!function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,(function(r){var n;return o(e[i][1][r]||r)}),p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r}()({1:[function(require,module,exports){"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),_debug=_interopRequireDefault(require("debug")),APP_NAME="mediasoup-demo",Logger=function(){function Logger(prefix){(0,_classCallCheck2.default)(this,Logger),prefix?(this._debug=(0,_debug.default)("".concat(APP_NAME,":").concat(prefix)),this._warn=(0,_debug.default)("".concat(APP_NAME,":WARN:").concat(prefix)),this._error=(0,_debug.default)("".concat(APP_NAME,":ERROR:").concat(prefix))):(this._debug=(0,_debug.default)(APP_NAME),this._warn=(0,_debug.default)("".concat(APP_NAME,":WARN")),this._error=(0,_debug.default)("".concat(APP_NAME,":ERROR"))),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}return(0,_createClass2.default)(Logger,[{key:"debug",get:function get(){return this._debug}},{key:"warn",get:function get(){return this._warn}},{key:"error",get:function get(){return this._error}}]),Logger}();exports.default=Logger},{"@babel/runtime/helpers/classCallCheck":39,"@babel/runtime/helpers/createClass":40,"@babel/runtime/helpers/interopRequireDefault":45,debug:260}],2:[function(require,module,exports){"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_typeof=require("@babel/runtime/helpers/typeof");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator")),_classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),_protooClient=_interopRequireDefault(require("protoo-client")),mediasoupClient=_interopRequireWildcard(require("mediasoup-client")),_Logger=_interopRequireDefault(require("./Logger")),_urlFactory=require("./urlFactory"),cookiesManager=_interopRequireWildcard(require("./cookiesManager")),requestActions=_interopRequireWildcard(require("./redux/requestActions")),stateActions=_interopRequireWildcard(require("./redux/stateActions")),e2e=_interopRequireWildcard(require("./e2e"));function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function _getRequireWildcardCache(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function _createForOfIteratorHelper(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(!it){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0,F=function F(){};return{s:F,n:function n(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function e(_e){throw _e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var normalCompletion=!0,didErr=!1,err;return{s:function s(){it=it.call(o)},n:function n(){var step=it.next();return normalCompletion=step.done,step},e:function e(_e2){didErr=!0,err=_e2},f:function f(){try{normalCompletion||null==it.return||it.return()}finally{if(didErr)throw err}}}}function _unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(o,minLen):void 0}}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){(0,_defineProperty2.default)(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}setTimeout((function(){}),5e3);var VIDEO_CONSTRAINS={qvga:{width:{ideal:320},height:{ideal:240}},vga:{width:{ideal:640},height:{ideal:480}},hd:{width:{ideal:1280},height:{ideal:720}}},PC_PROPRIETARY_CONSTRAINTS={optional:[{googDscp:!0}]},WEBCAM_SIMULCAST_ENCODINGS=[{scaleResolutionDownBy:4,maxBitrate:5e5},{scaleResolutionDownBy:2,maxBitrate:1e6},{scaleResolutionDownBy:1,maxBitrate:5e6}],WEBCAM_KSVC_ENCODINGS=[{scalabilityMode:"S3T3_KEY"}],SCREEN_SHARING_SIMULCAST_ENCODINGS=[{dtx:!0,maxBitrate:15e5},{dtx:!0,maxBitrate:6e6}],SCREEN_SHARING_SVC_ENCODINGS=[{scalabilityMode:"S3T3",dtx:!0}],EXTERNAL_VIDEO_SRC="/resources/videos/video-audio-stereo.mp4",logger=new _Logger.default("RoomClient"),store,RoomClient=function(){function RoomClient(_ref){var roomId=_ref.roomId,peerId=_ref.peerId,displayName=_ref.displayName,device=_ref.device,handlerName=_ref.handlerName,useSimulcast=_ref.useSimulcast,useSharingSimulcast=_ref.useSharingSimulcast,forceTcp=_ref.forceTcp,produce=_ref.produce,consume=_ref.consume,forceH264=_ref.forceH264,forceVP9=_ref.forceVP9,svc=_ref.svc,datachannel=_ref.datachannel,externalVideo=_ref.externalVideo,e2eKey=_ref.e2eKey;(0,_classCallCheck2.default)(this,RoomClient),this._closed=!1,this._displayName=displayName,this._device=device,this._forceTcp=forceTcp,this._produce=produce,this._consume=consume,this._useDataChannel=datachannel,this._forceH264=Boolean(forceH264),this._forceVP9=Boolean(forceVP9),this._externalVideo=null,this._e2eKey=e2eKey,this._externalVideoStream=null,this._nextDataChannelTestNumber=0,externalVideo&&(this._externalVideo=document.createElement("video"),this._externalVideo.controls=!0,this._externalVideo.muted=!0,this._externalVideo.loop=!0,this._externalVideo.setAttribute("playsinline",""),this._externalVideo.src=EXTERNAL_VIDEO_SRC,this._externalVideo.play().catch((function(error){return logger.warn("externalVideo.play() failed:%o",error)}))),this._handlerName=handlerName,this._useSimulcast=useSimulcast,this._useSharingSimulcast=useSharingSimulcast,this._protooUrl=(0,_urlFactory.getProtooUrl)({roomId:roomId,peerId:peerId}),this._protoo=null,this._mediasoupDevice=null,this._sendTransport=null,this._recvTransport=null,this._micProducer=null,this._webcamProducer=null,this._shareProducer=null,this._chatDataProducer=null,this._botDataProducer=null,this._consumers=new Map,this._dataConsumers=new Map,this._webcams=new Map,this._webcam={device:null,resolution:"vga"},svc&&(WEBCAM_KSVC_ENCODINGS[0].scalabilityMode="".concat(svc,"_KEY"),SCREEN_SHARING_SVC_ENCODINGS[0].scalabilityMode=svc),this._e2eKey&&e2e.isSupported()&&e2e.setCryptoKey("setCryptoKey",this._e2eKey,!0)}return(0,_createClass2.default)(RoomClient,[{key:"close",value:function close(){this._closed||(this._closed=!0,logger.debug("close()"),this._protoo.close(),this._sendTransport&&this._sendTransport.close(),this._recvTransport&&this._recvTransport.close(),store.dispatch(stateActions.setRoomState("closed")))}},{key:"join",value:function(){var _join=(0,_asyncToGenerator2.default)(_regenerator.default.mark((function _callee2(){var _this=this,protooTransport;return _regenerator.default.wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:protooTransport=new _protooClient.default.WebSocketTransport(this._protooUrl),this._protoo=new _protooClient.default.Peer(protooTransport),store.dispatch(stateActions.setRoomState("connecting")),this._protoo.on("open",(function(){return _this._joinRoom()})),this._protoo.on("failed",(function(){store.dispatch(requestActions.notify({type:"error",text:"WebSocket connection failed"}))})),this._protoo.on("disconnected",(function(){store.dispatch(requestActions.notify({type:"error",text:"WebSocket disconnected"})),_this._sendTransport&&(_this._sendTransport.close(),_this._sendTransport=null),_this._recvTransport&&(_this._recvTransport.close(),_this._recvTransport=null),store.dispatch(stateActions.setRoomState("closed"))})),this._protoo.on("close",(function(){_this._closed||_this.close()})),this._protoo.on("request",function(){var _ref2=(0,_asyncToGenerator2.default)(_regenerator.default.mark((function _callee(request,accept,reject){var _request$data,peerId,producerId,id,kind,rtpParameters,type,appData,producerPaused,consumer,share,screen,_mediasoupClient$pars,spatialLayers,temporalLayers,_request$data2,_peerId2,dataProducerId,_id,sctpStreamParameters,label,protocol,_appData,dataConsumer;return _regenerator.default.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:logger.debug('proto "request" event [method:%s, data:%o]',request.method,request.data),_context.t0=request.method,_context.next="newConsumer"===_context.t0?4:"newDataConsumer"===_context.t0?32:60;break;case 4:if(_this._consume){_context.next=7;break}return reject(403,"I do not want to consume"),_context.abrupt("break",60);case 7:return _request$data=request.data,peerId=_request$data.peerId,producerId=_request$data.producerId,id=_request$data.id,kind=_request$data.kind,rtpParameters=_request$data.rtpParameters,type=_request$data.type,appData=_request$data.appData,producerPaused=_request$data.producerPaused,_context.prev=8,_context.next=11,_this._recvTransport.consume({id:id,producerId:producerId,kind:kind,rtpParameters:rtpParameters,appData:_objectSpread(_objectSpread({},appData),{},{peerId:peerId})});case 11:consumer=_context.sent,_this._e2eKey&&e2e.isSupported()&&e2e.setupReceiverTransform(consumer.rtpReceiver),_this._consumers.set(consumer.id,consumer),console.log("consomer ----------------------------------------"),console.log(consumer),share=consumer._appData.share,screen=!1,share&&(console.warn("***************************************************************** scren share"),screen=!0),consumer.on("transportclose",(function(){_this._consumers.delete(consumer.id)})),_mediasoupClient$pars=mediasoupClient.parseScalabilityMode(consumer.rtpParameters.encodings[0].scalabilityMode),spatialLayers=_mediasoupClient$pars.spatialLayers,temporalLayers=_mediasoupClient$pars.temporalLayers,store.dispatch(stateActions.addConsumer({id:consumer.id,type:type,locallyPaused:!1,remotelyPaused:producerPaused,rtpParameters:consumer.rtpParameters,spatialLayers:spatialLayers,temporalLayers:temporalLayers,preferredSpatialLayer:spatialLayers-1,preferredTemporalLayer:temporalLayers-1,priority:1,codec:consumer.rtpParameters.codecs[0].mimeType.split("/")[1],track:consumer.track},peerId,screen)),accept(),"video"===consumer.kind&&store.getState().me.audioOnly&&_this._pauseConsumer(consumer),_context.next=31;break;case 26:throw _context.prev=26,_context.t1=_context.catch(8),logger.error('"newConsumer" request failed:%o',_context.t1),store.dispatch(requestActions.notify({type:"error",text:"Error creating a Consumer: ".concat(_context.t1)})),_context.t1;case 31:return _context.abrupt("break",60);case 32:if(_this._consume){_context.next=35;break}return reject(403,"I do not want to data consume"),_context.abrupt("break",60);case 35:if(_this._useDataChannel){_context.next=38;break}return reject(403,"I do not want DataChannels"),_context.abrupt("break",60);case 38:return _request$data2=request.data,_peerId2=_request$data2.peerId,dataProducerId=_request$data2.dataProducerId,_id=_request$data2.id,sctpStreamParameters=_request$data2.sctpStreamParameters,label=_request$data2.label,protocol=_request$data2.protocol,_appData=_request$data2.appData,_context.prev=39,_context.next=42,_this._recvTransport.consumeData({id:_id,dataProducerId:dataProducerId,sctpStreamParameters:sctpStreamParameters,label:label,protocol:protocol,appData:_objectSpread(_objectSpread({},_appData),{},{peerId:_peerId2})});case 42:dataConsumer=_context.sent,_this._dataConsumers.set(dataConsumer.id,dataConsumer),dataConsumer.on("transportclose",(function(){_this._dataConsumers.delete(dataConsumer.id)})),dataConsumer.on("open",(function(){logger.debug('DataConsumer "open" event')})),dataConsumer.on("close",(function(){logger.warn('DataConsumer "close" event'),_this._dataConsumers.delete(dataConsumer.id),store.dispatch(requestActions.notify({type:"error",text:"DataConsumer closed"}))})),dataConsumer.on("error",(function(error){logger.error('DataConsumer "error" event:%o',error),store.dispatch(requestActions.notify({type:"error",text:"DataConsumer error: ".concat(error)}))})),dataConsumer.on("message",(function(message){if(logger.debug('DataConsumer "message" event [streamId:%d]',dataConsumer.sctpStreamParameters.streamId),window.DC_MESSAGE=message,message instanceof ArrayBuffer){var view,number=new DataView(message).getUint32();return number==Math.pow(2,32)-1?(logger.warn("dataChannelTest finished!"),void(_this._nextDataChannelTestNumber=0)):(number>_this._nextDataChannelTestNumber&&logger.warn("dataChannelTest: %s packets missing",number-_this._nextDataChannelTestNumber),void(_this._nextDataChannelTestNumber=number+1))}if("string"==typeof message)switch(dataConsumer.label){case"chat":var _store$getState,peers=store.getState().peers,peersArray,sendingPeer=Object.keys(peers).map((function(_peerId){return peers[_peerId]})).find((function(peer){return peer.dataConsumers.includes(dataConsumer.id)}));if(!sendingPeer){logger.warn('DataConsumer "message" from unknown peer');break}store.dispatch(requestActions.notify({title:"".concat(sendingPeer.displayName," says:"),text:message,timeout:5e3}));break;case"bot":store.dispatch(requestActions.notify({title:"Message from Bot:",text:message,timeout:5e3}))}else logger.warn('ignoring DataConsumer "message" (not a string)')})),window.DC=dataConsumer,store.dispatch(stateActions.addDataConsumer({id:dataConsumer.id,sctpStreamParameters:dataConsumer.sctpStreamParameters,label:dataConsumer.label,protocol:dataConsumer.protocol},_peerId2)),accept(),_context.next=59;break;case 54:throw _context.prev=54,_context.t2=_context.catch(39),logger.error('"newDataConsumer" request failed:%o',_context.t2),store.dispatch(requestActions.notify({type:"error",text:"Error creating a DataConsumer: ".concat(_context.t2)})),_context.t2;case 59:return _context.abrupt("break",60);case 60:case"end":return _context.stop()}}),_callee,null,[[8,26],[39,54]])})));return function(_x,_x2,_x3){return _ref2.apply(this,arguments)}}()),this._protoo.on("notification",(function(notification){switch(notification.method){case"producerScore":var _notification$data=notification.data,producerId=_notification$data.producerId,score=_notification$data.score;store.dispatch(stateActions.setProducerScore(producerId,score));break;case"newPeer":var peer=notification.data;store.dispatch(stateActions.addPeer(_objectSpread(_objectSpread({},peer),{},{consumers:[],dataConsumers:[]})));break;case"peerClosed":var peerId=notification.data.peerId;store.dispatch(stateActions.removePeer(peerId));break;case"peerDisplayNameChanged":var _notification$data2=notification.data,_peerId3=_notification$data2.peerId,displayName=_notification$data2.displayName,oldDisplayName=_notification$data2.oldDisplayName;store.dispatch(stateActions.setPeerDisplayName(displayName,_peerId3)),store.dispatch(requestActions.notify({text:"".concat(oldDisplayName," is now ").concat(displayName)}));break;case"downlinkBwe":break;case"consumerClosed":var consumerId=notification.data.consumerId,consumer=_this._consumers.get(consumerId);if(!consumer)break;consumer.close(),_this._consumers.delete(consumerId);var _peerId4=consumer.appData.peerId,share,screen=!1;consumer._appData.share&&(console.warn("***************************************************************** scren share closed"),screen=!0),store.dispatch(stateActions.removeConsumer(consumerId,_peerId4,screen));break;case"consumerPaused":var _consumerId=notification.data.consumerId,_consumer=_this._consumers.get(_consumerId);if(!_consumer)break;_consumer.pause(),store.dispatch(stateActions.setConsumerPaused(_consumerId,"remote"));break;case"consumerResumed":var _consumerId2=notification.data.consumerId,_consumer2=_this._consumers.get(_consumerId2);if(!_consumer2)break;_consumer2.resume(),store.dispatch(stateActions.setConsumerResumed(_consumerId2,"remote"));break;case"consumerLayersChanged":var _notification$data3=notification.data,_consumerId3=_notification$data3.consumerId,spatialLayer=_notification$data3.spatialLayer,temporalLayer=_notification$data3.temporalLayer,_consumer3;if(!_this._consumers.get(_consumerId3))break;store.dispatch(stateActions.setConsumerCurrentLayers(_consumerId3,spatialLayer,temporalLayer));break;case"consumerScore":var _notification$data4=notification.data,_consumerId4=_notification$data4.consumerId,_score=_notification$data4.score;store.dispatch(stateActions.setConsumerScore(_consumerId4,_score));break;case"dataConsumerClosed":var dataConsumerId=notification.data.dataConsumerId,dataConsumer=_this._dataConsumers.get(dataConsumerId);if(!dataConsumer)break;dataConsumer.close(),_this._dataConsumers.delete(dataConsumerId);var _peerId5=dataConsumer.appData.peerId;store.dispatch(stateActions.removeDataConsumer(dataConsumerId,_peerId5));break;case"activeSpeaker":break;default:logger.error('unknown protoo notification.method "%s"',notification.method)}}));case 9:case"end":return _context2.stop()}}),_callee2,this)})));function join(){return _join.apply(this,arguments)}return join}()},{key:"enableMic",value:function(){var _enableMic=(0,_asyncToGenerator2.default)(_regenerator.default.mark((function _callee3(){var _this2=this,track,stream,_stream;return _regenerator.default.wrap((function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:if(!this._micProducer){_context3.next=2;break}return _context3.abrupt("return");case 2:if(this._mediasoupDevice.canProduce("audio")){_context3.next=5;break}return logger.error("enableMic() | cannot produce audio"),_context3.abrupt("return");case 5:if(_context3.prev=5,this._externalVideo){_context3.next=13;break}return _context3.next=9,navigator.mediaDevices.getUserMedia({audio:!0});case 9:stream=_context3.sent,track=stream.getAudioTracks()[0],_context3.next=17;break;case 13:return _context3.next=15,this._getExternalVideoStream();case 15:_stream=_context3.sent,track=_stream.getAudioTracks()[0].clone();case 17:return _context3.next=19,this._sendTransport.produce({track:track,codecOptions:{opusStereo:1,opusDtx:1}});case 19:this._micProducer=_context3.sent,this._e2eKey&&e2e.isSupported()&&e2e.setupSenderTransform(this._micProducer.rtpSender),store.dispatch(stateActions.addProducer({id:this._micProducer.id,paused:this._micProducer.paused,track:this._micProducer.track,rtpParameters:this._micProducer.rtpParameters,codec:this._micProducer.rtpParameters.codecs[0].mimeType.split("/")[1]})),store.dispatch(stateActions.CHANGEMYPEER()),this._micProducer.on("transportclose",(function(){_this2._micProducer=null})),this._micProducer.on("trackended",(function(){store.dispatch(requestActions.notify({type:"error",text:"Microphone disconnected!"})),_this2.disableMic().catch((function(){}))})),_context3.next=32;break;case 27:_context3.prev=27,_context3.t0=_context3.catch(5),logger.error("enableMic() | failed:%o",_context3.t0),store.dispatch(requestActions.notify({type:"error",text:"Error enabling microphone: ".concat(_context3.t0)})),track&&track.stop();case 32:case"end":return _context3.stop()}}),_callee3,this,[[5,27]])})));function enableMic(){return _enableMic.apply(this,arguments)}return enableMic}()},{key:"disableMic",value:function(){var _disableMic=(0,_asyncToGenerator2.default)(_regenerator.default.mark((function _callee4(){return _regenerator.default.wrap((function _callee4$(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:if(this._micProducer){_context4.next=2;break}return _context4.abrupt("return");case 2:return this._micProducer.close(),store.dispatch(stateActions.removeProducer(this._micProducer.id)),store.dispatch(stateActions.CHANGEMYPEER()),_context4.prev=5,_context4.next=8,this._protoo.request("closeProducer",{producerId:this._micProducer.id});case 8:_context4.next=13;break;case 10:_context4.prev=10,_context4.t0=_context4.catch(5),store.dispatch(requestActions.notify({type:"error",text:"Error closing server-side mic Producer: ".concat(_context4.t0)}));case 13:this._micProducer=null;case 14:case"end":return _context4.stop()}}),_callee4,this,[[5,10]])})));function disableMic(){return _disableMic.apply(this,arguments)}return disableMic}()},{key:"muteMic",value:function(){var _muteMic=(0,_asyncToGenerator2.default)(_regenerator.default.mark((function _callee5(){return _regenerator.default.wrap((function _callee5$(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:return logger.debug("muteMic()"),this._micProducer.pause(),_context5.prev=2,_context5.next=5,this._protoo.request("pauseProducer",{producerId:this._micProducer.id});case 5:store.dispatch(stateActions.setProducerPaused(this._micProducer.id)),_context5.next=12;break;case 8:_context5.prev=8,_context5.t0=_context5.catch(2),logger.error("muteMic() | failed: %o",_context5.t0),store.dispatch(requestActions.notify({type:"error",text:"Error pausing server-side mic Producer: ".concat(_context5.t0)}));case 12:case"end":return _context5.stop()}}),_callee5,this,[[2,8]])})));function muteMic(){return _muteMic.apply(this,arguments)}return muteMic}()},{key:"unmuteMic",value:function(){var _unmuteMic=(0,_asyncToGenerator2.default)(_regenerator.default.mark((function _callee6(){return _regenerator.default.wrap((function _callee6$(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:return logger.debug("unmuteMic()"),this._micProducer.resume(),_context6.prev=2,_context6.next=5,this._protoo.request("resumeProducer",{producerId:this._micProducer.id});case 5:store.dispatch(stateActions.setProducerResumed(this._micProducer.id)),_context6.next=12;break;case 8:_context6.prev=8,_context6.t0=_context6.catch(2),logger.error("unmuteMic() | failed: %o",_context6.t0),store.dispatch(requestActions.notify({type:"error",text:"Error resuming server-side mic Producer: ".concat(_context6.t0)}));case 12:case"end":return _context6.stop()}}),_callee6,this,[[2,8]])})));function unmuteMic(){return _unmuteMic.apply(this,arguments)}return unmuteMic}()},{key:"enableWebcam",value:function(){var _enableWebcam=(0,_asyncToGenerator2.default)(_regenerator.default.mark((function _callee7(){var _this3=this,track,device,resolution,stream,_stream2,encodings,codec,codecOptions,firstVideoCodec;return _regenerator.default.wrap((function _callee7$(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:if(logger.debug("enableWebcam()"),!this._webcamProducer){_context7.next=3;break}return _context7.abrupt("return");case 3:if(this._mediasoupDevice.canProduce("video")){_context7.next=6;break}return logger.error("enableWebcam() | cannot produce video"),_context7.abrupt("return");case 6:if(store.dispatch(stateActions.setWebcamInProgress(!0)),_context7.prev=7,this._externalVideo){_context7.next=22;break}return _context7.next=11,this._updateWebcams();case 11:if(device=this._webcam.device,resolution=this._webcam.resolution,device){_context7.next=15;break}throw new Error("no webcam devices");case 15:return logger.debug("enableWebcam() | calling getUserMedia()"),_context7.next=18,navigator.mediaDevices.getUserMedia({video:_objectSpread({deviceId:{ideal:device.deviceId}},VIDEO_CONSTRAINS[resolution])});case 18:stream=_context7.sent,track=stream.getVideoTracks()[0],_context7.next=27;break;case 22:return device={label:"external video"},_context7.next=25,this._getExternalVideoStream();case 25:_stream2=_context7.sent,track=_stream2.getVideoTracks()[0].clone();case 27:if(codecOptions={videoGoogleStartBitrate:1e3},!this._forceH264){_context7.next=34;break}if(codec=this._mediasoupDevice.rtpCapabilities.codecs.find((function(c){return"video/h264"===c.mimeType.toLowerCase()}))){_context7.next=32;break}throw new Error("desired H264 codec+configuration is not supported");case 32:_context7.next=38;break;case 34:if(!this._forceVP9){_context7.next=38;break}if(codec=this._mediasoupDevice.rtpCapabilities.codecs.find((function(c){return"video/vp9"===c.mimeType.toLowerCase()}))){_context7.next=38;break}throw new Error("desired VP9 codec+configuration is not supported");case 38:return this._useSimulcast&&(firstVideoCodec=this._mediasoupDevice.rtpCapabilities.codecs.find((function(c){return"video"===c.kind})),encodings=this._forceVP9&&codec||"video/vp9"===firstVideoCodec.mimeType.toLowerCase()?WEBCAM_KSVC_ENCODINGS:WEBCAM_SIMULCAST_ENCODINGS),_context7.next=41,this._sendTransport.produce({track:track,encodings:encodings,codecOptions:codecOptions,codec:codec});case 41:this._webcamProducer=_context7.sent,this._e2eKey&&e2e.isSupported()&&e2e.setupSenderTransform(this._webcamProducer.rtpSender),store.dispatch(stateActions.addProducer({id:this._webcamProducer.id,deviceLabel:device.label,type:this._getWebcamType(device),paused:this._webcamProducer.paused,track:this._webcamProducer.track,rtpParameters:this._webcamProducer.rtpParameters,codec:this._webcamProducer.rtpParameters.codecs[0].mimeType.split("/")[1]})),store.dispatch(stateActions.CHANGEMYPEER()),this._webcamProducer.on("transportclose",(function(){_this3._webcamProducer=null})),this._webcamProducer.on("trackended",(function(){store.dispatch(requestActions.notify({type:"error",text:"Webcam disconnected!"})),store.dispatch(stateActions.CHANGEMYPEER()),_this3.disableWebcam().catch((function(){}))})),_context7.next=55;break;case 49:_context7.prev=49,_context7.t0=_context7.catch(7),logger.error("enableWebcam() | failed:%o",_context7.t0),store.dispatch(requestActions.notify({type:"error",text:"Error enabling webcam: ".concat(_context7.t0)})),store.dispatch(stateActions.CHANGEMYPEER()),track&&track.stop();case 55:store.dispatch(stateActions.setWebcamInProgress(!1));case 56:case"end":return _context7.stop()}}),_callee7,this,[[7,49]])})));function enableWebcam(){return _enableWebcam.apply(this,arguments)}return enableWebcam}()},{key:"disableWebcam",value:function(){var _disableWebcam=(0,_asyncToGenerator2.default)(_regenerator.default.mark((function _callee8(){return _regenerator.default.wrap((function _callee8$(_context8){for(;;)switch(_context8.prev=_context8.next){case 0:if(logger.debug("disableWebcam()"),this._webcamProducer){_context8.next=3;break}return _context8.abrupt("return");case 3:return this._webcamProducer.close(),store.dispatch(stateActions.removeProducer(this._webcamProducer.id)),store.dispatch(stateActions.CHANGEMYPEER()),_context8.prev=6,_context8.next=9,this._protoo.request("closeProducer",{producerId:this._webcamProducer.id});case 9:_context8.next=14;break;case 11:_context8.prev=11,_context8.t0=_context8.catch(6),store.dispatch(requestActions.notify({type:"error",text:"Error closing server-side webcam Producer: ".concat(_context8.t0)}));case 14:this._webcamProducer=null;case 15:case"end":return _context8.stop()}}),_callee8,this,[[6,11]])})));function disableWebcam(){return _disableWebcam.apply(this,arguments)}return disableWebcam}()},{key:"changeWebcam",value:function(){var _changeWebcam=(0,_asyncToGenerator2.default)(_regenerator.default.mark((function _callee9(){var array,len,deviceId,idx,stream,track;return _regenerator.default.wrap((function _callee9$(_context9){for(;;)switch(_context9.prev=_context9.next){case 0:return logger.debug("changeWebcam()"),store.dispatch(stateActions.setWebcamInProgress(!0)),_context9.prev=2,_context9.next=5,this._updateWebcams();case 5:if(array=Array.from(this._webcams.keys()),len=array.length,deviceId=this._webcam.device?this._webcam.device.deviceId:void 0,(idx=array.indexOf(deviceId))<len-1?idx++:idx=0,this._webcam.device=this._webcams.get(array[idx]),logger.debug("changeWebcam() | new selected webcam [device:%o]",this._webcam.device),this._webcam.resolution="hd",this._webcam.device){_context9.next=15;break}throw new Error("no webcam devices");case 15:return this._webcamProducer.track.stop(),logger.debug("changeWebcam() | calling getUserMedia()"),_context9.next=19,navigator.mediaDevices.getUserMedia({video:_objectSpread({deviceId:{exact:this._webcam.device.deviceId}},VIDEO_CONSTRAINS[this._webcam.resolution])});case 19:return stream=_context9.sent,track=stream.getVideoTracks()[0],_context9.next=23,this._webcamProducer.replaceTrack({track:track});case 23:store.dispatch(stateActions.setProducerTrack(this._webcamProducer.id,track)),store.dispatch(stateActions.CHANGEMYPEER()),_context9.next=31;break;case 27:_context9.prev=27,_context9.t0=_context9.catch(2),logger.error("changeWebcam() | failed: %o",_context9.t0),store.dispatch(requestActions.notify({type:"error",text:"Could not change webcam: ".concat(_context9.t0)}));case 31:store.dispatch(stateActions.setWebcamInProgress(!1));case 32:case"end":return _context9.stop()}}),_callee9,this,[[2,27]])})));function changeWebcam(){return _changeWebcam.apply(this,arguments)}return changeWebcam}()},{key:"changeWebcamResolution",value:function(){var _changeWebcamResolution=(0,_asyncToGenerator2.default)(_regenerator.default.mark((function _callee10(){var stream,track;return _regenerator.default.wrap((function _callee10$(_context10){for(;;)switch(_context10.prev=_context10.next){case 0:logger.debug("changeWebcamResolution()"),store.dispatch(stateActions.setWebcamInProgress(!0)),_context10.prev=2,_context10.t0=this._webcam.resolution,_context10.next="qvga"===_context10.t0?6:"vga"===_context10.t0?8:"hd"===_context10.t0?10:12;break;case 6:return this._webcam.resolution="vga",_context10.abrupt("break",13);case 8:return this._webcam.resolution="hd",_context10.abrupt("break",13);case 10:return this._webcam.resolution="qvga",_context10.abrupt("break",13);case 12:this._webcam.resolution="hd";case 13:return logger.debug("changeWebcamResolution() | calling getUserMedia()"),_context10.next=16,navigator.mediaDevices.getUserMedia({video:_objectSpread({deviceId:{exact:this._webcam.device.deviceId}},VIDEO_CONSTRAINS[this._webcam.resolution])});case 16:return stream=_context10.sent,track=stream.getVideoTracks()[0],_context10.next=20,this._webcamProducer.replaceTrack({track:track});case 20:store.dispatch(stateActions.setProducerTrack(this._webcamProducer.id,track)),_context10.next=27;break;case 23:_context10.prev=23,_context10.t1=_context10.catch(2),logger.error("changeWebcamResolution() | failed: %o",_context10.t1),store.dispatch(requestActions.notify({type:"error",text:"Could not change webcam resolution: ".concat(_context10.t1)}));case 27:store.dispatch(stateActions.setWebcamInProgress(!1));case 28:case"end":return _context10.stop()}}),_callee10,this,[[2,23]])})));function changeWebcamResolution(){return _changeWebcamResolution.apply(this,arguments)}return changeWebcamResolution}()},{key:"enableShare",value:function(){var _enableShare=(0,_asyncToGenerator2.default)(_regenerator.default.mark((function _callee11(){var _this4=this,track,stream,encodings,codec,codecOptions,firstVideoCodec;return _regenerator.default.wrap((function _callee11$(_context11){for(;;)switch(_context11.prev=_context11.next){case 0:if(logger.debug("enableShare()"),!this._shareProducer){_context11.next=3;break}return _context11.abrupt("return");case 3:if(this._mediasoupDevice.canProduce("video")){_context11.next=6;break}return logger.error("enableShare() | cannot produce video"),_context11.abrupt("return");case 6:return store.dispatch(stateActions.setShareInProgress(!0)),_context11.prev=7,logger.debug("enableShare() | calling getUserMedia()"),_context11.next=11,navigator.mediaDevices.getDisplayMedia({audio:!1,video:{displaySurface:"monitor",logicalSurface:!0,cursor:!0,width:{max:1920},height:{max:1080},frameRate:{max:30}}});case 11:if(stream=_context11.sent){_context11.next=15;break}return store.dispatch(stateActions.setShareInProgress(!0)),_context11.abrupt("return");case 15:if(track=stream.getVideoTracks()[0],codecOptions={videoGoogleStartBitrate:1e3},!this._forceH264){_context11.next=23;break}if(codec=this._mediasoupDevice.rtpCapabilities.codecs.find((function(c){return"video/h264"===c.mimeType.toLowerCase()}))){_context11.next=21;break}throw new Error("desired H264 codec+configuration is not supported");case 21:_context11.next=27;break;case 23:if(!this._forceVP9){_context11.next=27;break}if(codec=this._mediasoupDevice.rtpCapabilities.codecs.find((function(c){return"video/vp9"===c.mimeType.toLowerCase()}))){_context11.next=27;break}throw new Error("desired VP9 codec+configuration is not supported");case 27:return this._useSharingSimulcast&&(firstVideoCodec=this._mediasoupDevice.rtpCapabilities.codecs.find((function(c){return"video"===c.kind})),encodings=this._forceVP9&&codec||"video/vp9"===firstVideoCodec.mimeType.toLowerCase()?SCREEN_SHARING_SVC_ENCODINGS:SCREEN_SHARING_SIMULCAST_ENCODINGS.map((function(encoding){return _objectSpread(_objectSpread({},encoding),{},{dtx:!0})}))),_context11.next=30,this._sendTransport.produce({track:track,encodings:encodings,codecOptions:codecOptions,codec:codec,appData:{share:!0}});case 30:this._shareProducer=_context11.sent,this._e2eKey&&e2e.isSupported()&&e2e.setupSenderTransform(this._shareProducer.rtpSender),store.dispatch(stateActions.addProducer({id:this._shareProducer.id,type:"share",paused:this._shareProducer.paused,track:this._shareProducer.track,rtpParameters:this._shareProducer.rtpParameters,codec:this._shareProducer.rtpParameters.codecs[0].mimeType.split("/")[1]})),store.dispatch(stateActions.CHANGEMYPEER()),webRtcControler.click(),this._shareProducer.on("transportclose",(function(){_this4._shareProducer=null})),this._shareProducer.on("trackended",(function(){store.dispatch(requestActions.notify({type:"error",text:"Share disconnected!"})),_this4.disableShare().catch((function(){}))})),_context11.next=44;break;case 39:_context11.prev=39,_context11.t0=_context11.catch(7),logger.error("enableShare() | failed:%o",_context11.t0),"NotAllowedError"!==_context11.t0.name&&store.dispatch(requestActions.notify({type:"error",text:"Error sharing: ".concat(_context11.t0)})),track&&track.stop();case 44:store.dispatch(stateActions.setShareInProgress(!1));case 45:case"end":return _context11.stop()}}),_callee11,this,[[7,39]])})));function enableShare(){return _enableShare.apply(this,arguments)}return enableShare}()},{key:"disableShare",value:function(){var _disableShare=(0,_asyncToGenerator2.default)(_regenerator.default.mark((function _callee12(){return _regenerator.default.wrap((function _callee12$(_context12){for(;;)switch(_context12.prev=_context12.next){case 0:if(logger.debug("disableShare()"),this._shareProducer){_context12.next=3;break}return _context12.abrupt("return");case 3:return this._shareProducer.close(),store.dispatch(stateActions.removeProducer(this._shareProducer.id)),store.dispatch(stateActions.CHANGEMYPEER()),_context12.prev=6,_context12.next=9,this._protoo.request("closeProducer",{producerId:this._shareProducer.id});case 9:_context12.next=14;break;case 11:_context12.prev=11,_context12.t0=_context12.catch(6),store.dispatch(requestActions.notify({type:"error",text:"Error closing server-side share Producer: ".concat(_context12.t0)}));case 14:this._shareProducer=null;case 15:case"end":return _context12.stop()}}),_callee12,this,[[6,11]])})));function disableShare(){return _disableShare.apply(this,arguments)}return disableShare}()},{key:"enableAudioOnly",value:function(){var _enableAudioOnly=(0,_asyncToGenerator2.default)(_regenerator.default.mark((function _callee13(){var _iterator,_step,consumer;return _regenerator.default.wrap((function _callee13$(_context13){for(;;)switch(_context13.prev=_context13.next){case 0:logger.debug("enableAudioOnly()"),store.dispatch(stateActions.setAudioOnlyInProgress(!0)),this.disableWebcam(),_iterator=_createForOfIteratorHelper(this._consumers.values()),_context13.prev=4,_iterator.s();case 6:if((_step=_iterator.n()).done){_context13.next=13;break}if("video"===(consumer=_step.value).kind){_context13.next=10;break}return _context13.abrupt("continue",11);case 10:this._pauseConsumer(consumer);case 11:_context13.next=6;break;case 13:_context13.next=18;break;case 15:_context13.prev=15,_context13.t0=_context13.catch(4),_iterator.e(_context13.t0);case 18:return _context13.prev=18,_iterator.f(),_context13.finish(18);case 21:store.dispatch(stateActions.setAudioOnlyState(!0)),store.dispatch(stateActions.setAudioOnlyInProgress(!1));case 23:case"end":return _context13.stop()}}),_callee13,this,[[4,15,18,21]])})));function enableAudioOnly(){return _enableAudioOnly.apply(this,arguments)}return enableAudioOnly}()},{key:"disableAudioOnly",value:function(){var _disableAudioOnly=(0,_asyncToGenerator2.default)(_regenerator.default.mark((function _callee14(){var _iterator2,_step2,consumer;return _regenerator.default.wrap((function _callee14$(_context14){for(;;)switch(_context14.prev=_context14.next){case 0:logger.debug("disableAudioOnly()"),store.dispatch(stateActions.setAudioOnlyInProgress(!0)),!this._webcamProducer&&this._produce&&(cookiesManager.getDevices()||{}).webcamEnabled&&this.enableWebcam(),_iterator2=_createForOfIteratorHelper(this._consumers.values()),_context14.prev=4,_iterator2.s();case 6:if((_step2=_iterator2.n()).done){_context14.next=13;break}if("video"===(consumer=_step2.value).kind){_context14.next=10;break}return _context14.abrupt("continue",11);case 10:this._resumeConsumer(consumer);case 11:_context14.next=6;break;case 13:_context14.next=18;break;case 15:_context14.prev=15,_context14.t0=_context14.catch(4),_iterator2.e(_context14.t0);case 18:return _context14.prev=18,_iterator2.f(),_context14.finish(18);case 21:store.dispatch(stateActions.setAudioOnlyState(!1)),store.dispatch(stateActions.setAudioOnlyInProgress(!1));case 23:case"end":return _context14.stop()}}),_callee14,this,[[4,15,18,21]])})));function disableAudioOnly(){return _disableAudioOnly.apply(this,arguments)}return disableAudioOnly}()},{key:"muteAudio",value:function(){var _muteAudio=(0,_asyncToGenerator2.default)(_regenerator.default.mark((function _callee15(){return _regenerator.default.wrap((function _callee15$(_context15){for(;;)switch(_context15.prev=_context15.next){case 0:logger.debug("muteAudio()"),store.dispatch(stateActions.setAudioMutedState(!0));case 2:case"end":return _context15.stop()}}),_callee15)})));function muteAudio(){return _muteAudio.apply(this,arguments)}return muteAudio}()},{key:"unmuteAudio",value:function(){var _unmuteAudio=(0,_asyncToGenerator2.default)(_regenerator.default.mark((function _callee16(){return _regenerator.default.wrap((function _callee16$(_context16){for(;;)switch(_context16.prev=_context16.next){case 0:logger.debug("unmuteAudio()"),store.dispatch(stateActions.setAudioMutedState(!1));case 2:case"end":return _context16.stop()}}),_callee16)})));function unmuteAudio(){return _unmuteAudio.apply(this,arguments)}return unmuteAudio}()},{key:"restartIce",value:function(){var _restartIce=(0,_asyncToGenerator2.default)(_regenerator.default.mark((function _callee17(){var iceParameters,_iceParameters;return _regenerator.default.wrap((function _callee17$(_context17){for(;;)switch(_context17.prev=_context17.next){case 0:if(logger.debug("restartIce()"),store.dispatch(stateActions.setRestartIceInProgress(!0)),_context17.prev=2,!this._sendTransport){_context17.next=9;break}return _context17.next=6,this._protoo.request("restartIce",{transportId:this._sendTransport.id});case 6:return iceParameters=_context17.sent,_context17.next=9,this._sendTransport.restartIce({iceParameters:iceParameters});case 9:if(!this._recvTransport){_context17.next=15;break}return _context17.next=12,this._protoo.request("restartIce",{transportId:this._recvTransport.id});case 12:return _iceParameters=_context17.sent,_context17.next=15,this._recvTransport.restartIce({iceParameters:_iceParameters});case 15:store.dispatch(requestActions.notify({text:"ICE restarted"})),_context17.next=22;break;case 18:_context17.prev=18,_context17.t0=_context17.catch(2),logger.error("restartIce() | failed:%o",_context17.t0),store.dispatch(requestActions.notify({type:"error",text:"ICE restart failed: ".concat(_context17.t0)}));case 22:store.dispatch(stateActions.setRestartIceInProgress(!1));case 23:case"end":return _context17.stop()}}),_callee17,this,[[2,18]])})));function restartIce(){return _restartIce.apply(this,arguments)}return restartIce}()},{key:"setMaxSendingSpatialLayer",value:function(){var _setMaxSendingSpatialLayer=(0,_asyncToGenerator2.default)(_regenerator.default.mark((function _callee18(spatialLayer){return _regenerator.default.wrap((function _callee18$(_context18){for(;;)switch(_context18.prev=_context18.next){case 0:if(_context18.prev=0,!this._webcamProducer){_context18.next=6;break}return _context18.next=4,this._webcamProducer.setMaxSpatialLayer(spatialLayer);case 4:_context18.next=9;break;case 6:if(!this._shareProducer){_context18.next=9;break}return _context18.next=9,this._shareProducer.setMaxSpatialLayer(spatialLayer);case 9:_context18.next=15;break;case 11:_context18.prev=11,_context18.t0=_context18.catch(0),logger.error("setMaxSendingSpatialLayer() | failed:%o",_context18.t0),store.dispatch(requestActions.notify({type:"error",text:"Error setting max sending video spatial layer: ".concat(_context18.t0)}));case 15:case"end":return _context18.stop()}}),_callee18,this,[[0,11]])})));function setMaxSendingSpatialLayer(_x4){return _setMaxSendingSpatialLayer.apply(this,arguments)}return setMaxSendingSpatialLayer}()},{key:"setConsumerPreferredLayers",value:function(){var _setConsumerPreferredLayers=(0,_asyncToGenerator2.default)(_regenerator.default.mark((function _callee19(consumerId,spatialLayer,temporalLayer){return _regenerator.default.wrap((function _callee19$(_context19){for(;;)switch(_context19.prev=_context19.next){case 0:return _context19.prev=0,_context19.next=3,this._protoo.request("setConsumerPreferredLayers",{consumerId:consumerId,spatialLayer:spatialLayer,temporalLayer:temporalLayer});case 3:store.dispatch(stateActions.setConsumerPreferredLayers(consumerId,spatialLayer,temporalLayer)),_context19.next=10;break;case 6:_context19.prev=6,_context19.t0=_context19.catch(0),logger.error("setConsumerPreferredLayers() | failed:%o",_context19.t0),store.dispatch(requestActions.notify({type:"error",text:"Error setting Consumer preferred layers: ".concat(_context19.t0)}));case 10:case"end":return _context19.stop()}}),_callee19,this,[[0,6]])})));function setConsumerPreferredLayers(_x5,_x6,_x7){return _setConsumerPreferredLayers.apply(this,arguments)}return setConsumerPreferredLayers}()},{key:"setConsumerPriority",value:function(){var _setConsumerPriority=(0,_asyncToGenerator2.default)(_regenerator.default.mark((function _callee20(consumerId,priority){return _regenerator.default.wrap((function _callee20$(_context20){for(;;)switch(_context20.prev=_context20.next){case 0:return _context20.prev=0,_context20.next=3,this._protoo.request("setConsumerPriority",{consumerId:consumerId,priority:priority});case 3:store.dispatch(stateActions.setConsumerPriority(consumerId,priority)),_context20.next=10;break;case 6:_context20.prev=6,_context20.t0=_context20.catch(0),logger.error("setConsumerPriority() | failed:%o",_context20.t0),store.dispatch(requestActions.notify({type:"error",text:"Error setting Consumer priority: ".concat(_context20.t0)}));case 10:case"end":return _context20.stop()}}),_callee20,this,[[0,6]])})));function setConsumerPriority(_x8,_x9){return _setConsumerPriority.apply(this,arguments)}return setConsumerPriority}()},{key:"requestConsumerKeyFrame",value:function(){var _requestConsumerKeyFrame=(0,_asyncToGenerator2.default)(_regenerator.default.mark((function _callee21(consumerId){return _regenerator.default.wrap((function _callee21$(_context21){for(;;)switch(_context21.prev=_context21.next){case 0:return _context21.prev=0,_context21.next=3,this._protoo.request("requestConsumerKeyFrame",{consumerId:consumerId});case 3:store.dispatch(requestActions.notify({text:"Keyframe requested for video consumer"})),_context21.next=10;break;case 6:_context21.prev=6,_context21.t0=_context21.catch(0),logger.error("requestConsumerKeyFrame() | failed:%o",_context21.t0),store.dispatch(requestActions.notify({type:"error",text:"Error requesting key frame for Consumer: ".concat(_context21.t0)}));case 10:case"end":return _context21.stop()}}),_callee21,this,[[0,6]])})));function requestConsumerKeyFrame(_x10){return _requestConsumerKeyFrame.apply(this,arguments)}return requestConsumerKeyFrame}()},{key:"enableChatDataProducer",value:function(){var _enableChatDataProducer=(0,_asyncToGenerator2.default)(_regenerator.default.mark((function _callee22(){var _this5=this;return _regenerator.default.wrap((function _callee22$(_context22){for(;;)switch(_context22.prev=_context22.next){case 0:if(logger.debug("enableChatDataProducer()"),this._useDataChannel){_context22.next=3;break}return _context22.abrupt("return");case 3:return _context22.prev=3,_context22.next=6,this._sendTransport.produceData({ordered:!1,maxRetransmits:1,label:"chat",priority:"medium",appData:{info:"my-chat-DataProducer"}});case 6:this._chatDataProducer=_context22.sent,store.dispatch(stateActions.addDataProducer({id:this._chatDataProducer.id,sctpStreamParameters:this._chatDataProducer.sctpStreamParameters,label:this._chatDataProducer.label,protocol:this._chatDataProducer.protocol})),this._chatDataProducer.on("transportclose",(function(){_this5._chatDataProducer=null})),this._chatDataProducer.on("open",(function(){logger.debug('chat DataProducer "open" event')})),this._chatDataProducer.on("close",(function(){logger.error('chat DataProducer "close" event'),_this5._chatDataProducer=null,store.dispatch(requestActions.notify({type:"error",text:"Chat DataProducer closed"}))})),this._chatDataProducer.on("error",(function(error){logger.error('chat DataProducer "error" event:%o',error),store.dispatch(requestActions.notify({type:"error",text:"Chat DataProducer error: ".concat(error)}))})),this._chatDataProducer.on("bufferedamountlow",(function(){logger.debug('chat DataProducer "bufferedamountlow" event')})),_context22.next=20;break;case 15:throw _context22.prev=15,_context22.t0=_context22.catch(3),logger.error("enableChatDataProducer() | failed:%o",_context22.t0),store.dispatch(requestActions.notify({type:"error",text:"Error enabling chat DataProducer: ".concat(_context22.t0)})),_context22.t0;case 20:case"end":return _context22.stop()}}),_callee22,this,[[3,15]])})));function enableChatDataProducer(){return _enableChatDataProducer.apply(this,arguments)}return enableChatDataProducer}()},{key:"enableBotDataProducer",value:function(){var _enableBotDataProducer=(0,_asyncToGenerator2.default)(_regenerator.default.mark((function _callee23(){var _this6=this;return _regenerator.default.wrap((function _callee23$(_context23){for(;;)switch(_context23.prev=_context23.next){case 0:if(logger.debug("enableBotDataProducer()"),this._useDataChannel){_context23.next=3;break}return _context23.abrupt("return");case 3:return _context23.prev=3,_context23.next=6,this._sendTransport.produceData({ordered:!1,maxPacketLifeTime:2e3,label:"bot",priority:"medium",appData:{info:"my-bot-DataProducer"}});case 6:this._botDataProducer=_context23.sent,store.dispatch(stateActions.addDataProducer({id:this._botDataProducer.id,sctpStreamParameters:this._botDataProducer.sctpStreamParameters,label:this._botDataProducer.label,protocol:this._botDataProducer.protocol})),this._botDataProducer.on("transportclose",(function(){_this6._botDataProducer=null})),this._botDataProducer.on("open",(function(){logger.debug('bot DataProducer "open" event')})),this._botDataProducer.on("close",(function(){logger.error('bot DataProducer "close" event'),_this6._botDataProducer=null,store.dispatch(requestActions.notify({type:"error",text:"Bot DataProducer closed"}))})),this._botDataProducer.on("error",(function(error){logger.error('bot DataProducer "error" event:%o',error),store.dispatch(requestActions.notify({type:"error",text:"Bot DataProducer error: ".concat(error)}))})),this._botDataProducer.on("bufferedamountlow",(function(){logger.debug('bot DataProducer "bufferedamountlow" event')})),_context23.next=20;break;case 15:throw _context23.prev=15,_context23.t0=_context23.catch(3),logger.error("enableBotDataProducer() | failed:%o",_context23.t0),store.dispatch(requestActions.notify({type:"error",text:"Error enabling bot DataProducer: ".concat(_context23.t0)})),_context23.t0;case 20:case"end":return _context23.stop()}}),_callee23,this,[[3,15]])})));function enableBotDataProducer(){return _enableBotDataProducer.apply(this,arguments)}return enableBotDataProducer}()},{key:"sendChatMessage",value:function(){var _sendChatMessage=(0,_asyncToGenerator2.default)(_regenerator.default.mark((function _callee24(text){return _regenerator.default.wrap((function _callee24$(_context24){for(;;)switch(_context24.prev=_context24.next){case 0:if(logger.debug('sendChatMessage() [text:"%s]',text),this._chatDataProducer){_context24.next=4;break}return store.dispatch(requestActions.notify({type:"error",text:"No chat DataProducer"})),_context24.abrupt("return");case 4:try{this._chatDataProducer.send(text)}catch(error){logger.error("chat DataProducer.send() failed:%o",error),store.dispatch(requestActions.notify({type:"error",text:"chat DataProducer.send() failed: ".concat(error)}))}case 5:case"end":return _context24.stop()}}),_callee24,this)})));function sendChatMessage(_x11){return _sendChatMessage.apply(this,arguments)}return sendChatMessage}()},{key:"sendBotMessage",value:function(){var _sendBotMessage=(0,_asyncToGenerator2.default)(_regenerator.default.mark((function _callee25(text){return _regenerator.default.wrap((function _callee25$(_context25){for(;;)switch(_context25.prev=_context25.next){case 0:if(logger.debug('sendBotMessage() [text:"%s]',text),this._botDataProducer){_context25.next=4;break}return store.dispatch(requestActions.notify({type:"error",text:"No bot DataProducer"})),_context25.abrupt("return");case 4:try{this._botDataProducer.send(text)}catch(error){logger.error("bot DataProducer.send() failed:%o",error),store.dispatch(requestActions.notify({type:"error",text:"bot DataProducer.send() failed: ".concat(error)}))}case 5:case"end":return _context25.stop()}}),_callee25,this)})));function sendBotMessage(_x12){return _sendBotMessage.apply(this,arguments)}return sendBotMessage}()},{key:"changeDisplayName",value:function(){var _changeDisplayName=(0,_asyncToGenerator2.default)(_regenerator.default.mark((function _callee26(displayName){return _regenerator.default.wrap((function _callee26$(_context26){for(;;)switch(_context26.prev=_context26.next){case 0:return logger.debug('changeDisplayName() [displayName:"%s"]',displayName),cookiesManager.setUser({displayName:displayName}),_context26.prev=2,_context26.next=5,this._protoo.request("changeDisplayName",{displayName:displayName});case 5:this._displayName=displayName,store.dispatch(stateActions.setDisplayName(displayName)),store.dispatch(requestActions.notify({text:"Display name changed"})),_context26.next=15;break;case 10:_context26.prev=10,_context26.t0=_context26.catch(2),logger.error("changeDisplayName() | failed: %o",_context26.t0),store.dispatch(requestActions.notify({type:"error",text:"Could not change display name: ".concat(_context26.t0)})),store.dispatch(stateActions.setDisplayName());case 15:case"end":return _context26.stop()}}),_callee26,this,[[2,10]])})));function changeDisplayName(_x13){return _changeDisplayName.apply(this,arguments)}return changeDisplayName}()},{key:"getSendTransportRemoteStats",value:function(){var _getSendTransportRemoteStats=(0,_asyncToGenerator2.default)(_regenerator.default.mark((function _callee27(){return _regenerator.default.wrap((function _callee27$(_context27){for(;;)switch(_context27.prev=_context27.next){case 0:if(logger.debug("getSendTransportRemoteStats()"),this._sendTransport){_context27.next=3;break}return _context27.abrupt("return");case 3:return _context27.abrupt("return",this._protoo.request("getTransportStats",{transportId:this._sendTransport.id}));case 4:case"end":return _context27.stop()}}),_callee27,this)})));function getSendTransportRemoteStats(){return _getSendTransportRemoteStats.apply(this,arguments)}return getSendTransportRemoteStats}()},{key:"getRecvTransportRemoteStats",value:function(){var _getRecvTransportRemoteStats=(0,_asyncToGenerator2.default)(_regenerator.default.mark((function _callee28(){return _regenerator.default.wrap((function _callee28$(_context28){for(;;)switch(_context28.prev=_context28.next){case 0:if(logger.debug("getRecvTransportRemoteStats()"),this._recvTransport){_context28.next=3;break}return _context28.abrupt("return");case 3:return _context28.abrupt("return",this._protoo.request("getTransportStats",{transportId:this._recvTransport.id}));case 4:case"end":return _context28.stop()}}),_callee28,this)})));function getRecvTransportRemoteStats(){return _getRecvTransportRemoteStats.apply(this,arguments)}return getRecvTransportRemoteStats}()},{key:"getAudioRemoteStats",value:function(){var _getAudioRemoteStats=(0,_asyncToGenerator2.default)(_regenerator.default.mark((function _callee29(){return _regenerator.default.wrap((function _callee29$(_context29){for(;;)switch(_context29.prev=_context29.next){case 0:if(logger.debug("getAudioRemoteStats()"),this._micProducer){_context29.next=3;break}return _context29.abrupt("return");case 3:return _context29.abrupt("return",this._protoo.request("getProducerStats",{producerId:this._micProducer.id}));case 4:case"end":return _context29.stop()}}),_callee29,this)})));function getAudioRemoteStats(){return _getAudioRemoteStats.apply(this,arguments)}return getAudioRemoteStats}()},{key:"getVideoRemoteStats",value:function(){var _getVideoRemoteStats=(0,_asyncToGenerator2.default)(_regenerator.default.mark((function _callee30(){var producer;return _regenerator.default.wrap((function _callee30$(_context30){for(;;)switch(_context30.prev=_context30.next){case 0:if(logger.debug("getVideoRemoteStats()"),producer=this._webcamProducer||this._shareProducer){_context30.next=4;break}return _context30.abrupt("return");case 4:return _context30.abrupt("return",this._protoo.request("getProducerStats",{producerId:producer.id}));case 5:case"end":return _context30.stop()}}),_callee30,this)})));function getVideoRemoteStats(){return _getVideoRemoteStats.apply(this,arguments)}return getVideoRemoteStats}()},{key:"getConsumerRemoteStats",value:function(){var _getConsumerRemoteStats=(0,_asyncToGenerator2.default)(_regenerator.default.mark((function _callee31(consumerId){var consumer;return _regenerator.default.wrap((function _callee31$(_context31){for(;;)switch(_context31.prev=_context31.next){case 0:if(logger.debug("getConsumerRemoteStats()"),consumer=this._consumers.get(consumerId)){_context31.next=4;break}return _context31.abrupt("return");case 4:return _context31.abrupt("return",this._protoo.request("getConsumerStats",{consumerId:consumerId}));case 5:case"end":return _context31.stop()}}),_callee31,this)})));function getConsumerRemoteStats(_x14){return _getConsumerRemoteStats.apply(this,arguments)}return getConsumerRemoteStats}()},{key:"getChatDataProducerRemoteStats",value:function(){var _getChatDataProducerRemoteStats=(0,_asyncToGenerator2.default)(_regenerator.default.mark((function _callee32(){var dataProducer;return _regenerator.default.wrap((function _callee32$(_context32){for(;;)switch(_context32.prev=_context32.next){case 0:if(logger.debug("getChatDataProducerRemoteStats()"),dataProducer=this._chatDataProducer){_context32.next=4;break}return _context32.abrupt("return");case 4:return _context32.abrupt("return",this._protoo.request("getDataProducerStats",{dataProducerId:dataProducer.id}));case 5:case"end":return _context32.stop()}}),_callee32,this)})));function getChatDataProducerRemoteStats(){return _getChatDataProducerRemoteStats.apply(this,arguments)}return getChatDataProducerRemoteStats}()},{key:"getBotDataProducerRemoteStats",value:function(){var _getBotDataProducerRemoteStats=(0,_asyncToGenerator2.default)(_regenerator.default.mark((function _callee33(){var dataProducer;return _regenerator.default.wrap((function _callee33$(_context33){for(;;)switch(_context33.prev=_context33.next){case 0:if(logger.debug("getBotDataProducerRemoteStats()"),dataProducer=this._botDataProducer){_context33.next=4;break}return _context33.abrupt("return");case 4:return _context33.abrupt("return",this._protoo.request("getDataProducerStats",{dataProducerId:dataProducer.id}));case 5:case"end":return _context33.stop()}}),_callee33,this)})));function getBotDataProducerRemoteStats(){return _getBotDataProducerRemoteStats.apply(this,arguments)}return getBotDataProducerRemoteStats}()},{key:"getDataConsumerRemoteStats",value:function(){var _getDataConsumerRemoteStats=(0,_asyncToGenerator2.default)(_regenerator.default.mark((function _callee34(dataConsumerId){var dataConsumer;return _regenerator.default.wrap((function _callee34$(_context34){for(;;)switch(_context34.prev=_context34.next){case 0:if(logger.debug("getDataConsumerRemoteStats()"),dataConsumer=this._dataConsumers.get(dataConsumerId)){_context34.next=4;break}return _context34.abrupt("return");case 4:return _context34.abrupt("return",this._protoo.request("getDataConsumerStats",{dataConsumerId:dataConsumerId}));case 5:case"end":return _context34.stop()}}),_callee34,this)})));function getDataConsumerRemoteStats(_x15){return _getDataConsumerRemoteStats.apply(this,arguments)}return getDataConsumerRemoteStats}()},{key:"getSendTransportLocalStats",value:function(){var _getSendTransportLocalStats=(0,_asyncToGenerator2.default)(_regenerator.default.mark((function _callee35(){return _regenerator.default.wrap((function _callee35$(_context35){for(;;)switch(_context35.prev=_context35.next){case 0:if(logger.debug("getSendTransportLocalStats()"),this._sendTransport){_context35.next=3;break}return _context35.abrupt("return");case 3:return _context35.abrupt("return",this._sendTransport.getStats());case 4:case"end":return _context35.stop()}}),_callee35,this)})));function getSendTransportLocalStats(){return _getSendTransportLocalStats.apply(this,arguments)}return getSendTransportLocalStats}()},{key:"getRecvTransportLocalStats",value:function(){var _getRecvTransportLocalStats=(0,_asyncToGenerator2.default)(_regenerator.default.mark((function _callee36(){return _regenerator.default.wrap((function _callee36$(_context36){for(;;)switch(_context36.prev=_context36.next){case 0:if(logger.debug("getRecvTransportLocalStats()"),this._recvTransport){_context36.next=3;break}return _context36.abrupt("return");case 3:return _context36.abrupt("return",this._recvTransport.getStats());case 4:case"end":return _context36.stop()}}),_callee36,this)})));function getRecvTransportLocalStats(){return _getRecvTransportLocalStats.apply(this,arguments)}return getRecvTransportLocalStats}()},{key:"getAudioLocalStats",value:function(){var _getAudioLocalStats=(0,_asyncToGenerator2.default)(_regenerator.default.mark((function _callee37(){return _regenerator.default.wrap((function _callee37$(_context37){for(;;)switch(_context37.prev=_context37.next){case 0:if(logger.debug("getAudioLocalStats()"),this._micProducer){_context37.next=3;break}return _context37.abrupt("return");case 3:return _context37.abrupt("return",this._micProducer.getStats());case 4:case"end":return _context37.stop()}}),_callee37,this)})));function getAudioLocalStats(){return _getAudioLocalStats.apply(this,arguments)}return getAudioLocalStats}()},{key:"getVideoLocalStats",value:function(){var _getVideoLocalStats=(0,_asyncToGenerator2.default)(_regenerator.default.mark((function _callee38(){var producer;return _regenerator.default.wrap((function _callee38$(_context38){for(;;)switch(_context38.prev=_context38.next){case 0:if(logger.debug("getVideoLocalStats()"),producer=this._webcamProducer||this._shareProducer){_context38.next=4;break}return _context38.abrupt("return");case 4:return _context38.abrupt("return",producer.getStats());case 5:case"end":return _context38.stop()}}),_callee38,this)})));function getVideoLocalStats(){return _getVideoLocalStats.apply(this,arguments)}return getVideoLocalStats}()},{key:"getConsumerLocalStats",value:function(){var _getConsumerLocalStats=(0,_asyncToGenerator2.default)(_regenerator.default.mark((function _callee39(consumerId){var consumer;return _regenerator.default.wrap((function _callee39$(_context39){for(;;)switch(_context39.prev=_context39.next){case 0:if(consumer=this._consumers.get(consumerId)){_context39.next=3;break}return _context39.abrupt("return");case 3:return _context39.abrupt("return",consumer.getStats());case 4:case"end":return _context39.stop()}}),_callee39,this)})));function getConsumerLocalStats(_x16){return _getConsumerLocalStats.apply(this,arguments)}return getConsumerLocalStats}()},{key:"applyNetworkThrottle",value:function(){var _applyNetworkThrottle=(0,_asyncToGenerator2.default)(_regenerator.default.mark((function _callee40(_ref3){var uplink,downlink,rtt,secret;return _regenerator.default.wrap((function _callee40$(_context40){for(;;)switch(_context40.prev=_context40.next){case 0:return uplink=_ref3.uplink,downlink=_ref3.downlink,rtt=_ref3.rtt,secret=_ref3.secret,_context40.prev=1,_context40.next=4,this._protoo.request("applyNetworkThrottle",{uplink:uplink,downlink:downlink,rtt:rtt,secret:secret});case 4:_context40.next=10;break;case 6:_context40.prev=6,_context40.t0=_context40.catch(1),logger.error("applyNetworkThrottle() | failed:%o",_context40.t0),store.dispatch(requestActions.notify({type:"error",text:"Error applying network throttle: ".concat(_context40.t0)}));case 10:case"end":return _context40.stop()}}),_callee40,this,[[1,6]])})));function applyNetworkThrottle(_x17){return _applyNetworkThrottle.apply(this,arguments)}return applyNetworkThrottle}()},{key:"resetNetworkThrottle",value:function(){var _resetNetworkThrottle=(0,_asyncToGenerator2.default)(_regenerator.default.mark((function _callee41(_ref4){var _ref4$silent,silent,secret;return _regenerator.default.wrap((function _callee41$(_context41){for(;;)switch(_context41.prev=_context41.next){case 0:return _ref4$silent=_ref4.silent,silent=void 0!==_ref4$silent&&_ref4$silent,secret=_ref4.secret,logger.debug("resetNetworkThrottle()"),_context41.prev=2,_context41.next=5,this._protoo.request("resetNetworkThrottle",{secret:secret});case 5:_context41.next=10;break;case 7:_context41.prev=7,_context41.t0=_context41.catch(2),silent||(logger.error("resetNetworkThrottle() | failed:%o",_context41.t0),store.dispatch(requestActions.notify({type:"error",text:"Error resetting network throttle: ".concat(_context41.t0)})));case 10:case"end":return _context41.stop()}}),_callee41,this,[[2,7]])})));function resetNetworkThrottle(_x18){return _resetNetworkThrottle.apply(this,arguments)}return resetNetworkThrottle}()},{key:"_joinRoom",value:function(){var _joinRoom2=(0,_asyncToGenerator2.default)(_regenerator.default.mark((function _callee44(){var _this7=this,routerRtpCapabilities,transportInfo,id,iceParameters,iceCandidates,dtlsParameters,sctpParameters,_transportInfo,_id4,_iceParameters2,_iceCandidates,_dtlsParameters,_sctpParameters,_yield$this$_protoo$r,peers,_iterator3,_step3,peer,devicesCookie,_store$getState2,me;return _regenerator.default.wrap((function _callee44$(_context44){for(;;)switch(_context44.prev=_context44.next){case 0:return logger.debug("_joinRoom()"),_context44.prev=1,this._mediasoupDevice=new mediasoupClient.Device({handlerName:this._handlerName}),_context44.next=5,this._protoo.request("getRouterRtpCapabilities");case 5:return routerRtpCapabilities=_context44.sent,_context44.next=8,this._mediasoupDevice.load({routerRtpCapabilities:routerRtpCapabilities});case 8:if(!this._produce){_context44.next=17;break}return _context44.next=11,this._protoo.request("createWebRtcTransport",{forceTcp:this._forceTcp,producing:!0,consuming:!1,sctpCapabilities:this._useDataChannel?this._mediasoupDevice.sctpCapabilities:void 0});case 11:transportInfo=_context44.sent,id=transportInfo.id,iceParameters=transportInfo.iceParameters,iceCandidates=transportInfo.iceCandidates,dtlsParameters=transportInfo.dtlsParameters,sctpParameters=transportInfo.sctpParameters,this._sendTransport=this._mediasoupDevice.createSendTransport({id:id,iceParameters:iceParameters,iceCandidates:iceCandidates,dtlsParameters:dtlsParameters,sctpParameters:sctpParameters,iceServers:[],proprietaryConstraints:PC_PROPRIETARY_CONSTRAINTS,additionalSettings:{encodedInsertableStreams:this._e2eKey&&e2e.isSupported()}}),this._sendTransport.on("connect",(function(_ref5,callback,errback){var dtlsParameters=_ref5.dtlsParameters;_this7._protoo.request("connectWebRtcTransport",{transportId:_this7._sendTransport.id,dtlsParameters:dtlsParameters}).then(callback).catch(errback)})),this._sendTransport.on("produce",function(){var _ref7=(0,_asyncToGenerator2.default)(_regenerator.default.mark((function _callee42(_ref6,callback,errback){var kind,rtpParameters,appData,_yield$_this7$_protoo,_id2;return _regenerator.default.wrap((function _callee42$(_context42){for(;;)switch(_context42.prev=_context42.next){case 0:return kind=_ref6.kind,rtpParameters=_ref6.rtpParameters,appData=_ref6.appData,_context42.prev=1,_context42.next=4,_this7._protoo.request("produce",{transportId:_this7._sendTransport.id,kind:kind,rtpParameters:rtpParameters,appData:appData});case 4:_yield$_this7$_protoo=_context42.sent,_id2=_yield$_this7$_protoo.id,callback({id:_id2}),_context42.next=12;break;case 9:_context42.prev=9,_context42.t0=_context42.catch(1),errback(_context42.t0);case 12:case"end":return _context42.stop()}}),_callee42,null,[[1,9]])})));return function(_x19,_x20,_x21){return _ref7.apply(this,arguments)}}()),this._sendTransport.on("producedata",function(){var _ref9=(0,_asyncToGenerator2.default)(_regenerator.default.mark((function _callee43(_ref8,callback,errback){var sctpStreamParameters,label,protocol,appData,_yield$_this7$_protoo2,_id3;return _regenerator.default.wrap((function _callee43$(_context43){for(;;)switch(_context43.prev=_context43.next){case 0:return sctpStreamParameters=_ref8.sctpStreamParameters,label=_ref8.label,protocol=_ref8.protocol,appData=_ref8.appData,_context43.prev=1,_context43.next=4,_this7._protoo.request("produceData",{transportId:_this7._sendTransport.id,sctpStreamParameters:sctpStreamParameters,label:label,protocol:protocol,appData:appData});case 4:_yield$_this7$_protoo2=_context43.sent,_id3=_yield$_this7$_protoo2.id,callback({id:_id3}),_context43.next=12;break;case 9:_context43.prev=9,_context43.t0=_context43.catch(1),errback(_context43.t0);case 12:case"end":return _context43.stop()}}),_callee43,null,[[1,9]])})));return function(_x22,_x23,_x24){return _ref9.apply(this,arguments)}}());case 17:if(!this._consume){_context44.next=24;break}return _context44.next=20,this._protoo.request("createWebRtcTransport",{forceTcp:this._forceTcp,producing:!1,consuming:!0,sctpCapabilities:this._useDataChannel?this._mediasoupDevice.sctpCapabilities:void 0});case 20:_transportInfo=_context44.sent,_id4=_transportInfo.id,_iceParameters2=_transportInfo.iceParameters,_iceCandidates=_transportInfo.iceCandidates,_dtlsParameters=_transportInfo.dtlsParameters,_sctpParameters=_transportInfo.sctpParameters,this._recvTransport=this._mediasoupDevice.createRecvTransport({id:_id4,iceParameters:_iceParameters2,iceCandidates:_iceCandidates,dtlsParameters:_dtlsParameters,sctpParameters:_sctpParameters,iceServers:[],additionalSettings:{encodedInsertableStreams:this._e2eKey&&e2e.isSupported()}}),this._recvTransport.on("connect",(function(_ref10,callback,errback){var dtlsParameters=_ref10.dtlsParameters;_this7._protoo.request("connectWebRtcTransport",{transportId:_this7._recvTransport.id,dtlsParameters:dtlsParameters}).then(callback).catch(errback)}));case 24:return _context44.next=26,this._protoo.request("join",{displayName:this._displayName,device:this._device,rtpCapabilities:this._consume?this._mediasoupDevice.rtpCapabilities:void 0,sctpCapabilities:this._useDataChannel&&this._consume?this._mediasoupDevice.sctpCapabilities:void 0});case 26:_yield$this$_protoo$r=_context44.sent,peers=_yield$this$_protoo$r.peers,store.dispatch(stateActions.setRoomState("connected")),webRtcControler.firstPermisson(),store.dispatch(stateActions.removeAllNotifications()),store.dispatch(requestActions.notify({text:"You are in the room!",timeout:3e3})),_iterator3=_createForOfIteratorHelper(peers);try{for(_iterator3.s();!(_step3=_iterator3.n()).done;)peer=_step3.value,store.dispatch(stateActions.addPeer(_objectSpread(_objectSpread({},peer),{},{consumers:[],dataConsumers:[]})))}catch(err){_iterator3.e(err)}finally{_iterator3.f()}this._produce&&(store.dispatch(stateActions.setMediaCapabilities({canSendMic:!0,canSendWebcam:this._mediasoupDevice.canProduce("video")})),window.ccc=this,devicesCookie=cookiesManager.getDevices(),this._sendTransport.on("connectionstatechange",(function(connectionState){}))),window.SHOW_INFO&&(_store$getState2=store.getState(),me=_store$getState2.me,store.dispatch(stateActions.setRoomStatsPeerId(me.id))),_context44.next=43;break;case 38:_context44.prev=38,_context44.t0=_context44.catch(1),logger.error("_joinRoom() failed:%o",_context44.t0),store.dispatch(requestActions.notify({type:"error",text:"Could not join the room: ".concat(_context44.t0)})),this.close();case 43:case"end":return _context44.stop()}}),_callee44,this,[[1,38]])})));function _joinRoom(){return _joinRoom2.apply(this,arguments)}return _joinRoom}()},{key:"_updateWebcams",value:function(){var _updateWebcams2=(0,_asyncToGenerator2.default)(_regenerator.default.mark((function _callee45(){var devices,_iterator4,_step4,device,array,len,currentWebcamId;return _regenerator.default.wrap((function _callee45$(_context45){for(;;)switch(_context45.prev=_context45.next){case 0:return logger.debug("_updateWebcams()"),this._webcams=new Map,logger.debug("_updateWebcams() | calling enumerateDevices()"),_context45.next=5,navigator.mediaDevices.enumerateDevices();case 5:devices=_context45.sent,_iterator4=_createForOfIteratorHelper(devices),_context45.prev=7,_iterator4.s();case 9:if((_step4=_iterator4.n()).done){_context45.next=16;break}if("videoinput"===(device=_step4.value).kind){_context45.next=13;break}return _context45.abrupt("continue",14);case 13:this._webcams.set(device.deviceId,device);case 14:_context45.next=9;break;case 16:_context45.next=21;break;case 18:_context45.prev=18,_context45.t0=_context45.catch(7),_iterator4.e(_context45.t0);case 21:return _context45.prev=21,_iterator4.f(),_context45.finish(21);case 24:array=Array.from(this._webcams.values()),len=array.length,currentWebcamId=this._webcam.device?this._webcam.device.deviceId:void 0,logger.debug("_updateWebcams() [webcams:%o]",array),0===len?this._webcam.device=null:this._webcams.has(currentWebcamId)||(this._webcam.device=array[0]),store.dispatch(stateActions.setCanChangeWebcam(this._webcams.size>1));case 30:case"end":return _context45.stop()}}),_callee45,this,[[7,18,21,24]])})));function _updateWebcams(){return _updateWebcams2.apply(this,arguments)}return _updateWebcams}()},{key:"_getWebcamType",value:function _getWebcamType(device){return/(back|rear)/i.test(device.label)?(logger.debug("_getWebcamType() | it seems to be a back camera"),"back"):(logger.debug("_getWebcamType() | it seems to be a front camera"),"front")}},{key:"_pauseConsumer",value:function(){var _pauseConsumer2=(0,_asyncToGenerator2.default)(_regenerator.default.mark((function _callee46(consumer){return _regenerator.default.wrap((function _callee46$(_context46){for(;;)switch(_context46.prev=_context46.next){case 0:if(!consumer.paused){_context46.next=2;break}return _context46.abrupt("return");case 2:return _context46.prev=2,_context46.next=5,this._protoo.request("pauseConsumer",{consumerId:consumer.id});case 5:consumer.pause(),store.dispatch(stateActions.setConsumerPaused(consumer.id,"local")),_context46.next=13;break;case 9:_context46.prev=9,_context46.t0=_context46.catch(2),logger.error("_pauseConsumer() | failed:%o",_context46.t0),store.dispatch(requestActions.notify({type:"error",text:"Error pausing Consumer: ".concat(_context46.t0)}));case 13:case"end":return _context46.stop()}}),_callee46,this,[[2,9]])})));function _pauseConsumer(_x25){return _pauseConsumer2.apply(this,arguments)}return _pauseConsumer}()},{key:"_resumeConsumer",value:function(){var _resumeConsumer2=(0,_asyncToGenerator2.default)(_regenerator.default.mark((function _callee47(consumer){return _regenerator.default.wrap((function _callee47$(_context47){for(;;)switch(_context47.prev=_context47.next){case 0:if(consumer.paused){_context47.next=2;break}return _context47.abrupt("return");case 2:return _context47.prev=2,_context47.next=5,this._protoo.request("resumeConsumer",{consumerId:consumer.id});case 5:consumer.resume(),store.dispatch(stateActions.setConsumerResumed(consumer.id,"local")),_context47.next=13;break;case 9:_context47.prev=9,_context47.t0=_context47.catch(2),logger.error("_resumeConsumer() | failed:%o",_context47.t0),store.dispatch(requestActions.notify({type:"error",text:"Error resuming Consumer: ".concat(_context47.t0)}));case 13:case"end":return _context47.stop()}}),_callee47,this,[[2,9]])})));function _resumeConsumer(_x26){return _resumeConsumer2.apply(this,arguments)}return _resumeConsumer}()},{key:"_getExternalVideoStream",value:function(){var _getExternalVideoStream2=(0,_asyncToGenerator2.default)(_regenerator.default.mark((function _callee48(){var _this8=this;return _regenerator.default.wrap((function _callee48$(_context48){for(;;)switch(_context48.prev=_context48.next){case 0:if(!this._externalVideoStream){_context48.next=2;break}return _context48.abrupt("return",this._externalVideoStream);case 2:if(!(this._externalVideo.readyState<3)){_context48.next=5;break}return _context48.next=5,new Promise((function(resolve){return _this8._externalVideo.addEventListener("canplay",resolve)}));case 5:if(!this._externalVideo.captureStream){_context48.next=9;break}this._externalVideoStream=this._externalVideo.captureStream(),_context48.next=14;break;case 9:if(!this._externalVideo.mozCaptureStream){_context48.next=13;break}this._externalVideoStream=this._externalVideo.mozCaptureStream(),_context48.next=14;break;case 13:throw new Error("video.captureStream() not supported");case 14:return _context48.abrupt("return",this._externalVideoStream);case 15:case"end":return _context48.stop()}}),_callee48,this)})));function _getExternalVideoStream(){return _getExternalVideoStream2.apply(this,arguments)}return _getExternalVideoStream}()},{key:"CHANGEMYPEER",value:function CHANGEMYPEER(){store.dispatch(stateActions.CHANGEMYPEER())}}],[{key:"init",value:function init(data){store=data.store}}]),RoomClient}();exports.default=RoomClient},{"./Logger":1,"./cookiesManager":17,"./e2e":19,"./redux/requestActions":31,"./redux/stateActions":32,"./urlFactory":33,"@babel/runtime/helpers/asyncToGenerator":38,"@babel/runtime/helpers/classCallCheck":39,"@babel/runtime/helpers/createClass":40,"@babel/runtime/helpers/defineProperty":41,"@babel/runtime/helpers/interopRequireDefault":45,"@babel/runtime/helpers/typeof":54,"@babel/runtime/regenerator":56,"mediasoup-client":413,"protoo-client":432}],3:[function(require,module,exports){"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.withRoomContext=withRoomContext,exports.default=void 0;var _extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends")),_react=_interopRequireDefault(require("react")),RoomContext=_react.default.createContext(),_default=RoomContext;function withRoomContext(Component){return function(props){return _react.default.createElement(RoomContext.Consumer,null,(function(roomClient){return _react.default.createElement(Component,(0,_extends2.default)({},props,{roomClient:roomClient}))}))}}exports.default=_default},{"@babel/runtime/helpers/extends":42,"@babel/runtime/helpers/interopRequireDefault":45,react:483}],4:[function(require,module,exports){"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),_inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits")),_possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn")),_getPrototypeOf2=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf")),_react=_interopRequireDefault(require("react")),_reactRedux=require("react-redux"),_propTypes=_interopRequireDefault(require("prop-types")),_RoomContext=require("../RoomContext");function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=(0,_getPrototypeOf2.default)(Derived),result;if(hasNativeReflectConstruct){var NewTarget=(0,_getPrototypeOf2.default)(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return(0,_possibleConstructorReturn2.default)(this,result)}}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var BotMessageRegex=new RegExp("^@bot (.*)"),ChatInput=function(_React$Component){(0,_inherits2.default)(ChatInput,_React$Component);var _super=_createSuper(ChatInput);function ChatInput(props){var _this;return(0,_classCallCheck2.default)(this,ChatInput),(_this=_super.call(this,props)).state={text:""},_this._textareaElem=null,_this}return(0,_createClass2.default)(ChatInput,[{key:"render",value:function render(){var _this2=this,_this$props=this.props,connected=_this$props.connected,chatDataProducer=_this$props.chatDataProducer,botDataProducer=_this$props.botDataProducer,text=this.state.text,disabled=!connected||!chatDataProducer&&!botDataProducer;return _react.default.createElement("div",{"data-component":"ChatInput"},_react.default.createElement("textarea",{ref:function ref(elem){_this2._textareaElem=elem},placeholder:disabled?"Chat unavailable":"Write here...",dir:"auto",autoComplete:"off",disabled:disabled,value:text,onChange:this.handleChange.bind(this),onKeyPress:this.handleKeyPress.bind(this)}))}},{key:"handleChange",value:function handleChange(event){var text=event.target.value;this.setState({text:text})}},{key:"handleKeyPress",value:function handleKeyPress(event){if("Enter"===event.key&&!event.shiftKey&&!event.ctrlKey){event.preventDefault();var text=this.state.text.trim();if(this.setState({text:""}),text){var roomClient=this.props.roomClient,match=BotMessageRegex.exec(text);match?(text=match[1].trim(),roomClient.sendBotMessage(text)):(text=text.trim(),roomClient.sendChatMessage(text))}}}}]),ChatInput}(_react.default.Component);ChatInput.propTypes={roomClient:_propTypes.default.any.isRequired,connected:_propTypes.default.bool.isRequired,chatDataProducer:_propTypes.default.any,botDataProducer:_propTypes.default.any};var mapStateToProps=function mapStateToProps(state){var dataProducersArray=Object.values(state.dataProducers),chatDataProducer=dataProducersArray.find((function(dataProducer){return"chat"===dataProducer.label})),botDataProducer=dataProducersArray.find((function(dataProducer){return"bot"===dataProducer.label}));return{connected:"connected"===state.room.state,chatDataProducer:chatDataProducer,botDataProducer:botDataProducer}},ChatInputContainer,_default=(0,_RoomContext.withRoomContext)((0,_reactRedux.connect)(mapStateToProps,void 0)(ChatInput));exports.default=_default},{"../RoomContext":3,"@babel/runtime/helpers/classCallCheck":39,"@babel/runtime/helpers/createClass":40,"@babel/runtime/helpers/getPrototypeOf":43,"@babel/runtime/helpers/inherits":44,"@babel/runtime/helpers/interopRequireDefault":45,"@babel/runtime/helpers/possibleConstructorReturn":51,"prop-types":426,react:483,"react-redux":459}],5:[function(require,module,exports){"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),_inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits")),_possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn")),_getPrototypeOf2=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf")),_react=_interopRequireDefault(require("react")),_propTypes=_interopRequireDefault(require("prop-types")),_riek=require("riek");function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=(0,_getPrototypeOf2.default)(Derived),result;if(hasNativeReflectConstruct){var NewTarget=(0,_getPrototypeOf2.default)(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return(0,_possibleConstructorReturn2.default)(this,result)}}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var EditableInput=function(_React$Component){(0,_inherits2.default)(EditableInput,_React$Component);var _super=_createSuper(EditableInput);function EditableInput(){return(0,_classCallCheck2.default)(this,EditableInput),_super.apply(this,arguments)}return(0,_createClass2.default)(EditableInput,[{key:"render",value:function render(){var _this$props=this.props,value=_this$props.value,propName=_this$props.propName,className=_this$props.className,classLoading=_this$props.classLoading,classInvalid=_this$props.classInvalid,editProps=_this$props.editProps,onChange=_this$props.onChange;return(_react.default.createElement(_riek.RIEInput,{value:value,propName:propName,className:className,classLoading:classLoading,classInvalid:classInvalid,shouldBlockWhileLoading:!0,editProps:editProps,change:function change(data){return onChange(data)}}))}},{key:"shouldComponentUpdate",value:function shouldComponentUpdate(nextProps){return nextProps.value!==this.props.value}}]),EditableInput}(_react.default.Component);exports.default=EditableInput,EditableInput.propTypes={value:_propTypes.default.string,propName:_propTypes.default.string.isRequired,className:_propTypes.default.string,classLoading:_propTypes.default.string,classInvalid:_propTypes.default.string,editProps:_propTypes.default.any,onChange:_propTypes.default.func.isRequired}},{"@babel/runtime/helpers/classCallCheck":39,"@babel/runtime/helpers/createClass":40,"@babel/runtime/helpers/getPrototypeOf":43,"@babel/runtime/helpers/inherits":44,"@babel/runtime/helpers/interopRequireDefault":45,"@babel/runtime/helpers/possibleConstructorReturn":51,"prop-types":426,react:483,riek:498}],6:[function(require,module,exports){"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_typeof=require("@babel/runtime/helpers/typeof");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),_inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits")),_possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn")),_getPrototypeOf2=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf")),_react=_interopRequireDefault(require("react")),_reactRedux=require("react-redux"),_propTypes=_interopRequireDefault(require("prop-types")),_reactTooltip=_interopRequireDefault(require("react-tooltip")),_classnames=_interopRequireDefault(require("classnames")),cookiesManager=_interopRequireWildcard(require("../cookiesManager")),appPropTypes=_interopRequireWildcard(require("./appPropTypes")),_RoomContext=require("../RoomContext"),stateActions=_interopRequireWildcard(require("../redux/stateActions")),_PeerView=_interopRequireDefault(require("./PeerView"));function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function _getRequireWildcardCache(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=(0,_getPrototypeOf2.default)(Derived),result;if(hasNativeReflectConstruct){var NewTarget=(0,_getPrototypeOf2.default)(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return(0,_possibleConstructorReturn2.default)(this,result)}}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var Me=function(_React$Component){(0,_inherits2.default)(Me,_React$Component);var _super=_createSuper(Me);function Me(props){var _this;return(0,_classCallCheck2.default)(this,Me),(_this=_super.call(this,props))._mounted=!1,_this._rootNode=null,_this}return(0,_createClass2.default)(Me,[{key:"render",value:function render(){var _this2=this,_this$props=this.props,roomClient=_this$props.roomClient,connected=_this$props.connected,me=_this$props.me,audioProducer=_this$props.audioProducer,videoProducer=_this$props.videoProducer,faceDetection=_this$props.faceDetection,onSetStatsPeerId=_this$props.onSetStatsPeerId,shareProducer=_this$props.shareProducer,room=_this$props.room,micState,webcamState,changeWebcamState,shareState;micState=me.canSendMic&&audioProducer?audioProducer.paused?"off":"on":"off",webcamState=me.canSendWebcam?videoProducer&&"share"!==videoProducer.type?"on":"off":"unsupported",changeWebcamState=Boolean(videoProducer)&&"share"!==videoProducer.type&&me.canChangeWebcam?"on":"unsupported",shareState=shareProducer?"on":"off";var videoVisible=Boolean(videoProducer)&&!videoProducer.paused,tip;return me.displayNameSet||(tip="Click on your name to change it"),_react.default.createElement("div",{"data-component":"Me",ref:function ref(node){return _this2._rootNode=node},"data-tip":tip,"data-tip-disable":!tip},connected?_react.default.createElement("div",{className:"controls"},_react.default.createElement("div",{id:"soapMic",className:(0,_classnames.default)("button","mic",micState),onClick:function onClick(){"on"===micState?roomClient.disableMic():roomClient.enableMic()}}),_react.default.createElement("div",{id:"soapWebcam",className:(0,_classnames.default)("button","webcam",webcamState,{disabled:me.webcamInProgress||me.shareInProgress}),onClick:function onClick(){"on"===webcamState?(cookiesManager.setDevices({webcamEnabled:!1}),roomClient.disableWebcam()):(cookiesManager.setDevices({webcamEnabled:!0}),roomClient.enableWebcam())}}),_react.default.createElement("div",{id:"soapChangWebcam",className:(0,_classnames.default)("button","change-webcam",changeWebcamState,{disabled:me.webcamInProgress||me.shareInProgress}),onClick:function onClick(){return roomClient.changeWebcam()}}),_react.default.createElement("div",{id:"soapShare",className:(0,_classnames.default)("button","share",shareState,{disabled:me.shareInProgress||me.webcamInProgress}),onClick:function onClick(){"on"===shareState?roomClient.disableShare():roomClient.enableShare()}})):null,_react.default.createElement(_reactTooltip.default,{type:"light",effect:"solid",delayShow:100,delayHide:100,delayUpdate:50}))}},{key:"componentDidMount",value:function componentDidMount(){var _this3=this;this._mounted=!0,setTimeout((function(){_this3._mounted&&!_this3.props.me.displayNameSet&&_reactTooltip.default.show(_this3._rootNode)}),4e3)}},{key:"componentWillUnmount",value:function componentWillUnmount(){this._mounted=!1}},{key:"componentDidUpdate",value:function componentDidUpdate(prevProps){!prevProps.me.displayNameSet&&this.props.me.displayNameSet&&_reactTooltip.default.hide(this._rootNode)}}]),Me}(_react.default.Component);Me.propTypes={roomClient:_propTypes.default.any.isRequired,connected:_propTypes.default.bool.isRequired,me:appPropTypes.Me.isRequired,audioProducer:appPropTypes.Producer,videoProducer:appPropTypes.Producer,faceDetection:_propTypes.default.bool.isRequired,onSetStatsPeerId:_propTypes.default.func.isRequired,shareProducer:appPropTypes.Producer,room:appPropTypes.Room.isRequired};var mapStateToProps=function mapStateToProps(state){var producersArray=Object.values(state.producers),audioProducer=producersArray.find((function(producer){return"audio"===producer.track.kind})),videoProducer=producersArray.find((function(producer){return"video"===producer.track.kind&&"share"!=producer.type})),shareProducer=producersArray.find((function(producer){return"share"===producer.type}));return{connected:"connected"===state.room.state,me:state.me,audioProducer:audioProducer,videoProducer:videoProducer,faceDetection:state.room.faceDetection,shareProducer:shareProducer,room:state.room}},mapDispatchToProps=function mapDispatchToProps(dispatch){return{onSetStatsPeerId:function onSetStatsPeerId(peerId){return dispatch(stateActions.setRoomStatsPeerId(peerId))}}},MeContainer,_default=(0,_RoomContext.withRoomContext)((0,_reactRedux.connect)(mapStateToProps,mapDispatchToProps)(Me));exports.default=_default},{"../RoomContext":3,"../cookiesManager":17,"../redux/stateActions":32,"./PeerView":11,"./appPropTypes":15,"@babel/runtime/helpers/classCallCheck":39,"@babel/runtime/helpers/createClass":40,"@babel/runtime/helpers/getPrototypeOf":43,"@babel/runtime/helpers/inherits":44,"@babel/runtime/helpers/interopRequireDefault":45,"@babel/runtime/helpers/possibleConstructorReturn":51,"@babel/runtime/helpers/typeof":54,classnames:258,"prop-types":426,react:483,"react-redux":459,"react-tooltip":470}],7:[function(require,module,exports){"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_typeof=require("@babel/runtime/helpers/typeof");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),_inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits")),_possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn")),_getPrototypeOf2=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf")),_react=_interopRequireDefault(require("react")),_reactRedux=require("react-redux"),_propTypes=_interopRequireDefault(require("prop-types")),_reactTooltip=_interopRequireDefault(require("react-tooltip")),_classnames=_interopRequireDefault(require("classnames")),cookiesManager=_interopRequireWildcard(require("../cookiesManager")),appPropTypes=_interopRequireWildcard(require("./appPropTypes")),_RoomContext=require("../RoomContext"),stateActions=_interopRequireWildcard(require("../redux/stateActions")),_PeerView=_interopRequireDefault(require("./PeerView"));function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function _getRequireWildcardCache(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=(0,_getPrototypeOf2.default)(Derived),result;if(hasNativeReflectConstruct){var NewTarget=(0,_getPrototypeOf2.default)(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return(0,_possibleConstructorReturn2.default)(this,result)}}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var Me2=function(_React$Component){(0,_inherits2.default)(Me2,_React$Component);var _super=_createSuper(Me2);function Me2(props){var _this;return(0,_classCallCheck2.default)(this,Me2),(_this=_super.call(this,props))._mounted=!1,_this._rootNode=null,_this}return(0,_createClass2.default)(Me2,[{key:"render",value:function render(){var _this2=this,_this$props=this.props,roomClient=_this$props.roomClient,connected=_this$props.connected,me=_this$props.me,audioProducer=_this$props.audioProducer,videoProducer=_this$props.videoProducer,faceDetection=_this$props.faceDetection,onSetStatsPeerId=_this$props.onSetStatsPeerId,h=_this$props.h,w=_this$props.w,type=_this$props.type,videoVisible=Boolean(videoProducer)&&!videoProducer.paused,tip;me.displayNameSet||(tip="Click on your name to change it");var myClass="peerBox_0";videoProducer?myClass="peerBox_2":audioProducer&&!audioProducer.paused&&(myClass="peerBox_1");var videoStyle={height:h+"px",width:w+"px"};return w>0&&"share"==type&&(videoStyle={maxHeight:h+"px",maxWidth:w+"px",float:"none"}),w>0&&"audio"==type&&(videoStyle={height:h+"px",width:w+"px",float:"right"}),_react.default.createElement("div",{className:"peer-container "+myClass},_react.default.createElement("div",{"data-component":"Peer",ref:function ref(node){return _this2._rootNode=node},"data-tip":tip,"data-tip-disable":!tip,className:""},_react.default.createElement(_PeerView.default,{isMe:!0,peer:me,audioProducerId:audioProducer?audioProducer.id:null,videoProducerId:videoProducer?videoProducer.id:null,audioRtpParameters:audioProducer?audioProducer.rtpParameters:null,videoRtpParameters:videoProducer?videoProducer.rtpParameters:null,audioTrack:audioProducer?audioProducer.track:null,videoTrack:videoProducer?videoProducer.track:null,videoVisible:videoVisible,audioCodec:audioProducer?audioProducer.codec:null,videoCodec:videoProducer?videoProducer.codec:null,audioScore:audioProducer?audioProducer.score:null,videoScore:videoProducer?videoProducer.score:null,faceDetection:faceDetection,onChangeDisplayName:function onChangeDisplayName(displayName){roomClient.changeDisplayName(displayName)},onChangeMaxSendingSpatialLayer:function onChangeMaxSendingSpatialLayer(spatialLayer){roomClient.setMaxSendingSpatialLayer(spatialLayer)},onStatsClick:onSetStatsPeerId,h:h,w:w,type:type}),_react.default.createElement(_reactTooltip.default,{type:"light",effect:"solid",delayShow:100,delayHide:100,delayUpdate:50})))}},{key:"componentDidMount",value:function componentDidMount(){var _this3=this;this._mounted=!0,setTimeout((function(){_this3._mounted&&!_this3.props.me.displayNameSet&&_reactTooltip.default.show(_this3._rootNode)}),4e3)}},{key:"componentWillUnmount",value:function componentWillUnmount(){this._mounted=!1}},{key:"componentDidUpdate",value:function componentDidUpdate(prevProps){!prevProps.me.displayNameSet&&this.props.me.displayNameSet&&_reactTooltip.default.hide(this._rootNode)}}]),Me2}(_react.default.Component);Me2.propTypes={roomClient:_propTypes.default.any.isRequired,connected:_propTypes.default.bool.isRequired,me:appPropTypes.Me.isRequired,audioProducer:appPropTypes.Producer,videoProducer:appPropTypes.Producer,faceDetection:_propTypes.default.bool.isRequired,onSetStatsPeerId:_propTypes.default.func.isRequired,h:_propTypes.default.number};var mapStateToProps=function mapStateToProps(state,_ref){var h=_ref.h,type=_ref.type,producersArray=Object.values(state.producers),audioProducer=producersArray.find((function(producer){return"audio"===producer.track.kind})),videoProducer=producersArray.find((function(producer){return"video"===producer.track.kind&&"share"!=producer.type}));return"share"==type&&(audioProducer=null,videoProducer=producersArray.find((function(producer){return"video"===producer.track.kind&&"share"==producer.type}))),{connected:"connected"===state.room.state,me:state.me,audioProducer:audioProducer,videoProducer:videoProducer,faceDetection:state.room.faceDetection,h:h,type:type}},mapDispatchToProps=function mapDispatchToProps(dispatch){return{onSetStatsPeerId:function onSetStatsPeerId(peerId){return dispatch(stateActions.setRoomStatsPeerId(peerId))}}},MeContainer,_default=(0,_RoomContext.withRoomContext)((0,_reactRedux.connect)(mapStateToProps,mapDispatchToProps)(Me2));exports.default=_default},{"../RoomContext":3,"../cookiesManager":17,"../redux/stateActions":32,"./PeerView":11,"./appPropTypes":15,"@babel/runtime/helpers/classCallCheck":39,"@babel/runtime/helpers/createClass":40,"@babel/runtime/helpers/getPrototypeOf":43,"@babel/runtime/helpers/inherits":44,"@babel/runtime/helpers/interopRequireDefault":45,"@babel/runtime/helpers/possibleConstructorReturn":51,"@babel/runtime/helpers/typeof":54,classnames:258,"prop-types":426,react:483,"react-redux":459,"react-tooltip":470}],8:[function(require,module,exports){"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator")),_classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),_inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits")),_possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn")),_getPrototypeOf2=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf")),_react=_interopRequireDefault(require("react")),_reactDraggable=_interopRequireDefault(require("react-draggable")),_propTypes=_interopRequireDefault(require("prop-types")),_RoomContext=require("../RoomContext");function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=(0,_getPrototypeOf2.default)(Derived),result;if(hasNativeReflectConstruct){var NewTarget=(0,_getPrototypeOf2.default)(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return(0,_possibleConstructorReturn2.default)(this,result)}}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var NetworkThrottle=function(_React$Component){(0,_inherits2.default)(NetworkThrottle,_React$Component);var _super=_createSuper(NetworkThrottle);function NetworkThrottle(props){var _this;return(0,_classCallCheck2.default)(this,NetworkThrottle),(_this=_super.call(this,props)).state={uplink:"",downlink:"",rtt:"",disabled:!1},_this}return(0,_createClass2.default)(NetworkThrottle,[{key:"render",value:function render(){var _this2=this,_this$state=this.state,uplink=_this$state.uplink,downlink=_this$state.downlink,rtt=_this$state.rtt,disabled=_this$state.disabled;return _react.default.createElement(_reactDraggable.default,{bounds:"parent",defaultPosition:{x:20,y:20},handle:"h1.draggable"},_react.default.createElement("form",{"data-component":"NetworkThrottle",onSubmit:function onSubmit(event){event.preventDefault(),_this2._apply()}},_react.default.createElement("h1",{className:"draggable"},"Network Throttle"),_react.default.createElement("div",{className:"inputs"},_react.default.createElement("div",{className:"row"},_react.default.createElement("p",{className:"key"},"UPLINK (kbps)"),_react.default.createElement("input",{className:"value",type:"text",placeholder:"NO LIMIT",disabled:disabled,pattern:"[0-9]*",value:uplink,autoCorrect:"false",spellCheck:"false",onChange:function onChange(event){return _this2.setState({uplink:event.target.value})}})),_react.default.createElement("div",{className:"row"},_react.default.createElement("p",{className:"key"},"DOWNLINK (kbps)"),_react.default.createElement("input",{className:"value",type:"text",placeholder:"NO LIMIT",disabled:disabled,pattern:"[0-9]*",value:downlink,autoCorrect:"false",spellCheck:"false",onChange:function onChange(event){return _this2.setState({downlink:event.target.value})}})),_react.default.createElement("div",{className:"row"},_react.default.createElement("p",{className:"key"},"RTT (ms)"),_react.default.createElement("input",{className:"value",type:"text",placeholder:"NOT SET",disabled:disabled,pattern:"[0-9]*",value:rtt,autoCorrect:"false",spellCheck:"false",onChange:function onChange(event){return _this2.setState({rtt:event.target.value})}}))),_react.default.createElement("div",{className:"buttons"},_react.default.createElement("button",{type:"button",className:"reset",disabled:disabled,onClick:function onClick(){return _this2._reset()}},"RESET"),_react.default.createElement("button",{type:"submit",className:"apply",disabled:disabled||!uplink.trim()&&!downlink.trim()&&!rtt.trim()},"APPLY"))))}},{key:"componentWillUnmount",value:function componentWillUnmount(){var roomClient;this.props.roomClient.resetNetworkThrottle({silent:!0})}},{key:"_apply",value:function(){var _apply2=(0,_asyncToGenerator2.default)(_regenerator.default.mark((function _callee(){var _this$props,roomClient,secret,_this$state2,uplink,downlink,rtt;return _regenerator.default.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return _this$props=this.props,roomClient=_this$props.roomClient,secret=_this$props.secret,_this$state2=this.state,uplink=_this$state2.uplink,downlink=_this$state2.downlink,rtt=_this$state2.rtt,uplink=Number(uplink)||0,downlink=Number(downlink)||0,rtt=Number(rtt)||0,this.setState({disabled:!0}),_context.next=8,roomClient.applyNetworkThrottle({uplink:uplink,downlink:downlink,rtt:rtt,secret:secret});case 8:window.onunload=function(){roomClient.resetNetworkThrottle({silent:!0,secret:secret})},this.setState({disabled:!1});case 10:case"end":return _context.stop()}}),_callee,this)})));function _apply(){return _apply2.apply(this,arguments)}return _apply}()},{key:"_reset",value:function(){var _reset2=(0,_asyncToGenerator2.default)(_regenerator.default.mark((function _callee2(){var _this$props2,roomClient,secret;return _regenerator.default.wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _this$props2=this.props,roomClient=_this$props2.roomClient,secret=_this$props2.secret,this.setState({uplink:"",downlink:"",rtt:"",disabled:!1}),this.setState({disabled:!0}),_context2.next=5,roomClient.resetNetworkThrottle({secret:secret});case 5:this.setState({disabled:!1});case 6:case"end":return _context2.stop()}}),_callee2,this)})));function _reset(){return _reset2.apply(this,arguments)}return _reset}()}]),NetworkThrottle}(_react.default.Component);NetworkThrottle.propTypes={roomClient:_propTypes.default.any.isRequired,secret:_propTypes.default.string.isRequired};var _default=(0,_RoomContext.withRoomContext)(NetworkThrottle);exports.default=_default},{"../RoomContext":3,"@babel/runtime/helpers/asyncToGenerator":38,"@babel/runtime/helpers/classCallCheck":39,"@babel/runtime/helpers/createClass":40,"@babel/runtime/helpers/getPrototypeOf":43,"@babel/runtime/helpers/inherits":44,"@babel/runtime/helpers/interopRequireDefault":45,"@babel/runtime/helpers/possibleConstructorReturn":51,"@babel/runtime/regenerator":56,"prop-types":426,react:483,"react-draggable":441}],9:[function(require,module,exports){"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_typeof=require("@babel/runtime/helpers/typeof");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _react=_interopRequireDefault(require("react")),_reactRedux=require("react-redux"),_classnames=_interopRequireDefault(require("classnames")),_propTypes=_interopRequireDefault(require("prop-types")),appPropTypes=_interopRequireWildcard(require("./appPropTypes")),stateActions=_interopRequireWildcard(require("../redux/stateActions")),_transitions=require("./transitions");function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function _getRequireWildcardCache(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}var Notifications=function Notifications(_ref){var notifications=_ref.notifications,_onClick=_ref.onClick;return(_react.default.createElement("div",{"data-component":"Notifications"},notifications.map((function(notification){return _react.default.createElement(_transitions.Appear,{key:notification.id,duration:250},_react.default.createElement("div",{className:(0,_classnames.default)("notification",notification.type),onClick:function onClick(){return _onClick(notification.id)}},_react.default.createElement("div",{className:"icon"}),_react.default.createElement("div",{className:"body"},notification.title?_react.default.createElement("p",{className:"title"},notification.title):null,_react.default.createElement("p",{className:"text"},notification.text))))}))))};Notifications.propTypes={notifications:_propTypes.default.arrayOf(appPropTypes.Notification).isRequired,onClick:_propTypes.default.func.isRequired};var mapStateToProps=function mapStateToProps(state){var notifications;return{notifications:state.notifications}},mapDispatchToProps=function mapDispatchToProps(dispatch){return{onClick:function onClick(notificationId){dispatch(stateActions.removeNotification(notificationId))}}},NotificationsContainer,_default=(0,_reactRedux.connect)(mapStateToProps,mapDispatchToProps)(Notifications);exports.default=_default},{"../redux/stateActions":32,"./appPropTypes":15,"./transitions":16,"@babel/runtime/helpers/interopRequireDefault":45,"@babel/runtime/helpers/typeof":54,classnames:258,"prop-types":426,react:483,"react-redux":459}],10:[function(require,module,exports){"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_typeof=require("@babel/runtime/helpers/typeof");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _react=_interopRequireDefault(require("react")),_reactRedux=require("react-redux"),_propTypes=_interopRequireDefault(require("prop-types")),_classnames=_interopRequireDefault(require("classnames")),appPropTypes=_interopRequireWildcard(require("./appPropTypes")),_RoomContext=require("../RoomContext"),stateActions=_interopRequireWildcard(require("../redux/stateActions")),_PeerView=_interopRequireDefault(require("./PeerView"));function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function _getRequireWildcardCache(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}var Peer=function Peer(props){var roomClient=props.roomClient,peer=props.peer,audioConsumer=props.audioConsumer,videoConsumer=props.videoConsumer,audioMuted=props.audioMuted,faceDetection=props.faceDetection,onSetStatsPeerId=props.onSetStatsPeerId,activeSpeakerId=props.activeSpeakerId,h=props.h,w=props.w,type=props.type;console.warn("my h : "+h);var audioEnabled=Boolean(audioConsumer)&&!audioConsumer.locallyPaused&&!audioConsumer.remotelyPaused,videoVisible=Boolean(videoConsumer)&&!videoConsumer.locallyPaused&&!videoConsumer.remotelyPaused,myClass="peerBox_0";videoConsumer?myClass="peerBox_2":audioConsumer&&!audioConsumer.remotelyPaused&&(myClass="peerBox_1");var videoStyle={height:h+"px",width:w+"px"};return w>0&&"share"==type&&(videoStyle={maxHeight:h+"px",maxWidth:w+"px",float:"none"}),w>0&&"audio"==type&&(videoStyle={height:h+"px",width:w+"px",float:"right"}),_react.default.createElement("div",{className:(0,_classnames.default)("peer-container",{"active-speaker":peer.id===activeSpeakerId},myClass)},_react.default.createElement("div",{"data-component":"Peer"},_react.default.createElement("div",{className:"indicators"},audioEnabled?null:_react.default.createElement("div",{className:"icon mic-off"}),videoConsumer?null:_react.default.createElement("div",{className:"icon webcam-off"})),_react.default.createElement(_PeerView.default,{peer:peer,audioConsumerId:audioConsumer?audioConsumer.id:null,videoConsumerId:videoConsumer?videoConsumer.id:null,audioRtpParameters:audioConsumer?audioConsumer.rtpParameters:null,videoRtpParameters:videoConsumer?videoConsumer.rtpParameters:null,consumerSpatialLayers:videoConsumer?videoConsumer.spatialLayers:null,consumerTemporalLayers:videoConsumer?videoConsumer.temporalLayers:null,consumerCurrentSpatialLayer:videoConsumer?videoConsumer.currentSpatialLayer:null,consumerCurrentTemporalLayer:videoConsumer?videoConsumer.currentTemporalLayer:null,consumerPreferredSpatialLayer:videoConsumer?videoConsumer.preferredSpatialLayer:null,consumerPreferredTemporalLayer:videoConsumer?videoConsumer.preferredTemporalLayer:null,consumerPriority:videoConsumer?videoConsumer.priority:null,audioTrack:audioConsumer?audioConsumer.track:null,videoTrack:videoConsumer?videoConsumer.track:null,audioMuted:audioMuted,videoVisible:videoVisible,videoMultiLayer:videoConsumer&&"simple"!==videoConsumer.type,audioCodec:audioConsumer?audioConsumer.codec:null,videoCodec:videoConsumer?videoConsumer.codec:null,audioScore:audioConsumer?audioConsumer.score:null,videoScore:videoConsumer?videoConsumer.score:null,faceDetection:faceDetection,onChangeVideoPreferredLayers:function onChangeVideoPreferredLayers(spatialLayer,temporalLayer){roomClient.setConsumerPreferredLayers(videoConsumer.id,spatialLayer,temporalLayer)},onChangeVideoPriority:function onChangeVideoPriority(priority){roomClient.setConsumerPriority(videoConsumer.id,priority)},onRequestKeyFrame:function onRequestKeyFrame(){roomClient.requestConsumerKeyFrame(videoConsumer.id)},onStatsClick:onSetStatsPeerId,h:h,w:w,type:type})))};Peer.propTypes={roomClient:_propTypes.default.any.isRequired,peer:appPropTypes.Peer.isRequired,audioConsumer:appPropTypes.Consumer,videoConsumer:appPropTypes.Consumer,audioMuted:_propTypes.default.bool,faceDetection:_propTypes.default.bool.isRequired,onSetStatsPeerId:_propTypes.default.func.isRequired,activeSpeakerId:_propTypes.default.string,h:_propTypes.default.number,w:_propTypes.default.number};var mapStateToProps=function mapStateToProps(state,_ref){var id=_ref.id,h=_ref.h,w=_ref.w,me=state.me,peer=state.peers[id],consumersArray=peer.consumers.map((function(consumerId){return state.consumers[consumerId]})),audioConsumer,videoConsumer;return{peer:peer,audioConsumer:consumersArray.find((function(consumer){return"audio"===consumer.track.kind})),videoConsumer:consumersArray.find((function(consumer){return"video"===consumer.track.kind})),audioMuted:me.audioMuted,faceDetection:state.room.faceDetection,activeSpeakerId:state.room.activeSpeakerId,h:h,w:w}},mapDispatchToProps=function mapDispatchToProps(dispatch){return{onSetStatsPeerId:function onSetStatsPeerId(peerId){return dispatch(stateActions.setRoomStatsPeerId(peerId))}}},PeerContainer,_default=(0,_RoomContext.withRoomContext)((0,_reactRedux.connect)(mapStateToProps,mapDispatchToProps)(Peer));exports.default=_default},{"../RoomContext":3,"../redux/stateActions":32,"./PeerView":11,"./appPropTypes":15,"@babel/runtime/helpers/interopRequireDefault":45,"@babel/runtime/helpers/typeof":54,classnames:258,"prop-types":426,react:483,"react-redux":459}],11:[function(require,module,exports){"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_typeof=require("@babel/runtime/helpers/typeof");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator")),_classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),_inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits")),_possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn")),_getPrototypeOf2=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf")),_react=_interopRequireDefault(require("react")),_propTypes=_interopRequireDefault(require("prop-types")),_reactTooltip=_interopRequireDefault(require("react-tooltip")),_classnames=_interopRequireDefault(require("classnames")),_reactSpinner=_interopRequireDefault(require("react-spinner")),_clipboardCopy=_interopRequireDefault(require("clipboard-copy")),_hark=_interopRequireDefault(require("hark")),faceapi=_interopRequireWildcard(require("face-api.js")),_Logger=_interopRequireDefault(require("../Logger")),appPropTypes=_interopRequireWildcard(require("./appPropTypes")),_EditableInput=_interopRequireDefault(require("./EditableInput"));function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function _getRequireWildcardCache(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=(0,_getPrototypeOf2.default)(Derived),result;if(hasNativeReflectConstruct){var NewTarget=(0,_getPrototypeOf2.default)(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return(0,_possibleConstructorReturn2.default)(this,result)}}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var logger=new _Logger.default("PeerView"),videomaxsize=100,tinyFaceDetectorOptions=new faceapi.TinyFaceDetectorOptions({inputSize:160,scoreThreshold:.5}),PeerView=function(_React$Component){(0,_inherits2.default)(PeerView,_React$Component);var _super=_createSuper(PeerView);function PeerView(props){var _this;return(0,_classCallCheck2.default)(this,PeerView),(_this=_super.call(this,props)).state={audioVolume:0,showInfo:!1,videoResolutionWidth:null,videoResolutionHeight:null,videoCanPlay:!1,videoElemPaused:!1,maxSpatialLayer:null},_this._audioTrack=null,_this._videoTrack=null,_this._hark=null,_this._videoResolutionPeriodicTimer=null,_this._faceDetectionRequestAnimationFrame=null,_this}return(0,_createClass2.default)(PeerView,[{key:"render",value:function render(){var _this$props=this.props,isMe=_this$props.isMe,peer=_this$props.peer,audioProducerId=_this$props.audioProducerId,videoProducerId=_this$props.videoProducerId,audioConsumerId=_this$props.audioConsumerId,videoConsumerId=_this$props.videoConsumerId,videoRtpParameters=_this$props.videoRtpParameters,consumerSpatialLayers=_this$props.consumerSpatialLayers,consumerTemporalLayers=_this$props.consumerTemporalLayers,consumerCurrentSpatialLayer=_this$props.consumerCurrentSpatialLayer,consumerCurrentTemporalLayer=_this$props.consumerCurrentTemporalLayer,consumerPreferredSpatialLayer=_this$props.consumerPreferredSpatialLayer,consumerPreferredTemporalLayer=_this$props.consumerPreferredTemporalLayer,consumerPriority=_this$props.consumerPriority,audioMuted=_this$props.audioMuted,videoVisible=_this$props.videoVisible,videoMultiLayer=_this$props.videoMultiLayer,audioCodec=_this$props.audioCodec,videoCodec=_this$props.videoCodec,audioScore=_this$props.audioScore,videoScore=_this$props.videoScore,onChangeDisplayName=_this$props.onChangeDisplayName,onChangeMaxSendingSpatialLayer=_this$props.onChangeMaxSendingSpatialLayer,onChangeVideoPreferredLayers=_this$props.onChangeVideoPreferredLayers,onChangeVideoPriority=_this$props.onChangeVideoPriority,onRequestKeyFrame=_this$props.onRequestKeyFrame,onStatsClick=_this$props.onStatsClick,css=_this$props.css,h=_this$props.h,w=_this$props.w,type=_this$props.type,_this$state=this.state,audioVolume=_this$state.audioVolume,showInfo=_this$state.showInfo,videoResolutionWidth=_this$state.videoResolutionWidth,videoResolutionHeight=_this$state.videoResolutionHeight,videoCanPlay=_this$state.videoCanPlay,videoElemPaused=_this$state.videoElemPaused,maxSpatialLayer=_this$state.maxSpatialLayer;css="pppppppppppppppppp";var videoStyle={height:h+"px",width:w+"px"};return w>0&&"share"==type&&(videoStyle={maxHeight:h+"px",maxWidth:w+"px",float:"none"}),w>0&&"audio"==type&&(videoStyle={height:h+"px",width:w+"px",float:"right"}),(videoConsumerId||videoProducerId)&&(css="wwwwwwwwwww"),_react.default.createElement("div",{className:css,"data-component":"PeerView"},_react.default.createElement("div",{className:"info"},_react.default.createElement("div",{className:(0,_classnames.default)("peer",{"is-me":isMe})},isMe?_react.default.createElement(_EditableInput.default,{value:peer.displayName,propName:"displayName",className:"display-name editable",classLoading:"loading",classInvalid:"invalid",shouldBlockWhileLoading:!0,editProps:{maxLength:20,autoCorrect:"false",spellCheck:"false"},onChange:function onChange(_ref){var displayName=_ref.displayName;return onChangeDisplayName(displayName)}}):_react.default.createElement("span",{className:"display-name"},peer.displayName))),_react.default.createElement("video",{ref:"videoElem",className:(0,_classnames.default)({"is-me":isMe,hidden:!videoVisible||!videoCanPlay,"network-error":videoVisible&&videoMultiLayer&&null===consumerCurrentSpatialLayer}),autoPlay:!0,playsInline:!0,muted:!0,controls:!1}),_react.default.createElement("audio",{ref:"audioElem",autoPlay:!0,playsInline:!0,muted:isMe||audioMuted,controls:!1}),_react.default.createElement("div",{className:"volume-container"},_react.default.createElement("div",{className:(0,_classnames.default)("bar","level".concat(audioVolume))})),videoVisible&&videoScore<5?_react.default.createElement("div",{className:"spinner-container"},_react.default.createElement(_reactSpinner.default,null)):null,videoElemPaused?_react.default.createElement("div",{className:"video-elem-paused"}):null)}},{key:"componentDidMount",value:function componentDidMount(){var _this$props2=this.props,audioTrack=_this$props2.audioTrack,videoTrack=_this$props2.videoTrack;this._setTracks(audioTrack,videoTrack)}},{key:"componentWillUnmount",value:function componentWillUnmount(){this._hark&&this._hark.stop(),clearInterval(this._videoResolutionPeriodicTimer),cancelAnimationFrame(this._faceDetectionRequestAnimationFrame);var videoElem=this.refs.videoElem;videoElem&&(videoElem.oncanplay=null,videoElem.onplay=null,videoElem.onpause=null)}},{key:"componentWillUpdate",value:function componentWillUpdate(){var _this$props3=this.props,isMe=_this$props3.isMe,audioTrack=_this$props3.audioTrack,videoTrack=_this$props3.videoTrack,videoRtpParameters=_this$props3.videoRtpParameters,maxSpatialLayer=this.state.maxSpatialLayer;isMe&&videoRtpParameters&&null===maxSpatialLayer?this.setState({maxSpatialLayer:videoRtpParameters.encodings.length-1}):isMe&&!videoRtpParameters&&null!==maxSpatialLayer&&this.setState({maxSpatialLayer:null}),this._setTracks(audioTrack,videoTrack)}},{key:"_setTracks",value:function _setTracks(audioTrack,videoTrack){var _this2=this,faceDetection=this.props.faceDetection;if(this._audioTrack!==audioTrack||this._videoTrack!==videoTrack){this._audioTrack=audioTrack,this._videoTrack=videoTrack,this._hark&&this._hark.stop(),this._stopVideoResolution(),faceDetection&&this._stopFaceDetection();var _this$refs=this.refs,audioElem=_this$refs.audioElem,videoElem=_this$refs.videoElem;if(audioTrack){var stream=new MediaStream;stream.addTrack(audioTrack),audioElem.srcObject=stream,audioElem.play().catch((function(error){return logger.warn("audioElem.play() failed:%o",error)})),this._runHark(stream)}else audioElem.srcObject=null;if(videoTrack){var _stream=new MediaStream;_stream.addTrack(videoTrack),videoElem.srcObject=_stream,videoElem.oncanplay=function(){return _this2.setState({videoCanPlay:!0})},videoElem.onplay=function(){_this2.setState({videoElemPaused:!1}),audioElem.play().catch((function(error){return logger.warn("audioElem.play() failed:%o",error)}))},videoElem.onpause=function(){return _this2.setState({videoElemPaused:!0})},videoElem.play().catch((function(error){return logger.warn("videoElem.play() failed:%o",error)})),this._startVideoResolution(),faceDetection&&this._startFaceDetection()}else videoElem.srcObject=null}}},{key:"_runHark",value:function _runHark(stream){var _this3=this;if(!stream.getAudioTracks()[0])throw new Error("_runHark() | given stream has no audio track");this._hark=(0,_hark.default)(stream,{play:!1,interval:500}),this._hark.on("volume_change",(function(dBs,threshold){var audioVolume=Math.round(10*Math.pow(10,dBs/85));1===audioVolume&&(audioVolume=0),audioVolume!==_this3.state.audioVolume&&_this3.setState({audioVolume:audioVolume})}))}},{key:"_startVideoResolution",value:function _startVideoResolution(){var _this4=this;this._videoResolutionPeriodicTimer=setInterval((function(){var _this4$state=_this4.state,videoResolutionWidth=_this4$state.videoResolutionWidth,videoResolutionHeight=_this4$state.videoResolutionHeight,videoElem=_this4.refs.videoElem;videoElem.videoWidth===videoResolutionWidth&&videoElem.videoHeight===videoResolutionHeight||_this4.setState({videoResolutionWidth:videoElem.videoWidth,videoResolutionHeight:videoElem.videoHeight})}),500)}},{key:"_stopVideoResolution",value:function _stopVideoResolution(){clearInterval(this._videoResolutionPeriodicTimer),this.setState({videoResolutionWidth:null,videoResolutionHeight:null})}},{key:"_startFaceDetection",value:function _startFaceDetection(){var _this5=this,_this$refs2=this.refs,videoElem=_this$refs2.videoElem,canvas=_this$refs2.canvas,step=function(){var _ref2=(0,_asyncToGenerator2.default)(_regenerator.default.mark((function _callee(){var detection,width,height,resizedDetections;return _regenerator.default.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:if(_this5._videoTrack&&!(videoElem.readyState<2)){_context.next=3;break}return _this5._faceDetectionRequestAnimationFrame=requestAnimationFrame(step),_context.abrupt("return");case 3:return _context.next=5,faceapi.detectSingleFace(videoElem,tinyFaceDetectorOptions);case 5:(detection=_context.sent)?(width=videoElem.offsetWidth,height=videoElem.offsetHeight,canvas.width=width,canvas.height=height,resizedDetections=faceapi.resizeResults(detection,{width:width,height:height}),faceapi.draw.drawDetections(canvas,resizedDetections)):(canvas.width=0,canvas.height=0),_this5._faceDetectionRequestAnimationFrame=requestAnimationFrame((function(){return setTimeout(step,100)}));case 8:case"end":return _context.stop()}}),_callee)})));return function step(){return _ref2.apply(this,arguments)}}();step()}},{key:"_stopFaceDetection",value:function _stopFaceDetection(){cancelAnimationFrame(this._faceDetectionRequestAnimationFrame);var canvas=this.refs.canvas;canvas.width=0,canvas.height=0}},{key:"_printProducerScore",value:function _printProducerScore(id,score){var scores=Array.isArray(score)?score:[score];return(_react.default.createElement(_react.default.Fragment,{key:id},_react.default.createElement("p",null,"streams:"),scores.sort((function(a,b){return a.rid?a.rid>b.rid?1:-1:a.ssrc>b.ssrc?1:-1})).map((function(_ref3,idx){var ssrc=_ref3.ssrc,rid=_ref3.rid,score=_ref3.score;return(_react.default.createElement("p",{key:idx,className:"indent"},void 0!==rid?"rid:".concat(rid,", ssrc:").concat(ssrc,", score:").concat(score):"ssrc:".concat(ssrc,", score:").concat(score)))}))))}},{key:"_printConsumerScore",value:function _printConsumerScore(id,score){return _react.default.createElement("p",{key:id},"score:".concat(score.score,", producerScore:").concat(score.producerScore,", producerScores:[").concat(score.producerScores,"]"))}}]),PeerView}(_react.default.Component);exports.default=PeerView,PeerView.propTypes={isMe:_propTypes.default.bool,peer:_propTypes.default.oneOfType([appPropTypes.Me,appPropTypes.Peer]).isRequired,audioProducerId:_propTypes.default.string,videoProducerId:_propTypes.default.string,audioConsumerId:_propTypes.default.string,videoConsumerId:_propTypes.default.string,audioRtpParameters:_propTypes.default.object,videoRtpParameters:_propTypes.default.object,consumerSpatialLayers:_propTypes.default.number,consumerTemporalLayers:_propTypes.default.number,consumerCurrentSpatialLayer:_propTypes.default.number,consumerCurrentTemporalLayer:_propTypes.default.number,consumerPreferredSpatialLayer:_propTypes.default.number,consumerPreferredTemporalLayer:_propTypes.default.number,consumerPriority:_propTypes.default.number,audioTrack:_propTypes.default.any,videoTrack:_propTypes.default.any,audioMuted:_propTypes.default.bool,videoVisible:_propTypes.default.bool.isRequired,videoMultiLayer:_propTypes.default.bool,audioCodec:_propTypes.default.string,videoCodec:_propTypes.default.string,audioScore:_propTypes.default.any,videoScore:_propTypes.default.any,faceDetection:_propTypes.default.bool.isRequired,onChangeDisplayName:_propTypes.default.func,onChangeMaxSendingSpatialLayer:_propTypes.default.func,onChangeVideoPreferredLayers:_propTypes.default.func,onChangeVideoPriority:_propTypes.default.func,onRequestKeyFrame:_propTypes.default.func,onStatsClick:_propTypes.default.func.isRequired}},{"../Logger":1,"./EditableInput":5,"./appPropTypes":15,"@babel/runtime/helpers/asyncToGenerator":38,"@babel/runtime/helpers/classCallCheck":39,"@babel/runtime/helpers/createClass":40,"@babel/runtime/helpers/getPrototypeOf":43,"@babel/runtime/helpers/inherits":44,"@babel/runtime/helpers/interopRequireDefault":45,"@babel/runtime/helpers/possibleConstructorReturn":51,"@babel/runtime/helpers/typeof":54,"@babel/runtime/regenerator":56,classnames:258,"clipboard-copy":259,"face-api.js":337,hark:382,"prop-types":426,react:483,"react-spinner":469,"react-tooltip":470}],12:[function(require,module,exports){"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_typeof=require("@babel/runtime/helpers/typeof");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _react=_interopRequireDefault(require("react")),_reactRedux=require("react-redux"),_propTypes=_interopRequireDefault(require("prop-types")),_classnames=_interopRequireDefault(require("classnames")),appPropTypes=_interopRequireWildcard(require("./appPropTypes")),_transitions=require("./transitions"),_Peer=_interopRequireDefault(require("./Peer")),_Me=_interopRequireDefault(require("./Me2")),sst;function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function _getRequireWildcardCache(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}var Peers=function Peers(_ref){var peers=_ref.peers,activeSpeakerId=_ref.activeSpeakerId,m0=[],m1=[],m2=[],m3=null,producersArray=Object.values(sst.producers),audioProducer=producersArray.find((function(producer){return"audio"===producer.track.kind})),videoProducer=producersArray.find((function(producer){return"video"===producer.track.kind&&"share"!=producer.type})),shareProducer=producersArray.find((function(producer){return"share"===producer.type})),audioProducerOnly=!1;audioProducer&&!videoProducer&&(audioProducerOnly=!0),shareProducer&&(m3=shareProducer),peers.map((function(peer){var consumersArray=peer.consumers.map((function(consumerId){return sst.consumers[consumerId]})),audioConsumer=consumersArray.find((function(consumer){return"audio"===consumer.track.kind})),videoConsumer;if(consumersArray.find((function(consumer){return"video"===consumer.track.kind})))if(peer.id.startsWith("screen")&&!m3)m3=peer;else for(var r=1;r<2;r++)m2.push(peer);else if(audioConsumer&&!audioConsumer.remotelyPaused)for(var r=1;r<2;r++)m1.push(peer);else m0.push(peer)})),console.warn("m3"),console.log(m3),console.warn("m2"),console.log(m2),console.warn("m1"),console.log(m1),console.warn("m0"),console.log(m0),console.warn("my video : "),console.log(videoProducer);var box=document.getElementById("videosBox"),width=box.clientWidth,height=box.clientHeight-40;console.log("clientWidth : "+width),console.log("clientHeight : "+height);var haveScreen=m3?1:0,haveVideo=videoProducer||m2.length>0?1:0,haveAudio=audioProducerOnly||m1.length>0?1:0;console.log("haveScreen : "+haveScreen),console.log("haveVideo : "+haveVideo),console.log("haveAudio : "+haveAudio);var have=haveScreen.toString()+haveVideo.toString()+haveAudio.toString();console.log("have : "+have);var max=height;width>height&&(max=width);var h1=0,h2=0,h3=0,section=max/18;switch(have){case"111":h3=12*section-1,h2=4*section-1,h1=2*section-1;break;case"110":h3=12*section-1,h2=6*section-1;break;case"101":h3=15*section-1,h1=3*section-1;break;case"100":h3=max;break;case"011":h2=14*section-1,h1=4*section-1;break;case"010":h2=max;break;case"001":h1=max}var mystyle1={height:h1+"px",width:width+"px",display:"inline-block"},mystyle2={height:h2+"px",width:width+"px",display:"grid"},mystyle3={height:h3+"px",width:width+"px",display:"inline-flex"};if(width>height&&(mystyle1={height:height+"px",width:h1+"px",float:"right"},mystyle2={height:height+"px",width:h2+"px",float:"right",display:"grid"},mystyle3={height:height+"px",width:h3+"px",float:"right",display:"inline-flex"}),0==h3&&(mystyle3.display="none"),0==h2&&(mystyle2.display="none"),0==h1&&(mystyle1.display="none"),console.log("h3 : "+h3),console.log("h2 : "+h2),console.log("h1 : "+h1),videoProducer){var r={id:"33"};m2.push(r)}var len2=m2.length;if(console.log("len2 : "+len2),audioProducerOnly){var r={id:"44"};m1.push(r)}var len1=m1.length;console.log("len1 : "+len2);var videoMaxSize=0,audioWidthMax=0,shareHeigth=h3,shareWidth=width,box2Heigth=h2,box1Heigth=h1;height>=width?(videoMaxSize=bestMatchCalculate(width,h2,len2,0),haveAudio&&h1>0&&(audioWidthMax=bestMatchCalculate(width,h1,len1,0))):(videoMaxSize=bestMatchCalculate(h2,height,len2,0),haveAudio&&h1>0&&(audioWidthMax=bestMatchCalculate(h1,height,len1,0)),shareHeigth=height,shareWidth=h3,box2Heigth=height,box1Heigth=height),console.log("videoMaxSize"),console.log(videoMaxSize);var colCount=0,rowCount=1,m2Col=[];if(m2.length>0){colCount=Math.floor(width/videoMaxSize.max),width>height&&(colCount=Math.floor(h2/videoMaxSize.max)),rowCount=videoMaxSize.rowCount,colCount=Math.ceil(len2/rowCount),console.log("col Count :"+colCount),console.log("row count :"+rowCount);for(var c=0,i=1;i<=rowCount;i++){for(var n=[],j=1;j<=colCount;j++)c<m2.length&&(n.push(m2[c]),c++);m2Col.push(n)}}console.log("audioWidthMax"),console.log(audioWidthMax),console.log(m2Col);var colCountM1=0,rowCountM1=1,m1Col=[];if(m1.length>0){rowCountM1=audioWidthMax.rowCount,colCountM1=Math.ceil(m1.length/rowCountM1),console.log("col Count m1 :"+colCountM1),console.log("row count m1 :"+rowCountM1);for(var c=0,i=1;i<=rowCountM1;i++){for(var n=[],j=1;j<=colCountM1;j++)c<m1.length&&(n.push(m1[c]),c++);m1Col.push(n)}}console.log(m1Col);var videoRowStyle={height:box2Heigth/rowCount+"px"},audioRowStyle={height:box1Heigth/rowCountM1+"px"};return _react.default.createElement("div",{"data-component":"Peers"},_react.default.createElement("div",{className:"peersbox",style:mystyle3},shareProducer?_react.default.createElement(_Me.default,{h:shareHeigth,w:shareWidth,type:"share"}):null,!shareProducer&&m3?_react.default.createElement(_transitions.Appear,{key:m3.id,duration:200},_react.default.createElement(_Peer.default,{id:m3.id,h:shareHeigth,w:shareWidth,type:"share"})):null),_react.default.createElement("div",{id:"peersbox",className:"peersbox",style:mystyle2},m2Col.map((function(n){return _react.default.createElement("div",{className:"videoRow",style:videoRowStyle},n.map((function(peer){switch(console.log(peer),peer.id){case"33":return _react.default.createElement(_transitions.Appear,{key:peer.id,duration:200},_react.default.createElement(_Me.default,{id:peer.id,h:videoMaxSize.max,w:videoMaxSize.max,type:"video"}));default:return _react.default.createElement(_transitions.Appear,{key:peer.id,duration:200},_react.default.createElement(_Peer.default,{id:peer.id,h:videoMaxSize.max,w:videoMaxSize.max,type:"video"}))}})))}))),_react.default.createElement("div",{className:"peersbox",style:mystyle1},m1Col.map((function(n){return _react.default.createElement("div",{className:"audioRow",style:audioRowStyle},n.map((function(peer){switch(console.log(peer),peer.id){case"44":return _react.default.createElement(_transitions.Appear,{key:peer.id,duration:200},_react.default.createElement(_Me.default,{id:peer.id,w:audioWidthMax.max,h:audioWidthMax.max,type:"audio"}));default:return _react.default.createElement(_transitions.Appear,{key:peer.id,duration:200},_react.default.createElement(_Peer.default,{id:peer.id,h:audioWidthMax.max,w:audioWidthMax.max,type:"audio"}))}})))}))))};Peers.propTypes={peers:_propTypes.default.arrayOf(appPropTypes.Peer).isRequired,activeSpeakerId:_propTypes.default.string};var mapStateToProps=function mapStateToProps(state){var peersArray=Object.values(state.peers);return sst=state,{peers:peersArray,activeSpeakerId:state.room.activeSpeakerId}},PeersContainer;function getMaxSize(a,n){window.videoMaxSize=300}function bestMatchCalculate(w,h,n,xxx){if(0==w||0==h||0==n)return 0;for(var max=0,p=1,i=1,max,min,r,t,t2,t3,k1,newMin,t4;i<=n;i++){var rowCount=Math.ceil(n/i),rowH=h/rowCount,colCount,colW=w/Math.ceil(n/rowCount),min;(min=Math.min(rowH,colW))>=max&&(max=min,p=rowCount)}return{max:max,rowCount:p}}function bestMatchCalculateAudio(w,h,n,xx){if(0==w||0==h||0==n)return 0;console.log("w : "+w+" h : "+h+" n : "+n);var row=1;h>160&&h<260&&(row=2);var col,count=w/(n/row);return console.log("count :"+count),count}var _default=(0,_reactRedux.connect)(mapStateToProps,null,null,{areStatesEqual:function areStatesEqual(next,prev){return prev.peers===next.peers&&prev.room.activeSpeakerId===next.room.activeSpeakerId}})(Peers);exports.default=_default},{"./Me2":7,"./Peer":10,"./appPropTypes":15,"./transitions":16,"@babel/runtime/helpers/interopRequireDefault":45,"@babel/runtime/helpers/typeof":54,classnames:258,"prop-types":426,react:483,"react-redux":459}],13:[function(require,module,exports){"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_typeof=require("@babel/runtime/helpers/typeof");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),_inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits")),_possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn")),_getPrototypeOf2=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf")),_react=_interopRequireDefault(require("react")),_reactRedux=require("react-redux"),_propTypes=_interopRequireDefault(require("prop-types")),_reactTooltip=_interopRequireDefault(require("react-tooltip")),_classnames=_interopRequireDefault(require("classnames")),_clipboardCopy=_interopRequireDefault(require("clipboard-copy")),appPropTypes=_interopRequireWildcard(require("./appPropTypes")),_RoomContext=require("../RoomContext"),requestActions=_interopRequireWildcard(require("../redux/requestActions")),_transitions=require("./transitions"),_Me=_interopRequireDefault(require("./Me")),_ChatInput=_interopRequireDefault(require("./ChatInput")),_Peers=_interopRequireDefault(require("./Peers")),_Stats=_interopRequireDefault(require("./Stats")),_Notifications=_interopRequireDefault(require("./Notifications")),_NetworkThrottle=_interopRequireDefault(require("./NetworkThrottle"));function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function _getRequireWildcardCache(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=(0,_getPrototypeOf2.default)(Derived),result;if(hasNativeReflectConstruct){var NewTarget=(0,_getPrototypeOf2.default)(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return(0,_possibleConstructorReturn2.default)(this,result)}}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var Room=function(_React$Component){(0,_inherits2.default)(Room,_React$Component);var _super=_createSuper(Room);function Room(){return(0,_classCallCheck2.default)(this,Room),_super.apply(this,arguments)}return(0,_createClass2.default)(Room,[{key:"render",value:function render(){var _this$props=this.props,roomClient=_this$props.roomClient,room=_this$props.room,me=_this$props.me,amActiveSpeaker=_this$props.amActiveSpeaker,onRoomLinkCopy=_this$props.onRoomLinkCopy;return(_react.default.createElement(_transitions.Appear,{duration:300},_react.default.createElement("div",{"data-component":"Room"},_react.default.createElement(_Notifications.default,null),_react.default.createElement(_Me.default,null),_react.default.createElement("div",{className:"state"},_react.default.createElement("div",{className:(0,_classnames.default)("icon",room.state)})),_react.default.createElement(_Peers.default,null),window.NETWORK_THROTTLE_SECRET?_react.default.createElement(_NetworkThrottle.default,{secret:window.NETWORK_THROTTLE_SECRET}):null,_react.default.createElement(_reactTooltip.default,{type:"light",effect:"solid",delayShow:100,delayHide:100,delayUpdate:50}))))}},{key:"componentDidMount",value:function componentDidMount(){var roomClient;this.props.roomClient.join()}}]),Room}(_react.default.Component);Room.propTypes={roomClient:_propTypes.default.any.isRequired,room:appPropTypes.Room.isRequired,me:appPropTypes.Me.isRequired,amActiveSpeaker:_propTypes.default.bool.isRequired,onRoomLinkCopy:_propTypes.default.func.isRequired};var mapStateToProps=function mapStateToProps(state){return{room:state.room,me:state.me,amActiveSpeaker:state.me.id===state.room.activeSpeakerId}},mapDispatchToProps=function mapDispatchToProps(dispatch){return{onRoomLinkCopy:function onRoomLinkCopy(){dispatch(requestActions.notify({text:"Room link copied to the clipboard"}))}}},RoomContainer,_default=(0,_RoomContext.withRoomContext)((0,_reactRedux.connect)(mapStateToProps,mapDispatchToProps)(Room));exports.default=_default},{"../RoomContext":3,"../redux/requestActions":31,"./ChatInput":4,"./Me":6,"./NetworkThrottle":8,"./Notifications":9,"./Peers":12,"./Stats":14,"./appPropTypes":15,"./transitions":16,"@babel/runtime/helpers/classCallCheck":39,"@babel/runtime/helpers/createClass":40,"@babel/runtime/helpers/getPrototypeOf":43,"@babel/runtime/helpers/inherits":44,"@babel/runtime/helpers/interopRequireDefault":45,"@babel/runtime/helpers/possibleConstructorReturn":51,"@babel/runtime/helpers/typeof":54,classnames:258,"clipboard-copy":259,"prop-types":426,react:483,"react-redux":459,"react-tooltip":470}],14:[function(require,module,exports){"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_typeof=require("@babel/runtime/helpers/typeof");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator")),_classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),_inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits")),_possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn")),_getPrototypeOf2=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf")),_react=_interopRequireDefault(require("react")),_reactRedux=require("react-redux"),_propTypes=_interopRequireDefault(require("prop-types")),_classnames=_interopRequireDefault(require("classnames")),_transitions=require("./transitions"),_RoomContext=require("../RoomContext"),stateActions=_interopRequireWildcard(require("../redux/stateActions"));function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function _getRequireWildcardCache(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function _createForOfIteratorHelper(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(!it){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0,F=function F(){};return{s:F,n:function n(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function e(_e){throw _e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var normalCompletion=!0,didErr=!1,err;return{s:function s(){it=it.call(o)},n:function n(){var step=it.next();return normalCompletion=step.done,step},e:function e(_e2){didErr=!0,err=_e2},f:function f(){try{normalCompletion||null==it.return||it.return()}finally{if(didErr)throw err}}}}function _unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(o,minLen):void 0}}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=(0,_getPrototypeOf2.default)(Derived),result;if(hasNativeReflectConstruct){var NewTarget=(0,_getPrototypeOf2.default)(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return(0,_possibleConstructorReturn2.default)(this,result)}}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var Stats=function(_React$Component){(0,_inherits2.default)(Stats,_React$Component);var _super=_createSuper(Stats);function Stats(props){var _this;return(0,_classCallCheck2.default)(this,Stats),(_this=_super.call(this,props)).state={sendTransportRemoteStats:null,sendTransportLocalStats:null,recvTransportRemoteStats:null,recvTransportLocalStats:null,audioProducerRemoteStats:null,audioProducerLocalStats:null,videoProducerRemoteStats:null,videoProducerLocalStats:null,chatDataProducerRemoteStats:null,botDataProducerRemoteStats:null,audioConsumerRemoteStats:null,audioConsumerLocalStats:null,videoConsumerRemoteStats:null,videoConsumerLocalStats:null,chatDataConsumerRemoteStats:null,botDataConsumerRemoteStats:null},_this._delayTimer=null,_this}return(0,_createClass2.default)(Stats,[{key:"render",value:function render(){var _this$props=this.props,peerId=_this$props.peerId,peerDisplayName=_this$props.peerDisplayName,isMe=_this$props.isMe,onClose=_this$props.onClose,_this$state=this.state,sendTransportRemoteStats=_this$state.sendTransportRemoteStats,sendTransportLocalStats=_this$state.sendTransportLocalStats,recvTransportRemoteStats=_this$state.recvTransportRemoteStats,recvTransportLocalStats=_this$state.recvTransportLocalStats,audioProducerRemoteStats=_this$state.audioProducerRemoteStats,audioProducerLocalStats=_this$state.audioProducerLocalStats,videoProducerRemoteStats=_this$state.videoProducerRemoteStats,videoProducerLocalStats=_this$state.videoProducerLocalStats,chatDataProducerRemoteStats=_this$state.chatDataProducerRemoteStats,botDataProducerRemoteStats=_this$state.botDataProducerRemoteStats,audioConsumerRemoteStats=_this$state.audioConsumerRemoteStats,audioConsumerLocalStats=_this$state.audioConsumerLocalStats,videoConsumerRemoteStats=_this$state.videoConsumerRemoteStats,videoConsumerLocalStats=_this$state.videoConsumerLocalStats,chatDataConsumerRemoteStats=_this$state.chatDataConsumerRemoteStats,botDataConsumerRemoteStats=_this$state.botDataConsumerRemoteStats;return _react.default.createElement("div",{"data-component":"Stats"},_react.default.createElement("div",{className:(0,_classnames.default)("content",{visible:peerId})},_react.default.createElement("div",{className:"header"},_react.default.createElement("div",{className:"info"},_react.default.createElement("div",{className:"close-icon",onClick:onClose}),isMe?_react.default.createElement("h1",null,"Your Stats"):_react.default.createElement("h1",null,"Stats of ",peerDisplayName)),_react.default.createElement("div",{className:"list"},sendTransportRemoteStats||sendTransportLocalStats?_react.default.createElement("p",null,"send transport stats: ",_react.default.createElement("a",{href:"#send-transport-remote-stats"},"[remote]"),_react.default.createElement("span",null," "),_react.default.createElement("a",{href:"#send-transport-local-stats"},"[local]")):null,recvTransportRemoteStats||recvTransportLocalStats?_react.default.createElement("p",null,"recv transport stats: ",_react.default.createElement("a",{href:"#recv-transport-remote-stats"},"[remote]"),_react.default.createElement("span",null," "),_react.default.createElement("a",{href:"#recv-transport-local-stats"},"[local]")):null,audioProducerRemoteStats||audioProducerLocalStats?_react.default.createElement("p",null,"audio producer stats: ",_react.default.createElement("a",{href:"#audio-producer-remote-stats"},"[remote]"),_react.default.createElement("span",null," "),_react.default.createElement("a",{href:"#audio-producer-local-stats"},"[local]")):null,videoProducerRemoteStats||videoProducerLocalStats?_react.default.createElement("p",null,"video producer stats: ",_react.default.createElement("a",{href:"#video-producer-remote-stats"},"[remote]"),_react.default.createElement("span",null," "),_react.default.createElement("a",{href:"#video-producer-local-stats"},"[local]")):null,chatDataProducerRemoteStats?_react.default.createElement("p",null,"chat dataproducer stats: ",_react.default.createElement("a",{href:"#chat-dataproducer-remote-stats"},"[remote]"),_react.default.createElement("span",null," "),_react.default.createElement("a",{className:"disabled"},"[local]")):null,botDataProducerRemoteStats?_react.default.createElement("p",null,"bot dataproducer stats: ",_react.default.createElement("a",{href:"#bot-dataproducer-remote-stats"},"[remote]"),_react.default.createElement("span",null," "),_react.default.createElement("a",{className:"disabled"},"[local]")):null,audioConsumerRemoteStats||audioConsumerLocalStats?_react.default.createElement("p",null,"audio consumer stats: ",_react.default.createElement("a",{href:"#audio-consumer-remote-stats"},"[remote]"),_react.default.createElement("span",null," "),_react.default.createElement("a",{href:"#audio-consumer-local-stats"},"[local]")):null,videoConsumerRemoteStats||videoConsumerLocalStats?_react.default.createElement("p",null,"video consumer stats: ",_react.default.createElement("a",{href:"#video-consumer-remote-stats"},"[remote]"),_react.default.createElement("span",null," "),_react.default.createElement("a",{href:"#video-consumer-local-stats"},"[local]")):null,chatDataConsumerRemoteStats?_react.default.createElement("p",null,"chat dataconsumer stats: ",_react.default.createElement("a",{href:"#chat-dataconsumer-remote-stats"},"[remote]"),_react.default.createElement("span",null," "),_react.default.createElement("a",{className:"disabled"},"[local]")):null,botDataConsumerRemoteStats?_react.default.createElement("p",null,"bot dataconsumer stats: ",_react.default.createElement("a",{href:"#bot-dataconsumer-remote-stats"},"[remote]"),_react.default.createElement("span",null," "),_react.default.createElement("a",{className:"disabled"},"[local]")):null)),_react.default.createElement("div",{className:"stats"},sendTransportRemoteStats?this._printStats("send transport remote stats",sendTransportRemoteStats):null,sendTransportLocalStats?this._printStats("send transport local stats",sendTransportLocalStats):null,recvTransportRemoteStats?this._printStats("recv transport remote stats",recvTransportRemoteStats):null,recvTransportLocalStats?this._printStats("recv transport local stats",recvTransportLocalStats):null,audioProducerRemoteStats?this._printStats("audio producer remote stats",audioProducerRemoteStats):null,audioProducerLocalStats?this._printStats("audio producer local stats",audioProducerLocalStats):null,videoProducerRemoteStats?this._printStats("video producer remote stats",videoProducerRemoteStats):null,videoProducerLocalStats?this._printStats("video producer local stats",videoProducerLocalStats):null,chatDataProducerRemoteStats?this._printStats("chat dataproducer remote stats",chatDataProducerRemoteStats):null,botDataProducerRemoteStats?this._printStats("bot dataproducer remote stats",botDataProducerRemoteStats):null,audioConsumerRemoteStats?this._printStats("audio consumer remote stats",audioConsumerRemoteStats):null,audioConsumerLocalStats?this._printStats("audio consumer local stats",audioConsumerLocalStats):null,videoConsumerRemoteStats?this._printStats("video consumer remote stats",videoConsumerRemoteStats):null,videoConsumerLocalStats?this._printStats("video consumer local stats",videoConsumerLocalStats):null,chatDataConsumerRemoteStats?this._printStats("chat dataconsumer remote stats",chatDataConsumerRemoteStats):null,botDataConsumerRemoteStats?this._printStats("bot dataconsumer remote stats",botDataConsumerRemoteStats):null)))}},{key:"componentDidUpdate",value:function componentDidUpdate(prevProps){var _this2=this,peerId=this.props.peerId;peerId&&!prevProps.peerId?this._delayTimer=setTimeout((function(){return _this2._start()}),250):!peerId&&prevProps.peerId?this._stop():peerId&&prevProps.peerId&&peerId!==prevProps.peerId&&(this._stop(),this._start())}},{key:"_start",value:function(){var _start2=(0,_asyncToGenerator2.default)(_regenerator.default.mark((function _callee(){var _this3=this,_this$props2,roomClient,isMe,audioConsumerId,videoConsumerId,chatDataConsumerId,botDataConsumerId,sendTransportRemoteStats,sendTransportLocalStats,recvTransportRemoteStats,recvTransportLocalStats,audioProducerRemoteStats,audioProducerLocalStats,videoProducerRemoteStats,videoProducerLocalStats,chatDataProducerRemoteStats,botDataProducerRemoteStats,audioConsumerRemoteStats,audioConsumerLocalStats,videoConsumerRemoteStats,videoConsumerLocalStats,chatDataConsumerRemoteStats,botDataConsumerRemoteStats;return _regenerator.default.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:if(_this$props2=this.props,roomClient=_this$props2.roomClient,isMe=_this$props2.isMe,audioConsumerId=_this$props2.audioConsumerId,videoConsumerId=_this$props2.videoConsumerId,chatDataConsumerId=_this$props2.chatDataConsumerId,botDataConsumerId=_this$props2.botDataConsumerId,sendTransportRemoteStats=null,sendTransportLocalStats=null,recvTransportRemoteStats=null,recvTransportLocalStats=null,audioProducerRemoteStats=null,audioProducerLocalStats=null,videoProducerRemoteStats=null,videoProducerLocalStats=null,chatDataProducerRemoteStats=null,botDataProducerRemoteStats=null,audioConsumerRemoteStats=null,audioConsumerLocalStats=null,videoConsumerRemoteStats=null,videoConsumerLocalStats=null,chatDataConsumerRemoteStats=null,botDataConsumerRemoteStats=null,!isMe){_context.next=53;break}return _context.next=20,roomClient.getSendTransportRemoteStats().catch((function(){}));case 20:return sendTransportRemoteStats=_context.sent,_context.next=23,roomClient.getSendTransportLocalStats().catch((function(){}));case 23:return sendTransportLocalStats=_context.sent,_context.next=26,roomClient.getRecvTransportRemoteStats().catch((function(){}));case 26:return recvTransportRemoteStats=_context.sent,_context.next=29,roomClient.getRecvTransportLocalStats().catch((function(){}));case 29:return recvTransportLocalStats=_context.sent,_context.next=32,roomClient.getAudioRemoteStats().catch((function(){}));case 32:return audioProducerRemoteStats=_context.sent,_context.next=35,roomClient.getAudioLocalStats().catch((function(){}));case 35:return audioProducerLocalStats=_context.sent,_context.next=38,roomClient.getVideoRemoteStats().catch((function(){}));case 38:return videoProducerRemoteStats=_context.sent,_context.next=41,roomClient.getVideoLocalStats().catch((function(){}));case 41:return videoProducerLocalStats=_context.sent,_context.next=44,roomClient.getChatDataProducerRemoteStats().catch((function(){}));case 44:return chatDataProducerRemoteStats=_context.sent,_context.next=47,roomClient.getBotDataProducerRemoteStats().catch((function(){}));case 47:return botDataProducerRemoteStats=_context.sent,_context.next=50,roomClient.getDataConsumerRemoteStats(botDataConsumerId).catch((function(){}));case 50:botDataConsumerRemoteStats=_context.sent,_context.next=68;break;case 53:return _context.next=55,roomClient.getConsumerRemoteStats(audioConsumerId).catch((function(){}));case 55:return audioConsumerRemoteStats=_context.sent,_context.next=58,roomClient.getConsumerLocalStats(audioConsumerId).catch((function(){}));case 58:return audioConsumerLocalStats=_context.sent,_context.next=61,roomClient.getConsumerRemoteStats(videoConsumerId).catch((function(){}));case 61:return videoConsumerRemoteStats=_context.sent,_context.next=64,roomClient.getConsumerLocalStats(videoConsumerId).catch((function(){}));case 64:return videoConsumerLocalStats=_context.sent,_context.next=67,roomClient.getDataConsumerRemoteStats(chatDataConsumerId).catch((function(){}));case 67:chatDataConsumerRemoteStats=_context.sent;case 68:this.setState({sendTransportRemoteStats:sendTransportRemoteStats,sendTransportLocalStats:sendTransportLocalStats,recvTransportRemoteStats:recvTransportRemoteStats,recvTransportLocalStats:recvTransportLocalStats,audioProducerRemoteStats:audioProducerRemoteStats,audioProducerLocalStats:audioProducerLocalStats,videoProducerRemoteStats:videoProducerRemoteStats,videoProducerLocalStats:videoProducerLocalStats,chatDataProducerRemoteStats:chatDataProducerRemoteStats,botDataProducerRemoteStats:botDataProducerRemoteStats,audioConsumerRemoteStats:audioConsumerRemoteStats,audioConsumerLocalStats:audioConsumerLocalStats,videoConsumerRemoteStats:videoConsumerRemoteStats,videoConsumerLocalStats:videoConsumerLocalStats,chatDataConsumerRemoteStats:chatDataConsumerRemoteStats,botDataConsumerRemoteStats:botDataConsumerRemoteStats}),this._delayTimer=setTimeout((function(){return _this3._start()}),2500);case 70:case"end":return _context.stop()}}),_callee,this)})));function _start(){return _start2.apply(this,arguments)}return _start}()},{key:"_stop",value:function _stop(){clearTimeout(this._delayTimer),this.setState({sendTransportRemoteStats:null,sendTransportLocalStats:null,recvTransportRemoteStats:null,recvTransportLocalStats:null,audioProducerRemoteStats:null,audioProducerLocalStats:null,videoProducerRemoteStats:null,videoProducerLocalStats:null,chatDataProducerRemoteStats:null,botDataProducerRemoteStats:null,audioConsumerRemoteStats:null,audioConsumerLocalStats:null,videoConsumerRemoteStats:null,videoConsumerLocalStats:null,chatDataConsumerRemoteStats:null,botDataConsumerRemoteStats:null})}},{key:"_printStats",value:function _printStats(title,stats){var anchor=title.replace(/[ ]+/g,"-");return"function"==typeof stats.values&&(stats=Array.from(stats.values())),_react.default.createElement(_transitions.Appear,{duration:150},_react.default.createElement("div",{className:"items"},_react.default.createElement("h2",{id:anchor},title),stats.map((function(item,idx){return _react.default.createElement("div",{className:"item",key:idx},Object.keys(item).map((function(key){return _react.default.createElement("div",{className:"line",key:key},_react.default.createElement("p",{className:"key"},key),_react.default.createElement("div",{className:"value"},"number"==typeof item[key]?JSON.stringify(Math.round(100*item[key])/100,null,"  "):_react.default.createElement("pre",null,JSON.stringify(item[key],null,"  "))))})))}))))}}]),Stats}(_react.default.Component);Stats.propTypes={roomClient:_propTypes.default.any.isRequired,peerId:_propTypes.default.string,peerDisplayName:_propTypes.default.string,isMe:_propTypes.default.bool,audioConsumerId:_propTypes.default.string,videoConsumerId:_propTypes.default.string,chatDataConsumerId:_propTypes.default.string,botDataConsumerId:_propTypes.default.string,onClose:_propTypes.default.func.isRequired};var mapStateToProps=function mapStateToProps(state){var room=state.room,me=state.me,peers=state.peers,consumers=state.consumers,dataConsumers=state.dataConsumers,statsPeerId=room.statsPeerId;if(!statsPeerId)return{};var isMe=statsPeerId===me.id,peer=isMe?me:peers[statsPeerId],audioConsumerId,videoConsumerId,chatDataConsumerId,botDataConsumerId;if(isMe)for(var _i=0,_Object$keys=Object.keys(dataConsumers);_i<_Object$keys.length;_i++){var dataConsumerId,dataConsumer=dataConsumers[_Object$keys[_i]];"bot"===dataConsumer.label&&(botDataConsumerId=dataConsumer.id)}else{var _iterator=_createForOfIteratorHelper(peer.consumers),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var consumerId,consumer=consumers[_step.value];switch(consumer.track.kind){case"audio":audioConsumerId=consumer.id;break;case"video":videoConsumerId=consumer.id}}}catch(err){_iterator.e(err)}finally{_iterator.f()}var _iterator2=_createForOfIteratorHelper(peer.dataConsumers),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var _dataConsumerId,_dataConsumer=dataConsumers[_step2.value];"chat"===_dataConsumer.label&&(chatDataConsumerId=_dataConsumer.id)}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}}return{peerId:peer.id,peerDisplayName:peer.displayName,isMe:isMe,audioConsumerId:audioConsumerId,videoConsumerId:videoConsumerId,chatDataConsumerId:chatDataConsumerId,botDataConsumerId:botDataConsumerId}},mapDispatchToProps=function mapDispatchToProps(dispatch){return{onClose:function onClose(){return dispatch(stateActions.setRoomStatsPeerId(null))}}},StatsContainer,_default=(0,_RoomContext.withRoomContext)((0,_reactRedux.connect)(mapStateToProps,mapDispatchToProps)(Stats));exports.default=_default},{"../RoomContext":3,"../redux/stateActions":32,"./transitions":16,"@babel/runtime/helpers/asyncToGenerator":38,"@babel/runtime/helpers/classCallCheck":39,"@babel/runtime/helpers/createClass":40,"@babel/runtime/helpers/getPrototypeOf":43,"@babel/runtime/helpers/inherits":44,"@babel/runtime/helpers/interopRequireDefault":45,"@babel/runtime/helpers/possibleConstructorReturn":51,"@babel/runtime/helpers/typeof":54,"@babel/runtime/regenerator":56,classnames:258,"prop-types":426,react:483,"react-redux":459}],15:[function(require,module,exports){"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.Notification=exports.DataConsumer=exports.Consumer=exports.Peer=exports.DataProducer=exports.Producer=exports.Me=exports.Device=exports.Room=void 0;var _propTypes=_interopRequireDefault(require("prop-types")),Room=_propTypes.default.shape({url:_propTypes.default.string.isRequired,state:_propTypes.default.oneOf(["new","connecting","connected","closed"]).isRequired,activeSpeakerName:_propTypes.default.string});exports.Room=Room;var Device=_propTypes.default.shape({flag:_propTypes.default.string.isRequired,name:_propTypes.default.string,version:_propTypes.default.string});exports.Device=Device;var Me=_propTypes.default.shape({id:_propTypes.default.string.isRequired,displayName:_propTypes.default.string,displayNameSet:_propTypes.default.bool.isRequired,device:Device.isRequired,canSendMic:_propTypes.default.bool.isRequired,canSendWebcam:_propTypes.default.bool.isRequired,canChangeWebcam:_propTypes.default.bool.isRequired,webcamInProgress:_propTypes.default.bool.isRequired,audioOnly:_propTypes.default.bool.isRequired,audioOnlyInProgress:_propTypes.default.bool.isRequired,restartIceInProgress:_propTypes.default.bool.isRequired});exports.Me=Me;var Producer=_propTypes.default.shape({id:_propTypes.default.string.isRequired,deviceLabel:_propTypes.default.string,type:_propTypes.default.oneOf(["front","back","share"]),paused:_propTypes.default.bool.isRequired,track:_propTypes.default.any.isRequired,rtpParameters:_propTypes.default.object.isRequired,codec:_propTypes.default.string.isRequired});exports.Producer=Producer;var DataProducer=_propTypes.default.shape({id:_propTypes.default.string.isRequired,sctpStreamParameters:_propTypes.default.object.isRequired});exports.DataProducer=DataProducer;var Peer=_propTypes.default.shape({id:_propTypes.default.string.isRequired,displayName:_propTypes.default.string,device:Device.isRequired,consumers:_propTypes.default.arrayOf(_propTypes.default.string).isRequired});exports.Peer=Peer;var Consumer=_propTypes.default.shape({id:_propTypes.default.string.isRequired,locallyPaused:_propTypes.default.bool.isRequired,remotelyPaused:_propTypes.default.bool.isRequired,currentSpatialLayer:_propTypes.default.number,preferredSpatialLayer:_propTypes.default.number,track:_propTypes.default.any,codec:_propTypes.default.string});exports.Consumer=Consumer;var DataConsumer=_propTypes.default.shape({id:_propTypes.default.string.isRequired,sctpStreamParameters:_propTypes.default.object.isRequired});exports.DataConsumer=DataConsumer;var Notification=_propTypes.default.shape({id:_propTypes.default.string.isRequired,type:_propTypes.default.oneOf(["info","error"]).isRequired,timeout:_propTypes.default.number});exports.Notification=Notification},{"@babel/runtime/helpers/interopRequireDefault":45,"prop-types":426}],16:[function(require,module,exports){"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.Appear=void 0;var _react=_interopRequireDefault(require("react")),_propTypes=_interopRequireDefault(require("prop-types")),_reactTransitionGroup=require("react-transition-group"),Appear=function Appear(_ref){var duration=_ref.duration,children=_ref.children;return(_react.default.createElement(_reactTransitionGroup.CSSTransition,{in:!0,classNames:"Appear",timeout:duration||1e3,appear:!0},children))};exports.Appear=Appear,Appear.propTypes={duration:_propTypes.default.number,children:_propTypes.default.any}},{"@babel/runtime/helpers/interopRequireDefault":45,"prop-types":426,react:483,"react-transition-group":478}],17:[function(require,module,exports){"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.getUser=getUser,exports.setUser=setUser,exports.getDevices=getDevices,exports.setDevices=setDevices;var _jsCookie=_interopRequireDefault(require("js-cookie")),USER_COOKIE="mediasoup-demo.user",DEVICES_COOKIE="mediasoup-demo.devices";function getUser(){return _jsCookie.default.getJSON(USER_COOKIE)}function setUser(_ref){var displayName=_ref.displayName;_jsCookie.default.set(USER_COOKIE,{displayName:displayName})}function getDevices(){return _jsCookie.default.getJSON(DEVICES_COOKIE)}function setDevices(_ref2){var webcamEnabled=_ref2.webcamEnabled;_jsCookie.default.set(DEVICES_COOKIE,{webcamEnabled:webcamEnabled})}},{"@babel/runtime/helpers/interopRequireDefault":45,"js-cookie":385}],18:[function(require,module,exports){"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=_default;var _bowser=_interopRequireDefault(require("bowser"));function _default(){var ua=navigator.userAgent,browser=_bowser.default.getParser(ua),flag;return{flag:flag=browser.satisfies({chrome:">=0",chromium:">=0"})?"chrome":browser.satisfies({firefox:">=0"})?"firefox":browser.satisfies({safari:">=0"})?"safari":browser.satisfies({opera:">=0"})?"opera":browser.satisfies({"microsoft edge":">=0"})?"edge":"unknown",name:browser.getBrowserName(),version:browser.getBrowserVersion()}}window.BOWSER=_bowser.default},{"@babel/runtime/helpers/interopRequireDefault":45,bowser:253}],19:[function(require,module,exports){"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.isSupported=isSupported,exports.setCryptoKey=setCryptoKey,exports.setupSenderTransform=setupSenderTransform,exports.setupReceiverTransform=setupReceiverTransform;var _Logger,logger=new(_interopRequireDefault(require("./Logger")).default)("e2e"),e2eSupported=void 0,worker=void 0;function isSupported(){if(void 0===e2eSupported)if(RTCRtpSender.prototype.createEncodedStreams)try{var stream=new ReadableStream;window.postMessage(stream,"*",[stream]),worker=new Worker("/resources/js/e2e-worker.js",{name:"e2e worker"}),logger.debug("isSupported() | supported"),e2eSupported=!0}catch(error){logger.debug("isSupported() | not supported: ".concat(error)),e2eSupported=!1}else logger.debug("isSupported() | not supported"),e2eSupported=!1;return e2eSupported}function setCryptoKey(operation,key,useCryptoOffset){logger.debug("setCryptoKey() [operation:%o, useCryptoOffset:%o]",operation,useCryptoOffset),assertSupported(),worker.postMessage({operation:operation,currentCryptoKey:key,useCryptoOffset:useCryptoOffset})}function setupSenderTransform(sender){logger.debug("setupSenderTransform()"),assertSupported();var senderStreams=sender.createEncodedStreams(),readableStream=senderStreams.readable||senderStreams.readableStream,writableStream=senderStreams.writable||senderStreams.writableStream;worker.postMessage({operation:"encode",readableStream:readableStream,writableStream:writableStream},[readableStream,writableStream])}function setupReceiverTransform(receiver){logger.debug("setupReceiverTransform()"),assertSupported();var receiverStreams=receiver.createEncodedStreams(),readableStream=receiverStreams.readable||receiverStreams.readableStream,writableStream=receiverStreams.writable||receiverStreams.writableStream;worker.postMessage({operation:"decode",readableStream:readableStream,writableStream:writableStream},[readableStream,writableStream])}function assertSupported(){if(!1===e2eSupported)throw new Error("e2e not supported");if(void 0===e2eSupported)throw new Error("e2e not initialized, must call isSupported() first")}},{"./Logger":1,"@babel/runtime/helpers/interopRequireDefault":45}],20:[function(require,module,exports){"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_typeof=require("@babel/runtime/helpers/typeof"),_regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator")),_domready=_interopRequireDefault(require("domready")),_urlParse=_interopRequireDefault(require("url-parse")),_react=_interopRequireDefault(require("react")),_reactDom=require("react-dom"),_reactRedux=require("react-redux"),_redux=require("redux"),_reduxThunk=_interopRequireDefault(require("redux-thunk")),_randomString=_interopRequireDefault(require("random-string")),faceapi=_interopRequireWildcard(require("face-api.js")),_Logger=_interopRequireDefault(require("./Logger")),utils=_interopRequireWildcard(require("./utils")),_randomName=_interopRequireDefault(require("./randomName")),_deviceInfo=_interopRequireDefault(require("./deviceInfo")),_RoomClient=_interopRequireDefault(require("./RoomClient")),_RoomContext=_interopRequireDefault(require("./RoomContext")),cookiesManager=_interopRequireWildcard(require("./cookiesManager")),stateActions=_interopRequireWildcard(require("./redux/stateActions")),_reducers=_interopRequireDefault(require("./redux/reducers")),_Room=_interopRequireDefault(require("./components/Room"));function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function _getRequireWildcardCache(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}var logger=new _Logger.default,reduxMiddlewares=[_reduxThunk.default],roomClient,store=(0,_redux.createStore)(_reducers.default,void 0,_redux.applyMiddleware.apply(void 0,reduxMiddlewares));function run(){return _run.apply(this,arguments)}function _run(){return(_run=(0,_asyncToGenerator2.default)(_regenerator.default.mark((function _callee3(){var urlParser,peerId,roomId,displayName,handler,useSimulcast,useSharingSimulcast,forceTcp,produce,consume,forceH264,forceVP9,svc,datachannel,info,faceDetection,externalVideo,throttleSecret,e2eKey,roomUrlParser,_i,_Object$keys,key,roomUrl,displayNameSet,device;return _regenerator.default.wrap((function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:if(logger.debug("run() [environment:%s]","development"),urlParser=new _urlParse.default(window.location.href,!0),peerId=board.userName,roomId=board.meetID,displayName=board.nickName,handler=urlParser.query.handler,useSimulcast="false"!==urlParser.query.simulcast,useSharingSimulcast="false"!==urlParser.query.sharingSimulcast,forceTcp="true"===urlParser.query.forceTcp,produce="false"!==urlParser.query.produce,consume="false"!==urlParser.query.consume,forceH264="true"===urlParser.query.forceH264,forceVP9="true"===urlParser.query.forceVP9,svc=urlParser.query.svc,datachannel="false"!==urlParser.query.datachannel,info="true"===urlParser.query.info,faceDetection="true"===urlParser.query.faceDetection,externalVideo="true"===urlParser.query.externalVideo,throttleSecret=urlParser.query.throttleSecret,e2eKey=urlParser.query.e2eKey,!faceDetection){_context3.next=23;break}return _context3.next=23,faceapi.loadTinyFaceDetectorModel("/resources/face-detector-models");case 23:info&&(window.SHOW_INFO=!0),throttleSecret&&(window.NETWORK_THROTTLE_SECRET=throttleSecret),roomId||(roomId=(0,_randomString.default)({length:8}).toLowerCase(),urlParser.query.roomId=roomId,window.history.pushState("","",urlParser.toString())),roomUrlParser=new _urlParse.default(window.location.href,!0),_i=0,_Object$keys=Object.keys(roomUrlParser.query);case 28:if(!(_i<_Object$keys.length)){_context3.next=38;break}key=_Object$keys[_i],_context3.t0=key,_context3.next="roomId"===_context3.t0?33:"handler"===_context3.t0?33:"simulcast"===_context3.t0?33:"sharingSimulcast"===_context3.t0?33:"produce"===_context3.t0?33:"consume"===_context3.t0?33:"forceH264"===_context3.t0?33:"forceVP9"===_context3.t0?33:"forceTcp"===_context3.t0?33:"svc"===_context3.t0?33:"datachannel"===_context3.t0?33:"info"===_context3.t0?33:"faceDetection"===_context3.t0?33:"externalVideo"===_context3.t0?33:"throttleSecret"===_context3.t0?33:"e2eKey"===_context3.t0?33:34;break;case 33:return _context3.abrupt("break",35);case 34:delete roomUrlParser.query[key];case 35:_i++,_context3.next=28;break;case 38:delete roomUrlParser.hash,roomUrl=roomUrlParser.toString(),displayName?displayNameSet=!0:(displayNameSet=!1,displayName=(0,_randomName.default)()),device=(0,_deviceInfo.default)(),store.dispatch(stateActions.setRoomUrl(roomUrl)),store.dispatch(stateActions.setRoomFaceDetection(faceDetection)),store.dispatch(stateActions.setMe({peerId:peerId,displayName:displayName,displayNameSet:displayNameSet,device:device})),roomClient=new _RoomClient.default({roomId:roomId,peerId:peerId,displayName:displayName,device:device,handlerName:handler,useSimulcast:useSimulcast,useSharingSimulcast:useSharingSimulcast,forceTcp:forceTcp,produce:produce,consume:consume,forceH264:forceH264,forceVP9:forceVP9,svc:svc,datachannel:datachannel,externalVideo:externalVideo,e2eKey:e2eKey}),window.CLIENT=roomClient,window.CC=roomClient,(0,_reactDom.render)(_react.default.createElement(_reactRedux.Provider,{store:store},_react.default.createElement(_RoomContext.default.Provider,{value:roomClient},_react.default.createElement(_Room.default,null))),document.getElementById("mediasoup-demo-app-container"));case 49:case"end":return _context3.stop()}}),_callee3)})))).apply(this,arguments)}window.STORE=store,_RoomClient.default.init({store:store}),(0,_domready.default)((0,_asyncToGenerator2.default)(_regenerator.default.mark((function _callee(){return _regenerator.default.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return logger.debug("DOM ready"),_context.next=3,utils.initialize();case 3:run();case 4:case"end":return _context.stop()}}),_callee)})))),window.__sendSdps=function(){logger.warn(">>> send transport local SDP offer:"),logger.warn(roomClient._sendTransport._handler._pc.localDescription.sdp),logger.warn(">>> send transport remote SDP answer:"),logger.warn(roomClient._sendTransport._handler._pc.remoteDescription.sdp)},window.__recvSdps=function(){logger.warn(">>> recv transport remote SDP offer:"),logger.warn(roomClient._recvTransport._handler._pc.remoteDescription.sdp),logger.warn(">>> recv transport local SDP answer:"),logger.warn(roomClient._recvTransport._handler._pc.localDescription.sdp)};var dataChannelTestInterval=null;window.__startDataChannelTest=function(){var number=0,buffer=new ArrayBuffer(32),view=new DataView(buffer);dataChannelTestInterval=window.setInterval((function(){window.DP&&(view.setUint32(0,number++),roomClient.sendChatMessage(buffer))}),100)},window.__stopDataChannelTest=function(){window.clearInterval(dataChannelTestInterval);var buffer=new ArrayBuffer(32),view=new DataView(buffer);window.DP&&(view.setUint32(0,Math.pow(2,32)-1),window.DP.send(buffer))},window.__testSctp=(0,_asyncToGenerator2.default)(_regenerator.default.mark((function _callee2(){var _ref3,_ref3$timeout,timeout,_ref3$bot,bot,dp,send,_args2=arguments;return _regenerator.default.wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(send=function _send(){dp.send("I am streamId ".concat(dp.sctpStreamParameters.streamId))},_ref3=_args2.length>0&&void 0!==_args2[0]?_args2[0]:{},_ref3$timeout=_ref3.timeout,timeout=void 0===_ref3$timeout?100:_ref3$timeout,_ref3$bot=_ref3.bot,bot=void 0!==_ref3$bot&&_ref3$bot){_context2.next=8;break}return _context2.next=5,window.CLIENT.enableChatDataProducer();case 5:dp=window.CLIENT._chatDataProducer,_context2.next=11;break;case 8:return _context2.next=10,window.CLIENT.enableBotDataProducer();case 10:dp=window.CLIENT._botDataProducer;case 11:logger.warn("<<< testSctp: DataProducer created [bot:%s, streamId:%d, readyState:%s]",bot?"true":"false",dp.sctpStreamParameters.streamId,dp.readyState),"open"===dp.readyState?send():dp.on("open",(function(){logger.warn("<<< testSctp: DataChannel open [streamId:%d]",dp.sctpStreamParameters.streamId),send()})),setTimeout((function(){return window.__testSctp({timeout:timeout,bot:bot})}),timeout);case 14:case"end":return _context2.stop()}}),_callee2)}))),setInterval((function(){window.CLIENT._sendTransport?(window.H1=window.CLIENT._sendTransport._handler,window.PC1=window.CLIENT._sendTransport._handler._pc,window.DP=window.CLIENT._chatDataProducer):(delete window.PC1,delete window.DP),window.CLIENT._recvTransport?(window.H2=window.CLIENT._recvTransport._handler,window.PC2=window.CLIENT._recvTransport._handler._pc):delete window.PC2}),2e3)},{"./Logger":1,"./RoomClient":2,"./RoomContext":3,"./components/Room":13,"./cookiesManager":17,"./deviceInfo":18,"./randomName":21,"./redux/reducers":25,"./redux/stateActions":32,"./utils":34,"@babel/runtime/helpers/asyncToGenerator":38,"@babel/runtime/helpers/interopRequireDefault":45,"@babel/runtime/helpers/typeof":54,"@babel/runtime/regenerator":56,domready:265,"face-api.js":337,"random-string":437,react:483,"react-dom":440,"react-redux":459,redux:485,"redux-thunk":484,"url-parse":591}],21:[function(require,module,exports){"use strict";var _typeof=require("@babel/runtime/helpers/typeof");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=_default;var pokemon=_interopRequireWildcard(require("pokemon"));function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function _getRequireWildcardCache(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function _default(){var lang="en";return pokemon.random("en")}function detectLanguage(){return"en"}},{"@babel/runtime/helpers/typeof":54,pokemon:421}],22:[function(require,module,exports){"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){(0,_defineProperty2.default)(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}var initialState={},consumers,_default=function consumers(){var state=arguments.length>0&&void 0!==arguments[0]?arguments[0]:initialState,action=arguments.length>1?arguments[1]:void 0;switch(action.type){case"SET_ROOM_STATE":var roomState=action.payload.state;return"closed"===roomState?{}:state;case"ADD_CONSUMER":var consumer=action.payload.consumer;return _objectSpread(_objectSpread({},state),{},(0,_defineProperty2.default)({},consumer.id,consumer));case"REMOVE_CONSUMER":var consumerId=action.payload.consumerId,newState=_objectSpread({},state);return delete newState[consumerId],newState;case"SET_CONSUMER_PAUSED":var _action$payload=action.payload,_consumerId=_action$payload.consumerId,originator=_action$payload.originator,_consumer=state[_consumerId],newConsumer;return newConsumer=_objectSpread(_objectSpread({},_consumer),{},"local"===originator?{locallyPaused:!0}:{remotelyPaused:!0}),_objectSpread(_objectSpread({},state),{},(0,_defineProperty2.default)({},_consumerId,newConsumer));case"SET_CONSUMER_RESUMED":var _action$payload2=action.payload,_consumerId2=_action$payload2.consumerId,_originator=_action$payload2.originator,_consumer2=state[_consumerId2],_newConsumer;return _newConsumer=_objectSpread(_objectSpread({},_consumer2),{},"local"===_originator?{locallyPaused:!1}:{remotelyPaused:!1}),_objectSpread(_objectSpread({},state),{},(0,_defineProperty2.default)({},_consumerId2,_newConsumer));case"SET_CONSUMER_CURRENT_LAYERS":var _action$payload3=action.payload,_consumerId3=_action$payload3.consumerId,spatialLayer=_action$payload3.spatialLayer,temporalLayer=_action$payload3.temporalLayer,_consumer3=state[_consumerId3],_newConsumer2=_objectSpread(_objectSpread({},_consumer3),{},{currentSpatialLayer:spatialLayer,currentTemporalLayer:temporalLayer});return _objectSpread(_objectSpread({},state),{},(0,_defineProperty2.default)({},_consumerId3,_newConsumer2));case"SET_CONSUMER_PREFERRED_LAYERS":var _action$payload4=action.payload,_consumerId4=_action$payload4.consumerId,_spatialLayer=_action$payload4.spatialLayer,_temporalLayer=_action$payload4.temporalLayer,_consumer4=state[_consumerId4],_newConsumer3=_objectSpread(_objectSpread({},_consumer4),{},{preferredSpatialLayer:_spatialLayer,preferredTemporalLayer:_temporalLayer});return _objectSpread(_objectSpread({},state),{},(0,_defineProperty2.default)({},_consumerId4,_newConsumer3));case"SET_CONSUMER_PRIORITY":var _action$payload5=action.payload,_consumerId5=_action$payload5.consumerId,priority=_action$payload5.priority,_consumer5=state[_consumerId5],_newConsumer4=_objectSpread(_objectSpread({},_consumer5),{},{priority:priority});return _objectSpread(_objectSpread({},state),{},(0,_defineProperty2.default)({},_consumerId5,_newConsumer4));case"SET_CONSUMER_TRACK":var _action$payload6=action.payload,_consumerId6=_action$payload6.consumerId,track=_action$payload6.track,_consumer6=state[_consumerId6],_newConsumer5=_objectSpread(_objectSpread({},_consumer6),{},{track:track});return _objectSpread(_objectSpread({},state),{},(0,_defineProperty2.default)({},_consumerId6,_newConsumer5));case"SET_CONSUMER_SCORE":var _action$payload7=action.payload,_consumerId7=_action$payload7.consumerId,score=_action$payload7.score,_consumer7=state[_consumerId7];if(!_consumer7)return state;var _newConsumer6=_objectSpread(_objectSpread({},_consumer7),{},{score:score});return _objectSpread(_objectSpread({},state),{},(0,_defineProperty2.default)({},_consumerId7,_newConsumer6));default:return state}};exports.default=_default},{"@babel/runtime/helpers/defineProperty":41,"@babel/runtime/helpers/interopRequireDefault":45}],23:[function(require,module,exports){"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){(0,_defineProperty2.default)(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}var initialState={},dataConsumers,_default=function dataConsumers(){var state=arguments.length>0&&void 0!==arguments[0]?arguments[0]:initialState,action=arguments.length>1?arguments[1]:void 0;switch(action.type){case"SET_ROOM_STATE":var roomState=action.payload.state;return"closed"===roomState?{}:state;case"ADD_DATA_CONSUMER":var dataConsumer=action.payload.dataConsumer;return _objectSpread(_objectSpread({},state),{},(0,_defineProperty2.default)({},dataConsumer.id,dataConsumer));case"REMOVE_DATA_CONSUMER":var dataConsumerId=action.payload.dataConsumerId,newState=_objectSpread({},state);return delete newState[dataConsumerId],newState;default:return state}};exports.default=_default},{"@babel/runtime/helpers/defineProperty":41,"@babel/runtime/helpers/interopRequireDefault":45}],24:[function(require,module,exports){"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){(0,_defineProperty2.default)(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}var initialState={},dataProducers,_default=function dataProducers(){var state=arguments.length>0&&void 0!==arguments[0]?arguments[0]:initialState,action=arguments.length>1?arguments[1]:void 0;switch(action.type){case"SET_ROOM_STATE":var roomState=action.payload.state;return"closed"===roomState?{}:state;case"ADD_DATA_PRODUCER":var dataProducer=action.payload.dataProducer;return _objectSpread(_objectSpread({},state),{},(0,_defineProperty2.default)({},dataProducer.id,dataProducer));case"REMOVE_DATA_PRODUCER":var dataProducerId=action.payload.dataProducerId,newState=_objectSpread({},state);return delete newState[dataProducerId],newState;default:return state}};exports.default=_default},{"@babel/runtime/helpers/defineProperty":41,"@babel/runtime/helpers/interopRequireDefault":45}],25:[function(require,module,exports){"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _redux=require("redux"),_room=_interopRequireDefault(require("./room")),_me=_interopRequireDefault(require("./me")),_producers=_interopRequireDefault(require("./producers")),_dataProducers=_interopRequireDefault(require("./dataProducers")),_peers=_interopRequireDefault(require("./peers")),_consumers=_interopRequireDefault(require("./consumers")),_dataConsumers=_interopRequireDefault(require("./dataConsumers")),_notifications=_interopRequireDefault(require("./notifications")),reducers,_default=(0,_redux.combineReducers)({room:_room.default,me:_me.default,producers:_producers.default,dataProducers:_dataProducers.default,peers:_peers.default,consumers:_consumers.default,dataConsumers:_dataConsumers.default,notifications:_notifications.default});exports.default=_default},{"./consumers":22,"./dataConsumers":23,"./dataProducers":24,"./me":26,"./notifications":27,"./peers":28,"./producers":29,"./room":30,"@babel/runtime/helpers/interopRequireDefault":45,redux:485}],26:[function(require,module,exports){"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){(0,_defineProperty2.default)(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}var initialState={id:null,displayName:null,displayNameSet:!1,device:null,canSendMic:!1,canSendWebcam:!1,canChangeWebcam:!1,webcamInProgress:!1,shareInProgress:!1,audioOnly:!1,audioOnlyInProgress:!1,audioMuted:!1,restartIceInProgress:!1},me,_default=function me(){var state=arguments.length>0&&void 0!==arguments[0]?arguments[0]:initialState,action=arguments.length>1?arguments[1]:void 0;switch(action.type){case"SET_ROOM_STATE":var roomState=action.payload.state;return"closed"===roomState?_objectSpread(_objectSpread({},state),{},{webcamInProgress:!1,shareInProgress:!1,audioOnly:!1,audioOnlyInProgress:!1,audioMuted:!1,restartIceInProgress:!1}):state;case"SET_ME":var _action$payload=action.payload,peerId=_action$payload.peerId,displayName=_action$payload.displayName,displayNameSet=_action$payload.displayNameSet,device=_action$payload.device;return _objectSpread(_objectSpread({},state),{},{id:peerId,displayName:displayName,displayNameSet:displayNameSet,device:device});case"SET_MEDIA_CAPABILITIES":var _action$payload2=action.payload,canSendMic=_action$payload2.canSendMic,canSendWebcam=_action$payload2.canSendWebcam;return _objectSpread(_objectSpread({},state),{},{canSendMic:canSendMic,canSendWebcam:canSendWebcam});case"SET_CAN_CHANGE_WEBCAM":var canChangeWebcam=action.payload;return _objectSpread(_objectSpread({},state),{},{canChangeWebcam:canChangeWebcam});case"SET_WEBCAM_IN_PROGRESS":var flag=action.payload.flag;return _objectSpread(_objectSpread({},state),{},{webcamInProgress:flag});case"SET_SHARE_IN_PROGRESS":var _flag=action.payload.flag;return _objectSpread(_objectSpread({},state),{},{shareInProgress:_flag});case"SET_DISPLAY_NAME":var _displayName=action.payload.displayName;return _displayName||(_displayName=state.displayName),_objectSpread(_objectSpread({},state),{},{displayName:_displayName,displayNameSet:!0});case"SET_AUDIO_ONLY_STATE":var enabled=action.payload.enabled;return _objectSpread(_objectSpread({},state),{},{audioOnly:enabled});case"SET_AUDIO_ONLY_IN_PROGRESS":var _flag2=action.payload.flag;return _objectSpread(_objectSpread({},state),{},{audioOnlyInProgress:_flag2});case"SET_AUDIO_MUTED_STATE":var _enabled=action.payload.enabled;return _objectSpread(_objectSpread({},state),{},{audioMuted:_enabled});case"SET_RESTART_ICE_IN_PROGRESS":var _flag3=action.payload.flag;return _objectSpread(_objectSpread({},state),{},{restartIceInProgress:_flag3});default:return state}};exports.default=_default},{"@babel/runtime/helpers/defineProperty":41,"@babel/runtime/helpers/interopRequireDefault":45}],27:[function(require,module,exports){"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _toConsumableArray2=_interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray")),initialState=[],notifications,_default=function notifications(){var state=arguments.length>0&&void 0!==arguments[0]?arguments[0]:initialState,action=arguments.length>1?arguments[1]:void 0;switch(action.type){case"ADD_NOTIFICATION":var notification=action.payload.notification;return[].concat((0,_toConsumableArray2.default)(state),[notification]);case"REMOVE_NOTIFICATION":var notificationId=action.payload.notificationId;return state.filter((function(notification){return notification.id!==notificationId}));case"REMOVE_ALL_NOTIFICATIONS":return[];default:return state}};exports.default=_default},{"@babel/runtime/helpers/interopRequireDefault":45,"@babel/runtime/helpers/toConsumableArray":53}],28:[function(require,module,exports){"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _toConsumableArray2=_interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray")),_defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){(0,_defineProperty2.default)(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}var initialState={},nummm="522",peers,_default=function peers(){var state=arguments.length>0&&void 0!==arguments[0]?arguments[0]:initialState,action=arguments.length>1?arguments[1]:void 0;switch(action.type){case"CHANGEMY_PEER":return _objectSpread({},state);case"SET_ROOM_STATE":var roomState=action.payload.state;return"closed"===roomState?{}:state;case"ADD_PEER":var peer=action.payload.peer;return state[peer.id]=peer,state;case"REMOVE_PEER":var peerId=action.payload.peerId,newState=_objectSpread({},state);return delete newState[peerId],delete newState["screen_"+peerId],newState;case"SET_PEER_DISPLAY_NAME":var _action$payload=action.payload,displayName=_action$payload.displayName,_peerId=_action$payload.peerId,_peer=state[_peerId];if(!_peer)throw new Error("no Peer found");var newPeer=_objectSpread(_objectSpread({},_peer),{},{displayName:displayName});return _objectSpread(_objectSpread({},state),{},(0,_defineProperty2.default)({},newPeer.id,newPeer));case"ADD_CONSUMER":console.warn("ADD_CONSUMER222----------"),console.log(action.payload);var _action$payload2=action.payload,consumer=_action$payload2.consumer,_peerId2=_action$payload2.peerId,screen=_action$payload2.screen;console.warn(consumer);var _peer2=state[_peerId2];if(console.log(_peer2),console.log(screen),!_peer2)throw new Error("no Peer found for new Consumer");var newConsumers=[].concat((0,_toConsumableArray2.default)(_peer2.consumers),[consumer.id]),_newPeer;return screen||(_newPeer=_objectSpread(_objectSpread({},_peer2),{},{consumers:newConsumers})),console.warn(newConsumers),screen&&((_newPeer=_objectSpread(_objectSpread({},_peer2),{},{consumers:[consumer.id]})).id="screen_"+_newPeer.id),console.log(_newPeer),_objectSpread(_objectSpread({},state),{},(0,_defineProperty2.default)({},_newPeer.id,_newPeer));case"REMOVE_CONSUMER":console.log(" remove consumer ---------------------------------");var _action$payload3=action.payload,consumerId=_action$payload3.consumerId,_peerId3=_action$payload3.peerId,_screen=_action$payload3.screen;if(console.log(_screen),console.log(consumerId),console.log("522"),_screen){_peerId3="screen_"+_peerId3;var _newState=_objectSpread({},state);return delete _newState[_peerId3],_newState}var _peer3=state[_peerId3];if(console.log(_peer3),!_peer3)return state;var idx=_peer3.consumers.indexOf(consumerId);if(-1===idx)throw new Error("Consumer not found");var _newConsumers=_peer3.consumers.slice();console.log(" remove consumer ---------------------------------"),console.log(_newConsumers),_newConsumers.splice(idx,1),console.log(_newConsumers);var _newPeer2=_objectSpread(_objectSpread({},_peer3),{},{consumers:_newConsumers});return _screen&&delete state[_peerId3],_objectSpread(_objectSpread({},state),{},(0,_defineProperty2.default)({},_newPeer2.id,_newPeer2));case"ADD_DATA_CONSUMER":var _action$payload4=action.payload,dataConsumer=_action$payload4.dataConsumer,_peerId4=_action$payload4.peerId;if(!_peerId4)return state;var _peer4=state[_peerId4];if(!_peer4)throw new Error("no Peer found for new DataConsumer");var newDataConsumers=[].concat((0,_toConsumableArray2.default)(_peer4.dataConsumers),[dataConsumer.id]),_newPeer3=_objectSpread(_objectSpread({},_peer4),{},{dataConsumers:newDataConsumers});return _objectSpread(_objectSpread({},state),{},(0,_defineProperty2.default)({},_newPeer3.id,_newPeer3));case"REMOVE_DATA_CONSUMER":var _action$payload5=action.payload,dataConsumerId=_action$payload5.dataConsumerId,_peerId5=_action$payload5.peerId;if(!_peerId5)return state;var _peer5=state[_peerId5];if(!_peer5)return state;var _idx=_peer5.dataConsumers.indexOf(dataConsumerId);if(-1===_idx)throw new Error("DataConsumer not found");var _newDataConsumers=_peer5.dataConsumers.slice();_newDataConsumers.splice(_idx,1);var _newPeer4=_objectSpread(_objectSpread({},_peer5),{},{dataConsumers:_newDataConsumers});return _objectSpread(_objectSpread({},state),{},(0,_defineProperty2.default)({},_newPeer4.id,_newPeer4));default:return state}};exports.default=_default},{"@babel/runtime/helpers/defineProperty":41,"@babel/runtime/helpers/interopRequireDefault":45,"@babel/runtime/helpers/toConsumableArray":53}],29:[function(require,module,exports){"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){(0,_defineProperty2.default)(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}var initialState={},producers,_default=function producers(){var state=arguments.length>0&&void 0!==arguments[0]?arguments[0]:initialState,action=arguments.length>1?arguments[1]:void 0;switch(action.type){case"SET_ROOM_STATE":var roomState=action.payload.state;return"closed"===roomState?{}:state;case"ADD_PRODUCER":var producer=action.payload.producer,type=producer.type;console.log(type);var id=producer.id;return"share"==type&&console.log(type+" share"),_objectSpread(_objectSpread({},state),{},(0,_defineProperty2.default)({},producer.id,producer));case"REMOVE_PRODUCER":var producerId=action.payload.producerId,newState=_objectSpread({},state);return delete newState[producerId],newState;case"SET_PRODUCER_PAUSED":var _producerId=action.payload.producerId,_producer=state[_producerId],newProducer=_objectSpread(_objectSpread({},_producer),{},{paused:!0});return _objectSpread(_objectSpread({},state),{},(0,_defineProperty2.default)({},_producerId,newProducer));case"SET_PRODUCER_RESUMED":var _producerId2=action.payload.producerId,_producer2=state[_producerId2],_newProducer=_objectSpread(_objectSpread({},_producer2),{},{paused:!1});return _objectSpread(_objectSpread({},state),{},(0,_defineProperty2.default)({},_producerId2,_newProducer));case"SET_PRODUCER_TRACK":var _action$payload=action.payload,_producerId3=_action$payload.producerId,track=_action$payload.track,_producer3=state[_producerId3],_newProducer2=_objectSpread(_objectSpread({},_producer3),{},{track:track});return _objectSpread(_objectSpread({},state),{},(0,_defineProperty2.default)({},_producerId3,_newProducer2));case"SET_PRODUCER_SCORE":var _action$payload2=action.payload,_producerId4=_action$payload2.producerId,score=_action$payload2.score,_producer4=state[_producerId4];if(!_producer4)return state;var _newProducer3=_objectSpread(_objectSpread({},_producer4),{},{score:score});return _objectSpread(_objectSpread({},state),{},(0,_defineProperty2.default)({},_producerId4,_newProducer3));default:return state}};exports.default=_default},{"@babel/runtime/helpers/defineProperty":41,"@babel/runtime/helpers/interopRequireDefault":45}],30:[function(require,module,exports){"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){(0,_defineProperty2.default)(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}var initialState={url:null,state:"new",activeSpeakerId:null,statsPeerId:null,faceDetection:!1},room,_default=function room(){var state=arguments.length>0&&void 0!==arguments[0]?arguments[0]:initialState,action=arguments.length>1?arguments[1]:void 0;switch(action.type){case"SET_ROOM_URL":var url=action.payload.url;return _objectSpread(_objectSpread({},state),{},{url:url});case"SET_ROOM_STATE":var roomState=action.payload.state;return _objectSpread(_objectSpread({},state),{},"connected"===roomState?{state:roomState}:{state:roomState,activeSpeakerId:null,statsPeerId:null});case"SET_ROOM_ACTIVE_SPEAKER":var peerId=action.payload.peerId;return _objectSpread(_objectSpread({},state),{},{activeSpeakerId:peerId});case"SET_ROOM_STATS_PEER_ID":var _peerId=action.payload.peerId;return state.statsPeerId===_peerId?_objectSpread(_objectSpread({},state),{},{statsPeerId:null}):_objectSpread(_objectSpread({},state),{},{statsPeerId:_peerId});case"SET_FACE_DETECTION":var flag=action.payload;return _objectSpread(_objectSpread({},state),{},{faceDetection:flag});case"REMOVE_PEER":var _peerId2=action.payload.peerId,newState=_objectSpread({},state);return _peerId2&&_peerId2===state.activeSpeakerId&&(newState.activeSpeakerId=null),_peerId2&&_peerId2===state.statsPeerId&&(newState.statsPeerId=null),newState;default:return state}};exports.default=_default},{"@babel/runtime/helpers/defineProperty":41,"@babel/runtime/helpers/interopRequireDefault":45}],31:[function(require,module,exports){"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_typeof=require("@babel/runtime/helpers/typeof");Object.defineProperty(exports,"__esModule",{value:!0}),exports.notify=void 0;var _randomString=_interopRequireDefault(require("random-string")),stateActions=_interopRequireWildcard(require("./stateActions"));function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function _getRequireWildcardCache(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}var notify=function notify(_ref){var _ref$type=_ref.type,type=void 0===_ref$type?"info":_ref$type,text=_ref.text,title=_ref.title,timeout=_ref.timeout;if(!timeout)switch(type){case"info":timeout=3e3;break;case"error":timeout=5e3}var notification={id:(0,_randomString.default)({length:6}).toLowerCase(),type:type,title:title,text:text,timeout:timeout};return function(dispatch){dispatch(stateActions.addNotification(notification)),setTimeout((function(){dispatch(stateActions.removeNotification(notification.id))}),timeout)}};exports.notify=notify},{"./stateActions":32,"@babel/runtime/helpers/interopRequireDefault":45,"@babel/runtime/helpers/typeof":54,"random-string":437}],32:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.CHANGEMYPEER=exports.removeAllNotifications=exports.removeNotification=exports.addNotification=exports.removeDataConsumer=exports.addDataConsumer=exports.setConsumerScore=exports.setConsumerTrack=exports.setConsumerPriority=exports.setConsumerPreferredLayers=exports.setConsumerCurrentLayers=exports.setConsumerResumed=exports.setConsumerPaused=exports.removeConsumer=exports.addConsumer=exports.setPeerDisplayName=exports.removePeer=exports.addPeer=exports.setShareInProgress=exports.setWebcamInProgress=exports.removeDataProducer=exports.addDataProducer=exports.setProducerScore=exports.setProducerTrack=exports.setProducerResumed=exports.setProducerPaused=exports.removeProducer=exports.addProducer=exports.setRestartIceInProgress=exports.setAudioMutedState=exports.setAudioOnlyInProgress=exports.setAudioOnlyState=exports.setDisplayName=exports.setCanChangeWebcam=exports.setMediaCapabilities=exports.setMe=exports.setRoomFaceDetection=exports.setRoomStatsPeerId=exports.setRoomActiveSpeaker=exports.setRoomState=exports.setRoomUrl=void 0;var setRoomUrl=function setRoomUrl(url){return{type:"SET_ROOM_URL",payload:{url:url}}};exports.setRoomUrl=setRoomUrl;var setRoomState=function setRoomState(state){return{type:"SET_ROOM_STATE",payload:{state:state}}};exports.setRoomState=setRoomState;var setRoomActiveSpeaker=function setRoomActiveSpeaker(peerId){return{type:"SET_ROOM_ACTIVE_SPEAKER",payload:{peerId:peerId}}};exports.setRoomActiveSpeaker=setRoomActiveSpeaker;var setRoomStatsPeerId=function setRoomStatsPeerId(peerId){return{type:"SET_ROOM_STATS_PEER_ID",payload:{peerId:peerId}}};exports.setRoomStatsPeerId=setRoomStatsPeerId;var setRoomFaceDetection=function setRoomFaceDetection(flag){return{type:"SET_FACE_DETECTION",payload:flag}};exports.setRoomFaceDetection=setRoomFaceDetection;var setMe=function setMe(_ref){var peerId,displayName,displayNameSet,device;return{type:"SET_ME",payload:{peerId:_ref.peerId,displayName:_ref.displayName,displayNameSet:_ref.displayNameSet,device:_ref.device}}};exports.setMe=setMe;var setMediaCapabilities=function setMediaCapabilities(_ref2){var canSendMic,canSendWebcam;return{type:"SET_MEDIA_CAPABILITIES",payload:{canSendMic:_ref2.canSendMic,canSendWebcam:_ref2.canSendWebcam}}};exports.setMediaCapabilities=setMediaCapabilities;var setCanChangeWebcam=function setCanChangeWebcam(flag){return{type:"SET_CAN_CHANGE_WEBCAM",payload:flag}};exports.setCanChangeWebcam=setCanChangeWebcam;var setDisplayName=function setDisplayName(displayName){return{type:"SET_DISPLAY_NAME",payload:{displayName:displayName}}};exports.setDisplayName=setDisplayName;var setAudioOnlyState=function setAudioOnlyState(enabled){return{type:"SET_AUDIO_ONLY_STATE",payload:{enabled:enabled}}};exports.setAudioOnlyState=setAudioOnlyState;var setAudioOnlyInProgress=function setAudioOnlyInProgress(flag){return{type:"SET_AUDIO_ONLY_IN_PROGRESS",payload:{flag:flag}}};exports.setAudioOnlyInProgress=setAudioOnlyInProgress;var setAudioMutedState=function setAudioMutedState(enabled){return{type:"SET_AUDIO_MUTED_STATE",payload:{enabled:enabled}}};exports.setAudioMutedState=setAudioMutedState;var setRestartIceInProgress=function setRestartIceInProgress(flag){return{type:"SET_RESTART_ICE_IN_PROGRESS",payload:{flag:flag}}};exports.setRestartIceInProgress=setRestartIceInProgress;var addProducer=function addProducer(producer){return{type:"ADD_PRODUCER",payload:{producer:producer}}};exports.addProducer=addProducer;var removeProducer=function removeProducer(producerId){return{type:"REMOVE_PRODUCER",payload:{producerId:producerId}}};exports.removeProducer=removeProducer;var setProducerPaused=function setProducerPaused(producerId){return{type:"SET_PRODUCER_PAUSED",payload:{producerId:producerId}}};exports.setProducerPaused=setProducerPaused;var setProducerResumed=function setProducerResumed(producerId){return{type:"SET_PRODUCER_RESUMED",payload:{producerId:producerId}}};exports.setProducerResumed=setProducerResumed;var setProducerTrack=function setProducerTrack(producerId,track){return{type:"SET_PRODUCER_TRACK",payload:{producerId:producerId,track:track}}};exports.setProducerTrack=setProducerTrack;var setProducerScore=function setProducerScore(producerId,score){return{type:"SET_PRODUCER_SCORE",payload:{producerId:producerId,score:score}}};exports.setProducerScore=setProducerScore;var addDataProducer=function addDataProducer(dataProducer){return{type:"ADD_DATA_PRODUCER",payload:{dataProducer:dataProducer}}};exports.addDataProducer=addDataProducer;var removeDataProducer=function removeDataProducer(dataProducerId){return{type:"REMOVE_DATA_PRODUCER",payload:{dataProducerId:dataProducerId}}};exports.removeDataProducer=removeDataProducer;var setWebcamInProgress=function setWebcamInProgress(flag){return{type:"SET_WEBCAM_IN_PROGRESS",payload:{flag:flag}}};exports.setWebcamInProgress=setWebcamInProgress;var setShareInProgress=function setShareInProgress(flag){return{type:"SET_SHARE_IN_PROGRESS",payload:{flag:flag}}};exports.setShareInProgress=setShareInProgress;var addPeer=function addPeer(peer){return{type:"ADD_PEER",payload:{peer:peer}}};exports.addPeer=addPeer;var removePeer=function removePeer(peerId){return{type:"REMOVE_PEER",payload:{peerId:peerId}}};exports.removePeer=removePeer;var setPeerDisplayName=function setPeerDisplayName(displayName,peerId){return{type:"SET_PEER_DISPLAY_NAME",payload:{displayName:displayName,peerId:peerId}}};exports.setPeerDisplayName=setPeerDisplayName;var addConsumer=function addConsumer(consumer,peerId,screen){return{type:"ADD_CONSUMER",payload:{consumer:consumer,peerId:peerId,screen:screen}}};exports.addConsumer=addConsumer;var removeConsumer=function removeConsumer(consumerId,peerId,screen){return{type:"REMOVE_CONSUMER",payload:{consumerId:consumerId,peerId:peerId,screen:screen}}};exports.removeConsumer=removeConsumer;var setConsumerPaused=function setConsumerPaused(consumerId,originator){return{type:"SET_CONSUMER_PAUSED",payload:{consumerId:consumerId,originator:originator}}};exports.setConsumerPaused=setConsumerPaused;var setConsumerResumed=function setConsumerResumed(consumerId,originator){return{type:"SET_CONSUMER_RESUMED",payload:{consumerId:consumerId,originator:originator}}};exports.setConsumerResumed=setConsumerResumed;var setConsumerCurrentLayers=function setConsumerCurrentLayers(consumerId,spatialLayer,temporalLayer){return{type:"SET_CONSUMER_CURRENT_LAYERS",payload:{consumerId:consumerId,spatialLayer:spatialLayer,temporalLayer:temporalLayer}}};exports.setConsumerCurrentLayers=setConsumerCurrentLayers;var setConsumerPreferredLayers=function setConsumerPreferredLayers(consumerId,spatialLayer,temporalLayer){return{type:"SET_CONSUMER_PREFERRED_LAYERS",payload:{consumerId:consumerId,spatialLayer:spatialLayer,temporalLayer:temporalLayer}}};exports.setConsumerPreferredLayers=setConsumerPreferredLayers;var setConsumerPriority=function setConsumerPriority(consumerId,priority){return{type:"SET_CONSUMER_PRIORITY",payload:{consumerId:consumerId,priority:priority}}};exports.setConsumerPriority=setConsumerPriority;var setConsumerTrack=function setConsumerTrack(consumerId,track){return{type:"SET_CONSUMER_TRACK",payload:{consumerId:consumerId,track:track}}};exports.setConsumerTrack=setConsumerTrack;var setConsumerScore=function setConsumerScore(consumerId,score){return{type:"SET_CONSUMER_SCORE",payload:{consumerId:consumerId,score:score}}};exports.setConsumerScore=setConsumerScore;var addDataConsumer=function addDataConsumer(dataConsumer,peerId){return{type:"ADD_DATA_CONSUMER",payload:{dataConsumer:dataConsumer,peerId:peerId}}};exports.addDataConsumer=addDataConsumer;var removeDataConsumer=function removeDataConsumer(dataConsumerId,peerId){return{type:"REMOVE_DATA_CONSUMER",payload:{dataConsumerId:dataConsumerId,peerId:peerId}}};exports.removeDataConsumer=removeDataConsumer;var addNotification=function addNotification(notification){return{type:"ADD_NOTIFICATION",payload:{notification:notification}}};exports.addNotification=addNotification;var removeNotification=function removeNotification(notificationId){return{type:"REMOVE_NOTIFICATION",payload:{notificationId:notificationId}}};exports.removeNotification=removeNotification;var removeAllNotifications=function removeAllNotifications(){return{type:"REMOVE_ALL_NOTIFICATIONS"}};exports.removeAllNotifications=removeAllNotifications;var CHANGEMYPEER=function CHANGEMYPEER(){return{type:"CHANGEMY_PEER"}};exports.CHANGEMYPEER=CHANGEMYPEER},{}],33:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getProtooUrl=getProtooUrl;var protooPort=4443;function getProtooUrl(_ref){var roomId=_ref.roomId,peerId=_ref.peerId,hostname=window.location.hostname;return"".concat(board.mediaServer,"/?roomId=").concat(roomId,"&peerId=").concat(peerId)}"test.mediasoup.org"===window.location.hostname&&(protooPort=4444)},{}],34:[function(require,module,exports){"use strict";var mediaQueryDetectorElem;function initialize(){return mediaQueryDetectorElem=document.getElementById("mediasoup-demo-app-media-query-detector"),Promise.resolve()}function isDesktop(){return Boolean(mediaQueryDetectorElem.offsetParent)}function isMobile(){return!mediaQueryDetectorElem.offsetParent}Object.defineProperty(exports,"__esModule",{value:!0}),exports.initialize=initialize,exports.isDesktop=isDesktop,exports.isMobile=isMobile},{}],35:[function(require,module,exports){function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}module.exports=_arrayLikeToArray,module.exports.default=module.exports,module.exports.__esModule=!0},{}],36:[function(require,module,exports){var arrayLikeToArray=require("./arrayLikeToArray.js");function _arrayWithoutHoles(arr){if(Array.isArray(arr))return arrayLikeToArray(arr)}module.exports=_arrayWithoutHoles,module.exports.default=module.exports,module.exports.__esModule=!0},{"./arrayLikeToArray.js":35}],37:[function(require,module,exports){function _assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}module.exports=_assertThisInitialized,module.exports.default=module.exports,module.exports.__esModule=!0},{}],38:[function(require,module,exports){function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}module.exports=_asyncToGenerator,module.exports.default=module.exports,module.exports.__esModule=!0},{}],39:[function(require,module,exports){function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}module.exports=_classCallCheck,module.exports.default=module.exports,module.exports.__esModule=!0},{}],40:[function(require,module,exports){function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}module.exports=_createClass,module.exports.default=module.exports,module.exports.__esModule=!0},{}],41:[function(require,module,exports){function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}module.exports=_defineProperty,module.exports.default=module.exports,module.exports.__esModule=!0},{}],42:[function(require,module,exports){function _extends(){return module.exports=_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},module.exports.default=module.exports,module.exports.__esModule=!0,_extends.apply(this,arguments)}module.exports=_extends,module.exports.default=module.exports,module.exports.__esModule=!0},{}],43:[function(require,module,exports){function _getPrototypeOf(o){return module.exports=_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)},module.exports.default=module.exports,module.exports.__esModule=!0,_getPrototypeOf(o)}module.exports=_getPrototypeOf,module.exports.default=module.exports,module.exports.__esModule=!0},{}],44:[function(require,module,exports){var setPrototypeOf=require("./setPrototypeOf.js");function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&setPrototypeOf(subClass,superClass)}module.exports=_inherits,module.exports.default=module.exports,module.exports.__esModule=!0},{"./setPrototypeOf.js":52}],45:[function(require,module,exports){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}module.exports=_interopRequireDefault,module.exports.default=module.exports,module.exports.__esModule=!0},{}],46:[function(require,module,exports){var _typeof=require("@babel/runtime/helpers/typeof").default;function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function _getRequireWildcardCache(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}module.exports=_interopRequireWildcard,module.exports.default=module.exports,module.exports.__esModule=!0},{"@babel/runtime/helpers/typeof":54}],47:[function(require,module,exports){function _iterableToArray(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}module.exports=_iterableToArray,module.exports.default=module.exports,module.exports.__esModule=!0},{}],48:[function(require,module,exports){function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}module.exports=_nonIterableSpread,module.exports.default=module.exports,module.exports.__esModule=!0},{}],49:[function(require,module,exports){var defineProperty=require("./defineProperty.js");function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread2(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}module.exports=_objectSpread2,module.exports.default=module.exports,module.exports.__esModule=!0},{"./defineProperty.js":41}],50:[function(require,module,exports){function _objectWithoutPropertiesLoose(source,excluded){if(null==source)return{};var target={},sourceKeys=Object.keys(source),key,i;for(i=0;i<sourceKeys.length;i++)key=sourceKeys[i],excluded.indexOf(key)>=0||(target[key]=source[key]);return target}module.exports=_objectWithoutPropertiesLoose,module.exports.default=module.exports,module.exports.__esModule=!0},{}],51:[function(require,module,exports){var _typeof=require("@babel/runtime/helpers/typeof").default,assertThisInitialized=require("./assertThisInitialized.js");function _possibleConstructorReturn(self,call){return!call||"object"!==_typeof(call)&&"function"!=typeof call?assertThisInitialized(self):call}module.exports=_possibleConstructorReturn,module.exports.default=module.exports,module.exports.__esModule=!0},{"./assertThisInitialized.js":37,"@babel/runtime/helpers/typeof":54}],52:[function(require,module,exports){function _setPrototypeOf(o,p){return module.exports=_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o},module.exports.default=module.exports,module.exports.__esModule=!0,_setPrototypeOf(o,p)}module.exports=_setPrototypeOf,module.exports.default=module.exports,module.exports.__esModule=!0},{}],53:[function(require,module,exports){var arrayWithoutHoles=require("./arrayWithoutHoles.js"),iterableToArray=require("./iterableToArray.js"),unsupportedIterableToArray=require("./unsupportedIterableToArray.js"),nonIterableSpread=require("./nonIterableSpread.js");function _toConsumableArray(arr){return arrayWithoutHoles(arr)||iterableToArray(arr)||unsupportedIterableToArray(arr)||nonIterableSpread()}module.exports=_toConsumableArray,module.exports.default=module.exports,module.exports.__esModule=!0},{"./arrayWithoutHoles.js":36,"./iterableToArray.js":47,"./nonIterableSpread.js":48,"./unsupportedIterableToArray.js":55}],54:[function(require,module,exports){function _typeof(obj){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?(module.exports=_typeof=function _typeof(obj){return typeof obj},module.exports.default=module.exports,module.exports.__esModule=!0):(module.exports=_typeof=function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},module.exports.default=module.exports,module.exports.__esModule=!0),_typeof(obj)}module.exports=_typeof,module.exports.default=module.exports,module.exports.__esModule=!0},{}],55:[function(require,module,exports){var arrayLikeToArray=require("./arrayLikeToArray.js");function _unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?arrayLikeToArray(o,minLen):void 0}}module.exports=_unsupportedIterableToArray,module.exports.default=module.exports,module.exports.__esModule=!0},{"./arrayLikeToArray.js":35}],56:[function(require,module,exports){module.exports=require("regenerator-runtime")},{"regenerator-runtime":486}],57:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0}),exports.EPSILON_FLOAT32=1e-7,exports.EPSILON_FLOAT16=1e-4;var DataStorage=function(){function DataStorage(backend,dataMover){this.backend=backend,this.dataMover=dataMover,this.data=new WeakMap}return DataStorage.prototype.get=function(dataId){return this.data.has(dataId)||this.dataMover.moveData(this.backend,dataId),this.data.get(dataId)},DataStorage.prototype.set=function(dataId,value){this.data.set(dataId,value)},DataStorage.prototype.has=function(dataId){return this.data.has(dataId)},DataStorage.prototype.delete=function(dataId){return this.data.delete(dataId)},DataStorage}();exports.DataStorage=DataStorage;var KernelBackend=function(){function KernelBackend(){}return KernelBackend.prototype.time=function(f){throw new Error("Not yet implemented.")},KernelBackend.prototype.read=function(dataId){throw new Error("Not yet implemented.")},KernelBackend.prototype.readSync=function(dataId){throw new Error("Not yet implemented.")},KernelBackend.prototype.disposeData=function(dataId){throw new Error("Not yet implemented.")},KernelBackend.prototype.write=function(dataId,values){throw new Error("Not yet implemented.")},KernelBackend.prototype.fromPixels=function(pixels,numChannels){throw new Error("Not yet implemented.")},KernelBackend.prototype.register=function(dataId,shape,dtype){throw new Error("Not yet implemented.")},KernelBackend.prototype.memory=function(){throw new Error("Not yet implemented.")},KernelBackend.prototype.floatPrecision=function(){throw new Error("Not yet implemented")},KernelBackend.prototype.epsilon=function(){return 32===this.floatPrecision()?exports.EPSILON_FLOAT32:exports.EPSILON_FLOAT16},KernelBackend.prototype.batchMatMul=function(a,b,transposeA,transposeB){throw new Error("Not yet implemented")},KernelBackend.prototype.fusedBatchMatMul=function(_a){var a=_a.a,b=_a.b,transposeA=_a.transposeA,transposeB=_a.transposeB,bias=_a.bias,activation=_a.activation,preluActivationWeights=_a.preluActivationWeights;throw new Error("Not yet implemented")},KernelBackend.prototype.slice=function(x,begin,size){throw new Error("Not yet implemented")},KernelBackend.prototype.stridedSlice=function(x,begin,end,strides){throw new Error("Not yet implemented")},KernelBackend.prototype.unstack=function(x,axis){throw new Error("Not yet implemented")},KernelBackend.prototype.reverse=function(a,axis){throw new Error("Not yet implemented")},KernelBackend.prototype.concat=function(tensors,axis){throw new Error("Not yet implemented")},KernelBackend.prototype.neg=function(a){throw new Error("Not yet implemented")},KernelBackend.prototype.add=function(a,b){throw new Error("Not yet implemented")},KernelBackend.prototype.addN=function(tensors){throw new Error("Not yet implemented")},KernelBackend.prototype.subtract=function(a,b){throw new Error("Not yet implemented")},KernelBackend.prototype.multiply=function(a,b){throw new Error("Not yet implemented")},KernelBackend.prototype.realDivide=function(a,b){throw new Error("Not yet implemented")},KernelBackend.prototype.floorDiv=function(a,b){throw new Error("Not yet implemented")},KernelBackend.prototype.sum=function(x,axes){throw new Error("Not yet implemented")},KernelBackend.prototype.prod=function(x,axes){throw new Error("Not yet implemented")},KernelBackend.prototype.unsortedSegmentSum=function(x,segmentIds,numSegments){throw new Error("Not yet implemented")},KernelBackend.prototype.argMin=function(x,axis){throw new Error("Not yet implemented")},KernelBackend.prototype.argMax=function(x,axis){throw new Error("Not yet implemented")},KernelBackend.prototype.equal=function(a,b){throw new Error("Not yet implemented")},KernelBackend.prototype.notEqual=function(a,b){throw new Error("Not yet implemented")},KernelBackend.prototype.less=function(a,b){throw new Error("Not yet implemented")},KernelBackend.prototype.lessEqual=function(a,b){throw new Error("Not yet implemented")},KernelBackend.prototype.greater=function(a,b){throw new Error("Not yet implemented")},KernelBackend.prototype.greaterEqual=function(a,b){throw new Error("Not yet implemented")},KernelBackend.prototype.logicalNot=function(a){throw new Error("Not yet implemented")},KernelBackend.prototype.logicalAnd=function(a,b){throw new Error("Not yet implemented")},KernelBackend.prototype.logicalOr=function(a,b){throw new Error("Not yet implemented")},KernelBackend.prototype.where=function(condition){throw new Error("Not yet implemented")},KernelBackend.prototype.select=function(condition,a,b){throw new Error("Not yet implemented")},KernelBackend.prototype.topk=function(x,k,sorted){throw new Error("Not yet implemented")},KernelBackend.prototype.min=function(x,axes){throw new Error("Not yet implemented")},KernelBackend.prototype.minimum=function(a,b){throw new Error("Not yet implemented")},KernelBackend.prototype.mod=function(a,b){throw new Error("Not yet implemented")},KernelBackend.prototype.max=function(x,axes){throw new Error("Not yet implemented")},KernelBackend.prototype.maximum=function(a,b){throw new Error("Not yet implemented")},KernelBackend.prototype.all=function(x,axes){throw new Error("Not yet implemented")},KernelBackend.prototype.any=function(x,axes){throw new Error("Not yet implemented")},KernelBackend.prototype.squaredDifference=function(a,b){throw new Error("Not yet implemented")},KernelBackend.prototype.ceil=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.floor=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.round=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.sign=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.isNaN=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.isInf=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.isFinite=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.pow=function(a,b){throw new Error("Not yet implemented")},KernelBackend.prototype.exp=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.expm1=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.log=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.log1p=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.sqrt=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.rsqrt=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.square=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.reciprocal=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.relu=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.prelu=function(x,a){throw new Error("Not yet implemented")},KernelBackend.prototype.elu=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.eluDer=function(dy,y){throw new Error("Not yet implemented")},KernelBackend.prototype.selu=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.int=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.clip=function(x,min,max){throw new Error("Not yet implemented")},KernelBackend.prototype.abs=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.complexAbs=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.sigmoid=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.softplus=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.sin=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.cos=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.tan=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.asin=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.acos=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.atan=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.atan2=function(a,b){throw new Error("Not yet implemented")},KernelBackend.prototype.sinh=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.cosh=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.tanh=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.asinh=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.acosh=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.atanh=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.erf=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.step=function(x,alpha){throw new Error("Not yet implemented")},KernelBackend.prototype.fusedConv2d=function(x,filter,convInfo,bias,activation,preluActivationWeights){throw new Error("Not yet implemented")},KernelBackend.prototype.conv2d=function(x,filter,convInfo){throw new Error("Not yet implemented")},KernelBackend.prototype.conv2dDerInput=function(dy,filter,convInfo){throw new Error("Not yet implemented")},KernelBackend.prototype.conv2dDerFilter=function(x,dY,convInfo){throw new Error("Not yet implemented")},KernelBackend.prototype.depthwiseConv2D=function(input,filter,convInfo){throw new Error("Not yet implemented")},KernelBackend.prototype.depthwiseConv2DDerInput=function(dy,filter,convInfo){throw new Error("Not yet implemented")},KernelBackend.prototype.depthwiseConv2DDerFilter=function(x,dY,convInfo){throw new Error("Not yet implemented")},KernelBackend.prototype.conv3d=function(x,filter,convInfo){throw new Error("Not yet implemented")},KernelBackend.prototype.conv3dDerInput=function(dy,filter,convInfo){throw new Error("Not yet implemented")},KernelBackend.prototype.conv3dDerFilter=function(x,dY,convInfo){throw new Error("Not yet implemented")},KernelBackend.prototype.maxPool=function(x,convInfo){throw new Error("Not yet implemented")},KernelBackend.prototype.maxPoolBackprop=function(dy,x,y,convInfo){throw new Error("Not yet implemented")},KernelBackend.prototype.avgPool=function(x,convInfo){throw new Error("Not yet implemented")},KernelBackend.prototype.avgPoolBackprop=function(dy,x,convInfo){throw new Error("Not yet implemented")},KernelBackend.prototype.avgPool3d=function(x,convInfo){throw new Error("Not yet implemented")},KernelBackend.prototype.avgPool3dBackprop=function(dy,x,convInfo){throw new Error("Not yet implemented")},KernelBackend.prototype.maxPool3d=function(x,convInfo){throw new Error("Not yet implemented")},KernelBackend.prototype.maxPool3dBackprop=function(dy,x,y,convInfo){throw new Error("Not yet implemented")},KernelBackend.prototype.reshape=function(x,shape){throw new Error("Not yet implemented")},KernelBackend.prototype.cast=function(x,dtype){throw new Error("Not yet implemented")},KernelBackend.prototype.tile=function(x,reps){throw new Error("Not yet implemented")},KernelBackend.prototype.pad=function(x,paddings,constantValue){throw new Error("Not yet implemented")},KernelBackend.prototype.transpose=function(x,perm){throw new Error("Not yet implemented")},KernelBackend.prototype.gather=function(x,indices,axis){throw new Error("Not yet implemented")},KernelBackend.prototype.gatherND=function(x,indices){throw new Error("Not yet implemented")},KernelBackend.prototype.scatterND=function(indices,updates,shape){throw new Error("Not yet implemented")},KernelBackend.prototype.batchToSpaceND=function(x,blockShape,crops){throw new Error("Not yet implemented")},KernelBackend.prototype.spaceToBatchND=function(x,blockShape,paddings){throw new Error("Not yet implemented")},KernelBackend.prototype.resizeBilinear=function(x,newHeight,newWidth,alignCorners){throw new Error("Not yet implemented")},KernelBackend.prototype.resizeBilinearBackprop=function(dy,x,alignCorners){throw new Error("Not yet implemented")},KernelBackend.prototype.resizeNearestNeighbor=function(x,newHEight,newWidth,alignCorners){throw new Error("Not yet implemented")},KernelBackend.prototype.resizeNearestNeighborBackprop=function(dy,x,alignCorners){throw new Error("Not yet implemented")},KernelBackend.prototype.batchNormalization=function(x,mean,variance,varianceEpsilon,scale,offset){throw new Error("Not yet implemented")},KernelBackend.prototype.localResponseNormalization4D=function(x,radius,bias,alpha,beta){throw new Error("Not yet implemented")},KernelBackend.prototype.LRNGrad=function(dy,inputImage,outputImage,radius,bias,alpha,beta){throw new Error("Not yet implemented")},KernelBackend.prototype.multinomial=function(logits,normalized,numSamples,seed){throw new Error("Not yet implemented")},KernelBackend.prototype.oneHot=function(indices,depth,onValue,offValue){throw new Error("Not yet implemented")},KernelBackend.prototype.cumsum=function(x,axis,exclusive,reverse){throw new Error("Not yet implemented")},KernelBackend.prototype.nonMaxSuppression=function(boxes,scores,maxOutputSize,iouThreshold,scoreThreshold){throw new Error("Not yet implemented")},KernelBackend.prototype.fft=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.ifft=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.complex=function(real,imag){throw new Error("Not yet implemented")},KernelBackend.prototype.real=function(input){throw new Error("Not yet implemented")},KernelBackend.prototype.imag=function(input){throw new Error("Not yet implemented")},KernelBackend.prototype.cropAndResize=function(image,boxes,boxIndex,cropSize,method,extrapolationValue){throw new Error("Not yet implemented")},KernelBackend.prototype.depthToSpace=function(x,blockSize,dataFormat){throw new Error("Not yet implemented")},KernelBackend.prototype.split=function(value,sizeSplits,axis){throw new Error("Not yet implemented")},KernelBackend.prototype.sparseToDense=function(sparseIndices,sparseValues,outputShape,defaultValue){throw new Error("Not yet implemented")},KernelBackend.prototype.diag=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.fill=function(shape,value,dtype){throw new Error("Not yet implemented.")},KernelBackend.prototype.onesLike=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.zerosLike=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.linspace=function(start,stop,num){throw new Error("Not yet implemented")},KernelBackend.prototype.dispose=function(){throw new Error("Not yet implemented")},KernelBackend}();exports.KernelBackend=KernelBackend},{}],58:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function __export(m){for(var p in m)exports.hasOwnProperty(p)||(exports[p]=m[p])}Object.defineProperty(exports,"__esModule",{value:!0});var tensor_ops_1=require("../ops/tensor_ops"),tensor_1=require("../tensor"),util_1=require("../util");__export(require("../ops/axis_util")),__export(require("../ops/broadcast_util")),__export(require("../ops/concat_util")),__export(require("../ops/conv_util"));var types_1=require("../types");function castTensor(x,dtype,backend){if("complex64"===dtype){if("complex64"===x.dtype)return x.clone();var zerosTensor=tensor_ops_1.zeros(x.shape),floatX=x.toFloat(),result=backend.complex(floatX,zerosTensor);return zerosTensor.dispose(),floatX.dispose(),result}if(!util_1.hasEncodingLoss(x.dtype,dtype))return tensor_1.Tensor.make(x.shape,{dataId:x.dataId},dtype);if("complex64"===x.dtype){var real=backend.real(x),result=real.cast(dtype);return real.dispose(),result}if("int32"===dtype)return backend.int(x);if("bool"===dtype){var zero=tensor_ops_1.scalar(0,x.dtype),result=backend.notEqual(x,zero);return zero.dispose(),result}throw new Error("Error in Cast: failed to cast "+x.dtype+" to "+dtype)}function reshapeTensor(x,shape){return tensor_1.Tensor.make(shape,{dataId:x.dataId},x.dtype)}function linspaceImpl(start,stop,num){var step=(stop-start)/(num-1),values=util_1.makeZerosTypedArray(num,"float32");values[0]=start;for(var i=1;i<values.length;i++)values[i]=values[i-1]+step;return tensor_ops_1.tensor1d(values,"float32")}exports.upcastType=types_1.upcastType,exports.castTensor=castTensor,exports.reshapeTensor=reshapeTensor,exports.linspaceImpl=linspaceImpl},{"../ops/axis_util":172,"../ops/broadcast_util":176,"../ops/concat_util":181,"../ops/conv_util":184,"../ops/tensor_ops":223,"../tensor":241,"../types":247,"../util":248}],59:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mergeRealAndImagArrays(real,imag){if(real.length!==imag.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+real.length+", imag: "+imag.length+".");for(var result=new Float32Array(2*real.length),i=0;i<result.length;i+=2)result[i]=real[i/2],result[i+1]=imag[i/2];return result}function splitRealAndImagArrays(complex){for(var real=new Float32Array(complex.length/2),imag=new Float32Array(complex.length/2),i=0;i<complex.length;i+=2)real[i/2]=complex[i],imag[i/2]=complex[i+1];return{real:real,imag:imag}}function complexWithEvenIndex(complex){for(var len=Math.ceil(complex.length/4),real=new Float32Array(len),imag=new Float32Array(len),i=0;i<complex.length;i+=4)real[Math.floor(i/4)]=complex[i],imag[Math.floor(i/4)]=complex[i+1];return{real:real,imag:imag}}function complexWithOddIndex(complex){for(var len=Math.floor(complex.length/4),real=new Float32Array(len),imag=new Float32Array(len),i=2;i<complex.length;i+=4)real[Math.floor(i/4)]=complex[i],imag[Math.floor(i/4)]=complex[i+1];return{real:real,imag:imag}}function getComplexWithIndex(complex,index){var real,imag;return{real:complex[2*index],imag:complex[2*index+1]}}function assignToTypedArray(data,real,imag,index){data[2*index]=real,data[2*index+1]=imag}function exponents(n,inverse){for(var real=new Float32Array(n/2),imag=new Float32Array(n/2),i=0;i<Math.ceil(n/2);i++){var x=(inverse?2:-2)*Math.PI*(i/n);real[i]=Math.cos(x),imag[i]=Math.sin(x)}return{real:real,imag:imag}}function exponent(k,n,inverse){var x=(inverse?2:-2)*Math.PI*(k/n),real,imag;return{real:Math.cos(x),imag:Math.sin(x)}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.mergeRealAndImagArrays=mergeRealAndImagArrays,exports.splitRealAndImagArrays=splitRealAndImagArrays,exports.complexWithEvenIndex=complexWithEvenIndex,exports.complexWithOddIndex=complexWithOddIndex,exports.getComplexWithIndex=getComplexWithIndex,exports.assignToTypedArray=assignToTypedArray,exports.exponents=exponents,exports.exponent=exponent},{}],60:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2017 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P((function(resolve){resolve(result.value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},__generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}};Object.defineProperty(exports,"__esModule",{value:!0});var seedrandom=require("seedrandom"),engine_1=require("../../engine"),environment_1=require("../../environment"),log_1=require("../../log"),array_ops_util=require("../../ops/array_ops_util"),axis_util=require("../../ops/axis_util"),broadcast_util=require("../../ops/broadcast_util"),complex_ops_1=require("../../ops/complex_ops"),concat_util=require("../../ops/concat_util"),erf_util=require("../../ops/erf_util"),gather_nd_util=require("../../ops/gather_nd_util"),ops=require("../../ops/ops"),ops_1=require("../../ops/ops"),scatter_nd_util=require("../../ops/scatter_nd_util"),selu_util=require("../../ops/selu_util"),slice_util_1=require("../../ops/slice_util"),tensor_1=require("../../tensor"),types_1=require("../../types"),util=require("../../util"),util_1=require("../../util"),backend_1=require("../backend"),backend_util=require("../backend_util"),complex_util=require("../complex_util"),non_max_suppression_impl_1=require("../non_max_suppression_impl"),split_shared_1=require("../split_shared"),tile_impl_1=require("../tile_impl"),topk_impl_1=require("../topk_impl"),where_impl_1=require("../where_impl");function mapActivation(backend,x,activation,preluActivationWeights){if("linear"===activation)return backend.linear(x);if("relu"===activation)return backend.relu(x);if("elu"===activation)return backend.elu(x);if("prelu"===activation)return backend.prelu(x,preluActivationWeights);throw new Error("Activation "+activation+" has not been implemented for the CPU backend.")}function createCanvas(){return"undefined"!=typeof OffscreenCanvas?new OffscreenCanvas(300,150):"undefined"!=typeof document?document.createElement("canvas"):null}var MathBackendCPU=function(){function MathBackendCPU(){if(this.blockSize=48,this.firstUse=!0,environment_1.ENV.get("IS_BROWSER")){var canvas=createCanvas();null!==canvas&&(this.fromPixels2DContext=canvas.getContext("2d"))}this.data=new backend_1.DataStorage(this,engine_1.ENGINE)}return MathBackendCPU.prototype.register=function(dataId,shape,dtype){if(this.firstUse&&(this.firstUse=!1,environment_1.ENV.get("IS_NODE")&&log_1.warn("\n============================\nHi there . Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.\n============================\n")),this.data.has(dataId))throw new Error("Data buffer is already registered");this.data.set(dataId,{dtype:dtype})},MathBackendCPU.prototype.write=function(dataId,values){if(null==values)throw new Error("MathBackendCPU.write(): values can not be null");this.data.get(dataId).values=values},MathBackendCPU.prototype.fromPixels=function(pixels,numChannels){if(null==pixels)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var isPixelData=pixels.data instanceof Uint8Array,isImageData="undefined"!=typeof ImageData&&pixels instanceof ImageData,isVideo="undefined"!=typeof HTMLVideoElement&&pixels instanceof HTMLVideoElement,isImage="undefined"!=typeof HTMLImageElement&&pixels instanceof HTMLImageElement,_a=isVideo?[pixels.videoWidth,pixels.videoHeight]:[pixels.width,pixels.height],width=_a[0],height=_a[1],vals,values;if(environment_1.ENV.get("IS_NODE")&&null==pixels.getContext)throw new Error("When running in node, pixels must be an HTMLCanvasElement like the one returned by the `canvas` npm package");if(null!=pixels.getContext)vals=pixels.getContext("2d").getImageData(0,0,width,height).data;else if(isImageData||isPixelData)vals=pixels.data;else{if(!isImage&&!isVideo)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData or {data: Uint32Array, width: number, height: number}, but was "+pixels.constructor.name);if(null==this.fromPixels2DContext)throw new Error("Can't read pixels from HTMLImageElement outside the browser.");this.fromPixels2DContext.canvas.width=width,this.fromPixels2DContext.canvas.height=height,this.fromPixels2DContext.drawImage(pixels,0,0,width,height),vals=this.fromPixels2DContext.getImageData(0,0,width,height).data}if(4===numChannels)values=new Int32Array(vals);else{var numPixels=width*height;values=new Int32Array(numPixels*numChannels);for(var i=0;i<numPixels;i++)for(var channel=0;channel<numChannels;++channel)values[i*numChannels+channel]=vals[4*i+channel]}var outShape=[height,width,numChannels];return ops_1.tensor3d(values,outShape,"int32")},MathBackendCPU.prototype.read=function(dataId){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(_a){return[2,this.readSync(dataId)]}))}))},MathBackendCPU.prototype.readSync=function(dataId){var _a=this.data.get(dataId),dtype=_a.dtype,complexTensors=_a.complexTensors;if("complex64"===dtype){var realValues=this.readSync(complexTensors.real.dataId),imagValues=this.readSync(complexTensors.imag.dataId);return complex_util.mergeRealAndImagArrays(realValues,imagValues)}return this.data.get(dataId).values},MathBackendCPU.prototype.bufferSync=function(t){var data=this.readSync(t.dataId),decodedData=data;if("string"===t.dtype)try{decodedData=data.map((function(d){return util.decodeString(d)}))}catch(_a){throw new Error("Failed to decode encoded string bytes into utf-8")}return ops_1.buffer(t.shape,t.dtype,decodedData)},MathBackendCPU.prototype.disposeData=function(dataId){if(this.data.has(dataId)){var complexTensors=this.data.get(dataId).complexTensors;null!=complexTensors&&(complexTensors.real.dispose(),complexTensors.imag.dispose()),this.data.delete(dataId)}},MathBackendCPU.prototype.time=function(f){return __awaiter(this,void 0,void 0,(function(){var start,kernelMs;return __generator(this,(function(_a){return start=util_1.now(),f(),[2,{kernelMs:kernelMs=util_1.now()-start}]}))}))},MathBackendCPU.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},MathBackendCPU.prototype.complex=function(real,imag){var result=tensor_1.Tensor.make(real.shape,{},"complex64"),resultData;return this.data.get(result.dataId).complexTensors={real:engine_1.ENGINE.keep(real.clone()),imag:engine_1.ENGINE.keep(imag.clone())},result},MathBackendCPU.prototype.real=function(input){var resultData;return this.data.get(input.dataId).complexTensors.real.clone()},MathBackendCPU.prototype.imag=function(input){var resultData;return this.data.get(input.dataId).complexTensors.imag.clone()},MathBackendCPU.prototype.assertNotComplex=function(tensor,opName){Array.isArray(tensor)||(tensor=[tensor]),tensor.forEach((function(t){null!=t&&util.assert("complex64"!==t.dtype,(function(){return opName+" does not support complex64 tensors."}))}))},MathBackendCPU.prototype.slice=function(x,begin,size){var isContinous;if(this.assertNotComplex(x,"slice"),slice_util_1.isSliceContinous(x.shape,begin,size)){var flatOffset=slice_util_1.computeFlatOffset(begin,x.strides),length_1=util.sizeFromShape(size),vals=this.readSync(x.dataId);return ops_1.tensor(vals.subarray(flatOffset,flatOffset+length_1),size,x.dtype)}for(var buffer=ops.buffer(size,x.dtype),xBuf=this.bufferSync(x),i=0;i<buffer.size;++i){var loc,xLoc=buffer.indexToLoc(i).map((function(idx,j){return idx+begin[j]}));buffer.values[i]=xBuf.get.apply(xBuf,xLoc)}return buffer.toTensor()},MathBackendCPU.prototype.stridedSlice=function(x,begin,end,strides){this.assertNotComplex(x,"stridedSlice");var outShape=slice_util_1.computeOutShape(begin,end,strides);if(outShape.some((function(axis){return 0===axis})))return ops.tensor([],outShape);for(var buffer=ops.buffer(outShape,x.dtype),xBuf=this.bufferSync(x),i=0;i<buffer.size;i++){for(var loc=buffer.indexToLoc(i),newLoc=new Array(loc.length),j=0;j<newLoc.length;j++)newLoc[j]=loc[j]*strides[j]+begin[j];buffer.set.apply(buffer,[xBuf.get.apply(xBuf,newLoc)].concat(loc))}return buffer.toTensor()},MathBackendCPU.prototype.diag=function(x){for(var xVals=this.readSync(x.dataId),buffer=ops.buffer([x.size,x.size],x.dtype),vals=buffer.values,i=0;i<xVals.length;i++)vals[i*x.size+i]=xVals[i];return buffer.toTensor()},MathBackendCPU.prototype.unstack=function(x,axis){for(var num=x.shape[axis],outShape=new Array(x.rank-1),outIndex=0,i=0;i<x.rank;i++)i!==axis&&(outShape[outIndex++]=x.shape[i]);var begin=new Array(x.rank).fill(0),size=x.shape.slice();size[axis]=1;for(var res=new Array(num),i=0;i<res.length;i++)begin[axis]=i,res[i]=this.slice(x,begin,size).reshape(outShape);return res},MathBackendCPU.prototype.reverse=function(x,axis){this.assertNotComplex(x,"reverse");for(var buffer=ops.buffer(x.shape,x.dtype),xBuf=this.bufferSync(x),_loop_1=function(i){var outLoc=buffer.indexToLoc(i),inLoc=outLoc.slice();axis.forEach((function(ax){return inLoc[ax]=x.shape[ax]-1-inLoc[ax]})),buffer.set.apply(buffer,[xBuf.get.apply(xBuf,inLoc)].concat(outLoc))},i=0;i<buffer.size;i++)_loop_1(i);return buffer.toTensor()},MathBackendCPU.prototype.concat=function(tensors,axis){var _this=this;if("complex64"===tensors[0].dtype){var reals=tensors.map((function(t){return complex_ops_1.real(t)})),imags=tensors.map((function(t){return complex_ops_1.imag(t)}));return complex_ops_1.complex(this.concat(reals,axis),this.concat(imags,axis))}var tensors2D=tensors.map((function(t){var innerSize=util.sizeFromShape(t.shape.slice(axis));return t.as2D(-1,innerSize)})),outShape=concat_util.computeOutShape(tensors2D.map((function(t){return t.shape})),1),values=ops.buffer(outShape,tensors[0].dtype).values;if(1===tensors2D[0].shape[0]){var offset_1=0;tensors2D.forEach((function(t){values.set(_this.readSync(t.dataId),offset_1),offset_1+=t.size}))}else{var colOffset_1=0;tensors2D.forEach((function(t){for(var tVals=_this.readSync(t.dataId),tIdx=0,row=0;row<t.shape[0];++row)for(var resIdx=row*outShape[1]+colOffset_1,col=0;col<t.shape[1];++col)values[resIdx+col]=tVals[tIdx++];colOffset_1+=t.shape[1]}))}var finalOutShape=concat_util.computeOutShape(tensors.map((function(t){return t.shape})),axis);return ops_1.tensor(values,finalOutShape,tensors[0].dtype)},MathBackendCPU.prototype.neg=function(x){return this.assertNotComplex(x,"neg"),this.multiply(ops.scalar(-1),x)},MathBackendCPU.prototype.add=function(a,b){return"complex64"===a.dtype||"complex64"===b.dtype?this.broadcastedBinaryComplexOp(a.cast("complex64"),b.cast("complex64"),(function(aReal,aImag,bReal,bImag){return{real:aReal+bReal,imag:aImag+bImag}})):this.broadcastedBinaryOp(a,b,types_1.upcastType(a.dtype,b.dtype),(function(aValue,bValue){return aValue+bValue}))},MathBackendCPU.prototype.addN=function(tensors){var _this=this;this.assertNotComplex(tensors,"addN");for(var vals=tensors.map((function(t){return _this.readSync(t.dataId)})),result=ops.buffer(tensors[0].shape,tensors[0].dtype),resultVals=result.values,i=0;i<tensors.length;i++)for(var currVals=vals[i],j=0;j<resultVals.length;j++)resultVals[j]+=currVals[j];return result.toTensor()},MathBackendCPU.prototype.subtract=function(a,b){return"complex64"===a.dtype||"complex64"===b.dtype?this.broadcastedBinaryComplexOp(a.cast("complex64"),b.cast("complex64"),(function(aReal,aImag,bReal,bImag){return{real:aReal-bReal,imag:aImag-bImag}})):this.broadcastedBinaryOp(a,b,types_1.upcastType(a.dtype,b.dtype),(function(aValue,bValue){return aValue-bValue}))},MathBackendCPU.prototype.pow=function(a,b){return this.assertNotComplex([a,b],"pow"),this.broadcastedBinaryOp(a,b,a.dtype,(function(aValue,bValue){return Math.pow(aValue,bValue)}))},MathBackendCPU.prototype.batchMatMul=function(a,b,transposeA,transposeB){this.assertNotComplex([a,b],"matMul");for(var sharedDim=transposeA?a.shape[1]:a.shape[2],leftDim=transposeA?a.shape[2]:a.shape[1],rightDim=transposeB?b.shape[1]:b.shape[2],batchDim=a.shape[0],aValues=this.readSync(a.dataId),bValues=this.readSync(b.dataId),_a=transposeA?[a.strides[0],1,a.strides[1]]:[a.strides[0],a.strides[1],1],aBatch=_a[0],aOuterStep=_a[1],aInnerStep=_a[2],_b=transposeB?[1,b.strides[1],b.strides[0]]:[b.strides[1],1,b.strides[0]],bInnerStep=_b[0],bOuterStep=_b[1],bBatch=_b[2],size=leftDim*rightDim,result=ops_1.buffer([batchDim,leftDim,rightDim],a.dtype),resVals=result.values,blockSize=this.blockSize,b_1=0;b_1<batchDim;b_1++)for(var i0=0;i0<leftDim;i0+=blockSize)for(var j0=0;j0<rightDim;j0+=blockSize)for(var k0=0;k0<sharedDim;k0+=blockSize)for(var iBlock=Math.min(i0+blockSize,leftDim),jBlock=Math.min(j0+blockSize,rightDim),kBlock=Math.min(k0+blockSize,sharedDim),i=i0;i<iBlock;i++)for(var j=j0;j<jBlock;j++){for(var sum=0,k=k0;k<kBlock;k++)sum+=aValues[b_1*aBatch+i*aOuterStep+k*aInnerStep]*bValues[k*bInnerStep+j*bOuterStep+b_1*bBatch];resVals[b_1*size+(i*rightDim+j)]+=sum}return result.toTensor()},MathBackendCPU.prototype.fusedBatchMatMul=function(_a){var a=_a.a,b=_a.b,transposeA=_a.transposeA,transposeB=_a.transposeB,bias=_a.bias,activation=_a.activation,preluActivationWeights=_a.preluActivationWeights,result=this.batchMatMul(a,b,transposeA,transposeB);return bias&&(result=this.add(result,bias)),activation&&(result=mapActivation(this,result,activation,preluActivationWeights)),result},MathBackendCPU.prototype.multiply=function(a,b){return"complex64"===a.dtype||"complex64"===b.dtype?this.broadcastedBinaryComplexOp(a.cast("complex64"),b.cast("complex64"),(function(aReal,aImag,bReal,bImag){return{real:aReal*bReal-aImag*bImag,imag:aReal*bImag+aImag*bReal}})):this.broadcastedBinaryOp(a,b,types_1.upcastType(a.dtype,b.dtype),(function(aValue,bValue){return aValue*bValue}))},MathBackendCPU.prototype.realDivide=function(a,b){this.assertNotComplex([a,b],"realDivide");var op=function(a,b){return a/b},outputDtype="float32";return this.broadcastedBinaryOp(a,b,"float32",op)},MathBackendCPU.prototype.floorDiv=function(a,b){this.assertNotComplex([a,b],"floorDiv");var op=function(a,b){return Math.floor(a/b)},outputDtype="int32";return this.broadcastedBinaryOp(a,b,"int32",op)},MathBackendCPU.prototype.sum=function(x,axes){this.assertNotComplex(x,"sum"),axis_util.assertAxesAreInnerMostDims("sum",axes,x.rank);for(var _a=axis_util.computeOutAndReduceShapes(x.shape,axes),outShape=_a[0],reduceShape=_a[1],resultDtype=types_1.upcastType(x.dtype,"int32"),result=ops.zeros(outShape,resultDtype),reduceSize=util.sizeFromShape(reduceShape),vals=this.readSync(result.dataId),aVals=this.readSync(x.dataId),i=0;i<vals.length;++i){for(var offset=i*reduceSize,sum=0,j=0;j<reduceSize;++j)sum+=aVals[offset+j];vals[i]=sum}return result},MathBackendCPU.prototype.prod=function(x,axes){this.assertNotComplex(x,"sum");for(var _a=axis_util.computeOutAndReduceShapes(x.shape,axes),outShape=_a[0],reduceShape=_a[1],resultDtype=types_1.upcastType(x.dtype,"int32"),result=ops.zeros(outShape,resultDtype),reduceSize=util.sizeFromShape(reduceShape),vals=this.readSync(result.dataId),aVals=this.readSync(x.dataId),i=0;i<vals.length;++i){for(var offset=i*reduceSize,prod=1,j=0;j<reduceSize;++j)prod*=aVals[offset+j];vals[i]=prod}return result},MathBackendCPU.prototype.unsortedSegmentSum=function(x,segmentIds,numSegments){this.assertNotComplex(x,"unsortedSegmentSum");for(var res=[],numIters=x.rank-segmentIds.rank,i=0;i<numIters;++i)segmentIds=segmentIds.expandDims(i+1);for(var i=0;i<numSegments;++i){var segmentId=ops.scalar(i,"int32"),mask,sum=ops.equal(segmentId,segmentIds).asType("float32").mul(x).sum(0);res.push(sum)}return ops.stack(res)},MathBackendCPU.prototype.argMin=function(x,axis){this.assertNotComplex(x,"argMin");var axes=[axis];axis_util.assertAxesAreInnerMostDims("argMin",axes,x.rank);for(var _a=axis_util.computeOutAndReduceShapes(x.shape,axes),outShape=_a[0],reduceShape=_a[1],result=ops.zeros(outShape,"int32"),reduceSize=util.sizeFromShape(reduceShape),vals=this.readSync(result.dataId),aVals=this.readSync(x.dataId),i=0;i<vals.length;++i){for(var offset=i*reduceSize,min=aVals[offset],minIndex=0,j=0;j<reduceSize;++j){var value=aVals[offset+j];value<min&&(min=value,minIndex=j)}vals[i]=minIndex}return result},MathBackendCPU.prototype.argMax=function(x,axis){this.assertNotComplex(x,"argMax");var axes=[axis];axis_util.assertAxesAreInnerMostDims("argMax",axes,x.rank);for(var _a=axis_util.computeOutAndReduceShapes(x.shape,axes),outShape=_a[0],reduceShape=_a[1],result=ops.zeros(outShape,"int32"),reduceSize=util.sizeFromShape(reduceShape),vals=this.readSync(result.dataId),aVals=this.readSync(x.dataId),i=0;i<vals.length;++i){for(var offset=i*reduceSize,max=aVals[offset],maxIndex=0,j=0;j<reduceSize;++j){var value=aVals[offset+j];value>max&&(max=value,maxIndex=j)}vals[i]=maxIndex}return result},MathBackendCPU.prototype.cumsum=function(x,axis,exclusive,reverse){if(this.assertNotComplex(x,"cumsum"),axis!==x.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(x.rank-1)+" but got axis="+axis);for(var resultDtype=types_1.upcastType(x.dtype,"int32"),result=ops.zeros(x.shape,resultDtype),vals=this.readSync(result.dataId),aVals=this.readSync(x.dataId),finalDim=x.shape[x.rank-1],indexAdjuster=reverse?function(i,j){return i+finalDim-j-1}:function(i,j){return i+j},i=0;i<aVals.length;i+=finalDim)for(var j=0;j<finalDim;j++){var idx=indexAdjuster(i,j);if(0===j)vals[idx]=exclusive?0:aVals[idx];else{var prevIdx=indexAdjuster(i,j-1);vals[idx]=exclusive?aVals[prevIdx]+vals[prevIdx]:aVals[idx]+vals[prevIdx]}}return result},MathBackendCPU.prototype.equal=function(a,b){return this.assertNotComplex([a,b],"equal"),this.broadcastedBinaryOp(a,b,"bool",(function(aVal,bVal){return aVal===bVal?1:0}))},MathBackendCPU.prototype.notEqual=function(a,b){return this.assertNotComplex([a,b],"notEqual"),this.broadcastedBinaryOp(a,b,"bool",(function(aVal,bVal){return aVal!==bVal?1:0}))},MathBackendCPU.prototype.less=function(a,b){return this.assertNotComplex([a,b],"less"),this.broadcastedBinaryOp(a,b,"bool",(function(aVal,bVal){return aVal<bVal?1:0}))},MathBackendCPU.prototype.lessEqual=function(a,b){return this.assertNotComplex([a,b],"lessEqual"),this.broadcastedBinaryOp(a,b,"bool",(function(aVal,bVal){return aVal<=bVal?1:0}))},MathBackendCPU.prototype.greater=function(a,b){return this.assertNotComplex([a,b],"greater"),this.broadcastedBinaryOp(a,b,"bool",(function(aVal,bVal){return aVal>bVal?1:0}))},MathBackendCPU.prototype.greaterEqual=function(a,b){return this.assertNotComplex([a,b],"greaterEqual"),this.broadcastedBinaryOp(a,b,"bool",(function(aVal,bVal){return aVal>=bVal?1:0}))},MathBackendCPU.prototype.logicalNot=function(x){this.assertNotComplex(x,"logicalNot");for(var values=this.readSync(x.dataId),newValues=new Uint8Array(values.length),i=0;i<values.length;++i)newValues[i]=values[i]?0:1;return tensor_1.Tensor.make(x.shape,{values:newValues},"bool")},MathBackendCPU.prototype.logicalAnd=function(a,b){return this.assertNotComplex([a,b],"logicalAnd"),this.broadcastedBinaryOp(a,b,"bool",(function(aVal,bVal){return aVal&&bVal}))},MathBackendCPU.prototype.logicalOr=function(a,b){return this.assertNotComplex([a,b],"logicalOr"),this.broadcastedBinaryOp(a,b,"bool",(function(aVal,bVal){return aVal||bVal}))},MathBackendCPU.prototype.select=function(condition,a,b){this.assertNotComplex([condition,a,b],"select");for(var values=this.readSync(condition.dataId),aValues=this.readSync(a.dataId),bValues=this.readSync(b.dataId),result=ops.zeros(a.shape,types_1.upcastType(a.dtype,b.dtype)),newValues=this.readSync(result.dataId),index=0,offset=0===condition.rank||condition.rank>1||1===a.rank?1:a.shape[1],i=0;i<values.length;i++)for(var j=0;j<offset;j++)1===values[i]?newValues[index++]=aValues[i]:newValues[index++]=bValues[i];return result},MathBackendCPU.prototype.where=function(condition){this.assertNotComplex([condition],"where");var condVals=this.readSync(condition.dataId);return where_impl_1.whereImpl(condition.shape,condVals)},MathBackendCPU.prototype.topk=function(x,k,sorted){this.assertNotComplex(x,"topk");var xVals=this.readSync(x.dataId);return topk_impl_1.topkImpl(xVals,x.shape,x.dtype,k,sorted)},MathBackendCPU.prototype.min=function(x,axes){this.assertNotComplex(x,"min"),axis_util.assertAxesAreInnerMostDims("min",axes,x.rank);for(var _a=axis_util.computeOutAndReduceShapes(x.shape,axes),outShape=_a[0],reduceShape=_a[1],result=ops.zeros(outShape,x.dtype),reduceSize=util.sizeFromShape(reduceShape),vals=this.readSync(result.dataId),aVals=this.readSync(x.dataId),i=0;i<vals.length;++i){for(var offset=i*reduceSize,min=aVals[offset],j=0;j<reduceSize;++j){var value=aVals[offset+j];value<min&&(min=value)}vals[i]=min}return result},MathBackendCPU.prototype.minimum=function(a,b){return this.assertNotComplex([a,b],"minimum"),this.broadcastedBinaryOp(a,b,a.dtype,(function(aVal,bVal){return Math.min(aVal,bVal)}))},MathBackendCPU.prototype.mod=function(a,b){return this.assertNotComplex([a,b],"mod"),this.broadcastedBinaryOp(a,b,a.dtype,(function(aVal,bVal){var rem=aVal%bVal;return aVal<0&&bVal<0||aVal>=0&&bVal>=0?rem:(rem+bVal)%bVal}))},MathBackendCPU.prototype.max=function(x,axes){this.assertNotComplex(x,"max"),axis_util.assertAxesAreInnerMostDims("max",axes,x.rank);for(var _a=axis_util.computeOutAndReduceShapes(x.shape,axes),outShape=_a[0],reduceShape=_a[1],result=ops.zeros(outShape,x.dtype),reduceSize=util.sizeFromShape(reduceShape),vals=this.readSync(result.dataId),aVals=this.readSync(x.dataId),i=0;i<vals.length;++i){for(var offset=i*reduceSize,max=aVals[offset],j=0;j<reduceSize;++j){var value=aVals[offset+j];value>max&&(max=value)}vals[i]=max}return result},MathBackendCPU.prototype.maximum=function(a,b){return this.assertNotComplex([a,b],"maximum"),this.broadcastedBinaryOp(a,b,a.dtype,(function(aVal,bVal){return Math.max(aVal,bVal)}))},MathBackendCPU.prototype.all=function(x,axes){this.assertNotComplex(x,"all"),axis_util.assertAxesAreInnerMostDims("all",axes,x.rank);for(var _a=axis_util.computeOutAndReduceShapes(x.shape,axes),outShape=_a[0],reduceShape=_a[1],result=ops.zeros(outShape,x.dtype),reduceSize=util.sizeFromShape(reduceShape),vals=this.readSync(result.dataId),aVals=this.readSync(x.dataId),i=0;i<vals.length;++i){for(var offset=i*reduceSize,all=aVals[offset],j=0;j<reduceSize;++j){var value=aVals[offset+j];all=all&&value}vals[i]=all}return result},MathBackendCPU.prototype.any=function(x,axes){this.assertNotComplex(x,"any"),axis_util.assertAxesAreInnerMostDims("any",axes,x.rank);for(var _a=axis_util.computeOutAndReduceShapes(x.shape,axes),outShape=_a[0],reduceShape=_a[1],result=ops.zeros(outShape,x.dtype),reduceSize=util.sizeFromShape(reduceShape),vals=this.readSync(result.dataId),aVals=this.readSync(x.dataId),i=0;i<vals.length;++i){for(var offset=i*reduceSize,anyVal=aVals[offset],j=0;j<reduceSize;++j){var value=aVals[offset+j];anyVal=anyVal||value}vals[i]=anyVal}return result},MathBackendCPU.prototype.squaredDifference=function(a,b){return this.assertNotComplex([a,b],"squaredDifference"),this.broadcastedBinaryOp(a,b,a.dtype,(function(aVal,bVal){var diff=aVal-bVal;return diff*diff}))},MathBackendCPU.prototype.ceil=function(x){this.assertNotComplex(x,"ceil");for(var values=this.readSync(x.dataId),newValues=new Float32Array(values.length),i=0;i<values.length;++i)newValues[i]=Math.ceil(values[i]);return tensor_1.Tensor.make(x.shape,{values:newValues})},MathBackendCPU.prototype.floor=function(x){this.assertNotComplex(x,"floor");for(var values=this.readSync(x.dataId),newValues=new Float32Array(values.length),i=0;i<values.length;++i)newValues[i]=Math.floor(values[i]);return tensor_1.Tensor.make(x.shape,{values:newValues})},MathBackendCPU.prototype.sign=function(x){this.assertNotComplex(x,"x");for(var values=this.readSync(x.dataId),newValues=new Float32Array(values.length),i=0;i<values.length;++i)values[i]<0?newValues[i]=-1:values[i]>0?newValues[i]=1:newValues[i]=0;return tensor_1.Tensor.make(x.shape,{values:newValues})},MathBackendCPU.prototype.isNaN=function(x){this.assertNotComplex(x,"x");for(var values=this.readSync(x.dataId),newValues=new Uint8Array(values.length),i=0;i<values.length;++i)Number.isNaN(values[i])&&(newValues[i]=1);return tensor_1.Tensor.make(x.shape,{values:newValues},"bool")},MathBackendCPU.prototype.isInf=function(x){this.assertNotComplex(x,"x");for(var values=this.readSync(x.dataId),newValues=new Uint8Array(values.length),i=0;i<values.length;++i)Math.abs(values[i])===1/0&&(newValues[i]=1);return tensor_1.Tensor.make(x.shape,{values:newValues},"bool")},MathBackendCPU.prototype.isFinite=function(x){this.assertNotComplex(x,"x");for(var values=this.readSync(x.dataId),newValues=new Uint8Array(values.length),i=0;i<values.length;++i)Number.isFinite(values[i])&&(newValues[i]=1);return tensor_1.Tensor.make(x.shape,{values:newValues},"bool")},MathBackendCPU.prototype.round=function(x){this.assertNotComplex(x,"round");for(var values=this.readSync(x.dataId),newValues=new Float32Array(values.length),i=0;i<values.length;++i){var base=Math.floor(values[i]);values[i]-base<.5?newValues[i]=Math.floor(values[i]):values[i]-base>.5?newValues[i]=Math.ceil(values[i]):newValues[i]=base%2==0?base:base+1}return tensor_1.Tensor.make(x.shape,{values:newValues})},MathBackendCPU.prototype.exp=function(x){this.assertNotComplex(x,"exp");for(var values=this.readSync(x.dataId),newValues=new Float32Array(values.length),i=0;i<values.length;++i)newValues[i]=Math.exp(values[i]);return tensor_1.Tensor.make(x.shape,{values:newValues})},MathBackendCPU.prototype.expm1=function(x){this.assertNotComplex(x,"expm1");for(var values=this.readSync(x.dataId),newValues=new Float32Array(values.length),i=0;i<values.length;++i)newValues[i]=Math.expm1(values[i]);return tensor_1.Tensor.make(x.shape,{values:newValues})},MathBackendCPU.prototype.log=function(x){this.assertNotComplex(x,"log");for(var values=this.readSync(x.dataId),newValues=new Float32Array(values.length),i=0;i<values.length;++i){var value=values[i];newValues[i]=Math.log(value)}return tensor_1.Tensor.make(x.shape,{values:newValues})},MathBackendCPU.prototype.log1p=function(x){this.assertNotComplex(x,"log1p");for(var values=this.readSync(x.dataId),newValues=new Float32Array(values.length),i=0;i<values.length;++i){var value=values[i];newValues[i]=Math.log1p(value)}return tensor_1.Tensor.make(x.shape,{values:newValues})},MathBackendCPU.prototype.sqrt=function(x){this.assertNotComplex(x,"sqrt");for(var values=this.readSync(x.dataId),newValues=new Float32Array(values.length),i=0;i<values.length;++i){var value=values[i];newValues[i]=Math.sqrt(value)}return tensor_1.Tensor.make(x.shape,{values:newValues})},MathBackendCPU.prototype.rsqrt=function(x){this.assertNotComplex(x,"rsqrt");for(var values=this.readSync(x.dataId),newValues=new Float32Array(values.length),i=0;i<values.length;++i){var value=values[i];newValues[i]=1/Math.sqrt(value)}return tensor_1.Tensor.make(x.shape,{values:newValues})},MathBackendCPU.prototype.square=function(x){this.assertNotComplex(x,"square");for(var values=this.readSync(x.dataId),newValues=new Float32Array(values.length),i=0;i<values.length;++i){var value=values[i];newValues[i]=value*value}return tensor_1.Tensor.make(x.shape,{values:newValues})},MathBackendCPU.prototype.reciprocal=function(x){this.assertNotComplex(x,"reciprocal");for(var values=this.readSync(x.dataId),newValues=new Float32Array(values.length),i=0;i<values.length;++i)newValues[i]=1/values[i];return tensor_1.Tensor.make(x.shape,{values:newValues})},MathBackendCPU.prototype.linear=function(x){return x},MathBackendCPU.prototype.relu=function(x){this.assertNotComplex(x,"relu");for(var res=ops.zeros(x.shape,x.dtype),resVals=this.readSync(res.dataId),inVals=this.readSync(x.dataId),i=0;i<inVals.length;++i)resVals[i]=Math.max(0,inVals[i]);return res},MathBackendCPU.prototype.prelu=function(x,a){return this.assertNotComplex([x,a],"prelu"),this.broadcastedBinaryOp(x,a,x.dtype,(function(xValue,aValue){return xValue<0?aValue*xValue:xValue}))},MathBackendCPU.prototype.elu=function(x){this.assertNotComplex(x,"elu");for(var resultValues=new Float32Array(x.size),values=this.readSync(x.dataId),i=0;i<values.length;++i){var v=values[i];resultValues[i]=v>=0?v:Math.exp(v)-1}return tensor_1.Tensor.make(x.shape,{values:resultValues})},MathBackendCPU.prototype.eluDer=function(dy,y){this.assertNotComplex([dy,y],"eluDer");for(var resultValues=new Float32Array(y.size),values=this.readSync(y.dataId),dyValues=this.readSync(dy.dataId),i=0;i<values.length;++i){var v=values[i];resultValues[i]=v>=1?dyValues[i]:dyValues[i]*(v+1)}return tensor_1.Tensor.make(y.shape,{values:resultValues})},MathBackendCPU.prototype.selu=function(x){this.assertNotComplex(x,"selu");for(var scaleAlpha=selu_util.SELU_SCALEALPHA,scale=selu_util.SELU_SCALE,resultValues=new Float32Array(x.size),values=this.readSync(x.dataId),i=0;i<values.length;++i){var v=values[i];resultValues[i]=v>=0?scale*v:scaleAlpha*(Math.exp(v)-1)}return tensor_1.Tensor.make(x.shape,{values:resultValues})},MathBackendCPU.prototype.clip=function(x,min,max){this.assertNotComplex(x,"clip");for(var resultValues=new Float32Array(x.size),values=this.readSync(x.dataId),i=0;i<values.length;++i){var v=values[i];resultValues[i]=v>max?max:v<min?min:v}return tensor_1.Tensor.make(x.shape,{values:resultValues})},MathBackendCPU.prototype.abs=function(x){for(var resultValues=new Float32Array(x.size),values=this.readSync(x.dataId),i=0;i<values.length;++i)resultValues[i]=Math.abs(values[i]);return tensor_1.Tensor.make(x.shape,{values:resultValues})},MathBackendCPU.prototype.complexAbs=function(x){for(var resultValues=new Float32Array(x.size),values=this.readSync(x.dataId),i=0;i<x.size;++i){var real_1=values[2*i],imag_1=values[2*i+1];resultValues[i]=Math.hypot(real_1,imag_1)}return tensor_1.Tensor.make(x.shape,{values:resultValues})},MathBackendCPU.prototype.int=function(x){this.assertNotComplex(x,"int");for(var resultValues=new Int32Array(x.size),values=this.readSync(x.dataId),i=0;i<values.length;++i)resultValues[i]=values[i];return tensor_1.Tensor.make(x.shape,{values:resultValues},"int32")},MathBackendCPU.prototype.sigmoid=function(x){this.assertNotComplex(x,"sigmoid");for(var resultValues=new Float32Array(x.size),values=this.readSync(x.dataId),i=0;i<values.length;++i)resultValues[i]=1/(1+Math.exp(-values[i]));return tensor_1.Tensor.make(x.shape,{values:resultValues})},MathBackendCPU.prototype.softplus=function(x){this.assertNotComplex(x,"softplus");for(var epsilon=1.1920928955078125e-7,threshold=Math.log(epsilon)+2,resultValues=new Float32Array(x.size),values=this.readSync(x.dataId),i=0;i<values.length;++i){var tooLarge=values[i]>-threshold,tooSmall=values[i]<threshold,expX=Math.exp(values[i]),result=void 0;result=tooSmall?expX:tooLarge?values[i]:Math.log(1+expX),resultValues[i]=result}return tensor_1.Tensor.make(x.shape,{values:resultValues})},MathBackendCPU.prototype.sin=function(x){this.assertNotComplex(x,"sin");for(var resultValues=new Float32Array(x.size),values=this.readSync(x.dataId),i=0;i<values.length;++i)resultValues[i]=Math.sin(values[i]);return tensor_1.Tensor.make(x.shape,{values:resultValues})},MathBackendCPU.prototype.cos=function(x){this.assertNotComplex(x,"cos");for(var resultValues=new Float32Array(x.size),values=this.readSync(x.dataId),i=0;i<values.length;++i)resultValues[i]=Math.cos(values[i]);return tensor_1.Tensor.make(x.shape,{values:resultValues})},MathBackendCPU.prototype.tan=function(x){this.assertNotComplex(x,"tan");for(var resultValues=new Float32Array(x.size),values=this.readSync(x.dataId),i=0;i<values.length;++i)resultValues[i]=Math.tan(values[i]);return tensor_1.Tensor.make(x.shape,{values:resultValues})},MathBackendCPU.prototype.asin=function(x){this.assertNotComplex(x,"asin");for(var resultValues=new Float32Array(x.size),values=this.readSync(x.dataId),i=0;i<values.length;++i)resultValues[i]=Math.asin(values[i]);return tensor_1.Tensor.make(x.shape,{values:resultValues})},MathBackendCPU.prototype.acos=function(x){this.assertNotComplex(x,"acos");for(var resultValues=new Float32Array(x.size),values=this.readSync(x.dataId),i=0;i<values.length;++i)resultValues[i]=Math.acos(values[i]);return tensor_1.Tensor.make(x.shape,{values:resultValues})},MathBackendCPU.prototype.atan=function(x){this.assertNotComplex(x,"atan");for(var resultValues=new Float32Array(x.size),values=this.readSync(x.dataId),i=0;i<values.length;++i)resultValues[i]=Math.atan(values[i]);return tensor_1.Tensor.make(x.shape,{values:resultValues})},MathBackendCPU.prototype.atan2=function(a,b){return this.assertNotComplex([a,b],"atan2"),this.broadcastedBinaryOp(a,b,a.dtype,(function(aValue,bValue){return Math.atan2(aValue,bValue)}))},MathBackendCPU.prototype.sinh=function(x){this.assertNotComplex(x,"sinh");for(var resultValues=new Float32Array(x.size),values=this.readSync(x.dataId),i=0;i<values.length;++i)resultValues[i]=Math.sinh(values[i]);return tensor_1.Tensor.make(x.shape,{values:resultValues})},MathBackendCPU.prototype.cosh=function(x){this.assertNotComplex(x,"cosh");for(var resultValues=new Float32Array(x.size),values=this.readSync(x.dataId),i=0;i<values.length;++i)resultValues[i]=Math.cosh(values[i]);return tensor_1.Tensor.make(x.shape,{values:resultValues})},MathBackendCPU.prototype.tanh=function(x){this.assertNotComplex(x,"tanh");for(var resultValues=new Float32Array(x.size),values=this.readSync(x.dataId),i=0;i<values.length;++i)resultValues[i]=util.tanh(values[i]);return tensor_1.Tensor.make(x.shape,{values:resultValues})},MathBackendCPU.prototype.asinh=function(x){this.assertNotComplex(x,"asinh");for(var resultValues=new Float32Array(x.size),values=this.readSync(x.dataId),i=0;i<values.length;++i)resultValues[i]=Math.asinh(values[i]);return tensor_1.Tensor.make(x.shape,{values:resultValues})},MathBackendCPU.prototype.acosh=function(x){this.assertNotComplex(x,"acosh");for(var resultValues=new Float32Array(x.size),values=this.readSync(x.dataId),i=0;i<values.length;++i)resultValues[i]=Math.acosh(values[i]);return tensor_1.Tensor.make(x.shape,{values:resultValues})},MathBackendCPU.prototype.atanh=function(x){this.assertNotComplex(x,"atanh");for(var resultValues=new Float32Array(x.size),values=this.readSync(x.dataId),i=0;i<values.length;++i)resultValues[i]=Math.atanh(values[i]);return tensor_1.Tensor.make(x.shape,{values:resultValues})},MathBackendCPU.prototype.erf=function(x){this.assertNotComplex(x,"erf");for(var resultValues=new Float32Array(x.size),values=this.readSync(x.dataId),p=erf_util.ERF_P,a1=erf_util.ERF_A1,a2=erf_util.ERF_A2,a3=erf_util.ERF_A3,a4=erf_util.ERF_A4,a5=erf_util.ERF_A5,i=0;i<values.length;++i){var v=values[i],t=1/(1+p*v);resultValues[i]=1-((((a5*t+a4)*t+a3)*t+a2)*t+a1)*t*Math.exp(-v*v)}return tensor_1.Tensor.make(x.shape,{values:resultValues})},MathBackendCPU.prototype.step=function(x,alpha){void 0===alpha&&(alpha=0),this.assertNotComplex(x,"step");for(var resultValues=new Float32Array(x.size),values=this.readSync(x.dataId),i=0;i<values.length;++i){var value=values[i];isNaN(value)?resultValues[i]=NaN:resultValues[i]=value>0?1:alpha}return tensor_1.Tensor.make(x.shape,{values:resultValues})},MathBackendCPU.prototype.fusedConv2d=function(x,filter,convInfo,bias,activation,preluActivationWeights){var result=this.conv2d(x,filter,convInfo);return bias&&(result=this.add(result,bias)),activation&&(result=mapActivation(this,result,activation,preluActivationWeights)),result},MathBackendCPU.prototype.conv2d=function(x,filter,convInfo){this.assertNotComplex([x,filter],"conv2d");for(var filterHeight=convInfo.filterHeight,filterWidth=convInfo.filterWidth,dilationHeight=convInfo.dilationHeight,dilationWidth=convInfo.dilationWidth,padLeft=convInfo.padInfo.left,padTop=convInfo.padInfo.top,isChannelsLast="channelsLast"===convInfo.dataFormat,y=ops.buffer(convInfo.outShape,x.dtype),xBatchStride=x.strides[0],xRowStride=isChannelsLast?x.strides[1]:x.strides[2],xColStride=isChannelsLast?x.strides[2]:1,xChannelStride=isChannelsLast?1:x.strides[1],yBatchStride=y.strides[0],yRowStride=isChannelsLast?y.strides[1]:y.strides[2],yColStride=isChannelsLast?y.strides[2]:1,yChannelStride=isChannelsLast?1:y.strides[1],xVals=this.readSync(x.dataId),wVals=this.readSync(filter.dataId),yVals=y.values,b=0;b<convInfo.batchSize;++b)for(var xOffset1=b*xBatchStride,yOffset1=b*yBatchStride,yR=0;yR<convInfo.outHeight;++yR)for(var yOffset2=yOffset1+yR*yRowStride,xRCorner=yR*convInfo.strideHeight-padTop,wR=0;wR<filterHeight;wR++){var xR=xRCorner+wR*dilationHeight;if(!(xR<0||xR>=convInfo.inHeight))for(var wOffset1=wR*filter.strides[0],xOffset2=xOffset1+xR*xRowStride,yC=0;yC<convInfo.outWidth;++yC)for(var yOffset3=yOffset2+yC*yColStride,xCCorner=yC*convInfo.strideWidth-padLeft,wC=0;wC<filterWidth;wC++){var xC=xCCorner+wC*dilationWidth;if(!(xC<0||xC>=convInfo.inWidth))for(var wOffset2,xOffset3=xOffset2+xC*xColStride,wOffset3=wOffset1+wC*filter.strides[1],d1=0;d1<convInfo.inChannels;++d1){for(var xVal=xVals[xOffset3+d1*xChannelStride],d2=0;d2<convInfo.outChannels;++d2)yVals[yOffset3+d2*yChannelStride]+=xVal*wVals[wOffset3+d2];wOffset3+=convInfo.outChannels}}}return y.toTensor()},MathBackendCPU.prototype.conv3d=function(x,filter,convInfo){for(var filterDepth=convInfo.filterDepth,filterHeight=convInfo.filterHeight,filterWidth=convInfo.filterWidth,dilationDepth=convInfo.dilationDepth,dilationHeight=convInfo.dilationHeight,dilationWidth=convInfo.dilationWidth,padFront=convInfo.padInfo.front,padLeft=convInfo.padInfo.left,padTop=convInfo.padInfo.top,y=ops.buffer(convInfo.outShape,x.dtype),xVals=this.readSync(x.dataId),wVals=this.readSync(filter.dataId),yVals=y.values,b=0;b<convInfo.batchSize;++b)for(var xOffset1=b*x.strides[0],yOffset1=b*y.strides[0],yF=0;yF<convInfo.outDepth;++yF)for(var yOffset2=yOffset1+yF*y.strides[1],xFCorner=yF*convInfo.strideDepth-padFront,wF=0;wF<filterDepth;wF++){var xF=xFCorner+wF*dilationDepth;if(!(xF<0||xF>=convInfo.inDepth))for(var wOffset1=wF*filter.strides[0],xOffset2=xOffset1+xF*x.strides[1],yR=0;yR<convInfo.outHeight;++yR)for(var yOffset3=yOffset2+yR*y.strides[2],xRCorner=yR*convInfo.strideHeight-padTop,wR=0;wR<filterHeight;wR++){var xR=xRCorner+wR*dilationHeight;if(!(xR<0||xR>=convInfo.inHeight))for(var wOffset2=wOffset1+wR*filter.strides[1],xOffset3=xOffset2+xR*x.strides[2],yC=0;yC<convInfo.outWidth;++yC)for(var yOffset4=yOffset3+yC*convInfo.outChannels,xCCorner=yC*convInfo.strideWidth-padLeft,wC=0;wC<filterWidth;wC++){var xC=xCCorner+wC*dilationWidth;if(!(xC<0||xC>=convInfo.inWidth))for(var wOffset3=wOffset2+wC*filter.strides[2],xOffset4=xOffset3+xC*convInfo.inChannels,wOffset4=wOffset3,d1=0;d1<convInfo.inChannels;++d1){for(var xVal=xVals[xOffset4+d1],d2=0;d2<convInfo.outChannels;++d2)yVals[yOffset4+d2]+=xVal*wVals[wOffset4+d2];wOffset4+=convInfo.outChannels}}}}return y.toTensor()},MathBackendCPU.prototype.conv2dDerInput=function(dy,filter,convInfo){this.assertNotComplex([dy,filter],"conv2dDerInput");for(var dx=ops.buffer(convInfo.inShape,"float32"),dxValues=dx.values,dyValues=this.readSync(dy.dataId),fltValues=this.readSync(filter.dataId),_a=filter.strides,fltS0=_a[0],fltS1=_a[1],fltS2=_a[2],batchSize=convInfo.batchSize,filterHeight=convInfo.filterHeight,filterWidth=convInfo.filterWidth,inChannels=convInfo.inChannels,inHeight=convInfo.inHeight,inWidth=convInfo.inWidth,outChannels=convInfo.outChannels,outHeight=convInfo.outHeight,outWidth=convInfo.outWidth,strideHeight=convInfo.strideHeight,strideWidth=convInfo.strideWidth,dataFormat=convInfo.dataFormat,topPad=filterHeight-1-convInfo.padInfo.top,leftPad=filterWidth-1-convInfo.padInfo.left,isChannelsLast="channelsLast"===dataFormat,xBatchStride=dx.strides[0],xRowStride=isChannelsLast?dx.strides[1]:dx.strides[2],xColStride=isChannelsLast?dx.strides[2]:1,xChannelStride=isChannelsLast?1:dx.strides[1],yBatchStride=dy.strides[0],yRowStride=isChannelsLast?dy.strides[1]:dy.strides[2],yColStride=isChannelsLast?dy.strides[2]:1,yChannelStride=isChannelsLast?1:dy.strides[1],b=0;b<batchSize;++b)for(var d1=0;d1<inChannels;++d1)for(var xR=0;xR<inHeight;++xR)for(var xRCorner=xR-topPad,xRMin=Math.max(0,Math.ceil(xRCorner/strideHeight)),yRMax=Math.min(outHeight,(filterHeight+xRCorner)/strideHeight),xC=0;xC<inWidth;++xC){for(var xCCorner=xC-leftPad,xCMin=Math.max(0,Math.ceil(xCCorner/strideWidth)),yCMax=Math.min(outWidth,(filterWidth+xCCorner)/strideWidth),dotProd=0,yR=xRMin;yR<yRMax;++yR)for(var wR=yR*strideHeight-xRCorner,yC=xCMin;yC<yCMax;++yC)for(var wC,dyOffset=yBatchStride*b+yRowStride*yR+yColStride*yC,fltOffset=fltS0*(filterHeight-1-wR)+fltS1*(filterWidth-1-(yC*strideWidth-xCCorner))+fltS2*d1,d2=0;d2<outChannels;++d2){var pixel,weight;dotProd+=dyValues[dyOffset+yChannelStride*d2]*fltValues[fltOffset+d2]}var dxOffset;dxValues[xBatchStride*b+xRowStride*xR+xColStride*xC+xChannelStride*d1]=dotProd}return dx.toTensor()},MathBackendCPU.prototype.conv3dDerInput=function(dy,filter,convInfo){for(var dx=ops.buffer(convInfo.inShape,"float32"),dxValues=dx.values,_a=dx.strides,dxS0=_a[0],dxS1=_a[1],dxS2=_a[2],dxS3=_a[3],dyValues=this.readSync(dy.dataId),_b=dy.strides,dyS0=_b[0],dyS1=_b[1],dyS2=_b[2],dyS3=_b[3],fltValues=this.readSync(filter.dataId),_c=filter.strides,fltS0=_c[0],fltS1=_c[1],fltS2=_c[2],fltS3=_c[3],batchSize=convInfo.batchSize,filterDepth=convInfo.filterDepth,filterHeight=convInfo.filterHeight,filterWidth=convInfo.filterWidth,inChannels=convInfo.inChannels,inDepth=convInfo.inDepth,inHeight=convInfo.inHeight,inWidth=convInfo.inWidth,outChannels=convInfo.outChannels,outDepth=convInfo.outDepth,outHeight=convInfo.outHeight,outWidth=convInfo.outWidth,strideDepth=convInfo.strideDepth,strideHeight=convInfo.strideHeight,strideWidth=convInfo.strideWidth,frontPad=filterDepth-1-convInfo.padInfo.front,topPad=filterHeight-1-convInfo.padInfo.top,leftPad=filterWidth-1-convInfo.padInfo.left,b=0;b<batchSize;++b)for(var d1=0;d1<inChannels;++d1)for(var xF=0;xF<inDepth;++xF)for(var xFCorner=xF-frontPad,xFMin=Math.max(0,Math.ceil(xFCorner/strideDepth)),yFMax=Math.min(outDepth,(filterDepth+xFCorner)/strideDepth),xR=0;xR<inHeight;++xR)for(var xRCorner=xR-topPad,xRMin=Math.max(0,Math.ceil(xRCorner/strideHeight)),yRMax=Math.min(outHeight,(filterHeight+xRCorner)/strideHeight),xC=0;xC<inWidth;++xC){for(var xCCorner=xC-leftPad,xCMin=Math.max(0,Math.ceil(xCCorner/strideWidth)),yCMax=Math.min(outWidth,(filterWidth+xCCorner)/strideWidth),dotProd=0,yF=xFMin;yF<yFMax;++yF)for(var wF=yF*strideDepth-xFCorner,yR=xRMin;yR<yRMax;++yR)for(var wR=yR*strideHeight-xRCorner,yC=xCMin;yC<yCMax;++yC)for(var wC,dyOffset=dyS0*b+dyS1*yF+dyS2*yR+dyS3*yC,fltOffset=fltS0*(filterDepth-1-wF)+fltS1*(filterHeight-1-wR)+fltS2*(filterWidth-1-(yC*strideWidth-xCCorner))+fltS3*d1,d2=0;d2<outChannels;++d2){var pixel,weight;dotProd+=dyValues[dyOffset+d2]*fltValues[fltOffset+d2]}dxValues[dxS0*b+dxS1*xF+dxS2*xR+dxS3*xC+d1]=dotProd}return dx.toTensor()},MathBackendCPU.prototype.conv2dDerFilter=function(x,dy,convInfo){this.assertNotComplex([x,dy],"conv2dDerFilter");for(var strideHeight=convInfo.strideHeight,strideWidth=convInfo.strideWidth,filterHeight=convInfo.filterHeight,filterWidth=convInfo.filterWidth,isChannelsLast="channelsLast"===convInfo.dataFormat,dW=ops.buffer(convInfo.filterShape,"float32"),leftPad=convInfo.padInfo.left,topPad=convInfo.padInfo.top,xBuf=this.bufferSync(x),dyBuf=this.bufferSync(dy),wR=0;wR<filterHeight;++wR)for(var yRMin=Math.max(0,Math.ceil((topPad-wR)/strideHeight)),yRMax=Math.min(convInfo.outHeight,(convInfo.inHeight+topPad-wR)/strideHeight),wC=0;wC<filterWidth;++wC)for(var yCMin=Math.max(0,Math.ceil((leftPad-wC)/strideWidth)),yCMax=Math.min(convInfo.outWidth,(convInfo.inWidth+leftPad-wC)/strideWidth),d1=0;d1<convInfo.inChannels;++d1)for(var d2=0;d2<convInfo.outChannels;++d2){for(var dotProd=0,b=0;b<convInfo.batchSize;++b)for(var yR=yRMin;yR<yRMax;++yR)for(var xR=wR+yR*strideHeight-topPad,yC=yCMin;yC<yCMax;++yC){var xC=wC+yC*strideWidth-leftPad;dotProd+=isChannelsLast?xBuf.get(b,xR,xC,d1)*dyBuf.get(b,yR,yC,d2):xBuf.get(b,d1,xR,xC)*dyBuf.get(b,d2,yR,yC)}dW.set(dotProd,wR,wC,d1,d2)}return dW.toTensor()},MathBackendCPU.prototype.conv3dDerFilter=function(x,dy,convInfo){for(var strideDepth=convInfo.strideDepth,strideHeight=convInfo.strideHeight,strideWidth=convInfo.strideWidth,filterDepth=convInfo.filterDepth,filterHeight=convInfo.filterHeight,filterWidth=convInfo.filterWidth,dw=ops.buffer(convInfo.filterShape,"float32"),dwValues=dw.values,_a=dw.strides,dwS0=_a[0],dwS1=_a[1],dwS2=_a[2],dwS3=_a[3],dyValues=this.readSync(dy.dataId),_b=dy.strides,dyS0=_b[0],dyS1=_b[1],dyS2=_b[2],dyS3=_b[3],xValues=this.readSync(x.dataId),_c=x.strides,xS0=_c[0],xS1=_c[1],xS2=_c[2],xS3=_c[3],frontPad=convInfo.padInfo.front,leftPad=convInfo.padInfo.left,topPad=convInfo.padInfo.top,wF=0;wF<filterDepth;++wF)for(var yFMin=Math.max(0,Math.ceil((frontPad-wF)/strideDepth)),yFMax=Math.min(convInfo.outDepth,(convInfo.inDepth+frontPad-wF)/strideDepth),wOffset1=wF*dwS0,wR=0;wR<filterHeight;++wR)for(var yRMin=Math.max(0,Math.ceil((topPad-wR)/strideHeight)),yRMax=Math.min(convInfo.outHeight,(convInfo.inHeight+topPad-wR)/strideHeight),wOffset2=wR*dwS1+wOffset1,wC=0;wC<filterWidth;++wC)for(var yCMin=Math.max(0,Math.ceil((leftPad-wC)/strideWidth)),yCMax=Math.min(convInfo.outWidth,(convInfo.inWidth+leftPad-wC)/strideWidth),wOffset3=wC*dwS2+wOffset2,d1=0;d1<convInfo.inChannels;++d1)for(var wOffset4=d1*dwS3+wOffset3,d2=0;d2<convInfo.outChannels;++d2){for(var dotProd=0,b=0;b<convInfo.batchSize;++b)for(var xOffset1=b*xS0,yOffset1=b*dyS0,yF=yFMin;yF<yFMax;++yF)for(var xF,xOffset2=(wF+yF*strideDepth-frontPad)*xS1+xOffset1,yOffset2=yF*dyS1+yOffset1,yR=yRMin;yR<yRMax;++yR)for(var xR,xOffset3=(wR+yR*strideHeight-topPad)*xS2+xOffset2,yOffset3=yR*dyS2+yOffset2,yC=yCMin;yC<yCMax;++yC){var xC,xOffset4,yOffset4=yC*dyS3+yOffset3;dotProd+=xValues[(wC+yC*strideWidth-leftPad)*xS3+xOffset3+d1]*dyValues[yOffset4+d2]}dwValues[wOffset4+d2]=dotProd}return dw.toTensor()},MathBackendCPU.prototype.depthwiseConv2D=function(x,filter,convInfo){this.assertNotComplex([x,filter],"depthwiseConv2D");for(var filterHeight=convInfo.filterHeight,filterWidth=convInfo.filterWidth,dilationHeight=convInfo.dilationHeight,dilationWidth=convInfo.dilationWidth,padLeft=convInfo.padInfo.left,padTop=convInfo.padInfo.top,chMul=convInfo.outChannels/convInfo.inChannels,y=ops.buffer(convInfo.outShape,x.dtype),xVals=this.readSync(x.dataId),wVals=this.readSync(filter.dataId),yVals=y.values,b=0;b<convInfo.batchSize;++b)for(var xOffset1=b*x.strides[0],yOffset1=b*y.strides[0],yR=0;yR<convInfo.outHeight;++yR)for(var yOffset2=yOffset1+yR*y.strides[1],xRCorner=yR*convInfo.strideHeight-padLeft,wR=0;wR<filterHeight;++wR){var xR=xRCorner+wR*dilationHeight;if(!(xR<0||xR>=convInfo.inHeight))for(var wOffset1=wR*filter.strides[0],xOffset2=xOffset1+xR*x.strides[1],yC=0;yC<convInfo.outWidth;++yC)for(var yOffset3=yOffset2+yC*y.strides[2],xCCorner=yC*convInfo.strideWidth-padTop,wC=0;wC<filterWidth;++wC){var xC=xCCorner+wC*dilationWidth;if(!(xC<0||xC>=convInfo.inWidth))for(var wOffset2=wOffset1+wC*filter.strides[1],xOffset3=xOffset2+xC*convInfo.inChannels,yOffset4=yOffset3,wOffset3=wOffset2,d1=0;d1<convInfo.inChannels;++d1){for(var xVal=xVals[xOffset3+d1],q=0;q<chMul;++q)yVals[yOffset4+q]+=xVal*wVals[wOffset3+q];yOffset4+=chMul,wOffset3+=chMul}}}return y.toTensor()},MathBackendCPU.prototype.depthwiseConv2DDerInput=function(dy,filter,convInfo){this.assertNotComplex([dy,filter],"depthwiseConv2DDerInput");for(var dx=ops.buffer(convInfo.inShape,"float32"),dxValues=dx.values,_a=dx.strides,dxS0=_a[0],dxS1=_a[1],dxS2=_a[2],dyValues=this.readSync(dy.dataId),_b=dy.strides,dyS0=_b[0],dyS1=_b[1],dyS2=_b[2],fltValues=this.readSync(filter.dataId),_c=filter.strides,fltS0=_c[0],fltS1=_c[1],fltS2=_c[2],batchSize=convInfo.batchSize,filterHeight=convInfo.filterHeight,filterWidth=convInfo.filterWidth,inChannels=convInfo.inChannels,inHeight=convInfo.inHeight,inWidth=convInfo.inWidth,outChannels=convInfo.outChannels,outHeight=convInfo.outHeight,outWidth=convInfo.outWidth,strideHeight=convInfo.strideHeight,strideWidth=convInfo.strideWidth,topPad=filterHeight-1-convInfo.padInfo.top,leftPad=filterWidth-1-convInfo.padInfo.left,chMul=outChannels/inChannels,b=0;b<batchSize;++b)for(var d1=0;d1<inChannels;++d1)for(var xR=0;xR<inHeight;++xR)for(var xRCorner=xR-topPad,xRMin=Math.max(0,Math.ceil(xRCorner/strideHeight)),yRMax=Math.min(outHeight,(filterHeight+xRCorner)/strideHeight),xC=0;xC<inWidth;++xC){for(var xCCorner=xC-leftPad,xCMin=Math.max(0,Math.ceil(xCCorner/strideWidth)),yCMax=Math.min(outWidth,(filterWidth+xCCorner)/strideWidth),dotProd=0,yR=xRMin;yR<yRMax;++yR)for(var wR=yR*strideHeight-xRCorner,yC=xCMin;yC<yCMax;++yC)for(var wC,dyOffset=dyS0*b+dyS1*yR+dyS2*yC,fltOffset=fltS0*(filterHeight-1-wR)+fltS1*(filterWidth-1-(yC*strideWidth-xCCorner))+fltS2*d1,dm=0;dm<chMul;++dm){var d2,pixel,weight;dotProd+=dyValues[dyOffset+(d1*chMul+dm)]*fltValues[fltOffset+dm]}dxValues[dxS0*b+dxS1*xR+dxS2*xC+d1]=dotProd}return dx.toTensor()},MathBackendCPU.prototype.depthwiseConv2DDerFilter=function(x,dy,convInfo){this.assertNotComplex([x,dy],"depthwiseConv2DDerFilter");for(var strideHeight=convInfo.strideHeight,strideWidth=convInfo.strideWidth,filterHeight=convInfo.filterHeight,filterWidth=convInfo.filterWidth,dW=ops.buffer(convInfo.filterShape,"float32"),leftPad=convInfo.padInfo.left,topPad=convInfo.padInfo.top,chMul=convInfo.outChannels/convInfo.inChannels,xBuf=this.bufferSync(x),dyBuf=this.bufferSync(dy),wR=0;wR<filterHeight;++wR)for(var yRMin=Math.max(0,Math.ceil((topPad-wR)/strideHeight)),yRMax=Math.min(convInfo.outHeight,(convInfo.inHeight+topPad-wR)/strideHeight),wC=0;wC<filterWidth;++wC)for(var yCMin=Math.max(0,Math.ceil((leftPad-wC)/strideWidth)),yCMax=Math.min(convInfo.outWidth,(convInfo.inWidth+leftPad-wC)/strideWidth),d2=0;d2<convInfo.outChannels;++d2){for(var d1=Math.trunc(d2/chMul),dm=d2%chMul,dotProd=0,b=0;b<convInfo.batchSize;++b)for(var yR=yRMin;yR<yRMax;++yR)for(var xR=wR+yR*strideHeight-topPad,yC=yCMin;yC<yCMax;++yC){var xC=wC+yC*strideWidth-leftPad;dotProd+=xBuf.get(b,xR,xC,d1)*dyBuf.get(b,yR,yC,d2)}dW.set(dotProd,wR,wC,d1,dm)}return dW.toTensor()},MathBackendCPU.prototype.tile=function(x,reps){return this.assertNotComplex(x,"tile"),tile_impl_1.tile(this.bufferSync(x),reps)},MathBackendCPU.prototype.pad=function(x,paddings,constantValue){this.assertNotComplex(x,"pad");var outShape=paddings.map((function(p,i){return p[0]+x.shape[i]+p[1]})),start=paddings.map((function(p){return p[0]})),xBuffer=this.bufferSync(x),buffer=ops.buffer(outShape,x.dtype);0!==constantValue&&buffer.values.fill(constantValue);for(var i=0;i<x.size;i++){var coords=xBuffer.indexToLoc(i),outCoords=coords.map((function(c,i){return c+start[i]}));buffer.set.apply(buffer,[xBuffer.get.apply(xBuffer,coords)].concat(outCoords))}return buffer.toTensor()},MathBackendCPU.prototype.transpose=function(x,perm){this.assertNotComplex(x,"transpose");for(var newShape=new Array(x.rank),i=0;i<newShape.length;i++)newShape[i]=x.shape[perm[i]];for(var values=this.readSync(x.dataId),result=ops_1.buffer(newShape,x.dtype),xBuf=this.bufferSync(x),i=0;i<x.size;++i){for(var loc=xBuf.indexToLoc(i),newLoc=new Array(loc.length),i_1=0;i_1<newLoc.length;i_1++)newLoc[i_1]=loc[perm[i_1]];var newIndex=result.locToIndex(newLoc);result.values[newIndex]=values[i]}return result.toTensor()},MathBackendCPU.prototype.gather=function(x,indices,axis){this.assertNotComplex([x,indices],"gather");var newShape=x.shape.slice(),indicesValues=this.readSync(indices.dataId);newShape[axis]=indicesValues.length;for(var result=ops_1.buffer(newShape,x.dtype),xBuf=this.bufferSync(x),i=0;i<result.size;++i){var newLoc=result.indexToLoc(i),originalLoc=newLoc.slice();originalLoc[axis]=indicesValues[newLoc[axis]];var originalIndex=xBuf.locToIndex(originalLoc);result.values[i]=xBuf.values[originalIndex]}return result.toTensor()},MathBackendCPU.prototype.batchToSpaceND=function(x,blockShape,crops){this.assertNotComplex([x],"batchToSpaceND");var prod=blockShape.reduce((function(a,b){return a*b})),reshaped=array_ops_util.getReshaped(x.shape,blockShape,prod),permuted=array_ops_util.getPermuted(reshaped.length,blockShape.length),reshapedPermuted=array_ops_util.getReshapedPermuted(x.shape,blockShape,prod),sliceBeginCoords=array_ops_util.getSliceBeginCoords(crops,blockShape.length),sliceSize=array_ops_util.getSliceSize(reshapedPermuted,crops,blockShape.length);return x.reshape(reshaped).transpose(permuted).reshape(reshapedPermuted).slice(sliceBeginCoords,sliceSize)},MathBackendCPU.prototype.spaceToBatchND=function(x,blockShape,paddings){this.assertNotComplex([x],"spaceToBatchND");var prod=blockShape.reduce((function(a,b){return a*b})),completePaddings=[[0,0]];completePaddings.push.apply(completePaddings,paddings);for(var i=1+blockShape.length;i<x.shape.length;++i)completePaddings.push([0,0]);var paddedX=x.pad(completePaddings),reshapedPaddedShape=array_ops_util.getReshaped(paddedX.shape,blockShape,prod,!1),permutedReshapedPaddedPermutation=array_ops_util.getPermuted(reshapedPaddedShape.length,blockShape.length,!1),flattenShape=array_ops_util.getReshapedPermuted(paddedX.shape,blockShape,prod,!1);return paddedX.reshape(reshapedPaddedShape).transpose(permutedReshapedPaddedPermutation).reshape(flattenShape)},MathBackendCPU.prototype.pool=function(x,convInfo,poolType){this.assertNotComplex(x,"pool");for(var strideHeight=convInfo.strideHeight,strideWidth=convInfo.strideWidth,dilationHeight=convInfo.dilationHeight,dilationWidth=convInfo.dilationWidth,effectiveFilterHeight=convInfo.effectiveFilterHeight,effectiveFilterWidth=convInfo.effectiveFilterWidth,padTop=convInfo.padInfo.top,padLeft=convInfo.padInfo.left,initialValue="max"===poolType?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,xValues=this.readSync(x.dataId),output=ops.buffer(convInfo.outShape,x.dtype),outputVals=output.values,outputBatchStrides=convInfo.outShape[1]*convInfo.outShape[2]*convInfo.outShape[3],outputRowStrides=convInfo.outShape[2]*convInfo.outShape[3],outputColStrides=convInfo.outShape[3],b=0;b<convInfo.batchSize;++b)for(var outputBatchOffset=b*outputBatchStrides,inputBatchOffset=b*x.strides[0],d=0;d<convInfo.inChannels;++d)for(var yR=0;yR<convInfo.outHeight;++yR)for(var xRCorner=yR*strideHeight-padTop,xRMin=Math.max(0,xRCorner),xRMax=Math.min(convInfo.inHeight,effectiveFilterHeight+xRCorner),outputRowOffset=outputBatchOffset+yR*outputRowStrides,yC=0;yC<convInfo.outWidth;++yC){for(var xCCorner=yC*strideWidth-padLeft,xCMin=Math.max(0,xCCorner),xCMax=Math.min(convInfo.inWidth,effectiveFilterWidth+xCCorner),minMaxValue=initialValue,avgValue=0,count=0,xR=xRMin;xR<xRMax;xR+=dilationHeight){for(var xROffset=inputBatchOffset+xR*x.strides[1],xC=xCMin;xC<xCMax;xC+=dilationWidth){var xCOffset,pixel=xValues[xROffset+xC*x.strides[2]+d];"max"===poolType&&pixel>minMaxValue?minMaxValue=pixel:"avg"===poolType&&(avgValue+=pixel,count++)}if(isNaN(minMaxValue))break}var outputOffset;outputVals[outputRowOffset+yC*outputColStrides+d]="avg"===poolType?avgValue/count:minMaxValue}return output.toTensor()},MathBackendCPU.prototype.maxPool=function(x,convInfo){return this.pool(x,convInfo,"max")},MathBackendCPU.prototype.maxPoolPositions=function(x,convInfo){for(var maxPositions=ops.buffer(convInfo.outShape,"int32"),strideHeight=convInfo.strideHeight,strideWidth=convInfo.strideWidth,dilationHeight=convInfo.dilationHeight,dilationWidth=convInfo.dilationWidth,effectiveFilterHeight=convInfo.effectiveFilterHeight,effectiveFilterWidth=convInfo.effectiveFilterWidth,padTop=convInfo.padInfo.top,padLeft=convInfo.padInfo.left,xBuf=this.bufferSync(x),b=0;b<convInfo.batchSize;++b)for(var d=0;d<convInfo.inChannels;++d)for(var yR=0;yR<convInfo.outHeight;++yR){for(var xRCorner=yR*strideHeight-padTop,xRMin=xRCorner;xRMin<0;)xRMin+=dilationHeight;for(var xRMax=Math.min(convInfo.inHeight,effectiveFilterHeight+xRCorner),yC=0;yC<convInfo.outWidth;++yC){for(var xCCorner=yC*strideWidth-padLeft,xCMin=xCCorner;xCMin<0;)xCMin+=dilationWidth;for(var xCMax=Math.min(convInfo.inWidth,effectiveFilterWidth+xCCorner),maxValue=Number.NEGATIVE_INFINITY,maxPosition=-1,xR=xRMin;xR<xRMax;xR+=dilationHeight)for(var wR=xR-xRCorner,xC=xCMin;xC<xCMax;xC+=dilationWidth){var wC=xC-xCCorner,pixel=xBuf.get(b,xR,xC,d);pixel>maxValue&&(maxValue=pixel,maxPosition=wR*effectiveFilterWidth+wC)}maxPositions.set(maxPosition,b,yR,yC,d)}}return maxPositions.toTensor()},MathBackendCPU.prototype.maxPoolBackprop=function(dy,x,y,convInfo){this.assertNotComplex([x,y],"maxPoolBackprop");for(var maxPositions=this.maxPoolPositions(x,convInfo),strideHeight=convInfo.strideHeight,strideWidth=convInfo.strideWidth,dilationHeight=convInfo.dilationHeight,dilationWidth=convInfo.dilationWidth,effectiveFilterHeight=convInfo.effectiveFilterHeight,effectiveFilterWidth=convInfo.effectiveFilterWidth,padLeft=effectiveFilterWidth-1-convInfo.padInfo.left,padTop=effectiveFilterHeight-1-convInfo.padInfo.top,dx=ops.buffer(x.shape,"float32"),maxPosBuf=this.bufferSync(maxPositions),dyBuf=this.bufferSync(dy),b=0;b<convInfo.batchSize;++b)for(var d=0;d<convInfo.inChannels;++d)for(var dxR=0;dxR<convInfo.inHeight;++dxR)for(var dxC=0;dxC<convInfo.inWidth;++dxC){for(var dyRCorner=dxR-padTop,dyCCorner=dxC-padLeft,dotProd=0,wR=0;wR<effectiveFilterHeight;wR+=dilationHeight){var dyR=(dyRCorner+wR)/strideHeight;if(!(dyR<0||dyR>=convInfo.outHeight||Math.floor(dyR)!==dyR))for(var wC=0;wC<effectiveFilterWidth;wC+=dilationWidth){var dyC=(dyCCorner+wC)/strideWidth;if(!(dyC<0||dyC>=convInfo.outWidth||Math.floor(dyC)!==dyC)){var maxPos,curPos,mask=effectiveFilterHeight*effectiveFilterWidth-1-maxPosBuf.get(b,dyR,dyC,d)===wR*effectiveFilterWidth+wC?1:0,pixel;if(0!==mask)dotProd+=dyBuf.get(b,dyR,dyC,d)*mask}}}dx.set(dotProd,b,dxR,dxC,d)}return dx.toTensor()},MathBackendCPU.prototype.avgPoolBackprop=function(dy,x,convInfo){this.assertNotComplex([dy,x],"avgPoolBackprop");for(var strideHeight=convInfo.strideHeight,strideWidth=convInfo.strideWidth,filterHeight=convInfo.filterHeight,filterWidth=convInfo.filterWidth,dilationHeight=convInfo.dilationHeight,dilationWidth=convInfo.dilationWidth,effectiveFilterHeight=convInfo.effectiveFilterHeight,effectiveFilterWidth=convInfo.effectiveFilterWidth,padLeft=effectiveFilterWidth-1-convInfo.padInfo.left,padTop=effectiveFilterHeight-1-convInfo.padInfo.top,dx=ops.buffer(x.shape,"float32"),avgMultiplier=1/(filterHeight*filterWidth),dyBuf=this.bufferSync(dy),b=0;b<convInfo.batchSize;++b)for(var d=0;d<convInfo.inChannels;++d)for(var dxR=0;dxR<convInfo.inHeight;++dxR)for(var dxC=0;dxC<convInfo.inWidth;++dxC){for(var dyRCorner=dxR-padTop,dyCCorner=dxC-padLeft,dotProd=0,wR=0;wR<effectiveFilterHeight;wR+=dilationHeight){var dyR=(dyRCorner+wR)/strideHeight;if(!(dyR<0||dyR>=convInfo.outHeight||Math.floor(dyR)!==dyR))for(var wC=0;wC<effectiveFilterWidth;wC+=dilationWidth){var dyC=(dyCCorner+wC)/strideWidth,pixel;if(!(dyC<0||dyC>=convInfo.outWidth||Math.floor(dyC)!==dyC))dotProd+=dyBuf.get(b,dyR,dyC,d)}}dx.set(dotProd*avgMultiplier,b,dxR,dxC,d)}return dx.toTensor()},MathBackendCPU.prototype.pool3d=function(x,convInfo,poolType){this.assertNotComplex(x,"pool3d");for(var strideDepth=convInfo.strideDepth,strideHeight=convInfo.strideHeight,strideWidth=convInfo.strideWidth,dilationDepth=convInfo.dilationDepth,dilationHeight=convInfo.dilationHeight,dilationWidth=convInfo.dilationWidth,effectiveFilterDepth=convInfo.effectiveFilterDepth,effectiveFilterHeight=convInfo.effectiveFilterHeight,effectiveFilterWidth=convInfo.effectiveFilterWidth,padFront=convInfo.padInfo.front,padTop=convInfo.padInfo.top,padLeft=convInfo.padInfo.left,initialValue="max"===poolType?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,xValues=this.readSync(x.dataId),output=ops.buffer(convInfo.outShape,x.dtype),outputVals=output.values,outputBatchStrides=convInfo.outShape[1]*convInfo.outShape[2]*convInfo.outShape[3]*convInfo.outShape[4],outputDepthStrides=convInfo.outShape[2]*convInfo.outShape[3]*convInfo.outShape[4],outputRowStrides=convInfo.outShape[3]*convInfo.outShape[4],outputColStrides=convInfo.outShape[4],batch=0;batch<convInfo.batchSize;++batch)for(var outputBatchOffset=batch*outputBatchStrides,inputBatchOffset=batch*x.strides[0],channel=0;channel<convInfo.inChannels;++channel)for(var yDepth=0;yDepth<convInfo.outDepth;++yDepth){for(var xDepthCorner=yDepth*strideDepth-padFront,xDepthMin=xDepthCorner;xDepthMin<0;)xDepthMin+=dilationDepth;for(var xDepthMax=Math.min(convInfo.inDepth,effectiveFilterDepth+xDepthCorner),outputDepthOffset=outputBatchOffset+yDepth*outputDepthStrides,yRow=0;yRow<convInfo.outHeight;++yRow){for(var xRowCorner=yRow*strideHeight-padTop,xRowMin=xRowCorner;xRowMin<0;)xRowMin+=dilationHeight;for(var xRowMax=Math.min(convInfo.inHeight,effectiveFilterHeight+xRowCorner),outputRowOffset=outputDepthOffset+yRow*outputRowStrides,yCol=0;yCol<convInfo.outWidth;++yCol){for(var xColCorner=yCol*strideWidth-padLeft,xColMin=xColCorner;xColMin<0;)xColMin+=dilationWidth;for(var xColMax=Math.min(convInfo.inWidth,effectiveFilterWidth+xColCorner),outputColOffset=outputRowOffset+yCol*outputColStrides,minMaxValue=initialValue,avgValue=0,count=0,xDepth=xDepthMin;xDepth<xDepthMax;xDepth+=dilationDepth){for(var xDepthOffset=inputBatchOffset+xDepth*x.strides[1],xRow=xRowMin;xRow<xRowMax;xRow+=dilationHeight){for(var xRowOffset=xDepthOffset+xRow*x.strides[2],xCol=xColMin;xCol<xColMax;xCol+=dilationWidth){var xColOffset,pixel=xValues[xRowOffset+xCol*x.strides[3]+channel];if("max"===poolType&&pixel>minMaxValue?minMaxValue=pixel:"avg"===poolType&&(avgValue+=pixel,count++),isNaN(minMaxValue))break}if(isNaN(minMaxValue))break}if(isNaN(minMaxValue))break}var outputOffset;outputVals[outputColOffset+channel]="avg"===poolType?avgValue/count:minMaxValue}}}return output.toTensor()},MathBackendCPU.prototype.avgPool3d=function(x,convInfo){return this.assertNotComplex(x,"avgPool3d"),this.pool3d(x,convInfo,"avg").toFloat()},MathBackendCPU.prototype.avgPool3dBackprop=function(dy,x,convInfo){this.assertNotComplex([dy,x],"avgPool3dBackprop");for(var strideDepth=convInfo.strideDepth,strideHeight=convInfo.strideHeight,strideWidth=convInfo.strideWidth,filterDepth=convInfo.filterDepth,filterHeight=convInfo.filterHeight,filterWidth=convInfo.filterWidth,dilationDepth=convInfo.dilationDepth,dilationHeight=convInfo.dilationHeight,dilationWidth=convInfo.dilationWidth,effectiveFilterDepth=convInfo.effectiveFilterDepth,effectiveFilterHeight=convInfo.effectiveFilterHeight,effectiveFilterWidth=convInfo.effectiveFilterWidth,padFront=effectiveFilterDepth-1-convInfo.padInfo.front,padLeft=effectiveFilterWidth-1-convInfo.padInfo.left,padTop=effectiveFilterHeight-1-convInfo.padInfo.top,dx=ops.buffer(x.shape,"float32"),avgMultiplier=1/(filterDepth*filterHeight*filterWidth),dyBuf=this.bufferSync(dy),batch=0;batch<convInfo.batchSize;++batch)for(var channel=0;channel<convInfo.inChannels;++channel)for(var dxDepth=0;dxDepth<convInfo.inDepth;++dxDepth)for(var dxRow=0;dxRow<convInfo.inHeight;++dxRow)for(var dxCol=0;dxCol<convInfo.inWidth;++dxCol){for(var dyDepthCorner=dxDepth-padFront,dyRowCorner=dxRow-padTop,dyColCorner=dxCol-padLeft,dotProd=0,wDepth=0;wDepth<effectiveFilterDepth;wDepth+=dilationDepth){var dyDepth=(dyDepthCorner+wDepth)/strideDepth;if(!(dyDepth<0||dyDepth>=convInfo.outDepth||Math.floor(dyDepth)!==dyDepth))for(var wRow=0;wRow<effectiveFilterHeight;wRow+=dilationHeight){var dyRow=(dyRowCorner+wRow)/strideHeight;if(!(dyRow<0||dyRow>=convInfo.outHeight||Math.floor(dyRow)!==dyRow))for(var wCol=0;wCol<effectiveFilterWidth;wCol+=dilationWidth){var dyCol=(dyColCorner+wCol)/strideWidth,pixel;if(!(dyCol<0||dyCol>=convInfo.outWidth||Math.floor(dyCol)!==dyCol))dotProd+=dyBuf.get(batch,dyDepth,dyRow,dyCol,channel)}}}dx.set(dotProd*avgMultiplier,batch,dxDepth,dxRow,dxCol,channel)}return dx.toTensor()},MathBackendCPU.prototype.maxPool3d=function(x,convInfo){return this.assertNotComplex(x,"maxPool3d"),this.pool3d(x,convInfo,"max").toFloat()},MathBackendCPU.prototype.maxPool3dPositions=function(x,convInfo){for(var maxPositions=ops.buffer(convInfo.outShape,"int32"),strideDepth=convInfo.strideDepth,strideHeight=convInfo.strideHeight,strideWidth=convInfo.strideWidth,dilationDepth=convInfo.dilationDepth,dilationHeight=convInfo.dilationHeight,dilationWidth=convInfo.dilationWidth,effectiveFilterDepth=convInfo.effectiveFilterDepth,effectiveFilterHeight=convInfo.effectiveFilterHeight,effectiveFilterWidth=convInfo.effectiveFilterWidth,padFront=convInfo.padInfo.front,padTop=convInfo.padInfo.top,padLeft=convInfo.padInfo.left,xBuf=this.bufferSync(x),batch=0;batch<convInfo.batchSize;++batch)for(var channel=0;channel<convInfo.inChannels;++channel)for(var yDepth=0;yDepth<convInfo.outDepth;++yDepth){for(var xDepthCorner=yDepth*strideDepth-padFront,xDepthMin=xDepthCorner;xDepthMin<0;)xDepthMin+=dilationDepth;for(var xDepthMax=Math.min(convInfo.inDepth,effectiveFilterDepth+xDepthCorner),yRow=0;yRow<convInfo.outHeight;++yRow){for(var xRowCorner=yRow*strideHeight-padTop,xRowMin=xRowCorner;xRowMin<0;)xRowMin+=dilationHeight;for(var xRowMax=Math.min(convInfo.inHeight,effectiveFilterHeight+xRowCorner),yCol=0;yCol<convInfo.outWidth;++yCol){for(var xColCorner=yCol*strideWidth-padLeft,xColMin=xColCorner;xColMin<0;)xColMin+=dilationWidth;for(var xColMax=Math.min(convInfo.inWidth,effectiveFilterWidth+xColCorner),maxValue=Number.NEGATIVE_INFINITY,maxPosition=-1,xDepth=xDepthMin;xDepth<xDepthMax;xDepth+=dilationDepth)for(var wDepth=xDepth-xDepthCorner,xRow=xRowMin;xRow<xRowMax;xRow+=dilationHeight)for(var wRow=xRow-xRowCorner,xCol=xColMin;xCol<xColMax;xCol+=dilationWidth){var wCol=xCol-xColCorner,pixel=xBuf.get(batch,xDepth,xRow,xCol,channel);pixel>=maxValue&&(maxValue=pixel,maxPosition=wDepth*effectiveFilterHeight*effectiveFilterWidth+wRow*effectiveFilterHeight+wCol)}maxPositions.set(maxPosition,batch,yDepth,yRow,yCol,channel)}}}return maxPositions.toTensor()},MathBackendCPU.prototype.maxPool3dBackprop=function(dy,x,y,convInfo){this.assertNotComplex([x,y],"maxPool3dBackprop");for(var maxPositions=this.maxPool3dPositions(x,convInfo),strideDepth=convInfo.strideDepth,strideHeight=convInfo.strideHeight,strideWidth=convInfo.strideWidth,dilationDepth=convInfo.dilationDepth,dilationHeight=convInfo.dilationHeight,dilationWidth=convInfo.dilationWidth,effectiveFilterDepth=convInfo.effectiveFilterDepth,effectiveFilterHeight=convInfo.effectiveFilterHeight,effectiveFilterWidth=convInfo.effectiveFilterWidth,padFront=effectiveFilterDepth-1-convInfo.padInfo.front,padLeft=effectiveFilterWidth-1-convInfo.padInfo.left,padTop=effectiveFilterHeight-1-convInfo.padInfo.top,dx=ops.buffer(x.shape,"float32"),maxPosBuf=this.bufferSync(maxPositions),dyBuf=this.bufferSync(dy),batch=0;batch<convInfo.batchSize;++batch)for(var channel=0;channel<convInfo.inChannels;++channel)for(var dxDepth=0;dxDepth<convInfo.inDepth;++dxDepth)for(var dxRow=0;dxRow<convInfo.inHeight;++dxRow)for(var dxCol=0;dxCol<convInfo.inWidth;++dxCol){for(var dyDepthCorner=dxDepth-padFront,dyRowCorner=dxRow-padTop,dyColCorner=dxCol-padLeft,dotProd=0,wDepth=0;wDepth<effectiveFilterDepth;wDepth+=dilationDepth){var dyDepth=(dyDepthCorner+wDepth)/strideDepth;if(!(dyDepth<0||dyDepth>=convInfo.outDepth||Math.floor(dyDepth)!==dyDepth))for(var wRow=0;wRow<effectiveFilterHeight;wRow+=dilationHeight){var dyRow=(dyRowCorner+wRow)/strideHeight;if(!(dyRow<0||dyRow>=convInfo.outHeight||Math.floor(dyRow)!==dyRow))for(var wCol=0;wCol<effectiveFilterWidth;wCol+=dilationWidth){var dyCol=(dyColCorner+wCol)/strideWidth;if(!(dyCol<0||dyCol>=convInfo.outWidth||Math.floor(dyCol)!==dyCol)){var maxPos,curPos,mask=effectiveFilterDepth*effectiveFilterHeight*effectiveFilterWidth-1-maxPosBuf.get(batch,dyDepth,dyRow,dyCol,channel)===wDepth*effectiveFilterHeight*effectiveFilterWidth+wRow*effectiveFilterWidth+wCol?1:0,pixel;if(0!==mask)dotProd+=dyBuf.get(batch,dyDepth,dyRow,dyCol,channel)*mask}}}}dx.set(dotProd,batch,dxDepth,dxRow,dxCol,channel)}return dx.toTensor()},MathBackendCPU.prototype.cast=function(x,dtype){return backend_util.castTensor(x,dtype,this)},MathBackendCPU.prototype.reshape=function(x,shape){return backend_util.reshapeTensor(x,shape)},MathBackendCPU.prototype.avgPool=function(x,convInfo){return this.assertNotComplex(x,"avgPool"),this.pool(x,convInfo,"avg").toFloat()},MathBackendCPU.prototype.resizeBilinear=function(x,newHeight,newWidth,alignCorners){this.assertNotComplex(x,"resizeBilinear");for(var _a=x.shape,batch=_a[0],oldHeight=_a[1],oldWidth=_a[2],numChannels=_a[3],xValues=this.readSync(x.dataId),result=new Float32Array(util.sizeFromShape([batch,newHeight,newWidth,numChannels])),effectiveInputSize=[alignCorners&&newHeight>1?oldHeight-1:oldHeight,alignCorners&&newWidth>1?oldWidth-1:oldWidth],effectiveOutputSize=[alignCorners&&newHeight>1?newHeight-1:newHeight,alignCorners&&newWidth>1?newWidth-1:newWidth],outputIdx=0,effectiveRowSizeRatio=effectiveInputSize[0]/effectiveOutputSize[0],effectiveColSizeRatio=effectiveInputSize[1]/effectiveOutputSize[1],b=0;b<batch;b++)for(var r=0;r<newHeight;r++)for(var sourceFracRow=effectiveRowSizeRatio*r,sourceRowFloor=Math.floor(sourceFracRow),rowFrac=sourceFracRow-sourceRowFloor,sourceRowCeil=Math.min(oldHeight-1,Math.ceil(sourceFracRow)),topRowOffset=b*x.strides[0]+sourceRowFloor*x.strides[1],botRowOffset=b*x.strides[0]+sourceRowCeil*x.strides[1],c=0;c<newWidth;c++)for(var sourceFracCol=effectiveColSizeRatio*c,sourceColFloor=Math.floor(sourceFracCol),colFrac=sourceFracCol-sourceColFloor,sourceColCeil=Math.min(oldWidth-1,Math.ceil(sourceFracCol)),topLeftOffest=topRowOffset+sourceColFloor*x.strides[2],botLeftOffset=botRowOffset+sourceColFloor*x.strides[2],topRightOffset=topRowOffset+ +sourceColCeil*x.strides[2],botRightOffest=botRowOffset+sourceColCeil*x.strides[2],d=0;d<numChannels;d++){var topLeft=xValues[topLeftOffest+d],bottomLeft=xValues[botLeftOffset+d],topRight,bottomRight,top_1=topLeft+(xValues[topRightOffset+d]-topLeft)*colFrac,bottom,newValue=top_1+(bottomLeft+(xValues[botRightOffest+d]-bottomLeft)*colFrac-top_1)*rowFrac;result[outputIdx++]=newValue}return ops.tensor(result,[batch,newHeight,newWidth,numChannels])},MathBackendCPU.prototype.resizeBilinearBackprop=function(dy,x,alignCorners){this.assertNotComplex([dy,x],"resizeBilinearBackprop");for(var _a=x.shape,batch=_a[0],xHeight=_a[1],xWidth=_a[2],depth=_a[3],_b=dy.shape,yHeight=_b[1],yWidth=_b[2],output=new Float32Array(batch*xHeight*xWidth*depth),effectiveXSize=[alignCorners&&yHeight>1?xHeight-1:xHeight,alignCorners&&yWidth>1?xWidth-1:xWidth],effectiveYSize=[alignCorners&&yHeight>1?yHeight-1:yHeight,alignCorners&&yWidth>1?yWidth-1:yWidth],heightScale=effectiveXSize[0]/effectiveYSize[0],widthScale=effectiveXSize[1]/effectiveYSize[1],dyValues=this.readSync(dy.dataId),offset=0,b=0;b<batch;b++)for(var bOffset=b*x.strides[0],r=0;r<yHeight;r++)for(var dxR=r*heightScale,topDxRIndex=Math.floor(dxR),bottomDxRIndex=Math.min(Math.ceil(dxR),xHeight-1),topDxROffset=bOffset+topDxRIndex*x.strides[1],bottomDxROffset=bOffset+bottomDxRIndex*x.strides[1],dxRLerp=dxR-topDxRIndex,inverseDxRLerp=1-dxRLerp,c=0;c<yWidth;c++)for(var dxC=c*widthScale,leftDxCIndex=Math.floor(dxC),rightDxCIndex=Math.min(Math.ceil(dxC),xWidth-1),dxCLerp=dxC-leftDxCIndex,inverseDxCLerp=1-dxCLerp,topLeftRCOffset=topDxROffset+leftDxCIndex*x.strides[2],topRightRCOffset=topDxROffset+rightDxCIndex*x.strides[2],bottomLeftRCOffset=bottomDxROffset+leftDxCIndex*x.strides[2],bottomRightRCOffset=bottomDxROffset+rightDxCIndex*x.strides[2],inverseDxRLerpTimesInverseDxCLerp=inverseDxRLerp*inverseDxCLerp,inverseDxRLerpTimesDxCLerp=inverseDxRLerp*dxCLerp,dxRLerpTimesInverseDxCLerp=dxRLerp*inverseDxCLerp,dxRLerpTimesDxCLerp=dxRLerp*dxCLerp,d=0;d<depth;d++){var dyVal=dyValues[offset++];output[topLeftRCOffset+d]+=dyVal*inverseDxRLerpTimesInverseDxCLerp,output[topRightRCOffset+d]+=dyVal*inverseDxRLerpTimesDxCLerp,output[bottomLeftRCOffset+d]+=dyVal*dxRLerpTimesInverseDxCLerp,output[bottomRightRCOffset+d]+=dyVal*dxRLerpTimesDxCLerp}return ops.tensor4d(output,[batch,xWidth,xHeight,depth],x.dtype)},MathBackendCPU.prototype.resizeNearestNeighbor=function(x,newHeight,newWidth,alignCorners){this.assertNotComplex(x,"resizeNearestNeighbor");for(var _a=x.shape,batch=_a[0],oldHeight=_a[1],oldWidth=_a[2],numChannels=_a[3],xValues=this.readSync(x.dataId),output=new Float32Array(batch*newHeight*newWidth*numChannels),effectiveInputSize=[alignCorners&&newHeight>1?oldHeight-1:oldHeight,alignCorners&&newWidth>1?oldWidth-1:oldWidth],effectiveOutputSize=[alignCorners&&newHeight>1?newHeight-1:newHeight,alignCorners&&newWidth>1?newWidth-1:newWidth],effectiveRowSizeRatio=effectiveInputSize[0]/effectiveOutputSize[0],effectiveColSizeRatio=effectiveInputSize[1]/effectiveOutputSize[1],outputOffset=0,b=0;b<batch;b++)for(var batchOffset=b*x.strides[0],r=0;r<newHeight;r++)for(var sourceFracRow=effectiveRowSizeRatio*r,sourceNearestRow,rowOffset=batchOffset+Math.min(oldHeight-1,alignCorners?Math.round(sourceFracRow):Math.floor(sourceFracRow))*x.strides[1],c=0;c<newWidth;c++)for(var sourceFracCol=effectiveColSizeRatio*c,sourceNearestCol,colOffset=rowOffset+Math.min(oldWidth-1,alignCorners?Math.round(sourceFracCol):Math.floor(sourceFracCol))*x.strides[2],d=0;d<numChannels;d++){var newVal=xValues[colOffset+d];output[outputOffset++]=newVal}return ops.tensor(output,[batch,newHeight,newWidth,numChannels],x.dtype)},MathBackendCPU.prototype.resizeNearestNeighborBackprop=function(dy,x,alignCorners){this.assertNotComplex([dy,x],"resizeNearestNeighborBackprop");for(var _a=x.shape,batch=_a[0],xHeight=_a[1],xWidth=_a[2],depth=_a[3],_b=dy.shape,yHeight=_b[1],yWidth=_b[2],output=new Float32Array(batch*xHeight*xWidth*depth),dyValues=this.readSync(dy.dataId),effectiveXSize=[alignCorners&&yHeight>1?xHeight-1:xHeight,alignCorners&&yWidth>1?xWidth-1:xWidth],effectiveYSize=[alignCorners&&yHeight>1?yHeight-1:yHeight,alignCorners&&yWidth>1?yWidth-1:yWidth],heightScale=effectiveXSize[0]/effectiveYSize[0],widthScale=effectiveXSize[1]/effectiveYSize[1],invHeightScale=1/heightScale,invWidthScale=1/widthScale,winHeight=2*Math.ceil(invHeightScale)+2,winWidth=2*Math.ceil(invWidthScale)+2,b=0;b<batch;b++)for(var batchOffset=b*x.strides[0],r=0;r<xHeight;r++)for(var rowOffset=batchOffset+r*x.strides[1],startRLerp=Math.floor(r*invHeightScale),startDyR=Math.floor(startRLerp-winHeight/2),c=0;c<xWidth;c++)for(var colOffset=rowOffset+c*x.strides[2],startCLerp=Math.floor(c*invWidthScale),startDyC=Math.floor(startCLerp-winWidth/2),d=0;d<depth;d++){for(var accum=0,dyRIndex=0;dyRIndex<winHeight;dyRIndex++){var dyR=dyRIndex+startDyR;if(!(dyR<0||dyR>=yHeight)){var dyROffset=batchOffset+dyR*dy.strides[1],sourceFracRow=dyR*heightScale,sourceNearestRow;if(r===Math.min(xHeight-1,alignCorners?Math.round(sourceFracRow):Math.floor(sourceFracRow)))for(var dyCIndex=0;dyCIndex<winWidth;dyCIndex++){var dyC=dyCIndex+startDyC;if(!(dyC<0||dyC>=yWidth)){var dyCOffset=dyROffset+dyC*dy.strides[2],sourceFracCol=dyC*widthScale,sourceNearestCol;c===Math.min(xWidth-1,alignCorners?Math.round(sourceFracCol):Math.floor(sourceFracCol))&&(accum+=dyValues[dyCOffset+d])}}}}output[colOffset+d]=accum}return ops.tensor4d(output,x.shape,x.dtype)},MathBackendCPU.prototype.batchNormalization=function(x,mean,variance,varianceEpsilon,scale,offset){this.assertNotComplex([x,mean,variance,scale,offset],"batchNorm");for(var xVals=this.readSync(x.dataId),mVals=this.readSync(mean.dataId),varVals=this.readSync(variance.dataId),sVals=scale?this.readSync(scale.dataId):new Float32Array([1]),offVals=offset?this.readSync(offset.dataId):new Float32Array([0]),outVals=new Float32Array(xVals.length),offValsLength=offVals.length,sValsLength=sVals.length,varValsLength=varVals.length,mValsLength=mVals.length,offi=0,mi=0,si=0,vi=0,i=0;i<xVals.length;++i)outVals[i]=offVals[offi++]+(xVals[i]-mVals[mi++])*sVals[si++]/Math.sqrt(varVals[vi++]+varianceEpsilon),offi>=offValsLength&&(offi=0),mi>=mValsLength&&(mi=0),si>=sValsLength&&(si=0),vi>=varValsLength&&(vi=0);return ops_1.tensor4d(outVals,x.shape)},MathBackendCPU.prototype.localResponseNormalization4D=function(x,depthRadius,bias,alpha,beta){this.assertNotComplex(x,"localResponseNormalization4D");var channels=x.shape[3],maxD=channels-1,xValues=this.readSync(x.dataId),size=x.size,result=new Float32Array(size);function sumAcrossChannels(offset){for(var currentChannel=offset%channels,beginSumOffset=offset-currentChannel+Math.max(0,currentChannel-depthRadius),endSumOffset=offset-currentChannel+Math.min(currentChannel+depthRadius,maxD),sum=0;beginSumOffset<=endSumOffset;beginSumOffset++){var z=xValues[beginSumOffset];sum+=z*z}return sum}for(var offset=0;offset<size;offset++){var sum=sumAcrossChannels(offset),val=xValues[offset]*Math.pow(bias+alpha*sum,-beta);result[offset]=val}return ops.tensor4d(result,x.shape)},MathBackendCPU.prototype.LRNGrad=function(dy,inputImage,outputImage,depthRadius,bias,alpha,beta){this.assertNotComplex(dy,"LRNGrad");for(var channels=dy.shape[3],dyValues=this.readSync(dy.dataId),inputImageValues=this.readSync(inputImage.dataId),outputImageValues=this.readSync(outputImage.dataId),result=new Float32Array(dy.size),size=dy.size,offset=0;offset<size;offset++){for(var currentChannel=offset%channels,depthBegin=offset-currentChannel+Math.max(0,currentChannel-depthRadius),depthEnd=offset-currentChannel+Math.min(channels,currentChannel+depthRadius+1),norm=0,k=depthBegin;k<depthEnd;k++)norm+=Math.pow(inputImageValues[k],2);norm=alpha*norm+bias;for(var k=depthBegin;k<depthEnd;k++){var dyi=-2*alpha*beta*inputImageValues[k]*outputImageValues[offset]/norm;offset===k&&(dyi+=Math.pow(norm,-beta)),dyi*=dyValues[offset],result[k]+=dyi}}return ops.tensor4d(result,dy.shape)},MathBackendCPU.prototype.multinomial=function(logits,normalized,numSamples,seed){this.assertNotComplex(logits,"multinomial");for(var probabilities=normalized?logits:ops.softmax(logits),batchSize=probabilities.shape[0],numEvents=probabilities.shape[1],res=ops.zeros([batchSize,numSamples],"int32"),resVals=this.readSync(res.dataId),probVals=this.readSync(probabilities.dataId),b=0;b<batchSize;++b){var offset=b*numEvents,cdf=new Float32Array(numEvents-1);cdf[0]=probVals[offset];for(var event_1=1;event_1<cdf.length;++event_1)cdf[event_1]=cdf[event_1-1]+probVals[offset+event_1];for(var random=seedrandom.alea(seed.toString()),outOffset=b*numSamples,sampleId=0;sampleId<numSamples;++sampleId){var r=random();resVals[outOffset+sampleId]=cdf.length;for(var event_2=0;event_2<cdf.length;event_2++)if(r<cdf[event_2]){resVals[outOffset+sampleId]=event_2;break}}}return res},MathBackendCPU.prototype.oneHot=function(indices,depth,onValue,offValue){this.assertNotComplex(indices,"oneHot");var res=new Float32Array(indices.size*depth);res.fill(offValue);for(var indicesVal=this.readSync(indices.dataId),event_3=0;event_3<indices.size;++event_3)indicesVal[event_3]>=0&&indicesVal[event_3]<depth&&(res[event_3*depth+indicesVal[event_3]]=onValue);return ops.tensor2d(res,[indices.size,depth],"int32")},MathBackendCPU.prototype.nonMaxSuppression=function(boxes,scores,maxOutputSize,iouThreshold,scoreThreshold){this.assertNotComplex(boxes,"nonMaxSuppression");var boxesVals=this.readSync(boxes.dataId),scoresVals=this.readSync(scores.dataId);return non_max_suppression_impl_1.nonMaxSuppressionImpl(boxesVals,scoresVals,maxOutputSize,iouThreshold,scoreThreshold)},MathBackendCPU.prototype.fft=function(x){return this.fftBatch(x,!1)},MathBackendCPU.prototype.ifft=function(x){return this.fftBatch(x,!0)},MathBackendCPU.prototype.fftBatch=function(x,inverse){for(var batch=x.shape[0],innerDim=x.shape[1],realResult=ops.buffer(x.shape,"float32"),imagResult=ops.buffer(x.shape,"float32"),real=ops.real(x).as2D(batch,innerDim),imag=ops.imag(x).as2D(batch,innerDim),b=0;b<batch;b++)for(var r=real.slice([b,0],[1,innerDim]),i=imag.slice([b,0],[1,innerDim]),input=ops.complex(r,i),res=this.readSync(this.fftImpl(input,inverse).dataId),d=0;d<innerDim;d++){var c=complex_util.getComplexWithIndex(res,d);realResult.values[b*innerDim+d]=c.real,imagResult.values[b*innerDim+d]=c.imag}var t;return ops.complex(realResult.toTensor(),imagResult.toTensor()).as2D(batch,innerDim)},MathBackendCPU.prototype.fftImpl=function(x,inverse){var x1D=x.as1D(),n=x1D.size;if(this.isExponentOf2(n)){var result=this.fftRadix2(x1D,n,inverse).as2D(x.shape[0],x.shape[1]);return inverse&&(result=ops.complex(ops.real(result).div(ops_1.scalar(n)),ops.imag(result).div(ops_1.scalar(n)))),result}var data=this.readSync(x.dataId),rawOutput=this.fourierTransformByMatmul(data,n,inverse),output=complex_util.splitRealAndImagArrays(rawOutput);return ops.complex(output.real,output.imag).as2D(x.shape[0],x.shape[1])},MathBackendCPU.prototype.isExponentOf2=function(size){return 0==(size&size-1)},MathBackendCPU.prototype.fftRadix2=function(input,size,inverse){if(1===size)return input;var data=this.readSync(input.dataId),half=size/2,evenComplex=complex_util.complexWithEvenIndex(data),evenTensor=ops.complex(evenComplex.real,evenComplex.imag).as1D(),oddComplex=complex_util.complexWithOddIndex(data),oddTensor=ops.complex(oddComplex.real,oddComplex.imag).as1D();evenTensor=this.fftRadix2(evenTensor,half,inverse),oddTensor=this.fftRadix2(oddTensor,half,inverse);var e=complex_util.exponents(size,inverse),exponent=ops.complex(e.real,e.imag).mul(oddTensor),addPart=evenTensor.add(exponent),subPart=evenTensor.sub(exponent),realTensor=ops.real(addPart).concat(ops.real(subPart)),imagTensor=ops.imag(addPart).concat(ops.imag(subPart));return ops.complex(realTensor,imagTensor).as1D()},MathBackendCPU.prototype.fourierTransformByMatmul=function(data,size,inverse){for(var ret=new Float32Array(2*size),r=0;r<size;r++){for(var real_2=0,imag_2=0,c=0;c<size;c++){var e=complex_util.exponent(r*c,size,inverse),term=complex_util.getComplexWithIndex(data,c);real_2+=term.real*e.real-term.imag*e.imag,imag_2+=term.real*e.imag+term.imag*e.real}inverse&&(real_2/=size,imag_2/=size),complex_util.assignToTypedArray(ret,real_2,imag_2,r)}return ret},MathBackendCPU.prototype.depthToSpace=function(x,blockSize,dataFormat){util.assert("NHWC"===dataFormat,(function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+dataFormat})),util.assert(blockSize>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: "+blockSize}));for(var batchSize=x.shape[0],inputHeight=x.shape[1],inputWidth=x.shape[2],inputDepth=x.shape[3],outputHeight=inputHeight*blockSize,outputWidth=inputWidth*blockSize,outputDepth=inputDepth/(blockSize*blockSize),xValues=this.readSync(x.dataId),result=new Float32Array(batchSize*outputHeight*outputWidth*outputDepth),outputIdx=0,b=0;b<batchSize;++b)for(var h=0;h<outputHeight;++h)for(var inH=Math.floor(h/blockSize),offsetH=h%blockSize,w=0;w<outputWidth;++w)for(var inW=Math.floor(w/blockSize),offsetW,offsetD=(offsetH*blockSize+w%blockSize)*outputDepth,d=0;d<outputDepth;++d){var inD,inputIdx=d+offsetD+inputDepth*(inW+inputWidth*(inH+inputHeight*b));result[outputIdx++]=xValues[inputIdx]}return ops.tensor4d(result,[batchSize,outputHeight,outputWidth,outputDepth])},MathBackendCPU.prototype.broadcastedBinaryOp=function(a,b,dtype,op){var newShape=broadcast_util.assertAndGetBroadcastShape(a.shape,b.shape),result=ops.buffer(newShape,dtype),aVals=this.readSync(a.dataId),bVals=this.readSync(b.dataId),aBroadcastDims=broadcast_util.getBroadcastDims(a.shape,newShape),bBroadcastDims=broadcast_util.getBroadcastDims(b.shape,newShape),resVals=result.values;if(aBroadcastDims.length+bBroadcastDims.length===0)for(var i=0;i<resVals.length;++i)resVals[i]=op(aVals[i%aVals.length],bVals[i%bVals.length]);else for(var aBuf=this.bufferSync(a),bBuf=this.bufferSync(b),_loop_2=function(i){var loc=result.indexToLoc(i),aLoc=loc.slice(-a.rank);aBroadcastDims.forEach((function(d){return aLoc[d]=0}));var aIndex=aBuf.locToIndex(aLoc),bLoc=loc.slice(-b.rank);bBroadcastDims.forEach((function(d){return bLoc[d]=0}));var bIndex=bBuf.locToIndex(bLoc);resVals[i]=op(aVals[aIndex],bVals[bIndex])},i=0;i<resVals.length;++i)_loop_2(i);return result.toTensor()},MathBackendCPU.prototype.broadcastedBinaryComplexOp=function(a,b,op){var newShape=broadcast_util.assertAndGetBroadcastShape(a.shape,b.shape),realResult=ops.buffer(newShape,"float32"),imagResult=ops.buffer(newShape,"float32"),aVals=this.readSync(a.dataId),bVals=this.readSync(b.dataId),aBroadcastDims=broadcast_util.getBroadcastDims(a.shape,newShape),bBroadcastDims=broadcast_util.getBroadcastDims(b.shape,newShape),realVals=realResult.values,imagVals=imagResult.values;if(aBroadcastDims.length+bBroadcastDims.length===0)for(var i=0;i<realVals.length;i++){var aIdx=i%aVals.length,bIdx=i%bVals.length,result=op(aVals[2*aIdx],aVals[2*aIdx+1],bVals[2*bIdx],bVals[2*bIdx+1]);realVals[i]=result.real,imagVals[i]=result.imag}else for(var aRealBuf=this.bufferSync(this.data.get(a.dataId).complexTensors.real),bRealBuf=this.bufferSync(this.data.get(b.dataId).complexTensors.real),_loop_3=function(i){var loc=realResult.indexToLoc(i),aLoc=loc.slice(-a.rank);aBroadcastDims.forEach((function(d){return aLoc[d]=0}));var aIndex=aRealBuf.locToIndex(aLoc),bLoc=loc.slice(-b.rank);bBroadcastDims.forEach((function(d){return bLoc[d]=0}));var bIndex=bRealBuf.locToIndex(bLoc),opResult=op(aVals[2*aIndex],aVals[2*aIndex+1],bVals[2*bIndex],bVals[2*bIndex+1]);realVals[i]=opResult.real,imagVals[i]=opResult.imag},i=0;i<realVals.length;i++)_loop_3(i);return this.complex(realResult.toTensor(),imagResult.toTensor())},MathBackendCPU.prototype.split=function(x,sizeSplits,axis){return split_shared_1.split(x,sizeSplits,axis)},MathBackendCPU.prototype.dispose=function(){},MathBackendCPU.prototype.floatPrecision=function(){return 32},MathBackendCPU.prototype.epsilon=function(){return backend_1.EPSILON_FLOAT32},MathBackendCPU.prototype.cropAndResize=function(images,boxes,boxIndex,cropSize,method,extrapolationValue){for(var _a=images.shape,batch=_a[0],imageHeight=_a[1],imageWidth=_a[2],numChannels=_a[3],numBoxes=boxes.shape[0],cropHeight=cropSize[0],cropWidth=cropSize[1],output=ops.buffer([numBoxes,cropHeight,cropWidth,numChannels],images.dtype),boxVals=this.readSync(boxes.dataId),boxIndVals=this.readSync(boxIndex.dataId),imageVals=this.readSync(images.dataId),inStride=images.strides,outStride=output.strides,b=0;b<numBoxes;b++){var startInd=4*b,y1=boxVals[startInd],x1=boxVals[startInd+1],y2=boxVals[startInd+2],x2=boxVals[startInd+3],bInd=boxIndVals[b];if(!(bInd>=batch))for(var heightScale=cropHeight>1?(y2-y1)*(imageHeight-1)/(cropHeight-1):0,widthScale=cropWidth>1?(x2-x1)*(imageWidth-1)/(cropWidth-1):0,y=0;y<cropHeight;y++){var yInd=cropHeight>1?y1*(imageHeight-1)+y*heightScale:.5*(y1+y2)*(imageHeight-1);if(yInd<0||yInd>imageHeight-1)for(var x=0;x<cropWidth;x++)for(var c=0;c<numChannels;c++){var ind=c+x*outStride[2]+y*outStride[1]+b*outStride[0];output.values[ind]=extrapolationValue}else if("bilinear"===method)for(var topInd=Math.floor(yInd),bottomInd=Math.ceil(yInd),yLerp=yInd-topInd,x=0;x<cropWidth;x++){var xInd;if((xInd=cropWidth>1?x1*(imageWidth-1)+x*widthScale:.5*(x1+x2)*(imageWidth-1))<0||xInd>imageWidth-1)for(var c=0;c<numChannels;c++){var ind=c+x*outStride[2]+y*outStride[1]+b*outStride[0];output.values[ind]=extrapolationValue}else for(var leftInd=Math.floor(xInd),rightInd=Math.ceil(xInd),xLerp=xInd-leftInd,c=0;c<numChannels;c++){var ind,topLeft=imageVals[ind=c+leftInd*inStride[2]+topInd*inStride[1]+bInd*inStride[0]],topRight=imageVals[ind=c+rightInd*inStride[2]+topInd*inStride[1]+bInd*inStride[0]],bottomLeft=imageVals[ind=c+leftInd*inStride[2]+bottomInd*inStride[1]+bInd*inStride[0]],bottomRight,top_2=topLeft+(topRight-topLeft)*xLerp,bottom=bottomLeft+(imageVals[ind=c+rightInd*inStride[2]+bottomInd*inStride[1]+bInd*inStride[0]]-bottomLeft)*xLerp;ind=c+x*outStride[2]+y*outStride[1]+b*outStride[0],output.values[ind]=top_2+(bottom-top_2)*yLerp}}else for(var x=0;x<cropWidth;++x){var xInd;if((xInd=cropWidth>1?x1*(imageWidth-1)+x*widthScale:.5*(x1+x2)*(imageWidth-1))<0||xInd>imageWidth-1)for(var c=0;c<numChannels;c++){var ind=c+x*outStride[2]+y*outStride[1]+b*outStride[0];output.values[ind]=extrapolationValue}else for(var closestX=Math.round(xInd),closestY=Math.round(yInd),c=0;c<numChannels;c++){var inInd=c+closestX*inStride[2]+closestY*inStride[1]+bInd*inStride[0],outInd=c+x*outStride[2]+y*outStride[1]+b*outStride[0];output.values[outInd]=imageVals[inInd]}}}}return output.toTensor()},MathBackendCPU.prototype.sparseToDense=function(sparseIndices,sparseValues,outputShape,defaultValue){var _a=scatter_nd_util.calculateShapes(sparseValues,sparseIndices,outputShape),sliceRank=_a.sliceRank,numUpdates=_a.numUpdates,sliceSize=_a.sliceSize,strides=_a.strides,outputSize=_a.outputSize,sumDupeIndices=!1;return this.scatter(sparseIndices,sparseValues,outputShape,outputSize,sliceSize,numUpdates,sliceRank,strides,defaultValue,!1)},MathBackendCPU.prototype.gatherND=function(x,indices){var indicesShape=indices.shape,sliceRank=indicesShape[indicesShape.length-1],_a=gather_nd_util.prepareAndValidate(x,indices),resultShape=_a[0],numSlices=_a[1],sliceSize=_a[2],strides=_a[3];if(0===numSlices)return ops_1.tensor([],resultShape,x.dtype);for(var buffer=new tensor_1.TensorBuffer([numSlices,sliceSize],x.dtype),indicesData=this.readSync(indices.dataId),xData=this.readSync(x.dataId),i=0;i<numSlices;i++){for(var index=[],flattenIndex=0,j=0;j<sliceRank;j++){var dim=indicesData[i*sliceRank+j];flattenIndex+=dim*strides[j],index.push(dim)}if(flattenIndex<0||flattenIndex>=x.size/sliceSize)throw new Error("Invalid indices: "+index+" does not index into "+x.shape);for(var k=0;k<sliceSize;k++)buffer.values[i*sliceSize+k]=xData[flattenIndex*sliceSize+k]}return buffer.toTensor().reshape(resultShape)},MathBackendCPU.prototype.scatterND=function(indices,updates,shape){var _a=scatter_nd_util.calculateShapes(updates,indices,shape),sliceRank=_a.sliceRank,numUpdates=_a.numUpdates,sliceSize=_a.sliceSize,strides=_a.strides,outputSize=_a.outputSize,defaultValue=ops_1.scalar(0),sumDupeIndices=!0;return this.scatter(indices,updates,shape,outputSize,sliceSize,numUpdates,sliceRank,strides,defaultValue,!0)},MathBackendCPU.prototype.fill=function(shape,value,dtype){dtype=dtype||util_1.inferDtype(value);var values=util_1.getArrayFromDType(dtype,util_1.sizeFromShape(shape));return values.fill(value),tensor_1.Tensor.make(shape,{values:values},dtype)},MathBackendCPU.prototype.onesLike=function(x){if("string"===x.dtype)throw new Error("onesLike is not supported for string tensors");return this.fill(x.shape,1,x.dtype)},MathBackendCPU.prototype.zerosLike=function(x){var values=util_1.getArrayFromDType(x.dtype,util_1.sizeFromShape(x.shape));return tensor_1.Tensor.make(x.shape,{values:values},x.dtype)},MathBackendCPU.prototype.linspace=function(start,stop,num){return backend_util.linspaceImpl(start,stop,num)},MathBackendCPU.prototype.scatter=function(indices,updates,shape,outputSize,sliceSize,numUpdates,sliceRank,strides,defaultValue,sumDupeIndices){var flattenShape=[outputSize/sliceSize,sliceSize],indicesData=this.readSync(indices.dataId),updatesData=this.readSync(updates.dataId);if(0===outputSize)return ops_1.tensor([],shape,updates.dtype);var buffer=new tensor_1.TensorBuffer(flattenShape,updates.dtype);buffer.values.fill(this.readSync(defaultValue.dataId)[0]);for(var i=0;i<numUpdates;i++){for(var index=[],flattenIndex=0,j=0;j<sliceRank;j++){var dim=indicesData[i*sliceRank+j];index.push(dim),flattenIndex+=dim*strides[j]}if(flattenIndex<0||flattenIndex>=outputSize/sliceSize)throw new Error("Invalid indices: "+index+" does not index into "+shape);for(var k=0;k<sliceSize;k++)sumDupeIndices?buffer.values[flattenIndex*sliceSize+k]+=updatesData[i*sliceSize+k]:buffer.values[flattenIndex*sliceSize+k]=0===updates.rank?updatesData[0]:updatesData[i*sliceSize+k]}return buffer.toTensor().reshape(shape)},MathBackendCPU}();exports.MathBackendCPU=MathBackendCPU,engine_1.ENGINE.registerBackend("cpu",(function(){return new MathBackendCPU}),1)},{"../../engine":150,"../../environment":151,"../../log":168,"../../ops/array_ops_util":171,"../../ops/axis_util":172,"../../ops/broadcast_util":176,"../../ops/complex_ops":179,"../../ops/concat_util":181,"../../ops/erf_util":188,"../../ops/gather_nd_util":191,"../../ops/ops":203,"../../ops/scatter_nd_util":211,"../../ops/selu_util":214,"../../ops/slice_util":217,"../../tensor":241,"../../types":247,"../../util":248,"../backend":57,"../backend_util":58,"../complex_util":59,"../non_max_suppression_impl":61,"../split_shared":63,"../tile_impl":64,"../topk_impl":65,"../where_impl":147,seedrandom:512}],61:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var tensor_ops_1=require("../ops/tensor_ops");function nonMaxSuppressionImpl(boxes,scores,maxOutputSize,iouThreshold,scoreThreshold){for(var candidates=Array.from(scores).map((function(score,boxIndex){return{score:score,boxIndex:boxIndex}})).filter((function(c){return c.score>scoreThreshold})).sort((function(c1,c2){return c2.score-c1.score})),selected=[],i=0;i<candidates.length;i++){var _a=candidates[i],score=_a.score,boxIndex=_a.boxIndex;if(score<scoreThreshold)break;for(var ignoreCandidate=!1,j=selected.length-1;j>=0;--j){var iou;if(intersectionOverUnion(boxes,boxIndex,selected[j])>=iouThreshold){ignoreCandidate=!0;break}}if(!ignoreCandidate&&(selected.push(boxIndex),selected.length>=maxOutputSize))break}return tensor_ops_1.tensor1d(selected,"int32")}function intersectionOverUnion(boxes,i,j){var iCoord=boxes.subarray(4*i,4*i+4),jCoord=boxes.subarray(4*j,4*j+4),yminI=Math.min(iCoord[0],iCoord[2]),xminI=Math.min(iCoord[1],iCoord[3]),ymaxI=Math.max(iCoord[0],iCoord[2]),xmaxI=Math.max(iCoord[1],iCoord[3]),yminJ=Math.min(jCoord[0],jCoord[2]),xminJ=Math.min(jCoord[1],jCoord[3]),ymaxJ=Math.max(jCoord[0],jCoord[2]),xmaxJ=Math.max(jCoord[1],jCoord[3]),areaI=(ymaxI-yminI)*(xmaxI-xminI),areaJ=(ymaxJ-yminJ)*(xmaxJ-xminJ);if(areaI<=0||areaJ<=0)return 0;var intersectionYmin=Math.max(yminI,yminJ),intersectionXmin=Math.max(xminI,xminJ),intersectionYmax=Math.min(ymaxI,ymaxJ),intersectionXmax=Math.min(xmaxI,xmaxJ),intersectionArea=Math.max(intersectionYmax-intersectionYmin,0)*Math.max(intersectionXmax-intersectionXmin,0);return intersectionArea/(areaI+areaJ-intersectionArea)}exports.nonMaxSuppressionImpl=nonMaxSuppressionImpl},{"../ops/tensor_ops":223}],62:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function getVecChannels(name,rank){return["x","y","z","w","u","v"].slice(0,rank).map((function(d){return name+"."+d}))}function getChannels(name,rank){return 1===rank?[name]:getVecChannels(name,rank)}function getSourceCoords(rank,dims){if(1===rank)return"rc";for(var coords="",i=0;i<rank;i++)coords+=dims[i],i<rank-1&&(coords+=",");return coords}Object.defineProperty(exports,"__esModule",{value:!0}),exports.getVecChannels=getVecChannels,exports.getChannels=getChannels,exports.getSourceCoords=getSourceCoords},{}],63:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function split(x,sizeSplits,axis){var begin=new Array(x.rank).fill(0),size=x.shape.slice();return sizeSplits.map((function(s){size[axis]=s;var slice=x.slice(begin,size);return begin[axis]+=s,slice}))}Object.defineProperty(exports,"__esModule",{value:!0}),exports.split=split},{}],64:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var array_ops_1=require("../ops/array_ops");function tile(xBuf,reps){for(var newShape=new Array(xBuf.rank),i=0;i<newShape.length;i++)newShape[i]=xBuf.shape[i]*reps[i];for(var result=array_ops_1.buffer(newShape,xBuf.dtype),i=0;i<result.values.length;++i){for(var newLoc=result.indexToLoc(i),originalLoc=new Array(xBuf.rank),i_1=0;i_1<originalLoc.length;i_1++)originalLoc[i_1]=newLoc[i_1]%xBuf.shape[i_1];var originalIndex=xBuf.locToIndex(originalLoc);result.values[i]=xBuf.values[originalIndex]}return result.toTensor()}exports.tile=tile},{"../ops/array_ops":170}],65:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var tensor_ops_1=require("../ops/tensor_ops"),util_1=require("../util");function topkImpl(x,xShape,xDtype,k,sorted){for(var lastDim=xShape[xShape.length-1],_a=[x.length/lastDim,lastDim],batch=_a[0],size=_a[1],allTopKVals=util_1.getTypedArrayFromDType(xDtype,batch*k),allTopKIndices=util_1.getTypedArrayFromDType("int32",batch*k),b=0;b<batch;b++){for(var offset=b*size,vals=x.subarray(offset,offset+size),valAndInd=[],i=0;i<vals.length;i++)valAndInd.push({value:vals[i],index:i});valAndInd.sort((function(a,b){return b.value-a.value}));for(var outOffset=b*k,topKVals=allTopKVals.subarray(outOffset,outOffset+k),topKIndices=allTopKIndices.subarray(outOffset,outOffset+k),i=0;i<k;i++)topKVals[i]=valAndInd[i].value,topKIndices[i]=valAndInd[i].index}var outputShape=xShape.slice();return outputShape[outputShape.length-1]=k,[tensor_ops_1.tensor(allTopKVals,outputShape,xDtype),tensor_ops_1.tensor(allTopKIndices,outputShape,"int32")]}exports.topkImpl=topkImpl},{"../ops/tensor_ops":223,"../util":248}],66:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2019 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var AddNProgram=function(){function AddNProgram(outputShape,shapes){this.outputShape=[],this.outputShape=outputShape,this.variableNames=shapes.map((function(_,i){return"T"+i}));var snippets=[];this.variableNames.forEach((function(variable){snippets.push("float v"+variable+" = get"+variable+"AtOutCoords();")}));var operation=this.variableNames.map((function(variable){return"v"+variable})).join(" + ");this.userCode="\n      void main() {\n        "+snippets.join("\n        ")+"\n\n        float result = "+operation+";\n        setOutput(result);\n      }\n    "}return AddNProgram}();exports.AddNProgram=AddNProgram},{}],67:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2019 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var AddNPackedProgram=function(){function AddNPackedProgram(outputShape,shapes){this.outputShape=[],this.usesPackedTextures=!0,this.outputShape=outputShape,this.variableNames=shapes.map((function(_,i){return"T"+i}));var snippets=[];this.variableNames.forEach((function(variable){snippets.push("vec4 v"+variable+" = get"+variable+"AtOutCoords();")}));var operation=this.variableNames.map((function(variable){return"v"+variable})).join(" + ");this.userCode="\n      void main() {\n        "+snippets.join("\n        ")+"\n\n        vec4 result = "+operation+";\n        setOutput(result);\n      }\n    "}return AddNPackedProgram}();exports.AddNPackedProgram=AddNPackedProgram},{}],68:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2017 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var ArgMinMaxProgram=function(){function ArgMinMaxProgram(reduceInfo,op,firstPass){this.variableNames=["A"];var windowSize=reduceInfo.windowSize,batchSize=reduceInfo.batchSize,inSize=reduceInfo.inSize,outSize=Math.ceil(inSize/windowSize);firstPass||this.variableNames.push("bestIndicesA"),this.outputShape=[batchSize,outSize];var compOp="max"===op?">":"<",indexSnippet=firstPass?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+windowSize+";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < "+windowSize+"; i++) {\n          int inIdx = "+indexSnippet+";\n          float candidate = getA(batch, inIdx);\n          if (candidate "+compOp+" bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    "}return ArgMinMaxProgram}();exports.ArgMinMaxProgram=ArgMinMaxProgram},{}],69:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2019 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var util_1=require("../../util"),packing_util_1=require("../packing_util"),shader_compiler_1=require("./shader_compiler"),ArgMinMaxPackedProgram=function(){function ArgMinMaxPackedProgram(shape,windowSize,op,firstPass){this.variableNames=["A"],this.usesPackedTextures=!0,util_1.assert(shape.length>2,(function(){return"Packed arg"+(op.charAt(0).toUpperCase()+op.slice(1))+" supports only inputs with rank above 2."}));var inSize=shape[shape.length-1],outSize=Math.ceil(inSize/windowSize);this.outputShape=shape.slice(0,-1),outSize>1&&this.outputShape.push(outSize),firstPass||this.variableNames.push("bestIndicesA");var outShape=this.outputShape,rank=outShape.length,dtype=shader_compiler_1.getCoordsDataType(rank),coords=packing_util_1.getChannels("coords",rank),sourceLocSetup,sourceRank;if(1===outSize){sourceRank=rank+1;var sourceLocDType=shader_compiler_1.getCoordsDataType(sourceRank);sourceLocSetup="\n        "+sourceLocDType+" sourceLocR = "+sourceLocDType+"("+coords.join()+", 0);\n        ++"+coords[rank-1]+";\n        "+sourceLocDType+" sourceLocG = "+sourceLocDType+"("+coords.join()+", 0);\n        ++"+coords[rank-2]+";\n        "+sourceLocDType+" sourceLocA = "+sourceLocDType+"("+coords.join()+", 0);\n        --"+coords[rank-1]+";\n        "+sourceLocDType+" sourceLocB = "+sourceLocDType+"("+coords.join()+", 0);\n        --"+coords[rank-2]+";"}else sourceRank=rank,sourceLocSetup="\n        "+dtype+" sourceLocR = coords;\n        ++"+coords[rank-1]+";\n        "+dtype+" sourceLocG = coords;\n        ++"+coords[rank-2]+";\n        "+dtype+" sourceLocA = coords;\n        --"+coords[rank-1]+";\n        "+dtype+" sourceLocB = coords;\n        --"+coords[rank-2]+";";var channels=["x","y","z","w","u","v"].slice(0,sourceRank),inChannel="."+channels[sourceRank-1],intChannels=channels.map((function(x){return"int "+x})),srcRCoords=packing_util_1.getChannels("sourceLocR",sourceRank-1).concat("inIdx.r"),srcGCoords=packing_util_1.getChannels("sourceLocG",sourceRank-1).concat("inIdx.g"),srcBCoords=packing_util_1.getChannels("sourceLocB",sourceRank-1).concat("inIdx.b"),srcACoords=packing_util_1.getChannels("sourceLocA",sourceRank-1).concat("inIdx.a"),compOp="max"===op?"greaterThan":"lessThan",fetchCandidateIdx=firstPass?"":"\n          inIdx = round(vec4(getBestIndicesAChannel("+srcRCoords.join()+"),\n                             getBestIndicesAChannel("+srcGCoords.join()+"),\n                             getBestIndicesAChannel("+srcBCoords.join()+"),\n                             getBestIndicesAChannel("+srcACoords.join()+")));",fetchValue="vec4(\n            getAChannel("+srcRCoords.join()+"),\n            hasNextCol ? getAChannel("+srcGCoords.join()+") : 0.,\n            hasNextRow ? getAChannel("+srcBCoords.join()+") : 0.,\n            hasNextRow && hasNextCol ? getAChannel("+srcACoords.join()+") : 0.)",getBestIndicesAChannelSnippet=firstPass?"":"\n      float getBestIndicesAChannel("+intChannels.join()+") {\n        return getChannel(getBestIndicesA("+channels.join()+"),\n                                          vec2("+channels.slice(-2).join()+"));\n      }";this.userCode="\n      float getAChannel("+intChannels.join()+") {\n        return getChannel(getA("+channels.join()+"),\n                               vec2("+channels.slice(-2).join()+"));\n      }\n      "+getBestIndicesAChannelSnippet+"\n      void main() {\n        "+dtype+" coords = getOutputCoords();\n        bool hasNextCol = "+coords[rank-1]+" < "+(outShape[rank-1]-1)+";\n        bool hasNextRow = "+coords[rank-2]+" < "+(outShape[rank-2]-1)+";\n        "+sourceLocSetup+"\n        ivec4 srcIdx = ivec4(sourceLocR"+inChannel+", sourceLocG"+inChannel+",\n          sourceLocB"+inChannel+", sourceLocA"+inChannel+") * "+windowSize+";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = "+fetchValue+";\n\n        for (int i = 0; i < "+windowSize+"; i++) {\n          inIdx = srcIdx;\n          "+fetchCandidateIdx+"\n          vec4 candidate = "+fetchValue+";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4("+compOp+"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    "}return ArgMinMaxPackedProgram}();exports.ArgMinMaxPackedProgram=ArgMinMaxPackedProgram},{"../../util":248,"../packing_util":62,"./shader_compiler":133}],70:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2017 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var AvgPool2DBackpropProgram=function(){function AvgPool2DBackpropProgram(convInfo){this.variableNames=["dy"],this.outputShape=convInfo.inShape;var filterHeight=convInfo.filterHeight,filterWidth=convInfo.filterWidth,strideHeight=convInfo.strideHeight,strideWidth=convInfo.strideWidth,dilationHeight=convInfo.dilationHeight,dilationWidth=convInfo.dilationWidth,effectiveFilterHeight=convInfo.effectiveFilterHeight,effectiveFilterWidth=convInfo.effectiveFilterWidth,padTop=effectiveFilterHeight-1-convInfo.padInfo.top,padLeft=effectiveFilterWidth-1-convInfo.padInfo.left,avgMultiplier=1/(filterHeight*filterWidth);this.userCode="\n      const ivec2 pads = ivec2("+padTop+", "+padLeft+");\n      const float avgMultiplier = float("+avgMultiplier+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+effectiveFilterHeight+";\n            wR += "+dilationHeight+") {\n          float dyR = float(dyRCorner + wR) / "+strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+convInfo.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+effectiveFilterWidth+";\n            wC+= "+dilationWidth+") {\n            float dyC = float(dyCCorner + wC) / "+strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+convInfo.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}return AvgPool2DBackpropProgram}();exports.AvgPool2DBackpropProgram=AvgPool2DBackpropProgram;var AvgPool3DBackpropProgram=function(){function AvgPool3DBackpropProgram(convInfo){this.variableNames=["dy"],this.outputShape=convInfo.inShape;var filterDepth=convInfo.filterDepth,filterHeight=convInfo.filterHeight,filterWidth=convInfo.filterWidth,strideDepth=convInfo.strideDepth,strideHeight=convInfo.strideHeight,strideWidth=convInfo.strideWidth,dilationDepth=convInfo.dilationDepth,dilationHeight=convInfo.dilationHeight,dilationWidth=convInfo.dilationWidth,effectiveFilterDepth=convInfo.effectiveFilterDepth,effectiveFilterHeight=convInfo.effectiveFilterHeight,effectiveFilterWidth=convInfo.effectiveFilterWidth,padFront=effectiveFilterDepth-1-convInfo.padInfo.front,padTop=effectiveFilterHeight-1-convInfo.padInfo.top,padLeft=effectiveFilterWidth-1-convInfo.padInfo.left,avgMultiplier=1/(filterDepth*filterHeight*filterWidth);this.userCode="\n      const ivec3 pads = ivec3("+padFront+", "+padTop+", "+padLeft+");\n      const float avgMultiplier = float("+avgMultiplier+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+effectiveFilterDepth+";\n            wD += "+dilationDepth+") {\n          float dyD = float(dyDCorner + wD) / "+strideDepth+".0;\n\n          if (dyD < 0.0 || dyD >= "+convInfo.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+effectiveFilterHeight+";\n              wR += "+dilationHeight+") {\n            float dyR = float(dyRCorner + wR) / "+strideHeight+".0;\n\n            if (dyR < 0.0 || dyR >= "+convInfo.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+effectiveFilterWidth+";\n                wC += "+dilationWidth+") {\n              float dyC = float(dyCCorner + wC) / "+strideWidth+".0;\n\n              if (dyC < 0.0 || dyC >= "+convInfo.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}return AvgPool3DBackpropProgram}();exports.AvgPool3DBackpropProgram=AvgPool3DBackpropProgram},{}],71:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2017 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P((function(resolve){resolve(result.value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},__generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}};Object.defineProperty(exports,"__esModule",{value:!0}),require("./flags_webgl");var device_util=require("../../device_util"),engine_1=require("../../engine"),environment_1=require("../../environment"),globals_1=require("../../globals"),log_1=require("../../log"),array_ops_1=require("../../ops/array_ops"),array_ops_util=require("../../ops/array_ops_util"),axis_util=require("../../ops/axis_util"),complex_ops_1=require("../../ops/complex_ops"),concat_util_1=require("../../ops/concat_util"),gather_nd_util=require("../../ops/gather_nd_util"),reduce_util=require("../../ops/reduce_util"),scatter_nd_util=require("../../ops/scatter_nd_util"),segment_util=require("../../ops/segment_util"),slice_util=require("../../ops/slice_util"),softmax_1=require("../../ops/softmax"),tensor_ops_1=require("../../ops/tensor_ops"),tensor_1=require("../../tensor"),types_1=require("../../types"),util=require("../../util"),util_1=require("../../util"),backend_1=require("../backend"),backend_util=require("../backend_util"),complex_util_1=require("../complex_util"),non_max_suppression_impl_1=require("../non_max_suppression_impl"),split_shared_1=require("../split_shared"),tile_impl_1=require("../tile_impl"),topk_impl_1=require("../topk_impl"),where_impl_1=require("../where_impl"),addn_gpu_1=require("./addn_gpu"),addn_packed_gpu_1=require("./addn_packed_gpu"),argminmax_gpu_1=require("./argminmax_gpu"),argminmax_packed_gpu_1=require("./argminmax_packed_gpu"),avg_pool_backprop_gpu_1=require("./avg_pool_backprop_gpu"),batchnorm_gpu_1=require("./batchnorm_gpu"),batchnorm_packed_gpu_1=require("./batchnorm_packed_gpu"),binaryop_complex_gpu=require("./binaryop_complex_gpu"),binaryop_complex_gpu_1=require("./binaryop_complex_gpu"),binaryop_gpu=require("./binaryop_gpu"),binaryop_gpu_1=require("./binaryop_gpu"),binaryop_packed_gpu=require("./binaryop_packed_gpu"),binaryop_packed_gpu_1=require("./binaryop_packed_gpu"),canvas_util_1=require("./canvas_util"),clip_gpu_1=require("./clip_gpu"),clip_packed_gpu_1=require("./clip_packed_gpu"),complex_abs_gpu_1=require("./complex_abs_gpu"),concat_gpu_1=require("./concat_gpu"),concat_packed_gpu_1=require("./concat_packed_gpu"),conv_backprop_gpu_1=require("./conv_backprop_gpu"),conv_backprop_gpu_depthwise_1=require("./conv_backprop_gpu_depthwise"),conv_gpu_1=require("./conv_gpu"),conv_gpu_depthwise_1=require("./conv_gpu_depthwise"),conv_packed_gpu_depthwise_1=require("./conv_packed_gpu_depthwise"),crop_and_resize_gpu_1=require("./crop_and_resize_gpu"),cumsum_gpu_1=require("./cumsum_gpu"),decode_matrix_gpu_1=require("./decode_matrix_gpu"),decode_matrix_packed_gpu_1=require("./decode_matrix_packed_gpu"),depth_to_space_gpu_1=require("./depth_to_space_gpu"),diag_gpu_1=require("./diag_gpu"),encode_float_gpu_1=require("./encode_float_gpu"),encode_float_packed_gpu_1=require("./encode_float_packed_gpu"),encode_matrix_gpu_1=require("./encode_matrix_gpu"),encode_matrix_packed_gpu_1=require("./encode_matrix_packed_gpu"),fft_gpu=require("./fft_gpu"),fft_gpu_1=require("./fft_gpu"),fill_gpu_1=require("./fill_gpu"),from_pixels_gpu_1=require("./from_pixels_gpu"),from_pixels_packed_gpu_1=require("./from_pixels_packed_gpu"),gather_gpu_1=require("./gather_gpu"),gather_nd_gpu_1=require("./gather_nd_gpu"),gpgpu_context_1=require("./gpgpu_context"),gpgpu_math=require("./gpgpu_math"),im2col_packed_gpu_1=require("./im2col_packed_gpu"),lrn_gpu_1=require("./lrn_gpu"),lrn_grad_gpu_1=require("./lrn_grad_gpu"),lrn_packed_gpu_1=require("./lrn_packed_gpu"),max_pool_backprop_gpu_1=require("./max_pool_backprop_gpu"),mulmat_packed_gpu_1=require("./mulmat_packed_gpu"),multinomial_gpu_1=require("./multinomial_gpu"),onehot_gpu_1=require("./onehot_gpu"),pack_gpu_1=require("./pack_gpu"),pad_gpu_1=require("./pad_gpu"),pad_packed_gpu_1=require("./pad_packed_gpu"),pool_gpu_1=require("./pool_gpu"),reduce_gpu_1=require("./reduce_gpu"),reshape_packed_gpu_1=require("./reshape_packed_gpu"),resize_bilinear_backprop_gpu_1=require("./resize_bilinear_backprop_gpu"),resize_bilinear_gpu_1=require("./resize_bilinear_gpu"),resize_bilinear_packed_gpu_1=require("./resize_bilinear_packed_gpu"),resize_nearest_neighbor_backprop_gpu_1=require("./resize_nearest_neighbor_backprop_gpu"),resize_nearest_neighbor_gpu_1=require("./resize_nearest_neighbor_gpu"),reverse_gpu_1=require("./reverse_gpu"),reverse_packed_gpu_1=require("./reverse_packed_gpu"),scatter_gpu_1=require("./scatter_gpu"),segment_gpu_1=require("./segment_gpu"),select_gpu_1=require("./select_gpu"),slice_gpu_1=require("./slice_gpu"),slice_packed_gpu_1=require("./slice_packed_gpu"),strided_slice_gpu_1=require("./strided_slice_gpu"),tex_util=require("./tex_util"),tex_util_1=require("./tex_util"),texture_manager_1=require("./texture_manager"),tile_gpu_1=require("./tile_gpu"),transpose_gpu_1=require("./transpose_gpu"),transpose_packed_gpu_1=require("./transpose_packed_gpu"),unary_op=require("./unaryop_gpu"),unaryop_gpu_1=require("./unaryop_gpu"),unary_packed_op=require("./unaryop_packed_gpu"),unaryop_packed_gpu_1=require("./unaryop_packed_gpu"),unpack_gpu_1=require("./unpack_gpu"),webgl_util=require("./webgl_util"),binaryCaches={};function getBinaryCache(webGLVersion){return webGLVersion in binaryCaches?binaryCaches[webGLVersion]:(binaryCaches[webGLVersion]={},binaryCaches[webGLVersion])}function mapActivationToShaderProgram(activation,packed){if(void 0===packed&&(packed=!1),"linear"===activation)return packed?unary_packed_op.LINEAR:unary_op.LINEAR;if("relu"===activation)return packed?unary_packed_op.RELU:unary_op.RELU;if("elu"===activation)return packed?unary_packed_op.ELU:unary_op.ELU;if("prelu"===activation)return packed?binaryop_packed_gpu.PRELU:binaryop_gpu.PRELU;throw new Error("Activation "+activation+" has not been implemented for the WebGL backend.")}var CPU_HANDOFF_SIZE_THRESHOLD=128,BEFORE_PAGING_CONSTANT=600;function numMBBeforeWarning(){return null==environment_1.ENV.global.screen?1024:environment_1.ENV.global.screen.height*environment_1.ENV.global.screen.width*window.devicePixelRatio*600/1024/1024}exports.MATMUL_SHARED_DIM_THRESHOLD=1e3;var MathBackendWebGL=function(){function MathBackendWebGL(gpgpu){if(this.gpgpu=gpgpu,this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.warnedAboutMemory=!1,this.disposed=!1,!environment_1.ENV.getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(null==gpgpu){var gl=canvas_util_1.getWebGLContext(environment_1.ENV.getNumber("WEBGL_VERSION"));this.binaryCache=getBinaryCache(environment_1.ENV.getNumber("WEBGL_VERSION")),this.gpgpu=new gpgpu_context_1.GPGPUContext(gl),this.canvas=gl.canvas,this.gpgpuCreatedLocally=!0}else this.binaryCache={},this.gpgpuCreatedLocally=!1,this.canvas=gpgpu.gl.canvas;this.textureManager=new texture_manager_1.TextureManager(this.gpgpu),this.numMBBeforeWarning=numMBBeforeWarning(),this.texData=new backend_1.DataStorage(this,engine_1.ENGINE)}return MathBackendWebGL.prototype.register=function(dataId,shape,dtype){if(this.texData.has(dataId))throw new Error("Data buffer is already registered");this.texData.set(dataId,{shape:shape,dtype:dtype})},MathBackendWebGL.prototype.fromPixels=function(pixels,numChannels){if(null==pixels)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var isCanvas="undefined"!=typeof OffscreenCanvas&&pixels instanceof OffscreenCanvas||"undefined"!=typeof HTMLCanvasElement&&pixels instanceof HTMLCanvasElement,isPixelData=pixels.data instanceof Uint8Array,isImageData="undefined"!=typeof ImageData&&pixels instanceof ImageData,isVideo="undefined"!=typeof HTMLVideoElement&&pixels instanceof HTMLVideoElement,isImage="undefined"!=typeof HTMLImageElement&&pixels instanceof HTMLImageElement,_a=isVideo?[pixels.videoWidth,pixels.videoHeight]:[pixels.width,pixels.height],width=_a[0],height=_a[1],texShape=[height,width],outShape=[height,width,numChannels];if(!(isCanvas||isPixelData||isImageData||isVideo||isImage))throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+pixels.constructor.name);(isImage||isVideo)&&(null==this.fromPixels2DContext&&(this.fromPixels2DContext=canvas_util_1.createCanvas(environment_1.ENV.getNumber("WEBGL_VERSION")).getContext("2d")),this.fromPixels2DContext.canvas.width=width,this.fromPixels2DContext.canvas.height=height,this.fromPixels2DContext.drawImage(pixels,0,0,width,height),pixels=this.fromPixels2DContext.canvas);var tempPixelHandle=this.makeTensorHandle(texShape,"int32"),program,res;if(this.texData.get(tempPixelHandle.dataId).usage=tex_util_1.TextureUsage.PIXELS,this.gpgpu.uploadPixelDataToTexture(this.getTexture(tempPixelHandle.dataId),pixels),environment_1.ENV.getBool("WEBGL_PACK")){program=new from_pixels_packed_gpu_1.FromPixelsPackedProgram(outShape);var packedOutput=this.makePackedTensor(program.outputShape,tempPixelHandle.dtype);res=this.compileAndRun(program,[tempPixelHandle],packedOutput)}else program=new from_pixels_gpu_1.FromPixelsProgram(outShape),res=this.compileAndRun(program,[tempPixelHandle]);return this.disposeData(tempPixelHandle.dataId),res},MathBackendWebGL.prototype.makeTensorHandle=function(shape,dtype){var dataId={};return this.register(dataId,shape,dtype),{dataId:dataId,shape:shape,dtype:dtype}},MathBackendWebGL.prototype.write=function(dataId,values){if(null==values)throw new Error("MathBackendWebGL.write(): values can not be null");if(environment_1.ENV.getBool("DEBUG"))for(var i=0;i<values.length;i++){var num=values[i];if(!webgl_util.canBeRepresented(num)){if(environment_1.ENV.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))throw Error("The value "+num+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.ENV.set('WEBGL_RENDER_FLOAT32_ENABLED', true);'");throw Error("The value "+num+" cannot be represented on this device.")}}var texData=this.texData.get(dataId),dtype;if("complex64"===texData.dtype)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.releaseGPUData(dataId),texData.usage=tex_util_1.TextureUsage.UPLOAD,texData.values=values},MathBackendWebGL.prototype.readSync=function(dataId){var texData=this.texData.get(dataId),values=texData.values,dtype=texData.dtype,complexTensors=texData.complexTensors,slice=texData.slice,shape=texData.shape,isPacked=texData.isPacked;if(null!=slice){var program=void 0;program=isPacked?new unaryop_packed_gpu_1.UnaryOpPackedProgram(shape,unary_op.CLONE):new unaryop_gpu_1.UnaryOpProgram(shape,unary_op.CLONE);var res=this.compileAndRun(program,[{dataId:dataId,shape:shape,dtype:dtype}]),data=this.readSync(res.dataId);return res.dispose(),data}if(null!=values)return this.convertAndCacheOnCPU(dataId);if("string"===dtype)return values;var shouldTimeProgram=null!=this.activeTimers,start,result;if(shouldTimeProgram&&(start=util.now()),"complex64"===dtype){var realValues=complexTensors.real.dataSync(),imagValues=complexTensors.imag.dataSync();result=complex_util_1.mergeRealAndImagArrays(realValues,imagValues)}else result=this.getValuesFromTexture(dataId);return shouldTimeProgram&&(this.downloadWaitMs+=util.now()-start),this.convertAndCacheOnCPU(dataId,result)},MathBackendWebGL.prototype.read=function(dataId){return __awaiter(this,void 0,void 0,(function(){var subscribers_1,texData,values,shape,slice,dtype,complexTensors,isPacked,program,res,data,buffer,tmpDownloadTarget,tmpData,vals,ps,realValues,imagValues,size,dTypeVals,subscribers,_a;return __generator(this,(function(_b){switch(_b.label){case 0:if(this.pendingRead.has(dataId))return subscribers_1=this.pendingRead.get(dataId),[2,new Promise((function(resolve){return subscribers_1.push(resolve)}))];if(texData=this.texData.get(dataId),values=texData.values,shape=texData.shape,slice=texData.slice,dtype=texData.dtype,complexTensors=texData.complexTensors,isPacked=texData.isPacked,null!=slice)return program=void 0,program=isPacked?new unaryop_packed_gpu_1.UnaryOpPackedProgram(shape,unary_op.CLONE):new unaryop_gpu_1.UnaryOpProgram(shape,unary_op.CLONE),res=this.compileAndRun(program,[{dataId:dataId,shape:shape,dtype:dtype}]),data=this.read(res.dataId),res.dispose(),[2,data];if(null!=values)return[2,this.convertAndCacheOnCPU(dataId)];if(!environment_1.ENV.getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===environment_1.ENV.getNumber("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return buffer=null,"complex64"!==dtype&&environment_1.ENV.get("WEBGL_BUFFER_SUPPORTED")&&(tmpDownloadTarget=this.decode(dataId),tmpData=this.texData.get(tmpDownloadTarget.dataId),buffer=(_a=this.gpgpu).createBufferFromTexture.apply(_a,[tmpData.texture].concat(tex_util.getDenseTexShape(shape)))),this.pendingRead.set(dataId,[]),"complex64"===dtype?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:_b.sent(),_b.label=2;case 2:return"complex64"!==dtype?[3,4]:[4,Promise.all([complexTensors.real.data(),complexTensors.imag.data()])];case 3:return ps=_b.sent(),realValues=ps[0],imagValues=ps[1],vals=complex_util_1.mergeRealAndImagArrays(realValues,imagValues),[3,5];case 4:null==buffer?vals=this.getValuesFromTexture(dataId):(size=util.sizeFromShape(shape),vals=this.gpgpu.downloadFloat32MatrixFromBuffer(buffer,size)),_b.label=5;case 5:return null!=tmpDownloadTarget&&this.disposeData(tmpDownloadTarget.dataId),dTypeVals=this.convertAndCacheOnCPU(dataId,vals),subscribers=this.pendingRead.get(dataId),this.pendingRead.delete(dataId),subscribers.forEach((function(resolve){return resolve(dTypeVals)})),this.pendingDisposal.has(dataId)&&(this.pendingDisposal.delete(dataId),this.disposeData(dataId)),[2,dTypeVals]}}))}))},MathBackendWebGL.prototype.getValuesFromTexture=function(dataId){var _a,_this=this,_b=this.texData.get(dataId),shape=_b.shape,dtype=_b.dtype,isPacked=_b.isPacked,size=util.sizeFromShape(shape);if(environment_1.ENV.getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var tmpTarget_1=this.decode(dataId),tmpData_1=this.texData.get(tmpTarget_1.dataId),vals_1=(_a=this.gpgpu).downloadMatrixFromPackedTexture.apply(_a,[tmpData_1.texture].concat(tex_util.getDenseTexShape(shape))).subarray(0,size);return this.disposeData(tmpTarget_1.dataId),vals_1}var shouldUsePackedProgram=environment_1.ENV.getBool("WEBGL_PACK")&&!0===isPacked,outputShape=shouldUsePackedProgram?webgl_util.getShapeAs3D(shape):shape,tmpTarget=this.makeTensorHandle(outputShape,"float32");tmpTarget.size=util_1.sizeFromShape(shape),this.texData.get(tmpTarget.dataId).usage=tex_util_1.TextureUsage.DOWNLOAD;var output=globals_1.tidy((function(){var program=shouldUsePackedProgram?new encode_float_packed_gpu_1.EncodeFloatPackedProgram(outputShape):new encode_float_gpu_1.EncodeFloatProgram(outputShape);return _this.compileAndRun(program,[{shape:outputShape,dtype:dtype,dataId:dataId}],tmpTarget,null)})),tmpData=this.texData.get(output.dataId),vals=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(tmpData.texture,tmpData.texShape[0],tmpData.texShape[1]).subarray(0,size);return this.disposeData(tmpTarget.dataId),vals},MathBackendWebGL.prototype.time=function(f){return __awaiter(this,void 0,void 0,(function(){var oldActiveTimers,newActiveTimers,outerMostTime,flattenedActiveTimerQueries,flattenedActiveTimerNames,kernelMs,res;return __generator(this,(function(_a){switch(_a.label){case 0:return oldActiveTimers=this.activeTimers,newActiveTimers=[],outerMostTime=!1,null==this.programTimersStack?(this.programTimersStack=newActiveTimers,outerMostTime=!0):this.activeTimers.push(newActiveTimers),this.activeTimers=newActiveTimers,f(),flattenedActiveTimerQueries=util.flatten(this.activeTimers.map((function(d){return d.query}))).filter((function(d){return null!=d})),flattenedActiveTimerNames=util.flatten(this.activeTimers.map((function(d){return d.name}))).filter((function(d){return null!=d})),this.activeTimers=oldActiveTimers,outerMostTime&&(this.programTimersStack=null),[4,Promise.all(flattenedActiveTimerQueries)];case 1:return kernelMs=_a.sent(),res={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:util.sum(kernelMs),getExtraProfileInfo:function(){return kernelMs.map((function(d,i){return{name:flattenedActiveTimerNames[i],ms:d}})).map((function(d){return d.name+": "+d.ms})).join(", ")},wallMs:null},this.uploadWaitMs=0,this.downloadWaitMs=0,[2,res]}}))}))},MathBackendWebGL.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},MathBackendWebGL.prototype.startTimer=function(){return environment_1.ENV.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?this.gpgpu.beginQuery():{startMs:util.now(),endMs:null}},MathBackendWebGL.prototype.endTimer=function(query){return environment_1.ENV.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(this.gpgpu.endQuery(),query):(query.endMs=util.now(),query)},MathBackendWebGL.prototype.getQueryTime=function(query){return __awaiter(this,void 0,void 0,(function(){var timerQuery;return __generator(this,(function(_a){return environment_1.ENV.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?[2,this.gpgpu.waitForQueryAndGetTime(query)]:[2,(timerQuery=query).endMs-timerQuery.startMs]}))}))},MathBackendWebGL.prototype.disposeData=function(dataId){if(!this.pendingDisposal.has(dataId))if(this.pendingRead.has(dataId))this.pendingDisposal.add(dataId);else if(this.texData.has(dataId)){this.releaseGPUData(dataId);var complexTensors=this.texData.get(dataId).complexTensors;null!=complexTensors&&(complexTensors.real.dispose(),complexTensors.imag.dispose()),this.texData.delete(dataId)}},MathBackendWebGL.prototype.releaseGPUData=function(dataId){var _a=this.texData.get(dataId),texture=_a.texture,dtype=_a.dtype,texShape=_a.texShape,usage=_a.usage,isPacked=_a.isPacked,slice=_a.slice,key=slice&&slice.origDataId||dataId,refCount=this.dataRefCount.get(key);refCount>1?this.dataRefCount.set(key,refCount-1):(this.dataRefCount.delete(key),null!=texture&&(this.numBytesInGPU-=this.computeBytes(texShape,dtype),this.textureManager.releaseTexture(texture,texShape,usage,isPacked)));var texData=this.texData.get(dataId);texData.texture=null,texData.texShape=null,texData.isPacked=!1,texData.slice=null},MathBackendWebGL.prototype.getTexture=function(dataId){return this.uploadToGPU(dataId),this.texData.get(dataId).texture},MathBackendWebGL.prototype.getDataInfo=function(dataId){return this.texData.get(dataId)},MathBackendWebGL.prototype.getCPUBackend=function(){return environment_1.ENV.getBool("WEBGL_CPU_FORWARD")?(null==this.cpuBackend&&(this.cpuBackend=engine_1.ENGINE.findBackend("cpu")),this.cpuBackend):null},MathBackendWebGL.prototype.shouldExecuteOnCPU=function(inputs,sizeThreshold){var _this=this;return void 0===sizeThreshold&&(sizeThreshold=128),null!=this.getCPUBackend()&&inputs.every((function(input){return null==_this.texData.get(input.dataId).texture&&input.size<sizeThreshold}))},MathBackendWebGL.prototype.getGPGPUContext=function(){return this.gpgpu},MathBackendWebGL.prototype.complex=function(real,imag){var result=this.makeOutputArray(real.shape,"complex64"),resultData;return this.texData.get(result.dataId).complexTensors={real:engine_1.ENGINE.keep(real.clone()),imag:engine_1.ENGINE.keep(imag.clone())},result},MathBackendWebGL.prototype.real=function(input){var resultData;return this.texData.get(input.dataId).complexTensors.real.clone()},MathBackendWebGL.prototype.imag=function(input){var resultData;return this.texData.get(input.dataId).complexTensors.imag.clone()},MathBackendWebGL.prototype.slice=function(x,begin,size){if(this.shouldExecuteOnCPU([x]))return this.cpuBackend.slice(x,begin,size);if(0===util.sizeFromShape(size))return tensor_ops_1.tensor([],size,x.dtype);var isPacked=this.texData.get(x.dataId).isPacked,isContinous=slice_util.isSliceContinous(x.shape,begin,size);if(isPacked||!isContinous){var program=environment_1.ENV.getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new slice_packed_gpu_1.SlicePackedProgram(size):new slice_gpu_1.SliceProgram(size),customSetup=program.getCustomSetupFunc(begin);return this.compileAndRun(program,[x],null,customSetup)}return this.uploadToGPU(x.dataId),this.shallowSlice(x,begin,size)},MathBackendWebGL.prototype.shallowSlice=function(x,begin,size){var xTexData=this.texData.get(x.dataId),t=tensor_1.Tensor.make(size,{},x.dtype,this),newTexData=this.texData.get(t.dataId);Object.assign(newTexData,xTexData),newTexData.shape=size,newTexData.dtype=x.dtype;var flatOffset=slice_util.computeFlatOffset(begin,x.strides);xTexData.slice&&(flatOffset+=xTexData.slice.flatOffset),newTexData.slice={flatOffset:flatOffset,origDataId:xTexData.slice&&xTexData.slice.origDataId||x.dataId};var refCount=this.dataRefCount.get(newTexData.slice.origDataId)||1;return this.dataRefCount.set(newTexData.slice.origDataId,refCount+1),t},MathBackendWebGL.prototype.stridedSlice=function(x,begin,end,strides){if(this.shouldExecuteOnCPU([x]))return this.cpuBackend.stridedSlice(x,begin,end,strides);var outShape=slice_util.computeOutShape(begin,end,strides);if(outShape.some((function(axis){return 0===axis})))return tensor_ops_1.tensor([],outShape);var program=new strided_slice_gpu_1.StridedSliceProgram(begin,strides,outShape);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.reverse=function(x,axis){var program=environment_1.ENV.getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new reverse_packed_gpu_1.ReversePackedProgram(x.shape,axis):new reverse_gpu_1.ReverseProgram(x.shape,axis);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.concat=function(tensors,axis){if("complex64"===tensors[0].dtype){var reals=tensors.map((function(t){return complex_ops_1.real(t)})),imags=tensors.map((function(t){return complex_ops_1.imag(t)}));return complex_ops_1.complex(this.concat(reals,axis),this.concat(imags,axis))}if(this.shouldExecuteOnCPU(tensors))return this.cpuBackend.concat(tensors,axis);if(1===tensors.length)return tensors[0];if(tensors.length>environment_1.ENV.getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var midIndex=Math.floor(tensors.length/2),leftSide=this.concat(tensors.slice(0,midIndex),axis),rightSide=this.concat(tensors.slice(midIndex),axis);return this.concat([leftSide,rightSide],axis)}if(environment_1.ENV.getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&tensors[0].rank>1){var program_1=new concat_packed_gpu_1.ConcatPackedProgram(tensors.map((function(t){return t.shape})),axis);return this.compileAndRun(program_1,tensors)}var outShape=concat_util_1.computeOutShape(tensors.map((function(t){return t.shape})),axis),tensors2D=tensors.map((function(t){return t.as2D(-1,util_1.sizeFromShape(t.shape.slice(axis)))})),program=new concat_gpu_1.ConcatProgram(tensors2D.map((function(t){return t.shape}))),res;return this.compileAndRun(program,tensors2D).reshape(outShape)},MathBackendWebGL.prototype.neg=function(x){if(this.shouldExecuteOnCPU([x]))return this.cpuBackend.neg(x);if(environment_1.ENV.getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(x,unary_op.NEG,x.dtype);var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.NEG);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.batchMatMul=function(a,b,transposeA,transposeB){var outerShapeA=transposeA?a.shape[2]:a.shape[1],outerShapeB=transposeB?b.shape[1]:b.shape[2],sharedDim=transposeA?a.shape[1]:a.shape[2],_a,batch=a.shape[0];if((1===outerShapeA||1===outerShapeB)&&sharedDim>exports.MATMUL_SHARED_DIM_THRESHOLD){transposeA&&(a=a.transpose([0,2,1])),transposeB&&(b=b.transpose([0,2,1]));var a3D=1===outerShapeB?a:a.as3D(batch,sharedDim,1),axis=1===outerShapeB?2:1,b3D=1===outerShapeB?b.as3D(batch,1,sharedDim):b;return this.multiply(a3D,b3D).sum(axis,!0)}var dtype=types_1.upcastType(a.dtype,b.dtype),program=new mulmat_packed_gpu_1.MatMulPackedProgram(a.shape,[batch,outerShapeA,outerShapeB],transposeA,transposeB),output=this.makePackedTensor(program.outputShape,dtype);return this.compileAndRun(program,[a,b],output)},MathBackendWebGL.prototype.fusedBatchMatMul=function(_a){var a=_a.a,b=_a.b,transposeA=_a.transposeA,transposeB=_a.transposeB,bias=_a.bias,activation=_a.activation,preluActivationWeights=_a.preluActivationWeights,outerShapeA=transposeA?a.shape[2]:a.shape[1],outerShapeB=transposeB?b.shape[1]:b.shape[2],_b,batch=a.shape[0],dtype=types_1.upcastType(a.dtype,b.dtype),hasBias=null!=bias,hasPreluActivationWeights=null!=preluActivationWeights,fusedActivation=activation?mapActivationToShaderProgram(activation,!0):null,program=new mulmat_packed_gpu_1.MatMulPackedProgram(a.shape,[batch,outerShapeA,outerShapeB],transposeA,transposeB,hasBias,fusedActivation,hasPreluActivationWeights),output=this.makePackedTensor(program.outputShape,dtype),inputs=[a,b];return bias&&inputs.push(bias),preluActivationWeights&&inputs.push(preluActivationWeights),this.compileAndRun(program,inputs,output)},MathBackendWebGL.prototype.multiply=function(a,b){if("complex64"===a.dtype){var aData=this.texData.get(a.dataId),bData=this.texData.get(b.dataId),realProgram=new binaryop_complex_gpu_1.BinaryOpComplexProgram(binaryop_complex_gpu.COMPLEX_MULTIPLY.REAL,a.shape,b.shape),imagProgram=new binaryop_complex_gpu_1.BinaryOpComplexProgram(binaryop_complex_gpu.COMPLEX_MULTIPLY.IMAG,a.shape,b.shape),inputs=[this.makeComplexComponentTensorHandle(a,aData.complexTensors.real),this.makeComplexComponentTensorHandle(a,aData.complexTensors.imag),this.makeComplexComponentTensorHandle(b,bData.complexTensors.real),this.makeComplexComponentTensorHandle(b,bData.complexTensors.imag)],real_1=this.compileAndRun(realProgram,inputs),imag_1=this.compileAndRun(imagProgram,inputs),complex_1=this.complex(real_1,imag_1);return real_1.dispose(),imag_1.dispose(),complex_1}if(this.shouldExecuteOnCPU([a,b]))return this.cpuBackend.multiply(a,b);if(environment_1.ENV.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(a,b,binaryop_gpu.MUL,a.dtype);var program=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.MUL,a.shape,b.shape),output=this.makeOutputArray(program.outputShape,a.dtype);return this.compileAndRun(program,[a,b],output)},MathBackendWebGL.prototype.batchNormalization=function(x,mean,variance,varianceEpsilon,scale,offset){var inputs=[x,mean,variance],offsetShape=null;null!=offset&&(offsetShape=offset.shape,inputs.push(offset));var scaleShape=null;if(null!=scale&&(scaleShape=scale.shape,inputs.push(scale)),environment_1.ENV.getBool("WEBGL_PACK_NORMALIZATION")){var batchNormPackedProgram=new batchnorm_packed_gpu_1.BatchNormPackedProgram(x.shape,mean.shape,variance.shape,offsetShape,scaleShape,varianceEpsilon);return this.compileAndRun(batchNormPackedProgram,inputs)}var batchNormProgram=new batchnorm_gpu_1.BatchNormProgram(x.shape,mean.shape,variance.shape,offsetShape,scaleShape,varianceEpsilon);return this.compileAndRun(batchNormProgram,inputs)},MathBackendWebGL.prototype.localResponseNormalization4D=function(x,radius,bias,alpha,beta){var program=environment_1.ENV.getBool("WEBGL_PACK_NORMALIZATION")?new lrn_packed_gpu_1.LRNPackedProgram(x.shape,radius,bias,alpha,beta):new lrn_gpu_1.LRNProgram(x.shape,radius,bias,alpha,beta);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.LRNGrad=function(dy,inputImage,outputImage,depthRadius,bias,alpha,beta){var program=new lrn_grad_gpu_1.LRNGradProgram(inputImage.shape,depthRadius,bias,alpha,beta);return this.compileAndRun(program,[inputImage,outputImage,dy])},MathBackendWebGL.prototype.tile=function(x,reps){if("string"===x.dtype){var data,decodedData=this.readSync(x.dataId).map((function(d){return util.decodeString(d)})),buf=array_ops_1.buffer(x.shape,x.dtype,decodedData);return tile_impl_1.tile(buf,reps)}var program=new tile_gpu_1.TileProgram(x.shape,reps);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.pad=function(x,paddings,constantValue){var program=environment_1.ENV.getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new pad_packed_gpu_1.PadPackedProgram(x.shape,paddings,constantValue):new pad_gpu_1.PadProgram(x.shape,paddings,constantValue);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.transpose=function(x,perm){if(this.shouldExecuteOnCPU([x]))return this.cpuBackend.transpose(x,perm);var program=environment_1.ENV.getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new transpose_packed_gpu_1.TransposePackedProgram(x.shape,perm):new transpose_gpu_1.TransposeProgram(x.shape,perm);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.gather=function(x,indices,axis){if(this.shouldExecuteOnCPU([x,indices]))return this.cpuBackend.gather(x,indices,axis);var program=new gather_gpu_1.GatherProgram(x.shape,indices.size,axis);return this.compileAndRun(program,[x,indices])},MathBackendWebGL.prototype.batchToSpaceND=function(x,blockShape,crops){util.assert(x.rank<=4,(function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"}));var prod=blockShape.reduce((function(a,b){return a*b})),reshaped=array_ops_util.getReshaped(x.shape,blockShape,prod),permuted=array_ops_util.getPermuted(reshaped.length,blockShape.length),reshapedPermuted=array_ops_util.getReshapedPermuted(x.shape,blockShape,prod),sliceBeginCoords=array_ops_util.getSliceBeginCoords(crops,blockShape.length),sliceSize=array_ops_util.getSliceSize(reshapedPermuted,crops,blockShape.length);return x.reshape(reshaped).transpose(permuted).reshape(reshapedPermuted).slice(sliceBeginCoords,sliceSize)},MathBackendWebGL.prototype.spaceToBatchND=function(x,blockShape,paddings){util.assert(x.rank<=4,(function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"}));var prod=blockShape.reduce((function(a,b){return a*b})),completePaddings=[[0,0]];completePaddings.push.apply(completePaddings,paddings);for(var i=1+blockShape.length;i<x.shape.length;++i)completePaddings.push([0,0]);var paddedX=x.pad(completePaddings),reshapedPaddedShape=array_ops_util.getReshaped(paddedX.shape,blockShape,prod,!1),permutedReshapedPaddedPermutation=array_ops_util.getPermuted(reshapedPaddedShape.length,blockShape.length,!1),flattenShape=array_ops_util.getReshapedPermuted(paddedX.shape,blockShape,prod,!1);return paddedX.reshape(reshapedPaddedShape).transpose(permutedReshapedPaddedPermutation).reshape(flattenShape)},MathBackendWebGL.prototype.reduce=function(x,reduceType,dtype){var batchSize=x.shape[0],inSize=x.shape[1],windowSize,reduceInfo={windowSize:reduce_util.computeOptimalWindowSize(inSize),inSize:inSize,batchSize:batchSize},program=new reduce_gpu_1.ReduceProgram(reduceInfo,reduceType),_a=program.outputShape,rows=_a[0],cols=_a[1],output=this.makeOutputArray([rows,cols],dtype);return this.compileAndRun(program,[x],output),1===output.shape[1]?output:this.reduce(output,reduceType,dtype)},MathBackendWebGL.prototype.argReduce=function(x,reduceType,bestIndicesA){void 0===bestIndicesA&&(bestIndicesA=null);var batchSize=x.shape[0],inSize=x.shape[1];null!=bestIndicesA&&(batchSize=bestIndicesA.shape[0],inSize=bestIndicesA.shape[1]);var windowSize,reduceInfo={windowSize:reduce_util.computeOptimalWindowSize(inSize),inSize:inSize,batchSize:batchSize},program=new argminmax_gpu_1.ArgMinMaxProgram(reduceInfo,reduceType,null==bestIndicesA),_a=program.outputShape,rows=_a[0],cols=_a[1],output=this.makeOutputArray([rows,cols],"int32"),inputs=[x];return null!=bestIndicesA&&inputs.push(bestIndicesA),this.compileAndRun(program,inputs,output),1===output.shape[1]?output:this.argReduce(x,reduceType,output)},MathBackendWebGL.prototype.argReducePacked=function(x,reduceType,bestIndicesA){void 0===bestIndicesA&&(bestIndicesA=null);var inShape=null!=bestIndicesA?bestIndicesA.shape:x.shape,inSize=inShape[inShape.length-1],windowSize=reduce_util.computeOptimalWindowSize(inSize),program=new argminmax_packed_gpu_1.ArgMinMaxPackedProgram(inShape,windowSize,reduceType,null==bestIndicesA),output=this.makePackedTensor(program.outputShape,"int32"),inputs=null==bestIndicesA?[x]:[x,bestIndicesA];return this.compileAndRun(program,inputs,output),output.rank===x.rank?this.argReducePacked(x,reduceType,output):output},MathBackendWebGL.prototype.sum=function(x,axes){axis_util.assertAxesAreInnerMostDims("sum",axes,x.rank);var _a=axis_util.computeOutAndReduceShapes(x.shape,axes),outShape=_a[0],reduceShape=_a[1],inSize=util.sizeFromShape(reduceShape),a2D=x.as2D(-1,inSize),outputDType=types_1.sumOutType(x.dtype);return this.reduce(a2D,"sum",outputDType).reshape(outShape)},MathBackendWebGL.prototype.prod=function(x,axes){if(this.shouldExecuteOnCPU([x]))return this.cpuBackend.prod(x,axes);var _a=axis_util.computeOutAndReduceShapes(x.shape,axes),outShape=_a[0],reduceShape=_a[1],inSize=util.sizeFromShape(reduceShape),a2D=x.as2D(-1,inSize),outputDType=types_1.sumOutType(x.dtype);return this.reduce(a2D,"prod",outputDType).reshape(outShape)},MathBackendWebGL.prototype.unsortedSegmentSum=function(x,segmentIds,numSegments){var axis=0,permutation=axis_util.getAxesPermutation([axis],x.rank),permutedX=x;null!=permutation&&(permutedX=x.transpose(permutation),axis=axis_util.getInnerMostAxes(1,x.rank)[0]);var outShape=segment_util.computeOutShape(permutedX.shape,axis,numSegments),inSize=util.sizeFromShape([permutedX.shape[axis]]),a2D=permutedX.as2D(-1,inSize),outputDType=types_1.sumOutType(x.dtype),result=this.segOpCompute(a2D,"unsortedSegmentSum",segmentIds,outputDType,numSegments).reshape(outShape);return null!=permutation&&(result=result.transpose(axis_util.getUndoAxesPermutation(permutation))),result},MathBackendWebGL.prototype.segOpCompute=function(x,segOpType,segmentIds,dtype,numSegments){var batchSize=x.shape[0],inSize=x.shape[1],windowSize=segment_util.segOpComputeOptimalWindowSize(inSize,numSegments),segOpInfo={windowSize:windowSize,inSize:inSize,batchSize:batchSize,numSegments:numSegments},program=new segment_gpu_1.SegmentOpProgram(segOpInfo,segOpType),_a=program.outputShape,rows=_a[0],cols=_a[1],output=this.makeOutputArray([rows,cols],dtype);return this.compileAndRun(program,[x,segmentIds],output),output.shape[1]===numSegments?output:(segmentIds=tensor_ops_1.range(0,numSegments).tile([inSize/windowSize]),this.segOpCompute(output,segOpType,segmentIds,dtype,numSegments))},MathBackendWebGL.prototype.argMinMaxReduce=function(x,axis,reduceType){var axes=[axis];if(axis_util.assertAxesAreInnerMostDims("arg"+reduceType.charAt(0).toUpperCase()+reduceType.slice(1),axes,x.rank),!environment_1.ENV.getBool("WEBGL_PACK_REDUCE")||x.rank<=2){var _a=axis_util.computeOutAndReduceShapes(x.shape,axes),outShape=_a[0],reduceShape=_a[1],inSize=util.sizeFromShape(reduceShape),a2D=x.as2D(-1,inSize);return this.argReduce(a2D,reduceType).reshape(outShape)}return this.argReducePacked(x,reduceType)},MathBackendWebGL.prototype.argMin=function(x,axis){return this.argMinMaxReduce(x,axis,"min")},MathBackendWebGL.prototype.argMax=function(x,axis){return this.argMinMaxReduce(x,axis,"max")},MathBackendWebGL.prototype.cumsum=function(x,axis,exclusive,reverse){if(axis!==x.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(x.rank-1)+" but got axis="+axis);var program=new cumsum_gpu_1.CumSumProgram(x.shape,exclusive,reverse);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.equal=function(a,b){if(environment_1.ENV.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(a,b,binaryop_packed_gpu.EQUAL,"bool");var program=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.EQUAL,a.shape,b.shape),output=this.makeOutputArray(program.outputShape,"bool");return this.compileAndRun(program,[a,b],output)},MathBackendWebGL.prototype.notEqual=function(a,b){if(environment_1.ENV.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(a,b,binaryop_packed_gpu.NOT_EQUAL,"bool");var program=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.NOT_EQUAL,a.shape,b.shape),output=this.makeOutputArray(program.outputShape,"bool");return this.compileAndRun(program,[a,b],output)},MathBackendWebGL.prototype.less=function(a,b){if(this.shouldExecuteOnCPU([a,b]))return this.cpuBackend.less(a,b);if(environment_1.ENV.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(a,b,binaryop_packed_gpu.LESS,"bool");var program=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.LESS,a.shape,b.shape),output=this.makeOutputArray(program.outputShape,"bool");return this.compileAndRun(program,[a,b],output)},MathBackendWebGL.prototype.lessEqual=function(a,b){if(environment_1.ENV.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(a,b,binaryop_packed_gpu.LESS_EQUAL,"bool");var program=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.LESS_EQUAL,a.shape,b.shape),output=this.makeOutputArray(program.outputShape,"bool");return this.compileAndRun(program,[a,b],output)},MathBackendWebGL.prototype.greater=function(a,b){if(this.shouldExecuteOnCPU([a,b]))return this.cpuBackend.greater(a,b);if(environment_1.ENV.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(a,b,binaryop_packed_gpu.GREATER,"bool");var program=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.GREATER,a.shape,b.shape),output=this.makeOutputArray(program.outputShape,"bool");return this.compileAndRun(program,[a,b],output)},MathBackendWebGL.prototype.greaterEqual=function(a,b){if(environment_1.ENV.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(a,b,binaryop_packed_gpu.GREATER_EQUAL,"bool");var program=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.GREATER_EQUAL,a.shape,b.shape),output=this.makeOutputArray(program.outputShape,"bool");return this.compileAndRun(program,[a,b],output)},MathBackendWebGL.prototype.logicalNot=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.LOGICAL_NOT);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.logicalAnd=function(a,b){if(environment_1.ENV.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(a,b,binaryop_packed_gpu.LOGICAL_AND,"bool");var program=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.LOGICAL_AND,a.shape,b.shape),output=this.makeOutputArray(program.outputShape,"bool");return this.compileAndRun(program,[a,b],output)},MathBackendWebGL.prototype.logicalOr=function(a,b){if(environment_1.ENV.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(a,b,binaryop_packed_gpu.LOGICAL_OR,"bool");var program=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.LOGICAL_OR,a.shape,b.shape),output=this.makeOutputArray(program.outputShape,"bool");return this.compileAndRun(program,[a,b],output)},MathBackendWebGL.prototype.select=function(condition,a,b){var program=new select_gpu_1.SelectProgram(condition.rank,a.shape,a.rank),output=this.makeOutputArray(program.outputShape,types_1.upcastType(a.dtype,b.dtype));return this.compileAndRun(program,[condition,a,b],output)},MathBackendWebGL.prototype.where=function(condition){log_1.warn("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var condVals=condition.dataSync();return where_impl_1.whereImpl(condition.shape,condVals)},MathBackendWebGL.prototype.topk=function(x,k,sorted){var xVals=x.dataSync();return topk_impl_1.topkImpl(xVals,x.shape,x.dtype,k,sorted)},MathBackendWebGL.prototype.min=function(x,axes){axis_util.assertAxesAreInnerMostDims("min",axes,x.rank);var _a=axis_util.computeOutAndReduceShapes(x.shape,axes),outShape=_a[0],reduceShape=_a[1],inSize=util.sizeFromShape(reduceShape),a2D=x.as2D(-1,inSize);return this.reduce(a2D,"min",a2D.dtype).reshape(outShape)},MathBackendWebGL.prototype.minimum=function(a,b){if(this.shouldExecuteOnCPU([a,b]))return this.cpuBackend.minimum(a,b);var program=environment_1.ENV.getBool("WEBGL_PACK_BINARY_OPERATIONS")?new binaryop_packed_gpu_1.BinaryOpPackedProgram(binaryop_packed_gpu.MIN,a.shape,b.shape):new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.MIN,a.shape,b.shape);return this.compileAndRun(program,[a,b])},MathBackendWebGL.prototype.mod=function(a,b){var program=environment_1.ENV.getBool("WEBGL_PACK_BINARY_OPERATIONS")?new binaryop_packed_gpu_1.BinaryOpPackedProgram(binaryop_packed_gpu.MOD,a.shape,b.shape):new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.MOD,a.shape,b.shape);return this.compileAndRun(program,[a,b])},MathBackendWebGL.prototype.max=function(x,axes){if(this.shouldExecuteOnCPU([x]))return this.cpuBackend.max(x,axes);axis_util.assertAxesAreInnerMostDims("max",axes,x.rank);var _a=axis_util.computeOutAndReduceShapes(x.shape,axes),outShape=_a[0],reduceShape=_a[1],inSize=util.sizeFromShape(reduceShape),a2D=x.as2D(-1,inSize);return this.reduce(a2D,"max",a2D.dtype).reshape(outShape)},MathBackendWebGL.prototype.maximum=function(a,b){if(this.shouldExecuteOnCPU([a,b]))return this.cpuBackend.maximum(a,b);var program=environment_1.ENV.getBool("WEBGL_PACK_BINARY_OPERATIONS")?new binaryop_packed_gpu_1.BinaryOpPackedProgram(binaryop_packed_gpu.MAX,a.shape,b.shape):new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.MAX,a.shape,b.shape);return this.compileAndRun(program,[a,b])},MathBackendWebGL.prototype.all=function(x,axes){axis_util.assertAxesAreInnerMostDims("all",axes,x.rank);var _a=axis_util.computeOutAndReduceShapes(x.shape,axes),outShape=_a[0],reduceShape=_a[1],inSize=util.sizeFromShape(reduceShape),a2D=x.as2D(-1,inSize);return this.reduce(a2D,"all",a2D.dtype).reshape(outShape)},MathBackendWebGL.prototype.any=function(x,axes){axis_util.assertAxesAreInnerMostDims("any",axes,x.rank);var _a=axis_util.computeOutAndReduceShapes(x.shape,axes),outShape=_a[0],reduceShape=_a[1],inSize=util.sizeFromShape(reduceShape),a2D=x.as2D(-1,inSize);return this.reduce(a2D,"any",a2D.dtype).reshape(outShape)},MathBackendWebGL.prototype.squaredDifference=function(a,b){var program=environment_1.ENV.getBool("WEBGL_PACK_BINARY_OPERATIONS")?new binaryop_packed_gpu_1.BinaryOpPackedProgram(binaryop_gpu.SQUARED_DIFFERENCE,a.shape,b.shape):new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.SQUARED_DIFFERENCE,a.shape,b.shape);return this.compileAndRun(program,[a,b])},MathBackendWebGL.prototype.realDivide=function(a,b){var op=binaryop_gpu.DIV,outputDtype="float32";if(environment_1.ENV.getBool("WEBGL_PACK_BINARY_OPERATIONS")){var checkOutOfBounds=!0;return this.packedBinaryOp(a,b,binaryop_packed_gpu.DIV,"float32",!0)}var program=new binaryop_gpu_1.BinaryOpProgram(op,a.shape,b.shape),output=this.makeOutputArray(program.outputShape,"float32");return this.compileAndRun(program,[a,b],output)},MathBackendWebGL.prototype.floorDiv=function(a,b){var op=binaryop_gpu.INT_DIV,outputDtype="int32";if(environment_1.ENV.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(a,b,binaryop_packed_gpu.INT_DIV,"int32");var program=new binaryop_gpu_1.BinaryOpProgram(op,a.shape,b.shape),output=this.makeOutputArray(program.outputShape,"int32");return this.compileAndRun(program,[a,b],output)},MathBackendWebGL.prototype.add=function(a,b){if("complex64"===a.dtype&&"complex64"===b.dtype)return this.complexSeparableBinaryOp(a,b,binaryop_gpu.ADD);if(this.shouldExecuteOnCPU([a,b]))return this.cpuBackend.add(a,b);var dtype=types_1.upcastType(a.dtype,b.dtype);if(environment_1.ENV.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(a,b,binaryop_gpu.ADD,dtype);var program=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.ADD,a.shape,b.shape),output=this.makeOutputArray(program.outputShape,dtype);return this.compileAndRun(program,[a,b],output)},MathBackendWebGL.prototype.packedUnaryOp=function(x,op,dtype){var program=new unaryop_packed_gpu_1.UnaryOpPackedProgram(x.shape,op),output=this.makePackedTensor(program.outputShape,dtype);return this.compileAndRun(program,[x],output)},MathBackendWebGL.prototype.packedBinaryOp=function(a,b,op,dtype,checkOutOfBounds){void 0===checkOutOfBounds&&(checkOutOfBounds=!1);var program=new binaryop_packed_gpu_1.BinaryOpPackedProgram(op,a.shape,b.shape,checkOutOfBounds),output=this.makePackedTensor(program.outputShape,dtype);return this.compileAndRun(program,[a,b],output)},MathBackendWebGL.prototype.complexSeparableBinaryOp=function(a,b,op){var _this=this,aData=this.texData.get(a.dataId),bData=this.texData.get(b.dataId),_a=[[aData.complexTensors.real,bData.complexTensors.real],[aData.complexTensors.imag,bData.complexTensors.imag]].map((function(complexParts){var aPart=complexParts[0],bPart=complexParts[1],aHandle=_this.makeComplexComponentTensorHandle(a,aPart),bHandle=_this.makeComplexComponentTensorHandle(b,bPart),program=new binaryop_gpu_1.BinaryOpProgram(op,a.shape,b.shape),output=_this.makeOutputArray(program.outputShape,types_1.upcastType(aPart.dtype,bPart.dtype));return _this.compileAndRun(program,[aHandle,bHandle],output)})),real=_a[0],imag=_a[1],complex=this.complex(real,imag);return real.dispose(),imag.dispose(),complex},MathBackendWebGL.prototype.makeComplexComponentTensorHandle=function(complexTensor,complexPart){return{dataId:complexPart.dataId,dtype:complexPart.dtype,shape:complexTensor.shape}},MathBackendWebGL.prototype.addN=function(tensors){if(1===tensors.length)return tensors[0];if(tensors.length>environment_1.ENV.get("WEBGL_MAX_TEXTURES_IN_SHADER")){var midIndex=Math.floor(tensors.length/2),leftSide=this.addN(tensors.slice(0,midIndex)),rightSide=this.addN(tensors.slice(midIndex));return this.addN([leftSide,rightSide])}var dtype=tensors.map((function(t){return t.dtype})).reduce((function(d1,d2){return types_1.upcastType(d1,d2)})),shapes=tensors.map((function(t){return t.shape})),usePackedOp=environment_1.ENV.getBool("WEBGL_PACK"),program=usePackedOp?new addn_packed_gpu_1.AddNPackedProgram(tensors[0].shape,shapes):new addn_gpu_1.AddNProgram(tensors[0].shape,shapes),output=usePackedOp?this.makePackedTensor(program.outputShape,dtype):this.makeOutputArray(program.outputShape,dtype);return this.compileAndRun(program,tensors,output)},MathBackendWebGL.prototype.subtract=function(a,b){if("complex64"===a.dtype&&"complex64"===b.dtype)return this.complexSeparableBinaryOp(a,b,binaryop_gpu.SUB);if(this.shouldExecuteOnCPU([a,b]))return this.cpuBackend.subtract(a,b);var dtype=types_1.upcastType(a.dtype,b.dtype);if(environment_1.ENV.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(a,b,binaryop_gpu.SUB,a.dtype);var program=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.SUB,a.shape,b.shape),output=this.makeOutputArray(program.outputShape,dtype);return this.compileAndRun(program,[a,b],output)},MathBackendWebGL.prototype.pow=function(a,b){var usePackedOp=environment_1.ENV.getBool("WEBGL_PACK_BINARY_OPERATIONS"),program=usePackedOp?new binaryop_packed_gpu_1.BinaryOpPackedProgram(binaryop_packed_gpu.POW,a.shape,b.shape):new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.POW,a.shape,b.shape),dtype=types_1.upcastType(a.dtype,b.dtype),output=usePackedOp?this.makePackedTensor(program.outputShape,dtype):this.makeOutputArray(program.outputShape,dtype);return this.compileAndRun(program,[a,b],output)},MathBackendWebGL.prototype.ceil=function(x){if(this.shouldExecuteOnCPU([x]))return this.cpuBackend.ceil(x);if(environment_1.ENV.getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(x,unary_op.CEIL,x.dtype);var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.CEIL);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.floor=function(x){if(this.shouldExecuteOnCPU([x]))return this.cpuBackend.floor(x);if(environment_1.ENV.getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(x,unary_op.FLOOR,x.dtype);var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.FLOOR);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.sign=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.SIGN);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.isNaN=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.IS_NAN),output=this.makeOutputArray(program.outputShape,"bool");return this.compileAndRun(program,[x],output)},MathBackendWebGL.prototype.isInf=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.IS_INF),output=this.makeOutputArray(program.outputShape,"bool");return this.compileAndRun(program,[x],output)},MathBackendWebGL.prototype.isFinite=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.IS_FINITE),output=this.makeOutputArray(program.outputShape,"bool");return this.compileAndRun(program,[x],output)},MathBackendWebGL.prototype.round=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.ROUND);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.exp=function(x){if(this.shouldExecuteOnCPU([x]))return this.cpuBackend.exp(x);if(environment_1.ENV.getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(x,unary_op.EXP,x.dtype);var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.EXP);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.expm1=function(x){if(this.shouldExecuteOnCPU([x]))return this.cpuBackend.expm1(x);if(environment_1.ENV.getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(x,unary_op.EXPM1,x.dtype);var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.EXPM1);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.log=function(x){if(this.shouldExecuteOnCPU([x]))return this.cpuBackend.log(x);if(environment_1.ENV.getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(x,unary_packed_op.LOG,x.dtype);var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.LOG);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.log1p=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.LOG1P);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.sqrt=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.SQRT);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.rsqrt=function(x){if(this.shouldExecuteOnCPU([x]))return this.cpuBackend.rsqrt(x);var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.RSQRT);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.square=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.SQUARE);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.reciprocal=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.RECIPROCAL);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.relu=function(x){var program;return program=environment_1.ENV.getBool("WEBGL_PACK")?new unaryop_packed_gpu_1.UnaryOpPackedProgram(x.shape,unary_packed_op.RELU):new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.RELU),this.compileAndRun(program,[x])},MathBackendWebGL.prototype.prelu=function(x,alpha){var program=environment_1.ENV.getBool("WEBGL_PACK_BINARY_OPERATIONS")?new binaryop_packed_gpu_1.BinaryOpPackedProgram(binaryop_packed_gpu.PRELU,x.shape,alpha.shape):new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.PRELU,x.shape,alpha.shape);return this.compileAndRun(program,[x,alpha])},MathBackendWebGL.prototype.elu=function(x){if(environment_1.ENV.getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(x,unary_packed_op.ELU,x.dtype);var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.ELU);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.eluDer=function(dy,y){var program=environment_1.ENV.getBool("WEBGL_PACK_BINARY_OPERATIONS")?new binaryop_packed_gpu_1.BinaryOpPackedProgram(binaryop_packed_gpu.ELU_DER,dy.shape,y.shape):new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.ELU_DER,dy.shape,y.shape);return this.compileAndRun(program,[dy,y])},MathBackendWebGL.prototype.selu=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.SELU);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.int=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.TO_INT),output=this.makeOutputArray(program.outputShape,"int32");return this.compileAndRun(program,[x],output)},MathBackendWebGL.prototype.clip=function(x,min,max){var program,customSetup=(program=environment_1.ENV.getBool("WEBGL_PACK_CLIP")?new clip_packed_gpu_1.ClipPackedProgram(x.shape):new clip_gpu_1.ClipProgram(x.shape)).getCustomSetupFunc(min,max);return this.compileAndRun(program,[x],null,customSetup)},MathBackendWebGL.prototype.abs=function(x){if(this.shouldExecuteOnCPU([x]))return this.cpuBackend.abs(x);if(environment_1.ENV.getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(x,unary_op.ABS,x.dtype);var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.ABS);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.complexAbs=function(x){var xData=this.texData.get(x.dataId),program=new complex_abs_gpu_1.ComplexAbsProgram(x.shape),inputs=[this.makeComplexComponentTensorHandle(x,xData.complexTensors.real),this.makeComplexComponentTensorHandle(x,xData.complexTensors.imag)];return this.compileAndRun(program,inputs)},MathBackendWebGL.prototype.sigmoid=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.SIGMOID);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.softplus=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.SOFTPLUS);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.sin=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.SIN);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.cos=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.COS);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.tan=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.TAN);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.asin=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.ASIN);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.acos=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.ACOS);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.atan=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.ATAN);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.atan2=function(a,b){var program=environment_1.ENV.getBool("WEBGL_PACK_BINARY_OPERATIONS")?new binaryop_packed_gpu_1.BinaryOpPackedProgram(binaryop_packed_gpu.ATAN2,a.shape,b.shape):new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.ATAN2,a.shape,b.shape);return this.compileAndRun(program,[a,b])},MathBackendWebGL.prototype.sinh=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.SINH);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.cosh=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.COSH);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.tanh=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.TANH);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.asinh=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.ASINH);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.acosh=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.ACOSH);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.atanh=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.ATANH);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.erf=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.ERF);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.step=function(x,alpha){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.STEP(alpha));return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.conv2dByMatMul=function(x,filter,convInfo,bias,activation,preluActivationWeights){var xShape=x.shape,xTexData=this.texData.get(x.dataId),sharedMatMulDim=convInfo.inChannels,outerShapeX=xShape[0]*xShape[1]*xShape[2],outerShapeFilter=convInfo.outChannels,isChannelsLast="channelsLast"===convInfo.dataFormat,transposeA=!1,transposeB=!1,batchMatMulWillBeUnpacked=(1===outerShapeX||1===outerShapeFilter)&&sharedMatMulDim>exports.MATMUL_SHARED_DIM_THRESHOLD,reshapeWillBeExpensive=xShape[2]%2!=0&&!!xTexData.isPacked;if(batchMatMulWillBeUnpacked||!environment_1.ENV.getBool("WEBGL_LAZILY_UNPACK")||!environment_1.ENV.getBool("WEBGL_PACK_BINARY_OPERATIONS")||!reshapeWillBeExpensive){var targetShape_1=isChannelsLast?xShape[0]*xShape[1]*xShape[2]:xShape[0]*xShape[2]*xShape[3],xReshaped_1=this.reshape(x,[1,targetShape_1,convInfo.inChannels]),filterReshaped_1=this.reshape(filter,[1,convInfo.inChannels,convInfo.outChannels]);return this.reshape(this.fusedBatchMatMul({a:xReshaped_1,b:filterReshaped_1,transposeA:!1,transposeB:!1,bias:bias,activation:activation,preluActivationWeights:preluActivationWeights}),convInfo.outShape)}var targetShape=isChannelsLast?xShape[0]*xShape[1]*(xShape[2]+1):xShape[0]*xShape[2]*(xShape[3]+1),xReshaped=tensor_1.Tensor.make([1,targetShape,convInfo.inChannels],{dataId:x.dataId},x.dtype,this),originalXTexDataShape=xTexData.shape;xTexData.shape=xTexData.shape.slice(),xTexData.shape[xTexData.shape.length-2]++,util.assert(webgl_util.isReshapeFree(xTexData.shape,xReshaped.shape),(function(){return"packed reshape "+xTexData.shape+" to "+xReshaped.shape+" isn't free"}));var filterReshaped=this.reshape(filter,[1,convInfo.inChannels,convInfo.outChannels]),pointwiseConv=this.fusedBatchMatMul({a:xReshaped,b:filterReshaped,transposeA:!1,transposeB:!1,bias:bias,activation:activation,preluActivationWeights:preluActivationWeights}),pointwiseConvTexData=this.texData.get(pointwiseConv.dataId);return util.assert(pointwiseConvTexData.isPacked,(function(){return"batchMatMul result is expected to be packed"})),xTexData.shape=originalXTexDataShape,pointwiseConvTexData.shape=convInfo.outShape,tensor_1.Tensor.make(convInfo.outShape,{dataId:pointwiseConv.dataId},pointwiseConv.dtype,this)},MathBackendWebGL.prototype.conv2dWithIm2Row=function(x,filter,convInfo,bias,activation,preluActivationWeights){var filterWidth=convInfo.filterWidth,filterHeight=convInfo.filterHeight,inChannels=convInfo.inChannels,outWidth=convInfo.outWidth,outHeight=convInfo.outHeight,dataFormat,isChannelsLast="channelsLast"===convInfo.dataFormat,sharedDim=filterWidth*filterHeight*inChannels,numCols=outHeight*outWidth,x2ColShape=[sharedDim,numCols],transposeA=!0,transposeB=!1,xSqueezed=x.squeeze([0]),w2Row=filter.reshape([1,sharedDim,-1]),im2ColProgram=new im2col_packed_gpu_1.Im2ColPackedProgram(x2ColShape,xSqueezed.shape,convInfo),im2Col=this.compileAndRun(im2ColProgram,[xSqueezed]).reshape([1,x2ColShape[0],x2ColShape[1]]),hasBias=null!=bias,hasPreluActivationWeights=null!=preluActivationWeights,fusedActivation=activation?mapActivationToShaderProgram(activation,!0):null,matmulProgram=new mulmat_packed_gpu_1.MatMulPackedProgram(im2Col.shape,[1,numCols,convInfo.outChannels],!0,!1,hasBias,fusedActivation,hasPreluActivationWeights),inputs=[im2Col,w2Row];bias&&inputs.push(bias),hasPreluActivationWeights&&inputs.push(preluActivationWeights);var product=this.compileAndRun(matmulProgram,inputs);return isChannelsLast?product.reshape([1,outHeight,outWidth,convInfo.outChannels]):product.reshape([1,convInfo.outChannels,outHeight,outWidth])},MathBackendWebGL.prototype.fusedConv2d=function(x,filter,convInfo,bias,activation,preluActivationWeights){if(1===convInfo.filterHeight&&1===convInfo.filterWidth&&1===convInfo.dilationHeight&&1===convInfo.dilationWidth&&1===convInfo.strideHeight&&1===convInfo.strideWidth&&("SAME"===convInfo.padInfo.type||"VALID"===convInfo.padInfo.type))return this.conv2dByMatMul(x,filter,convInfo,bias,activation,preluActivationWeights);if(environment_1.ENV.getBool("WEBGL_CONV_IM2COL")&&1===x.shape[0])return this.conv2dWithIm2Row(x,filter,convInfo,bias,activation,preluActivationWeights);var hasBias=null!=bias,hasPreluActivationWeights=null!=preluActivationWeights,fusedActivation=activation?mapActivationToShaderProgram(activation,!1):null,program=new conv_gpu_1.Conv2DProgram(convInfo,hasBias,fusedActivation,hasPreluActivationWeights),inputs=[x,filter];return bias&&inputs.push(bias),preluActivationWeights&&inputs.push(preluActivationWeights),this.compileAndRun(program,inputs)},MathBackendWebGL.prototype.conv2d=function(x,filter,convInfo){if(1===convInfo.filterHeight&&1===convInfo.filterWidth&&1===convInfo.dilationHeight&&1===convInfo.dilationWidth&&1===convInfo.strideHeight&&1===convInfo.strideWidth&&("SAME"===convInfo.padInfo.type||"VALID"===convInfo.padInfo.type))return this.conv2dByMatMul(x,filter,convInfo);if(environment_1.ENV.getBool("WEBGL_CONV_IM2COL")&&1===x.shape[0])return this.conv2dWithIm2Row(x,filter,convInfo);var program=new conv_gpu_1.Conv2DProgram(convInfo);return this.compileAndRun(program,[x,filter])},MathBackendWebGL.prototype.conv2dDerInput=function(dy,filter,convInfo){var program=new conv_backprop_gpu_1.Conv2DDerInputProgram(convInfo);return this.compileAndRun(program,[dy,filter])},MathBackendWebGL.prototype.conv2dDerFilter=function(x,dy,convInfo){var program=new conv_backprop_gpu_1.Conv2DDerFilterProgram(convInfo);return this.compileAndRun(program,[x,dy])},MathBackendWebGL.prototype.depthwiseConv2D=function(x,filter,convInfo){var program;return environment_1.ENV.getBool("WEBGL_PACK_DEPTHWISECONV")&&convInfo.strideWidth<=2&&convInfo.outChannels/convInfo.inChannels==1?(program=new conv_packed_gpu_depthwise_1.DepthwiseConvPacked2DProgram(convInfo),this.compileAndRun(program,[x,filter],this.makePackedTensor(convInfo.outShape,x.dtype))):(program=new conv_gpu_depthwise_1.DepthwiseConv2DProgram(convInfo),this.compileAndRun(program,[x,filter]))},MathBackendWebGL.prototype.depthwiseConv2DDerInput=function(dy,filter,convInfo){var program=new conv_backprop_gpu_depthwise_1.DepthwiseConv2DDerInputProgram(convInfo);return this.compileAndRun(program,[dy,filter])},MathBackendWebGL.prototype.depthwiseConv2DDerFilter=function(x,dy,convInfo){var program=new conv_backprop_gpu_depthwise_1.DepthwiseConv2DDerFilterProgram(convInfo);return this.compileAndRun(program,[x,dy])},MathBackendWebGL.prototype.conv3d=function(x,filter,convInfo){var program=new conv_gpu_1.Conv3DProgram(convInfo);return this.compileAndRun(program,[x,filter])},MathBackendWebGL.prototype.conv3dDerInput=function(dy,filter,convInfo){var program=new conv_backprop_gpu_1.Conv3DDerInputProgram(convInfo);return this.compileAndRun(program,[dy,filter])},MathBackendWebGL.prototype.conv3dDerFilter=function(x,dy,convInfo){var program=new conv_backprop_gpu_1.Conv3DDerFilterProgram(convInfo);return this.compileAndRun(program,[x,dy])},MathBackendWebGL.prototype.maxPool=function(x,convInfo){var program=new pool_gpu_1.Pool2DProgram(convInfo,"max",!1),output=this.makeOutputArray(program.outputShape,x.dtype);return this.compileAndRun(program,[x],output)},MathBackendWebGL.prototype.avgPool=function(x,convInfo){var program=new pool_gpu_1.Pool2DProgram(convInfo,"avg",!1),output=this.makeOutputArray(program.outputShape,"float32");return this.compileAndRun(program,[x],output)},MathBackendWebGL.prototype.maxPoolBackprop=function(dy,x,y,convInfo){var getPositions=!0,maxPoolPositionsProgram=new pool_gpu_1.Pool2DProgram(convInfo,"max",!0),maxPoolPositions=this.compileAndRun(maxPoolPositionsProgram,[x]),maxPoolBackPropProgram=new max_pool_backprop_gpu_1.MaxPool2DBackpropProgram(convInfo),output=this.makeOutputArray(maxPoolBackPropProgram.outputShape,x.dtype),result=this.compileAndRun(maxPoolBackPropProgram,[dy,maxPoolPositions],output);return maxPoolPositions.dispose(),result},MathBackendWebGL.prototype.avgPoolBackprop=function(dy,x,convInfo){var avgPoolBackpropProgram=new avg_pool_backprop_gpu_1.AvgPool2DBackpropProgram(convInfo),output=this.makeOutputArray(avgPoolBackpropProgram.outputShape,x.dtype);return this.compileAndRun(avgPoolBackpropProgram,[dy],output)},MathBackendWebGL.prototype.cast=function(x,dtype){return backend_util.castTensor(x,dtype,this)},MathBackendWebGL.prototype.unstack=function(x,axis){for(var num=x.shape[axis],outShape=new Array(x.rank-1),outIndex=0,i=0;i<x.rank;i++)i!==axis&&(outShape[outIndex++]=x.shape[i]);var begin=new Array(x.rank).fill(0),size=x.shape.slice();size[axis]=1;for(var res=new Array(num),i=0;i<res.length;i++)begin[axis]=i,res[i]=this.slice(x,begin,size).reshape(outShape);return res},MathBackendWebGL.prototype.avgPool3d=function(x,convInfo){var program=new pool_gpu_1.Pool3DProgram(convInfo,"avg",!1),output=this.makeOutputArray(program.outputShape,"float32");return this.compileAndRun(program,[x],output)},MathBackendWebGL.prototype.avgPool3dBackprop=function(dy,x,convInfo){var avgPool3dBackpropProgram=new avg_pool_backprop_gpu_1.AvgPool3DBackpropProgram(convInfo),output=this.makeOutputArray(avgPool3dBackpropProgram.outputShape,x.dtype);return this.compileAndRun(avgPool3dBackpropProgram,[dy],output)},MathBackendWebGL.prototype.maxPool3d=function(x,convInfo){var program=new pool_gpu_1.Pool3DProgram(convInfo,"max",!1),output=this.makeOutputArray(program.outputShape,"float32");return this.compileAndRun(program,[x],output)},MathBackendWebGL.prototype.maxPool3dBackprop=function(dy,x,y,convInfo){var getPositions=!0,maxPool3dPositionsProgram=new pool_gpu_1.Pool3DProgram(convInfo,"max",!0),maxPool3dPositions=this.compileAndRun(maxPool3dPositionsProgram,[x]),maxPool3dBackPropProgram=new max_pool_backprop_gpu_1.MaxPool3DBackpropProgram(convInfo),output=this.makeOutputArray(maxPool3dBackPropProgram.outputShape,x.dtype),result=this.compileAndRun(maxPool3dBackPropProgram,[dy,maxPool3dPositions],output);return maxPool3dPositions.dispose(),result},MathBackendWebGL.prototype.reshape=function(x,shape){var texData=this.texData.get(x.dataId);return!texData.isPacked||webgl_util.isReshapeFree(x.shape,shape)||null!==texData.texture&&webgl_util.isReshapeFree(texData.shape,shape)?backend_util.reshapeTensor(x,shape):this.packedReshape(x,shape)},MathBackendWebGL.prototype.resizeBilinear=function(x,newHeight,newWidth,alignCorners){var program=environment_1.ENV.getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new resize_bilinear_packed_gpu_1.ResizeBilinearPackedProgram(x.shape,newHeight,newWidth,alignCorners):new resize_bilinear_gpu_1.ResizeBilinearProgram(x.shape,newHeight,newWidth,alignCorners);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.resizeBilinearBackprop=function(dy,x,alignCorners){var program=new resize_bilinear_backprop_gpu_1.ResizeBilinearBackpropProgram(dy,x,alignCorners);return this.compileAndRun(program,[dy])},MathBackendWebGL.prototype.resizeNearestNeighbor=function(x,newHeight,newWidth,alignCorners){var program=new resize_nearest_neighbor_gpu_1.ResizeNearestNeighborProgram(x.shape,newHeight,newWidth,alignCorners);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.resizeNearestNeighborBackprop=function(dy,x,alignCorners){var program=new resize_nearest_neighbor_backprop_gpu_1.ResizeNearestNeigborBackpropProgram(dy,x,alignCorners);return this.compileAndRun(program,[dy])},MathBackendWebGL.prototype.multinomial=function(logits,normalized,numSamples,seed){var probs=normalized?logits:softmax_1.softmax(logits),batchSize=probs.shape[0],numOutcomes=probs.shape[1],program=new multinomial_gpu_1.MultinomialProgram(batchSize,numOutcomes,numSamples),output=this.makeOutputArray(program.outputShape,"int32"),customSetup=program.getCustomSetupFunc(seed);return this.compileAndRun(program,[probs],output,customSetup)},MathBackendWebGL.prototype.oneHot=function(indices,depth,onValue,offValue){var program=new onehot_gpu_1.OneHotProgram(indices.size,depth,onValue,offValue);return this.compileAndRun(program,[indices])},MathBackendWebGL.prototype.diag=function(x){var program=new diag_gpu_1.DiagProgram(x.size);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.nonMaxSuppression=function(boxes,scores,maxOutputSize,iouThreshold,scoreThreshold){log_1.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var boxesVals=boxes.dataSync(),scoresVals=scores.dataSync();return non_max_suppression_impl_1.nonMaxSuppressionImpl(boxesVals,scoresVals,maxOutputSize,iouThreshold,scoreThreshold)},MathBackendWebGL.prototype.cropAndResize=function(image,boxes,boxIndex,cropSize,method,extrapolationValue){var program=new crop_and_resize_gpu_1.CropAndResizeProgram(image.shape,boxes.shape,cropSize,method,extrapolationValue);return this.compileAndRun(program,[image,boxes,boxIndex])},MathBackendWebGL.prototype.depthToSpace=function(x,blockSize,dataFormat){util.assert(blockSize>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: "+blockSize}));var batchSize=x.shape[0],inputHeight="NHWC"===dataFormat?x.shape[1]:x.shape[2],inputWidth="NHWC"===dataFormat?x.shape[2]:x.shape[3],inputDepth="NHWC"===dataFormat?x.shape[3]:x.shape[1],outputHeight=inputHeight*blockSize,outputWidth=inputWidth*blockSize,outputDepth=inputDepth/(blockSize*blockSize),outputShape="NHWC"===dataFormat?[batchSize,outputHeight,outputWidth,outputDepth]:[batchSize,outputDepth,outputHeight,outputWidth],program=new depth_to_space_gpu_1.DepthToSpaceProgram(outputShape,blockSize,dataFormat);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.split=function(x,sizeSplits,axis){return split_shared_1.split(x,sizeSplits,axis)},MathBackendWebGL.prototype.scatterND=function(indices,updates,shape){var _a=scatter_nd_util.calculateShapes(updates,indices,shape),sliceRank=_a.sliceRank,numUpdates=_a.numUpdates,sliceSize=_a.sliceSize,strides=_a.strides,outputSize=_a.outputSize,flattenShape=[outputSize/sliceSize,sliceSize],flattenIndices=indices.reshape([numUpdates,sliceRank]),flattenX=updates.reshape([numUpdates,sliceSize]);if(0===outputSize)return backend_util.reshapeTensor(tensor_ops_1.tensor([]),shape);var defaultValue=tensor_ops_1.scalar(0),program=new scatter_gpu_1.ScatterProgram(numUpdates,sliceRank,flattenIndices.rank,flattenX.rank,strides,flattenShape),res;return this.compileAndRun(program,[flattenX,flattenIndices,defaultValue]).reshape(shape)},MathBackendWebGL.prototype.sparseToDense=function(sparseIndices,sparseValues,outputShape,defaultValue){var _a=scatter_nd_util.calculateShapes(sparseValues,sparseIndices,outputShape),sliceRank=_a.sliceRank,numUpdates=_a.numUpdates,strides=_a.strides,outputSize=_a.outputSize,sumDupeIndices=!1,program=new scatter_gpu_1.ScatterProgram(numUpdates,sliceRank,sparseIndices.rank,sparseValues.rank,strides,[outputSize,1],!1),res;return this.compileAndRun(program,[sparseValues,sparseIndices,defaultValue]).reshape(outputShape)},MathBackendWebGL.prototype.fft=function(x){var inverse=!1;return this.fftImpl(x,!1)},MathBackendWebGL.prototype.ifft=function(x){var inverse=!0;return this.fftImpl(x,!0)},MathBackendWebGL.prototype.fftImpl=function(x,inverse){var xData=this.texData.get(x.dataId),realProgram=new fft_gpu_1.FFTProgram(fft_gpu.COMPLEX_FFT.REAL,x.shape,inverse),imagProgram=new fft_gpu_1.FFTProgram(fft_gpu.COMPLEX_FFT.IMAG,x.shape,inverse),inputs=[this.makeComplexComponentTensorHandle(x,xData.complexTensors.real),this.makeComplexComponentTensorHandle(x,xData.complexTensors.imag)],real=this.compileAndRun(realProgram,inputs),imag=this.compileAndRun(imagProgram,inputs),complex=this.complex(real,imag).as2D(x.shape[0],x.shape[1]);return real.dispose(),imag.dispose(),complex},MathBackendWebGL.prototype.gatherND=function(x,indices){var indicesShape=indices.shape,sliceRank=indicesShape[indicesShape.length-1],_a=gather_nd_util.prepareAndValidate(x,indices),resultShape=_a[0],numSlices=_a[1],sliceSize=_a[2],strides=_a[3],flattenIndices=indices.reshape([numSlices,sliceRank]),flattenX=x.reshape([x.size/sliceSize,sliceSize]),program=new gather_nd_gpu_1.GatherNDProgram(sliceRank,strides,[numSlices,sliceSize]),res;return this.compileAndRun(program,[flattenX,flattenIndices]).reshape(resultShape)},MathBackendWebGL.prototype.fill=function(shape,value,dtype){if("string"===(dtype=dtype||util_1.inferDtype(value))){var values=util_1.getArrayFromDType(dtype,util_1.sizeFromShape(shape));return values.fill(value),tensor_1.Tensor.make(shape,{values:values},dtype)}var program=new fill_gpu_1.FillProgram(shape,value),customSetup=program.getCustomSetupFunc(value),output=this.makeOutputArray(shape,dtype);return this.compileAndRun(program,[],output,customSetup)},MathBackendWebGL.prototype.onesLike=function(x){if("string"===x.dtype)throw new Error("onesLike is not supported under string dtype");return this.fill(x.shape,1,x.dtype)},MathBackendWebGL.prototype.zerosLike=function(x){return this.fill(x.shape,"string"===x.dtype?"":0,x.dtype)},MathBackendWebGL.prototype.linspace=function(start,stop,num){return backend_util.linspaceImpl(start,stop,num)},MathBackendWebGL.prototype.makeOutputArray=function(shape,dtype){return tensor_1.Tensor.make(shape,{},dtype,this)},MathBackendWebGL.prototype.makePackedTensor=function(shape,dtype){var packedTensor=tensor_1.Tensor.make(shape,{},dtype,this);return this.texData.get(packedTensor.dataId).isPacked=!0,packedTensor},MathBackendWebGL.prototype.unpackTensor=function(input){var program=new unpack_gpu_1.UnpackProgram(input.shape);return this.compileAndRun(program,[input],tensor_1.Tensor.make(program.outputShape,{},input.dtype,this))},MathBackendWebGL.prototype.packTensor=function(input){var program=new pack_gpu_1.PackProgram(input.shape);return this.compileAndRun(program,[input],this.makePackedTensor(input.shape,input.dtype),null,!0)},MathBackendWebGL.prototype.packedReshape=function(input,afterShape){var inputAs3D=input.reshape([webgl_util.getBatchDim(input.shape)].concat(webgl_util.getRowsCols(input.shape))),afterShapeAs3D=[webgl_util.getBatchDim(afterShape)].concat(webgl_util.getRowsCols(afterShape)),program=new reshape_packed_gpu_1.ReshapePackedProgram(afterShapeAs3D,inputAs3D.shape);return this.compileAndRun(program,[inputAs3D]).reshape(afterShape)},MathBackendWebGL.prototype.decode=function(dataId){var texData=this.texData.get(dataId),isPacked=texData.isPacked,shape=texData.shape,dtype=texData.dtype,shapeAs3D=webgl_util.getShapeAs3D(shape),denseTexShape=tex_util.getDenseTexShape(shape),tmpTarget=this.makeTensorHandle(shape,"float32"),program;return this.texData.get(tmpTarget.dataId).isPacked=!0,this.texData.get(tmpTarget.dataId).dtype=dtype,this.texData.get(tmpTarget.dataId).texShape=denseTexShape.map((function(d){return 2*d})),program=isPacked?new decode_matrix_packed_gpu_1.DecodeMatrixPackedProgram(shapeAs3D,denseTexShape):new decode_matrix_gpu_1.DecodeMatrixProgram(shapeAs3D,denseTexShape),this.compileAndRun(program,[{shape:shapeAs3D,dtype:dtype,dataId:dataId}],tmpTarget,null,!0),tmpTarget},MathBackendWebGL.prototype.compileAndRun=function(program,inputs,output,customSetup,preventEagerUnpackingOfOutput){var _this=this;if(void 0===preventEagerUnpackingOfOutput&&(preventEagerUnpackingOfOutput=!1),null==output&&(output=program.usesPackedTextures?this.makePackedTensor(program.outputShape,inputs[0].dtype):this.makeOutputArray(program.outputShape,inputs[0].dtype)),0===output.size)return this.texData.get(output.dataId).values=util_1.getTypedArrayFromDType(output.dtype,0),output;var inputsData=inputs.map((function(input){if("complex64"===input.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var texData=_this.texData.get(input.dataId);if(null==texData.texture){if(!program.usesPackedTextures&&util.sizeFromShape(input.shape)<=environment_1.ENV.getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:input.shape,texData:null,isUniform:!0,uniformValues:texData.values};program.usesPackedTextures&&(texData.isPacked=!0,texData.shape=input.shape)}else if(!!texData.isPacked!=!!program.usesPackedTextures)input=texData.isPacked?_this.unpackTensor(input):_this.packTensor(input),texData=_this.texData.get(input.dataId);else if(texData.isPacked&&!webgl_util.isReshapeFree(texData.shape,input.shape)){var savedInput=input,targetShape=input.shape;input.shape=texData.shape,input=_this.packedReshape(input,targetShape),texData=_this.texData.get(input.dataId),savedInput.shape=targetShape}return _this.uploadToGPU(input.dataId),{shape:input.shape,texData:texData,isUniform:!1}}));this.uploadToGPU(output.dataId);var outputData={shape:output.shape,texData:this.texData.get(output.dataId),isUniform:!1},key=gpgpu_math.makeShaderKey(program,inputsData,outputData),binary=this.getAndSaveBinary(key,(function(){return gpgpu_math.compileProgram(_this.gpgpu,program,inputsData,outputData)})),shouldTimeProgram=null!=this.activeTimers,query;return shouldTimeProgram&&(query=this.startTimer()),gpgpu_math.runProgram(this.gpgpu,binary,inputsData,outputData,customSetup),shouldTimeProgram&&(query=this.endTimer(query),this.activeTimers.push({name:program.constructor.name,query:this.getQueryTime(query)})),!environment_1.ENV.getBool("WEBGL_LAZILY_UNPACK")&&this.texData.get(output.dataId).isPacked&&!1===preventEagerUnpackingOfOutput?this.unpackTensor(output):output},MathBackendWebGL.prototype.getAndSaveBinary=function(key,getBinary){return key in this.binaryCache||(this.binaryCache[key]=getBinary()),this.binaryCache[key]},MathBackendWebGL.prototype.getTextureManager=function(){return this.textureManager},MathBackendWebGL.prototype.dispose=function(){this.disposed||(this.textureManager.dispose(),null!=this.canvas&&null!=this.canvas.remove?this.canvas.remove():this.canvas=null,null!=this.fromPixels2DContext&&this.fromPixels2DContext.canvas.remove&&this.fromPixels2DContext.canvas.remove(),this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},MathBackendWebGL.prototype.floatPrecision=function(){var _this=this;return null==this.floatPrecisionValue&&(this.floatPrecisionValue=globals_1.tidy((function(){if(!environment_1.ENV.get("WEBGL_RENDER_FLOAT32_ENABLED")){var debugFlag=environment_1.ENV.getBool("DEBUG");environment_1.ENV.set("DEBUG",!1);var underflowCheckValue=_this.abs(tensor_ops_1.scalar(1e-8)).dataSync()[0];if(environment_1.ENV.set("DEBUG",debugFlag),underflowCheckValue>0)return 32}return 16}))),this.floatPrecisionValue},MathBackendWebGL.prototype.epsilon=function(){return 32===this.floatPrecision()?backend_1.EPSILON_FLOAT32:backend_1.EPSILON_FLOAT16},MathBackendWebGL.prototype.uploadToGPU=function(dataId){var _a,texData=this.texData.get(dataId),shape=texData.shape,dtype=texData.dtype,values=texData.values,texture=texData.texture,usage=texData.usage,isPacked=texData.isPacked;if(null==texture){var shouldTimeProgram=null!=this.activeTimers,start;shouldTimeProgram&&(start=util.now());var texShape=texData.texShape;if(null==texShape&&(texShape=webgl_util.getTextureShapeFromLogicalShape(shape,isPacked),texData.texShape=texShape),null!=values){var shapeAs3D=webgl_util.getShapeAs3D(shape),program=void 0,width=texShape[1],height=texShape[0],isByteArray=values instanceof Uint8Array;isPacked?(width=(_a=tex_util.getPackedMatrixTextureShapeWidthHeight(texShape[0],texShape[1]))[0],height=_a[1],program=new encode_matrix_packed_gpu_1.EncodeMatrixPackedProgram(shapeAs3D,[height,width],isByteArray)):program=new encode_matrix_gpu_1.EncodeMatrixProgram(shapeAs3D,[height,width],isByteArray);var tempDenseInputHandle=this.makeTensorHandle([height,width],dtype);this.texData.get(tempDenseInputHandle.dataId).usage=isByteArray?tex_util_1.TextureUsage.PIXELS:tex_util_1.TextureUsage.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(tempDenseInputHandle.dataId),width,height,values);var encodedOutputTarget=this.makeTensorHandle(program.outputShape,tempDenseInputHandle.dtype);encodedOutputTarget.size=util_1.sizeFromShape(program.outputShape),this.texData.get(encodedOutputTarget.dataId).isPacked=isPacked,this.compileAndRun(program,[tempDenseInputHandle],encodedOutputTarget);var outputTexData=this.texData.get(encodedOutputTarget.dataId);texData.texture=outputTexData.texture,texData.texShape=outputTexData.texShape,texData.isPacked=outputTexData.isPacked,texData.usage=outputTexData.usage,this.disposeData(tempDenseInputHandle.dataId),this.texData.delete(encodedOutputTarget.dataId),texData.values=null,shouldTimeProgram&&(this.uploadWaitMs+=util.now()-start)}else{var newTexture=this.acquireTexture(texShape,usage,dtype,isPacked);texData.texture=newTexture}}},MathBackendWebGL.prototype.convertAndCacheOnCPU=function(dataId,float32Values){var texData=this.texData.get(dataId),dtype=texData.dtype;return this.releaseGPUData(dataId),null!=float32Values&&(texData.values=float32ToTypedArray(float32Values,dtype)),texData.values},MathBackendWebGL.prototype.acquireTexture=function(texShape,texType,dtype,isPacked){if(this.numBytesInGPU+=this.computeBytes(texShape,dtype),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var mb=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+mb+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(texShape,texType,isPacked)},MathBackendWebGL.prototype.computeBytes=function(shape,dtype){return shape[0]*shape[1]*util.bytesPerElement(dtype)},MathBackendWebGL}();function float32ToTypedArray(a,dtype){if("float32"===dtype||"complex64"===dtype)return a;if("int32"===dtype||"bool"===dtype){for(var result="int32"===dtype?new Int32Array(a.length):new Uint8Array(a.length),i=0;i<result.length;++i)result[i]=Math.round(a[i]);return result}throw new Error("Unknown dtype "+dtype)}exports.MathBackendWebGL=MathBackendWebGL,device_util.isBrowser()&&engine_1.ENGINE.registerBackend("webgl",(function(){return new MathBackendWebGL}),2)},{"../../device_util":149,"../../engine":150,"../../environment":151,"../../globals":153,"../../log":168,"../../ops/array_ops":170,"../../ops/array_ops_util":171,"../../ops/axis_util":172,"../../ops/complex_ops":179,"../../ops/concat_util":181,"../../ops/gather_nd_util":191,"../../ops/reduce_util":206,"../../ops/scatter_nd_util":211,"../../ops/segment_util":213,"../../ops/slice_util":217,"../../ops/softmax":218,"../../ops/tensor_ops":223,"../../tensor":241,"../../types":247,"../../util":248,"../backend":57,"../backend_util":58,"../complex_util":59,"../non_max_suppression_impl":61,"../split_shared":63,"../tile_impl":64,"../topk_impl":65,"../where_impl":147,"./addn_gpu":66,"./addn_packed_gpu":67,"./argminmax_gpu":68,"./argminmax_packed_gpu":69,"./avg_pool_backprop_gpu":70,"./batchnorm_gpu":72,"./batchnorm_packed_gpu":73,"./binaryop_complex_gpu":74,"./binaryop_gpu":75,"./binaryop_packed_gpu":76,"./canvas_util":77,"./clip_gpu":78,"./clip_packed_gpu":79,"./complex_abs_gpu":80,"./concat_gpu":81,"./concat_packed_gpu":82,"./conv_backprop_gpu":83,"./conv_backprop_gpu_depthwise":84,"./conv_gpu":85,"./conv_gpu_depthwise":86,"./conv_packed_gpu_depthwise":87,"./crop_and_resize_gpu":88,"./cumsum_gpu":89,"./decode_matrix_gpu":90,"./decode_matrix_packed_gpu":91,"./depth_to_space_gpu":92,"./diag_gpu":93,"./encode_float_gpu":94,"./encode_float_packed_gpu":95,"./encode_matrix_gpu":96,"./encode_matrix_packed_gpu":97,"./fft_gpu":98,"./fill_gpu":99,"./flags_webgl":100,"./from_pixels_gpu":101,"./from_pixels_packed_gpu":102,"./gather_gpu":103,"./gather_nd_gpu":104,"./gpgpu_context":106,"./gpgpu_math":107,"./im2col_packed_gpu":109,"./lrn_gpu":110,"./lrn_grad_gpu":111,"./lrn_packed_gpu":112,"./max_pool_backprop_gpu":113,"./mulmat_packed_gpu":114,"./multinomial_gpu":115,"./onehot_gpu":116,"./pack_gpu":117,"./pad_gpu":118,"./pad_packed_gpu":119,"./pool_gpu":120,"./reduce_gpu":121,"./reshape_packed_gpu":122,"./resize_bilinear_backprop_gpu":123,"./resize_bilinear_gpu":124,"./resize_bilinear_packed_gpu":125,"./resize_nearest_neighbor_backprop_gpu":126,"./resize_nearest_neighbor_gpu":127,"./reverse_gpu":128,"./reverse_packed_gpu":129,"./scatter_gpu":130,"./segment_gpu":131,"./select_gpu":132,"./slice_gpu":135,"./slice_packed_gpu":136,"./strided_slice_gpu":137,"./tex_util":138,"./texture_manager":139,"./tile_gpu":140,"./transpose_gpu":141,"./transpose_packed_gpu":142,"./unaryop_gpu":143,"./unaryop_packed_gpu":144,"./unpack_gpu":145,"./webgl_util":146}],72:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2017 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var broadcast_util=require("../../ops/broadcast_util"),BatchNormProgram=function(){function BatchNormProgram(xShape,meanShape,varianceShape,offsetShape,scaleShape,varianceEpsilon){this.outputShape=[],this.variableNames=["x","mean","variance"],broadcast_util.assertAndGetBroadcastShape(xShape,meanShape),broadcast_util.assertAndGetBroadcastShape(xShape,varianceShape);var offsetSnippet="0.0";null!=offsetShape&&(broadcast_util.assertAndGetBroadcastShape(xShape,offsetShape),this.variableNames.push("offset"),offsetSnippet="getOffsetAtOutCoords()");var scaleSnippet="1.0";null!=scaleShape&&(broadcast_util.assertAndGetBroadcastShape(xShape,scaleShape),this.variableNames.push("scale"),scaleSnippet="getScaleAtOutCoords()"),this.outputShape=xShape,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = "+offsetSnippet+";\n        float scale = "+scaleSnippet+";\n        float inv = scale * inversesqrt(variance + float("+varianceEpsilon+"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    "}return BatchNormProgram}();exports.BatchNormProgram=BatchNormProgram},{"../../ops/broadcast_util":176}],73:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var broadcast_util=require("../../ops/broadcast_util"),BatchNormPackedProgram=function(){function BatchNormPackedProgram(xShape,meanShape,varianceShape,offsetShape,scaleShape,varianceEpsilon){this.usesPackedTextures=!0,this.variableNames=["x","mean","variance"],broadcast_util.assertAndGetBroadcastShape(xShape,meanShape),broadcast_util.assertAndGetBroadcastShape(xShape,varianceShape);var offsetSnippet="vec4(0.0)";null!=offsetShape&&(broadcast_util.assertAndGetBroadcastShape(xShape,offsetShape),this.variableNames.push("offset"),offsetSnippet="getOffsetAtOutCoords()");var scaleSnippet="vec4(1.0)";null!=scaleShape&&(broadcast_util.assertAndGetBroadcastShape(xShape,scaleShape),this.variableNames.push("scale"),scaleSnippet="getScaleAtOutCoords()"),this.outputShape=xShape,this.userCode="\n      void main() {\n        vec4 offset = "+offsetSnippet+";\n        vec4 scale = "+scaleSnippet+";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4("+varianceEpsilon+"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    "}return BatchNormPackedProgram}();exports.BatchNormPackedProgram=BatchNormPackedProgram},{"../../ops/broadcast_util":176}],74:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var broadcast_util=require("../../ops/broadcast_util");exports.COMPLEX_MULTIPLY={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"};var BinaryOpComplexProgram=function(){function BinaryOpComplexProgram(op,aShape,bShape){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=broadcast_util.assertAndGetBroadcastShape(aShape,bShape),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        "+op+"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    "}return BinaryOpComplexProgram}();exports.BinaryOpComplexProgram=BinaryOpComplexProgram},{"../../ops/broadcast_util":176}],75:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2017 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var broadcast_util=require("../../ops/broadcast_util"),CHECK_NAN_SNIPPET="\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n";exports.ADD="return a + b;",exports.SUB="return a - b;",exports.MUL="return a * b;",exports.DIV="\nif (b == 0.0) {\n  return NAN;\n}\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",exports.INT_DIV="\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",exports.POW="\nif(a < 0.0 && floor(b) < b){\n  return NAN;\n}\nif (b == 0.0) {\n  return 1.0;\n}\nreturn (round(mod(b, 2.0)) != 1) ?\n    pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",exports.SQUARED_DIFFERENCE="return (a - b) * (a - b);",exports.EQUAL="return float(a == b);",exports.NOT_EQUAL="return float(a != b);",exports.LESS="return float(a < b);",exports.LESS_EQUAL="return float(a <= b);",exports.GREATER="return float(a > b);",exports.GREATER_EQUAL="return float(a >= b);",exports.LOGICAL_AND="return float(a >= 1.0 && b >= 1.0);",exports.LOGICAL_OR="return float(a >= 1.0 || b >= 1.0);",exports.MAX=CHECK_NAN_SNIPPET+"\n  return max(a, b);\n",exports.MIN=CHECK_NAN_SNIPPET+"\n  return min(a, b);\n",exports.MOD="if (b == 0.0) return NAN;\n  return mod(a, b);",exports.ATAN2=CHECK_NAN_SNIPPET+"\n  return atan(a, b);\n",exports.ELU_DER="return (b >= 1.0) ? a : a * (b + 1.0);",exports.PRELU="return (a < 0.) ? b * a : a;";var BinaryOpProgram=function(){function BinaryOpProgram(op,aShape,bShape){this.variableNames=["A","B"],this.outputShape=broadcast_util.assertAndGetBroadcastShape(aShape,bShape),this.userCode="\n      float binaryOperation(float a, float b) {\n        "+op+"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    "}return BinaryOpProgram}();exports.BinaryOpProgram=BinaryOpProgram},{"../../ops/broadcast_util":176}],76:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var broadcast_util=require("../../ops/broadcast_util"),util_1=require("../../util"),packing_util_1=require("../packing_util"),shader_compiler_1=require("./shader_compiler"),CHECK_NAN_SNIPPET="\n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n";exports.DIV="\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(b.x == 0.0) {\n    result.x = NAN;\n  } else if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(b.y == 0.0) {\n    result.y = NAN;\n  } else if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(b.z == 0.0) {\n    result.z = NAN;\n  } else if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(b.w == 0.0) {\n    result.w = NAN;\n  } else if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n",exports.INT_DIV="\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n",exports.POW="\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));\n  "+CHECK_NAN_SNIPPET+"\n  return result;\n",exports.PRELU="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n",exports.ELU_DER="\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",exports.ATAN2="\n  vec4 result = atan(a, b);\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  "+CHECK_NAN_SNIPPET+"\n  return result;\n",exports.EQUAL="\n  return vec4(equal(a, b));\n",exports.NOT_EQUAL="\n  return vec4(notEqual(a, b));\n",exports.LESS="\n  return vec4(lessThan(a, b));\n",exports.LESS_EQUAL="\n  return vec4(lessThanEqual(a, b));\n",exports.GREATER="\n  return vec4(greaterThan(a, b));\n",exports.GREATER_EQUAL="\n  return vec4(greaterThanEqual(a, b));\n",exports.LOGICAL_AND="\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n",exports.LOGICAL_OR="\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n",exports.MAX="\n  vec4 result = vec4(max(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  "+CHECK_NAN_SNIPPET+"\n  return result;\n",exports.MIN="\n  vec4 result = vec4(min(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  "+CHECK_NAN_SNIPPET+"\n  return result;\n",exports.MOD="\n  vec4 result = mod(a, b);\n  vec4 isNaN = vec4(equal(b, vec4(0.0)));\n  "+CHECK_NAN_SNIPPET+"\n  return result;\n";var BinaryOpPackedProgram=function(){function BinaryOpPackedProgram(op,aShape,bShape,checkOutOfBounds){void 0===checkOutOfBounds&&(checkOutOfBounds=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.usesPackedTextures=!0,this.outputShape=broadcast_util.assertAndGetBroadcastShape(aShape,bShape);var rank=this.outputShape.length,checkOutOfBoundsString="",dtype;if(checkOutOfBounds)if(0===rank||1===util_1.sizeFromShape(this.outputShape))checkOutOfBoundsString="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else if(checkOutOfBoundsString="\n          "+shader_compiler_1.getCoordsDataType(rank)+" coords = getOutputCoords();\n        ",1===rank)checkOutOfBoundsString+="\n            result.y = (coords + 1) >= "+this.outputShape[0]+" ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ";else{var channels=packing_util_1.getChannels("coords",rank);checkOutOfBoundsString+="\n            bool nextRowOutOfBounds =\n              ("+channels[rank-2]+" + 1) >= "+this.outputShape[rank-2]+";\n            bool nextColOutOfBounds =\n              ("+channels[rank-1]+" + 1) >= "+this.outputShape[rank-1]+";\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          "}this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        "+op+"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        "+checkOutOfBoundsString+"\n\n        setOutput(result);\n      }\n    "}return BinaryOpPackedProgram}();exports.BinaryOpPackedProgram=BinaryOpPackedProgram},{"../../ops/broadcast_util":176,"../../util":248,"../packing_util":62,"./shader_compiler":133}],77:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var contexts={},WEBGL_ATTRIBUTES={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function setWebGLContext(webGLVersion,gl){contexts[webGLVersion]=gl}function getWebGLContext(webGLVersion){webGLVersion in contexts||(contexts[webGLVersion]=getWebGLRenderingContext(webGLVersion));var gl=contexts[webGLVersion];return gl.isContextLost()?(delete contexts[webGLVersion],getWebGLContext(webGLVersion)):(gl.disable(gl.DEPTH_TEST),gl.disable(gl.STENCIL_TEST),gl.disable(gl.BLEND),gl.disable(gl.DITHER),gl.disable(gl.POLYGON_OFFSET_FILL),gl.disable(gl.SAMPLE_COVERAGE),gl.enable(gl.SCISSOR_TEST),gl.enable(gl.CULL_FACE),gl.cullFace(gl.BACK),contexts[webGLVersion])}function createCanvas(webGLVersion){if("undefined"!=typeof OffscreenCanvas&&2===webGLVersion)return new OffscreenCanvas(300,150);if("undefined"!=typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function getWebGLRenderingContext(webGLVersion){if(1!==webGLVersion&&2!==webGLVersion)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var canvas=createCanvas(webGLVersion);return canvas.addEventListener("webglcontextlost",(function(ev){ev.preventDefault(),delete contexts[webGLVersion]}),!1),1===webGLVersion?canvas.getContext("webgl",WEBGL_ATTRIBUTES)||canvas.getContext("experimental-webgl",WEBGL_ATTRIBUTES):canvas.getContext("webgl2",WEBGL_ATTRIBUTES)}exports.setWebGLContext=setWebGLContext,exports.getWebGLContext=getWebGLContext,exports.createCanvas=createCanvas},{}],78:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2017 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var ClipProgram=function(){function ClipProgram(aShape){this.variableNames=["A"],this.outputShape=aShape,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}return ClipProgram.prototype.getCustomSetupFunc=function(min,max){var _this=this;return function(gpgpu,webGLProgram){null==_this.minLoc&&(_this.minLoc=gpgpu.getUniformLocationNoThrow(webGLProgram,"minVal"),_this.maxLoc=gpgpu.getUniformLocationNoThrow(webGLProgram,"maxVal")),gpgpu.gl.uniform1f(_this.minLoc,min),gpgpu.gl.uniform1f(_this.maxLoc,max)}},ClipProgram}();exports.ClipProgram=ClipProgram},{}],79:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var ClipPackedProgram=function(){function ClipPackedProgram(aShape){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=aShape,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}return ClipPackedProgram.prototype.getCustomSetupFunc=function(min,max){var _this=this;return function(gpgpu,webGLProgram){null==_this.minLoc&&(_this.minLoc=gpgpu.getUniformLocationNoThrow(webGLProgram,"minVal"),_this.maxLoc=gpgpu.getUniformLocationNoThrow(webGLProgram,"maxVal")),gpgpu.gl.uniform1f(_this.minLoc,min),gpgpu.gl.uniform1f(_this.maxLoc,max)}},ClipPackedProgram}();exports.ClipPackedProgram=ClipPackedProgram},{}],80:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var ComplexAbsProgram=function(){function ComplexAbsProgram(shape){this.variableNames=["real","imag"],this.outputShape=shape,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "}return ComplexAbsProgram}();exports.ComplexAbsProgram=ComplexAbsProgram},{}],81:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2017 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var concat_util=require("../../ops/concat_util"),ConcatProgram=function(){function ConcatProgram(shapes){this.outputShape=[],this.outputShape=concat_util.computeOutShape(shapes,1),this.variableNames=shapes.map((function(_,i){return"T"+i}));var offsets=new Array(shapes.length-1);offsets[0]=shapes[0][1];for(var i=1;i<offsets.length;i++)offsets[i]=offsets[i-1]+shapes[i][1];for(var snippets=["if (yC < "+offsets[0]+") setOutput(getT0(yR, yC));"],i=1;i<offsets.length;i++){var shift=offsets[i-1];snippets.push("else if (yC < "+offsets[i]+") setOutput(getT"+i+"(yR, yC-"+shift+"));")}var lastIndex=offsets.length,lastShift=offsets[offsets.length-1];snippets.push("else setOutput(getT"+lastIndex+"(yR, yC-"+lastShift+"));"),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        "+snippets.join("\n        ")+"\n      }\n    "}return ConcatProgram}();exports.ConcatProgram=ConcatProgram},{"../../ops/concat_util":181}],82:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2019 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var concat_util=require("../../ops/concat_util"),packing_util_1=require("../packing_util"),shader_compiler_1=require("./shader_compiler"),ConcatPackedProgram=function(){function ConcatPackedProgram(shapes,axis){this.usesPackedTextures=!0,this.outputShape=[],this.outputShape=concat_util.computeOutShape(shapes,axis);var shape=this.outputShape,rank=shape.length,dtype=shader_compiler_1.getCoordsDataType(rank),coords=packing_util_1.getChannels("coords",rank),channels=["x","y","z","w","u","v"].slice(0,rank);this.variableNames=shapes.map((function(_,i){return"T"+i}));var offsets=new Array(shapes.length-1);offsets[0]=shapes[0][axis];for(var i=1;i<offsets.length;i++)offsets[i]=offsets[i-1]+shapes[i][axis];for(var channel=channels[axis],lastChannels="vec2("+channels.slice(-2).join()+")",allChannels=channels.join(),getValueSnippet="if ("+channel+" < "+offsets[0]+")\n          return getChannel(getT0("+allChannels+"), "+lastChannels+");",i=1;i<offsets.length;i++){var shift_1=offsets[i-1];getValueSnippet+="\n        else if ("+channel+" < "+offsets[i]+") {\n          "+channel+" -= "+shift_1+";\n          return getChannel(getT"+i+"("+allChannels+"), "+lastChannels+");\n        }"}var lastIndex=offsets.length,shift;getValueSnippet+="\n        else {\n          "+channel+" -= "+offsets[offsets.length-1]+";\n          return getChannel(getT"+lastIndex+"("+allChannels+"), "+lastChannels+");\n        }",this.userCode="\n      float getValue("+channels.map((function(x){return"int "+x}))+") {\n        "+getValueSnippet+"\n      }\n\n      void main() {\n        "+dtype+" coords = getOutputCoords();\n        vec4 result = vec4(getValue("+coords+"), 0., 0., 0.);\n        if (++"+coords[rank-1]+" < "+shape[rank-1]+") {\n          result.g = getValue("+coords+");\n        }\n        if (++"+coords[rank-2]+" < "+shape[rank-2]+") {\n          result.a = getValue("+coords+");\n        }\n        if ("+coords[rank-2]+" < "+shape[rank-2]+" &&\n            --"+coords[rank-1]+" < "+shape[rank-1]+") {\n          result.b = getValue("+coords+");\n        }\n        setOutput(result);\n      }\n    "}return ConcatPackedProgram}();exports.ConcatPackedProgram=ConcatPackedProgram},{"../../ops/concat_util":181,"../packing_util":62,"./shader_compiler":133}],83:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2017 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var Conv2DDerFilterProgram=function(){function Conv2DDerFilterProgram(convInfo){this.variableNames=["x","dy"],this.outputShape=convInfo.filterShape;var strideHeight=convInfo.strideHeight,strideWidth=convInfo.strideWidth,padTop=convInfo.padInfo.top,padLeft=convInfo.padInfo.left,isChannelsLast="channelsLast"===convInfo.dataFormat;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+convInfo.batchSize+"; b++) {\n          for (int yR = 0; yR < "+convInfo.outHeight+"; yR++) {\n            int xR = wR + yR * "+strideHeight+" - "+padTop+";\n\n            if (xR < 0 || xR >= "+convInfo.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+convInfo.outWidth+"; yC++) {\n              int xC = wC + yC * "+strideWidth+" - "+padLeft+";\n\n              if (xC < 0 || xC >= "+convInfo.inWidth+") {\n                continue;\n              }\n\n              if ("+isChannelsLast+") {\n                float dyValue = getDy(b, yR, yC, d2);\n                float xValue = getX(b, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              } else {\n                float dyValue = getDy(b, d2, yR, yC);\n                float xValue = getX(b, d1, xR, xC);\n                dotProd += (xValue * dyValue);\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}return Conv2DDerFilterProgram}();exports.Conv2DDerFilterProgram=Conv2DDerFilterProgram;var Conv2DDerInputProgram=function(){function Conv2DDerInputProgram(convInfo){this.variableNames=["dy","W"],this.outputShape=convInfo.inShape;var filterHeight=convInfo.filterHeight,filterWidth=convInfo.filterWidth,strideHeight=convInfo.strideHeight,strideWidth=convInfo.strideWidth,isChannelsLast="channelsLast"===convInfo.dataFormat,padTop=filterHeight-1-convInfo.padInfo.top,padLeft=filterWidth-1-convInfo.padInfo.left,rowDim=isChannelsLast?1:2,colDim=isChannelsLast?2:3,channelDim=isChannelsLast?3:1;this.userCode="\n      const ivec2 pads = ivec2("+padTop+", "+padLeft+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords["+channelDim+"];\n\n        ivec2 dyCorner = ivec2(coords["+rowDim+"], coords["+colDim+"]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+filterHeight+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+convInfo.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+filterHeight+" - 1 - wR;\n\n          for (int wC = 0; wC < "+filterWidth+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+convInfo.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+filterWidth+" - 1 - wC;\n\n            for (int d2 = 0; d2 < "+convInfo.outChannels+"; d2++) {\n\n              if ("+isChannelsLast+") {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}return Conv2DDerInputProgram}();exports.Conv2DDerInputProgram=Conv2DDerInputProgram;var Conv3DDerFilterProgram=function(){function Conv3DDerFilterProgram(convInfo){this.variableNames=["x","dy"],this.outputShape=convInfo.filterShape;var strideDepth=convInfo.strideDepth,strideHeight=convInfo.strideHeight,strideWidth=convInfo.strideWidth,padFront=convInfo.padInfo.front,padTop=convInfo.padInfo.top,padLeft=convInfo.padInfo.left;this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+convInfo.batchSize+"; b++) {\n          for (int yF = 0; yF < "+convInfo.outDepth+"; yF++) {\n            int xF = wF + yF * "+strideDepth+" - "+padFront+";\n\n            if (xF < 0 || xF >= "+convInfo.inDepth+") {\n              continue;\n            }\n\n            for (int yR = 0; yR < "+convInfo.outHeight+"; yR++) {\n              int xR = wR + yR * "+strideHeight+" - "+padTop+";\n\n              if (xR < 0 || xR >= "+convInfo.inHeight+") {\n                continue;\n              }\n\n              for (int yC = 0; yC < "+convInfo.outWidth+"; yC++) {\n                int xC = wC + yC * "+strideWidth+" - "+padLeft+";\n\n                if (xC < 0 || xC >= "+convInfo.inWidth+") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}return Conv3DDerFilterProgram}();exports.Conv3DDerFilterProgram=Conv3DDerFilterProgram;var Conv3DDerInputProgram=function(){function Conv3DDerInputProgram(convInfo){this.variableNames=["dy","W"],this.outputShape=convInfo.inShape;var filterDepth=convInfo.filterDepth,filterHeight=convInfo.filterHeight,filterWidth=convInfo.filterWidth,strideDepth=convInfo.strideDepth,strideHeight=convInfo.strideHeight,strideWidth=convInfo.strideWidth,padFront=filterDepth-1-convInfo.padInfo.front,padTop=filterHeight-1-convInfo.padInfo.top,padLeft=filterWidth-1-convInfo.padInfo.left;this.userCode="\n      const ivec3 pads = ivec3("+padFront+", "+padTop+", "+padLeft+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+filterDepth+"; wF++) {\n          float dyF = float(dyFCorner + wF) / "+strideDepth+".0;\n\n          if (dyF < 0.0 || dyF >= "+convInfo.outDepth+".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = "+filterDepth+" - 1 - wF;\n\n          for (int wR = 0; wR < "+filterHeight+"; wR++) {\n            float dyR = float(dyRCorner + wR) / "+strideHeight+".0;\n\n            if (dyR < 0.0 || dyR >= "+convInfo.outHeight+".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = "+filterHeight+" - 1 - wR;\n\n            for (int wC = 0; wC < "+filterWidth+"; wC++) {\n              float dyC = float(dyCCorner + wC) / "+strideWidth+".0;\n\n              if (dyC < 0.0 || dyC >= "+convInfo.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = "+filterWidth+" - 1 - wC;\n\n              for (int d2 = 0; d2 < "+convInfo.outChannels+"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}return Conv3DDerInputProgram}();exports.Conv3DDerInputProgram=Conv3DDerInputProgram},{}],84:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var DepthwiseConv2DDerFilterProgram=function(){function DepthwiseConv2DDerFilterProgram(convInfo){this.variableNames=["x","dy"],this.outputShape=convInfo.filterShape;var strideHeight=convInfo.strideHeight,strideWidth=convInfo.strideWidth,padTop=convInfo.padInfo.top,padLeft=convInfo.padInfo.left,channelMul=convInfo.outChannels/convInfo.inChannels;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * "+channelMul+" + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < "+convInfo.batchSize+"; b++) {\n          for (int yR = 0; yR < "+convInfo.outHeight+"; yR++) {\n            int xR = wR + yR * "+strideHeight+" - "+padTop+";\n\n            if (xR < 0 || xR >= "+convInfo.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+convInfo.outWidth+"; yC++) {\n              int xC = wC + yC * "+strideWidth+" - "+padLeft+";\n\n              if (xC < 0 || xC >= "+convInfo.inWidth+") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}return DepthwiseConv2DDerFilterProgram}();exports.DepthwiseConv2DDerFilterProgram=DepthwiseConv2DDerFilterProgram;var DepthwiseConv2DDerInputProgram=function(){function DepthwiseConv2DDerInputProgram(convInfo){this.variableNames=["dy","W"],this.outputShape=convInfo.inShape;var filterHeight=convInfo.filterHeight,filterWidth=convInfo.filterWidth,strideHeight=convInfo.strideHeight,strideWidth=convInfo.strideWidth,padTop=filterHeight-1-convInfo.padInfo.top,padLeft=filterWidth-1-convInfo.padInfo.left,channelMul=convInfo.outChannels/convInfo.inChannels;this.userCode="\n      const ivec2 pads = ivec2("+padTop+", "+padLeft+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < "+filterHeight+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+convInfo.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+filterHeight+" - 1 - wR;\n\n          for (int wC = 0; wC < "+filterWidth+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+convInfo.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+filterWidth+" - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < "+channelMul+"; dm++) {\n              int d2 = d1 * "+channelMul+" + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}return DepthwiseConv2DDerInputProgram}();exports.DepthwiseConv2DDerInputProgram=DepthwiseConv2DDerInputProgram},{}],85:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2017 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var Conv2DProgram=function(){function Conv2DProgram(convInfo,addBias,activation,hasPreluActivationWeights){void 0===addBias&&(addBias=!1),void 0===activation&&(activation=null),void 0===hasPreluActivationWeights&&(hasPreluActivationWeights=!1),this.variableNames=["x","W"],this.outputShape=convInfo.outShape;var padTop=convInfo.padInfo.top,padLeft=convInfo.padInfo.left,strideHeight=convInfo.strideHeight,strideWidth=convInfo.strideWidth,dilationHeight=convInfo.dilationHeight,dilationWidth=convInfo.dilationWidth,filterHeight=convInfo.filterHeight,filterWidth=convInfo.filterWidth,inputDepthNearestVec4=4*Math.floor(convInfo.inChannels/4),inputDepthVec4Remainder=convInfo.inChannels%4,isChannelsLast="channelsLast"===convInfo.dataFormat,rowDim=isChannelsLast?1:2,colDim=isChannelsLast?2:3,channelDim=isChannelsLast?3:1,activationSnippet="",applyActivationSnippet="";activation&&(activationSnippet=hasPreluActivationWeights?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+activation+"\n        }":"\n          float activation(float x) {\n            "+activation+"\n          }\n        ",applyActivationSnippet="result = activation(result);");var addBiasSnippet=addBias?"result += getBiasAtOutCoords();":"";addBias&&this.variableNames.push("bias"),hasPreluActivationWeights&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+activationSnippet+"\n\n      const ivec2 strides = ivec2("+strideHeight+", "+strideWidth+");\n      const ivec2 pads = ivec2("+padTop+", "+padLeft+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords["+channelDim+"];\n\n        ivec2 xRCCorner =\n            ivec2(coords["+rowDim+"], coords["+colDim+"]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+filterHeight+"; wR++) {\n          int xR = xRCorner + wR * "+dilationHeight+";\n\n          if (xR < 0 || xR >= "+convInfo.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+filterWidth+"; wC++) {\n            int xC = xCCorner + wC * "+dilationWidth+";\n\n            if (xC < 0 || xC >= "+convInfo.inWidth+") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < "+inputDepthNearestVec4+"; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if ("+isChannelsLast+") {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if ("+(1===inputDepthVec4Remainder)+") {\n\n              if ("+isChannelsLast+") {\n                dotProd +=\n                    getX(batch, xR, xC, "+inputDepthNearestVec4+") *\n                    getW(wR, wC, "+inputDepthNearestVec4+", d2);\n              } else {\n                dotProd +=\n                    getX(batch, "+inputDepthNearestVec4+", xR, xC) *\n                    getW(wR, wC, "+inputDepthNearestVec4+", d2);\n              }\n\n            } else if ("+(2===inputDepthVec4Remainder)+") {\n              vec2 wValues = vec2(\n                getW(wR, wC, "+inputDepthNearestVec4+", d2),\n                getW(wR, wC, "+inputDepthNearestVec4+" + 1, d2)\n              );\n\n              if ("+isChannelsLast+") {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, "+inputDepthNearestVec4+"),\n                  getX(batch, xR, xC, "+inputDepthNearestVec4+" + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, "+inputDepthNearestVec4+", xR, xC),\n                  getX(batch, "+inputDepthNearestVec4+" + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if ("+(3===inputDepthVec4Remainder)+") {\n              vec3 wValues = vec3(\n                getW(wR, wC, "+inputDepthNearestVec4+", d2),\n                getW(wR, wC, "+inputDepthNearestVec4+" + 1, d2),\n                getW(wR, wC, "+inputDepthNearestVec4+" + 2, d2)\n              );\n\n              if ("+isChannelsLast+") {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, "+inputDepthNearestVec4+"),\n                  getX(batch, xR, xC, "+inputDepthNearestVec4+" + 1),\n                  getX(batch, xR, xC, "+inputDepthNearestVec4+" + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, "+inputDepthNearestVec4+", xR, xC),\n                  getX(batch, "+inputDepthNearestVec4+" + 1, xR, xC),\n                  getX(batch, "+inputDepthNearestVec4+" + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        "+addBiasSnippet+"\n        "+applyActivationSnippet+"\n        setOutput(result);\n      }\n    "}return Conv2DProgram}();exports.Conv2DProgram=Conv2DProgram;var Conv3DProgram=function(){function Conv3DProgram(convInfo){this.variableNames=["x","W"],this.outputShape=convInfo.outShape;var padFront=convInfo.padInfo.front,padTop=convInfo.padInfo.top,padLeft=convInfo.padInfo.left,strideDepth=convInfo.strideDepth,strideHeight=convInfo.strideHeight,strideWidth=convInfo.strideWidth,dilationDepth=convInfo.dilationDepth,dilationHeight=convInfo.dilationHeight,dilationWidth=convInfo.dilationWidth,filterDepth=convInfo.filterDepth,filterHeight=convInfo.filterHeight,filterWidth=convInfo.filterWidth,inputDepthNearestVec4=4*Math.floor(convInfo.inChannels/4),inputDepthVec4Remainder=convInfo.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3("+strideDepth+", "+strideHeight+", "+strideWidth+");\n      const ivec3 pads = ivec3("+padFront+", "+padTop+", "+padLeft+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+filterDepth+"; wF++) {\n          int xF = xFCorner + wF * "+dilationDepth+";\n\n          if (xF < 0 || xF >= "+convInfo.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+filterHeight+"; wR++) {\n            int xR = xRCorner + wR * "+dilationHeight+";\n\n            if (xR < 0 || xR >= "+convInfo.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+filterWidth+"; wC++) {\n              int xC = xCCorner + wC * "+dilationWidth+";\n\n              if (xC < 0 || xC >= "+convInfo.inWidth+") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < "+inputDepthNearestVec4+"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if ("+(1===inputDepthVec4Remainder)+") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, "+inputDepthNearestVec4+") *\n                  getW(wF, wR, wC, "+inputDepthNearestVec4+", d2);\n              } else if ("+(2===inputDepthVec4Remainder)+") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, "+inputDepthNearestVec4+"),\n                  getX(batch, xF, xR, xC, "+inputDepthNearestVec4+" + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, "+inputDepthNearestVec4+", d2),\n                  getW(wF, wR, wC, "+inputDepthNearestVec4+" + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if ("+(3===inputDepthVec4Remainder)+") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, "+inputDepthNearestVec4+"),\n                  getX(batch, xF, xR, xC, "+inputDepthNearestVec4+" + 1),\n                  getX(batch, xF, xR, xC, "+inputDepthNearestVec4+" + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, "+inputDepthNearestVec4+", d2),\n                  getW(wF, wR, wC, "+inputDepthNearestVec4+" + 1, d2),\n                  getW(wF, wR, wC, "+inputDepthNearestVec4+" + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}return Conv3DProgram}();exports.Conv3DProgram=Conv3DProgram},{}],86:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2017 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var DepthwiseConv2DProgram=function(){function DepthwiseConv2DProgram(convInfo){this.variableNames=["x","W"],this.outputShape=convInfo.outShape;var xNumRows=convInfo.inHeight,xNumCols=convInfo.inWidth,padTop=convInfo.padInfo.top,padLeft=convInfo.padInfo.left,strideHeight=convInfo.strideHeight,strideWidth=convInfo.strideWidth,dilationHeight=convInfo.dilationHeight,dilationWidth=convInfo.dilationWidth,filterHeight=convInfo.filterHeight,filterWidth=convInfo.filterWidth,channelMul=convInfo.outChannels/convInfo.inChannels;this.userCode="\n      const ivec2 strides = ivec2("+strideHeight+", "+strideWidth+");\n      const ivec2 pads = ivec2("+padTop+", "+padLeft+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / "+channelMul+";\n        int q = d2 - d1 * "+channelMul+";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < "+filterHeight+"; wR++) {\n          int xR = xRCorner + wR * "+dilationHeight+";\n\n          if (xR < 0 || xR >= "+xNumRows+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+filterWidth+"; wC++) {\n            int xC = xCCorner + wC * "+dilationWidth+";\n\n            if (xC < 0 || xC >= "+xNumCols+") {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}return DepthwiseConv2DProgram}();exports.DepthwiseConv2DProgram=DepthwiseConv2DProgram},{}],87:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var util=require("../../util"),DepthwiseConvPacked2DProgram=function(){function DepthwiseConvPacked2DProgram(convInfo){this.variableNames=["x","W"],this.usesPackedTextures=!0,this.outputShape=convInfo.outShape;for(var xNumRows=convInfo.inHeight,xNumCols=convInfo.inWidth,padTop=convInfo.padInfo.top,padLeft=convInfo.padInfo.left,strideHeight=convInfo.strideHeight,strideWidth=convInfo.strideWidth,dilationHeight=convInfo.dilationHeight,dilationWidth=convInfo.dilationWidth,filterHeight=convInfo.filterHeight,filterWidth=convInfo.filterWidth,texelsAcross=filterWidth,mainLoop="int xR; int xC; int xCOffset;",r=0;r<filterHeight;r++)for(var c=0;c<filterWidth;c++)mainLoop+="\n          vec4 xTexelR"+r+"C"+2*c+" = vec4(0.);\n          vec4 wR"+r+"C"+c+" = vec4(0.);\n          vec4 xR"+r+"C"+c+" = vec4(0.);";for(var r=0;r<filterHeight;r++)for(var texelC=0;texelC<texelsAcross;texelC++){var c;if(mainLoop+="\n          xR = xRCorner + "+r*dilationHeight+";\n          xC = xCCorner + "+(c=2*texelC)*dilationWidth+";\n        ",1===strideWidth){if(c<filterWidth&&(mainLoop+=padLeft%2==1?"\n                xCOffset = xC + 1;\n                if(xR >= 0 && xR < "+xNumRows+" && xCOffset >= 0 && xCOffset < "+xNumCols+") {\n                  xTexelR"+r+"C"+c+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+r+"C"+c+" = vec4(0.);\n                }\n\n                xCOffset = xC + 1 - 2;\n                if(xR >= 0 && xR < "+xNumRows+" && xCOffset >= 0 && xCOffset < "+xNumCols+") {\n                  vec4 previous = getX(batch, xR, xCOffset, d1);\n                  xR"+r+"C"+c+" = vec4(previous.zw, xTexelR"+r+"C"+c+".xy);\n                } else {\n                  xR"+r+"C"+c+" = vec4(0, 0, xTexelR"+r+"C"+c+".xy);\n                }\n              ":"\n                if(xR >= 0 && xR < "+xNumRows+" && xC >= 0 && xC < "+xNumCols+") {\n                  xTexelR"+r+"C"+c+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+r+"C"+c+" = vec4(0.);\n                }\n\n                xR"+r+"C"+c+" = xTexelR"+r+"C"+c+";\n              ",c+1<filterWidth)){var nextTexelOffset=padLeft%2==0?util.nearestLargerEven(dilationWidth):dilationWidth;dilationWidth%2==0&&padLeft%2==1||dilationWidth%2!=0&&padLeft%2!=1?(mainLoop+="\n                  xCOffset = xC + "+padLeft%2+" + "+nextTexelOffset+";\n\n                  if(xR >= 0 && xR < "+xNumRows+" &&\n                    xCOffset >= 0 && xCOffset < "+xNumCols+") {\n                    xTexelR"+r+"C"+(c+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n                ",dilationWidth>1&&(mainLoop+="\n                    xCOffset -= 2;\n                    if(xR >= 0 && xR < "+xNumRows+" &&\n                      xCOffset >= 0 && xCOffset < "+xNumCols+") {\n                      xTexelR"+r+"C"+c+" = getX(batch, xR, xCOffset, d1);\n                    } else {\n                      xTexelR"+r+"C"+c+" = vec4(0.);\n                    }\n                  "),mainLoop+="\n                  xR"+r+"C"+(c+1)+" = vec4(\n                    xTexelR"+r+"C"+c+".zw, xTexelR"+r+"C"+(c+2)+".xy);\n                "):mainLoop+="\n                  xCOffset = xC + "+nextTexelOffset+";\n\n                  if(xR >= 0 && xR < "+xNumRows+" &&\n                    xCOffset >= 0 && xCOffset < "+xNumCols+") {\n                    xTexelR"+r+"C"+(c+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n\n                  xR"+r+"C"+(c+1)+" = xTexelR"+r+"C"+(c+2)+";\n                "}}else c<filterWidth&&(mainLoop+="\n              if(xR >= 0 && xR < "+xNumRows+") {\n            ",padLeft%2==1?(mainLoop+="\n                xCOffset = xC + 1 - "+strideWidth+";\n                if(xCOffset >= 0 && xCOffset < "+xNumCols+") {\n                  xTexelR"+r+"C"+c+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+r+"C"+c+" = vec4(0.);\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < "+xNumCols+") {\n                  xTexelR"+r+"C"+(c+2)+" = getX(batch, xR, xC + 1, d1);\n                } else {\n                  xTexelR"+r+"C"+(c+2)+" = vec4(0.);\n                }\n\n                xR"+r+"C"+c+" = vec4(\n                  xTexelR"+r+"C"+c+".zw, xTexelR"+r+"C"+(c+2)+".zw);\n              ",c+1<filterWidth&&(mainLoop+="\n                  vec4 final = vec4(0.);\n                  xCOffset = xC + 1 + "+strideWidth+";\n                  if(xCOffset >= 0 && xCOffset < "+xNumCols+") {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xR"+r+"C"+(c+1)+" = vec4(xTexelR"+r+"C"+(c+2)+".xy, final.xy);\n                ")):(mainLoop+="\n                if(xC >= 0 && xC < "+xNumCols+") {\n                  xTexelR"+r+"C"+c+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+r+"C"+c+" = vec4(0.);\n                }\n\n                xCOffset = xC + "+strideWidth+";\n                if(xCOffset >= 0 && xCOffset < "+xNumCols+") {\n                  xTexelR"+r+"C"+(c+2)+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+r+"C"+(c+2)+" = vec4(0.);\n                }\n\n                xR"+r+"C"+c+" = vec4(\n                  xTexelR"+r+"C"+c+".xy, xTexelR"+r+"C"+(c+2)+".xy);\n              ",c+1<filterWidth&&(mainLoop+="\n                  xR"+r+"C"+(c+1)+" = vec4(\n                    xTexelR"+r+"C"+c+".zw, xTexelR"+r+"C"+(c+2)+".zw);\n                ")),mainLoop+="}");c<filterWidth&&(mainLoop+="\n            vec4 wTexelR"+r+"C"+c+" = getW("+r+", "+c+", d1, q);\n            wR"+r+"C"+c+" = vec4(wTexelR"+r+"C"+c+".xz, wTexelR"+r+"C"+c+".xz);\n          ",c+1<filterWidth&&(mainLoop+="\n              vec4 wTexelR"+r+"C"+(c+1)+" = getW("+r+", "+(c+1)+", d1, q);\n              wR"+r+"C"+(c+1)+" =\n                vec4(wTexelR"+r+"C"+(c+1)+".xz, wTexelR"+r+"C"+(c+1)+".xz);"))}for(var r=0;r<filterHeight;r++)for(var c=0;c<filterWidth;c++)mainLoop+="result += xR"+r+"C"+c+" * wR"+r+"C"+c+";";this.userCode="\n      const ivec2 strides = ivec2("+strideHeight+", "+strideWidth+");\n      const ivec2 pads = ivec2("+padTop+", "+padLeft+");\n\n      void main() {\n\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2;\n        int q = 0;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        vec4 result = vec4(0.);\n\n        "+mainLoop+"\n\n        setOutput(result);\n      }\n    "}return DepthwiseConvPacked2DProgram}();exports.DepthwiseConvPacked2DProgram=DepthwiseConvPacked2DProgram},{"../../util":248}],88:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2017 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var CropAndResizeProgram=function(){function CropAndResizeProgram(imageShape,boxShape,cropSize,method,extrapolationValue){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var batch=imageShape[0],imageHeight=imageShape[1],imageWidth=imageShape[2],depth=imageShape[3],numBoxes=boxShape[0],cropHeight=cropSize[0],cropWidth=cropSize[1];this.outputShape=[numBoxes,cropHeight,cropWidth,depth];var methodId="bilinear"===method?1:0,_a=[imageHeight-1+".0",imageWidth-1+".0"],inputHeightFloat=_a[0],inputWidthFloat=_a[1],_b=cropHeight>1?[""+(imageHeight-1)/(cropHeight-1),"(y2-y1) * height_ratio","y1*"+inputHeightFloat+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+inputHeightFloat],heightRatio=_b[0],heightScale=_b[1],inY=_b[2],_c=cropWidth>1?[""+(imageWidth-1)/(cropWidth-1),"(x2-x1) * width_ratio","x1*"+inputWidthFloat+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+inputWidthFloat],widthRatio=_c[0],widthScale=_c[1],inX=_c[2];this.userCode="\n      const float height_ratio = float("+heightRatio+");\n      const float width_ratio = float("+widthRatio+");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= "+batch+") {\n          return;\n        }\n\n        float height_scale = "+heightScale+";\n        float width_scale = "+widthScale+";\n\n        float in_y = "+inY+";\n        if( in_y < 0.0 || in_y > "+inputHeightFloat+" ) {\n          setOutput(float("+extrapolationValue+"));\n          return;\n        }\n        float in_x = "+inX+";\n        if( in_x < 0.0 || in_x > "+inputWidthFloat+" ) {\n          setOutput(float("+extrapolationValue+"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if("+methodId+" == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    "}return CropAndResizeProgram}();exports.CropAndResizeProgram=CropAndResizeProgram},{}],89:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var shader_compiler_1=require("./shader_compiler"),CumSumProgram=function(){function CumSumProgram(shape,exclusive,reverse){this.variableNames=["x"],this.outputShape=shape;var rank=shape.length,finalDim=shape[shape.length-1],comparator=reverse?"<":">";this.userCode="\n      int getIndex(int i) {\n        "+(reverse?"return "+finalDim+" -i - 1;":"return i;")+"\n      }\n\n      void main() {\n        "+shader_compiler_1.getCoordsDataType(rank)+" coords = getOutputCoords();\n        int end = "+getFinalCoord(rank,"coords")+";\n        float val = 0.0;\n        for (int i = "+finalDim+" - 1; i >= 0; i -= 1) {\n          int idx = getIndex(i);\n          if (idx "+comparator+" end) {\n            continue;\n          }\n          if (idx == end && "+exclusive+") {\n            continue;\n          }\n          "+getFinalCoord(rank,"coords")+" = idx;\n          val += getX("+getCoords(rank,"coords")+");\n        }\n        setOutput(val);\n      }\n    "}return CumSumProgram}();function getCoords(rank,name){if(1===rank)return""+name;if(2===rank)return name+".x, "+name+".y";if(3===rank)return name+".x, "+name+".y, "+name+".z";if(4===rank)return name+".x, "+name+".y, "+name+".z, "+name+".w";throw Error("Cumulative sum for rank "+rank+" is not yet supported")}function getFinalCoord(rank,name){if(1===rank)return""+name;if(2===rank)return name+".y";if(3===rank)return name+".z";if(4===rank)return name+".w";throw Error("Cumulative sum for rank "+rank+" is not yet supported")}exports.CumSumProgram=CumSumProgram},{"./shader_compiler":133}],90:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var glsl_version_1=require("./glsl_version"),shader_util=require("./shader_compiler_util"),DecodeMatrixProgram=function(){function DecodeMatrixProgram(outputShape,texShape){this.variableNames=["A"];var glsl=glsl_version_1.getGlslDifferences();this.outputShape=outputShape,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+shader_util.getLogicalCoordinatesFromFlatIndex(["r","c","d"],outputShape)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+texShape[0]+", "+texShape[1]+"));\n        int index = 4 * (resTexRC.x * "+texShape[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        "+glsl.output+" = result;\n      }\n    "}return DecodeMatrixProgram}();exports.DecodeMatrixProgram=DecodeMatrixProgram},{"./glsl_version":105,"./shader_compiler_util":134}],91:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var glsl_version_1=require("./glsl_version"),shader_util=require("./shader_compiler_util"),DecodeMatrixPackedProgram=function(){function DecodeMatrixPackedProgram(outputShape,texShape){this.variableNames=["A"],this.usesPackedTextures=!0;var glsl=glsl_version_1.getGlslDifferences();this.outputShape=outputShape,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+shader_util.getLogicalCoordinatesFromFlatIndex(["r","c","d"],outputShape)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+texShape[0]+", "+texShape[1]+"));\n        int index = 4 * (resTexRC.x * "+texShape[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        "+glsl.output+" = result;\n      }\n    "}return DecodeMatrixPackedProgram}();exports.DecodeMatrixPackedProgram=DecodeMatrixPackedProgram},{"./glsl_version":105,"./shader_compiler_util":134}],92:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var DepthToSpaceProgram=function(){function DepthToSpaceProgram(outputShape,blockSize,dataFormat){this.variableNames=["x"],this.outputShape=[],this.outputShape=outputShape,this.blockSize=blockSize,this.dataFormat=dataFormat,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = "+this.getHeightCoordString()+";\n      int w = "+this.getWidthCoordString()+";\n      int d = "+this.getDepthCoordString()+";\n\n      int in_h = h / "+blockSize+";\n      int offset_h = imod(h, "+blockSize+");\n      int in_w = w / "+blockSize+";\n      int offset_w = imod(w, "+blockSize+");\n      int offset_d = (offset_h * "+blockSize+" + offset_w) *\n        "+this.getOutputDepthSize()+";\n      int in_d = d + offset_d;\n\n      float result = "+this.getInputSamplingString()+";\n      setOutput(result);\n    }\n  "}return DepthToSpaceProgram.prototype.getHeightCoordString=function(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"},DepthToSpaceProgram.prototype.getWidthCoordString=function(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"},DepthToSpaceProgram.prototype.getDepthCoordString=function(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"},DepthToSpaceProgram.prototype.getOutputDepthSize=function(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]},DepthToSpaceProgram.prototype.getInputSamplingString=function(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},DepthToSpaceProgram}();exports.DepthToSpaceProgram=DepthToSpaceProgram},{}],93:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2019 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var DiagProgram=function(){function DiagProgram(size){this.variableNames=["X"],this.outputShape=[size,size],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "}return DiagProgram}();exports.DiagProgram=DiagProgram},{}],94:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var glsl_version_1=require("./glsl_version"),shader_compiler_util_1=require("./shader_compiler_util"),EncodeFloatProgram=function(){function EncodeFloatProgram(outputShape){this.variableNames=["A"];var glsl=glsl_version_1.getGlslDifferences();this.outputShape=outputShape,this.userCode="\n      "+shader_compiler_util_1.ENCODE_FLOAT_SNIPPET+"\n\n      void main() {\n        float x = getAAtOutCoords();\n        "+glsl.output+" = encode_float(x);\n      }\n    "}return EncodeFloatProgram}();exports.EncodeFloatProgram=EncodeFloatProgram},{"./glsl_version":105,"./shader_compiler_util":134}],95:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var glsl_version_1=require("./glsl_version"),shader_compiler_util_1=require("./shader_compiler_util"),EncodeFloatPackedProgram=function(){function EncodeFloatPackedProgram(outputShape){this.variableNames=["A"],this.usesPackedTextures=!0;var glsl=glsl_version_1.getGlslDifferences();this.outputShape=outputShape,this.userCode="\n      "+shader_compiler_util_1.ENCODE_FLOAT_SNIPPET+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        "+glsl.output+" = encode_float(x);\n      }\n    "}return EncodeFloatPackedProgram}();exports.EncodeFloatPackedProgram=EncodeFloatPackedProgram},{"./glsl_version":105,"./shader_compiler_util":134}],96:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var glsl_version_1=require("./glsl_version"),shader_util=require("./shader_compiler_util"),EncodeMatrixProgram=function(){function EncodeMatrixProgram(outputShape,texShape,inputIsUnsignedByte){void 0===inputIsUnsignedByte&&(inputIsUnsignedByte=!1),this.variableNames=["A"];var glsl=glsl_version_1.getGlslDifferences(),height=texShape[0],width=texShape[1];this.outputShape=outputShape;var output="result";inputIsUnsignedByte&&(output="floor(result * 255. + 0.5)"),this.userCode="\n      "+shader_util.getFlatIndexFrom3D(outputShape)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        int flatIndex = getFlatIndex(coords);\n        int offset = imod(flatIndex, 4);\n\n        flatIndex = idiv(flatIndex, 4, 1.);\n        \n        int r = flatIndex / "+width+";\n        int c = imod(flatIndex, "+width+");\n        vec2 uv = (vec2(c, r) + halfCR) / vec2("+width+".0, "+height+".0);\n        vec4 values = "+glsl.texture2D+"(A, uv);\n\n        float result;\n\n        if(offset == 0) {\n          result = values[0];\n        } else if(offset == 1) {\n          result = values[1];\n        } else if(offset == 2) {\n          result = values[2];\n        } else {\n          result = values[3];\n        }\n\n        "+glsl.output+" = vec4("+output+", 0., 0., 0.);\n      }\n    "}return EncodeMatrixProgram}();exports.EncodeMatrixProgram=EncodeMatrixProgram},{"./glsl_version":105,"./shader_compiler_util":134}],97:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var glsl_version_1=require("./glsl_version"),shader_util=require("./shader_compiler_util"),EncodeMatrixPackedProgram=function(){function EncodeMatrixPackedProgram(outputShape,texShape,inputIsUnsignedByte){void 0===inputIsUnsignedByte&&(inputIsUnsignedByte=!1),this.variableNames=["A"];var glsl=glsl_version_1.getGlslDifferences(),height=texShape[0],width=texShape[1];this.outputShape=outputShape;var mainLoop="",output="result";inputIsUnsignedByte&&(output="floor(result * 255. + 0.5)");for(var row=0;row<=1;row++)for(var col=0;col<=1;col++){var channel=2*row+col;mainLoop+="\n          localCoords = coords;\n          if(localCoords[2] + "+col+" < "+outputShape[2]+") {\n            localCoords[2] += "+col+";\n            if(localCoords[1] + "+row+" < "+outputShape[1]+") {\n              localCoords[1] += "+row+";\n\n              flatIndex = getFlatIndex(localCoords);\n              offset = imod(flatIndex, 4);\n    \n              flatIndex = idiv(flatIndex, 4, 1.);\n\n              r = flatIndex / "+width+";\n              c = imod(flatIndex, "+width+");\n              uv = (vec2(c, r) + halfCR) / vec2("+width+".0, "+height+".0);\n              values = "+glsl.texture2D+"(A, uv);\n\n              if(offset == 0) {\n                result["+channel+"] = values[0];\n              } else if(offset == 1) {\n                result["+channel+"] = values[1];\n              } else if(offset == 2) {\n                result["+channel+"] = values[2];\n              } else {\n                result["+channel+"] = values[3];\n              }\n            }\n          }\n        "}this.userCode="\n      "+shader_util.getFlatIndexFrom3D(outputShape)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        vec4 result = vec4(0.);\n        int flatIndex, r, c, offset;\n        ivec3 localCoords;\n        vec2 uv;\n        vec4 values;\n        \n        "+mainLoop+"\n\n        "+glsl.output+" = "+output+";\n      }\n    "}return EncodeMatrixPackedProgram}();exports.EncodeMatrixPackedProgram=EncodeMatrixPackedProgram},{"./glsl_version":105,"./shader_compiler_util":134}],98:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0}),exports.COMPLEX_FFT={REAL:"return real * expR - imag * expI;",IMAG:"return real * expI + imag * expR;"};var FFTProgram=function(){function FFTProgram(op,inputShape,inverse){this.variableNames=["real","imag"];var innerDim=inputShape[1];this.outputShape=inputShape;var exponentMultiplierSnippet=inverse?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,resultDenominator=inverse?innerDim+".0":"1.0";this.userCode="\n      const float exponentMultiplier = "+exponentMultiplierSnippet+";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        "+op+"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float("+innerDim+");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < "+innerDim+"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / "+resultDenominator+";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    "}return FFTProgram}();exports.FFTProgram=FFTProgram},{}],99:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2019 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var FillProgram=function(){function FillProgram(shape,value){this.outputShape=[],this.variableNames=["x"],this.outputShape=shape,this.userCode="\n      uniform float value;\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}return FillProgram.prototype.getCustomSetupFunc=function(value){var _this=this;return function(gpgpu,webGLProgram){null==_this.valueLoc&&(_this.valueLoc=gpgpu.getUniformLocationNoThrow(webGLProgram,"value")),gpgpu.gl.uniform1f(_this.valueLoc,value)}},FillProgram}();exports.FillProgram=FillProgram},{}],100:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2019 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var device_util=require("../../device_util"),environment_1=require("../../environment"),webgl_util=require("./webgl_util");environment_1.ENV.registerFlag("HAS_WEBGL",(function(){return environment_1.ENV.getNumber("WEBGL_VERSION")>0})),environment_1.ENV.registerFlag("WEBGL_VERSION",(function(){return webgl_util.isWebGLVersionEnabled(2)?2:webgl_util.isWebGLVersionEnabled(1)?1:0})),environment_1.ENV.registerFlag("WEBGL_BUFFER_SUPPORTED",(function(){return 2===environment_1.ENV.get("WEBGL_VERSION")})),environment_1.ENV.registerFlag("WEBGL_CPU_FORWARD",(function(){return!0})),environment_1.ENV.registerFlag("WEBGL_FORCE_F16_TEXTURES",(function(){return!1})),environment_1.ENV.registerFlag("WEBGL_PACK",(function(){return environment_1.ENV.getBool("HAS_WEBGL")})),environment_1.ENV.registerFlag("WEBGL_PACK_NORMALIZATION",(function(){return environment_1.ENV.getBool("WEBGL_PACK")})),environment_1.ENV.registerFlag("WEBGL_PACK_CLIP",(function(){return environment_1.ENV.getBool("WEBGL_PACK")})),environment_1.ENV.registerFlag("WEBGL_PACK_DEPTHWISECONV",(function(){return!1})),environment_1.ENV.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",(function(){return environment_1.ENV.getBool("WEBGL_PACK")})),environment_1.ENV.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",(function(){return environment_1.ENV.getBool("WEBGL_PACK")})),environment_1.ENV.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",(function(){return environment_1.ENV.getBool("WEBGL_PACK")})),environment_1.ENV.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",(function(){return environment_1.ENV.getBool("WEBGL_PACK")})),environment_1.ENV.registerFlag("WEBGL_PACK_REDUCE",(function(){return environment_1.ENV.getBool("WEBGL_PACK")})),environment_1.ENV.registerFlag("WEBGL_LAZILY_UNPACK",(function(){return environment_1.ENV.getBool("WEBGL_PACK")})),environment_1.ENV.registerFlag("WEBGL_CONV_IM2COL",(function(){return environment_1.ENV.getBool("WEBGL_PACK")})),environment_1.ENV.registerFlag("WEBGL_MAX_TEXTURE_SIZE",(function(){return webgl_util.getWebGLMaxTextureSize(environment_1.ENV.getNumber("WEBGL_VERSION"))})),environment_1.ENV.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",(function(){return webgl_util.getMaxTexturesInShader(environment_1.ENV.getNumber("WEBGL_VERSION"))})),environment_1.ENV.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",(function(){var webGLVersion=environment_1.ENV.getNumber("WEBGL_VERSION");return 0===webGLVersion?0:webgl_util.getWebGLDisjointQueryTimerVersion(webGLVersion)})),environment_1.ENV.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",(function(){return environment_1.ENV.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!device_util.isMobile()})),environment_1.ENV.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",(function(){return webgl_util.isCapableOfRenderingToFloatTexture(environment_1.ENV.getNumber("WEBGL_VERSION"))})),environment_1.ENV.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",(function(){return!environment_1.ENV.getBool("WEBGL_FORCE_F16_TEXTURES")&&environment_1.ENV.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")})),environment_1.ENV.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",(function(){return webgl_util.isDownloadFloatTextureEnabled(environment_1.ENV.getNumber("WEBGL_VERSION"))})),environment_1.ENV.registerFlag("WEBGL_FENCE_API_ENABLED",(function(){return webgl_util.isWebGLFenceEnabled(environment_1.ENV.getNumber("WEBGL_VERSION"))})),environment_1.ENV.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",(function(){var useUniforms;return environment_1.ENV.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0}))},{"../../device_util":149,"../../environment":151,"./webgl_util":146}],101:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var glsl_version_1=require("./glsl_version"),FromPixelsProgram=function(){function FromPixelsProgram(outputShape){this.variableNames=["A"];var glsl=glsl_version_1.getGlslDifferences(),height=outputShape[0],width=outputShape[1];this.outputShape=outputShape,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+width+".0, "+height+".0);\n\n        vec4 values = "+glsl.texture2D+"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    "}return FromPixelsProgram}();exports.FromPixelsProgram=FromPixelsProgram},{"./glsl_version":105}],102:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var glsl_version_1=require("./glsl_version"),FromPixelsPackedProgram=function(){function FromPixelsPackedProgram(outputShape){this.variableNames=["A"];var glsl=glsl_version_1.getGlslDifferences(),height=outputShape[0],width=outputShape[1];this.outputShape=outputShape,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+width+".0, "+height+".0);\n            vec4 values = "+glsl.texture2D+"(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        "+glsl.output+" = result;\n      }\n    "}return FromPixelsPackedProgram}();exports.FromPixelsPackedProgram=FromPixelsPackedProgram},{"./glsl_version":105}],103:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2017 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var shader_compiler_1=require("./shader_compiler"),GatherProgram=function(){function GatherProgram(aShape,indicesLength,axis){this.variableNames=["A","indices"];var outputShape=aShape.slice();outputShape[axis]=indicesLength,this.outputShape=outputShape,this.rank=outputShape.length;var dtype=shader_compiler_1.getCoordsDataType(this.rank),sourceCoords=getSourceCoords(aShape,axis);this.userCode="\n      void main() {\n        "+dtype+" resRC = getOutputCoords();\n        setOutput(getA("+sourceCoords+"));\n      }\n    "}return GatherProgram}();function getSourceCoords(aShape,axis){var rank=aShape.length;if(rank>4)throw Error("Gather for rank "+rank+" is not yet supported");if(1===rank)return"int(getIndices(resRC))";for(var currentCoords=["resRC.x","resRC.y","resRC.z","resRC.w"],sourceCoords=[],i=0;i<aShape.length;i++)i===axis?sourceCoords.push("int(getIndices("+currentCoords[i]+"))"):sourceCoords.push(""+currentCoords[i]);return sourceCoords.join()}exports.GatherProgram=GatherProgram},{"./shader_compiler":133}],104:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var shader_compiler_1=require("./shader_compiler"),GatherNDProgram=function(){function GatherNDProgram(sliceDim,strides,shape){this.sliceDim=sliceDim,this.strides=strides,this.variableNames=["x","indices"],this.outputShape=shape;var stridesType=shader_compiler_1.getCoordsDataType(strides.length),dtype=shader_compiler_1.getCoordsDataType(shape.length),strideString=this.sliceDim>1?"strides[j]":"strides";this.userCode="\n        "+stridesType+" strides = "+stridesType+"("+this.strides+");\n         void main() {\n          "+dtype+" coords = getOutputCoords();\n          int flattenIndex = 0;\n          for (int j = 0; j < "+this.sliceDim+"; j++) {\n            int index = round(getIndices(coords[0], j));\n            flattenIndex += index * "+strideString+";\n          }\n          setOutput(getX(flattenIndex, coords[1]));\n        }\n      "}return GatherNDProgram}();exports.GatherNDProgram=GatherNDProgram},{"./shader_compiler":133}],105:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../../environment");function getGlslDifferences(){var version,attribute,varyingVs,varyingFs,texture2D,output,defineOutput,defineSpecialNaN,defineSpecialInf,defineRound;return 2===environment_1.ENV.getNumber("WEBGL_VERSION")?(version="#version 300 es",attribute="in",varyingVs="out",varyingFs="in",texture2D="texture",output="outputColor",defineOutput="out vec4 outputColor;",defineSpecialNaN="\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 0. || val == 0.) ? false : true;\n      }\n    ",defineSpecialInf="",defineRound="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(version="",attribute="attribute",varyingVs="varying",varyingFs="varying",texture2D="texture2D",output="gl_FragColor",defineOutput="",defineSpecialNaN="\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n    ",defineSpecialInf="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",defineRound="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:version,attribute:attribute,varyingVs:varyingVs,varyingFs:varyingFs,texture2D:texture2D,output:output,defineOutput:defineOutput,defineSpecialNaN:defineSpecialNaN,defineSpecialInf:defineSpecialInf,defineRound:defineRound}}exports.getGlslDifferences=getGlslDifferences},{"../../environment":151}],106:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2017 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P((function(resolve){resolve(result.value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},__generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}};Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../../environment"),util=require("../../util"),canvas_util_1=require("./canvas_util"),gpgpu_util=require("./gpgpu_util"),tex_util=require("./tex_util"),webgl_util=require("./webgl_util"),GPGPUContext=function(){function GPGPUContext(gl){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var glVersion=environment_1.ENV.getNumber("WEBGL_VERSION");if(null!=gl?(this.gl=gl,canvas_util_1.setWebGLContext(glVersion,gl)):this.gl=canvas_util_1.getWebGLContext(glVersion),1===environment_1.ENV.getNumber("WEBGL_VERSION"))this.textureFloatExtension=webgl_util.getExtensionOrThrow(this.gl,this.debug,"OES_texture_float"),this.colorBufferFloatExtension=this.gl.getExtension("WEBGL_color_buffer_float"),this.textureHalfFloatExtension=webgl_util.getExtensionOrThrow(this.gl,this.debug,"OES_texture_half_float"),this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float");else{var COLOR_BUFFER_FLOAT="EXT_color_buffer_float",COLOR_BUFFER_HALF_FLOAT="EXT_color_buffer_half_float";if(webgl_util.hasExtension(this.gl,COLOR_BUFFER_FLOAT))this.colorBufferFloatExtension=this.gl.getExtension(COLOR_BUFFER_FLOAT);else{if(!webgl_util.hasExtension(this.gl,COLOR_BUFFER_HALF_FLOAT))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension(COLOR_BUFFER_HALF_FLOAT)}}this.vertexBuffer=gpgpu_util.createVertexBuffer(this.gl,this.debug),this.indexBuffer=gpgpu_util.createIndexBuffer(this.gl,this.debug),this.framebuffer=webgl_util.createFramebuffer(this.gl,this.debug),this.textureConfig=tex_util.getTextureConfig(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(GPGPUContext.prototype,"debug",{get:function(){return environment_1.ENV.getBool("DEBUG")},enumerable:!0,configurable:!0}),GPGPUContext.prototype.dispose=function(){var _this=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var gl=this.gl;webgl_util.callAndCheck(gl,this.debug,(function(){return gl.finish()})),webgl_util.callAndCheck(gl,this.debug,(function(){return gl.bindFramebuffer(gl.FRAMEBUFFER,null)})),webgl_util.callAndCheck(gl,this.debug,(function(){return gl.deleteFramebuffer(_this.framebuffer)})),webgl_util.callAndCheck(gl,this.debug,(function(){return gl.bindBuffer(gl.ARRAY_BUFFER,null)})),webgl_util.callAndCheck(gl,this.debug,(function(){return gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,null)})),webgl_util.callAndCheck(gl,this.debug,(function(){return gl.deleteBuffer(_this.indexBuffer)})),this.disposed=!0}},GPGPUContext.prototype.createFloat32MatrixTexture=function(rows,columns){return this.throwIfDisposed(),gpgpu_util.createFloat32MatrixTexture(this.gl,this.debug,rows,columns,this.textureConfig)},GPGPUContext.prototype.createFloat16MatrixTexture=function(rows,columns){return this.throwIfDisposed(),gpgpu_util.createFloat16MatrixTexture(this.gl,this.debug,rows,columns,this.textureConfig)},GPGPUContext.prototype.createUnsignedBytesMatrixTexture=function(rows,columns){return this.throwIfDisposed(),gpgpu_util.createUnsignedBytesMatrixTexture(this.gl,this.debug,rows,columns,this.textureConfig)},GPGPUContext.prototype.uploadPixelDataToTexture=function(texture,pixels){this.throwIfDisposed(),gpgpu_util.uploadPixelDataToTexture(this.gl,this.debug,texture,pixels)},GPGPUContext.prototype.uploadDenseMatrixToTexture=function(texture,width,height,data){this.throwIfDisposed(),gpgpu_util.uploadDenseMatrixToTexture(this.gl,this.debug,texture,width,height,data,this.textureConfig)},GPGPUContext.prototype.createFloat16PackedMatrixTexture=function(rows,columns){return this.throwIfDisposed(),gpgpu_util.createFloat16PackedMatrixTexture(this.gl,this.debug,rows,columns,this.textureConfig)},GPGPUContext.prototype.createPackedMatrixTexture=function(rows,columns){return this.throwIfDisposed(),gpgpu_util.createPackedMatrixTexture(this.gl,this.debug,rows,columns,this.textureConfig)},GPGPUContext.prototype.deleteMatrixTexture=function(texture){var _this=this;this.throwIfDisposed(),this.outputTexture===texture&&(webgl_util.unbindColorTextureFromFramebuffer(this.gl,this.debug,this.framebuffer),this.outputTexture=null),webgl_util.callAndCheck(this.gl,this.debug,(function(){return _this.gl.deleteTexture(texture)}))},GPGPUContext.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(texture,rows,columns){var _this=this;return this.downloadMatrixDriver(texture,(function(){return gpgpu_util.downloadByteEncodedFloatMatrixFromOutputTexture(_this.gl,_this.debug,rows,columns,_this.textureConfig)}))},GPGPUContext.prototype.downloadPackedMatrixFromBuffer=function(buffer,batch,rows,columns,physicalRows,physicalCols){return gpgpu_util.downloadPackedMatrixFromBuffer(this.gl,buffer,batch,rows,columns,physicalRows,physicalCols,this.textureConfig)},GPGPUContext.prototype.downloadFloat32MatrixFromBuffer=function(buffer,size){return gpgpu_util.downloadFloat32MatrixFromBuffer(this.gl,buffer,size)},GPGPUContext.prototype.createBufferFromTexture=function(texture,rows,columns){this.bindTextureToFrameBuffer(texture);var result=gpgpu_util.createBufferFromOutputTexture(this.gl,this.debug,rows,columns,this.textureConfig);return this.unbindTextureToFrameBuffer(),result},GPGPUContext.prototype.createAndWaitForFence=function(){var fenceContext=this.createFence(this.gl);return this.pollFence(fenceContext)},GPGPUContext.prototype.createFence=function(gl){var _this=this,query,isFencePassed;if(environment_1.ENV.getBool("WEBGL_FENCE_API_ENABLED")){var gl2_1=gl,sync_1=gl2_1.fenceSync(gl2_1.SYNC_GPU_COMMANDS_COMPLETE,0);gl.flush(),isFencePassed=function(){var status=gl2_1.clientWaitSync(sync_1,0,0);return status===gl2_1.ALREADY_SIGNALED||status===gl2_1.CONDITION_SATISFIED},query=sync_1}else environment_1.ENV.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(query=this.beginQuery(),this.endQuery(),isFencePassed=function(){return _this.isQueryAvailable(query,environment_1.ENV.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):isFencePassed=function(){return!0};return{query:query,isFencePassed:isFencePassed}},GPGPUContext.prototype.downloadMatrixFromPackedTexture=function(texture,physicalRows,physicalCols){var _this=this;return this.downloadMatrixDriver(texture,(function(){return gpgpu_util.downloadMatrixFromPackedOutputTexture(_this.gl,_this.debug,physicalRows,physicalCols)}))},GPGPUContext.prototype.createProgram=function(fragmentShaderSource){this.throwIfDisposed();var gl=this.gl,fragmentShader=webgl_util.createFragmentShader(gl,this.debug,fragmentShaderSource),vertexShader=gpgpu_util.createVertexShader(gl,this.debug),program=webgl_util.createProgram(gl,this.debug);return webgl_util.callAndCheck(gl,this.debug,(function(){return gl.attachShader(program,vertexShader)})),webgl_util.callAndCheck(gl,this.debug,(function(){return gl.attachShader(program,fragmentShader)})),webgl_util.linkProgram(gl,this.debug,program),this.debug&&webgl_util.validateProgram(gl,this.debug,program),this.vertexAttrsAreBound||(this.setProgram(program),this.vertexAttrsAreBound=gpgpu_util.bindVertexProgramAttributeStreams(gl,this.debug,this.program,this.vertexBuffer)),program},GPGPUContext.prototype.deleteProgram=function(program){var _this=this;this.throwIfDisposed(),program===this.program&&(this.program=null),null!=program&&webgl_util.callAndCheck(this.gl,this.debug,(function(){return _this.gl.deleteProgram(program)}))},GPGPUContext.prototype.setProgram=function(program){var _this=this;this.throwIfDisposed(),this.program=program,null!=this.program&&this.debug&&webgl_util.validateProgram(this.gl,this.debug,this.program),webgl_util.callAndCheck(this.gl,this.debug,(function(){return _this.gl.useProgram(program)}))},GPGPUContext.prototype.getUniformLocation=function(program,uniformName,shouldThrow){return void 0===shouldThrow&&(shouldThrow=!0),this.throwIfDisposed(),shouldThrow?webgl_util.getProgramUniformLocationOrThrow(this.gl,this.debug,program,uniformName):webgl_util.getProgramUniformLocation(this.gl,program,uniformName)},GPGPUContext.prototype.getAttributeLocation=function(program,attribute){var _this=this;return this.throwIfDisposed(),webgl_util.callAndCheck(this.gl,this.debug,(function(){return _this.gl.getAttribLocation(program,attribute)}))},GPGPUContext.prototype.getUniformLocationNoThrow=function(program,uniformName){return this.throwIfDisposed(),this.gl.getUniformLocation(program,uniformName)},GPGPUContext.prototype.setInputMatrixTexture=function(inputMatrixTexture,uniformLocation,textureUnit){this.throwIfDisposed(),this.throwIfNoProgram(),webgl_util.bindTextureToProgramUniformSampler(this.gl,this.debug,this.program,inputMatrixTexture,uniformLocation,textureUnit)},GPGPUContext.prototype.setOutputMatrixTexture=function(outputMatrixTexture,rows,columns){this.setOutputMatrixTextureDriver(outputMatrixTexture,columns,rows)},GPGPUContext.prototype.setOutputPackedMatrixTexture=function(outputPackedMatrixTexture,rows,columns){this.throwIfDisposed();var _a=tex_util.getPackedMatrixTextureShapeWidthHeight(rows,columns),width=_a[0],height=_a[1];this.setOutputMatrixTextureDriver(outputPackedMatrixTexture,width,height)},GPGPUContext.prototype.setOutputMatrixWriteRegion=function(startRow,numRows,startColumn,numColumns){this.setOutputMatrixWriteRegionDriver(startColumn,startRow,numColumns,numRows)},GPGPUContext.prototype.setOutputPackedMatrixWriteRegion=function(startRow,numRows,startColumn,numColumns){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},GPGPUContext.prototype.debugValidate=function(){null!=this.program&&webgl_util.validateProgram(this.gl,this.debug,this.program),webgl_util.validateFramebuffer(this.gl)},GPGPUContext.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var gl=this.gl;this.debug&&this.debugValidate(),webgl_util.callAndCheck(gl,this.debug,(function(){return gl.drawElements(gl.TRIANGLES,6,gl.UNSIGNED_SHORT,0)}))},GPGPUContext.prototype.blockUntilAllProgramsCompleted=function(){var _this=this;this.throwIfDisposed(),webgl_util.callAndCheck(this.gl,this.debug,(function(){return _this.gl.finish()}))},GPGPUContext.prototype.getQueryTimerExtension=function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=webgl_util.getExtensionOrThrow(this.gl,this.debug,2===environment_1.ENV.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},GPGPUContext.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},GPGPUContext.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},GPGPUContext.prototype.beginQuery=function(){if(2===environment_1.ENV.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var gl2=this.gl,ext_1=this.getQueryTimerExtensionWebGL2(),query_1=gl2.createQuery();return gl2.beginQuery(ext_1.TIME_ELAPSED_EXT,query_1),query_1}var ext=this.getQueryTimerExtensionWebGL1(),query=ext.createQueryEXT();return ext.beginQueryEXT(ext.TIME_ELAPSED_EXT,query),query},GPGPUContext.prototype.endQuery=function(){if(2!==environment_1.ENV.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var ext=this.getQueryTimerExtensionWebGL1();ext.endQueryEXT(ext.TIME_ELAPSED_EXT)}else{var gl2=this.gl,ext_2=this.getQueryTimerExtensionWebGL2();gl2.endQuery(ext_2.TIME_ELAPSED_EXT)}},GPGPUContext.prototype.waitForQueryAndGetTime=function(query){return __awaiter(this,void 0,void 0,(function(){var _this=this;return __generator(this,(function(_a){switch(_a.label){case 0:return[4,util.repeatedTry((function(){return _this.disposed||_this.isQueryAvailable(query,environment_1.ENV.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}))];case 1:return _a.sent(),[2,this.getQueryTime(query,environment_1.ENV.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}}))}))},GPGPUContext.prototype.getQueryTime=function(query,queryTimerVersion){if(0===queryTimerVersion)return null;if(2===queryTimerVersion){var gl2=this.gl,timeElapsedNanos;return(timeElapsedNanos=gl2.getQueryParameter(query,gl2.QUERY_RESULT))/1e6}var ext=this.getQueryTimerExtensionWebGL1(),timeElapsedNanos;return(timeElapsedNanos=ext.getQueryObjectEXT(query,ext.QUERY_RESULT_EXT))/1e6},GPGPUContext.prototype.isQueryAvailable=function(query,queryTimerVersion){if(0===queryTimerVersion)return!0;if(2===queryTimerVersion){var gl2=this.gl,ext=this.getQueryTimerExtensionWebGL2(),available=gl2.getQueryParameter(query,gl2.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(ext.GPU_DISJOINT_EXT)),available&&!this.disjoint}var ext,available=(ext=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(query,ext.QUERY_RESULT_AVAILABLE_EXT);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(ext.GPU_DISJOINT_EXT)),available&&!this.disjoint},GPGPUContext.prototype.pollFence=function(fenceContext){var _this=this;return new Promise((function(resolve){_this.addItemToPoll((function(){return fenceContext.isFencePassed()}),(function(){return resolve()}))}))},GPGPUContext.prototype.pollItems=function(){for(var index=linearSearchLastTrue(this.itemsToPoll.map((function(x){return x.isDoneFn}))),i=0;i<=index;++i){var resolveFn;(0,this.itemsToPoll[i].resolveFn)()}this.itemsToPoll=this.itemsToPoll.slice(index+1)},GPGPUContext.prototype.addItemToPoll=function(isDoneFn,resolveFn){var _this=this;this.itemsToPoll.push({isDoneFn:isDoneFn,resolveFn:resolveFn}),this.itemsToPoll.length>1||util.repeatedTry((function(){return _this.pollItems(),0===_this.itemsToPoll.length}))},GPGPUContext.prototype.bindTextureToFrameBuffer=function(texture){this.throwIfDisposed(),webgl_util.bindColorTextureToFramebuffer(this.gl,this.debug,texture,this.framebuffer),this.debug&&webgl_util.validateFramebuffer(this.gl)},GPGPUContext.prototype.unbindTextureToFrameBuffer=function(){null!=this.outputTexture?(webgl_util.bindColorTextureToFramebuffer(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&webgl_util.validateFramebuffer(this.gl)):webgl_util.unbindColorTextureFromFramebuffer(this.gl,this.debug,this.framebuffer)},GPGPUContext.prototype.downloadMatrixDriver=function(texture,downloadAndDecode){this.bindTextureToFrameBuffer(texture);var result=downloadAndDecode();return this.unbindTextureToFrameBuffer(),result},GPGPUContext.prototype.setOutputMatrixTextureDriver=function(outputMatrixTextureMaybePacked,width,height){this.throwIfDisposed();var gl=this.gl;webgl_util.bindColorTextureToFramebuffer(gl,this.debug,outputMatrixTextureMaybePacked,this.framebuffer),this.debug&&webgl_util.validateFramebuffer(gl),this.outputTexture=outputMatrixTextureMaybePacked,webgl_util.callAndCheck(gl,this.debug,(function(){return gl.viewport(0,0,width,height)})),webgl_util.callAndCheck(gl,this.debug,(function(){return gl.scissor(0,0,width,height)}))},GPGPUContext.prototype.setOutputMatrixWriteRegionDriver=function(x,y,width,height){var _this=this;this.throwIfDisposed(),webgl_util.callAndCheck(this.gl,this.debug,(function(){return _this.gl.scissor(x,y,width,height)}))},GPGPUContext.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},GPGPUContext.prototype.throwIfNoProgram=function(){if(null==this.program)throw new Error("No GPU program is currently set.")},GPGPUContext}();function linearSearchLastTrue(arr){for(var i=0;i<arr.length;++i){var isDone;if(!arr[i]())break}return i-1}exports.GPGPUContext=GPGPUContext,exports.linearSearchLastTrue=linearSearchLastTrue},{"../../environment":151,"../../util":248,"./canvas_util":77,"./gpgpu_util":108,"./tex_util":138,"./webgl_util":146}],107:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2017 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../../environment"),util=require("../../util"),shader_compiler=require("./shader_compiler");function compileProgram(gpgpu,program,inputs,output){var userCode=program.userCode,inputInfos=inputs.map((function(input,i){var shapeInfo={logicalShape:input.shape,texShape:input.isUniform?null:input.texData.texShape,isUniform:input.isUniform,isPacked:!input.isUniform&&input.texData.isPacked,flatOffset:null};return null!=input.texData&&null!=input.texData.slice&&input.texData.slice.flatOffset>0&&(shapeInfo.flatOffset=input.texData.slice.flatOffset),{name:program.variableNames[i],shapeInfo:shapeInfo}})),inShapeInfos=inputInfos.map((function(x){return x.shapeInfo})),outShapeInfo={logicalShape:output.shape,texShape:output.texData.texShape,isUniform:!1,isPacked:output.texData.isPacked,flatOffset:null},source=shader_compiler.makeShader(inputInfos,outShapeInfo,userCode,program.usesPackedTextures),webGLProgram=gpgpu.createProgram(source),infLoc=null,nanLoc=gpgpu.getUniformLocation(webGLProgram,"NAN",!1);1===environment_1.ENV.getNumber("WEBGL_VERSION")&&(infLoc=gpgpu.getUniformLocation(webGLProgram,"INFINITY",!1));for(var uniformLocations={},i=0;i<program.variableNames.length;i++){var varName=program.variableNames[i],shouldThrow=!1;uniformLocations[varName]=gpgpu.getUniformLocation(webGLProgram,varName,!1),uniformLocations["offset"+varName]=gpgpu.getUniformLocation(webGLProgram,"offset"+varName,!1)}return{program:program,source:source,webGLProgram:webGLProgram,uniformLocations:uniformLocations,inShapeInfos:inShapeInfos,outShapeInfo:outShapeInfo,infLoc:infLoc,nanLoc:nanLoc}}function validateBinaryAndProgram(shapeInfos,inputs){if(shapeInfos.length!==inputs.length)throw Error("Binary was compiled with "+shapeInfos.length+" inputs, but was executed with "+inputs.length+" inputs");shapeInfos.forEach((function(s,i){var shapeA=s.logicalShape,input=inputs[i],shapeB=input.shape;if(!util.arraysEqual(shapeA,shapeB))throw Error("Binary was compiled with different shapes than the current args. Shapes "+shapeA+" and "+shapeB+" must match");if(!s.isUniform||!input.isUniform){var texShapeA=s.texShape,texShapeB=input.isUniform?null:input.texData.texShape;if(!util.arraysEqual(texShapeA,texShapeB))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+texShapeA+" and "+texShapeB+" must match")}}))}function runProgram(gpgpu,binary,inputs,output,customSetup){validateBinaryAndProgram(binary.inShapeInfos,inputs),validateBinaryAndProgram([binary.outShapeInfo],[output]);var outTex=output.texData.texture,outTexShape=output.texData.texShape;output.texData.isPacked?gpgpu.setOutputPackedMatrixTexture(outTex,outTexShape[0],outTexShape[1]):gpgpu.setOutputMatrixTexture(outTex,outTexShape[0],outTexShape[1]),gpgpu.setProgram(binary.webGLProgram),1===environment_1.ENV.getNumber("WEBGL_VERSION")&&null!==binary.infLoc&&gpgpu.gl.uniform1f(binary.infLoc,1/0),null!==binary.nanLoc&&gpgpu.gl.uniform1f(binary.nanLoc,NaN),inputs.forEach((function(input,i){var varName=binary.program.variableNames[i],varLoc=binary.uniformLocations[varName],varOffsetLoc=binary.uniformLocations["offset"+varName];if(null!=varLoc)if(input.isUniform)if(util.sizeFromShape(input.shape)<2)gpgpu.gl.uniform1f(varLoc,input.uniformValues[0]);else{var vals=input.uniformValues;vals instanceof Float32Array||(vals=new Float32Array(vals)),gpgpu.gl.uniform1fv(varLoc,vals)}else null!=input.texData.slice&&null!=varOffsetLoc&&gpgpu.gl.uniform1i(varOffsetLoc,input.texData.slice.flatOffset),gpgpu.setInputMatrixTexture(input.texData.texture,varLoc,i)})),null!=customSetup&&customSetup(gpgpu,binary.webGLProgram),gpgpu.executeProgram()}function makeShaderKey(program,inputs,output){var keyInputs="";inputs.concat(output).forEach((function(x){var hasOffset=null!=x.texData&&null!=x.texData.slice&&x.texData.slice.flatOffset>0,texShape=x.isUniform?"uniform":x.texData.texShape;keyInputs+=x.shape+"_"+texShape+"_"+hasOffset}));var keyUserCode=program.userCode,key=program.constructor.name;return key+="_"+keyInputs+"_"+keyUserCode}exports.compileProgram=compileProgram,exports.runProgram=runProgram,exports.makeShaderKey=makeShaderKey},{"../../environment":151,"../../util":248,"./shader_compiler":133}],108:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2017 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var glsl_version_1=require("./glsl_version"),tex_util=require("./tex_util"),webgl_util=require("./webgl_util");function createVertexShader(gl,debug){var glsl=glsl_version_1.getGlslDifferences(),vertexShaderSource=glsl.version+"\n    precision highp float;\n    "+glsl.attribute+" vec3 clipSpacePos;\n    "+glsl.attribute+" vec2 uv;\n    "+glsl.varyingVs+" vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }";return webgl_util.createVertexShader(gl,debug,vertexShaderSource)}function createVertexBuffer(gl,debug){var vertexArray=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return webgl_util.createStaticVertexBuffer(gl,debug,vertexArray)}function createIndexBuffer(gl,debug){var triangleVertexIndices=new Uint16Array([0,1,2,2,1,3]);return webgl_util.createStaticIndexBuffer(gl,debug,triangleVertexIndices)}function createAndConfigureTexture(gl,debug,width,height,internalFormat,textureFormat,textureType){webgl_util.validateTextureSize(width,height);var texture=webgl_util.createTexture(gl,debug),tex2d=gl.TEXTURE_2D;return webgl_util.callAndCheck(gl,debug,(function(){return gl.bindTexture(tex2d,texture)})),webgl_util.callAndCheck(gl,debug,(function(){return gl.texParameteri(tex2d,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE)})),webgl_util.callAndCheck(gl,debug,(function(){return gl.texParameteri(tex2d,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE)})),webgl_util.callAndCheck(gl,debug,(function(){return gl.texParameteri(tex2d,gl.TEXTURE_MIN_FILTER,gl.NEAREST)})),webgl_util.callAndCheck(gl,debug,(function(){return gl.texParameteri(tex2d,gl.TEXTURE_MAG_FILTER,gl.NEAREST)})),webgl_util.callAndCheck(gl,debug,(function(){return gl.texImage2D(tex2d,0,internalFormat,width,height,0,textureFormat,textureType,null)})),webgl_util.callAndCheck(gl,debug,(function(){return gl.bindTexture(gl.TEXTURE_2D,null)})),texture}function createFloat32MatrixTexture(gl,debug,rows,columns,textureConfig){var _a=tex_util.getUnpackedMatrixTextureShapeWidthHeight(rows,columns),width,height;return createAndConfigureTexture(gl,debug,_a[0],_a[1],textureConfig.internalFormatFloat,textureConfig.textureFormatFloat,gl.FLOAT)}function createFloat16MatrixTexture(gl,debug,rows,columns,textureConfig){var _a=tex_util.getUnpackedMatrixTextureShapeWidthHeight(rows,columns),width,height;return createAndConfigureTexture(gl,debug,_a[0],_a[1],textureConfig.internalFormatHalfFloat,textureConfig.textureFormatFloat,textureConfig.textureTypeHalfFloat)}function createUnsignedBytesMatrixTexture(gl,debug,rows,columns,textureConfig){var _a=tex_util.getUnpackedMatrixTextureShapeWidthHeight(rows,columns),width,height;return createAndConfigureTexture(gl,debug,_a[0],_a[1],gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE)}function createPackedMatrixTexture(gl,debug,rows,columns,textureConfig){var _a=tex_util.getPackedMatrixTextureShapeWidthHeight(rows,columns),width,height;return createAndConfigureTexture(gl,debug,_a[0],_a[1],textureConfig.internalFormatPackedFloat,gl.RGBA,gl.FLOAT)}function createFloat16PackedMatrixTexture(gl,debug,rows,columns,textureConfig){var _a=tex_util.getPackedMatrixTextureShapeWidthHeight(rows,columns),width,height;return createAndConfigureTexture(gl,debug,_a[0],_a[1],textureConfig.internalFormatPackedHalfFloat,gl.RGBA,textureConfig.textureTypeHalfFloat)}function bindVertexProgramAttributeStreams(gl,debug,program,vertexBuffer){var posOffset=0,uvOffset=12,stride=20,success;return webgl_util.callAndCheck(gl,debug,(function(){return gl.bindBuffer(gl.ARRAY_BUFFER,vertexBuffer)})),webgl_util.bindVertexBufferToProgramAttribute(gl,debug,program,"clipSpacePos",vertexBuffer,3,20,0)&&webgl_util.bindVertexBufferToProgramAttribute(gl,debug,program,"uv",vertexBuffer,2,20,12)}function uploadDenseMatrixToTexture(gl,debug,texture,width,height,data,textureConfig){var dataForUpload,texelDataType,internalFormat;webgl_util.callAndCheck(gl,debug,(function(){return gl.bindTexture(gl.TEXTURE_2D,texture)})),data instanceof Uint8Array?(dataForUpload=new Uint8Array(width*height*4),texelDataType=gl.UNSIGNED_BYTE,internalFormat=gl.RGBA):(dataForUpload=new Float32Array(width*height*4),texelDataType=gl.FLOAT,internalFormat=textureConfig.internalFormatPackedFloat),dataForUpload.set(data),webgl_util.callAndCheck(gl,debug,(function(){return gl.texImage2D(gl.TEXTURE_2D,0,internalFormat,width,height,0,gl.RGBA,texelDataType,dataForUpload)})),webgl_util.callAndCheck(gl,debug,(function(){return gl.bindTexture(gl.TEXTURE_2D,null)}))}function uploadPixelDataToTexture(gl,debug,texture,pixels){webgl_util.callAndCheck(gl,debug,(function(){return gl.bindTexture(gl.TEXTURE_2D,texture)})),pixels.data instanceof Uint8Array?webgl_util.callAndCheck(gl,debug,(function(){return gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,pixels.width,pixels.height,0,gl.RGBA,gl.UNSIGNED_BYTE,pixels.data)})):webgl_util.callAndCheck(gl,debug,(function(){return gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,pixels)})),webgl_util.callAndCheck(gl,debug,(function(){return gl.bindTexture(gl.TEXTURE_2D,null)}))}function createBufferFromOutputTexture(gl2,debug,rows,columns,textureConfig){var buffer=gl2.createBuffer();webgl_util.callAndCheck(gl2,debug,(function(){return gl2.bindBuffer(gl2.PIXEL_PACK_BUFFER,buffer)}));var bytesPerFloat=4,valuesPerTexel=4,bufferSizeBytes=16*rows*columns;return webgl_util.callAndCheck(gl2,debug,(function(){return gl2.bufferData(gl2.PIXEL_PACK_BUFFER,bufferSizeBytes,gl2.STREAM_READ)})),webgl_util.callAndCheck(gl2,debug,(function(){return gl2.readPixels(0,0,columns,rows,gl2.RGBA,gl2.FLOAT,0)})),webgl_util.callAndCheck(gl2,debug,(function(){return gl2.bindBuffer(gl2.PIXEL_PACK_BUFFER,null)})),buffer}function downloadFloat32MatrixFromBuffer(gl,buffer,size){var gl2=gl,downloadTarget=new Float32Array(size);return gl2.bindBuffer(gl2.PIXEL_PACK_BUFFER,buffer),gl2.getBufferSubData(gl2.PIXEL_PACK_BUFFER,0,downloadTarget),gl2.bindBuffer(gl2.PIXEL_PACK_BUFFER,null),downloadTarget}function downloadByteEncodedFloatMatrixFromOutputTexture(gl,debug,rows,columns,textureConfig){var _a=tex_util.getUnpackedMatrixTextureShapeWidthHeight(rows,columns),w=_a[0],h=_a[1],numChannels=4,downloadTarget=new Uint8Array(tex_util.getUnpackedArraySizeFromMatrixSize(rows*columns,4));return webgl_util.callAndCheck(gl,debug,(function(){return gl.readPixels(0,0,w,h,textureConfig.downloadTextureFormat,gl.UNSIGNED_BYTE,downloadTarget)})),new Float32Array(downloadTarget.buffer)}function downloadPackedMatrixFromBuffer(gl,buffer,batch,rows,cols,physicalRows,physicalCols,textureConfig){var gl2=gl,downloadTarget=new Float32Array(tex_util.getPackedRGBAArraySizeFromMatrixShape(physicalRows,physicalCols));return gl2.bindBuffer(gl2.PIXEL_PACK_BUFFER,buffer),gl2.getBufferSubData(gl2.PIXEL_PACK_BUFFER,0,downloadTarget),gl2.bindBuffer(gl2.PIXEL_PACK_BUFFER,null),downloadTarget}function downloadMatrixFromPackedOutputTexture(gl,debug,physicalRows,physicalCols){var packedRGBA=new Float32Array(physicalRows*physicalCols*4);return webgl_util.callAndCheck(gl,debug,(function(){return gl.readPixels(0,0,physicalCols,physicalRows,gl.RGBA,gl.FLOAT,packedRGBA)})),packedRGBA}exports.createVertexShader=createVertexShader,exports.createVertexBuffer=createVertexBuffer,exports.createIndexBuffer=createIndexBuffer,exports.createFloat32MatrixTexture=createFloat32MatrixTexture,exports.createFloat16MatrixTexture=createFloat16MatrixTexture,exports.createUnsignedBytesMatrixTexture=createUnsignedBytesMatrixTexture,exports.createPackedMatrixTexture=createPackedMatrixTexture,exports.createFloat16PackedMatrixTexture=createFloat16PackedMatrixTexture,exports.bindVertexProgramAttributeStreams=bindVertexProgramAttributeStreams,exports.uploadDenseMatrixToTexture=uploadDenseMatrixToTexture,exports.uploadPixelDataToTexture=uploadPixelDataToTexture,exports.createBufferFromOutputTexture=createBufferFromOutputTexture,exports.downloadFloat32MatrixFromBuffer=downloadFloat32MatrixFromBuffer,exports.downloadByteEncodedFloatMatrixFromOutputTexture=downloadByteEncodedFloatMatrixFromOutputTexture,exports.downloadPackedMatrixFromBuffer=downloadPackedMatrixFromBuffer,exports.downloadMatrixFromPackedOutputTexture=downloadMatrixFromPackedOutputTexture},{"./glsl_version":105,"./tex_util":138,"./webgl_util":146}],109:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var glsl_version_1=require("./glsl_version"),Im2ColPackedProgram=function(){function Im2ColPackedProgram(outputShape,inputShape,convInfo){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=outputShape;for(var filterWidth=convInfo.filterWidth,inChannels=convInfo.inChannels,strideWidth=convInfo.strideWidth,strideHeight=convInfo.strideHeight,padInfo=convInfo.padInfo,outWidth=convInfo.outWidth,dilationWidth=convInfo.dilationWidth,dilationHeight=convInfo.dilationHeight,dataFormat=convInfo.dataFormat,left=padInfo.left,top=padInfo.top,itemsPerBlockRow=inChannels*filterWidth,glsl=glsl_version_1.getGlslDifferences(),isChannelsLast="channelsLast"===dataFormat,rowDim=isChannelsLast?0:1,colDim=isChannelsLast?1:2,unrolled="",row=0;row<=1;row++)for(var col=0;col<=1;col++)unrolled+="\n          blockIndex = rc.y + "+col+";\n          pos = rc.x + "+row+";\n\n          if(blockIndex < "+outputShape[1]+" && pos < "+outputShape[0]+") {\n            offsetY = int(blockIndex / ("+outWidth+")) * "+strideHeight+" - "+top+";\n            d0 = offsetY + "+dilationHeight+" * (pos / "+itemsPerBlockRow+");\n\n            if(d0 < "+inputShape[rowDim]+" && d0 >= 0) {\n\n              offsetX = int(mod(float(blockIndex), "+outWidth+".) * "+strideWidth+". - "+left+".);\n              d1 = offsetX + "+dilationWidth+" * (int(mod(float(pos), "+itemsPerBlockRow+".) / "+inChannels+".));\n\n              if(d1 < "+inputShape[colDim]+" && d1 >= 0) {\n\n                ch = int(mod(float(pos), "+inChannels+".));\n\n                if ("+isChannelsLast+") {\n                  innerDims = vec2(d1, ch);\n                  result["+(2*row+col)+"] = getChannel(\n                    getA(d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result["+(2*row+col)+"] = getChannel(\n                    getA(ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        ";this.userCode="\n      void main() {\n        ivec2 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        "+unrolled+"\n\n        "+glsl.output+" = result;\n      }\n    "}return Im2ColPackedProgram}();exports.Im2ColPackedProgram=Im2ColPackedProgram},{"./glsl_version":105}],110:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2017 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var LRNProgram=function(){function LRNProgram(xShape,radius,bias,alpha,beta){this.variableNames=["x"],this.outputShape=[];var rad=radius,maxD=xShape[3]-1,powOperator;this.outputShape=xShape;var basis="float("+bias+") + float("+alpha+") * sum";powOperator=.5===beta?"inversesqrt("+basis+")":1===beta?"1.0/("+basis+")":"exp(log("+basis+") * float(-"+beta+"));",this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -"+rad+"; j <= "+rad+"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  "+maxD+") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * "+powOperator+";\n        setOutput(val);\n      }\n    "}return LRNProgram}();exports.LRNProgram=LRNProgram},{}],111:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var LRNGradProgram=function(){function LRNGradProgram(inputShape,depthRadius,bias,alpha,beta){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=inputShape,this.depth=inputShape[3],this.depthRadius=depthRadius,this.bias=bias,this.alpha=alpha,this.beta=beta,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < "+this.depth+"; ++d) {\n          int depthBegin = int(max(0.0, float(d - "+depthRadius+")));\n          int depthEnd = int(min(float("+this.depth+"),\n              float(d + "+depthRadius+" + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = "+this.depth+";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float("+alpha+") * norm + float("+bias+");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float("+alpha+")\n                * float("+beta+")\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * "+beta+");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    "}return LRNGradProgram}();exports.LRNGradProgram=LRNGradProgram},{}],112:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2019 Google LLC All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var LRNPackedProgram=function(){function LRNPackedProgram(xShape,radius,bias,alpha,beta){this.variableNames=["x"],this.outputShape=[],this.usesPackedTextures=!0;var rad=radius,maxD=xShape[3]-1,powOperator;this.outputShape=xShape;var basis="float("+bias+") + float("+alpha+") * sum";powOperator=.5===beta?"inversesqrt("+basis+")":1===beta?"1.0/("+basis+")":"exp(log("+basis+") * float(-"+beta+"));",this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < "+this.outputShape[3]+";\n        bool hasNextRow = c < "+this.outputShape[2]+";\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - "+rad+";\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - "+rad+"; j <= "+rad+"; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2("+maxD+"));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * "+powOperator+";\n        setOutput(result);\n      }\n    "}return LRNPackedProgram}();exports.LRNPackedProgram=LRNPackedProgram},{}],113:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2017 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var MaxPool2DBackpropProgram=function(){function MaxPool2DBackpropProgram(convInfo){this.variableNames=["dy","maxPos"],this.outputShape=convInfo.inShape;var strideHeight=convInfo.strideHeight,strideWidth=convInfo.strideWidth,dilationHeight=convInfo.dilationHeight,effectiveFilterHeight=convInfo.effectiveFilterHeight,effectiveFilterWidth=convInfo.effectiveFilterWidth,padTop=effectiveFilterHeight-1-convInfo.padInfo.top,padLeft=effectiveFilterWidth-1-convInfo.padInfo.left,lastIndex=effectiveFilterHeight*effectiveFilterWidth-1;this.userCode="\n      const ivec2 pads = ivec2("+padTop+", "+padLeft+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+effectiveFilterHeight+";\n          wR += "+dilationHeight+") {\n          float dyR = float(dyRCorner + wR) / "+strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+convInfo.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+effectiveFilterWidth+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+convInfo.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = "+lastIndex+" - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * "+effectiveFilterWidth+" + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}return MaxPool2DBackpropProgram}();exports.MaxPool2DBackpropProgram=MaxPool2DBackpropProgram;var MaxPool3DBackpropProgram=function(){function MaxPool3DBackpropProgram(convInfo){this.variableNames=["dy","maxPos"],this.outputShape=convInfo.inShape;var strideDepth=convInfo.strideDepth,strideHeight=convInfo.strideHeight,strideWidth=convInfo.strideWidth,dilationDepth=convInfo.dilationDepth,dilationHeight=convInfo.dilationHeight,dilationWidth=convInfo.dilationWidth,effectiveFilterDepth=convInfo.effectiveFilterDepth,effectiveFilterHeight=convInfo.effectiveFilterHeight,effectiveFilterWidth=convInfo.effectiveFilterWidth,padFront=effectiveFilterDepth-1-convInfo.padInfo.front,padTop=effectiveFilterHeight-1-convInfo.padInfo.top,padLeft=effectiveFilterWidth-1-convInfo.padInfo.left,lastIndex=effectiveFilterDepth*effectiveFilterHeight*effectiveFilterWidth-1;this.userCode="\n      const ivec3 pads = ivec3("+padFront+", "+padTop+", "+padLeft+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+effectiveFilterDepth+";\n           wD += "+dilationDepth+") {\n          float dyD = float(dyDCorner + wD) / "+strideDepth+".0;\n\n          if (dyD < 0.0 || dyD >= "+convInfo.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+effectiveFilterHeight+";\n              wR += "+dilationHeight+") {\n            float dyR = float(dyRCorner + wR) / "+strideHeight+".0;\n\n            if (dyR < 0.0 || dyR >= "+convInfo.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+effectiveFilterWidth+";\n                wC += "+dilationWidth+") {\n              float dyC = float(dyCCorner + wC) / "+strideWidth+".0;\n\n              if (dyC < 0.0 || dyC >= "+convInfo.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = "+lastIndex+" -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * "+effectiveFilterHeight+" * "+effectiveFilterWidth+" +\n                  wR * "+effectiveFilterWidth+" + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}return MaxPool3DBackpropProgram}();exports.MaxPool3DBackpropProgram=MaxPool3DBackpropProgram},{}],114:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var MatMulPackedProgram=function(){function MatMulPackedProgram(aShape,outputShape,transposeA,transposeB,addBias,activation,hasPreluActivation){void 0===transposeA&&(transposeA=!1),void 0===transposeB&&(transposeB=!1),void 0===addBias&&(addBias=!1),void 0===activation&&(activation=null),void 0===hasPreluActivation&&(hasPreluActivation=!1),this.variableNames=["matrixA","matrixB"],this.usesPackedTextures=!0,this.outputShape=outputShape;var sharedDim=transposeA?aShape[1]:aShape[2],sharedDimensionPacked=Math.ceil(sharedDim/2),aSample=transposeA?"i * 2, rc.y":"rc.y, i * 2",bSample=transposeB?"rc.z, i * 2":"i * 2, rc.z",aSwizzle=transposeA?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],bSwizzle=transposeB?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],activationSnippet="",applyActivationSnippet="";activation&&(activationSnippet=hasPreluActivation?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+activation+"\n        }":"vec4 activation(vec4 x) {\n          "+activation+"\n        }",applyActivationSnippet="result = activation(result);");var addBiasSnippet=addBias?"result += getBiasAtOutCoords();":"";addBias&&this.variableNames.push("bias"),hasPreluActivation&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+activationSnippet+"\n\n      const float sharedDimension = "+sharedDimensionPacked+".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < "+sharedDimensionPacked+"; i++) {\n          vec4 a = getMatrixA(rc.x, "+aSample+");\n          vec4 b = getMatrixB(rc.x, "+bSample+");\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += ("+aSwizzle[0]+" * "+bSwizzle[0]+");\n          result += ("+aSwizzle[1]+" * "+bSwizzle[1]+");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        "+addBiasSnippet+"\n\n        "+applyActivationSnippet+"\n\n        setOutput(result);\n      }\n    "}return MatMulPackedProgram}();exports.MatMulPackedProgram=MatMulPackedProgram},{}],115:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2017 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var MultinomialProgram=function(){function MultinomialProgram(batchSize,numOutcomes,numSamples){this.variableNames=["probs"],this.outputShape=[batchSize,numSamples],this.userCode="\n      uniform float seed;\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < "+(numOutcomes-1)+"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float("+(numOutcomes-1)+"));\n      }\n    "}return MultinomialProgram.prototype.getCustomSetupFunc=function(seed){var _this=this;return function(gpgpu,webGLProgram){null==_this.seedLoc&&(_this.seedLoc=gpgpu.getUniformLocation(webGLProgram,"seed")),gpgpu.gl.uniform1f(_this.seedLoc,seed)}},MultinomialProgram}();exports.MultinomialProgram=MultinomialProgram},{}],116:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2017 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var OneHotProgram=function(){function OneHotProgram(numIndices,depth,onValue,offValue){this.variableNames=["indices"],this.outputShape=[numIndices,depth],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float("+offValue+"), float("+onValue+"),\n                      float(index == coords.y)));\n      }\n    "}return OneHotProgram}();exports.OneHotProgram=OneHotProgram},{}],117:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var packing_util_1=require("../packing_util"),shader_compiler_1=require("./shader_compiler"),PackProgram=function(){function PackProgram(outputShape){this.variableNames=["A"],this.outputShape=outputShape;var rank=outputShape.length;if(0===rank)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{var channels=packing_util_1.getChannels("rc",rank),dtype=shader_compiler_1.getCoordsDataType(rank),outOfBoundsCondition=getOutOfBoundsCondition(rank,outputShape,channels),setup=getSetup(rank,outputShape[outputShape.length-1],outputShape[outputShape.length-2],channels),output=getOutput(outputShape,channels);this.userCode="\n        void main() {\n          "+dtype+" rc = getOutputCoords();\n\n          if("+outOfBoundsCondition+") {\n            setOutput(vec4(0));\n          } else {\n            "+setup+"\n\n            setOutput(vec4("+output+"));\n          }\n        }\n      "}}return PackProgram}();function getSourceCoordsArr(rank,dims){for(var coords=[],row=0;row<=1;row++)for(var col=0;col<=1;col++){for(var coord=(0===row?"r":"rp1")+", "+(0===col?"c":"cp1"),d=2;d<rank;d++)coord=dims[dims.length-1-d]+","+coord;coords.push(coord)}return coords}function getOutOfBoundsCondition(rank,shape,dims){if(1===rank)return"rc > "+shape[0];for(var cond="",i=rank-2;i<rank;i++)cond+=dims[i]+" >= "+shape[i],i<rank-1&&(cond+="||");return cond}function getSetup(rank,cols,rows,dims){if(1===rank)return"";var innerDims=dims.slice(-2);return"\n    int r = "+innerDims[0]+";\n    int c = "+innerDims[1]+";\n    int rp1 = r + 1;\n    int cp1 = c + 1;\n\n    bool cEdge = cp1 >= "+cols+";\n    bool rEdge = rp1 >= "+rows+";\n  "}function getOutput(shape,dims){var rank=shape.length,sourceCoords=getSourceCoordsArr(rank,dims);return 1===rank?"getA(rc),\n            rc + 1 >= "+shape[0]+" ? 0. : getA(rc + 1),\n            0, 0":"getA("+sourceCoords[0]+"),\n          cEdge ? 0. : getA("+sourceCoords[1]+"),\n          rEdge ? 0. : getA("+sourceCoords[2]+"),\n          rEdge || cEdge ? 0. : getA("+sourceCoords[3]+")"}exports.PackProgram=PackProgram},{"../packing_util":62,"./shader_compiler":133}],118:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2017 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var shader_compiler_1=require("./shader_compiler"),PadProgram=function(){function PadProgram(xShape,paddings,constantValue){this.variableNames=["x"],this.outputShape=paddings.map((function(p,i){return p[0]+xShape[i]+p[1]}));var rank=xShape.length,type=shader_compiler_1.getCoordsDataType(rank),start=paddings.map((function(p){return p[0]})).join(","),end=paddings.map((function(p,i){return p[0]+xShape[i]})).join(","),unpackedCoords=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,rank);this.userCode=1!==rank?"\n      "+type+" start = "+type+"("+start+");\n      "+type+" end = "+type+"("+end+");\n\n      void main() {\n        "+type+" outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(float("+constantValue+"));\n        } else {\n          "+type+" coords = outC - start;\n          setOutput(getX("+unpackedCoords+"));\n        }\n      }\n    ":"\n        int start = "+start+";\n        int end = "+end+";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(float("+constantValue+"));\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      "}return PadProgram}();exports.PadProgram=PadProgram},{"./shader_compiler":133}],119:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2019 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var packing_util_1=require("../packing_util"),shader_compiler_1=require("./shader_compiler"),PadPackedProgram=function(){function PadPackedProgram(xShape,paddings,constantValue){this.variableNames=["x"],this.usesPackedTextures=!0,this.outputShape=paddings.map((function(p,i){return p[0]+xShape[i]+p[1]}));for(var rank=xShape.length,dtype=shader_compiler_1.getCoordsDataType(rank),start=paddings.map((function(p){return p[0]})).join(","),end=paddings.map((function(p,i){return p[0]+xShape[i]})).join(","),coords=packing_util_1.getChannels("rc",rank),source=packing_util_1.getChannels("source",rank),cLimit=coords[rank-1]+" < "+this.outputShape[rank-1],innerDims=1===rank?"source":"vec2("+source.slice(-2).join()+")",componentSetup=[dtype+" rc = outputLoc;",coords[rank-1]+" += 1;\n       if("+cLimit+") {\n      ",1===rank?"":"}\n       rc = outputLoc;\n       "+coords[rank-2]+" += 1;\n       if("+coords[rank-2]+" < "+this.outputShape[rank-2]+") {",1===rank?"":"  "+coords[rank-1]+" += 1;\n         if("+cLimit+") {"],paddingArea=1===rank?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",mainLoop="",i=0,j=1===rank?2:4;i<j;i++)mainLoop+="\n        "+componentSetup[i]+"\n        if ("+paddingArea+") {\n          result["+i+"] = float("+constantValue+");\n        } else {\n          "+dtype+" source = rc - start;\n          result["+i+"] = getChannel(getX("+source.join()+"), "+innerDims+");\n        }\n      ";mainLoop+=1===rank?"} ":"}}",this.userCode="\n      const "+dtype+" start = "+dtype+"("+start+");\n      const "+dtype+" end = "+dtype+"("+end+");\n\n      void main() {\n        "+dtype+" outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        "+mainLoop+"\n        setOutput(result);\n      }\n    "}return PadPackedProgram}();exports.PadPackedProgram=PadPackedProgram},{"../packing_util":62,"./shader_compiler":133}],120:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2017 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var Pool2DProgram=function(){function Pool2DProgram(convInfo,poolType,computePositions){if(this.variableNames=["x"],"avg"===poolType&&computePositions)throw new Error("Cannot compute positions for average pool.");var filterWidth=convInfo.filterWidth,strideHeight=convInfo.strideHeight,strideWidth=convInfo.strideWidth,dilationHeight=convInfo.dilationHeight,dilationWidth=convInfo.dilationWidth,effectiveFilterHeight=convInfo.effectiveFilterHeight,effectiveFilterWidth=convInfo.effectiveFilterWidth,padTop=convInfo.padInfo.top,padLeft=convInfo.padInfo.left;this.outputShape=convInfo.outShape;var isAvgPool="avg"===poolType,initializationValue="0.0";if(isAvgPool||(initializationValue="-1.0 / 1e-20"),computePositions){var compareOp_1=">=";this.userCode="\n        const ivec2 strides = ivec2("+strideHeight+", "+strideWidth+");\n        const ivec2 pads = ivec2("+padTop+", "+padLeft+");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < "+effectiveFilterHeight+";\n              wR += "+dilationHeight+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+convInfo.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+effectiveFilterWidth+";\n                wC += "+dilationWidth+") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= "+convInfo.inWidth+") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value >= currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = wR * "+effectiveFilterWidth+" + wC;\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      "}else{var compareOp="max",returnValue=poolType+"("+poolType+"("+poolType+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===poolType&&(returnValue="avgValue / count");var filterWidthNearestVec4=4*Math.floor(filterWidth/4),filterWidthVec4Remainder=filterWidth%4,updateSnippet="\n      if ("+isAvgPool+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec2 strides = ivec2("+strideHeight+", "+strideWidth+");\n      const ivec2 pads = ivec2("+padTop+", "+padLeft+");\n      const float initializationValue = "+initializationValue+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= "+convInfo.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+initializationValue+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < "+effectiveFilterHeight+";\n            wR += "+dilationHeight+") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= "+convInfo.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+filterWidthNearestVec4+"; wC += 4) {\n            int xC = xCCorner + wC * "+dilationWidth+";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+dilationWidth+", d),\n              getValue(batch, xR, xC + 2 * "+dilationWidth+", d),\n              getValue(batch, xR, xC + 3 * "+dilationWidth+", d)\n            );\n\n            "+updateSnippet+"\n          }\n\n          int xC = xCCorner + "+filterWidthNearestVec4+";\n          if ("+(1===filterWidthVec4Remainder)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            "+updateSnippet+"\n          } else if ("+(2===filterWidthVec4Remainder)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+dilationWidth+", d),\n              initializationValue,\n              initializationValue\n            );\n\n            "+updateSnippet+"\n          } else if ("+(3===filterWidthVec4Remainder)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+dilationWidth+", d),\n              getValue(batch, xR, xC + 2 * "+dilationWidth+", d),\n              initializationValue\n            );\n\n            "+updateSnippet+"\n          }\n        }\n        setOutput("+returnValue+");\n      }\n    "}}return Pool2DProgram}();exports.Pool2DProgram=Pool2DProgram;var Pool3DProgram=function(){function Pool3DProgram(convInfo,poolType,computePositions){if(this.variableNames=["x"],"avg"===poolType&&computePositions)throw new Error("Cannot compute positions for average pool.");var filterWidth=convInfo.filterWidth,strideDepth=convInfo.strideDepth,strideHeight=convInfo.strideHeight,strideWidth=convInfo.strideWidth,dilationDepth=convInfo.dilationDepth,dilationHeight=convInfo.dilationHeight,dilationWidth=convInfo.dilationWidth,effectiveFilterDepth=convInfo.effectiveFilterDepth,effectiveFilterHeight=convInfo.effectiveFilterHeight,effectiveFilterWidth=convInfo.effectiveFilterWidth,padFront=convInfo.padInfo.front,padTop=convInfo.padInfo.top,padLeft=convInfo.padInfo.left;this.outputShape=convInfo.outShape;var isAvgPool="avg"===poolType,initializationValue="0.0";if(isAvgPool||(initializationValue="-1.0 / 1e-20"),computePositions){var compareOp_2=">=";this.userCode="\n        const ivec3 strides =\n            ivec3("+strideDepth+", "+strideHeight+", "+strideWidth+");\n        const ivec3 pads = ivec3("+padFront+", "+padTop+", "+padLeft+");\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < "+effectiveFilterDepth+";\n              wD += "+dilationDepth+") {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= "+convInfo.inDepth+") {\n              continue;\n            }\n\n            for (int wR = 0; wR < "+effectiveFilterHeight+";\n                wR += "+dilationHeight+") {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= "+convInfo.inHeight+") {\n                continue;\n              }\n\n              for (int wC = 0; wC < "+effectiveFilterWidth+";\n                  wC += "+dilationWidth+") {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= "+convInfo.inWidth+") {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value >= currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition =\n                      wD * "+effectiveFilterHeight+" * "+effectiveFilterWidth+" +\n                      wR * "+effectiveFilterWidth+" + wC;;\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      "}else{var compareOp="max",returnValue=poolType+"("+poolType+"("+poolType+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===poolType&&(returnValue="avgValue / count");var filterWidthNearestVec4=4*Math.floor(filterWidth/4),filterWidthVec4Remainder=filterWidth%4,updateSnippet="\n      if ("+isAvgPool+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec3 strides =\n        ivec3("+strideDepth+", "+strideHeight+", "+strideWidth+");\n      const ivec3 pads = ivec3("+padFront+", "+padTop+", "+padLeft+");\n      const float initializationValue = "+initializationValue+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= "+convInfo.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+initializationValue+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < "+effectiveFilterDepth+";\n            wD += "+dilationDepth+") {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= "+convInfo.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+effectiveFilterHeight+";\n            wR += "+dilationHeight+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+convInfo.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+filterWidthNearestVec4+"; wC += 4) {\n              int xC = xCCorner + wC * "+dilationWidth+";\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+dilationWidth+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+dilationWidth+", ch),\n                getValue(batch, xD, xR, xC + 3 * "+dilationWidth+", ch)\n              );\n\n              "+updateSnippet+"\n            }\n\n            int xC = xCCorner + "+filterWidthNearestVec4+";\n            if ("+(1===filterWidthVec4Remainder)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              "+updateSnippet+"\n            } else if ("+(2===filterWidthVec4Remainder)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+dilationWidth+", ch),\n                initializationValue,\n                initializationValue\n              );\n\n              "+updateSnippet+"\n            } else if ("+(3===filterWidthVec4Remainder)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+dilationWidth+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+dilationWidth+", ch),\n                initializationValue\n              );\n\n              "+updateSnippet+"\n            }\n          }\n          setOutput("+returnValue+");\n        }\n      }\n    "}}return Pool3DProgram}();exports.Pool3DProgram=Pool3DProgram},{}],121:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2017 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var ReduceProgram=function(){function ReduceProgram(reduceInfo,reduceType){this.variableNames=["x"];var windowSize=reduceInfo.windowSize,batchSize=reduceInfo.batchSize,inSize=reduceInfo.inSize,outSize=Math.ceil(inSize/windowSize);this.outputShape=[batchSize,outSize];var initializationValue="0.0",compareOp="";"prod"===reduceType?initializationValue="1.0":"min"===reduceType?(initializationValue="1.0 / 1e-20",compareOp="min"):"max"===reduceType&&(initializationValue="-1.0 / 1e-20",compareOp="max");var returnValue=reduceType+"("+reduceType+"("+reduceType+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"sum"===reduceType?returnValue="sumValue":"prod"===reduceType?returnValue="prodValue":"all"===reduceType?returnValue="allValue":"any"===reduceType&&(returnValue="anyValue");var windowSizeNearestVec4=4*Math.floor(windowSize/4),windowSizeVec4Remainder=windowSize%4,updateSnippet="\n      if ("+("sum"===reduceType)+") {\n        sumValue += dot(values, ones);\n      } else if ("+("prod"===reduceType)+") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = "+compareOp+"(values, minMaxValue);\n      }\n    ",vecType="vec4";"all"===reduceType?(initializationValue="1.0",updateSnippet="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",vecType="bvec4"):"any"===reduceType&&(initializationValue="0.0",updateSnippet="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",vecType="bvec4");var checkOutOfBounds="";inSize%windowSize>0&&(checkOutOfBounds="\n        if (inIdx < 0 || inIdx >= "+inSize+") {\n          return initializationValue;\n        }\n      "),this.userCode="\n      const float initializationValue = "+initializationValue+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        "+checkOutOfBounds+"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+windowSize+";\n\n        vec4 minMaxValue = vec4("+initializationValue+");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < "+windowSizeNearestVec4+"; i += 4) {\n          int inIdx = inOffset + i;\n          "+vecType+" values = "+vecType+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          "+updateSnippet+"\n        }\n\n        int inIdx = inOffset + "+windowSizeNearestVec4+";\n        if ("+(1===windowSizeVec4Remainder)+") {\n          "+vecType+" values = "+vecType+"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          "+updateSnippet+"\n        } else if ("+(2===windowSizeVec4Remainder)+") {\n          "+vecType+" values = "+vecType+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          "+updateSnippet+"\n        } else if ("+(3===windowSizeVec4Remainder)+") {\n          "+vecType+" values = "+vecType+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          "+updateSnippet+"\n        }\n        setOutput("+returnValue+");\n      }\n    "}return ReduceProgram}();exports.ReduceProgram=ReduceProgram},{}],122:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var shader_util=require("./shader_compiler_util"),ReshapePackedProgram=function(){function ReshapePackedProgram(outputShape,inputShape){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=outputShape;for(var mainLoop="",i=0;i<4;i++){var thisRC="thisRC = rc;";i%2==1&&(thisRC+="thisRC.z += 1;"),i>1&&(thisRC+="thisRC.y += 1;"),mainLoop+="\n        "+thisRC+"\n        "+(i>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+"\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result["+i+"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        "+(i>0?"}":"")+"\n      "}this.userCode="\n      "+getReshapedInputCoords(inputShape)+"\n      "+shader_util.getFlatIndexFrom3D(outputShape)+"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = "+outputShape[1]+";\n        int cols = "+outputShape[2]+";\n\n        "+mainLoop+"\n\n        setOutput(result);\n      }\n    "}return ReshapePackedProgram}();function getReshapedInputCoords(shape){var coordsFromIndexSnippet;return"\n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      "+shader_util.getLogicalCoordinatesFromFlatIndex(["r","c","d"],shape)+"\n      return ivec3(r, c, d);\n    }\n  "}exports.ReshapePackedProgram=ReshapePackedProgram},{"./shader_compiler_util":134}],123:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var ResizeBilinearBackpropProgram=function(){function ResizeBilinearBackpropProgram(dy,x,alignCorners){this.variableNames=["dy"],this.outputShape=[],this.outputShape=x.shape;var _a=x.shape,xHeight=_a[1],xWidth=_a[2],_b=dy.shape,yHeight=_b[1],yWidth=_b[2],effectiveXSize=[alignCorners&&yHeight>1?xHeight-1:xHeight,alignCorners&&yWidth>1?xWidth-1:xWidth],effectiveYSize=[alignCorners&&yHeight>1?yHeight-1:yHeight,alignCorners&&yWidth>1?yWidth-1:yWidth],heightScale=effectiveXSize[0]/effectiveYSize[0],widthScale=effectiveXSize[1]/effectiveYSize[1],invHeightScale=1/heightScale,invWidthScale=1/widthScale,winHeight=2*Math.ceil(invHeightScale)+2,winWidth=2*Math.ceil(invWidthScale)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+heightScale+");\n        const float widthScale = float("+widthScale+");\n\n        const float invHeightScale = float("+invHeightScale+");\n        const float invWidthScale = float("+invWidthScale+");\n\n        const int winHeight = int("+winHeight+");\n        const int winWidth = int("+winWidth+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+yHeight+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+yWidth+") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), "+(xHeight-1)+".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), "+(xWidth-1)+".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "}return ResizeBilinearBackpropProgram}();exports.ResizeBilinearBackpropProgram=ResizeBilinearBackpropProgram},{}],124:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2017 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var ResizeBilinearProgram=function(){function ResizeBilinearProgram(inputShape,newHeight,newWidth,alignCorners){this.variableNames=["A"],this.outputShape=[];var batch=inputShape[0],oldHeight=inputShape[1],oldWidth=inputShape[2],depth=inputShape[3];this.outputShape=[batch,newHeight,newWidth,depth];var effectiveInSize=[alignCorners&&newHeight>1?oldHeight-1:oldHeight,alignCorners&&newWidth>1?oldWidth-1:oldWidth],effectiveOutSize=[alignCorners&&newHeight>1?newHeight-1:newHeight,alignCorners&&newWidth>1?newWidth-1:newWidth];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+effectiveInSize[0]/effectiveOutSize[0]+",\n          "+effectiveInSize[1]/effectiveOutSize[1]+");\n      const vec2 inputShapeRC = vec2("+oldHeight+".0, "+oldWidth+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    "}return ResizeBilinearProgram}();exports.ResizeBilinearProgram=ResizeBilinearProgram},{}],125:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2019 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var ResizeBilinearPackedProgram=function(){function ResizeBilinearPackedProgram(inputShape,newHeight,newWidth,alignCorners){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=[];var batch=inputShape[0],oldHeight=inputShape[1],oldWidth=inputShape[2],depth=inputShape[3];this.outputShape=[batch,newHeight,newWidth,depth];var effectiveInSize=[alignCorners&&newHeight>1?oldHeight-1:oldHeight,alignCorners&&newWidth>1?oldWidth-1:oldWidth],effectiveOutSize=[alignCorners&&newHeight>1?newHeight-1:newHeight,alignCorners&&newWidth>1?newWidth-1:newWidth];this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          "+effectiveInSize[0]/effectiveOutSize[0]+",\n          "+effectiveInSize[1]/effectiveOutSize[1]+",\n          "+effectiveInSize[1]/effectiveOutSize[1]+");\n      const vec3 inputShapeRC = vec3("+oldHeight+".0, "+oldWidth+".0,\n                                     "+oldWidth+".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n        \n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < "+(depth-1)+"; \n        bool hasNextRow = coords.z < "+(newWidth-1)+";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    "}return ResizeBilinearPackedProgram}();exports.ResizeBilinearPackedProgram=ResizeBilinearPackedProgram},{}],126:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google LLC All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var ResizeNearestNeigborBackpropProgram=function(){function ResizeNearestNeigborBackpropProgram(dy,x,alignCorners){this.variableNames=["dy"],this.outputShape=[],this.outputShape=x.shape;var _a=x.shape,xHeight=_a[1],xWidth=_a[2],_b=dy.shape,yHeight=_b[1],yWidth=_b[2],effectiveXSize=[alignCorners&&yHeight>1?xHeight-1:xHeight,alignCorners&&yWidth>1?xWidth-1:xWidth],effectiveYSize=[alignCorners&&yHeight>1?yHeight-1:yHeight,alignCorners&&yWidth>1?yWidth-1:yWidth],heightScale=effectiveXSize[0]/effectiveYSize[0],widthScale=effectiveXSize[1]/effectiveYSize[1],invHeightScale=1/heightScale,invWidthScale=1/widthScale,winHeight=2*Math.ceil(invHeightScale)+2,winWidth=2*Math.ceil(invWidthScale)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+heightScale+");\n        const float widthScale = float("+widthScale+");\n\n        const float invHeightScale = float("+invHeightScale+");\n        const float invWidthScale = float("+invWidthScale+");\n\n        const int winHeight = int("+winHeight+");\n        const int winWidth = int("+winWidth+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+yHeight+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+yWidth+") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float("+effectiveXSize[0]+") *\n                (float(dyR) / float("+effectiveYSize[0]+"));\n\n            float sourceFracCol =\n                float("+effectiveXSize[1]+") *\n                  (float(dyC) / float("+effectiveYSize[1]+"));\n\n            int sourceNearestRow = int(min(\n                float(int("+xHeight+") - 1),\n                "+alignCorners+" ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int("+xWidth+") - 1),\n                "+alignCorners+" ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "}return ResizeNearestNeigborBackpropProgram}();exports.ResizeNearestNeigborBackpropProgram=ResizeNearestNeigborBackpropProgram},{}],127:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var ResizeNearestNeighborProgram=function(){function ResizeNearestNeighborProgram(inputShape,newHeight,newWidth,alignCorners){this.variableNames=["A"],this.outputShape=[];var batch=inputShape[0],oldHeight=inputShape[1],oldWidth=inputShape[2],depth=inputShape[3];this.outputShape=[batch,newHeight,newWidth,depth];var effectiveInSize=[alignCorners&&newHeight>1?oldHeight-1:oldHeight,alignCorners&&newWidth>1?oldWidth-1:oldWidth],effectiveOutSize=[alignCorners&&newHeight>1?newHeight-1:newHeight,alignCorners&&newWidth>1?newWidth-1:newWidth],roundBase=alignCorners?"0.5":"0.0";this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+effectiveInSize[0]/effectiveOutSize[0]+",\n          "+effectiveInSize[1]/effectiveOutSize[1]+");\n      const vec2 inputShapeRC = vec2("+oldHeight+".0, "+oldWidth+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + "+roundBase+")));\n\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    "}return ResizeNearestNeighborProgram}();exports.ResizeNearestNeighborProgram=ResizeNearestNeighborProgram},{}],128:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2017 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var shader_compiler_1=require("./shader_compiler"),ReverseProgram=function(){function ReverseProgram(xShape,axis){this.variableNames=["x"];var rank=xShape.length;if(rank>4)throw new Error("WebGL backend: Reverse of rank-"+rank+" tensor is not yet supported");if(this.outputShape=xShape,1!==rank){var getInCoord=function(i){return-1!==axis.indexOf(i)&&1!==xShape[i]?xShape[i]+" - coords["+i+"] - 1":"coords["+i+"]"},inCoords=xShape.map((function(_,i){return getInCoord(i)})).join(","),type=shader_compiler_1.getCoordsDataType(rank);this.userCode="\n      void main() {\n        "+type+" coords = getOutputCoords();\n        setOutput(getX("+inCoords+"));\n      }\n    "}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX("+xShape[0]+" - coord - 1));\n        }\n      "}return ReverseProgram}();exports.ReverseProgram=ReverseProgram},{"./shader_compiler":133}],129:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2019 Google LLC All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var packing_util_1=require("../packing_util"),shader_compiler_1=require("./shader_compiler"),ReversePackedProgram=function(){function ReversePackedProgram(xShape,axis){this.variableNames=["x"],this.usesPackedTextures=!0;var rank=xShape.length;if(rank>4)throw new Error("WebGL backend: Reverse of rank-"+rank+" tensor is not yet supported");this.outputShape=xShape;var channels=packing_util_1.getChannels("rc",rank),nextColumn=channels[rank-1]+" + 1 < "+this.outputShape[rank-1],nextRow=channels[rank-2]+" + 1 < "+this.outputShape[rank-2],type=shader_compiler_1.getCoordsDataType(rank);function getR(channels){return getChannel(channels)}function getG(channels){return channels[rank-1]="("+channels[rank-1]+" + 1)",getChannel(channels)}function getB(channels){return channels[rank-2]="("+channels[rank-2]+" + 1)",getChannel(channels)}function getA(channels){return channels[rank-1]="("+channels[rank-1]+" + 1)",channels[rank-2]="("+channels[rank-2]+" + 1)",getChannel(channels)}function getChannel(channels){var inCoordsArray=xShape.map((function(_,i){return getInCoord(i,channels)})),inCoords,innerDims;return"getChannel(getX("+inCoordsArray.join(",")+"), vec2("+inCoordsArray.slice(-2).join(",")+"))"}function getInCoord(i,channels1){return-1!==axis.indexOf(i)&&1!==xShape[i]?xShape[i]+" - "+channels1[i]+" - 1":""+channels1[i]}this.userCode=1===rank?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX("+xShape[0]+" - rc - 1),\n            "+xShape[0]+" - rc - 1);\n          if("+nextColumn+"){\n              result.g = getChannel(getX("+xShape[0]+" - (rc  + 1) - 1),\n                "+xShape[0]+" - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      ":"\n        void main() {\n          "+type+" rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = "+getR(channels.slice())+";\n          if("+nextColumn+"){\n            result.g = "+getG(channels.slice())+";\n          }\n          if("+nextRow+") {\n            result.b = "+getB(channels.slice())+";\n            if("+nextColumn+") {\n              result.a = "+getA(channels.slice())+";\n            }\n          }\n          setOutput(result);\n        }\n    "}return ReversePackedProgram}();exports.ReversePackedProgram=ReversePackedProgram},{"../packing_util":62,"./shader_compiler":133}],130:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var shader_compiler_1=require("./shader_compiler"),ScatterProgram=function(){function ScatterProgram(updateSize,sliceDim,indicesRank,updatesRank,strides,shape,summingDupeIndex){void 0===summingDupeIndex&&(summingDupeIndex=!0),this.variableNames=["updates","indices","defaultValue"],this.outputShape=shape;var stridesType=shader_compiler_1.getCoordsDataType(strides.length),dtype=shader_compiler_1.getCoordsDataType(shape.length),indicesString="";1===indicesRank?indicesString="i":2===indicesRank&&(indicesString="i, j");var indicesSnippet="getIndices("+indicesString+")",updatesString="";1===updatesRank?updatesString="i":2===updatesRank&&(updatesString="i, coords[1]");var updatesSnippet="getUpdates("+updatesString+")",strideString=sliceDim>1?"strides[j]":"strides";this.userCode="\n        "+stridesType+" strides = "+stridesType+"("+strides+");\n\n        void main() {\n          "+dtype+" coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < "+updateSize+"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < "+sliceDim+"; j++) {\n              int index = round("+indicesSnippet+");\n              flattenedIndex += index * "+strideString+";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += "+updatesSnippet+";\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      "}return ScatterProgram}();exports.ScatterProgram=ScatterProgram},{"./shader_compiler":133}],131:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var SegmentOpProgram=function(){function SegmentOpProgram(segOpInfo,segOpType){this.variableNames=["x","segmentIds"];var windowSize=segOpInfo.windowSize,batchSize=segOpInfo.batchSize,inSize=segOpInfo.inSize,numSegments=segOpInfo.numSegments,outSize=numSegments*Math.ceil(inSize/windowSize);this.outputShape=[batchSize,outSize];var initializationValue="0.0",returnValue="sumValue",windowSizeNearestVec4=4*Math.floor(windowSize/4),windowSizeVec4Remainder=windowSize%4,updateSnippet="\n        sumValue += dot(values, segFilter);\n    ",checkValueOutOfBounds="";inSize%windowSize>0&&(checkValueOutOfBounds="\n        if (inIdx < 0 || inIdx >= "+inSize+") {\n          return initializationValue;\n        }\n      ");var checkSegmentIdOutOfBounds="";inSize%windowSize>0&&(checkSegmentIdOutOfBounds="\n        if (inIdx < 0 || inIdx >= "+inSize+") {\n          return -1.0;\n        }\n      "),this.userCode="\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        "+checkValueOutOfBounds+"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        "+checkSegmentIdOutOfBounds+"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          "+numSegments+")) * float("+windowSize+"));\n        int currentSeg = int(mod(float(outIdx), float("+numSegments+")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < "+windowSizeNearestVec4+"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          "+updateSnippet+"\n        }\n\n        int inIdx = inOffset + "+windowSizeNearestVec4+";\n        if ("+(1===windowSizeVec4Remainder)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          "+updateSnippet+"\n        } else if ("+(2===windowSizeVec4Remainder)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          "+updateSnippet+"\n        } else if ("+(3===windowSizeVec4Remainder)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          "+updateSnippet+"\n        }\n        setOutput(sumValue);\n      }\n    "}return SegmentOpProgram}();exports.SegmentOpProgram=SegmentOpProgram},{}],132:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2017 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var shader_compiler_1=require("./shader_compiler"),SelectProgram=function(){function SelectProgram(cRank,shape,rank){var cCoords,abCoords;if(this.variableNames=["c","a","b"],this.outputShape=shape,rank>4)throw Error("Where for rank "+rank+" is not yet supported");if(1===rank)abCoords="resRC",cCoords="resRC";else{for(var currentCoords=["resRC.x","resRC.y","resRC.z","resRC.w"],cCoordVars=[],abCoordVars=[],i=0;i<shape.length;i++)abCoordVars.push(""+currentCoords[i]),i<cRank&&cCoordVars.push(""+currentCoords[i]);cCoords=cCoordVars.join(),abCoords=abCoordVars.join()}var dtype=shader_compiler_1.getCoordsDataType(rank);this.userCode="\n      void main() {\n        "+dtype+" resRC = getOutputCoords();\n        float cVal = getC("+cCoords+");\n        if (cVal >= 1.0) {\n          setOutput(getA("+abCoords+"));\n        } else {\n          setOutput(getB("+abCoords+"));\n        }\n      }\n    "}return SelectProgram}();exports.SelectProgram=SelectProgram},{"./shader_compiler":133}],133:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2017 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var broadcast_util_1=require("../../ops/broadcast_util"),util=require("../../util"),glsl_version_1=require("./glsl_version"),shader_util=require("./shader_compiler_util");function makeShader(inputsInfo,outputShape,userCode,usesPackedTextures){var prefixSnippets=[];inputsInfo.forEach((function(x){var size=util.sizeFromShape(x.shapeInfo.logicalShape);x.shapeInfo.isUniform?prefixSnippets.push("uniform float "+x.name+(size>1?"["+size+"]":"")+";"):(prefixSnippets.push("uniform sampler2D "+x.name+";"),prefixSnippets.push("uniform int offset"+x.name+";"))}));var inputPrefixSnippet=prefixSnippets.join("\n"),inputSamplingSnippet=inputsInfo.map((function(x){return getInputSamplingSnippet(x,outputShape,usesPackedTextures)})).join("\n"),outTexShape=outputShape.texShape,glsl=glsl_version_1.getGlslDifferences(),floatTextureSampleSnippet=getFloatTextureSampleSnippet(glsl),outputSamplingSnippet,floatTextureSetOutputSnippet,shaderPrefix=getShaderPrefix(glsl),source;return outputShape.isPacked?(outputSamplingSnippet=getPackedOutputSamplingSnippet(outputShape.logicalShape,outTexShape),floatTextureSetOutputSnippet=getFloatTextureSetRGBASnippet(glsl)):(outputSamplingSnippet=getOutputSamplingSnippet(outputShape.logicalShape,outTexShape),floatTextureSetOutputSnippet=getFloatTextureSetRSnippet(glsl)),usesPackedTextures&&(shaderPrefix+=SHADER_PACKED_PREFIX),[shaderPrefix,floatTextureSampleSnippet,floatTextureSetOutputSnippet,inputPrefixSnippet,outputSamplingSnippet,inputSamplingSnippet,userCode].join("\n")}function getSamplerFromInInfo(inInfo){var shape=inInfo.shapeInfo.logicalShape;switch(shape.length){case 0:return getSamplerScalar(inInfo);case 1:return getSampler1D(inInfo);case 2:return getSampler2D(inInfo);case 3:return getSampler3D(inInfo);case 4:return getSampler4D(inInfo);case 5:return getSampler5D(inInfo);case 6:return getSampler6D(inInfo);default:throw new Error(shape.length+"-D input sampling is not yet supported")}}function getPackedSamplerFromInInfo(inInfo){var shape;switch(inInfo.shapeInfo.logicalShape.length){case 0:return getPackedSamplerScalar(inInfo);case 1:return getPackedSampler1D(inInfo);case 2:return getPackedSampler2D(inInfo);case 3:return getPackedSampler3D(inInfo);default:return getPackedSamplerND(inInfo)}}function getInputSamplingSnippet(inInfo,outShapeInfo,usesPackedTextures){void 0===usesPackedTextures&&(usesPackedTextures=!1);var res="";res+=usesPackedTextures?getPackedSamplerFromInInfo(inInfo):getSamplerFromInInfo(inInfo);var inShape=inInfo.shapeInfo.logicalShape,outShape=outShapeInfo.logicalShape;return inShape.length<=outShape.length&&(res+=usesPackedTextures?getPackedSamplerAtOutputCoords(inInfo,outShapeInfo):getSamplerAtOutputCoords(inInfo,outShapeInfo)),res}function getPackedOutputSamplingSnippet(outShape,outTexShape){switch(outShape.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return getOutputPacked1DCoords(outShape,outTexShape);case 2:return getOutputPacked2DCoords(outShape,outTexShape);case 3:return getOutputPacked3DCoords(outShape,outTexShape);default:return getOutputPackedNDCoords(outShape,outTexShape)}}function getOutputSamplingSnippet(outShape,outTexShape){switch(outShape.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return getOutput1DCoords(outShape,outTexShape);case 2:return getOutput2DCoords(outShape,outTexShape);case 3:return getOutput3DCoords(outShape,outTexShape);case 4:return getOutput4DCoords(outShape,outTexShape);case 5:return getOutput5DCoords(outShape,outTexShape);case 6:return getOutput6DCoords(outShape,outTexShape);default:throw new Error(outShape.length+"-D output sampling is not yet supported")}}function getFloatTextureSampleSnippet(glsl){return"\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return "+glsl.texture2D+"(textureSampler, uv).r;\n    }\n  "}function getFloatTextureSetRSnippet(glsl){return"\n    void setOutput(float val) {\n      "+glsl.output+" = vec4(val, 0, 0, 0);\n    }\n  "}function getFloatTextureSetRGBASnippet(glsl){return"\n    void setOutput(vec4 val) {\n      "+glsl.output+" = val;\n    }\n  "}function getShaderPrefix(glsl){var SHADER_PREFIX;return glsl.version+"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    "+glsl.varyingFs+" vec2 resultUV;\n    "+glsl.defineOutput+"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    #define isnan(value) isnan_custom(value)\n    "+glsl.defineSpecialNaN+"\n    bvec4 isnan_custom(vec4 val) {\n      return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n    }\n\n    "+glsl.defineSpecialInf+"\n    "+glsl.defineRound+"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    "+SAMPLE_1D_SNIPPET+"\n    "+SAMPLE_2D_SNIPPET+"\n    "+SAMPLE_3D_SNIPPET+"\n  "}exports.makeShader=makeShader;var SAMPLE_1D_SNIPPET="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",SAMPLE_2D_SNIPPET="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",SAMPLE_3D_SNIPPET="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",SHADER_PACKED_PREFIX="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function getOutputScalarCoords(){return"\n    int getOutputCoords() {\n      return 0;\n    }\n  "}function getOutputPacked1DCoords(shape,texShape){var packedTexShape=[Math.ceil(texShape[0]/2),Math.ceil(texShape[1]/2)];return 1===packedTexShape[0]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * "+packedTexShape[1]+".0);\n      }\n    ":1===packedTexShape[1]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * "+packedTexShape[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+packedTexShape[0]+", "+packedTexShape[1]+"));\n      return 2 * (resTexRC.x * "+packedTexShape[1]+" + resTexRC.y);\n    }\n  "}function getOutput1DCoords(shape,texShape){return 1===texShape[0]?"\n      int getOutputCoords() {\n        return int(resultUV.x * "+texShape[1]+".0);\n      }\n    ":1===texShape[1]?"\n      int getOutputCoords() {\n        return int(resultUV.y * "+texShape[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+texShape[0]+", "+texShape[1]+"));\n      return resTexRC.x * "+texShape[1]+" + resTexRC.y;\n    }\n  "}function getOutputPacked3DCoords(shape,texShape){var packedTexShape=[Math.ceil(texShape[0]/2),Math.ceil(texShape[1]/2)],texelsInLogicalRow=Math.ceil(shape[2]/2),texelsInBatch=texelsInLogicalRow*Math.ceil(shape[1]/2);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+packedTexShape[0]+", "+packedTexShape[1]+"));\n      int index = resTexRC.x * "+packedTexShape[1]+" + resTexRC.y;\n\n      int b = index / "+texelsInBatch+";\n      index -= b * "+texelsInBatch+";\n\n      int r = 2 * (index / "+texelsInLogicalRow+");\n      int c = imod(index, "+texelsInLogicalRow+") * 2;\n\n      return ivec3(b, r, c);\n    }\n  "}function getOutput3DCoords(shape,texShape){var coordsFromIndexSnippet=shader_util.getLogicalCoordinatesFromFlatIndex(["r","c","d"],shape);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+texShape[0]+", "+texShape[1]+"));\n      int index = resTexRC.x * "+texShape[1]+" + resTexRC.y;\n      "+coordsFromIndexSnippet+"\n      return ivec3(r, c, d);\n    }\n  "}function getOutputPackedNDCoords(shape,texShape){for(var packedTexShape=[Math.ceil(texShape[0]/2),Math.ceil(texShape[1]/2)],texelsInLogicalRow=Math.ceil(shape[shape.length-1]/2),texelsInBatch=texelsInLogicalRow*Math.ceil(shape[shape.length-2]/2),texelsInBatchN=texelsInBatch,batches="",coords="b, r, c",b=2;b<shape.length-1;b++)batches="\n      int b"+b+" = index / "+(texelsInBatchN*=shape[shape.length-b-1])+";\n      index -= b"+b+" * "+texelsInBatchN+";\n    "+batches,coords="b"+b+", "+coords;return"\n    ivec"+shape.length+" getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+packedTexShape[0]+", "+packedTexShape[1]+"));\n      int index = resTexRC.x * "+packedTexShape[1]+" + resTexRC.y;\n\n      "+batches+"\n\n      int b = index / "+texelsInBatch+";\n      index -= b * "+texelsInBatch+";\n\n      int r = 2 * (index / "+texelsInLogicalRow+");\n      int c = imod(index, "+texelsInLogicalRow+") * 2;\n\n      return ivec"+shape.length+"("+coords+");\n    }\n  "}function getOutput4DCoords(shape,texShape){var coordsFromIndexSnippet=shader_util.getLogicalCoordinatesFromFlatIndex(["r","c","d","d2"],shape);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+texShape[0]+", "+texShape[1]+"));\n      int index = resTexRC.x * "+texShape[1]+" + resTexRC.y;\n      "+coordsFromIndexSnippet+"\n      return ivec4(r, c, d, d2);\n    }\n  "}function getOutput5DCoords(shape,texShape){var coordsFromIndexSnippet=shader_util.getLogicalCoordinatesFromFlatIndex(["r","c","d","d2","d3"],shape);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2("+texShape[0]+",\n                             "+texShape[1]+"));\n\n      int index = resTexRC.x * "+texShape[1]+" + resTexRC.y;\n\n      "+coordsFromIndexSnippet+"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  "}function getOutput6DCoords(shape,texShape){var coordsFromIndexSnippet=shader_util.getLogicalCoordinatesFromFlatIndex(["r","c","d","d2","d3","d4"],shape);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+texShape[0]+", "+texShape[1]+"));\n      int index = resTexRC.x * "+texShape[1]+" + resTexRC.y;\n\n      "+coordsFromIndexSnippet+"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  "}function getOutputPacked2DCoords(shape,texShape){var packedTexShape=[Math.ceil(texShape[0]/2),Math.ceil(texShape[1]/2)];if(util.arraysEqual(shape,texShape))return"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2("+packedTexShape[0]+", "+packedTexShape[1]+"));\n      }\n    ";var texelsInLogicalRow=Math.ceil(shape[1]/2);return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+packedTexShape[0]+", "+packedTexShape[1]+"));\n\n      int index = resTexRC.x * "+packedTexShape[1]+" + resTexRC.y;\n      int r = 2 * (index / "+texelsInLogicalRow+");\n      int c = imod(index, "+texelsInLogicalRow+") * 2;\n\n      return ivec2(r, c);\n    }\n  "}function getOutput2DCoords(shape,texShape){return util.arraysEqual(shape,texShape)?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2("+texShape[0]+", "+texShape[1]+"));\n      }\n    ":1===shape[1]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+texShape[0]+", "+texShape[1]+"));\n        int index = resTexRC.x * "+texShape[1]+" + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":1===shape[0]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+texShape[0]+", "+texShape[1]+"));\n        int index = resTexRC.x * "+texShape[1]+" + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+texShape[0]+", "+texShape[1]+"));\n      int index = resTexRC.x * "+texShape[1]+" + resTexRC.y;\n      int r = index / "+shape[1]+";\n      int c = index - r * "+shape[1]+";\n      return ivec2(r, c);\n    }\n  "}function getFlatOffsetUniformName(texName){return"offset"+texName}function getPackedSamplerScalar(inputInfo){var texName=inputInfo.name,funcName,glsl;return"\n    vec4 "+("get"+texName.charAt(0).toUpperCase()+texName.slice(1))+"() {\n      return "+glsl_version_1.getGlslDifferences().texture2D+"("+texName+", halfCR);\n    }\n  "}function getSamplerScalar(inputInfo){var texName=inputInfo.name,funcName="get"+texName.charAt(0).toUpperCase()+texName.slice(1);if(inputInfo.shapeInfo.isUniform)return"float "+funcName+"() {return "+texName+";}";var _a=inputInfo.shapeInfo.texShape,texNumR=_a[0],texNumC=_a[1];if(1===texNumR&&1===texNumC)return"\n      float "+funcName+"() {\n        return sampleTexture("+texName+", halfCR);\n      }\n    ";var _b=inputInfo.shapeInfo.texShape,tNumR,tNumC,offset;return"\n    float "+funcName+"() {\n      vec2 uv = uvFromFlat("+_b[0]+", "+_b[1]+", "+getFlatOffsetUniformName(texName)+");\n      return sampleTexture("+texName+", uv);\n    }\n  "}function getPackedSampler1D(inputInfo){var texName=inputInfo.name,funcName="get"+texName.charAt(0).toUpperCase()+texName.slice(1),texShape=inputInfo.shapeInfo.texShape,packedTexShape=[Math.ceil(texShape[0]/2),Math.ceil(texShape[1]/2)],glsl=glsl_version_1.getGlslDifferences();return"\n    vec4 "+funcName+"(int index) {\n      vec2 uv = packedUVfrom1D(\n        "+packedTexShape[0]+", "+packedTexShape[1]+", index);\n      return "+glsl.texture2D+"("+texName+", uv);\n    }\n  "}function getSampler1D(inputInfo){var texName=inputInfo.name,funcName="get"+texName.charAt(0).toUpperCase()+texName.slice(1);if(inputInfo.shapeInfo.isUniform)return"\n      float "+funcName+"(int index) {\n        "+getUniformSampler(inputInfo)+"\n      }\n    ";var texShape=inputInfo.shapeInfo.texShape,tNumR=texShape[0],tNumC=texShape[1];if(1===tNumC&&1===tNumR)return"\n      float "+funcName+"(int index) {\n        return sampleTexture("+texName+", halfCR);\n      }\n    ";var offset=getFlatOffsetUniformName(texName);return 1===tNumC?"\n      float "+funcName+"(int index) {\n        vec2 uv = vec2(0.5, (float(index + "+offset+") + 0.5) / "+tNumR+".0);\n        return sampleTexture("+texName+", uv);\n      }\n    ":1===tNumR?"\n      float "+funcName+"(int index) {\n        vec2 uv = vec2((float(index + "+offset+") + 0.5) / "+tNumC+".0, 0.5);\n        return sampleTexture("+texName+", uv);\n      }\n    ":"\n    float "+funcName+"(int index) {\n      vec2 uv = uvFromFlat("+tNumR+", "+tNumC+", index + "+offset+");\n      return sampleTexture("+texName+", uv);\n    }\n  "}function getPackedSampler2D(inputInfo){var shape=inputInfo.shapeInfo.logicalShape,texName=inputInfo.name,funcName="get"+texName.charAt(0).toUpperCase()+texName.slice(1),texShape=inputInfo.shapeInfo.texShape,texNumR=texShape[0],texNumC=texShape[1],glsl=glsl_version_1.getGlslDifferences();if(null!=texShape&&util.arraysEqual(shape,texShape))return"\n      vec4 "+funcName+"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2("+texNumC+".0, "+texNumR+".0);\n\n        return "+glsl.texture2D+"("+texName+", uv);\n      }\n    ";var packedTexShape=[Math.ceil(texShape[0]/2),Math.ceil(texShape[1]/2)],valuesPerRow;return"\n    vec4 "+funcName+"(int row, int col) {\n      vec2 uv = packedUVfrom2D("+Math.ceil(shape[1]/2)+", "+packedTexShape[0]+", "+packedTexShape[1]+", row, col);\n      return "+glsl.texture2D+"("+texName+", uv);\n    }\n  "}function getSampler2D(inputInfo){var shape=inputInfo.shapeInfo.logicalShape,texName=inputInfo.name,funcName="get"+texName.charAt(0).toUpperCase()+texName.slice(1),texShape=inputInfo.shapeInfo.texShape;if(null!=texShape&&util.arraysEqual(shape,texShape)){var texNumR_1=texShape[0],texNumC_1;return"\n    float "+funcName+"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2("+texShape[1]+".0, "+texNumR_1+".0);\n      return sampleTexture("+texName+", uv);\n    }\n  "}var _a=util.squeezeShape(shape),newShape=_a.newShape,keptDims=_a.keptDims,squeezedShape=newShape;if(squeezedShape.length<shape.length){var newInputInfo,params=["row","col"];return"\n      "+getSamplerFromInInfo(squeezeInputInfo(inputInfo,squeezedShape))+"\n      float "+funcName+"(int row, int col) {\n        return "+funcName+"("+getSqueezedParams(params,keptDims)+");\n      }\n    "}if(inputInfo.shapeInfo.isUniform)return"\n      float "+funcName+"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2("+shape[1]+", 1)));\n        "+getUniformSampler(inputInfo)+"\n      }\n    ";var texNumR=texShape[0],texNumC=texShape[1],offset=getFlatOffsetUniformName(texName);return 1===texNumC?"\n    float "+funcName+"(int row, int col) {\n      float index = dot(vec3(row, col, "+offset+"), vec3("+shape[1]+", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / "+texNumR+".0);\n      return sampleTexture("+texName+", uv);\n    }\n  ":1===texNumR?"\n    float "+funcName+"(int row, int col) {\n      float index = dot(vec3(row, col, "+offset+"), vec3("+shape[1]+", 1, 1));\n      vec2 uv = vec2((index + 0.5) / "+texNumC+".0, 0.5);\n      return sampleTexture("+texName+", uv);\n    }\n  ":"\n  float "+funcName+"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * "+shape[1]+" + col + "+offset+";\n    vec2 uv = uvFromFlat("+texNumR+", "+texNumC+", index);\n    return sampleTexture("+texName+", uv);\n  }\n"}function getPackedSampler3D(inputInfo){var shape=inputInfo.shapeInfo.logicalShape,texName=inputInfo.name,funcName="get"+texName.charAt(0).toUpperCase()+texName.slice(1),texShape=inputInfo.shapeInfo.texShape,packedTexShape=[Math.ceil(texShape[0]/2),Math.ceil(texShape[1]/2)];if(1===shape[0]){var squeezedShape,keptDims=[1,2],newInputInfo,params=["b","row","col"];return"\n        "+getPackedSamplerFromInInfo(squeezeInputInfo(inputInfo,shape.slice(1)))+"\n        vec4 "+funcName+"(int b, int row, int col) {\n          return "+funcName+"("+getSqueezedParams(params,keptDims)+");\n        }\n      "}var texNumR=packedTexShape[0],texNumC=packedTexShape[1],valuesPerRow=Math.ceil(shape[2]/2),texelsInBatch,glsl;return"\n    vec4 "+funcName+"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        "+texNumR+", "+texNumC+", "+valuesPerRow*Math.ceil(shape[1]/2)+", "+valuesPerRow+", b, row, col);\n      return "+glsl_version_1.getGlslDifferences().texture2D+"("+texName+", uv);\n    }\n  "}function getSampler3D(inputInfo){var shape=inputInfo.shapeInfo.logicalShape,texName=inputInfo.name,funcName="get"+texName.charAt(0).toUpperCase()+texName.slice(1),stride0=shape[1]*shape[2],stride1=shape[2],_a=util.squeezeShape(shape),newShape=_a.newShape,keptDims=_a.keptDims,squeezedShape=newShape;if(squeezedShape.length<shape.length){var newInputInfo,params=["row","col","depth"];return"\n        "+getSamplerFromInInfo(squeezeInputInfo(inputInfo,squeezedShape))+"\n        float "+funcName+"(int row, int col, int depth) {\n          return "+funcName+"("+getSqueezedParams(params,keptDims)+");\n        }\n      "}if(inputInfo.shapeInfo.isUniform)return"\n      float "+funcName+"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3("+stride0+", "+stride1+", 1)));\n        "+getUniformSampler(inputInfo)+"\n      }\n    ";var texShape=inputInfo.shapeInfo.texShape,texNumR=texShape[0],texNumC=texShape[1],flatOffset=inputInfo.shapeInfo.flatOffset,offset;return texNumC===stride0&&null==flatOffset?"\n        float "+funcName+"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2("+stride1+", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2("+texNumC+".0, "+texNumR+".0);\n          return sampleTexture("+texName+", uv);\n        }\n      ":texNumC===stride1&&null==flatOffset?"\n    float "+funcName+"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2("+shape[1]+", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+texNumC+".0, "+texNumR+".0);\n      return sampleTexture("+texName+", uv);\n    }\n  ":"\n      float "+funcName+"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * "+stride0+" + col * "+stride1+" + depth + "+getFlatOffsetUniformName(texName)+";\n        vec2 uv = uvFromFlat("+texNumR+", "+texNumC+", index);\n        return sampleTexture("+texName+", uv);\n      }\n  "}function getPackedSamplerND(inputInfo){for(var shape=inputInfo.shapeInfo.logicalShape,rank=shape.length,texName=inputInfo.name,funcName="get"+texName.charAt(0).toUpperCase()+texName.slice(1),texShape=inputInfo.shapeInfo.texShape,packedTexShape=[Math.ceil(texShape[0]/2),Math.ceil(texShape[1]/2)],texNumR=packedTexShape[0],texNumC=packedTexShape[1],valuesPerRow=Math.ceil(shape[rank-1]/2),texelsInBatch=valuesPerRow*Math.ceil(shape[rank-2]/2),params="int b, int row, int col",index="b * "+texelsInBatch+" + (row / 2) * "+valuesPerRow+" + (col / 2)",b=2;b<rank-1;b++)params="int b"+b+", "+params,index="b"+b+" * "+(texelsInBatch*=shape[rank-b-1])+" + "+index;var glsl;return"\n    vec4 "+funcName+"("+params+") {\n      int index = "+index+";\n      int texR = index / "+texNumC+";\n      int texC = index - texR * "+texNumC+";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+texNumC+", "+texNumR+");\n      return "+glsl_version_1.getGlslDifferences().texture2D+"("+texName+", uv);\n    }\n  "}function getSampler4D(inputInfo){var shape=inputInfo.shapeInfo.logicalShape,texName=inputInfo.name,funcName="get"+texName.charAt(0).toUpperCase()+texName.slice(1),stride2=shape[3],stride1=shape[2]*stride2,stride0=shape[1]*stride1,_a=util.squeezeShape(shape),newShape=_a.newShape,keptDims=_a.keptDims;if(newShape.length<shape.length){var newInputInfo,params=["row","col","depth","depth2"];return"\n      "+getSamplerFromInInfo(squeezeInputInfo(inputInfo,newShape))+"\n      float "+funcName+"(int row, int col, int depth, int depth2) {\n        return "+funcName+"("+getSqueezedParams(params,keptDims)+");\n      }\n    "}if(inputInfo.shapeInfo.isUniform)return"\n      float "+funcName+"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4("+stride0+", "+stride1+", "+stride2+", 1)));\n        "+getUniformSampler(inputInfo)+"\n      }\n    ";var flatOffset=inputInfo.shapeInfo.flatOffset,texShape=inputInfo.shapeInfo.texShape,texNumR=texShape[0],texNumC=texShape[1],offset;return texNumC===stride0&&null==flatOffset?"\n      float "+funcName+"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3("+stride1+", "+stride2+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+texNumC+".0, "+texNumR+".0);\n        return sampleTexture("+texName+", uv);\n      }\n    ":texNumC===stride2&&null==flatOffset?"\n      float "+funcName+"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3("+shape[1]*shape[2]+", "+shape[2]+", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+texNumC+".0, "+texNumR+".0);\n        return sampleTexture("+texName+", uv);\n      }\n    ":"\n    float "+funcName+"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+stride0+" + col * "+stride1+" +\n          depth * "+stride2+" + depth2;\n      vec2 uv = uvFromFlat("+texNumR+", "+texNumC+", index + "+getFlatOffsetUniformName(texName)+");\n      return sampleTexture("+texName+", uv);\n    }\n  "}function getSampler5D(inputInfo){var shape=inputInfo.shapeInfo.logicalShape,texName=inputInfo.name,funcName="get"+texName.charAt(0).toUpperCase()+texName.slice(1),stride3=shape[4],stride2=shape[3]*stride3,stride1=shape[2]*stride2,stride0=shape[1]*stride1,_a=util.squeezeShape(shape),newShape=_a.newShape,keptDims=_a.keptDims;if(newShape.length<shape.length){var newInputInfo,params=["row","col","depth","depth2","depth3"];return"\n      "+getSamplerFromInInfo(squeezeInputInfo(inputInfo,newShape))+"\n      float "+funcName+"(int row, int col, int depth, int depth2, int depth3) {\n        return "+funcName+"("+getSqueezedParams(params,keptDims)+");\n      }\n    "}if(inputInfo.shapeInfo.isUniform)return"\n      float "+funcName+"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+stride0+", "+stride1+", "+stride2+", "+stride3+")) +\n          depth3;\n        "+getUniformSampler(inputInfo)+"\n      }\n    ";var flatOffset=inputInfo.shapeInfo.flatOffset,texShape=inputInfo.shapeInfo.texShape,texNumR=texShape[0],texNumC=texShape[1],offset;return texNumC===stride0&&null==flatOffset?"\n      float "+funcName+"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4("+stride1+", "+stride2+", "+stride3+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+texNumC+".0, "+texNumR+".0);\n        return sampleTexture("+texName+", uv);\n      }\n    ":texNumC===stride3&&null==flatOffset?"\n      float "+funcName+"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+shape[1]*shape[2]*shape[3]+",\n               "+shape[2]*shape[3]+", "+shape[3]+", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+texNumC+".0, "+texNumR+".0);\n        return sampleTexture("+texName+", uv);\n      }\n    ":"\n    float "+funcName+"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+stride0+" + col * "+stride1+" + depth * "+stride2+" +\n          depth2 * "+stride3+" + depth3 + "+getFlatOffsetUniformName(texName)+";\n      vec2 uv = uvFromFlat("+texNumR+", "+texNumC+", index);\n      return sampleTexture("+texName+", uv);\n    }\n  "}function getSampler6D(inputInfo){var shape=inputInfo.shapeInfo.logicalShape,texName=inputInfo.name,funcName="get"+texName.charAt(0).toUpperCase()+texName.slice(1),_a=util.squeezeShape(shape),newShape=_a.newShape,keptDims=_a.keptDims;if(newShape.length<shape.length){var newInputInfo,params=["row","col","depth","depth2","depth3","depth4"];return"\n      "+getSamplerFromInInfo(squeezeInputInfo(inputInfo,newShape))+"\n      float "+funcName+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return "+funcName+"("+getSqueezedParams(params,keptDims)+");\n      }\n    "}var stride4=shape[5],stride3=shape[4]*stride4,stride2=shape[3]*stride3,stride1=shape[2]*stride2,stride0=shape[1]*stride1;if(inputInfo.shapeInfo.isUniform)return"\n      float "+funcName+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4("+stride0+", "+stride1+", "+stride2+", "+stride3+")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2("+stride4+", 1)));\n        "+getUniformSampler(inputInfo)+"\n      }\n    ";var flatOffset=inputInfo.shapeInfo.flatOffset,texShape=inputInfo.shapeInfo.texShape,texNumR=texShape[0],texNumC=texShape[1],offset;return texNumC===stride0&&null==flatOffset?"\n      float "+funcName+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4("+stride1+", "+stride2+", "+stride3+", "+stride4+")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+texNumC+".0, "+texNumR+".0);\n        return sampleTexture("+texName+", uv);\n      }\n    ":texNumC===stride4&&null==flatOffset?"\n      float "+funcName+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4("+shape[1]*shape[2]*shape[3]*shape[4]+",\n               "+shape[2]*shape[3]*shape[4]+",\n               "+shape[3]*shape[4]+",\n               "+shape[4]+")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+texNumC+".0, "+texNumR+".0);\n        return sampleTexture("+texName+", uv);\n      }\n    ":"\n    float "+funcName+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+stride0+" + col * "+stride1+" + depth * "+stride2+" +\n          depth2 * "+stride3+" + depth3 * "+stride4+" + depth4 + "+getFlatOffsetUniformName(texName)+";\n      vec2 uv = uvFromFlat("+texNumR+", "+texNumC+", index);\n      return sampleTexture("+texName+", uv);\n    }\n  "}function getUniformSampler(inputInfo){var texName=inputInfo.name,inSize=util.sizeFromShape(inputInfo.shapeInfo.logicalShape);return inSize<2?"return "+texName+";":"\n    for (int i = 0; i < "+inSize+"; i++) {\n      if (i == index) {\n        return "+texName+"[i];\n      }\n    }\n  "}function getPackedSamplerAtOutputCoords(inputInfo,outShapeInfo){var texName=inputInfo.name,texFuncSnippet=texName.charAt(0).toUpperCase()+texName.slice(1),funcName="get"+texFuncSnippet+"AtOutCoords",inRank=inputInfo.shapeInfo.logicalShape.length,outRank=outShapeInfo.logicalShape.length,broadcastDims=broadcast_util_1.getBroadcastDims(inputInfo.shapeInfo.logicalShape,outShapeInfo.logicalShape),type=getCoordsDataType(outRank),rankDiff=outRank-inRank,coordsSnippet,fields=["x","y","z","w","u","v"];coordsSnippet=0===inRank?"":outRank<2&&broadcastDims.length>=1?"coords = 0;":broadcastDims.map((function(d){return"coords."+fields[d+rankDiff]+" = 0;"})).join("\n");var unpackedCoordsSnippet="";unpackedCoordsSnippet=outRank<2&&inRank>0?"coords":inputInfo.shapeInfo.logicalShape.map((function(s,i){return"coords."+fields[i+rankDiff]})).join(", ");var output="return outputValue;",inSize,isInputScalar=1===util.sizeFromShape(inputInfo.shapeInfo.logicalShape),outSize,isOutputScalar=1===util.sizeFromShape(outShapeInfo.logicalShape);if(1!==inRank||isInputScalar||isOutputScalar){if(isInputScalar&&!isOutputScalar)output=1===outRank?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(broadcastDims.length){var rows=inRank-2,cols=inRank-1;broadcastDims.indexOf(rows)>-1&&broadcastDims.indexOf(cols)>-1?output="return vec4(outputValue.x);":broadcastDims.indexOf(rows)>-1?output="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":broadcastDims.indexOf(cols)>-1&&(output="return vec4(outputValue.xx, outputValue.zz);")}}else output="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return"\n    vec4 "+funcName+"() {\n      "+type+" coords = getOutputCoords();\n      "+coordsSnippet+"\n      vec4 outputValue = get"+texFuncSnippet+"("+unpackedCoordsSnippet+");\n      "+output+"\n    }\n  "}function getSamplerAtOutputCoords(inputInfo,outShapeInfo){var texName=inputInfo.name,texFuncSnippet=texName.charAt(0).toUpperCase()+texName.slice(1),funcName="get"+texFuncSnippet+"AtOutCoords",outTexShape=outShapeInfo.texShape,inTexShape=inputInfo.shapeInfo.texShape,inRank=inputInfo.shapeInfo.logicalShape.length,outRank=outShapeInfo.logicalShape.length;if(!inputInfo.shapeInfo.isUniform&&inRank===outRank&&null==inputInfo.shapeInfo.flatOffset&&util.arraysEqual(inTexShape,outTexShape))return"\n      float "+funcName+"() {\n        return sampleTexture("+texName+", resultUV);\n      }\n    ";var type=getCoordsDataType(outRank),broadcastDims=broadcast_util_1.getBroadcastDims(inputInfo.shapeInfo.logicalShape,outShapeInfo.logicalShape),rankDiff=outRank-inRank,coordsSnippet,fields=["x","y","z","w","u","v"],unpackedCoordsSnippet="";return"\n    float "+funcName+"() {\n      "+type+" coords = getOutputCoords();\n      "+(coordsSnippet=0===inRank?"":outRank<2&&broadcastDims.length>=1?"coords = 0;":broadcastDims.map((function(d){return"coords."+fields[d+rankDiff]+" = 0;"})).join("\n"))+"\n      return get"+texFuncSnippet+"("+(unpackedCoordsSnippet=outRank<2&&inRank>0?"coords":inputInfo.shapeInfo.logicalShape.map((function(s,i){return"coords."+fields[i+rankDiff]})).join(", "))+");\n    }\n  "}function getCoordsDataType(rank){if(rank<=1)return"int";if(2===rank)return"ivec2";if(3===rank)return"ivec3";if(4===rank)return"ivec4";if(5===rank)return"ivec5";if(6===rank)return"ivec6";throw Error("GPU for rank "+rank+" is not yet supported")}function squeezeInputInfo(inInfo,squeezedShape){var newInputInfo=JSON.parse(JSON.stringify(inInfo));return newInputInfo.shapeInfo.logicalShape=squeezedShape,newInputInfo}function getSqueezedParams(params,keptDims){return keptDims.map((function(d){return params[d]})).join(", ")}exports.getCoordsDataType=getCoordsDataType},{"../../ops/broadcast_util":176,"../../util":248,"./glsl_version":105,"./shader_compiler_util":134}],134:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var util=require("../../util");function getLogicalCoordinatesFromFlatIndex(coords,shape,index){void 0===index&&(index="index");var strides=util.computeStrides(shape);return strides.map((function(stride,i){var line1,line2;return"int "+coords[i]+" = "+index+" / "+stride+"; "+(i===strides.length-1?"int "+coords[i+1]+" = "+index+" - "+coords[i]+" * "+stride:"index -= "+coords[i]+" * "+stride)+";"})).join("")}function buildVec(x){return 1===x.length?""+x[0]:"vec"+x.length+"("+x.join(",")+")"}function dotify(x,y){if(x.length!==y.length)throw new Error("Vectors to be dotted must be of the same length -got "+x.length+" and "+y.length);for(var slices=[],nearestVec4=Math.floor(x.length/4),nearestVec4Remainder=x.length%4,i=0;i<nearestVec4;i++){var xSlice=x.slice(4*i,4*i+4),ySlice=y.slice(4*i,4*i+4);slices.push(buildVec(xSlice)+", "+buildVec(ySlice))}if(0!==nearestVec4Remainder){var xSlice=x.slice(4*nearestVec4),ySlice=y.slice(4*nearestVec4);1===xSlice.length&&(xSlice=xSlice.map((function(d){return"float("+d+")"})),ySlice=ySlice.map((function(d){return"float("+d+")"}))),slices.push(buildVec(xSlice)+", "+buildVec(ySlice))}return slices.map((function(d,i){return"dot("+d+")"})).join("+")}function getFlatIndexFrom3D(shape){var strides=util.computeStrides(shape).map((function(d){return d.toString()}));return"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * "+strides[0]+" + coords.y * "+strides[1]+" + coords.z;\n  }\n"}exports.getLogicalCoordinatesFromFlatIndex=getLogicalCoordinatesFromFlatIndex,exports.dotify=dotify,exports.getFlatIndexFrom3D=getFlatIndexFrom3D,exports.ENCODE_FLOAT_SNIPPET="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n"},{"../../util":248}],135:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2017 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var shader_compiler_1=require("./shader_compiler"),SliceProgram=function(){function SliceProgram(destSize){this.variableNames=["source"],this.outputShape=destSize,this.rank=destSize.length;var dtype=shader_compiler_1.getCoordsDataType(this.rank),uniformPart="uniform int start["+this.rank+"];",sourceCoords=getCoords(this.rank),body,coordSum;body="\n        "+dtype+" sourceLoc;\n        "+dtype+" coords = getOutputCoords();\n        "+destSize.map((function(_,i){return"sourceLoc."+coords[i]+" = start["+i+"] + coords."+coords[i]+";"})).join("\n")+"\n      ",this.userCode="\n      "+uniformPart+"\n      void main() {\n        "+body+"\n        setOutput(getSource("+sourceCoords+"));\n      }\n    "}return SliceProgram.prototype.getCustomSetupFunc=function(start){var _this=this;if(start.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+start.length+")");return function(gpgpu,webGLProgram){null==_this.startLoc&&(_this.startLoc=gpgpu.getUniformLocationNoThrow(webGLProgram,"start"),null==_this.startLoc)||gpgpu.gl.uniform1iv(_this.startLoc,start)}},SliceProgram}();exports.SliceProgram=SliceProgram;var coords=["x","y","z","w","u","v"];function getCoords(rank){if(1===rank)return"sourceLoc";if(rank<=6)return coords.slice(0,rank).map((function(x){return"sourceLoc."+x})).join(",");throw Error("Slicing for rank "+rank+" is not yet supported")}},{"./shader_compiler":133}],136:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2019 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var packing_util_1=require("../packing_util"),shader_compiler_1=require("./shader_compiler"),SlicePackedProgram=function(){function SlicePackedProgram(destSize){this.variableNames=["source"],this.usesPackedTextures=!0,this.outputShape=destSize,this.rank=destSize.length;var dtype=shader_compiler_1.getCoordsDataType(this.rank),coords=packing_util_1.getChannels("coords",this.rank),sourceLoc=packing_util_1.getChannels("sourceLoc",this.rank),innerDims=1===this.rank?"sourceLoc":"vec2("+sourceLoc.slice(-2).join()+")",getChannel="getChannel(getSource("+sourceLoc.join()+"), "+innerDims+")",upperRow="\n      result.x = "+getChannel+";\n      if (++"+coords[this.rank-1]+" < "+destSize[this.rank-1]+") {\n        ++"+sourceLoc[this.rank-1]+";\n        result.y = "+getChannel+";\n        --"+sourceLoc[this.rank-1]+";\n      }\n    ",lowerRow=1===this.rank?"":"\n      --"+coords[this.rank-1]+";\n      if (++"+coords[this.rank-2]+" < "+destSize[this.rank-2]+") {\n        ++"+sourceLoc[this.rank-2]+";\n        result.z = "+getChannel+";\n        if (++"+coords[this.rank-1]+" < "+destSize[this.rank-1]+") {\n          ++"+sourceLoc[this.rank-1]+";\n          result.w = "+getChannel+";\n        }\n      }\n    ",sourceLocSetup=this.rank<=4?"sourceLoc = coords +\n            "+dtype+"("+destSize.map((function(_,i){return"start["+i+"]"})).join()+");":destSize.map((function(_,i){return sourceLoc[i]+" = "+coords[i]+" + start["+i+"];"})).join("\n");this.userCode="\n      uniform int start["+this.rank+"];\n      void main() {\n        "+dtype+" coords = getOutputCoords();\n        "+dtype+" sourceLoc;\n        "+sourceLocSetup+" \n        vec4 result = vec4(0.);\n        "+upperRow+"\n        "+lowerRow+"\n        setOutput(result);\n      }\n    "}return SlicePackedProgram.prototype.getCustomSetupFunc=function(start){var _this=this;if(start.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+start.length+")");return function(gpgpu,webGLProgram){null==_this.startLoc&&(_this.startLoc=gpgpu.getUniformLocationNoThrow(webGLProgram,"start"),null==_this.startLoc)||gpgpu.gl.uniform1iv(_this.startLoc,start)}},SlicePackedProgram}();exports.SlicePackedProgram=SlicePackedProgram},{"../packing_util":62,"./shader_compiler":133}],137:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2017 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var shader_compiler_1=require("./shader_compiler"),StridedSliceProgram=function(){function StridedSliceProgram(begin,strides,size){this.variableNames=["x"],this.outputShape=size;var rank=size.length,inputDtype=shader_compiler_1.getCoordsDataType(size.length),dtype=shader_compiler_1.getCoordsDataType(size.length),newCoords="";if(1===rank)newCoords="coords * strides + begin";else{var outputAxis_1=0;newCoords=size.map((function(_,i){return outputAxis_1++,1===size.length?"coords * strides["+i+"] + begin["+i+"]":"coords["+(outputAxis_1-1)+"] * strides["+i+"] + begin["+i+"]"})).join(",")}this.userCode="\n      "+inputDtype+" begin = "+inputDtype+"("+begin+");\n      "+inputDtype+" strides = "+inputDtype+"("+strides+");\n\n      void main() {\n        "+dtype+" coords = getOutputCoords();\n        setOutput(getX("+newCoords+"));\n      }\n    "}return StridedSliceProgram}();exports.StridedSliceProgram=StridedSliceProgram},{"./shader_compiler":133}],138:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2017 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../../environment"),util=require("../../util"),TextureUsage,PhysicalTextureType;function getUnpackedMatrixTextureShapeWidthHeight(rows,columns){return[columns,rows]}function getUnpackedArraySizeFromMatrixSize(matrixSize,channelsPerTexture){return matrixSize*channelsPerTexture}function getColorMatrixTextureShapeWidthHeight(rows,columns){return[4*columns,rows]}function getDenseTexShape(shape){var size=util.sizeFromShape(shape),texelsNeeded=Math.ceil(size/4);return util.sizeToSquarishShape(texelsNeeded)}function getMatrixSizeFromUnpackedArraySize(unpackedSize,channelsPerTexture){if(unpackedSize%channelsPerTexture!=0)throw new Error("unpackedSize ("+unpackedSize+") must be a multiple of "+channelsPerTexture);return unpackedSize/channelsPerTexture}function decodeMatrixFromUnpackedColorRGBAArray(unpackedArray,matrix,channels){var requiredSize=unpackedArray.length*channels/4;if(matrix.length<requiredSize)throw new Error("matrix length ("+matrix.length+") must be >= "+requiredSize);for(var dst=0,src=0;src<unpackedArray.length;src+=4)for(var c=0;c<channels;c++)matrix[dst++]=unpackedArray[src+c]}function getPackedMatrixTextureShapeWidthHeight(rows,columns){return[Math.max(1,Math.ceil(columns/2)),Math.max(1,Math.ceil(rows/2))]}function getPackedRGBAArraySizeFromMatrixShape(rows,columns){var _a=getPackedMatrixTextureShapeWidthHeight(rows,columns),w,h;return _a[0]*_a[1]*4}function getTextureConfig(gl,textureHalfFloatExtension){var glany=gl,internalFormatFloat,internalFormatHalfFloat,internalFormatPackedHalfFloat,internalFormatPackedFloat,textureFormatFloat,downloadTextureFormat,downloadUnpackNumChannels,defaultNumChannels,textureTypeHalfFloat,textureTypeFloat;return 2===environment_1.ENV.getNumber("WEBGL_VERSION")?(internalFormatFloat=glany.R32F,internalFormatHalfFloat=glany.R16F,internalFormatPackedHalfFloat=glany.RGBA16F,internalFormatPackedFloat=glany.RGBA32F,textureFormatFloat=glany.RED,downloadUnpackNumChannels=4,defaultNumChannels=1,textureTypeHalfFloat=glany.HALF_FLOAT,textureTypeFloat=glany.FLOAT):(internalFormatFloat=gl.RGBA,internalFormatHalfFloat=gl.RGBA,internalFormatPackedHalfFloat=gl.RGBA,internalFormatPackedFloat=glany.RGBA,textureFormatFloat=gl.RGBA,downloadUnpackNumChannels=4,defaultNumChannels=4,textureTypeHalfFloat=null!=textureHalfFloatExtension?textureHalfFloatExtension.HALF_FLOAT_OES:null,textureTypeFloat=gl.FLOAT),{internalFormatFloat:internalFormatFloat,internalFormatHalfFloat:internalFormatHalfFloat,internalFormatPackedHalfFloat:internalFormatPackedHalfFloat,internalFormatPackedFloat:internalFormatPackedFloat,textureFormatFloat:textureFormatFloat,downloadTextureFormat:downloadTextureFormat=gl.RGBA,downloadUnpackNumChannels:downloadUnpackNumChannels,defaultNumChannels:defaultNumChannels,textureTypeHalfFloat:textureTypeHalfFloat,textureTypeFloat:textureTypeFloat}}!function(TextureUsage){TextureUsage[TextureUsage.RENDER=0]="RENDER",TextureUsage[TextureUsage.UPLOAD=1]="UPLOAD",TextureUsage[TextureUsage.PIXELS=2]="PIXELS",TextureUsage[TextureUsage.DOWNLOAD=3]="DOWNLOAD"}(TextureUsage=exports.TextureUsage||(exports.TextureUsage={})),function(PhysicalTextureType){PhysicalTextureType[PhysicalTextureType.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",PhysicalTextureType[PhysicalTextureType.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",PhysicalTextureType[PhysicalTextureType.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",PhysicalTextureType[PhysicalTextureType.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",PhysicalTextureType[PhysicalTextureType.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(PhysicalTextureType=exports.PhysicalTextureType||(exports.PhysicalTextureType={})),exports.getUnpackedMatrixTextureShapeWidthHeight=getUnpackedMatrixTextureShapeWidthHeight,exports.getUnpackedArraySizeFromMatrixSize=getUnpackedArraySizeFromMatrixSize,exports.getColorMatrixTextureShapeWidthHeight=getColorMatrixTextureShapeWidthHeight,exports.getDenseTexShape=getDenseTexShape,exports.getMatrixSizeFromUnpackedArraySize=getMatrixSizeFromUnpackedArraySize,exports.decodeMatrixFromUnpackedColorRGBAArray=decodeMatrixFromUnpackedColorRGBAArray,exports.getPackedMatrixTextureShapeWidthHeight=getPackedMatrixTextureShapeWidthHeight,exports.getPackedRGBAArraySizeFromMatrixShape=getPackedRGBAArraySizeFromMatrixShape,exports.getTextureConfig=getTextureConfig},{"../../environment":151,"../../util":248}],139:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2017 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../../environment"),tex_util_1=require("./tex_util"),TextureManager=function(){function TextureManager(gpgpu){this.gpgpu=gpgpu,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return TextureManager.prototype.acquireTexture=function(shapeRC,usage,isPacked){var physicalTexType=getPhysicalFromLogicalTextureType(usage,isPacked),shapeKey=getKeyFromTextureShape(shapeRC,physicalTexType,isPacked),newTexture;if(shapeKey in this.freeTextures||(this.freeTextures[shapeKey]=[]),shapeKey in this.usedTextures||(this.usedTextures[shapeKey]=[]),this.freeTextures[shapeKey].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var newTexture_1=this.freeTextures[shapeKey].shift();return this.usedTextures[shapeKey].push(newTexture_1),newTexture_1}return this.numUsedTextures++,this.log(),physicalTexType===tex_util_1.PhysicalTextureType.PACKED_2X2_FLOAT32?newTexture=this.gpgpu.createPackedMatrixTexture(shapeRC[0],shapeRC[1]):physicalTexType===tex_util_1.PhysicalTextureType.PACKED_2X2_FLOAT16?newTexture=this.gpgpu.createFloat16PackedMatrixTexture(shapeRC[0],shapeRC[1]):physicalTexType===tex_util_1.PhysicalTextureType.UNPACKED_FLOAT32?newTexture=this.gpgpu.createFloat32MatrixTexture(shapeRC[0],shapeRC[1]):physicalTexType===tex_util_1.PhysicalTextureType.UNPACKED_FLOAT16?newTexture=this.gpgpu.createFloat16MatrixTexture(shapeRC[0],shapeRC[1]):physicalTexType===tex_util_1.PhysicalTextureType.PACKED_4X1_UNSIGNED_BYTE&&(newTexture=this.gpgpu.createUnsignedBytesMatrixTexture(shapeRC[0],shapeRC[1])),this.usedTextures[shapeKey].push(newTexture),newTexture},TextureManager.prototype.releaseTexture=function(texture,shape,logicalTexType,isPacked){if(null!=this.freeTextures){var physicalTexType,shapeKey=getKeyFromTextureShape(shape,getPhysicalFromLogicalTextureType(logicalTexType,isPacked),isPacked);shapeKey in this.freeTextures||(this.freeTextures[shapeKey]=[]),this.freeTextures[shapeKey].push(texture),this.numFreeTextures++,this.numUsedTextures--;var texList=this.usedTextures[shapeKey],texIndex=texList.indexOf(texture);if(texIndex<0)throw new Error("Cannot release a texture that was never provided by this texture manager");texList.splice(texIndex,1),this.log()}},TextureManager.prototype.log=function(){if(this.logEnabled){var total=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+total+")")}},TextureManager.prototype.getNumUsedTextures=function(){return this.numUsedTextures},TextureManager.prototype.getNumFreeTextures=function(){return this.numFreeTextures},TextureManager.prototype.dispose=function(){var _this=this;if(null!=this.freeTextures){for(var texShape in this.freeTextures)this.freeTextures[texShape].forEach((function(tex){_this.gpgpu.deleteMatrixTexture(tex)}));for(var texShape in this.usedTextures)this.usedTextures[texShape].forEach((function(tex){_this.gpgpu.deleteMatrixTexture(tex)}));this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},TextureManager}();function getPhysicalTextureForRendering(isPacked){return environment_1.ENV.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?isPacked?tex_util_1.PhysicalTextureType.PACKED_2X2_FLOAT32:tex_util_1.PhysicalTextureType.UNPACKED_FLOAT32:isPacked?tex_util_1.PhysicalTextureType.PACKED_2X2_FLOAT16:tex_util_1.PhysicalTextureType.UNPACKED_FLOAT16}function getPhysicalFromLogicalTextureType(logicalTexType,isPacked){if(logicalTexType===tex_util_1.TextureUsage.UPLOAD)return tex_util_1.PhysicalTextureType.PACKED_2X2_FLOAT32;if(logicalTexType===tex_util_1.TextureUsage.RENDER||null==logicalTexType)return getPhysicalTextureForRendering(isPacked);if(logicalTexType===tex_util_1.TextureUsage.DOWNLOAD||logicalTexType===tex_util_1.TextureUsage.PIXELS)return tex_util_1.PhysicalTextureType.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+logicalTexType)}function getKeyFromTextureShape(shapeRowsCol,physicalTexType,isPacked){return shapeRowsCol[0]+"_"+shapeRowsCol[1]+"_"+physicalTexType+"_"+isPacked}exports.TextureManager=TextureManager},{"../../environment":151,"./tex_util":138}],140:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2017 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var shader_compiler_1=require("./shader_compiler"),TileProgram=function(){function TileProgram(aShape,reps){this.variableNames=["A"];for(var outputShape=new Array(aShape.length),i=0;i<outputShape.length;i++)outputShape[i]=aShape[i]*reps[i];this.outputShape=outputShape,this.rank=outputShape.length;var dtype=shader_compiler_1.getCoordsDataType(this.rank),sourceCoords=getSourceCoords(aShape);this.userCode="\n      void main() {\n        "+dtype+" resRC = getOutputCoords();\n        setOutput(getA("+sourceCoords+"));\n      }\n    "}return TileProgram}();function getSourceCoords(aShape){var rank=aShape.length;if(rank>5)throw Error("Tile for rank "+rank+" is not yet supported");if(1===rank)return"imod(resRC, "+aShape[0]+")";for(var currentCoords=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],sourceCoords=[],i=0;i<aShape.length;i++)sourceCoords.push("imod("+currentCoords[i]+", "+aShape[i]+")");return sourceCoords.join()}exports.TileProgram=TileProgram},{"./shader_compiler":133}],141:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2017 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var shader_compiler_1=require("./shader_compiler"),TransposeProgram=function(){function TransposeProgram(aShape,newDim){this.variableNames=["A"];for(var outputShape=new Array(aShape.length),i=0;i<outputShape.length;i++)outputShape[i]=aShape[newDim[i]];this.outputShape=outputShape,this.rank=outputShape.length;var dtype=shader_compiler_1.getCoordsDataType(this.rank),switched=getSwitchedCoords(newDim);this.userCode="\n    void main() {\n      "+dtype+" resRC = getOutputCoords();\n      setOutput(getA("+switched+"));\n    }\n    "}return TransposeProgram}();function getSwitchedCoords(newDim){var rank=newDim.length;if(rank>6)throw Error("Transpose for rank "+rank+" is not yet supported");for(var originalOrder=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],switchedCoords=new Array(rank),i=0;i<newDim.length;i++)switchedCoords[newDim[i]]=originalOrder[i];return switchedCoords.join()}exports.TransposeProgram=TransposeProgram},{"./shader_compiler":133}],142:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2019 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var packing_util_1=require("../packing_util"),shader_compiler_1=require("./shader_compiler"),TransposePackedProgram=function(){function TransposePackedProgram(aShape,newDim){this.variableNames=["A"],this.usesPackedTextures=!0;for(var outputShape=new Array(aShape.length),i=0;i<outputShape.length;i++)outputShape[i]=aShape[newDim[i]];if(this.outputShape=outputShape,this.rank=outputShape.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");for(var dtype=shader_compiler_1.getCoordsDataType(this.rank),outputOrder=packing_util_1.getVecChannels("rc",this.rank),switchedOrder=new Array(this.rank),i=0;i<newDim.length;i++)switchedOrder[newDim[i]]=outputOrder[i];var innerDims="vec2("+switchedOrder.slice(-2).join()+")",nextColumn="++"+outputOrder[this.rank-1]+" < "+outputShape[this.rank-1],getc="getChannel(getA("+switchedOrder.join()+"), "+innerDims+")";this.userCode="\n    void main() {\n      "+dtype+" rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = "+getc+";\n      if("+nextColumn+") {\n        result[1] = "+getc+";\n      }\n      --"+outputOrder[this.rank-1]+";\n      if(++"+outputOrder[this.rank-2]+" < "+outputShape[this.rank-2]+") {\n        result[2] = "+getc+";\n        if("+nextColumn+") {\n          result[3] = "+getc+";\n        }\n      }  \n      setOutput(result);\n    }\n    "}return TransposePackedProgram}();exports.TransposePackedProgram=TransposePackedProgram},{"../packing_util":62,"./shader_compiler":133}],143:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2017 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var erf_util=require("../../ops/erf_util"),selu_util=require("../../ops/selu_util"),UnaryOpProgram=function(){function UnaryOpProgram(aShape,opSnippet){this.variableNames=["A"],this.outputShape=aShape,this.userCode="\n      float unaryOperation(float x) {\n        "+opSnippet+"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "}return UnaryOpProgram}();exports.UnaryOpProgram=UnaryOpProgram;var CHECK_NAN_SNIPPET="if (isnan(x)) return x;";function STEP(alpha){return void 0===alpha&&(alpha=0),CHECK_NAN_SNIPPET+"\n    return x > 0.0 ? 1.0 : float("+alpha+");\n  "}exports.LINEAR="return x;",exports.ABS="return abs(x);",exports.RELU=CHECK_NAN_SNIPPET+"\n  return (x < 0.0) ? 0.0 : x;\n",exports.ELU="return (x >= 0.0) ? x : (exp(x) - 1.0);",exports.SELU="\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = "+selu_util.SELU_SCALEALPHA+";\n  float scale = "+selu_util.SELU_SCALE+";\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n",exports.STEP=STEP,exports.NEG="return -x;",exports.CEIL="return ceil(x);",exports.FLOOR="return floor(x);",exports.SIGN="\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n",exports.IS_NAN="return float(isnan(x));",exports.IS_INF="return float(isinf(x));",exports.IS_FINITE="return float(!isnan(x) && !isinf(x));",exports.ROUND="\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n",exports.EXP="return exp(x);",exports.EXPM1="return exp(x) - 1.0;",exports.LOG="if (x < 0.0) return NAN;\n  return log(x);",exports.LOG1P="return log(1.0 + x);",exports.SQRT="return sqrt(x);",exports.RSQRT="return inversesqrt(x);",exports.SIGMOID="return 1.0 / (1.0 + exp(-1.0 * x));",exports.SOFTPLUS="\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n",exports.SIN=CHECK_NAN_SNIPPET+"\n  return sin(x);\n",exports.COS=CHECK_NAN_SNIPPET+"\n  return cos(x);\n",exports.TAN="return tan(x);",exports.ASIN="return asin(x);",exports.ACOS="return acos(x);",exports.ATAN=CHECK_NAN_SNIPPET+"\n  return atan(x);\n",exports.SINH="\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n",exports.COSH="\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n",exports.TANH="\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n",exports.ASINH="return log(x + sqrt(x * x + 1.0));",exports.ACOSH=CHECK_NAN_SNIPPET+"\n  if (x < 1.0) return NAN;\n  return log(x + sqrt(x * x - 1.0));",exports.ATANH=CHECK_NAN_SNIPPET+"\n  if ((x < -1.0) || (x > 1.0)) return NAN;\n  return (log(1.0 + x) - log(1.0 - x)) / 2.0;",exports.ERF='\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = '+erf_util.ERF_P+";\n  float a1 = "+erf_util.ERF_A1+";\n  float a2 = "+erf_util.ERF_A2+";\n  float a3 = "+erf_util.ERF_A3+";\n  float a4 = "+erf_util.ERF_A4+";\n  float a5 = "+erf_util.ERF_A5+";\n\n  float t = 1.0 / (1.0 + p * x);\n  return 1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x);\n",exports.SQUARE="return x * x;",exports.RECIPROCAL="return 1.0 / x;",exports.LOGICAL_NOT="return float(!(x >= 1.0));",exports.TO_INT="return float(int(x));",exports.CLONE="return x;"},{"../../ops/erf_util":188,"../../ops/selu_util":214}],144:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0}),exports.LINEAR="return x;",exports.LOG="\n  vec4 result = log(x);\n  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));\n  result.r = isNaN.r == 1.0 ? NAN : result.r;\n  result.g = isNaN.g == 1.0 ? NAN : result.g;\n  result.b = isNaN.b == 1.0 ? NAN : result.b;\n  result.a = isNaN.a == 1.0 ? NAN : result.a;\n\n  return result;\n",exports.RELU="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",exports.ELU="\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n";var UnaryOpPackedProgram=function(){function UnaryOpPackedProgram(aShape,opSnippet){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=aShape,this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        "+opSnippet+"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "}return UnaryOpPackedProgram}();exports.UnaryOpPackedProgram=UnaryOpPackedProgram},{}],145:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var packing_util_1=require("../packing_util"),shader_compiler_1=require("./shader_compiler"),UnpackProgram=function(){function UnpackProgram(outputShape){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=outputShape;var rank=outputShape.length,channels=packing_util_1.getChannels("rc",rank),dtype=shader_compiler_1.getCoordsDataType(rank),sourceCoords=packing_util_1.getSourceCoords(rank,channels),innerDims=channels.slice(-2),coords=rank<=1?"rc":"vec2("+innerDims.join(",")+")";this.userCode="\n      void main() {\n        "+dtype+" rc = getOutputCoords();\n        vec4 packedInput = getA("+sourceCoords+");\n\n        setOutput(getChannel(packedInput, "+coords+"));\n      }\n    "}return UnpackProgram}();exports.UnpackProgram=UnpackProgram},{"../packing_util":62,"./shader_compiler":133}],146:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2017 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../../environment"),util=require("../../util"),canvas_util_1=require("./canvas_util"),tex_util_1=require("./tex_util");function callAndCheck(gl,debugMode,func){var returnValue=func();return debugMode&&checkWebGLError(gl),returnValue}function checkWebGLError(gl){var error=gl.getError();if(error!==gl.NO_ERROR)throw new Error("WebGL Error: "+getWebGLErrorMessage(gl,error))}exports.callAndCheck=callAndCheck;var MIN_FLOAT16=5.96e-8,MAX_FLOAT16=65504;function canBeRepresented(num){return!!(environment_1.ENV.getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===num||5.96e-8<Math.abs(num)&&Math.abs(num)<65504)}function getWebGLErrorMessage(gl,status){switch(status){case gl.NO_ERROR:return"NO_ERROR";case gl.INVALID_ENUM:return"INVALID_ENUM";case gl.INVALID_VALUE:return"INVALID_VALUE";case gl.INVALID_OPERATION:return"INVALID_OPERATION";case gl.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case gl.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case gl.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+status}}function getExtensionOrThrow(gl,debug,extensionName){return throwIfNull(gl,debug,(function(){return gl.getExtension(extensionName)}),'Extension "'+extensionName+'" not supported on this browser.')}function createVertexShader(gl,debug,vertexShaderSource){var vertexShader=throwIfNull(gl,debug,(function(){return gl.createShader(gl.VERTEX_SHADER)}),"Unable to create vertex WebGLShader.");if(callAndCheck(gl,debug,(function(){return gl.shaderSource(vertexShader,vertexShaderSource)})),callAndCheck(gl,debug,(function(){return gl.compileShader(vertexShader)})),!1===gl.getShaderParameter(vertexShader,gl.COMPILE_STATUS))throw console.log(gl.getShaderInfoLog(vertexShader)),new Error("Failed to compile vertex shader.");return vertexShader}function createFragmentShader(gl,debug,fragmentShaderSource){var fragmentShader=throwIfNull(gl,debug,(function(){return gl.createShader(gl.FRAGMENT_SHADER)}),"Unable to create fragment WebGLShader.");if(callAndCheck(gl,debug,(function(){return gl.shaderSource(fragmentShader,fragmentShaderSource)})),callAndCheck(gl,debug,(function(){return gl.compileShader(fragmentShader)})),!1===gl.getShaderParameter(fragmentShader,gl.COMPILE_STATUS))throw logShaderSourceAndInfoLog(fragmentShaderSource,gl.getShaderInfoLog(fragmentShader)),new Error("Failed to compile fragment shader.");return fragmentShader}exports.canBeRepresented=canBeRepresented,exports.getWebGLErrorMessage=getWebGLErrorMessage,exports.getExtensionOrThrow=getExtensionOrThrow,exports.createVertexShader=createVertexShader,exports.createFragmentShader=createFragmentShader;var lineNumberRegex=/ERROR: [0-9]+:([0-9]+):/g,MAX_TEXTURE_SIZE,MAX_TEXTURES_IN_SHADER;function logShaderSourceAndInfoLog(shaderSource,shaderInfoLog){var lineNumberRegexResult=lineNumberRegex.exec(shaderInfoLog);if(null==lineNumberRegexResult)return console.log("Couldn't parse line number in error: "+shaderInfoLog),void console.log(shaderSource);for(var lineNumber=+lineNumberRegexResult[1],shaderLines=shaderSource.split("\n"),pad=shaderLines.length.toString().length+2,linesWithLineNumbers=shaderLines.map((function(line,lineNumber){return util.rightPad((lineNumber+1).toString(),pad)+line})),maxLineLength=0,i=0;i<linesWithLineNumbers.length;i++)maxLineLength=Math.max(linesWithLineNumbers[i].length,maxLineLength);var beforeErrorLines=linesWithLineNumbers.slice(0,lineNumber-1),errorLine=linesWithLineNumbers.slice(lineNumber-1,lineNumber),afterErrorLines=linesWithLineNumbers.slice(lineNumber);console.log(beforeErrorLines.join("\n")),console.log(shaderInfoLog.split("\n")[0]),console.log("%c "+util.rightPad(errorLine[0],maxLineLength),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(afterErrorLines.join("\n"))}function createProgram(gl,debug){return throwIfNull(gl,debug,(function(){return gl.createProgram()}),"Unable to create WebGLProgram.")}function linkProgram(gl,debug,program){if(callAndCheck(gl,debug,(function(){return gl.linkProgram(program)})),!1===gl.getProgramParameter(program,gl.LINK_STATUS))throw console.log(gl.getProgramInfoLog(program)),new Error("Failed to link vertex and fragment shaders.")}function validateProgram(gl,debug,program){if(callAndCheck(gl,debug,(function(){return gl.validateProgram(program)})),!1===gl.getProgramParameter(program,gl.VALIDATE_STATUS))throw console.log(gl.getProgramInfoLog(program)),new Error("Shader program validation failed.")}function createStaticVertexBuffer(gl,debug,data){var buffer=throwIfNull(gl,debug,(function(){return gl.createBuffer()}),"Unable to create WebGLBuffer");return callAndCheck(gl,debug,(function(){return gl.bindBuffer(gl.ARRAY_BUFFER,buffer)})),callAndCheck(gl,debug,(function(){return gl.bufferData(gl.ARRAY_BUFFER,data,gl.STATIC_DRAW)})),buffer}function createStaticIndexBuffer(gl,debug,data){var buffer=throwIfNull(gl,debug,(function(){return gl.createBuffer()}),"Unable to create WebGLBuffer");return callAndCheck(gl,debug,(function(){return gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,buffer)})),callAndCheck(gl,debug,(function(){return gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,data,gl.STATIC_DRAW)})),buffer}function getNumChannels(){return 2===environment_1.ENV.getNumber("WEBGL_VERSION")?1:4}function createTexture(gl,debug){return throwIfNull(gl,debug,(function(){return gl.createTexture()}),"Unable to create WebGLTexture.")}function validateTextureSize(width,height){var maxTextureSize=environment_1.ENV.getNumber("WEBGL_MAX_TEXTURE_SIZE");if(width<=0||height<=0){var requested="["+width+"x"+height+"]";throw new Error("Requested texture size "+requested+" is invalid.")}if(width>maxTextureSize||height>maxTextureSize){var requested="["+width+"x"+height+"]",max;throw new Error("Requested texture size "+requested+" greater than WebGL maximum on this browser / GPU "+("["+maxTextureSize+"x"+maxTextureSize+"]")+".")}}function createFramebuffer(gl,debug){return throwIfNull(gl,debug,(function(){return gl.createFramebuffer()}),"Unable to create WebGLFramebuffer.")}function bindVertexBufferToProgramAttribute(gl,debug,program,attribute,buffer,arrayEntriesPerItem,itemStrideInBytes,itemOffsetInBytes){var loc=gl.getAttribLocation(program,attribute);return-1!==loc&&(callAndCheck(gl,debug,(function(){return gl.bindBuffer(gl.ARRAY_BUFFER,buffer)})),callAndCheck(gl,debug,(function(){return gl.vertexAttribPointer(loc,arrayEntriesPerItem,gl.FLOAT,!1,itemStrideInBytes,itemOffsetInBytes)})),callAndCheck(gl,debug,(function(){return gl.enableVertexAttribArray(loc)})),!0)}function bindTextureUnit(gl,debug,texture,textureUnit){validateTextureUnit(gl,textureUnit),callAndCheck(gl,debug,(function(){return gl.activeTexture(gl.TEXTURE0+textureUnit)})),callAndCheck(gl,debug,(function(){return gl.bindTexture(gl.TEXTURE_2D,texture)}))}function unbindTextureUnit(gl,debug,textureUnit){validateTextureUnit(gl,textureUnit),callAndCheck(gl,debug,(function(){return gl.activeTexture(gl.TEXTURE0+textureUnit)})),callAndCheck(gl,debug,(function(){return gl.bindTexture(gl.TEXTURE_2D,null)}))}function getProgramUniformLocationOrThrow(gl,debug,program,uniformName){return throwIfNull(gl,debug,(function(){return gl.getUniformLocation(program,uniformName)}),'uniform "'+uniformName+'" not present in program.')}function getProgramUniformLocation(gl,program,uniformName){return gl.getUniformLocation(program,uniformName)}function bindTextureToProgramUniformSampler(gl,debug,program,texture,uniformSamplerLocation,textureUnit){callAndCheck(gl,debug,(function(){return bindTextureUnit(gl,debug,texture,textureUnit)})),callAndCheck(gl,debug,(function(){return gl.uniform1i(uniformSamplerLocation,textureUnit)}))}function bindCanvasToFramebuffer(gl,debug){callAndCheck(gl,debug,(function(){return gl.bindFramebuffer(gl.FRAMEBUFFER,null)})),callAndCheck(gl,debug,(function(){return gl.viewport(0,0,gl.canvas.width,gl.canvas.height)})),callAndCheck(gl,debug,(function(){return gl.scissor(0,0,gl.canvas.width,gl.canvas.height)}))}function bindColorTextureToFramebuffer(gl,debug,texture,framebuffer){callAndCheck(gl,debug,(function(){return gl.bindFramebuffer(gl.FRAMEBUFFER,framebuffer)})),callAndCheck(gl,debug,(function(){return gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,texture,0)}))}function unbindColorTextureFromFramebuffer(gl,debug,framebuffer){callAndCheck(gl,debug,(function(){return gl.bindFramebuffer(gl.FRAMEBUFFER,framebuffer)})),callAndCheck(gl,debug,(function(){return gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,null,0)}))}function validateFramebuffer(gl){var status=gl.checkFramebufferStatus(gl.FRAMEBUFFER);if(status!==gl.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+getFramebufferErrorMessage(gl,status))}function getFramebufferErrorMessage(gl,status){switch(status){case gl.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case gl.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case gl.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case gl.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+status}}function throwIfNull(gl,debug,returnTOrNull,failureMessage){var tOrNull=callAndCheck(gl,debug,(function(){return returnTOrNull()}));if(null==tOrNull)throw new Error(failureMessage);return tOrNull}function validateTextureUnit(gl,textureUnit){var maxTextureUnit=gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,glTextureUnit=textureUnit+gl.TEXTURE0,textureUnitRange;if(glTextureUnit<gl.TEXTURE0||glTextureUnit>maxTextureUnit)throw new Error("textureUnit must be in "+("[gl.TEXTURE0, gl.TEXTURE"+maxTextureUnit+"]")+".")}function getBatchDim(shape,dimsToSkip){return void 0===dimsToSkip&&(dimsToSkip=2),util.sizeFromShape(shape.slice(0,shape.length-dimsToSkip))}function getRowsCols(shape){if(0===shape.length)throw Error("Cannot get rows and columns of an empty shape array.");return[shape.length>1?shape[shape.length-2]:1,shape[shape.length-1]]}function getShapeAs3D(shape){var shapeAs3D=[1,1,1],isScalar;return 0===shape.length||1===shape.length&&1===shape[0]||(shapeAs3D=[getBatchDim(shape)].concat(getRowsCols(shape))),shapeAs3D}function getTextureShapeFromLogicalShape(logShape,isPacked){var _a;void 0===isPacked&&(isPacked=!1);var maxTexSize=environment_1.ENV.getNumber("WEBGL_MAX_TEXTURE_SIZE");if(isPacked&&(maxTexSize*=2,1===(logShape=logShape.map((function(d,i){return i>=logShape.length-2?util.nearestLargerEven(logShape[i]):logShape[i]}))).length&&(logShape=[2,logShape[0]])),2!==logShape.length){var squeezeResult=util.squeezeShape(logShape);logShape=squeezeResult.newShape}var size=util.sizeFromShape(logShape);if(logShape.length<=1&&size<=maxTexSize)return[1,size];if(2===logShape.length&&logShape[0]<=maxTexSize&&logShape[1]<=maxTexSize)return logShape;if(3===logShape.length&&logShape[0]*logShape[1]<=maxTexSize&&logShape[2]<=maxTexSize)return[logShape[0]*logShape[1],logShape[2]];if(3===logShape.length&&logShape[0]<=maxTexSize&&logShape[1]*logShape[2]<=maxTexSize)return[logShape[0],logShape[1]*logShape[2]];if(4===logShape.length&&logShape[0]*logShape[1]*logShape[2]<=maxTexSize&&logShape[3]<=maxTexSize)return[logShape[0]*logShape[1]*logShape[2],logShape[3]];if(4===logShape.length&&logShape[0]<=maxTexSize&&logShape[1]*logShape[2]*logShape[3]<=maxTexSize)return[logShape[0],logShape[1]*logShape[2]*logShape[3]];if(isPacked){var batchDim=getBatchDim(logShape),rows=2,cols=2;return logShape.length&&(rows=(_a=getRowsCols(logShape))[0],cols=_a[1]),size=batchDim*(rows/2)*(cols/2),util.sizeToSquarishShape(size).map((function(d){return 2*d}))}return util.sizeToSquarishShape(size)}function isEven(n){return n%2==0}function isReshapeFree(shape1,shape2){if(shape1=shape1.slice(-2),shape2=shape2.slice(-2),util.arraysEqual(shape1,shape2))return!0;if(!shape1.length||!shape2.length)return!0;if(0===shape1[0]||0===shape1[1]||0===shape2[0]||0===shape2[1])return!0;if(shape1.length!==shape2.length){var shape1Cols=shape1.slice(-1)[0],shape2Cols=shape2.slice(-1)[0];if(shape1Cols===shape2Cols)return!0;if(isEven(shape1Cols)&&isEven(shape2Cols)&&(1===shape1[0]||1===shape2[0]))return!0}return shape1[1]===shape2[1]&&isEven(shape1[0])&&isEven(shape2[0])}function getWebGLMaxTextureSize(webGLVersion){if(null==MAX_TEXTURE_SIZE){var gl=canvas_util_1.getWebGLContext(webGLVersion);MAX_TEXTURE_SIZE=gl.getParameter(gl.MAX_TEXTURE_SIZE)}return MAX_TEXTURE_SIZE}function resetMaxTextureSize(){MAX_TEXTURE_SIZE=null}function resetMaxTexturesInShader(){MAX_TEXTURES_IN_SHADER=null}function getMaxTexturesInShader(webGLVersion){if(null==MAX_TEXTURES_IN_SHADER){var gl=canvas_util_1.getWebGLContext(webGLVersion);MAX_TEXTURES_IN_SHADER=gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,MAX_TEXTURES_IN_SHADER)}function getWebGLDisjointQueryTimerVersion(webGLVersion){if(0===webGLVersion)return 0;var queryTimerVersion,gl=canvas_util_1.getWebGLContext(webGLVersion);return queryTimerVersion=hasExtension(gl,"EXT_disjoint_timer_query_webgl2")&&2===webGLVersion?2:hasExtension(gl,"EXT_disjoint_timer_query")?1:0}function hasExtension(gl,extensionName){var ext;return null!=gl.getExtension(extensionName)}function isWebGLVersionEnabled(webGLVersion){try{var gl;if(null!=canvas_util_1.getWebGLContext(webGLVersion))return!0}catch(e){return!1}return!1}function isCapableOfRenderingToFloatTexture(webGLVersion){if(0===webGLVersion)return!1;var gl=canvas_util_1.getWebGLContext(webGLVersion),isFrameBufferComplete;if(1===webGLVersion){if(!hasExtension(gl,"OES_texture_float"))return!1}else if(!hasExtension(gl,"EXT_color_buffer_float"))return!1;return createFloatTextureAndBindToFramebuffer(gl)}function isDownloadFloatTextureEnabled(webGLVersion){if(0===webGLVersion)return!1;var gl=canvas_util_1.getWebGLContext(webGLVersion),isFrameBufferComplete;if(1!==webGLVersion){if(hasExtension(gl,"EXT_color_buffer_float"))return createFloatTextureAndBindToFramebuffer(gl);var COLOR_BUFFER_HALF_FLOAT="EXT_color_buffer_half_float";if(hasExtension(gl,COLOR_BUFFER_HALF_FLOAT)){var textureHalfFloatExtension=gl.getExtension(COLOR_BUFFER_HALF_FLOAT);return createHalfFloatTextureAndBindToFramebuffer(gl,textureHalfFloatExtension)}return!1}return!!hasExtension(gl,"OES_texture_float")&&(!!hasExtension(gl,"WEBGL_color_buffer_float")&&createFloatTextureAndBindToFramebuffer(gl))}function createFloatTextureAndBindToFramebuffer(gl){var texConfig=tex_util_1.getTextureConfig(gl),texture=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,texture);var width=1,height=1;gl.texImage2D(gl.TEXTURE_2D,0,texConfig.internalFormatFloat,1,1,0,texConfig.textureFormatFloat,texConfig.textureTypeFloat,null);var frameBuffer=gl.createFramebuffer();gl.bindFramebuffer(gl.FRAMEBUFFER,frameBuffer),gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,texture,0);var isFrameBufferComplete=gl.checkFramebufferStatus(gl.FRAMEBUFFER)===gl.FRAMEBUFFER_COMPLETE;return gl.bindTexture(gl.TEXTURE_2D,null),gl.bindFramebuffer(gl.FRAMEBUFFER,null),gl.deleteTexture(texture),gl.deleteFramebuffer(frameBuffer),isFrameBufferComplete}function createHalfFloatTextureAndBindToFramebuffer(gl,textureHalfFloatExtension){var texConfig=tex_util_1.getTextureConfig(gl,textureHalfFloatExtension),texture=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,texture);var width=1,height=1;gl.texImage2D(gl.TEXTURE_2D,0,texConfig.internalFormatHalfFloat,1,1,0,texConfig.textureFormatFloat,texConfig.textureTypeHalfFloat,null);var frameBuffer=gl.createFramebuffer();gl.bindFramebuffer(gl.FRAMEBUFFER,frameBuffer),gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,texture,0);var isFrameBufferComplete=gl.checkFramebufferStatus(gl.FRAMEBUFFER)===gl.FRAMEBUFFER_COMPLETE;return gl.bindTexture(gl.TEXTURE_2D,null),gl.bindFramebuffer(gl.FRAMEBUFFER,null),gl.deleteTexture(texture),gl.deleteFramebuffer(frameBuffer),isFrameBufferComplete}function isWebGLFenceEnabled(webGLVersion){return 2===webGLVersion&&null!=canvas_util_1.getWebGLContext(webGLVersion).fenceSync;var gl,isEnabled}exports.createProgram=createProgram,exports.linkProgram=linkProgram,exports.validateProgram=validateProgram,exports.createStaticVertexBuffer=createStaticVertexBuffer,exports.createStaticIndexBuffer=createStaticIndexBuffer,exports.getNumChannels=getNumChannels,exports.createTexture=createTexture,exports.validateTextureSize=validateTextureSize,exports.createFramebuffer=createFramebuffer,exports.bindVertexBufferToProgramAttribute=bindVertexBufferToProgramAttribute,exports.bindTextureUnit=bindTextureUnit,exports.unbindTextureUnit=unbindTextureUnit,exports.getProgramUniformLocationOrThrow=getProgramUniformLocationOrThrow,exports.getProgramUniformLocation=getProgramUniformLocation,exports.bindTextureToProgramUniformSampler=bindTextureToProgramUniformSampler,exports.bindCanvasToFramebuffer=bindCanvasToFramebuffer,exports.bindColorTextureToFramebuffer=bindColorTextureToFramebuffer,exports.unbindColorTextureFromFramebuffer=unbindColorTextureFromFramebuffer,exports.validateFramebuffer=validateFramebuffer,exports.getFramebufferErrorMessage=getFramebufferErrorMessage,exports.getBatchDim=getBatchDim,exports.getRowsCols=getRowsCols,exports.getShapeAs3D=getShapeAs3D,exports.getTextureShapeFromLogicalShape=getTextureShapeFromLogicalShape,exports.isReshapeFree=isReshapeFree,exports.getWebGLMaxTextureSize=getWebGLMaxTextureSize,exports.resetMaxTextureSize=resetMaxTextureSize,exports.resetMaxTexturesInShader=resetMaxTexturesInShader,exports.getMaxTexturesInShader=getMaxTexturesInShader,exports.getWebGLDisjointQueryTimerVersion=getWebGLDisjointQueryTimerVersion,exports.hasExtension=hasExtension,exports.isWebGLVersionEnabled=isWebGLVersionEnabled,exports.isCapableOfRenderingToFloatTexture=isCapableOfRenderingToFloatTexture,exports.isDownloadFloatTextureEnabled=isDownloadFloatTextureEnabled,exports.isWebGLFenceEnabled=isWebGLFenceEnabled},{"../../environment":151,"../../util":248,"./canvas_util":77,"./tex_util":138}],147:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var array_ops_1=require("../ops/array_ops");function whereImpl(condShape,condVals){for(var indices=[],i=0;i<condVals.length;i++)condVals[i]&&indices.push(i);for(var inBuffer=array_ops_1.buffer(condShape,"int32"),out=array_ops_1.buffer([indices.length,condShape.length],"int32"),i=0;i<indices.length;i++){var loc=inBuffer.indexToLoc(indices[i]),offset=i*condShape.length;out.values.set(loc,offset)}return out.toTensor()}exports.whereImpl=whereImpl},{"../ops/array_ops":170}],148:[function(require,module,exports){(function(setImmediate){(function(){"use strict";
/**
 * @license
 * Copyright 2017 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var delayCallback="undefined"!=typeof requestAnimationFrame?requestAnimationFrame:void 0!==setImmediate?setImmediate:function(f){return f()};function nextFrame(){return new Promise((function(resolve){return delayCallback((function(){return resolve()}))}))}exports.nextFrame=nextFrame}).call(this)}).call(this,require("timers").setImmediate)},{timers:587}],149:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2017 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function isMobile(){var a=navigator.userAgent||navigator.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4))}function isBrowser(){return"undefined"!=typeof window&&null!=window.document||"undefined"!=typeof WorkerGlobalScope}Object.defineProperty(exports,"__esModule",{value:!0}),exports.isMobile=isMobile,exports.isBrowser=isBrowser},{}],150:[function(require,module,exports){(function(process,global){(function(){"use strict";
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P((function(resolve){resolve(result.value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},__generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}};Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("./environment"),profiler_1=require("./profiler"),tape_1=require("./tape"),tensor_1=require("./tensor"),tensor_util_1=require("./tensor_util"),util=require("./util"),util_1=require("./util"),EngineState=function(){function EngineState(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return EngineState.prototype.dispose=function(){for(var variableName in this.registeredVariables)this.registeredVariables[variableName].dispose()},EngineState}(),Engine=function(){function Engine(ENV){this.ENV=ENV,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new EngineState}return Engine.prototype.ready=function(){return __awaiter(this,void 0,void 0,(function(){var sortedBackends,i,backendName,success;return __generator(this,(function(_a){switch(_a.label){case 0:if(null!=this.pendingBackendInit)return[2,this.pendingBackendInit.then((function(){}))];if(null!=this.backendInstance)return[2];sortedBackends=this.getSortedBackends(),i=0,_a.label=1;case 1:return i<sortedBackends.length?(backendName=sortedBackends[i],[4,this.initializeBackend(backendName).success]):[3,5];case 2:return(success=_a.sent())?[4,this.setBackend(backendName)]:[3,4];case 3:return _a.sent(),[2];case 4:return i++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}}))}))},Object.defineProperty(Engine.prototype,"backend",{get:function(){if(null!=this.pendingBackendInit)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() before calling other methods");if(null==this.backendInstance){var _a=this.initializeBackendsAndReturnBest(),name_1=_a.name,asyncInit;if(_a.asyncInit)throw new Error("The highest priority backend '"+name_1+"' has not yet been initialized. Make sure to await tf.ready() before calling other methods");this.setBackend(name_1)}return this.backendInstance},enumerable:!0,configurable:!0}),Engine.prototype.backendNames=function(){return Object.keys(this.registryFactory)},Engine.prototype.findBackend=function(backendName){if(!(backendName in this.registry)){if(!(backendName in this.registryFactory))return null;var asyncInit;if(this.initializeBackend(backendName).asyncInit)return null}return this.registry[backendName]},Engine.prototype.findBackendFactory=function(backendName){return backendName in this.registryFactory?this.registryFactory[backendName].factory:null},Engine.prototype.registerBackend=function(backendName,factory,priority){return void 0===priority&&(priority=1),backendName in this.registryFactory?(console.warn(backendName+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[backendName]={factory:factory,priority:priority},!0)},Engine.prototype.setBackend=function(backendName){return __awaiter(this,void 0,void 0,(function(){var _a,success,asyncInit,result,_b;return __generator(this,(function(_c){switch(_c.label){case 0:if(null==this.registryFactory[backendName])throw new Error("Backend name '"+backendName+"' not found in registry");return this.backendName=backendName,null!=this.registry[backendName]?[3,4]:(this.backendInstance=null,_a=this.initializeBackend(backendName),success=_a.success,(asyncInit=_a.asyncInit)?[4,success]:[3,2]);case 1:return _b=_c.sent(),[3,3];case 2:_b=success,_c.label=3;case 3:if(!(result=_b))return[2,!1];_c.label=4;case 4:return this.backendInstance=this.registry[backendName],this.profiler=new profiler_1.Profiler(this.backendInstance),[2,!0]}}))}))},Engine.prototype.initializeBackend=function(backendName){var _this=this,registryFactoryEntry=this.registryFactory[backendName];if(null==registryFactoryEntry)throw new Error("Cannot initialize backend "+backendName+", no registration found.");try{var backend=registryFactoryEntry.factory();if(Promise.resolve(backend)===backend){var promiseId_1=++this.pendingBackendInitId,success=backend.then((function(backendInstance){return!(promiseId_1<_this.pendingBackendInitId)&&(_this.registry[backendName]=backendInstance,_this.pendingBackendInit=null,!0)})).catch((function(err){return!(promiseId_1<_this.pendingBackendInitId)&&(_this.pendingBackendInit=null,console.warn("Initialization of backend "+backendName+" failed"),console.warn(err.stack||err.message),!1)}));return this.pendingBackendInit=success,{success:success,asyncInit:!0}}return this.registry[backendName]=backend,{success:!0,asyncInit:!1}}catch(err){return console.warn("Initialization of backend "+backendName+" failed"),console.warn(err.stack||err.message),{success:!1,asyncInit:!1}}},Engine.prototype.removeBackend=function(backendName){if(!(backendName in this.registryFactory))throw new Error(backendName+" backend not found in registry");this.backendName===backendName&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,backendName in this.registry&&(this.registry[backendName].dispose(),delete this.registry[backendName]),delete this.registryFactory[backendName],this.backendName===backendName&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},Engine.prototype.getSortedBackends=function(){var _this=this;if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((function(a,b){return _this.registryFactory[b].priority-_this.registryFactory[a].priority}))},Engine.prototype.initializeBackendsAndReturnBest=function(){for(var sortedBackends=this.getSortedBackends(),i=0;i<sortedBackends.length;i++){var backendName=sortedBackends[i],_a=this.initializeBackend(backendName),success=_a.success,asyncInit=_a.asyncInit;if(asyncInit||success)return{name:backendName,asyncInit:asyncInit}}throw new Error("Could not initialize any backends, all backend initializations failed.")},Engine.prototype.moveData=function(destBackend,dataId){this.write(destBackend,dataId,this.readSync(dataId))},Engine.prototype.tidy=function(nameOrFn,fn){var _this=this,name=null,result;if(null==fn){if("function"!=typeof nameOrFn)throw new Error("Please provide a function to tidy()");fn=nameOrFn}else{if("string"!=typeof nameOrFn&&!(nameOrFn instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof fn)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");name=nameOrFn}return this.scopedRun((function(){return _this.startScope(name)}),(function(){return _this.endScope(result)}),(function(){return(result=fn())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),result}))},Engine.prototype.scopedRun=function(start,end,f){start();try{var res=f();return end(),res}catch(ex){throw end(),ex}},Engine.prototype.nextTensorId=function(){return Engine.nextTensorId++},Engine.prototype.nextVariableId=function(){return Engine.nextVariableId++},Engine.prototype.clone=function(x){var y=tensor_1.Tensor.make(x.shape,{dataId:x.dataId},x.dtype);return this.addTapeNode([x],y,(function(dy){return[dy.toFloat()]})),y},Engine.prototype.runKernel=function(forwardFunc,inputs,backwardsFunc){var _this=this,result,saved=[],isTapeOn=this.isTapeOn(),scopeName=null!=this.state.activeScope?this.state.activeScope.name:"",saveFunc=function(tensors){isTapeOn&&(saved=tensors.map((function(tensor){return _this.keep(_this.clone(tensor))})))},startingBytecount=this.state.numBytes,startingNumTensors=this.state.numTensors;if(this.scopedRun((function(){return _this.state.kernelDepth++}),(function(){return _this.state.kernelDepth--}),(function(){result=_this.ENV.getBool("DEBUG")?_this.profiler.profileKernel(scopeName,inputs,(function(){return forwardFunc(_this.backend,saveFunc)})):forwardFunc(_this.backend,saveFunc)})),isTapeOn){var tapeNode={id:this.state.nextTapeNodeId++,name:scopeName,inputs:inputs,outputs:Array.isArray(result)?result:[result],saved:saved};null!=backwardsFunc&&(tapeNode.gradient=function(dy){return backwardsFunc(dy,saved)}),this.state.activeTape.push(tapeNode)}return this.state.profiling&&this.state.activeProfile.kernels.push({name:scopeName,bytesAdded:this.state.numBytes-startingBytecount,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-startingNumTensors,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(inputs).map((function(key){return inputs[key].shape})),outputShape:Array.isArray(result)?result.map((function(item){return item.shape})):result.shape}),result},Engine.prototype.registerTensor=function(a,backend){var refCount=this.state.tensorInfo.has(a.dataId)?this.state.tensorInfo.get(a.dataId).refCount:0;if(this.state.numTensors++,"string"===a.dtype&&this.state.numStringTensors++,0===refCount){this.state.numDataBuffers++;var bytes=0;"complex64"!==a.dtype&&"string"!==a.dtype&&(bytes=a.size*util.bytesPerElement(a.dtype)),this.state.tensorInfo.set(a.dataId,{backend:null!=backend?backend:this.backend,dtype:a.dtype,shape:a.shape,bytes:bytes,refCount:0}),this.state.numBytes+=bytes,null!=backend?backend.register(a.dataId,a.shape,a.dtype):this.backend.register(a.dataId,a.shape,a.dtype)}this.state.tensorInfo.get(a.dataId).refCount++,a instanceof tensor_1.Variable||this.track(a)},Engine.prototype.registerVariable=function(v){if(null!=this.state.registeredVariables[v.name])throw new Error("Variable with name "+v.name+" was already registered");this.state.registeredVariables[v.name]=v},Engine.prototype.disposeTensor=function(a){if(this.state.tensorInfo.has(a.dataId)){this.state.numTensors--,"string"===a.dtype&&this.state.numStringTensors--;var info=this.state.tensorInfo.get(a.dataId),refCount;info.refCount<=1?("complex64"!==a.dtype&&(this.state.numBytes-=info.bytes),this.state.numDataBuffers--,info.backend.disposeData(a.dataId),this.state.tensorInfo.delete(a.dataId)):this.state.tensorInfo.get(a.dataId).refCount--}},Engine.prototype.disposeVariables=function(){for(var varName in this.state.registeredVariables){var v=this.state.registeredVariables[varName];this.disposeVariable(v)}},Engine.prototype.disposeVariable=function(v){this.disposeTensor(v),null!=this.state.registeredVariables[v.name]&&delete this.state.registeredVariables[v.name]},Engine.prototype.memory=function(){var info=this.backend.memory();return info.numTensors=this.state.numTensors,info.numDataBuffers=this.state.numDataBuffers,info.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(info.unreliable=!0,null==info.reasons&&(info.reasons=[]),info.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),info},Engine.prototype.profile=function(query){return __awaiter(this,void 0,void 0,(function(){var startBytes,startNumTensors;return __generator(this,(function(_a){return this.state.profiling=!0,startBytes=this.state.numBytes,startNumTensors=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=query(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map((function(d){return d.totalBytesSnapshot}))),this.state.activeProfile.newBytes=this.state.numBytes-startBytes,this.state.activeProfile.newTensors=this.state.numTensors-startNumTensors,[2,this.state.activeProfile]}))}))},Engine.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&0===this.state.kernelDepth},Engine.prototype.addTapeNode=function(inputs,result,gradientsFunc){var inputsMap={};inputs.forEach((function(input,idx){inputsMap[idx]=input}));var gradient=function(dy){var res=gradientsFunc(dy),resMap={};return res.forEach((function(r,idx){resMap[idx]=function(){return r}})),resMap},tapeNode={id:this.state.nextTapeNodeId++,name:this.state.activeScope.name,inputs:inputsMap,outputs:[result],gradient:gradient};this.state.activeTape.push(tapeNode)},Engine.prototype.keep=function(result){return result.kept=!0,result},Engine.prototype.startTape=function(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++},Engine.prototype.endTape=function(){this.state.gradientDepth--},Engine.prototype.startScope=function(name){var scopeInfo={track:[],name:"unnamed scope",id:this.state.nextScopeId++};name&&(scopeInfo.name=name),this.state.scopeStack.push(scopeInfo),this.state.activeScope=scopeInfo},Engine.prototype.endScope=function(result){for(var _this=this,tensorsToTrackInParent=tensor_util_1.getTensorsInContainer(result),tensorsToTrackInParentSet=new Set(tensorsToTrackInParent.map((function(t){return t.id}))),i=0;i<this.state.activeScope.track.length;i++){var tensor=this.state.activeScope.track[i];tensor.kept||tensorsToTrackInParentSet.has(tensor.id)||tensor.dispose()}var oldScope=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],tensorsToTrackInParent.forEach((function(tensor){tensor.kept||tensor.scopeId!==oldScope.id||_this.track(tensor)}))},Engine.prototype.gradients=function(f,xs,dy,allowNoGradients){var _this=this;if(void 0===allowNoGradients&&(allowNoGradients=!1),util.assert(xs.length>0,(function(){return"gradients() received an empty list of xs."})),null!=dy&&"float32"!==dy.dtype)throw new Error("dy must have 'float32' dtype, but has '"+dy.dtype+"'");var y=this.scopedRun((function(){return _this.startTape()}),(function(){return _this.endTape()}),(function(){return _this.tidy("forward",f)}));util.assert(y instanceof tensor_1.Tensor,(function(){return"The result y returned by f() must be a tensor."}));var filteredTape=tape_1.getFilteredNodesXToY(this.state.activeTape,xs,y);if(!allowNoGradients&&0===filteredTape.length&&xs.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(function(){var accumulatedGradientMap={};accumulatedGradientMap[y.id]=null==dy?ones(y.shape):dy,tape_1.backpropagateGradients(accumulatedGradientMap,filteredTape,(function(f){return _this.tidy(f)}));var grads=xs.map((function(x){return accumulatedGradientMap[x.id]}));return 0===_this.state.gradientDepth&&(_this.state.activeTape.forEach((function(node){for(var key in node.saved)node.saved[key].dispose()})),_this.state.activeTape=null),{value:y,grads:grads}}))},Engine.prototype.customGrad=function(f){var _this=this;return util.assert(util.isFunction(f),(function(){return"The f passed in customGrad(f) must be a function."})),function(){for(var inputs=[],_i=0,res;_i<arguments.length;_i++)inputs[_i]=arguments[_i];util.assert(inputs.every((function(t){return t instanceof tensor_1.Tensor})),(function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"}));var inputMap={};return inputs.forEach((function(input,i){inputMap[i]=input})),_this.runKernel((function(_,save){return res=f.apply(void 0,inputs.concat([save])),util.assert(res.value instanceof tensor_1.Tensor,(function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"})),util.assert(util.isFunction(res.gradFunc),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."})),res.value}),inputMap,(function(dy,saved){var gradRes=res.gradFunc(dy,saved),grads=Array.isArray(gradRes)?gradRes:[gradRes];util.assert(grads.length===inputs.length,(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."})),util.assert(grads.every((function(t){return t instanceof tensor_1.Tensor})),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."}));var gradMap={};return grads.forEach((function(grad,i){gradMap[i]=function(){return grad}})),gradMap}))}},Engine.prototype.write=function(destBackend,dataId,values){var info=this.state.tensorInfo.get(dataId),srcBackend=info.backend;if(destBackend=destBackend||this.backend,"string"===info.dtype){var newBytes=util_1.bytesFromStringArray(values);this.state.numBytes+=newBytes-info.bytes,info.bytes=newBytes}destBackend!==srcBackend&&(srcBackend.disposeData(dataId),info.backend=destBackend,destBackend.register(dataId,info.shape,info.dtype)),destBackend.write(dataId,values)},Engine.prototype.readSync=function(dataId){var info;return this.state.tensorInfo.get(dataId).backend.readSync(dataId)},Engine.prototype.read=function(dataId){var info;return this.state.tensorInfo.get(dataId).backend.read(dataId)},Engine.prototype.fromPixels=function(pixels,numChannels){return this.backend.fromPixels(pixels,numChannels)},Engine.prototype.time=function(query){return __awaiter(this,void 0,void 0,(function(){var start,timingInfo;return __generator(this,(function(_a){switch(_a.label){case 0:return start=util_1.now(),[4,this.backend.time(query)];case 1:return(timingInfo=_a.sent()).wallMs=util_1.now()-start,[2,timingInfo]}}))}))},Engine.prototype.track=function(result){return null!=this.state.activeScope&&(result.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(result)),result},Object.defineProperty(Engine.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),Engine.prototype.reset=function(){for(var backendName in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new EngineState,this.registry)this.registry[backendName].dispose(),delete this.registry[backendName];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},Engine.nextTensorId=0,Engine.nextVariableId=0,Engine}(),GLOBAL;function ones(shape){var values=util_1.makeOnesTypedArray(util_1.sizeFromShape(shape),"float32");return tensor_1.Tensor.make(shape,{values:values})}function getGlobalNamespace(){if(null==GLOBAL){var ns=void 0;if("undefined"!=typeof window)ns=window;else if(void 0!==global)ns=global;else if(void 0!==process)ns=process;else{if("undefined"==typeof self)throw new Error("Could not find a global object");ns=self}GLOBAL=ns}return GLOBAL}function getOrMakeEngine(){var ns=getGlobalNamespace();if(null==ns._tfengine){var environment=new environment_1.Environment(ns);ns._tfengine=new Engine(environment)}return environment_1.setEnvironmentGlobal(ns._tfengine.ENV),tensor_1.setTensorTracker((function(){return ns._tfengine})),ns._tfengine}exports.Engine=Engine,exports.ENGINE=getOrMakeEngine()}).call(this)}).call(this,require("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./environment":151,"./profiler":238,"./tape":240,"./tensor":241,"./tensor_util":243,"./util":248,_process:422}],151:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2017 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var TENSORFLOWJS_FLAGS_PREFIX="tfjsflags",Environment=function(){function Environment(global){this.global=global,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return Environment.prototype.setPlatform=function(platformName,platform){null!=this.platform&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+platform+"."),this.platformName=platformName,this.platform=platform},Environment.prototype.registerFlag=function(flagName,evaluationFn,setHook){if(this.flagRegistry[flagName]={evaluationFn:evaluationFn,setHook:setHook},null!=this.urlFlags[flagName]){var flagValue=this.urlFlags[flagName];console.warn("Setting feature override from URL "+flagName+": "+flagValue+"."),this.set(flagName,flagValue)}},Environment.prototype.get=function(flagName){return flagName in this.flags?this.flags[flagName]:(this.flags[flagName]=this.evaluateFlag(flagName),this.flags[flagName])},Environment.prototype.getNumber=function(flagName){return this.get(flagName)},Environment.prototype.getBool=function(flagName){return this.get(flagName)},Environment.prototype.getFlags=function(){return this.flags},Object.defineProperty(Environment.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),Environment.prototype.set=function(flagName,value){if(null==this.flagRegistry[flagName])throw new Error("Cannot set flag "+flagName+" as it has not been registered.");this.flags[flagName]=value,null!=this.flagRegistry[flagName].setHook&&this.flagRegistry[flagName].setHook(value)},Environment.prototype.evaluateFlag=function(flagName){if(null==this.flagRegistry[flagName])throw new Error("Cannot evaluate flag '"+flagName+"': no evaluation function found.");return this.flagRegistry[flagName].evaluationFn()},Environment.prototype.setFlags=function(flags){this.flags=Object.assign({},flags)},Environment.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},Environment.prototype.populateURLFlags=function(){var _this=this;if(void 0!==this.global&&void 0!==this.global.location&&void 0!==this.global.location.search){var urlParams=getQueryParams(this.global.location.search),keyValues;if("tfjsflags"in urlParams)urlParams.tfjsflags.split(",").forEach((function(keyValue){var _a=keyValue.split(":"),key=_a[0],value=_a[1];_this.urlFlags[key]=parseValue(key,value)}))}},Environment}();function getQueryParams(queryString){var params={};return queryString.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(function(s){for(var t=[],_i=1;_i<arguments.length;_i++)t[_i-1]=arguments[_i];return decodeParam(params,t[0],t[1]),t.join("=")})),params}function decodeParam(params,name,value){params[decodeURIComponent(name)]=decodeURIComponent(value||"")}function parseValue(flagName,value){if("true"===(value=value.toLowerCase())||"false"===value)return"true"===value;if(""+ +value===value)return+value;throw new Error("Could not parse value flag value "+value+" for flag "+flagName+".")}function setEnvironmentGlobal(environment){exports.ENV=environment}exports.Environment=Environment,exports.getQueryParams=getQueryParams,exports.ENV=null,exports.setEnvironmentGlobal=setEnvironmentGlobal},{}],152:[function(require,module,exports){(function(process){(function(){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});
/**
 * @license
 * Copyright 2019 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
var device_util=require("./device_util"),environment_1=require("./environment");environment_1.ENV.registerFlag("DEBUG",(function(){return!1}),(function(debugValue){debugValue&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),environment_1.ENV.registerFlag("IS_BROWSER",(function(){return device_util.isBrowser()})),environment_1.ENV.registerFlag("IS_NODE",(function(){return void 0!==process&&void 0!==process.versions&&void 0!==process.versions.node})),environment_1.ENV.registerFlag("IS_CHROME",(function(){return"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)})),environment_1.ENV.registerFlag("PROD",(function(){return!1})),environment_1.ENV.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(function(){return environment_1.ENV.getBool("DEBUG")})),environment_1.ENV.registerFlag("DEPRECATION_WARNINGS_ENABLED",(function(){return!0})),environment_1.ENV.registerFlag("IS_TEST",(function(){return!1}))}).call(this)}).call(this,require("_process"))},{"./device_util":149,"./environment":151,_process:422}],153:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("./engine"),environment_1=require("./environment"),tensor_1=require("./tensor"),tensor_util_1=require("./tensor_util");function enableProdMode(){environment_1.ENV.set("PROD",!0)}function enableDebugMode(){environment_1.ENV.set("DEBUG",!0)}function disableDeprecationWarnings(){environment_1.ENV.set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")}function deprecationWarn(msg){environment_1.ENV.getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(msg+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function disposeVariables(){engine_1.ENGINE.disposeVariables()}function memory(){return engine_1.ENGINE.memory()}function profile(f){return engine_1.ENGINE.profile(f)}function tidy(nameOrFn,fn){return engine_1.ENGINE.tidy(nameOrFn,fn)}function dispose(container){var tensors;tensor_util_1.getTensorsInContainer(container).forEach((function(tensor){return tensor.dispose()}))}function keep(result){return engine_1.ENGINE.keep(result)}function time(f){return engine_1.ENGINE.time(f)}function setBackend(backendName){return engine_1.ENGINE.setBackend(backendName)}function ready(){return engine_1.ENGINE.ready()}function getBackend(){return engine_1.ENGINE.backendName}function removeBackend(name){engine_1.ENGINE.removeBackend(name)}function findBackend(name){return engine_1.ENGINE.findBackend(name)}function findBackendFactory(name){return engine_1.ENGINE.findBackendFactory(name)}function registerBackend(name,factory,priority){return void 0===priority&&(priority=1),engine_1.ENGINE.registerBackend(name,factory,priority)}function backend(){return engine_1.ENGINE.backend}function setPlatform(platformName,platform){environment_1.ENV.setPlatform(platformName,platform)}exports.enableProdMode=enableProdMode,exports.enableDebugMode=enableDebugMode,exports.disableDeprecationWarnings=disableDeprecationWarnings,exports.deprecationWarn=deprecationWarn,tensor_1.setDeprecationWarningFn(deprecationWarn),exports.disposeVariables=disposeVariables,exports.memory=memory,exports.profile=profile,exports.tidy=tidy,exports.dispose=dispose,exports.keep=keep,exports.time=time,exports.setBackend=setBackend,exports.ready=ready,exports.getBackend=getBackend,exports.removeBackend=removeBackend,exports.findBackend=findBackend,exports.findBackendFactory=findBackendFactory,exports.registerBackend=registerBackend,exports.backend=backend,exports.setPlatform=setPlatform},{"./engine":150,"./environment":151,"./tensor":241,"./tensor_util":243}],154:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("./engine"),tensor_1=require("./tensor"),tensor_util_env_1=require("./tensor_util_env"),util=require("./util");function grad(f){return util.assert(util.isFunction(f),(function(){return"The f passed in grad(f) must be a function"})),function(x,dy){var $x=tensor_util_env_1.convertToTensor(x,"x","tf.grad",null),$dy=null!=dy?tensor_util_env_1.convertToTensor(dy,"dy","tf.grad"):null;return engine_1.ENGINE.tidy((function(){var _a=engine_1.ENGINE.gradients((function(){return f($x)}),[$x],$dy),value=_a.value,grads=_a.grads;return null!=$dy&&util.assertShapesMatch(value.shape,$dy.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),checkGrads(grads),grads[0]}))}}function grads(f){return util.assert(util.isFunction(f),(function(){return"The f passed in grads(f) must be a function"})),function(args,dy){util.assert(Array.isArray(args),(function(){return"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s"}));var $args=tensor_util_env_1.convertToTensorArray(args,"args","tf.grads",null),$dy=null!=dy?tensor_util_env_1.convertToTensor(dy,"dy","tf.grads"):null;return engine_1.ENGINE.tidy((function(){var _a=engine_1.ENGINE.gradients((function(){return f.apply(void 0,$args)}),$args,$dy),value=_a.value,grads=_a.grads;return null!=$dy&&util.assertShapesMatch(value.shape,$dy.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),checkGrads(grads),grads}))}}function valueAndGrad(f){return util.assert(util.isFunction(f),(function(){return"The f passed in valueAndGrad(f) must be a function"})),function(x,dy){util.assert(x instanceof tensor_1.Tensor,(function(){return"The x passed in valueAndGrad(f)(x) must be a tensor"})),util.assert(null==dy||dy instanceof tensor_1.Tensor,(function(){return"The dy passed in valueAndGrad(f)(x, dy) must be a tensor"}));var _a=engine_1.ENGINE.gradients((function(){return f(x)}),[x],dy),grads=_a.grads,value=_a.value;return checkGrads(grads),{grad:grads[0],value:value}}}function valueAndGrads(f){return util.assert(util.isFunction(f),(function(){return"The f passed in valueAndGrads(f) must be a function"})),function(args,dy){util.assert(Array.isArray(args)&&args.every((function(arg){return arg instanceof tensor_1.Tensor})),(function(){return"The args passed in valueAndGrads(f)(args) must be array of tensors"})),util.assert(null==dy||dy instanceof tensor_1.Tensor,(function(){return"The dy passed in valueAndGrads(f)(args, dy) must be a tensor"}));var res=engine_1.ENGINE.gradients((function(){return f.apply(void 0,args)}),args,dy);return null!=dy&&util.assertShapesMatch(res.value.shape,dy.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),checkGrads(res.grads),res}}function variableGrads(f,varList){util.assert(util.isFunction(f),(function(){return"The f passed in variableGrads(f) must be a function"})),util.assert(null==varList||Array.isArray(varList)&&varList.every((function(v){return v instanceof tensor_1.Variable})),(function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"}));var specifiedVarList=null!=varList;if(!specifiedVarList)for(var varName in varList=[],engine_1.ENGINE.registeredVariables)varList.push(engine_1.ENGINE.registeredVariables[varName]);var specifiedNonTrainable=specifiedVarList?varList.filter((function(variable){return!variable.trainable})):null,originalVarCount=varList.length;varList=varList.filter((function(variable){return variable.trainable})),util.assert(varList.length>0,(function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+originalVarCount+" variables is trainable."}));var allowNoGradients=!0,_a=engine_1.ENGINE.gradients(f,varList,null,!0),value=_a.value,grads=_a.grads;util.assert(grads.some((function(g){return null!=g})),(function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."})),util.assert(0===value.rank,(function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+value.rank+" tensor"}));var namedGrads={};return varList.forEach((function(v,i){null!=grads[i]&&(namedGrads[v.name]=grads[i])})),null!=specifiedNonTrainable&&specifiedNonTrainable.forEach((function(v){return namedGrads[v.name]=null})),{value:value,grads:namedGrads}}function customGrad(f){return engine_1.ENGINE.customGrad(f)}function checkGrads(grads){var numNullGradients;if(grads.filter((function(g){return null==g})).length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that\n    the f you passed encloses all operations that lead from x to y.")}exports.grad=grad,exports.grads=grads,exports.valueAndGrad=valueAndGrad,exports.valueAndGrads=valueAndGrads,exports.variableGrads=variableGrads,exports.customGrad=customGrad},{"./engine":150,"./tensor":241,"./tensor_util_env":244,"./util":248}],155:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2017 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function __export(m){for(var p in m)exports.hasOwnProperty(p)||(exports[p]=m[p])}Object.defineProperty(exports,"__esModule",{value:!0}),require("./engine"),require("./flags"),require("./backends/webgl/backend_webgl"),require("./backends/cpu/backend_cpu"),require("./platforms/platform_browser"),require("./platforms/platform_node");var backend_util=require("./backends/backend_util");exports.backend_util=backend_util;var environment=require("./environment");exports.environment=environment;var io=require("./io/io");exports.io=io;var math=require("./math");exports.math=math;var browser=require("./ops/browser");exports.browser=browser;var serialization=require("./serialization");exports.serialization=serialization;var tensor_1=require("./tensor"),tensor_util=require("./tensor_util");exports.tensor_util=tensor_util;var test_util=require("./test_util");exports.test_util=test_util;var util=require("./util");exports.util=util;var version_1=require("./version");exports.version_core=version_1.version;var webgl=require("./webgl");exports.webgl=webgl;var adadelta_optimizer_1=require("./optimizers/adadelta_optimizer");exports.AdadeltaOptimizer=adadelta_optimizer_1.AdadeltaOptimizer;var adagrad_optimizer_1=require("./optimizers/adagrad_optimizer");exports.AdagradOptimizer=adagrad_optimizer_1.AdagradOptimizer;var adam_optimizer_1=require("./optimizers/adam_optimizer");exports.AdamOptimizer=adam_optimizer_1.AdamOptimizer;var adamax_optimizer_1=require("./optimizers/adamax_optimizer");exports.AdamaxOptimizer=adamax_optimizer_1.AdamaxOptimizer;var momentum_optimizer_1=require("./optimizers/momentum_optimizer");exports.MomentumOptimizer=momentum_optimizer_1.MomentumOptimizer;var optimizer_1=require("./optimizers/optimizer");exports.Optimizer=optimizer_1.Optimizer;var rmsprop_optimizer_1=require("./optimizers/rmsprop_optimizer");exports.RMSPropOptimizer=rmsprop_optimizer_1.RMSPropOptimizer;var sgd_optimizer_1=require("./optimizers/sgd_optimizer");exports.SGDOptimizer=sgd_optimizer_1.SGDOptimizer;var tensor_2=require("./tensor");exports.Tensor=tensor_2.Tensor,exports.TensorBuffer=tensor_2.TensorBuffer,exports.variable=tensor_2.variable,exports.Variable=tensor_2.Variable;var types_1=require("./types");exports.Rank=types_1.Rank,__export(require("./ops/ops"));var loss_ops_1=require("./ops/loss_ops");exports.Reduction=loss_ops_1.Reduction,__export(require("./train")),__export(require("./globals"));var gradients_1=require("./gradients");exports.customGrad=gradients_1.customGrad,exports.grad=gradients_1.grad,exports.grads=gradients_1.grads,exports.valueAndGrad=gradients_1.valueAndGrad,exports.valueAndGrads=gradients_1.valueAndGrads,exports.variableGrads=gradients_1.variableGrads;var environment_1=require("./environment");exports.ENV=environment_1.ENV,exports.Environment=environment_1.Environment;var browser_util_1=require("./browser_util");exports.nextFrame=browser_util_1.nextFrame;var backend_1=require("./backends/backend");exports.KernelBackend=backend_1.KernelBackend,exports.DataStorage=backend_1.DataStorage;var ops=require("./ops/ops");tensor_1.setOpHandler(ops)},{"./backends/backend":57,"./backends/backend_util":58,"./backends/cpu/backend_cpu":60,"./backends/webgl/backend_webgl":71,"./browser_util":148,"./engine":150,"./environment":151,"./flags":152,"./globals":153,"./gradients":154,"./io/io":159,"./math":169,"./ops/browser":177,"./ops/loss_ops":196,"./ops/ops":203,"./optimizers/adadelta_optimizer":227,"./optimizers/adagrad_optimizer":228,"./optimizers/adam_optimizer":229,"./optimizers/adamax_optimizer":230,"./optimizers/momentum_optimizer":231,"./optimizers/optimizer":232,"./optimizers/rmsprop_optimizer":234,"./optimizers/sgd_optimizer":235,"./platforms/platform_browser":236,"./platforms/platform_node":237,"./serialization":239,"./tensor":241,"./tensor_util":243,"./test_util":245,"./train":246,"./types":247,"./util":248,"./version":249,"./webgl":250}],156:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P((function(resolve){resolve(result.value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},__generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}};Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../environment"),io_utils_1=require("./io_utils"),router_registry_1=require("./router_registry"),DEFAULT_FILE_NAME_PREFIX="model",DEFAULT_JSON_EXTENSION_NAME=".json",DEFAULT_WEIGHT_DATA_EXTENSION_NAME=".weights.bin";function defer(f){return new Promise((function(resolve){return setTimeout(resolve)})).then(f)}var BrowserDownloads=function(){function BrowserDownloads(fileNamePrefix){if(!environment_1.ENV.getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");fileNamePrefix.startsWith(BrowserDownloads.URL_SCHEME)&&(fileNamePrefix=fileNamePrefix.slice(BrowserDownloads.URL_SCHEME.length)),null!=fileNamePrefix&&0!==fileNamePrefix.length||(fileNamePrefix="model"),this.modelTopologyFileName=fileNamePrefix+".json",this.weightDataFileName=fileNamePrefix+".weights.bin"}return BrowserDownloads.prototype.save=function(modelArtifacts){return __awaiter(this,void 0,void 0,(function(){var weightsURL,weightsManifest,modelTopologyAndWeightManifest,modelTopologyAndWeightManifestURL,jsonAnchor_1,weightDataAnchor_1;return __generator(this,(function(_a){switch(_a.label){case 0:if("undefined"==typeof document)throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(weightsURL=window.URL.createObjectURL(new Blob([modelArtifacts.weightData],{type:"application/octet-stream"})),!(modelArtifacts.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return weightsManifest=[{paths:["./"+this.weightDataFileName],weights:modelArtifacts.weightSpecs}],modelTopologyAndWeightManifest={modelTopology:modelArtifacts.modelTopology,format:modelArtifacts.format,generatedBy:modelArtifacts.generatedBy,convertedBy:modelArtifacts.convertedBy,weightsManifest:weightsManifest},modelTopologyAndWeightManifestURL=window.URL.createObjectURL(new Blob([JSON.stringify(modelTopologyAndWeightManifest)],{type:"application/json"})),(jsonAnchor_1=null==this.jsonAnchor?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,jsonAnchor_1.href=modelTopologyAndWeightManifestURL,[4,defer((function(){return jsonAnchor_1.dispatchEvent(new MouseEvent("click"))}))];case 2:return _a.sent(),null==modelArtifacts.weightData?[3,4]:((weightDataAnchor_1=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,weightDataAnchor_1.href=weightsURL,[4,defer((function(){return weightDataAnchor_1.dispatchEvent(new MouseEvent("click"))}))]);case 3:_a.sent(),_a.label=4;case 4:return[2,{modelArtifactsInfo:io_utils_1.getModelArtifactsInfoForJSON(modelArtifacts)}]}}))}))},BrowserDownloads.URL_SCHEME="downloads://",BrowserDownloads}();exports.BrowserDownloads=BrowserDownloads;var BrowserFiles=function(){function BrowserFiles(files){if(null==files||files.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+files);this.files=files}return BrowserFiles.prototype.load=function(){return __awaiter(this,void 0,void 0,(function(){var jsonFile,weightFiles,_this=this;return __generator(this,(function(_a){return jsonFile=this.files[0],weightFiles=this.files.slice(1),[2,new Promise((function(resolve,reject){var jsonReader=new FileReader;jsonReader.onload=function(event){var modelJSON=JSON.parse(event.target.result),modelTopology=modelJSON.modelTopology;if(null!=modelTopology){0===weightFiles.length&&resolve({modelTopology:modelTopology});var weightsManifest=modelJSON.weightsManifest;if(null!=weightsManifest){var pathToFile;try{pathToFile=_this.checkManifestAndWeightFiles(weightsManifest,weightFiles)}catch(err){return void reject(err)}var weightSpecs=[],paths=[],perFileBuffers=[];weightsManifest.forEach((function(weightsGroup){weightsGroup.paths.forEach((function(path){paths.push(path),perFileBuffers.push(null)})),weightSpecs.push.apply(weightSpecs,weightsGroup.weights)})),weightsManifest.forEach((function(weightsGroup){weightsGroup.paths.forEach((function(path){var weightFileReader=new FileReader;weightFileReader.onload=function(event){var weightData=event.target.result,index=paths.indexOf(path);perFileBuffers[index]=weightData,-1===perFileBuffers.indexOf(null)&&resolve({modelTopology:modelTopology,weightSpecs:weightSpecs,weightData:io_utils_1.concatenateArrayBuffers(perFileBuffers)})},weightFileReader.onerror=function(error){return reject("Failed to weights data from file of path '"+path+"'.")},weightFileReader.readAsArrayBuffer(pathToFile[path])}))}))}else reject(new Error("weightManifest field is missing from file "+jsonFile.name))}else reject(new Error("modelTopology field is missing from file "+jsonFile.name))},jsonReader.onerror=function(error){return reject("Failed to read model topology and weights manifest JSON from file '"+jsonFile.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},jsonReader.readAsText(jsonFile)}))]}))}))},BrowserFiles.prototype.checkManifestAndWeightFiles=function(manifest,files){for(var basenames=[],fileNames=files.map((function(file){return io_utils_1.basename(file.name)})),pathToFile={},_i=0,manifest_1=manifest;_i<manifest_1.length;_i++){var group;manifest_1[_i].paths.forEach((function(path){var pathBasename=io_utils_1.basename(path);if(-1!==basenames.indexOf(pathBasename))throw new Error("Duplicate file basename found in weights manifest: '"+pathBasename+"'");if(basenames.push(pathBasename),-1===fileNames.indexOf(pathBasename))throw new Error("Weight file with basename '"+pathBasename+"' is not provided.");pathToFile[path]=files[fileNames.indexOf(pathBasename)]}))}if(basenames.length!==files.length)throw new Error("Mismatch in the number of files in weights manifest ("+basenames.length+") and the number of weight files provided ("+files.length+").");return pathToFile},BrowserFiles}();function browserDownloads(fileNamePrefix){return void 0===fileNamePrefix&&(fileNamePrefix="model"),new BrowserDownloads(fileNamePrefix)}function browserFiles(files){return new BrowserFiles(files)}exports.browserDownloadsRouter=function(url){return environment_1.ENV.getBool("IS_BROWSER")&&!Array.isArray(url)&&url.startsWith(BrowserDownloads.URL_SCHEME)?browserDownloads(url.slice(BrowserDownloads.URL_SCHEME.length)):null},router_registry_1.IORouterRegistry.registerSaveRouter(exports.browserDownloadsRouter),exports.browserDownloads=browserDownloads,exports.browserFiles=browserFiles},{"../environment":151,"./io_utils":160,"./router_registry":165}],157:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P((function(resolve){resolve(result.value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},__generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}};Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../environment"),util_1=require("../util"),io_utils_1=require("./io_utils"),router_registry_1=require("./router_registry"),weights_loader_1=require("./weights_loader"),OCTET_STREAM_MIME_TYPE="application/octet-stream",JSON_TYPE="application/json",HTTPRequest=function(){function HTTPRequest(path,loadOptions){if(this.DEFAULT_METHOD="POST",null==loadOptions&&(loadOptions={}),this.weightPathPrefix=loadOptions.weightPathPrefix,this.onProgress=loadOptions.onProgress,null!=loadOptions.fetchFunc?(util_1.assert("function"==typeof loadOptions.fetchFunc,(function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"})),this.fetch=loadOptions.fetchFunc):this.fetch=environment_1.ENV.platform.fetch,util_1.assert(null!=path&&path.length>0,(function(){return"URL path for http must not be null, undefined or empty."})),Array.isArray(path)&&util_1.assert(2===path.length,(function(){return"URL paths for http must have a length of 2, (actual length is "+path.length+")."})),this.path=path,null!=loadOptions.requestInit&&null!=loadOptions.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=loadOptions.requestInit||{}}return HTTPRequest.prototype.save=function(modelArtifacts){return __awaiter(this,void 0,void 0,(function(){var init,weightsManifest,modelTopologyAndWeightManifest,response;return __generator(this,(function(_a){switch(_a.label){case 0:if(modelArtifacts.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(init=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,weightsManifest=[{paths:["./model.weights.bin"],weights:modelArtifacts.weightSpecs}],modelTopologyAndWeightManifest={modelTopology:modelArtifacts.modelTopology,format:modelArtifacts.format,generatedBy:modelArtifacts.generatedBy,convertedBy:modelArtifacts.convertedBy,weightsManifest:weightsManifest},init.body.append("model.json",new Blob([JSON.stringify(modelTopologyAndWeightManifest)],{type:JSON_TYPE}),"model.json"),null!=modelArtifacts.weightData&&init.body.append("model.weights.bin",new Blob([modelArtifacts.weightData],{type:OCTET_STREAM_MIME_TYPE}),"model.weights.bin"),[4,this.fetch(this.path,init)];case 1:if((response=_a.sent()).ok)return[2,{modelArtifactsInfo:io_utils_1.getModelArtifactsInfoForJSON(modelArtifacts),responses:[response]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+response.status+".")}}))}))},HTTPRequest.prototype.load=function(){return __awaiter(this,void 0,void 0,(function(){var modelConfigRequest,modelConfig,e_1,message,modelTopology,weightsManifest,weightSpecs,weightData,results;return __generator(this,(function(_a){switch(_a.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(modelConfigRequest=_a.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+modelConfigRequest.status+". Please verify this URL points to the model JSON of the model to load.");_a.label=2;case 2:return _a.trys.push([2,4,,5]),[4,modelConfigRequest.json()];case 3:return modelConfig=_a.sent(),[3,5];case 4:throw e_1=_a.sent(),message="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?message+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":message+=" Please make sure the server is serving valid JSON for this request.",new Error(message);case 5:if(modelTopology=modelConfig.modelTopology,weightsManifest=modelConfig.weightsManifest,null==modelTopology&&null==weightsManifest)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return null==weightsManifest?[3,7]:[4,this.loadWeights(weightsManifest)];case 6:results=_a.sent(),weightSpecs=results[0],weightData=results[1],_a.label=7;case 7:return[2,{modelTopology:modelTopology,weightSpecs:weightSpecs,weightData:weightData}]}}))}))},HTTPRequest.prototype.loadWeights=function(weightsManifest){return __awaiter(this,void 0,void 0,(function(){var weightPath,_a,prefix,suffix,pathPrefix,weightSpecs,_i,weightsManifest_1,entry,fetchURLs,buffers;return __generator(this,(function(_b){switch(_b.label){case 0:for(weightPath=Array.isArray(this.path)?this.path[1]:this.path,_a=parseUrl(weightPath),prefix=_a[0],suffix=_a[1],pathPrefix=this.weightPathPrefix||prefix,weightSpecs=[],_i=0,weightsManifest_1=weightsManifest;_i<weightsManifest_1.length;_i++)entry=weightsManifest_1[_i],weightSpecs.push.apply(weightSpecs,entry.weights);return fetchURLs=[],weightsManifest.forEach((function(weightsGroup){weightsGroup.paths.forEach((function(path){fetchURLs.push(pathPrefix+path+suffix)}))})),[4,weights_loader_1.loadWeightsAsArrayBuffer(fetchURLs,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return buffers=_b.sent(),[2,[weightSpecs,io_utils_1.concatenateArrayBuffers(buffers)]]}}))}))},HTTPRequest.URL_SCHEME_REGEX=/^https?:\/\//,HTTPRequest}();function parseUrl(url){var lastSlash=url.lastIndexOf("/"),lastSearchParam=url.lastIndexOf("?"),prefix,suffix;return[url.substring(0,lastSlash)+"/",lastSearchParam>lastSlash?url.substring(lastSearchParam):""]}function isHTTPScheme(url){return null!=url.match(HTTPRequest.URL_SCHEME_REGEX)}function http(path,loadOptions){return new HTTPRequest(path,loadOptions)}function browserHTTPRequest(path,loadOptions){return http(path,loadOptions)}exports.HTTPRequest=HTTPRequest,exports.parseUrl=parseUrl,exports.isHTTPScheme=isHTTPScheme,exports.httpRouter=function(url,onProgress){if("undefined"==typeof fetch)return null;var isHTTP=!0;return(isHTTP=Array.isArray(url)?url.every((function(urlItem){return isHTTPScheme(urlItem)})):isHTTPScheme(url))?http(url,{onProgress:onProgress}):null},router_registry_1.IORouterRegistry.registerSaveRouter(exports.httpRouter),router_registry_1.IORouterRegistry.registerLoadRouter(exports.httpRouter),exports.http=http,exports.browserHTTPRequest=browserHTTPRequest},{"../environment":151,"../util":248,"./io_utils":160,"./router_registry":165,"./weights_loader":167}],158:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P((function(resolve){resolve(result.value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},__generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}};Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../environment"),io_utils_1=require("./io_utils"),model_management_1=require("./model_management"),router_registry_1=require("./router_registry"),DATABASE_NAME="tensorflowjs",DATABASE_VERSION=1,MODEL_STORE_NAME="models_store",INFO_STORE_NAME="model_info_store";function deleteDatabase(){return __awaiter(this,void 0,void 0,(function(){var idbFactory;return __generator(this,(function(_a){return idbFactory=getIndexedDBFactory(),[2,new Promise((function(resolve,reject){var deleteRequest=idbFactory.deleteDatabase(DATABASE_NAME);deleteRequest.onsuccess=function(){return resolve()},deleteRequest.onerror=function(error){return reject(error)}}))]}))}))}function getIndexedDBFactory(){if(!environment_1.ENV.getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var theWindow=window,factory=theWindow.indexedDB||theWindow.mozIndexedDB||theWindow.webkitIndexedDB||theWindow.msIndexedDB||theWindow.shimIndexedDB;if(null==factory)throw new Error("The current browser does not appear to support IndexedDB.");return factory}function setUpDatabase(openRequest){var db=openRequest.result;db.createObjectStore("models_store",{keyPath:"modelPath"}),db.createObjectStore(INFO_STORE_NAME,{keyPath:"modelPath"})}exports.deleteDatabase=deleteDatabase;var BrowserIndexedDB=function(){function BrowserIndexedDB(modelPath){if(this.indexedDB=getIndexedDBFactory(),null==modelPath||!modelPath)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=modelPath}return BrowserIndexedDB.prototype.save=function(modelArtifacts){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(_a){if(modelArtifacts.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,modelArtifacts)]}))}))},BrowserIndexedDB.prototype.load=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(_a){return[2,this.databaseAction(this.modelPath)]}))}))},BrowserIndexedDB.prototype.databaseAction=function(modelPath,modelArtifacts){var _this=this;return new Promise((function(resolve,reject){var openRequest=_this.indexedDB.open(DATABASE_NAME,1);openRequest.onupgradeneeded=function(){return setUpDatabase(openRequest)},openRequest.onsuccess=function(){var db=openRequest.result;if(null==modelArtifacts){var modelTx=db.transaction("models_store","readonly"),modelStore,getRequest_1=modelTx.objectStore("models_store").get(_this.modelPath);getRequest_1.onsuccess=function(){if(null==getRequest_1.result)return db.close(),reject(new Error("Cannot find model with path '"+_this.modelPath+"' in IndexedDB."));resolve(getRequest_1.result.modelArtifacts)},getRequest_1.onerror=function(error){return db.close(),reject(getRequest_1.error)},modelTx.oncomplete=function(){return db.close()}}else{var modelArtifactsInfo_1=io_utils_1.getModelArtifactsInfoForJSON(modelArtifacts),infoTx_1=db.transaction(INFO_STORE_NAME,"readwrite"),infoStore_1=infoTx_1.objectStore(INFO_STORE_NAME),putInfoRequest_1=infoStore_1.put({modelPath:_this.modelPath,modelArtifactsInfo:modelArtifactsInfo_1}),modelTx_1;putInfoRequest_1.onsuccess=function(){var modelStore,putModelRequest=(modelTx_1=db.transaction("models_store","readwrite")).objectStore("models_store").put({modelPath:_this.modelPath,modelArtifacts:modelArtifacts,modelArtifactsInfo:modelArtifactsInfo_1});putModelRequest.onsuccess=function(){return resolve({modelArtifactsInfo:modelArtifactsInfo_1})},putModelRequest.onerror=function(error){var deleteInfoRequest=(infoStore_1=infoTx_1.objectStore(INFO_STORE_NAME)).delete(_this.modelPath);deleteInfoRequest.onsuccess=function(){return db.close(),reject(putModelRequest.error)},deleteInfoRequest.onerror=function(error){return db.close(),reject(putModelRequest.error)}}},putInfoRequest_1.onerror=function(error){return db.close(),reject(putInfoRequest_1.error)},infoTx_1.oncomplete=function(){null==modelTx_1?db.close():modelTx_1.oncomplete=function(){return db.close()}}}},openRequest.onerror=function(error){return reject(openRequest.error)}}))},BrowserIndexedDB.URL_SCHEME="indexeddb://",BrowserIndexedDB}();function browserIndexedDB(modelPath){return new BrowserIndexedDB(modelPath)}function maybeStripScheme(key){return key.startsWith(BrowserIndexedDB.URL_SCHEME)?key.slice(BrowserIndexedDB.URL_SCHEME.length):key}exports.BrowserIndexedDB=BrowserIndexedDB,exports.indexedDBRouter=function(url){return environment_1.ENV.getBool("IS_BROWSER")&&!Array.isArray(url)&&url.startsWith(BrowserIndexedDB.URL_SCHEME)?browserIndexedDB(url.slice(BrowserIndexedDB.URL_SCHEME.length)):null},router_registry_1.IORouterRegistry.registerSaveRouter(exports.indexedDBRouter),router_registry_1.IORouterRegistry.registerLoadRouter(exports.indexedDBRouter),exports.browserIndexedDB=browserIndexedDB;var BrowserIndexedDBManager=function(){function BrowserIndexedDBManager(){this.indexedDB=getIndexedDBFactory()}return BrowserIndexedDBManager.prototype.listModels=function(){return __awaiter(this,void 0,void 0,(function(){var _this=this;return __generator(this,(function(_a){return[2,new Promise((function(resolve,reject){var openRequest=_this.indexedDB.open(DATABASE_NAME,1);openRequest.onupgradeneeded=function(){return setUpDatabase(openRequest)},openRequest.onsuccess=function(){var db=openRequest.result,tx=db.transaction(INFO_STORE_NAME,"readonly"),store,getAllInfoRequest=tx.objectStore(INFO_STORE_NAME).getAll();getAllInfoRequest.onsuccess=function(){for(var out={},_i=0,_a=getAllInfoRequest.result;_i<_a.length;_i++){var item=_a[_i];out[item.modelPath]=item.modelArtifactsInfo}resolve(out)},getAllInfoRequest.onerror=function(error){return db.close(),reject(getAllInfoRequest.error)},tx.oncomplete=function(){return db.close()}},openRequest.onerror=function(error){return reject(openRequest.error)}}))]}))}))},BrowserIndexedDBManager.prototype.removeModel=function(path){return __awaiter(this,void 0,void 0,(function(){var _this=this;return __generator(this,(function(_a){return path=maybeStripScheme(path),[2,new Promise((function(resolve,reject){var openRequest=_this.indexedDB.open(DATABASE_NAME,1);openRequest.onupgradeneeded=function(){return setUpDatabase(openRequest)},openRequest.onsuccess=function(){var db=openRequest.result,infoTx=db.transaction(INFO_STORE_NAME,"readwrite"),infoStore=infoTx.objectStore(INFO_STORE_NAME),getInfoRequest=infoStore.get(path),modelTx;getInfoRequest.onsuccess=function(){if(null==getInfoRequest.result)return db.close(),reject(new Error("Cannot find model with path '"+path+"' in IndexedDB."));var deleteInfoRequest=infoStore.delete(path),deleteModelData_1=function(){var modelStore,deleteModelRequest=(modelTx=db.transaction("models_store","readwrite")).objectStore("models_store").delete(path);deleteModelRequest.onsuccess=function(){return resolve(getInfoRequest.result.modelArtifactsInfo)},deleteModelRequest.onerror=function(error){return reject(getInfoRequest.error)}};deleteInfoRequest.onsuccess=deleteModelData_1,deleteInfoRequest.onerror=function(error){return deleteModelData_1(),db.close(),reject(getInfoRequest.error)}},getInfoRequest.onerror=function(error){return db.close(),reject(getInfoRequest.error)},infoTx.oncomplete=function(){null==modelTx?db.close():modelTx.oncomplete=function(){return db.close()}}},openRequest.onerror=function(error){return reject(openRequest.error)}}))]}))}))},BrowserIndexedDBManager}();if(exports.BrowserIndexedDBManager=BrowserIndexedDBManager,environment_1.ENV.getBool("IS_BROWSER"))try{model_management_1.ModelStoreManagerRegistry.registerManager(BrowserIndexedDB.URL_SCHEME,new BrowserIndexedDBManager)}catch(err){}},{"../environment":151,"./io_utils":160,"./model_management":162,"./router_registry":165}],159:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0}),require("./indexed_db"),require("./local_storage");var browser_files_1=require("./browser_files");exports.browserFiles=browser_files_1.browserFiles;var http_1=require("./http");exports.browserHTTPRequest=http_1.browserHTTPRequest,exports.http=http_1.http,exports.isHTTPScheme=http_1.isHTTPScheme;var io_utils_1=require("./io_utils");exports.concatenateArrayBuffers=io_utils_1.concatenateArrayBuffers,exports.decodeWeights=io_utils_1.decodeWeights,exports.encodeWeights=io_utils_1.encodeWeights,exports.getModelArtifactsInfoForJSON=io_utils_1.getModelArtifactsInfoForJSON;var passthrough_1=require("./passthrough");exports.fromMemory=passthrough_1.fromMemory,exports.withSaveHandler=passthrough_1.withSaveHandler;var router_registry_1=require("./router_registry");exports.getLoadHandlers=router_registry_1.getLoadHandlers,exports.getSaveHandlers=router_registry_1.getSaveHandlers,exports.registerLoadRouter=router_registry_1.registerLoadRouter,exports.registerSaveRouter=router_registry_1.registerSaveRouter;var weights_loader_1=require("./weights_loader");exports.loadWeights=weights_loader_1.loadWeights,exports.weightsLoaderFactory=weights_loader_1.weightsLoaderFactory;var model_management_1=require("./model_management");exports.copyModel=model_management_1.copyModel,exports.listModels=model_management_1.listModels,exports.moveModel=model_management_1.moveModel,exports.removeModel=model_management_1.removeModel},{"./browser_files":156,"./http":157,"./indexed_db":158,"./io_utils":160,"./local_storage":161,"./model_management":162,"./passthrough":163,"./router_registry":165,"./weights_loader":167}],160:[function(require,module,exports){(function(Buffer){(function(){"use strict";
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P((function(resolve){resolve(result.value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},__generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}};Object.defineProperty(exports,"__esModule",{value:!0});var tensor_ops_1=require("../ops/tensor_ops"),util_1=require("../util"),types_1=require("./types"),NUM_BYTES_STRING_LENGTH=4;function encodeWeights(tensors,group){return __awaiter(this,void 0,void 0,(function(){var specs,dataPromises,names,_loop_1,i,tensorValues,_this=this;return __generator(this,(function(_a){switch(_a.label){case 0:for(specs=[],dataPromises=[],names=Array.isArray(tensors)?tensors.map((function(tensor){return tensor.name})):Object.keys(tensors),_loop_1=function(i){var name_1=names[i],t=Array.isArray(tensors)?tensors[i].tensor:tensors[name_1];if("float32"!==t.dtype&&"int32"!==t.dtype&&"bool"!==t.dtype&&"string"!==t.dtype)throw new Error("Unsupported dtype in weight '"+name_1+"': "+t.dtype);var spec={name:name_1,shape:t.shape,dtype:t.dtype};if("string"===t.dtype){var utf8bytes=new Promise((function(resolve){return __awaiter(_this,void 0,void 0,(function(){var vals,totalNumBytes,bytes,offset,i_1,val,bytesOfLength;return __generator(this,(function(_a){switch(_a.label){case 0:return[4,t.bytes()];case 1:for(vals=_a.sent(),totalNumBytes=vals.reduce((function(p,c){return p+c.length}),0)+4*vals.length,bytes=new Uint8Array(totalNumBytes),offset=0,i_1=0;i_1<vals.length;i_1++)val=vals[i_1],bytesOfLength=new Uint8Array(new Uint32Array([val.length]).buffer),bytes.set(bytesOfLength,offset),offset+=4,bytes.set(val,offset),offset+=val.length;return resolve(bytes),[2]}}))}))}));dataPromises.push(utf8bytes)}else dataPromises.push(t.data());null!=group&&(spec.group=group),specs.push(spec)},i=0;i<names.length;++i)_loop_1(i);return[4,Promise.all(dataPromises)];case 1:return[2,{data:concatenateTypedArrays(tensorValues=_a.sent()),specs:specs}]}}))}))}function decodeWeights(buffer,specs){for(var out={},offset=0,_loop_2=function(spec){var name_2=spec.name,dtype=spec.dtype,shape=spec.shape,size=util_1.sizeFromShape(shape),values=void 0;if("quantization"in spec){var quantization_1=spec.quantization;if("uint8"!==quantization_1.dtype&&"uint16"!==quantization_1.dtype)throw new Error("Weight "+spec.name+" has unknown quantization dtype "+quantization_1.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var quantizationSizeFactor=types_1.DTYPE_VALUE_SIZE_MAP[quantization_1.dtype],byteBuffer=buffer.slice(offset,offset+size*quantizationSizeFactor),quantizedArray="uint8"===quantization_1.dtype?new Uint8Array(byteBuffer):new Uint16Array(byteBuffer);if("float32"===dtype)values=Float32Array.from(quantizedArray,(function(v){return v*quantization_1.scale+quantization_1.min}));else{if("int32"!==dtype)throw new Error("Unsupported dtype in weight '"+name_2+"': "+dtype);values=Int32Array.from(quantizedArray,(function(v){return Math.round(v*quantization_1.scale+quantization_1.min)}))}offset+=size*quantizationSizeFactor}else if("string"===dtype){var size_1=util_1.sizeFromShape(spec.shape);values=[];for(var i=0;i<size_1;i++){var byteLength=new Uint32Array(buffer.slice(offset,offset+4))[0];offset+=4;var bytes=new Uint8Array(buffer.slice(offset,offset+byteLength));values.push(bytes),offset+=byteLength}}else{var dtypeFactor=types_1.DTYPE_VALUE_SIZE_MAP[dtype],byteBuffer=buffer.slice(offset,offset+size*dtypeFactor);if("float32"===dtype)values=new Float32Array(byteBuffer);else if("int32"===dtype)values=new Int32Array(byteBuffer);else{if("bool"!==dtype)throw new Error("Unsupported dtype in weight '"+name_2+"': "+dtype);values=new Uint8Array(byteBuffer)}offset+=size*dtypeFactor}out[name_2]=tensor_ops_1.tensor(values,shape,dtype)},_i=0,specs_1=specs;_i<specs_1.length;_i++){var spec;_loop_2(specs_1[_i])}return out}function concatenateTypedArrays(xs){if(null===xs)throw new Error("Invalid input value: "+JSON.stringify(xs));var totalByteLength=0,normalizedXs=[];xs.forEach((function(x){if(totalByteLength+=x.byteLength,normalizedXs.push(x.byteLength===x.buffer.byteLength?x:new x.constructor(x)),!(x instanceof Float32Array||x instanceof Int32Array||x instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+x.constructor.name)}));var y=new Uint8Array(totalByteLength),offset=0;return normalizedXs.forEach((function(x){y.set(new Uint8Array(x.buffer),offset),offset+=x.byteLength})),y.buffer}exports.encodeWeights=encodeWeights,exports.decodeWeights=decodeWeights,exports.concatenateTypedArrays=concatenateTypedArrays;var useNodeBuffer=void 0!==Buffer&&("undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa);function stringByteLength(str){return useNodeBuffer?Buffer.byteLength(str):new Blob([str]).size}function arrayBufferToBase64String(buffer){return useNodeBuffer?Buffer.from(buffer).toString("base64"):btoa(String.fromCharCode.apply(null,new Uint8Array(buffer)))}function base64StringToArrayBuffer(str){if(useNodeBuffer){var buf=Buffer.from(str,"base64");return buf.buffer.slice(buf.byteOffset,buf.byteOffset+buf.byteLength)}for(var s=atob(str),buffer=new Uint8Array(s.length),i=0;i<s.length;++i)buffer.set([s.charCodeAt(i)],i);return buffer.buffer}function concatenateArrayBuffers(buffers){var totalByteLength=0;buffers.forEach((function(buffer){totalByteLength+=buffer.byteLength}));var temp=new Uint8Array(totalByteLength),offset=0;return buffers.forEach((function(buffer){temp.set(new Uint8Array(buffer),offset),offset+=buffer.byteLength})),temp.buffer}function basename(path){var SEPARATOR="/";for(path=path.trim();path.endsWith("/");)path=path.slice(0,path.length-1);var items=path.split("/");return items[items.length-1]}function getModelArtifactsInfoForJSON(modelArtifacts){if(modelArtifacts.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==modelArtifacts.modelTopology?0:stringByteLength(JSON.stringify(modelArtifacts.modelTopology)),weightSpecsBytes:null==modelArtifacts.weightSpecs?0:stringByteLength(JSON.stringify(modelArtifacts.weightSpecs)),weightDataBytes:null==modelArtifacts.weightData?0:modelArtifacts.weightData.byteLength}}exports.stringByteLength=stringByteLength,exports.arrayBufferToBase64String=arrayBufferToBase64String,exports.base64StringToArrayBuffer=base64StringToArrayBuffer,exports.concatenateArrayBuffers=concatenateArrayBuffers,exports.basename=basename,exports.getModelArtifactsInfoForJSON=getModelArtifactsInfoForJSON}).call(this)}).call(this,require("buffer").Buffer)},{"../ops/tensor_ops":223,"../util":248,"./types":166,buffer:257}],161:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P((function(resolve){resolve(result.value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},__generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}};Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../environment"),util_1=require("../util"),io_utils_1=require("./io_utils"),model_management_1=require("./model_management"),router_registry_1=require("./router_registry"),PATH_SEPARATOR="/",PATH_PREFIX="tensorflowjs_models",INFO_SUFFIX="info",MODEL_TOPOLOGY_SUFFIX="model_topology",WEIGHT_SPECS_SUFFIX="weight_specs",WEIGHT_DATA_SUFFIX="weight_data",MODEL_METADATA_SUFFIX="model_metadata";function purgeLocalStorageArtifacts(){if(!environment_1.ENV.getBool("IS_BROWSER")||void 0===window.localStorage)throw new Error("purgeLocalStorageModels() cannot proceed because local storage is unavailable in the current environment.");for(var LS=window.localStorage,purgedModelPaths=[],i=0;i<LS.length;++i){var key=LS.key(i),prefix=PATH_PREFIX+"/";if(key.startsWith(prefix)&&key.length>prefix.length){LS.removeItem(key);var modelName=getModelPathFromKey(key);-1===purgedModelPaths.indexOf(modelName)&&purgedModelPaths.push(modelName)}}return purgedModelPaths}function getModelKeys(path){return{info:[PATH_PREFIX,path,INFO_SUFFIX].join("/"),topology:[PATH_PREFIX,path,MODEL_TOPOLOGY_SUFFIX].join("/"),weightSpecs:[PATH_PREFIX,path,WEIGHT_SPECS_SUFFIX].join("/"),weightData:[PATH_PREFIX,path,WEIGHT_DATA_SUFFIX].join("/"),modelMetadata:[PATH_PREFIX,path,MODEL_METADATA_SUFFIX].join("/")}}function getModelPathFromKey(key){var items=key.split("/");if(items.length<3)throw new Error("Invalid key format: "+key);return items.slice(1,items.length-1).join("/")}function maybeStripScheme(key){return key.startsWith(BrowserLocalStorage.URL_SCHEME)?key.slice(BrowserLocalStorage.URL_SCHEME.length):key}exports.purgeLocalStorageArtifacts=purgeLocalStorageArtifacts;var BrowserLocalStorage=function(){function BrowserLocalStorage(modelPath){if(!environment_1.ENV.getBool("IS_BROWSER")||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==modelPath||!modelPath)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=modelPath,this.keys=getModelKeys(this.modelPath)}return BrowserLocalStorage.prototype.save=function(modelArtifacts){return __awaiter(this,void 0,void 0,(function(){var topology,weightSpecs,modelArtifactsInfo;return __generator(this,(function(_a){if(modelArtifacts.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");topology=JSON.stringify(modelArtifacts.modelTopology),weightSpecs=JSON.stringify(modelArtifacts.weightSpecs),modelArtifactsInfo=io_utils_1.getModelArtifactsInfoForJSON(modelArtifacts);try{return this.LS.setItem(this.keys.info,JSON.stringify(modelArtifactsInfo)),this.LS.setItem(this.keys.topology,topology),this.LS.setItem(this.keys.weightSpecs,weightSpecs),this.LS.setItem(this.keys.weightData,io_utils_1.arrayBufferToBase64String(modelArtifacts.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:modelArtifacts.format,generatedBy:modelArtifacts.generatedBy,convertedBy:modelArtifacts.convertedBy})),[2,{modelArtifactsInfo:modelArtifactsInfo}]}catch(err){throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+modelArtifactsInfo.modelTopologyBytes+", weightSpecsBytes="+modelArtifactsInfo.weightSpecsBytes+", weightDataBytes="+modelArtifactsInfo.weightDataBytes+".")}return[2]}))}))},BrowserLocalStorage.prototype.load=function(){return __awaiter(this,void 0,void 0,(function(){var info,out,topology,weightSpecs,metadataString,metadata,weightDataBase64;return __generator(this,(function(_a){if(null==(info=JSON.parse(this.LS.getItem(this.keys.info))))throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if("JSON"!==info.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(out={},null==(topology=JSON.parse(this.LS.getItem(this.keys.topology))))throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(out.modelTopology=topology,null==(weightSpecs=JSON.parse(this.LS.getItem(this.keys.weightSpecs))))throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(out.weightSpecs=weightSpecs,null!=(metadataString=this.LS.getItem(this.keys.modelMetadata))&&(metadata=JSON.parse(metadataString),out.format=metadata.format,out.generatedBy=metadata.generatedBy,out.convertedBy=metadata.convertedBy),null==(weightDataBase64=this.LS.getItem(this.keys.weightData)))throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return out.weightData=io_utils_1.base64StringToArrayBuffer(weightDataBase64),[2,out]}))}))},BrowserLocalStorage.URL_SCHEME="localstorage://",BrowserLocalStorage}();function browserLocalStorage(modelPath){return new BrowserLocalStorage(modelPath)}exports.BrowserLocalStorage=BrowserLocalStorage,exports.localStorageRouter=function(url){return environment_1.ENV.getBool("IS_BROWSER")&&!Array.isArray(url)&&url.startsWith(BrowserLocalStorage.URL_SCHEME)?browserLocalStorage(url.slice(BrowserLocalStorage.URL_SCHEME.length)):null},router_registry_1.IORouterRegistry.registerSaveRouter(exports.localStorageRouter),router_registry_1.IORouterRegistry.registerLoadRouter(exports.localStorageRouter),exports.browserLocalStorage=browserLocalStorage;var BrowserLocalStorageManager=function(){function BrowserLocalStorageManager(){util_1.assert(environment_1.ENV.getBool("IS_BROWSER"),(function(){return"Current environment is not a web browser"})),util_1.assert(void 0!==window.localStorage,(function(){return"Current browser does not appear to support localStorage"})),this.LS=window.localStorage}return BrowserLocalStorageManager.prototype.listModels=function(){return __awaiter(this,void 0,void 0,(function(){var out,prefix,suffix,i,key,modelPath;return __generator(this,(function(_a){for(out={},prefix=PATH_PREFIX+"/",suffix="/"+INFO_SUFFIX,i=0;i<this.LS.length;++i)(key=this.LS.key(i)).startsWith(prefix)&&key.endsWith(suffix)&&(modelPath=getModelPathFromKey(key),out[modelPath]=JSON.parse(this.LS.getItem(key)));return[2,out]}))}))},BrowserLocalStorageManager.prototype.removeModel=function(path){return __awaiter(this,void 0,void 0,(function(){var keys,info;return __generator(this,(function(_a){if(path=maybeStripScheme(path),keys=getModelKeys(path),null==this.LS.getItem(keys.info))throw new Error("Cannot find model at path '"+path+"'");return info=JSON.parse(this.LS.getItem(keys.info)),this.LS.removeItem(keys.info),this.LS.removeItem(keys.topology),this.LS.removeItem(keys.weightSpecs),this.LS.removeItem(keys.weightData),[2,info]}))}))},BrowserLocalStorageManager}();if(exports.BrowserLocalStorageManager=BrowserLocalStorageManager,environment_1.ENV.getBool("IS_BROWSER"))try{model_management_1.ModelStoreManagerRegistry.registerManager(BrowserLocalStorage.URL_SCHEME,new BrowserLocalStorageManager)}catch(err){}},{"../environment":151,"../util":248,"./io_utils":160,"./model_management":162,"./router_registry":165}],162:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P((function(resolve){resolve(result.value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},__generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}};Object.defineProperty(exports,"__esModule",{value:!0});var util_1=require("../util"),router_registry_1=require("./router_registry"),URL_SCHEME_SUFFIX="://",ModelStoreManagerRegistry=function(){function ModelStoreManagerRegistry(){this.managers={}}return ModelStoreManagerRegistry.getInstance=function(){return null==ModelStoreManagerRegistry.instance&&(ModelStoreManagerRegistry.instance=new ModelStoreManagerRegistry),ModelStoreManagerRegistry.instance},ModelStoreManagerRegistry.registerManager=function(scheme,manager){util_1.assert(null!=scheme,(function(){return"scheme must not be undefined or null."})),scheme.endsWith("://")&&(scheme=scheme.slice(0,scheme.indexOf("://"))),util_1.assert(scheme.length>0,(function(){return"scheme must not be an empty string."}));var registry=ModelStoreManagerRegistry.getInstance();util_1.assert(null==registry.managers[scheme],(function(){return"A model store manager is already registered for scheme '"+scheme+"'."})),registry.managers[scheme]=manager},ModelStoreManagerRegistry.getManager=function(scheme){var manager=this.getInstance().managers[scheme];if(null==manager)throw new Error("Cannot find model manager for scheme '"+scheme+"'");return manager},ModelStoreManagerRegistry.getSchemes=function(){return Object.keys(this.getInstance().managers)},ModelStoreManagerRegistry}();function parseURL(url){if(-1===url.indexOf("://"))throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+ModelStoreManagerRegistry.getSchemes().join(","));return{scheme:url.split("://")[0],path:url.split("://")[1]}}function cloneModelInternal(sourceURL,destURL,deleteSource){return void 0===deleteSource&&(deleteSource=!1),__awaiter(this,void 0,void 0,(function(){var loadHandlers,loadHandler,saveHandlers,saveHandler,sourceScheme,sourcePath,sameMedium,modelArtifacts,saveResult;return __generator(this,(function(_a){switch(_a.label){case 0:return util_1.assert(sourceURL!==destURL,(function(){return"Old path and new path are the same: '"+sourceURL+"'"})),loadHandlers=router_registry_1.IORouterRegistry.getLoadHandlers(sourceURL),util_1.assert(loadHandlers.length>0,(function(){return"Copying failed because no load handler is found for source URL "+sourceURL+"."})),util_1.assert(loadHandlers.length<2,(function(){return"Copying failed because more than one ("+loadHandlers.length+") load handlers for source URL "+sourceURL+"."})),loadHandler=loadHandlers[0],saveHandlers=router_registry_1.IORouterRegistry.getSaveHandlers(destURL),util_1.assert(saveHandlers.length>0,(function(){return"Copying failed because no save handler is found for destination URL "+destURL+"."})),util_1.assert(saveHandlers.length<2,(function(){return"Copying failed because more than one ("+loadHandlers.length+") save handlers for destination URL "+destURL+"."})),saveHandler=saveHandlers[0],sourceScheme=parseURL(sourceURL).scheme,sourcePath=parseURL(sourceURL).path,sameMedium=sourceScheme===parseURL(sourceURL).scheme,[4,loadHandler.load()];case 1:return modelArtifacts=_a.sent(),deleteSource&&sameMedium?[4,ModelStoreManagerRegistry.getManager(sourceScheme).removeModel(sourcePath)]:[3,3];case 2:_a.sent(),_a.label=3;case 3:return[4,saveHandler.save(modelArtifacts)];case 4:return saveResult=_a.sent(),!deleteSource||sameMedium?[3,6]:[4,ModelStoreManagerRegistry.getManager(sourceScheme).removeModel(sourcePath)];case 5:_a.sent(),_a.label=6;case 6:return[2,saveResult.modelArtifactsInfo]}}))}))}function listModels(){return __awaiter(this,void 0,void 0,(function(){var schemes,out,_i,schemes_1,scheme,schemeOut,path,url;return __generator(this,(function(_a){switch(_a.label){case 0:schemes=ModelStoreManagerRegistry.getSchemes(),out={},_i=0,schemes_1=schemes,_a.label=1;case 1:return _i<schemes_1.length?(scheme=schemes_1[_i],[4,ModelStoreManagerRegistry.getManager(scheme).listModels()]):[3,4];case 2:for(path in schemeOut=_a.sent())out[url=scheme+"://"+path]=schemeOut[path];_a.label=3;case 3:return _i++,[3,1];case 4:return[2,out]}}))}))}function removeModel(url){return __awaiter(this,void 0,void 0,(function(){var schemeAndPath,manager;return __generator(this,(function(_a){return schemeAndPath=parseURL(url),[2,(manager=ModelStoreManagerRegistry.getManager(schemeAndPath.scheme)).removeModel(schemeAndPath.path)]}))}))}function copyModel(sourceURL,destURL){return __awaiter(this,void 0,void 0,(function(){var deleteSource;return __generator(this,(function(_a){return deleteSource=!1,[2,cloneModelInternal(sourceURL,destURL,!1)]}))}))}function moveModel(sourceURL,destURL){return __awaiter(this,void 0,void 0,(function(){var deleteSource;return __generator(this,(function(_a){return deleteSource=!0,[2,cloneModelInternal(sourceURL,destURL,!0)]}))}))}exports.ModelStoreManagerRegistry=ModelStoreManagerRegistry,exports.listModels=listModels,exports.removeModel=removeModel,exports.copyModel=copyModel,exports.moveModel=moveModel},{"../util":248,"./router_registry":165}],163:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P((function(resolve){resolve(result.value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},__generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}};Object.defineProperty(exports,"__esModule",{value:!0});var PassthroughLoader=function(){function PassthroughLoader(modelArtifacts){this.modelArtifacts=modelArtifacts}return PassthroughLoader.prototype.load=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(_a){return[2,this.modelArtifacts]}))}))},PassthroughLoader}(),PassthroughSaver=function(){function PassthroughSaver(saveHandler){this.saveHandler=saveHandler}return PassthroughSaver.prototype.save=function(modelArtifacts){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(_a){return[2,this.saveHandler(modelArtifacts)]}))}))},PassthroughSaver}();function fromMemory(modelArtifacts,weightSpecs,weightData,trainingConfig){if(1===arguments.length){var isModelArtifacts=null!=modelArtifacts.modelTopology||null!=modelArtifacts.weightSpecs;return isModelArtifacts?new PassthroughLoader(modelArtifacts):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new PassthroughLoader({modelTopology:modelArtifacts}))}return console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new PassthroughLoader({modelTopology:modelArtifacts,weightSpecs:weightSpecs,weightData:weightData,trainingConfig:trainingConfig})}function withSaveHandler(saveHandler){return new PassthroughSaver(saveHandler)}exports.fromMemory=fromMemory,exports.withSaveHandler=withSaveHandler},{}],164:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2019 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var util_1=require("../util");function monitorPromisesProgress(promises,onProgress,startFraction,endFraction){checkPromises(promises),checkFraction(startFraction=null==startFraction?0:startFraction,endFraction=null==endFraction?1:endFraction);var resolvedPromise=0,registerMonitor=function(promise){return promise.then((function(value){var fraction=startFraction+ ++resolvedPromise/promises.length*(endFraction-startFraction);return onProgress(fraction),value})),promise};function checkPromises(promises){util_1.assert(null!=promises&&Array.isArray(promises)&&promises.length>0,(function(){return"promises must be a none empty array"}))}function checkFraction(startFraction,endFraction){util_1.assert(startFraction>=0&&startFraction<=1,(function(){return"Progress fraction must be in range [0, 1], but got startFraction "+startFraction})),util_1.assert(endFraction>=0&&endFraction<=1,(function(){return"Progress fraction must be in range [0, 1], but got endFraction "+endFraction})),util_1.assert(endFraction>=startFraction,(function(){return"startFraction must be no more than endFraction, but got startFraction "+startFraction+" and endFraction "+endFraction}))}return Promise.all(promises.map(registerMonitor))}exports.monitorPromisesProgress=monitorPromisesProgress},{"../util":248}],165:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var IORouterRegistry=function(){function IORouterRegistry(){this.saveRouters=[],this.loadRouters=[]}return IORouterRegistry.getInstance=function(){return null==IORouterRegistry.instance&&(IORouterRegistry.instance=new IORouterRegistry),IORouterRegistry.instance},IORouterRegistry.registerSaveRouter=function(saveRouter){IORouterRegistry.getInstance().saveRouters.push(saveRouter)},IORouterRegistry.registerLoadRouter=function(loadRouter){IORouterRegistry.getInstance().loadRouters.push(loadRouter)},IORouterRegistry.getSaveHandlers=function(url){return IORouterRegistry.getHandlers(url,"save")},IORouterRegistry.getLoadHandlers=function(url,onProgress){return IORouterRegistry.getHandlers(url,"load",onProgress)},IORouterRegistry.getHandlers=function(url,handlerType,onProgress){var validHandlers=[],routers;return("load"===handlerType?IORouterRegistry.getInstance().loadRouters:IORouterRegistry.getInstance().saveRouters).forEach((function(router){var handler=router(url,onProgress);null!==handler&&validHandlers.push(handler)})),validHandlers},IORouterRegistry}();exports.IORouterRegistry=IORouterRegistry,exports.registerSaveRouter=function(loudRouter){return IORouterRegistry.registerSaveRouter(loudRouter)},exports.registerLoadRouter=function(loudRouter){return IORouterRegistry.registerLoadRouter(loudRouter)},exports.getSaveHandlers=function(url){return IORouterRegistry.getSaveHandlers(url)},exports.getLoadHandlers=function(url,onProgress){return IORouterRegistry.getLoadHandlers(url,onProgress)}},{}],166:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0}),exports.DTYPE_VALUE_SIZE_MAP={float32:4,int32:4,uint16:2,uint8:1,bool:1}},{}],167:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P((function(resolve){resolve(result.value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},__generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}};Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../environment"),util=require("../util"),io_utils_1=require("./io_utils"),progress_1=require("./progress"),types_1=require("./types");function loadWeightsAsArrayBuffer(fetchURLs,loadOptions){return __awaiter(this,void 0,void 0,(function(){var fetchFunc,requests,fetchStartFraction,fetchEndFraction,responses,_a,bufferPromises,bufferStartFraction,bufferEndFraction,buffers,_b;return __generator(this,(function(_c){switch(_c.label){case 0:return null==loadOptions&&(loadOptions={}),fetchFunc=null==loadOptions.fetchFunc?environment_1.ENV.platform.fetch:loadOptions.fetchFunc,requests=fetchURLs.map((function(fetchURL){return fetchFunc(fetchURL,loadOptions.requestInit,{isBinary:!0})})),fetchStartFraction=0,fetchEndFraction=.5,null!=loadOptions.onProgress?[3,2]:[4,Promise.all(requests)];case 1:return _a=_c.sent(),[3,4];case 2:return[4,progress_1.monitorPromisesProgress(requests,loadOptions.onProgress,fetchStartFraction,fetchEndFraction)];case 3:_a=_c.sent(),_c.label=4;case 4:return bufferPromises=(responses=_a).map((function(response){return response.arrayBuffer()})),bufferStartFraction=.5,bufferEndFraction=1,null!=loadOptions.onProgress?[3,6]:[4,Promise.all(bufferPromises)];case 5:return _b=_c.sent(),[3,8];case 6:return[4,progress_1.monitorPromisesProgress(bufferPromises,loadOptions.onProgress,bufferStartFraction,bufferEndFraction)];case 7:_b=_c.sent(),_c.label=8;case 8:return[2,buffers=_b]}}))}))}function loadWeights(manifest,filePathPrefix,weightNames,requestInit){return void 0===filePathPrefix&&(filePathPrefix=""),__awaiter(this,void 0,void 0,(function(){var fetchWeights,loadWeights;return __generator(this,(function(_a){return[2,(loadWeights=weightsLoaderFactory(fetchWeights=function(fetchUrls){return loadWeightsAsArrayBuffer(fetchUrls,{requestInit:requestInit})}))(manifest,filePathPrefix,weightNames)]}))}))}function weightsLoaderFactory(fetchWeightsFunction){var _this=this;return function(manifest,filePathPrefix,weightNames){return void 0===filePathPrefix&&(filePathPrefix=""),__awaiter(_this,void 0,void 0,(function(){var groupIndicesToFetchMap,groupWeightsToFetch,weightsFound,allManifestWeightNames,weightsNotFound,groupIndicesToFetch,fetchUrls,buffers,weightsTensorMap,bufferIndexOffset;return __generator(this,(function(_a){switch(_a.label){case 0:if(groupIndicesToFetchMap=manifest.map((function(){return!1})),groupWeightsToFetch={},weightsFound=null!=weightNames?weightNames.map((function(){return!1})):[],allManifestWeightNames=[],manifest.forEach((function(manifestGroupConfig,groupIndex){var groupOffset=0;manifestGroupConfig.weights.forEach((function(weightsEntry){var rawDtype="quantization"in weightsEntry?weightsEntry.quantization.dtype:weightsEntry.dtype,weightsBytes=types_1.DTYPE_VALUE_SIZE_MAP[rawDtype]*util.sizeFromShape(weightsEntry.shape),enqueueWeightsForFetchingFn=function(){groupIndicesToFetchMap[groupIndex]=!0,null==groupWeightsToFetch[groupIndex]&&(groupWeightsToFetch[groupIndex]=[]),groupWeightsToFetch[groupIndex].push({manifestEntry:weightsEntry,groupOffset:groupOffset,sizeBytes:weightsBytes})};null!=weightNames?weightNames.forEach((function(weightName,weightIndex){weightName===weightsEntry.name&&(enqueueWeightsForFetchingFn(),weightsFound[weightIndex]=!0)})):enqueueWeightsForFetchingFn(),allManifestWeightNames.push(weightsEntry.name),groupOffset+=weightsBytes}))})),!weightsFound.every((function(found){return found})))throw weightsNotFound=weightNames.filter((function(_,i){return!weightsFound[i]})),new Error("Could not find weights in manifest with names: "+weightsNotFound.join(", ")+". \nManifest JSON has weights with names: "+allManifestWeightNames.join(", ")+".");return groupIndicesToFetch=groupIndicesToFetchMap.reduce((function(accumulator,shouldFetch,i){return shouldFetch&&accumulator.push(i),accumulator}),[]),fetchUrls=[],groupIndicesToFetch.forEach((function(i){manifest[i].paths.forEach((function(filepath){var fetchUrl=filePathPrefix+(filePathPrefix.endsWith("/")?"":"/")+filepath;fetchUrls.push(fetchUrl)}))})),[4,fetchWeightsFunction(fetchUrls)];case 1:return buffers=_a.sent(),weightsTensorMap={},bufferIndexOffset=0,groupIndicesToFetch.forEach((function(i){for(var numBuffers=manifest[i].paths.length,groupBytes=0,i_1=0;i_1<numBuffers;i_1++)groupBytes+=buffers[bufferIndexOffset+i_1].byteLength;for(var groupBuffer=new ArrayBuffer(groupBytes),groupByteBuffer=new Uint8Array(groupBuffer),groupBufferOffset=0,i_2=0;i_2<numBuffers;i_2++){var buffer=new Uint8Array(buffers[bufferIndexOffset+i_2]);groupByteBuffer.set(buffer,groupBufferOffset),groupBufferOffset+=buffer.byteLength}var weightsEntries;groupWeightsToFetch[i].forEach((function(weightsEntry){var byteBuffer=groupBuffer.slice(weightsEntry.groupOffset,weightsEntry.groupOffset+weightsEntry.sizeBytes),nameToTensorMap=io_utils_1.decodeWeights(byteBuffer,[weightsEntry.manifestEntry]);for(var name_1 in nameToTensorMap)weightsTensorMap[name_1]=nameToTensorMap[name_1]})),bufferIndexOffset+=numBuffers})),[2,weightsTensorMap]}}))}))}}exports.loadWeightsAsArrayBuffer=loadWeightsAsArrayBuffer,exports.loadWeights=loadWeights,exports.weightsLoaderFactory=weightsLoaderFactory},{"../environment":151,"../util":248,"./io_utils":160,"./progress":164,"./types":166}],168:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("./environment");function warn(){for(var msg=[],_i=0;_i<arguments.length;_i++)msg[_i]=arguments[_i];environment_1.ENV.getBool("IS_TEST")||console.warn.apply(console,msg)}function log(){for(var msg=[],_i=0;_i<arguments.length;_i++)msg[_i]=arguments[_i];environment_1.ENV.getBool("IS_TEST")||console.log.apply(console,msg)}exports.warn=warn,exports.log=log},{"./environment":151}],169:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var confusion_matrix_1=require("./ops/confusion_matrix");exports.confusionMatrix=confusion_matrix_1.confusionMatrix},{"./ops/confusion_matrix":182}],170:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P((function(resolve){resolve(result.value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},__generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}};Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),tensor_1=require("../tensor"),tensor_util_env_1=require("../tensor_util_env"),util=require("../util"),axis_util_1=require("./axis_util"),concat_split_1=require("./concat_split"),operation_1=require("./operation"),rand_1=require("./rand"),tensor_ops_1=require("./tensor_ops");function clone_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","clone",null),der=function(dy){return{$x:function(){return dy.toFloat()}}};return engine_1.ENGINE.runKernel((function(backend){return tensor_1.Tensor.make($x.shape,{dataId:$x.dataId},$x.dtype)}),{$x:$x},der)}function eye_(numRows,numColumns,batchShape,dtype){void 0===dtype&&(dtype="float32"),null==numColumns&&(numColumns=numRows);for(var buff=buffer([numRows,numColumns],dtype),n=numRows<=numColumns?numRows:numColumns,i=0;i<n;++i)buff.set(1,i,i);var out=buff.toTensor().as2D(numRows,numColumns);if(null==batchShape)return out;if(1===batchShape.length)return exports.tile(exports.expandDims(out,0),[batchShape[0],1,1]);if(2===batchShape.length)return exports.tile(exports.expandDims(exports.expandDims(out,0),0),[batchShape[0],batchShape[1],1,1]);if(3===batchShape.length)return exports.tile(exports.expandDims(exports.expandDims(exports.expandDims(out,0),0),0),[batchShape[0],batchShape[1],batchShape[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+batchShape.length+"D.")}function randomNormal_(shape,mean,stdDev,dtype,seed){if(void 0===mean&&(mean=0),void 0===stdDev&&(stdDev=1),null!=dtype&&"bool"===dtype)throw new Error("Unsupported data type "+dtype);for(var randGauss=new rand_1.MPRandGauss(mean,stdDev,dtype,!1,seed),res=buffer(shape,dtype),i=0;i<res.values.length;i++)res.values[i]=randGauss.nextValue();return res.toTensor()}function truncatedNormal_(shape,mean,stdDev,dtype,seed){if(void 0===mean&&(mean=0),void 0===stdDev&&(stdDev=1),null!=dtype&&"bool"===dtype)throw new Error("Unsupported data type "+dtype);for(var randGauss=new rand_1.MPRandGauss(mean,stdDev,dtype,!0,seed),res=buffer(shape,dtype),i=0;i<res.values.length;i++)res.values[i]=randGauss.nextValue();return res.toTensor()}function randomGamma_(shape,alpha,beta,dtype,seed){if(void 0===beta&&(beta=1),void 0===dtype&&(dtype="float32"),null==beta&&(beta=1),null==dtype&&(dtype="float32"),"float32"!==dtype&&"int32"!==dtype)throw new Error("Unsupported data type "+dtype);for(var rgamma=new rand_1.RandGamma(alpha,beta,dtype,seed),res=buffer(shape,dtype),i=0;i<res.values.length;i++)res.values[i]=rgamma.nextValue();return res.toTensor()}function randomUniform_(shape,minval,maxval,dtype,seed){void 0===minval&&(minval=0),void 0===maxval&&(maxval=1),void 0===dtype&&(dtype="float32");for(var res=buffer(shape,dtype),random=new rand_1.UniformRandom(minval,maxval,null,seed),i=0;i<res.values.length;i++)res.values[i]=random.nextValue();return res.toTensor()}function rand_(shape,randFunction,dtype){var size=util.sizeFromShape(shape),values=null;if(null==dtype||"float32"===dtype)values=new Float32Array(size);else if("int32"===dtype)values=new Int32Array(size);else{if("bool"!==dtype)throw new Error("Unknown data type "+dtype);values=new Uint8Array(size)}for(var i=0;i<size;i++)values[i]=randFunction();return tensor_1.Tensor.make(shape,{values:values},dtype)}function multinomial_(logits,numSamples,seed,normalized){void 0===normalized&&(normalized=!1);var $logits=tensor_util_env_1.convertToTensor(logits,"logits","multinomial"),numOutcomes=$logits.size,origRank=$logits.rank;if(numOutcomes<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+numOutcomes+".");if(origRank>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+origRank);seed=seed||Math.random();var logits2D=1===origRank?$logits.as2D(1,-1):$logits,res=engine_1.ENGINE.runKernel((function(backend){return backend.multinomial(logits2D,normalized,numSamples,seed)}),{logits2D:logits2D});return 1===origRank?res.as1D():res}function oneHot_(indices,depth,onValue,offValue){if(void 0===onValue&&(onValue=1),void 0===offValue&&(offValue=0),depth<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+depth);var $indices=tensor_util_env_1.convertToTensor(indices,"indices","oneHot","int32"),outShape=$indices.shape.concat([depth]);$indices=$indices.flatten();var grad=function(dy){return{$indices:function(){return tensor_ops_1.zeros($indices.shape,"float32")}}},result;return engine_1.ENGINE.runKernel((function(backend){return backend.oneHot($indices,depth,onValue,offValue)}),{$indices:$indices},grad).reshape(outShape)}function reshape_(x,shape){var $x=tensor_util_env_1.convertToTensor(x,"x","reshape",null);shape=util.inferFromImplicitShape(shape,$x.size),util.assert($x.size===util.sizeFromShape(shape),(function(){return"new shape and old shape must have the same number of elements."}));var grad=function(dy){return{$x:function(){return dy.reshape($x.shape)}}};return engine_1.ENGINE.runKernel((function(backend){return backend.reshape($x,shape)}),{$x:$x},grad)}function squeeze_(x,axis){var $x=tensor_util_env_1.convertToTensor(x,"x","squeeze");return exports.reshape($x,util.squeezeShape($x.shape,axis).newShape)}function cast_(x,dtype){var $x=tensor_util_env_1.convertToTensor(x,"x","cast");if(!util.isValidDtype(dtype))throw new Error("Failed to cast to unknown dtype "+dtype);if("string"===dtype&&"string"!==$x.dtype||"string"!==dtype&&"string"===$x.dtype)throw new Error("Only strings can be casted to strings");var grad=function(dy){return{$x:function(){return dy.clone()}}};return engine_1.ENGINE.runKernel((function(backend){return backend.cast($x,dtype)}),{$x:$x},grad)}function tile_(x,reps){var parseAs=null,$x=tensor_util_env_1.convertToTensor(x,"x","tile",null);util.assert($x.rank===reps.length,(function(){return"Error in transpose: rank of input "+$x.rank+" must match length of reps "+reps+"."}));var grad=function(dy,saved){var $x=saved[0],derX;return{$x:function(){var xGrad=tensor_ops_1.zerosLike($x);if(1===$x.rank)for(var i=0;i<reps[0];++i)xGrad=xGrad.add(dy.slice([i*$x.shape[0]],[$x.shape[0]]));else if(2===$x.rank)for(var i=0;i<reps[0];++i)for(var j=0;j<reps[1];++j)xGrad=xGrad.add(dy.slice([i*$x.shape[0],j*$x.shape[1]],[$x.shape[0],$x.shape[1]]));else if(3===$x.rank)for(var i=0;i<reps[0];++i)for(var j=0;j<reps[1];++j)for(var k=0;k<reps[2];++k)xGrad=xGrad.add(dy.slice([i*$x.shape[0],j*$x.shape[1],k*$x.shape[2]],[$x.shape[0],$x.shape[1],$x.shape[2]]));else{if(4!==$x.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+$x.rank+" tensors yet.");for(var i=0;i<reps[0];++i)for(var j=0;j<reps[1];++j)for(var k=0;k<reps[2];++k)for(var l=0;l<reps[3];++l)xGrad=xGrad.add(dy.slice([i*$x.shape[0],j*$x.shape[1],k*$x.shape[2],l*$x.shape[3]],[$x.shape[0],$x.shape[1],$x.shape[2],$x.shape[3]]))}return xGrad}}};return engine_1.ENGINE.runKernel((function(backend,save){var res=backend.tile($x,reps);return save([$x]),res}),{$x:$x},grad)}function pad1d_(x,paddings,constantValue){return void 0===constantValue&&(constantValue=0),util.assert(2===paddings.length,(function(){return"Invalid number of paddings. Must be length of 2."})),exports.pad(x,[paddings],constantValue)}function pad2d_(x,paddings,constantValue){return void 0===constantValue&&(constantValue=0),util.assert(2===paddings.length&&2===paddings[0].length&&2===paddings[1].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),exports.pad(x,paddings,constantValue)}function pad3d_(x,paddings,constantValue){return void 0===constantValue&&(constantValue=0),util.assert(3===paddings.length&&2===paddings[0].length&&2===paddings[1].length&&2===paddings[2].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),exports.pad(x,paddings,constantValue)}function pad4d_(x,paddings,constantValue){return void 0===constantValue&&(constantValue=0),util.assert(4===paddings.length&&2===paddings[0].length&&2===paddings[1].length&&2===paddings[2].length&&2===paddings[3].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),exports.pad(x,paddings,constantValue)}function pad_(x,paddings,constantValue){void 0===constantValue&&(constantValue=0);var $x=tensor_util_env_1.convertToTensor(x,"x","pad");if(0===$x.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var begin=paddings.map((function(p){return p[0]})),grad=function(dy){return{$x:function(){return dy.slice(begin,$x.shape)}}};return engine_1.ENGINE.runKernel((function(backend){return backend.pad($x,paddings,constantValue)}),{$x:$x},grad)}function stack_(tensors,axis){void 0===axis&&(axis=0);var $tensors=tensor_util_env_1.convertToTensorArray(tensors,"tensors","stack");if(util.assert($tensors.length>=1,(function(){return"Pass at least one tensor to tf.stack"})),1===$tensors.length)return $tensors[0].expandDims(axis);var rank=$tensors[0].rank,shape=$tensors[0].shape,dtype=$tensors[0].dtype;util.assert(axis<=rank,(function(){return"Axis must be <= rank of the tensor"})),$tensors.forEach((function(t){util.assertShapesMatch(shape,t.shape,"All tensors passed to stack must have matching shapes")})),$tensors.forEach((function(t){util.assert(dtype===t.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var expandedTensors=$tensors.map((function(t){return t.expandDims(axis)}));return concat_split_1.concat(expandedTensors,axis)}function batchToSpaceND_(x,blockShape,crops){var $x=tensor_util_env_1.convertToTensor(x,"x","batchToSpaceND"),prod=blockShape.reduce((function(a,b){return a*b}));util.assert($x.rank>=1+blockShape.length,(function(){return"input rank is "+$x.rank+" but should be > than blockShape.length "+blockShape.length})),util.assert(crops.length===blockShape.length,(function(){return"crops.length is "+crops.length+" but should be equal to blockShape.length  "+blockShape.length})),util.assert($x.shape[0]%prod==0,(function(){return"input tensor batch is "+$x.shape[0]+" but is not divisible by the product of the elements of blockShape "+blockShape.join(" * ")+" === "+prod}));var grad=function(dy){return{$x:function(){return dy.spaceToBatchND(blockShape,crops)}}};return engine_1.ENGINE.runKernel((function(backend){return backend.batchToSpaceND($x,blockShape,crops)}),{$x:$x},grad)}function spaceToBatchND_(x,blockShape,paddings){var $x=tensor_util_env_1.convertToTensor(x,"x","spaceToBatchND");util.assert($x.rank>=1+blockShape.length,(function(){return"input rank "+$x.rank+" should be > than [blockShape] "+blockShape.length})),util.assert(paddings.length===blockShape.length,(function(){return"paddings.shape[0] "+paddings.length+" must be equal to [blockShape] "+blockShape.length})),util.assert($x.shape.reduce((function(a,b,i){return i>0&&i<=blockShape.length?a&&(b+paddings[i-1][0]+paddings[i-1][1])%blockShape[i-1]==0:a}),!0),(function(){return"input spatial dimensions "+$x.shape.slice(1)+" with paddings "+paddings.toString()+" must be divisible by blockShapes "+blockShape.toString()}));var grad=function(dy){return{$x:function(){return dy.batchToSpaceND(blockShape,paddings)}}};return engine_1.ENGINE.runKernel((function(backend){return backend.spaceToBatchND($x,blockShape,paddings)}),{$x:$x},grad)}function unstack_(x,axis){void 0===axis&&(axis=0),axis=axis||0;var $x=tensor_util_env_1.convertToTensor(x,"x","unstack");util.assert(axis>=-$x.shape.length&&axis<$x.shape.length,(function(){return"Axis = "+axis+" is not in [-"+$x.shape.length+", "+$x.shape.length+")"})),axis<0&&(axis+=$x.shape.length);var grad=function(dy){return{$x:function(){return exports.stack(dy,axis)}}};return engine_1.ENGINE.runKernel((function(backend){return backend.unstack($x,axis)}),{$x:$x},grad)}function cumsum_(x,axis,exclusive,reverse){void 0===axis&&(axis=0),void 0===exclusive&&(exclusive=!1),void 0===reverse&&(reverse=!1);var $x=tensor_util_env_1.convertToTensor(x,"x","cumsum");axis|=0;var permutation=axis_util_1.getAxesPermutation([axis],$x.rank),permutedX=$x;null!=permutation&&(permutedX=$x.transpose(permutation));var permutedAxis=axis_util_1.getInnerMostAxes(1,$x.rank)[0],grad=function(dy){return{permutedX:function(){return dy.cumsum(axis,exclusive,!reverse)}}},value=engine_1.ENGINE.runKernel((function(backend){return backend.cumsum(permutedX,permutedAxis,exclusive,reverse)}),{permutedX:permutedX},grad);return null!=permutation&&(value=value.transpose(permutation)),value}function expandDims_(x,axis){void 0===axis&&(axis=0);var parseAs=null,$x=tensor_util_env_1.convertToTensor(x,"x","expandDims",null);util.assert(axis<=$x.rank,(function(){return"Axis must be <= rank of the tensor"}));var newShape=$x.shape.slice();return axis<0&&(util.assert(-($x.rank+1)<=axis,(function(){return"Axis must be in the interval ["+-($x.rank+1)+", "+$x.rank+"]"})),axis=$x.rank+axis+1),newShape.splice(axis,0,1),exports.reshape($x,newShape)}function depthToSpace_(x,blockSize,dataFormat){void 0===dataFormat&&(dataFormat="NHWC");var $x=tensor_util_env_1.convertToTensor(x,"x","depthToSpace"),inputHeight="NHWC"===dataFormat?$x.shape[1]:$x.shape[2],inputWidth="NHWC"===dataFormat?$x.shape[2]:$x.shape[3],inputDepth="NHWC"===dataFormat?$x.shape[3]:$x.shape[1];return util.assert(inputHeight*blockSize>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n      "+inputHeight+" and "+blockSize+"  for depthToSpace with input shape\n      "+$x.shape})),util.assert(inputWidth*blockSize>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n      "+inputWidth+" and "+blockSize+" for depthToSpace with input shape\n          "+$x.shape})),util.assert(inputDepth%(blockSize*blockSize)==0,(function(){return"Dimension size must be evenly divisible by "+blockSize*blockSize+" but is "+inputDepth+" for depthToSpace with input shape "+$x.shape})),engine_1.ENGINE.runKernel((function(backend){return backend.depthToSpace($x,blockSize,dataFormat)}),{$x:$x})}function setdiff1dAsync_(x,y){return __awaiter(this,void 0,void 0,(function(){var $x,$y,xVals,yVals,ySet,outputSize,i,buffer,indices,i,p;return __generator(this,(function(_a){switch(_a.label){case 0:return $x=tensor_util_env_1.convertToTensor(x,"x","setdiff1d"),$y=tensor_util_env_1.convertToTensor(y,"y","setdiff1d"),util.assert($x.dtype===$y.dtype,(function(){return"x and y should have the same dtype, but got x ("+$x.dtype+") and y ("+$y.dtype+")."})),util.assert(1===$x.rank,(function(){return"x should be 1D tensor, but got x ("+$x.shape+")."})),util.assert(1===$y.rank,(function(){return"y should be 1D tensor, but got y ("+$y.shape+")."})),[4,$x.data()];case 1:return xVals=_a.sent(),[4,$y.data()];case 2:for(yVals=_a.sent(),ySet=new Set(yVals),outputSize=0,i=0;i<xVals.length;i++)ySet.has(xVals[i])||outputSize++;for(buffer=new tensor_1.TensorBuffer([outputSize],$x.dtype),indices=new tensor_1.TensorBuffer([outputSize],"int32"),i=0,p=0;i<xVals.length;i++)ySet.has(xVals[i])||(buffer.values[p]=xVals[i],indices.values[p]=i,p++);return[2,[buffer.toTensor(),indices.toTensor()]]}}))}))}function buffer(shape,dtype,values){return void 0===dtype&&(dtype="float32"),dtype=dtype||"float32",util.assertNonNegativeIntegerDimensions(shape),new tensor_1.TensorBuffer(shape,dtype,values)}function print(x,verbose){void 0===verbose&&(verbose=!1),console.log(x.toString(verbose))}exports.buffer=buffer,exports.print=print,exports.batchToSpaceND=operation_1.op({batchToSpaceND_:batchToSpaceND_}),exports.cast=operation_1.op({cast_:cast_}),exports.clone=operation_1.op({clone_:clone_}),exports.cumsum=operation_1.op({cumsum_:cumsum_}),exports.depthToSpace=operation_1.op({depthToSpace_:depthToSpace_}),exports.expandDims=operation_1.op({expandDims_:expandDims_}),exports.eye=operation_1.op({eye_:eye_}),exports.multinomial=operation_1.op({multinomial_:multinomial_}),exports.oneHot=operation_1.op({oneHot_:oneHot_}),exports.pad=operation_1.op({pad_:pad_}),exports.pad1d=operation_1.op({pad1d_:pad1d_}),exports.pad2d=operation_1.op({pad2d_:pad2d_}),exports.pad3d=operation_1.op({pad3d_:pad3d_}),exports.pad4d=operation_1.op({pad4d_:pad4d_}),exports.rand=operation_1.op({rand_:rand_}),exports.randomNormal=operation_1.op({randomNormal_:randomNormal_}),exports.randomGamma=operation_1.op({randomGamma_:randomGamma_}),exports.randomUniform=operation_1.op({randomUniform_:randomUniform_}),exports.reshape=operation_1.op({reshape_:reshape_}),exports.spaceToBatchND=operation_1.op({spaceToBatchND_:spaceToBatchND_}),exports.squeeze=operation_1.op({squeeze_:squeeze_}),exports.stack=operation_1.op({stack_:stack_}),exports.tile=operation_1.op({tile_:tile_}),exports.truncatedNormal=operation_1.op({truncatedNormal_:truncatedNormal_}),exports.unstack=operation_1.op({unstack_:unstack_}),exports.setdiff1dAsync=setdiff1dAsync_},{"../engine":150,"../tensor":241,"../tensor_util_env":244,"../util":248,"./axis_util":172,"./concat_split":180,"./operation":202,"./rand":205,"./tensor_ops":223}],171:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function getReshaped(inputShape,blockShape,prod,batchToSpace){void 0===batchToSpace&&(batchToSpace=!0);var reshaped=[];if(batchToSpace)(reshaped=reshaped.concat(blockShape.slice(0))).push(inputShape[0]/prod),reshaped=reshaped.concat(inputShape.slice(1));else{reshaped=reshaped.concat(inputShape[0]);for(var spatialLength=blockShape.length,i=0;i<spatialLength;++i)reshaped=reshaped.concat([inputShape[i+1]/blockShape[i],blockShape[i]]);reshaped=reshaped.concat(inputShape.slice(spatialLength+1))}return reshaped}function getPermuted(reshapedRank,blockShapeRank,batchToSpace){void 0===batchToSpace&&(batchToSpace=!0);var permuted=[];if(batchToSpace){permuted.push(blockShapeRank);for(var i=blockShapeRank+1;i<reshapedRank;++i)i<=2*blockShapeRank?(permuted.push(i),permuted.push(i-(blockShapeRank+1))):permuted.push(i)}else{for(var permutedBeforeBatch=[],permutedAfterBatch=[],i=1;i<reshapedRank;++i)i>=2*blockShapeRank+1||i%2==1?permutedAfterBatch.push(i):permutedBeforeBatch.push(i);permuted.push.apply(permuted,permutedBeforeBatch),permuted.push(0),permuted.push.apply(permuted,permutedAfterBatch)}return permuted}function getReshapedPermuted(inputShape,blockShape,prod,batchToSpace){void 0===batchToSpace&&(batchToSpace=!0);var reshapedPermuted=[];batchToSpace?reshapedPermuted.push(inputShape[0]/prod):reshapedPermuted.push(inputShape[0]*prod);for(var i=1;i<inputShape.length;++i)i<=blockShape.length?batchToSpace?reshapedPermuted.push(blockShape[i-1]*inputShape[i]):reshapedPermuted.push(inputShape[i]/blockShape[i-1]):reshapedPermuted.push(inputShape[i]);return reshapedPermuted}function getSliceBeginCoords(crops,blockShape){for(var sliceBeginCoords=[0],i=0;i<blockShape;++i)sliceBeginCoords.push(crops[i][0]);return sliceBeginCoords}function getSliceSize(uncroppedShape,crops,blockShape){for(var sliceSize=uncroppedShape.slice(0,1),i=0;i<blockShape;++i)sliceSize.push(uncroppedShape[i+1]-crops[i][0]-crops[i][1]);return sliceSize}Object.defineProperty(exports,"__esModule",{value:!0}),exports.getReshaped=getReshaped,exports.getPermuted=getPermuted,exports.getReshapedPermuted=getReshapedPermuted,exports.getSliceBeginCoords=getSliceBeginCoords,exports.getSliceSize=getSliceSize},{}],172:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2017 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var util=require("../util");function axesAreInnerMostDims(axes,rank){for(var i=0;i<axes.length;++i)if(axes[axes.length-i-1]!==rank-1-i)return!1;return!0}function combineLocations(outputLoc,reduceLoc,axes){for(var rank=outputLoc.length+reduceLoc.length,loc=[],outIdx=0,reduceIdx=0,dim=0;dim<rank;dim++)-1===axes.indexOf(dim)?loc.push(outputLoc[outIdx++]):loc.push(reduceLoc[reduceIdx++]);return loc}function computeOutAndReduceShapes(aShape,axes){for(var outShape=[],rank=aShape.length,dim=0;dim<rank;dim++)-1===axes.indexOf(dim)&&outShape.push(aShape[dim]);var reduceShape;return[outShape,axes.map((function(dim){return aShape[dim]}))]}function expandShapeToKeepDim(shape,axes){var reduceSubShape;return combineLocations(shape,axes.map((function(x){return 1})),axes)}function assertAxesAreInnerMostDims(msg,axes,rank){util.assert(axesAreInnerMostDims(axes,rank),(function(){return msg+" supports only inner-most axes for now. Got axes "+axes+" and rank-"+rank+" input."}))}function getAxesPermutation(axes,rank){if(axesAreInnerMostDims(axes,rank))return null;for(var result=[],i=0;i<rank;++i)-1===axes.indexOf(i)&&result.push(i);return axes.forEach((function(axis){return result.push(axis)})),result}function getUndoAxesPermutation(axes){return axes.map((function(axis,i){return[i,axis]})).sort((function(a,b){return a[1]-b[1]})).map((function(x){return x[0]}))}function getInnerMostAxes(numAxes,rank){for(var res=[],i=rank-numAxes;i<rank;++i)res.push(i);return res}exports.axesAreInnerMostDims=axesAreInnerMostDims,exports.combineLocations=combineLocations,exports.computeOutAndReduceShapes=computeOutAndReduceShapes,exports.expandShapeToKeepDim=expandShapeToKeepDim,exports.assertAxesAreInnerMostDims=assertAxesAreInnerMostDims,exports.getAxesPermutation=getAxesPermutation,exports.getUndoAxesPermutation=getUndoAxesPermutation,exports.getInnerMostAxes=getInnerMostAxes},{"../util":248}],173:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),globals_1=require("../globals"),tensor_util_env_1=require("../tensor_util_env"),util=require("../util"),array_ops_1=require("./array_ops"),broadcast_util_1=require("./broadcast_util"),operation_1=require("./operation"),tensor_ops_1=require("./tensor_ops"),unary_ops_1=require("./unary_ops");function batchNorm2d_(x,mean,variance,offset,scale,varianceEpsilon){var $x=tensor_util_env_1.convertToTensor(x,"x","batchNorm"),$mean=tensor_util_env_1.convertToTensor(mean,"mean","batchNorm"),$variance=tensor_util_env_1.convertToTensor(variance,"variance","batchNorm"),$scale,$offset;return null!=scale&&($scale=tensor_util_env_1.convertToTensor(scale,"scale","batchNorm")),null!=offset&&($offset=tensor_util_env_1.convertToTensor(offset,"offset","batchNorm")),util.assert(2===$x.rank,(function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+$x.rank+"."})),util.assert(2===$mean.rank||1===$mean.rank,(function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+$mean.rank+"."})),util.assert(2===$variance.rank||1===$variance.rank,(function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+$variance.rank+"."})),null!=$scale&&util.assert(2===$scale.rank||1===$scale.rank,(function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+$scale.rank+"."})),null!=$offset&&util.assert(2===$offset.rank||1===$offset.rank,(function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+$offset.rank+"."})),batchNorm_($x,$mean,$variance,$offset,$scale,varianceEpsilon)}function batchNorm3d_(x,mean,variance,offset,scale,varianceEpsilon){var $x=tensor_util_env_1.convertToTensor(x,"x","batchNorm"),$mean=tensor_util_env_1.convertToTensor(mean,"mean","batchNorm"),$variance=tensor_util_env_1.convertToTensor(variance,"variance","batchNorm"),$scale,$offset;return null!=scale&&($scale=tensor_util_env_1.convertToTensor(scale,"scale","batchNorm")),null!=offset&&($offset=tensor_util_env_1.convertToTensor(offset,"offset","batchNorm")),util.assert(3===$x.rank,(function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+$x.rank+"."})),util.assert(3===$mean.rank||1===$mean.rank,(function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+$mean.rank+"."})),util.assert(3===$variance.rank||1===$variance.rank,(function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+$variance.rank+"."})),null!=$scale&&util.assert(3===$scale.rank||1===$scale.rank,(function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+$scale.rank+"."})),null!=$offset&&util.assert(3===$offset.rank||1===$offset.rank,(function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+$offset.rank+"."})),batchNorm_($x,$mean,$variance,$offset,$scale,varianceEpsilon)}function batchNorm4d_(x,mean,variance,offset,scale,varianceEpsilon){var $x=tensor_util_env_1.convertToTensor(x,"x","batchNorm"),$mean=tensor_util_env_1.convertToTensor(mean,"mean","batchNorm"),$variance=tensor_util_env_1.convertToTensor(variance,"variance","batchNorm"),$scale,$offset;return null!=scale&&($scale=tensor_util_env_1.convertToTensor(scale,"scale","batchNorm")),null!=offset&&($offset=tensor_util_env_1.convertToTensor(offset,"offset","batchNorm")),util.assert(4===$x.rank,(function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+$x.rank+"."})),util.assert(4===$mean.rank||1===$mean.rank,(function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+$mean.rank+"."})),util.assert(4===$variance.rank||1===$variance.rank,(function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+$variance.rank+"."})),null!=$scale&&util.assert(4===$scale.rank||1===$scale.rank,(function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+$scale.rank+"."})),null!=$offset&&util.assert(4===$offset.rank||1===$offset.rank,(function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+$offset.rank+"."})),batchNorm_($x,$mean,$variance,$offset,$scale,varianceEpsilon)}function batchNormalization_(x,mean,variance,varianceEpsilon,scale,offset){return void 0===varianceEpsilon&&(varianceEpsilon=.001),warnDeprecation(),batchNorm_(x,mean,variance,offset,scale,varianceEpsilon)}function batchNorm_(x,mean,variance,offset,scale,varianceEpsilon){null==varianceEpsilon&&(varianceEpsilon=.001);var $x=tensor_util_env_1.convertToTensor(x,"x","batchNorm"),$mean=tensor_util_env_1.convertToTensor(mean,"mean","batchNorm"),$variance=tensor_util_env_1.convertToTensor(variance,"variance","batchNorm"),$scale,$offset,x4D;null!=scale&&($scale=tensor_util_env_1.convertToTensor(scale,"scale","batchNorm")),null!=offset&&($offset=tensor_util_env_1.convertToTensor(offset,"offset","batchNorm")),util.assert($mean.rank===$variance.rank,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),util.assert(null==$offset||$mean.rank===$offset.rank,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),util.assert(null==$scale||$mean.rank===$scale.rank,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."})),x4D=0===$x.rank||1===$x.rank?$x.as4D(1,1,1,$x.size):2===$x.rank?$x.as4D(1,1,$x.shape[0],$x.shape[1]):3===$x.rank?$x.as4D(1,$x.shape[0],$x.shape[1],$x.shape[2]):$x;var der=function(dy,saved){var _a=saved,$x=_a[0],$mean=_a[1],$variance=_a[2],$scale=_a[3],scaleValue=null==$scale?tensor_ops_1.scalar(1):$scale,reductionAxes=broadcast_util_1.getReductionAxes($mean.shape,x4D.shape),tileShape=[];if(1===$mean.rank){for(var i=0;i<x4D.shape.length-1;++i)tileShape.push(x4D.shape[i]);tileShape.push(1)}var xMinusMean=$x.sub($mean),dyTimesScaleValue=dy.mul(scaleValue),oneOverSqrtVariance=unary_ops_1.rsqrt($variance.add(tensor_ops_1.scalar(varianceEpsilon))),minusHalfRCube=oneOverSqrtVariance.mul(oneOverSqrtVariance).mul(oneOverSqrtVariance).mul(tensor_ops_1.scalar(-.5)),derX,derMean,derVariance,derScale,derOffset;return{$x:function(){return 1===$mean.rank?dy.mul(array_ops_1.tile(oneOverSqrtVariance.as4D(1,1,1,$mean.shape[0]),tileShape)).mul(scaleValue).reshape($x.shape):dy.mul(oneOverSqrtVariance).mul(scaleValue).reshape($x.shape)},$mean:function(){var meanDer=oneOverSqrtVariance.mul(tensor_ops_1.scalar(-1)).mul(dyTimesScaleValue);return 1===$mean.rank&&(meanDer=meanDer.sum(reductionAxes)),meanDer.reshape($mean.shape)},$variance:function(){var varianceDer=minusHalfRCube.mul(xMinusMean).mul(dyTimesScaleValue);return 1===$mean.rank&&(varianceDer=varianceDer.sum(reductionAxes)),varianceDer.reshape($mean.shape)},$scale:function(){var xMinusMean2TimesRsqrt=xMinusMean.mul(oneOverSqrtVariance),scaleDer=dy.mul(xMinusMean2TimesRsqrt);return 1===$mean.rank&&(scaleDer=scaleDer.sum(reductionAxes)),scaleDer.reshape($mean.shape)},$offset:function(){var offsetDer=dy;return 1===$mean.rank&&(offsetDer=offsetDer.sum(reductionAxes)),offsetDer.reshape($mean.shape)}}},res;return engine_1.ENGINE.runKernel((function(backend,save){var res=backend.batchNormalization(x4D,batchnormReshape4D($mean),batchnormReshape4D($variance),varianceEpsilon,batchnormReshape4D($scale),batchnormReshape4D($offset));return save([$x,$mean,$variance,$scale]),res}),{$x:$x,$mean:$mean,$variance:$variance,$scale:$scale,$offset:$offset},der).reshape($x.shape)}function batchnormReshape4D(x){return null==x?null:0===x.rank?x.as1D():1===x.rank?x:2===x.rank?x.as4D(1,1,x.shape[0],x.shape[1]):3===x.rank?x.as4D(1,x.shape[0],x.shape[1],x.shape[2]):x}function batchNormalization2d_(x,mean,variance,varianceEpsilon,scale,offset){return void 0===varianceEpsilon&&(varianceEpsilon=.001),warnDeprecation(),batchNorm2d_(x,mean,variance,offset,scale,varianceEpsilon)}function batchNormalization3d_(x,mean,variance,varianceEpsilon,scale,offset){return void 0===varianceEpsilon&&(varianceEpsilon=.001),warnDeprecation(),batchNorm3d_(x,mean,variance,offset,scale,varianceEpsilon)}function batchNormalization4d_(x,mean,variance,varianceEpsilon,scale,offset){return void 0===varianceEpsilon&&(varianceEpsilon=.001),warnDeprecation(),batchNorm4d_(x,mean,variance,offset,scale,varianceEpsilon)}function warnDeprecation(){globals_1.deprecationWarn("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}exports.batchNormalization2d=operation_1.op({batchNormalization2d_:batchNormalization2d_}),exports.batchNormalization3d=operation_1.op({batchNormalization3d_:batchNormalization3d_}),exports.batchNormalization4d=operation_1.op({batchNormalization4d_:batchNormalization4d_}),exports.batchNormalization=operation_1.op({batchNormalization_:batchNormalization_}),exports.batchNorm=operation_1.op({batchNorm_:batchNorm_}),exports.batchNorm2d=operation_1.op({batchNorm2d_:batchNorm2d_}),exports.batchNorm3d=operation_1.op({batchNorm3d_:batchNorm3d_}),exports.batchNorm4d=operation_1.op({batchNorm4d_:batchNorm4d_})},{"../engine":150,"../globals":153,"../tensor_util_env":244,"../util":248,"./array_ops":170,"./broadcast_util":176,"./operation":202,"./tensor_ops":223,"./unary_ops":226}],174:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),tensor_util_1=require("../tensor_util"),tensor_util_env_1=require("../tensor_util_env"),types_1=require("../types"),util=require("../util"),broadcast_util=require("./broadcast_util"),operation_1=require("./operation"),tensor_ops_1=require("./tensor_ops"),unary_ops_1=require("./unary_ops");function add_(a,b){var _a,$a=tensor_util_env_1.convertToTensor(a,"a","add"),$b=tensor_util_env_1.convertToTensor(b,"b","add");_a=tensor_util_1.makeTypesMatch($a,$b),$a=_a[0],$b=_a[1];var outShape=broadcast_util.assertAndGetBroadcastShape($a.shape,$b.shape),der=function(dy){var derA,derB;return{$a:function(){var res=dy,reduceAxes=broadcast_util.getReductionAxes($a.shape,outShape);return reduceAxes.length>0&&(res=res.sum(reduceAxes)),res.reshape($a.shape)},$b:function(){var res=dy,reduceAxes=broadcast_util.getReductionAxes($b.shape,outShape);return reduceAxes.length>0&&(res=res.sum(reduceAxes)),res.reshape($b.shape)}}};return engine_1.ENGINE.runKernel((function(backend){return backend.add($a,$b)}),{$a:$a,$b:$b},der)}function addN_(tensors){util.assert(Array.isArray(tensors),(function(){return"The argument passed to tf.addN() must be a list of tensors"})),util.assert(tensors.length>=1,(function(){return"Must pass at least one tensor to tf.addN(), but got "+tensors.length}));var $tensors=tensors.map((function(t,i){return tensor_util_env_1.convertToTensor(t,"tensors"+i,"addN")})),firstTensor=$tensors[0];$tensors.forEach((function(t){if(t.dtype!==firstTensor.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")})),$tensors.forEach((function(t){if(!util.arraysEqual(t.shape,firstTensor.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}));var der=function(dy){var ders={};return $tensors.forEach((function(t,i){ders[i]=function(){return dy.clone()}})),ders},inputs=$tensors;return engine_1.ENGINE.runKernel((function(backend){return backend.addN($tensors)}),inputs,der)}function addStrict_(a,b){var $a=tensor_util_env_1.convertToTensor(a,"a","addStrict"),$b=tensor_util_env_1.convertToTensor(b,"b","addStrict");return util.assertShapesMatch($a.shape,$b.shape,"Error in addStrict: "),$a.add($b)}function sub_(a,b){var _a,$a=tensor_util_env_1.convertToTensor(a,"a","sub"),$b=tensor_util_env_1.convertToTensor(b,"b","sub");_a=tensor_util_1.makeTypesMatch($a,$b),$a=_a[0],$b=_a[1];var outShape=broadcast_util.assertAndGetBroadcastShape($a.shape,$b.shape),der=function(dy){var derA,derB;return{$a:function(){var res=dy,reduceAxes=broadcast_util.getReductionAxes($a.shape,outShape);return reduceAxes.length>0&&(res=res.sum(reduceAxes)),res.reshape($a.shape)},$b:function(){var res=dy,reduceAxes=broadcast_util.getReductionAxes($b.shape,outShape);return reduceAxes.length>0&&(res=res.sum(reduceAxes)),res.neg().reshape($b.shape)}}};return engine_1.ENGINE.runKernel((function(backend){return backend.subtract($a,$b)}),{$a:$a,$b:$b},der)}function subStrict_(a,b){var $a=tensor_util_env_1.convertToTensor(a,"a","subStrict"),$b=tensor_util_env_1.convertToTensor(b,"b","subStrict");return util.assertShapesMatch($a.shape,$b.shape,"Error in subStrict: "),$a.sub($b)}function pow_(base,exp){var $base=tensor_util_env_1.convertToTensor(base,"base","pow"),$exp=tensor_util_env_1.convertToTensor(exp,"exp","pow"),outShape=broadcast_util.assertAndGetBroadcastShape($base.shape,$exp.shape);base=$base.cast(types_1.upcastType($base.dtype,$exp.dtype)),exp=$exp.cast(types_1.upcastType($base.dtype,$exp.dtype));var grad=function(dy,saved){var $base=saved[0],$exp=saved[1],y=saved[2],derBase,derExp;return{$base:function(){var expFloat=$exp.toFloat(),res=dy.mul(expFloat.mul($base.pow(expFloat.sub(tensor_ops_1.scalar(1))))),reduceAxes=broadcast_util.getReductionAxes($base.shape,outShape);return reduceAxes.length>0&&(res=res.sum(reduceAxes)),res.reshape($base.shape)},$exp:function(){var condition=$base.greater(0),logBase=$base.log().where(condition,tensor_ops_1.zerosLike($base)),res=dy.mul(y.mul(logBase)),reduceAxes=broadcast_util.getReductionAxes($exp.shape,outShape);return reduceAxes.length>0&&(res=res.sum(reduceAxes)),res.reshape($exp.shape)}}};return engine_1.ENGINE.runKernel((function(backend,save){var y=backend.pow($base,$exp);return save([$base,$exp,y]),y}),{$base:$base,$exp:$exp},grad)}function powStrict_(base,exp){return util.assertShapesMatch(base.shape,exp.shape,"Error in powStrict: "),base.pow(exp)}function mul_(a,b){var _a,$a=tensor_util_env_1.convertToTensor(a,"a","mul"),$b=tensor_util_env_1.convertToTensor(b,"b","mul");_a=tensor_util_1.makeTypesMatch($a,$b),$a=_a[0],$b=_a[1];var outShape=broadcast_util.assertAndGetBroadcastShape($a.shape,$b.shape),der=function(dy,saved){var $a=saved[0],$b=saved[1],derA,derB;return{$a:function(){var res=dy.mul($b.toFloat()),reduceAxes=broadcast_util.getReductionAxes($a.shape,outShape);return reduceAxes.length>0?res.sum(reduceAxes).reshape($a.shape):res},$b:function(){var res=dy.mul($a.toFloat()),reduceAxes=broadcast_util.getReductionAxes($b.shape,outShape);return reduceAxes.length>0?res.sum(reduceAxes).reshape($b.shape):res}}};return engine_1.ENGINE.runKernel((function(backend,save){var res=backend.multiply($a,$b);return save([$a,$b]),res}),{$a:$a,$b:$b},der)}function mulStrict_(a,b){var $a=tensor_util_env_1.convertToTensor(a,"a","mul"),$b=tensor_util_env_1.convertToTensor(b,"b","mul");return util.assertShapesMatch($a.shape,$b.shape,"Error in multiplyStrict: "),$a.mul($b)}function div_(a,b){var _a,$a=tensor_util_env_1.convertToTensor(a,"a","div"),$b=tensor_util_env_1.convertToTensor(b,"b","div");if(_a=tensor_util_1.makeTypesMatch($a,$b),$a=_a[0],$b=_a[1],"int32"===$a.dtype&&"int32"===$b.dtype)return exports.floorDiv($a,$b);var outShape=broadcast_util.assertAndGetBroadcastShape($a.shape,$b.shape),der=function(dy,saved){var $a=saved[0],$b=saved[1],derA,derB;return{$a:function(){var res=dy.div($b.toFloat()),reduceAxes=broadcast_util.getReductionAxes($a.shape,outShape);return reduceAxes.length>0?res.sum(reduceAxes).reshape($a.shape):res},$b:function(){var res=dy.mul($a.toFloat()),reduceAxes=broadcast_util.getReductionAxes($b.shape,outShape);reduceAxes.length>0&&(res=res.sum(reduceAxes).reshape($b.shape));var tmp=$b.square();return res.div(tmp.toFloat()).neg()}}};return engine_1.ENGINE.runKernel((function(backend,save){var res=backend.realDivide($a,$b);return save([$a,$b]),res}),{$a:$a,$b:$b},der)}function floorDiv_(a,b){var _a,$a=tensor_util_env_1.convertToTensor(a,"a","floorDiv"),$b=tensor_util_env_1.convertToTensor(b,"b","floorDiv");_a=tensor_util_1.makeTypesMatch($a,$b),$a=_a[0],$b=_a[1];var outShape=broadcast_util.assertAndGetBroadcastShape($a.shape,$b.shape),der=function(dy,saved){var $a=saved[0],$b=saved[1],derA,derB;return{$a:function(){var res=dy.div($b.toFloat()),reduceAxes=broadcast_util.getReductionAxes($a.shape,outShape);return reduceAxes.length>0?res.sum(reduceAxes).reshape($a.shape):res},$b:function(){var res=dy.mul($a.toFloat()),reduceAxes=broadcast_util.getReductionAxes($b.shape,outShape);reduceAxes.length>0&&(res=res.sum(reduceAxes).reshape($b.shape));var tmp=$b.square();return res.div(tmp.toFloat()).neg()}}};return engine_1.ENGINE.runKernel((function(backend,save){var res=backend.floorDiv($a,$b);return save([$a,$b]),res}),{$a:$a,$b:$b},der)}function divStrict_(a,b){var $a=tensor_util_env_1.convertToTensor(a,"a","div"),$b=tensor_util_env_1.convertToTensor(b,"b","div");return util.assertShapesMatch($a.shape,$b.shape,"Error in divideStrict: "),$a.div($b)}function mod_(a,b){var _a,$a=tensor_util_env_1.convertToTensor(a,"a","mod"),$b=tensor_util_env_1.convertToTensor(b,"b","mod");_a=tensor_util_1.makeTypesMatch($a,$b),$a=_a[0],$b=_a[1];var outShape=broadcast_util.assertAndGetBroadcastShape($a.shape,$b.shape),der=function(dy,saved){var $a=saved[0],$b=saved[1],derA,derB;return{$a:function(){var reduceAxes=broadcast_util.getReductionAxes($a.shape,outShape);return reduceAxes.length>0?dy.sum(reduceAxes).reshape($a.shape):dy},$b:function(){var res=dy.mul($a.div($b).floor().neg()),reduceAxes=broadcast_util.getReductionAxes($b.shape,outShape);return reduceAxes.length>0?res.sum(reduceAxes).reshape($b.shape):res}}};return engine_1.ENGINE.runKernel((function(backend,save){var res=backend.mod($a,$b);return save([$a,$b]),res}),{$a:$a,$b:$b},der)}function modStrict_(a,b){var $a=tensor_util_env_1.convertToTensor(a,"a","modStrict"),$b=tensor_util_env_1.convertToTensor(b,"b","modStrict");return util.assertShapesMatch($a.shape,$b.shape,"Error in modStrict: "),$a.mod($b)}function minimum_(a,b){var _a,$a=tensor_util_env_1.convertToTensor(a,"a","minimum"),$b=tensor_util_env_1.convertToTensor(b,"b","minimum");_a=tensor_util_1.makeTypesMatch($a,$b),$a=_a[0],$b=_a[1],"bool"===$a.dtype&&($a=$a.toInt(),$b=$b.toInt()),broadcast_util.assertAndGetBroadcastShape($a.shape,$b.shape);var der=function(dy,saved){var $a=saved[0],$b=saved[1],derA,derB;return{$a:function(){return dy.mul($a.lessEqual($b).toFloat())},$b:function(){return dy.mul($a.greater($b).toFloat())}}};return engine_1.ENGINE.runKernel((function(backend,save){var res=backend.minimum($a,$b);return save([$a,$b]),res}),{$a:$a,$b:$b},der)}function minimumStrict_(a,b){var $a=tensor_util_env_1.convertToTensor(a,"a","minimumStrict"),$b=tensor_util_env_1.convertToTensor(b,"b","minimumStrict");return util.assertShapesMatch($a.shape,$b.shape,"Error in minimumStrict: "),$a.minimum($b)}function maximum_(a,b){var _a,$a=tensor_util_env_1.convertToTensor(a,"a","maximum"),$b=tensor_util_env_1.convertToTensor(b,"b","maximum");_a=tensor_util_1.makeTypesMatch($a,$b),$a=_a[0],$b=_a[1],"bool"===$a.dtype&&($a=$a.toInt(),$b=$b.toInt()),broadcast_util.assertAndGetBroadcastShape($a.shape,$b.shape);var der=function(dy,saved){var $a=saved[0],$b=saved[1],derA,derB;return{$a:function(){return dy.mul($a.greaterEqual($b).toFloat())},$b:function(){return dy.mul($a.less($b).toFloat())}}};return engine_1.ENGINE.runKernel((function(backend,save){var res=backend.maximum($a,$b);return save([$a,$b]),res}),{$a:$a,$b:$b},der)}function maximumStrict_(a,b){var $a=tensor_util_env_1.convertToTensor(a,"a","maximumStrict"),$b=tensor_util_env_1.convertToTensor(b,"b","maximumStrict");return util.assertShapesMatch($a.shape,$b.shape,"Error in maximumStrict: "),$a.maximum($b)}function squaredDifference_(a,b){var _a,$a=tensor_util_env_1.convertToTensor(a,"a","squaredDifference"),$b=tensor_util_env_1.convertToTensor(b,"b","squaredDifference");_a=tensor_util_1.makeTypesMatch($a,$b),$a=_a[0],$b=_a[1],broadcast_util.assertAndGetBroadcastShape($a.shape,$b.shape);var der=function(dy,saved){var $a=saved[0],$b=saved[1],two=tensor_ops_1.scalar(2),derA,derB;return{$a:function(){return dy.mul($a.sub($b).mul(two))},$b:function(){return dy.mul($b.sub($a).mul(two))}}};return engine_1.ENGINE.runKernel((function(backend,save){var res=backend.squaredDifference($a,$b);return save([$a,$b]),res}),{$a:$a,$b:$b},der)}function squaredDifferenceStrict_(a,b){var $a=tensor_util_env_1.convertToTensor(a,"a","squaredDifferenceStrict"),$b=tensor_util_env_1.convertToTensor(b,"b","squaredDifferenceStrict");return util.assertShapesMatch($a.shape,$b.shape,"Error in squaredDifferenceStrict: "),$a.squaredDifference($b)}function atan2_(a,b){var _a,$a=tensor_util_env_1.convertToTensor(a,"a","atan2"),$b=tensor_util_env_1.convertToTensor(b,"b","atan2");_a=tensor_util_1.makeTypesMatch($a,$b),$a=_a[0],$b=_a[1];var outShape=broadcast_util.assertAndGetBroadcastShape($a.shape,$b.shape),der=function(dy,saved){var $a=saved[0],$b=saved[1],derA,derB;return{$a:function(){var d=exports.add($a.square(),$b.square()),res=dy.mul($b.div(d)),reduceAxes=broadcast_util.getReductionAxes($a.shape,outShape);return reduceAxes.length>0&&(res=res.sum(reduceAxes)),res.reshape($a.shape)},$b:function(){var d=exports.add($a.square(),$b.square()),res=unary_ops_1.neg(dy.mul($a.div(d))),reduceAxes=broadcast_util.getReductionAxes($b.shape,outShape);return reduceAxes.length>0&&(res=res.sum(reduceAxes)),res.reshape($b.shape)}}};return engine_1.ENGINE.runKernel((function(backend,save){var res=backend.atan2($a,$b);return save([$a,$b]),res}),{$a:$a,$b:$b},der)}exports.add=operation_1.op({add_:add_}),exports.addN=operation_1.op({addN_:addN_}),exports.addStrict=operation_1.op({addStrict_:addStrict_}),exports.atan2=operation_1.op({atan2_:atan2_}),exports.div=operation_1.op({div_:div_}),exports.divStrict=operation_1.op({divStrict_:divStrict_}),exports.floorDiv=operation_1.op({floorDiv_:floorDiv_}),exports.maximum=operation_1.op({maximum_:maximum_}),exports.maximumStrict=operation_1.op({maximumStrict_:maximumStrict_}),exports.minimum=operation_1.op({minimum_:minimum_}),exports.minimumStrict=operation_1.op({minimumStrict_:minimumStrict_}),exports.mod=operation_1.op({mod_:mod_}),exports.modStrict=operation_1.op({modStrict_:modStrict_}),exports.mul=operation_1.op({mul_:mul_}),exports.mulStrict=operation_1.op({mulStrict_:mulStrict_}),exports.pow=operation_1.op({pow_:pow_}),exports.powStrict=operation_1.op({powStrict_:powStrict_}),exports.squaredDifference=operation_1.op({squaredDifference_:squaredDifference_}),exports.squaredDifferenceStrict=operation_1.op({squaredDifferenceStrict_:squaredDifferenceStrict_}),exports.sub=operation_1.op({sub_:sub_}),exports.subStrict=operation_1.op({subStrict_:subStrict_})},{"../engine":150,"../tensor_util":243,"../tensor_util_env":244,"../types":247,"../util":248,"./broadcast_util":176,"./operation":202,"./tensor_ops":223,"./unary_ops":226}],175:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P((function(resolve){resolve(result.value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},__generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}};Object.defineProperty(exports,"__esModule",{value:!0});var tensor_util_env_1=require("../tensor_util_env"),util=require("../util"),logical_ops_1=require("./logical_ops"),segment_ops_1=require("./segment_ops");function booleanMaskAsync_(tensor,mask,axis){return __awaiter(this,void 0,void 0,(function(){var $tensor,$mask,axisFrom,maskDim,tensorShape,leadingSize,i,targetTensorShape,reshapedTensor,reshapedMask,positivePositions,indices,res;return __generator(this,(function(_a){switch(_a.label){case 0:for($tensor=tensor_util_env_1.convertToTensor(tensor,"tensor","boolMask"),$mask=tensor_util_env_1.convertToTensor(mask,"mask","boolMask","bool"),axisFrom=null==axis?0:axis,maskDim=$mask.rank,tensorShape=$tensor.shape,util.assert(maskDim>0,(function(){return"mask cannot be scalar"})),util.assertShapesMatch(tensorShape.slice(axisFrom,axisFrom+maskDim),$mask.shape,"mask's shape must match the first K dimensions of tensor's shape,"),leadingSize=1,i=axisFrom;i<axisFrom+maskDim;i++)leadingSize*=tensorShape[i];return targetTensorShape=tensorShape.slice(0,axisFrom).concat([leadingSize],tensorShape.slice(axisFrom+maskDim)),reshapedTensor=$tensor.reshape(targetTensorShape),reshapedMask=$mask.reshape([-1]),[4,logical_ops_1.whereAsync(reshapedMask)];case 1:return positivePositions=_a.sent(),indices=positivePositions.squeeze([1]),res=segment_ops_1.gather(reshapedTensor,indices,axisFrom),tensor!==$tensor&&$tensor.dispose(),mask!==$mask&&$mask.dispose(),indices.dispose(),reshapedTensor.dispose(),reshapedMask.dispose(),positivePositions.dispose(),[2,res]}}))}))}exports.booleanMaskAsync=booleanMaskAsync_},{"../tensor_util_env":244,"../util":248,"./logical_ops":195,"./segment_ops":212}],176:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2017 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function getBroadcastDims(inShape,outShape){for(var inRank=inShape.length,dims=[],i=0;i<inRank;i++){var dim=inRank-1-i,a=inShape[dim]||1,b;(outShape[outShape.length-1-i]||1)>1&&1===a&&dims.unshift(dim)}return dims}function getReductionAxes(inShape,outShape){for(var result=[],i=0;i<outShape.length;i++){var inDim=inShape[inShape.length-i-1],outAxis=outShape.length-i-1,outDim=outShape[outAxis];(null==inDim||1===inDim&&outDim>1)&&result.unshift(outAxis)}return result}function assertAndGetBroadcastShape(shapeA,shapeB){for(var result=[],l=Math.max(shapeA.length,shapeB.length),i=0;i<l;i++){var a=shapeA[shapeA.length-i-1];null==a&&(a=1);var b=shapeB[shapeB.length-i-1];if(null==b&&(b=1),1===a)result.unshift(b);else if(1===b)result.unshift(a);else{var errMsg;if(a!==b)throw Error("Operands could not be broadcast together with shapes "+shapeA+" and "+shapeB+".");result.unshift(a)}}return result}Object.defineProperty(exports,"__esModule",{value:!0}),exports.getBroadcastDims=getBroadcastDims,exports.getReductionAxes=getReductionAxes,exports.assertAndGetBroadcastShape=assertAndGetBroadcastShape},{}],177:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2019 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P((function(resolve){resolve(result.value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},__generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}};Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),tensor_1=require("../tensor"),tensor_util_env_1=require("../tensor_util_env"),operation_1=require("./operation");function fromPixels_(pixels,numChannels){if(void 0===numChannels&&(numChannels=3),numChannels>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");var isVideo="undefined"!=typeof HTMLVideoElement&&pixels instanceof HTMLVideoElement;if(isVideo){var HAVE_CURRENT_DATA_READY_STATE=2;if(isVideo&&pixels.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.")}return engine_1.ENGINE.fromPixels(pixels,numChannels)}function toPixels(img,canvas){return __awaiter(this,void 0,void 0,(function(){var $img,_a,height,width,depth,data,minTensor,maxTensor,vals,minVals,maxVals,min,max,multiplier,bytes,i,r,g,b,a,j,ctx,imageData;return __generator(this,(function(_b){switch(_b.label){case 0:if($img=tensor_util_env_1.convertToTensor(img,"img","toPixels"),img instanceof tensor_1.Tensor||($img=$img.toInt()),2!==$img.rank&&3!==$img.rank)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+$img.rank+".");if(_a=$img.shape.slice(0,2),height=_a[0],width=_a[1],(depth=2===$img.rank?1:$img.shape[2])>4||2===depth)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+depth);return[4,$img.data()];case 1:return data=_b.sent(),minTensor=$img.min(),maxTensor=$img.max(),[4,Promise.all([minTensor.data(),maxTensor.data()])];case 2:if(vals=_b.sent(),minVals=vals[0],maxVals=vals[1],min=minVals[0],max=maxVals[0],minTensor.dispose(),maxTensor.dispose(),"float32"===$img.dtype){if(min<0||max>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+min+" - "+max+"].")}else{if("int32"!==$img.dtype)throw new Error("Unsupported type for toPixels: "+$img.dtype+". Please use float32 or int32 tensors.");if(min<0||max>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+min+" - "+max+"].")}for(multiplier="float32"===$img.dtype?255:1,bytes=new Uint8ClampedArray(width*height*4),i=0;i<height*width;++i)r=void 0,g=void 0,b=void 0,a=void 0,1===depth?(r=data[i]*multiplier,g=data[i]*multiplier,b=data[i]*multiplier,a=255):3===depth?(r=data[3*i]*multiplier,g=data[3*i+1]*multiplier,b=data[3*i+2]*multiplier,a=255):4===depth&&(r=data[4*i]*multiplier,g=data[4*i+1]*multiplier,b=data[4*i+2]*multiplier,a=data[4*i+3]*multiplier),bytes[(j=4*i)+0]=Math.round(r),bytes[j+1]=Math.round(g),bytes[j+2]=Math.round(b),bytes[j+3]=Math.round(a);return null!=canvas&&(canvas.width=width,canvas.height=height,ctx=canvas.getContext("2d"),imageData=new ImageData(bytes,width,height),ctx.putImageData(imageData,0,0)),$img!==img&&$img.dispose(),[2,bytes]}}))}))}exports.toPixels=toPixels,exports.fromPixels=operation_1.op({fromPixels_:fromPixels_})},{"../engine":150,"../tensor":241,"../tensor_util_env":244,"./operation":202}],178:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),tensor_util_1=require("../tensor_util"),tensor_util_env_1=require("../tensor_util_env"),util_1=require("../util"),broadcast_util_1=require("./broadcast_util"),operation_1=require("./operation"),tensor_ops_1=require("./tensor_ops");function notEqual_(a,b){var _a,$a=tensor_util_env_1.convertToTensor(a,"a","notEqual"),$b=tensor_util_env_1.convertToTensor(b,"b","notEqual");return _a=tensor_util_1.makeTypesMatch($a,$b),$a=_a[0],$b=_a[1],broadcast_util_1.assertAndGetBroadcastShape($a.shape,$b.shape),engine_1.ENGINE.runKernel((function(backend){return backend.notEqual($a,$b)}),{$a:$a,$b:$b})}function notEqualStrict_(a,b){var $a=tensor_util_env_1.convertToTensor(a,"a","notEqualStrict"),$b=tensor_util_env_1.convertToTensor(b,"b","notEqualStrict");return util_1.assertShapesMatch($a.shape,$b.shape,"Error in notEqualStrict: "),$a.notEqual($b)}function less_(a,b){var _a,$a=tensor_util_env_1.convertToTensor(a,"a","less"),$b=tensor_util_env_1.convertToTensor(b,"b","less");return _a=tensor_util_1.makeTypesMatch($a,$b),$a=_a[0],$b=_a[1],broadcast_util_1.assertAndGetBroadcastShape($a.shape,$b.shape),engine_1.ENGINE.runKernel((function(backend){return backend.less($a,$b)}),{$a:$a,$b:$b})}function lessStrict_(a,b){var $a=tensor_util_env_1.convertToTensor(a,"a","lessStrict"),$b=tensor_util_env_1.convertToTensor(b,"b","lessStrict");return util_1.assertShapesMatch($a.shape,$b.shape,"Error in lessStrict: "),$a.less($b)}function equal_(a,b){var _a,$a=tensor_util_env_1.convertToTensor(a,"a","equal"),$b=tensor_util_env_1.convertToTensor(b,"b","equal");return _a=tensor_util_1.makeTypesMatch($a,$b),$a=_a[0],$b=_a[1],broadcast_util_1.assertAndGetBroadcastShape($a.shape,$b.shape),engine_1.ENGINE.runKernel((function(backend){return backend.equal($a,$b)}),{$a:$a,$b:$b})}function equalStrict_(a,b){var $a=tensor_util_env_1.convertToTensor(a,"a","equalStrict"),$b=tensor_util_env_1.convertToTensor(b,"b","equalStrict");return util_1.assertShapesMatch($a.shape,$b.shape,"Error in equalStrict: "),$a.equal($b)}function lessEqual_(a,b){var _a,$a=tensor_util_env_1.convertToTensor(a,"a","lessEqual"),$b=tensor_util_env_1.convertToTensor(b,"b","lessEqual");return _a=tensor_util_1.makeTypesMatch($a,$b),$a=_a[0],$b=_a[1],broadcast_util_1.assertAndGetBroadcastShape($a.shape,$b.shape),engine_1.ENGINE.runKernel((function(backend){return backend.lessEqual($a,$b)}),{$a:$a,$b:$b})}function lessEqualStrict_(a,b){var $a=tensor_util_env_1.convertToTensor(a,"a","lessEqualStrict"),$b=tensor_util_env_1.convertToTensor(b,"b","lessEqualStrict");return util_1.assertShapesMatch($a.shape,$b.shape,"Error in lessEqualStrict: "),$a.lessEqual($b)}function greater_(a,b){var _a,$a=tensor_util_env_1.convertToTensor(a,"a","greater"),$b=tensor_util_env_1.convertToTensor(b,"b","greater");return _a=tensor_util_1.makeTypesMatch($a,$b),$a=_a[0],$b=_a[1],broadcast_util_1.assertAndGetBroadcastShape($a.shape,$b.shape),engine_1.ENGINE.runKernel((function(backend){return backend.greater($a,$b)}),{$a:$a,$b:$b})}function greaterStrict_(a,b){var $a=tensor_util_env_1.convertToTensor(a,"a","greaterStrict"),$b=tensor_util_env_1.convertToTensor(b,"b","greaterStrict");return util_1.assertShapesMatch($a.shape,$b.shape,"Error in greaterStrict: "),$a.greater($b)}function greaterEqual_(a,b){var _a,$a=tensor_util_env_1.convertToTensor(a,"a","greaterEqual"),$b=tensor_util_env_1.convertToTensor(b,"b","greaterEqual");_a=tensor_util_1.makeTypesMatch($a,$b),$a=_a[0],$b=_a[1],broadcast_util_1.assertAndGetBroadcastShape($a.shape,$b.shape);var grad=function(dy,saved){var $a=saved[0],$b=saved[1];return{$a:function(){return tensor_ops_1.zerosLike($a)},$b:function(){return tensor_ops_1.zerosLike($b)}}};return engine_1.ENGINE.runKernel((function(backend,save){var res=backend.greaterEqual($a,$b);return save([$a,$b]),res}),{$a:$a,$b:$b},grad)}function greaterEqualStrict_(a,b){var $a=tensor_util_env_1.convertToTensor(a,"a","greaterEqualStrict"),$b=tensor_util_env_1.convertToTensor(b,"b","greaterEqualStrict");return util_1.assertShapesMatch($a.shape,$b.shape,"Error in greaterEqualStrict: "),$a.greaterEqual($b)}exports.equal=operation_1.op({equal_:equal_}),exports.equalStrict=operation_1.op({equalStrict_:equalStrict_}),exports.greater=operation_1.op({greater_:greater_}),exports.greaterEqual=operation_1.op({greaterEqual_:greaterEqual_}),exports.greaterEqualStrict=operation_1.op({greaterEqualStrict_:greaterEqualStrict_}),exports.greaterStrict=operation_1.op({greaterStrict_:greaterStrict_}),exports.less=operation_1.op({less_:less_}),exports.lessEqual=operation_1.op({lessEqual_:lessEqual_}),exports.lessEqualStrict=operation_1.op({lessEqualStrict_:lessEqualStrict_}),exports.lessStrict=operation_1.op({lessStrict_:lessStrict_}),exports.notEqual=operation_1.op({notEqual_:notEqual_}),exports.notEqualStrict=operation_1.op({notEqualStrict_:notEqualStrict_})},{"../engine":150,"../tensor_util":243,"../tensor_util_env":244,"../util":248,"./broadcast_util":176,"./operation":202,"./tensor_ops":223}],179:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
var engine_1=require("../engine"),tensor_util_env_1=require("../tensor_util_env"),util=require("../util"),operation_1=require("./operation");function complex_(real,imag){var $real=tensor_util_env_1.convertToTensor(real,"real","complex"),$imag=tensor_util_env_1.convertToTensor(imag,"imag","complex");return util.assertShapesMatch($real.shape,$imag.shape,"real and imag shapes, "+$real.shape+" and "+$imag.shape+", must match in call to tf.complex()."),engine_1.ENGINE.runKernel((function(backend){return backend.complex($real,$imag)}),{$real:$real,$imag:$imag})}function real_(input){var $input=tensor_util_env_1.convertToTensor(input,"input","real");return engine_1.ENGINE.runKernel((function(backend){return backend.real($input)}),{$input:$input})}function imag_(input){var $input=tensor_util_env_1.convertToTensor(input,"input","imag");return engine_1.ENGINE.runKernel((function(backend){return backend.imag($input)}),{$input:$input})}exports.complex=operation_1.op({complex_:complex_}),exports.real=operation_1.op({real_:real_}),exports.imag=operation_1.op({imag_:imag_})},{"../engine":150,"../tensor_util_env":244,"../util":248,"./operation":202}],180:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),tensor_util_env_1=require("../tensor_util_env"),util_1=require("../util"),util_2=require("../util"),concat_util_1=require("./concat_util"),operation_1=require("./operation"),tensor_ops_1=require("./tensor_ops");function concat1d_(tensors){return exports.concat(tensors,0)}function concat2d_(tensors,axis){return exports.concat(tensors,axis)}function concat3d_(tensors,axis){return exports.concat(tensors,axis)}function concat4d_(tensors,axis){return exports.concat(tensors,axis)}function concat_(tensors,axis){void 0===axis&&(axis=0),util_1.assert(tensors.length>=1,(function(){return"Pass at least one tensor to concat"}));var $tensors=tensor_util_env_1.convertToTensorArray(tensors,"tensors","concat");"complex64"===$tensors[0].dtype&&$tensors.forEach((function(tensor){if("complex64"!==tensor.dtype)throw new Error("Cannot concatenate complex64 tensors with a tensor\n          with dtype "+tensor.dtype+". ")})),axis=util_2.parseAxisParam(axis,$tensors[0].shape)[0];var outShape=concat_util_1.computeOutShape($tensors.map((function(t){return t.shape})),axis);if(0===util_1.sizeFromShape(outShape))return tensor_ops_1.tensor([],outShape);if(1===($tensors=$tensors.filter((function(t){return t.size>0}))).length)return $tensors[0];var shapes=$tensors.map((function(t){return t.shape}));concat_util_1.assertParamsConsistent(shapes,axis);var der=function(dy){var sizeSplits=shapes.map((function(s){return s[axis]})),derTensors;return exports.split(dy,sizeSplits,axis).map((function(t){return function(){return t}}))},inputs=$tensors;return engine_1.ENGINE.runKernel((function(backend){return backend.concat($tensors,axis)}),inputs,der)}function split_(x,numOrSizeSplits,axis){void 0===axis&&(axis=0);var $x=tensor_util_env_1.convertToTensor(x,"x","split"),splitSizes;axis=util_2.parseAxisParam(axis,$x.shape)[0],"number"==typeof numOrSizeSplits?(util_1.assert($x.shape[axis]%numOrSizeSplits==0,(function(){return"Number of splits must evenly divide the axis."})),splitSizes=new Array(numOrSizeSplits).fill($x.shape[axis]/numOrSizeSplits)):(util_1.assert($x.shape[axis]===numOrSizeSplits.reduce((function(a,b){return a+b})),(function(){return"The sum of sizes must match the size of the axis dimension."})),splitSizes=numOrSizeSplits);var der=function(dy){return{$x:function(){return exports.concat(dy,axis)}}};return engine_1.ENGINE.runKernel((function(backend){return backend.split($x,splitSizes,axis)}),{$x:$x},der)}exports.concat=operation_1.op({concat_:concat_}),exports.concat1d=operation_1.op({concat1d_:concat1d_}),exports.concat2d=operation_1.op({concat2d_:concat2d_}),exports.concat3d=operation_1.op({concat3d_:concat3d_}),exports.concat4d=operation_1.op({concat4d_:concat4d_}),exports.split=operation_1.op({split_:split_})},{"../engine":150,"../tensor_util_env":244,"../util":248,"./concat_util":181,"./operation":202,"./tensor_ops":223}],181:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2017 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var util=require("../util");function assertParamsConsistent(shapes,axis){var rank=shapes[0].length;shapes.forEach((function(shape,i){util.assert(shape.length===rank,(function(){return"Error in concat"+rank+"D: rank of tensors["+i+"] must be the same as the rank of the rest ("+rank+")"}))})),util.assert(axis>=0&&axis<rank,(function(){return"Error in concat"+rank+"D: axis must be between 0 and "+(rank-1)+"."}));var firstShape=shapes[0];shapes.forEach((function(shape,i){for(var r=0;r<rank;r++)util.assert(r===axis||shape[r]===firstShape[r],(function(){return"Error in concat"+rank+"D: Shape of tensors["+i+"] ("+shape+") does not match the shape of the rest ("+firstShape+") along the non-concatenated axis "+i+"."}))}))}function computeOutShape(shapes,axis){for(var outputShape=shapes[0].slice(),i=1;i<shapes.length;i++)outputShape[axis]+=shapes[i][axis];return outputShape}exports.assertParamsConsistent=assertParamsConsistent,exports.computeOutShape=computeOutShape},{"../util":248}],182:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var tensor_util_env_1=require("../tensor_util_env"),util=require("../util"),array_ops_1=require("./array_ops"),operation_1=require("./operation");function confusionMatrix_(labels,predictions,numClasses){var $labels=tensor_util_env_1.convertToTensor(labels,"labels","confusionMatrix"),$predictions=tensor_util_env_1.convertToTensor(predictions,"predictions","confusionMatrix");util.assert(null==numClasses||numClasses>0&&Number.isInteger(numClasses),(function(){return"If provided, numClasses must be a positive integer, but got "+numClasses})),util.assert(1===$labels.rank,(function(){return"Expected the rank of labels to be 1, but got "+$labels.rank})),util.assert(1===$predictions.rank,(function(){return"Expected the rank of predictions to be 1, but got "+$predictions.rank})),util.assert($labels.shape[0]===$predictions.shape[0],(function(){return"Mismatch in the number of examples: "+$labels.shape[0]+" vs. "+$predictions.shape[0]+". Labels and predictions should have the same number of elements."})),util.assert(numClasses>0&&Number.isInteger(numClasses),(function(){return"numClasses is required to be a positive integer, but got "+numClasses}));var oneHotLabels=array_ops_1.oneHot($labels.asType("int32"),numClasses),oneHotPredictions=array_ops_1.oneHot($predictions.asType("int32"),numClasses);return oneHotLabels.transpose().matMul(oneHotPredictions).asType("int32")}exports.confusionMatrix_=confusionMatrix_,exports.confusionMatrix=operation_1.op({confusionMatrix_:confusionMatrix_})},{"../tensor_util_env":244,"../util":248,"./array_ops":170,"./operation":202}],183:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),tensor_util_env_1=require("../tensor_util_env"),util=require("../util"),conv_util=require("./conv_util"),operation_1=require("./operation");function conv1d_(x,filter,stride,pad,dataFormat,dilation,dimRoundingMode){void 0===dataFormat&&(dataFormat="NWC"),void 0===dilation&&(dilation=1);var $x=tensor_util_env_1.convertToTensor(x,"x","conv1d"),$filter=tensor_util_env_1.convertToTensor(filter,"filter","conv1d"),x3D=$x,reshapedTo3D=!1;2===$x.rank&&(reshapedTo3D=!0,x3D=$x.as3D(1,$x.shape[0],$x.shape[1])),util.assert(3===x3D.rank,(function(){return"Error in conv1d: input must be rank 3, but got rank "+x3D.rank+"."})),util.assert(3===$filter.rank,(function(){return"Error in conv1d: filter must be rank 3, but got rank "+$filter.rank+"."})),null!=dimRoundingMode&&util.assert(util.isInt(pad),(function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+dimRoundingMode+" but got pad "+pad+"."})),util.assert(x3D.shape[2]===$filter.shape[1],(function(){return"Error in conv1d: depth of input ("+x3D.shape[2]+") must match input depth for filter "+$filter.shape[1]+"."})),util.assert(conv_util.eitherStridesOrDilationsAreOne(stride,dilation),(function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+stride+" and dilation '"+dilation+"'"})),util.assert("NWC"===dataFormat,(function(){return"Error in conv1d: got dataFormat of "+dataFormat+" but only NWC is currently supported."}));var filter4D=$filter.as4D(1,$filter.shape[0],$filter.shape[1],$filter.shape[2]),input4D=x3D.as4D(x3D.shape[0],1,x3D.shape[1],x3D.shape[2]),strides=[1,stride],dilations=[1,dilation],conv2dDataFormat="NHWC",res=exports.conv2d(input4D,filter4D,strides,pad,"NHWC",dilations,dimRoundingMode);return reshapedTo3D?res.as2D(res.shape[2],res.shape[3]):res.as3D(res.shape[0],res.shape[2],res.shape[3])}function conv2d_(x,filter,strides,pad,dataFormat,dilations,dimRoundingMode){void 0===dataFormat&&(dataFormat="NHWC"),void 0===dilations&&(dilations=[1,1]);var $x=tensor_util_env_1.convertToTensor(x,"x","conv2d"),$filter=tensor_util_env_1.convertToTensor(filter,"filter","conv2d"),x4D=$x,reshapedTo4D=!1;3===$x.rank&&(reshapedTo4D=!0,x4D=$x.as4D(1,$x.shape[0],$x.shape[1],$x.shape[2])),util.assert(4===x4D.rank,(function(){return"Error in conv2d: input must be rank 4, but got rank "+x4D.rank+"."})),util.assert(4===$filter.rank,(function(){return"Error in conv2d: filter must be rank 4, but got rank "+$filter.rank+"."})),null!=dimRoundingMode&&util.assert(util.isInt(pad),(function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+dimRoundingMode+" but got pad "+pad+"."}));var inDepth="NHWC"===dataFormat?x4D.shape[3]:x4D.shape[1];util.assert(inDepth===$filter.shape[2],(function(){return"Error in conv2d: depth of input ("+inDepth+") must match input depth for filter "+$filter.shape[2]+"."})),util.assert(conv_util.eitherStridesOrDilationsAreOne(strides,dilations),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+strides+" and dilations '"+dilations+"'"}));var $dataFormat=conv_util.convertConv2DDataFormat(dataFormat),convInfo=conv_util.computeConv2DInfo(x4D.shape,$filter.shape,strides,dilations,pad,dimRoundingMode,!1,$dataFormat),grad=function(dy,saved){var _a=saved,$filter=_a[0],x4D=_a[1];return util.assert(conv_util.tupleValuesAreOne(dilations),(function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+dilations+"'"})),{x:function(){return conv2dDerInput_(x4D.shape,dy,$filter,strides,pad,dataFormat)},$filter:function(){return conv2dDerFilter_(x4D,dy,$filter.shape,strides,pad,dataFormat)}}},res=engine_1.ENGINE.runKernel((function(backend,save){var res=backend.conv2d(x4D,$filter,convInfo);return save([$filter,x4D]),res}),{x:x4D,$filter:$filter},grad);return reshapedTo4D?res.as3D(res.shape[1],res.shape[2],res.shape[3]):res}function conv2dDerInput_(xShape,dy,filter,strides,pad,dataFormat,dimRoundingMode){void 0===dataFormat&&(dataFormat="NHWC"),util.assert(xShape.length===dy.rank,(function(){return"Length of inShape ("+xShape.length+") and rank of dy ("+dy.rank+") must match"}));var xShape4D=xShape,dy4D=dy,reshapedTo4D=!1;3===dy.rank&&(reshapedTo4D=!0,dy4D=dy.as4D(1,dy.shape[0],dy.shape[1],dy.shape[2]),xShape4D=[1,xShape[0],xShape[1],xShape[2]]),util.assert(4===xShape4D.length,(function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+xShape4D.length+"."})),util.assert(4===dy4D.rank,(function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+dy4D.rank})),util.assert(4===filter.rank,(function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+filter.rank}));var inDepth="NHWC"===dataFormat?xShape4D[3]:xShape4D[1],outDepth="NHWC"===dataFormat?dy4D.shape[3]:dy4D.shape[1];util.assert(inDepth===filter.shape[2],(function(){return"Error in conv2dDerInput: depth of input ("+inDepth+") must match input depth for filter "+filter.shape[2]+"."})),util.assert(outDepth===filter.shape[3],(function(){return"Error in conv2dDerInput: depth of output ("+outDepth+") must match output depth for filter "+filter.shape[3]+"."})),null!=dimRoundingMode&&util.assert(util.isInt(pad),(function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+dimRoundingMode+" but got pad "+pad+"."}));var dilations=1,grad=function(ddx,saved){var filter=saved[0],dy4D=saved[1];return{dy4D:function(){return exports.conv2d(ddx,filter,strides,pad,dataFormat,1,dimRoundingMode)},filter:function(){return exports.conv2dDerFilter(ddx,dy4D,filter.shape,strides,pad,dataFormat,dimRoundingMode)}}},$dataFormat=conv_util.convertConv2DDataFormat(dataFormat),convInfo=conv_util.computeConv2DInfo(xShape4D,filter.shape,strides,1,pad,dimRoundingMode,!1,$dataFormat),res=engine_1.ENGINE.runKernel((function(backend,save){var res=backend.conv2dDerInput(dy4D,filter,convInfo);return save([filter,dy4D]),res}),{dy4D:dy4D,filter:filter},grad);return reshapedTo4D?res.as3D(res.shape[1],res.shape[2],res.shape[3]):res}function conv2dDerFilter_(x,dy,filterShape,strides,pad,dataFormat,dimRoundingMode){void 0===dataFormat&&(dataFormat="NHWC");var x4D=x;3===x.rank&&(x4D=x.as4D(1,x.shape[0],x.shape[1],x.shape[2]));var dy4D=dy;3===dy4D.rank&&(dy4D=dy.as4D(1,dy.shape[0],dy.shape[1],dy.shape[2])),util.assert(4===x4D.rank,(function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+x4D.shape+"."})),util.assert(4===dy4D.rank,(function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+dy4D.shape+"."})),util.assert(4===filterShape.length,(function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+filterShape+"."}));var inDepth="NHWC"===dataFormat?x4D.shape[3]:x4D.shape[1],outDepth="NHWC"===dataFormat?dy4D.shape[3]:dy4D.shape[1];util.assert(inDepth===filterShape[2],(function(){return"Error in conv2dDerFilter: depth of input "+inDepth+") must match input depth in filter ("+filterShape[2]+"."})),util.assert(outDepth===filterShape[3],(function(){return"Error in conv2dDerFilter: depth of dy ("+outDepth+") must match output depth for filter ("+filterShape[3]+")."})),null!=dimRoundingMode&&util.assert(util.isInt(pad),(function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+dimRoundingMode+" but got pad "+pad+"."}));var dilations=1,$dataFormat=conv_util.convertConv2DDataFormat(dataFormat),convInfo=conv_util.computeConv2DInfo(x4D.shape,filterShape,strides,1,pad,dimRoundingMode,!1,$dataFormat);return engine_1.ENGINE.runKernel((function(backend){return backend.conv2dDerFilter(x4D,dy4D,convInfo)}),{x4D:x4D,dy4D:dy4D})}function conv2dTranspose_(x,filter,outputShape,strides,pad,dimRoundingMode){var $x,$filter;return conv2dDerInput_(outputShape,tensor_util_env_1.convertToTensor(x,"x","conv2dTranspose"),tensor_util_env_1.convertToTensor(filter,"filter","conv2dTranspose"),strides,pad,"NHWC",dimRoundingMode)}function depthwiseConv2d_(x,filter,strides,pad,dataFormat,dilations,dimRoundingMode){void 0===dataFormat&&(dataFormat="NHWC"),void 0===dilations&&(dilations=[1,1]);var $x=tensor_util_env_1.convertToTensor(x,"x","depthwiseConv2d"),$filter=tensor_util_env_1.convertToTensor(filter,"filter","depthwiseConv2d"),x4D=$x,reshapedTo4D=!1;3===$x.rank&&(reshapedTo4D=!0,x4D=$x.as4D(1,$x.shape[0],$x.shape[1],$x.shape[2])),util.assert(4===x4D.rank,(function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+x4D.rank+"."})),util.assert(4===$filter.rank,(function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+$filter.rank+"."})),util.assert(x4D.shape[3]===$filter.shape[2],(function(){return"Error in depthwiseConv2d: number of input channels ("+x4D.shape[3]+") must match the inChannels dimension in filter "+$filter.shape[2]+"."})),null==dilations&&(dilations=[1,1]),util.assert(conv_util.eitherStridesOrDilationsAreOne(strides,dilations),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+strides+" and dilations '"+dilations+"'"})),null!=dimRoundingMode&&util.assert(util.isInt(pad),(function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+dimRoundingMode+" but got pad "+pad+"."}));var convInfo=conv_util.computeConv2DInfo(x4D.shape,$filter.shape,strides,dilations,pad,dimRoundingMode,!0),grad=function(dy,saved){util.assert(conv_util.tupleValuesAreOne(dilations),(function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+dilations+"'"}));var x4D=saved[0],$filter=saved[1];return{x:function(){return depthwiseConv2dDerInput(x4D.shape,dy,$filter,convInfo)},$filter:function(){return depthwiseConv2dDerFilter(x4D,dy,$filter.shape,convInfo)}}},res=engine_1.ENGINE.runKernel((function(backend,save){var res=backend.depthwiseConv2D(x4D,$filter,convInfo);return save([x4D,$filter]),res}),{x:x4D,$filter:$filter},grad);return reshapedTo4D?res.as3D(res.shape[1],res.shape[2],res.shape[3]):res}function separableConv2d_(x,depthwiseFilter,pointwiseFilter,strides,pad,dilation,dataFormat){void 0===dilation&&(dilation=[1,1]),void 0===dataFormat&&(dataFormat="NHWC");var $x=tensor_util_env_1.convertToTensor(x,"x","separableConv2d"),$depthwiseFilter=tensor_util_env_1.convertToTensor(depthwiseFilter,"depthwiseFilter","separableConv2d"),$pointwiseFilter=tensor_util_env_1.convertToTensor(pointwiseFilter,"pointwiseFilter","separableConv2d"),x4D=$x,reshapedTo4D=!1;if(3===$x.rank&&(reshapedTo4D=!0,x4D=$x.as4D(1,$x.shape[0],$x.shape[1],$x.shape[2])),"NCHW"===dataFormat)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");util.assert(4===x4D.rank,(function(){return"Error in separableConv2d: input must be rank 4, but got rank "+x4D.rank+"."})),util.assert(4===$depthwiseFilter.rank,(function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+$depthwiseFilter.rank+"."})),util.assert(4===$pointwiseFilter.rank,(function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+$depthwiseFilter.rank+"."})),util.assert(1===$pointwiseFilter.shape[0],(function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+$pointwiseFilter.shape[0]+"."})),util.assert(1===$pointwiseFilter.shape[1],(function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+$pointwiseFilter.shape[1]+"."}));var inChannels=$depthwiseFilter.shape[2],channelMultiplier=$depthwiseFilter.shape[3];util.assert($pointwiseFilter.shape[2]===inChannels*channelMultiplier,(function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+inChannels*channelMultiplier+", but got "+$pointwiseFilter.shape[2]+"."}));var depthwise=exports.depthwiseConv2d(x4D,$depthwiseFilter,strides,pad,dataFormat,dilation),pointwiseStride=1,res=exports.conv2d(depthwise,$pointwiseFilter,1,"valid",dataFormat);return reshapedTo4D?res.as3D(res.shape[1],res.shape[2],res.shape[3]):res}function parseTupleParam(param){return"number"==typeof param?[param,param,param]:2===param.length?[param[0],param[1],1]:param}function tupleValuesAreOne(param){var _a=parseTupleParam(param),dimA=_a[0],dimB=_a[1],dimC=_a[2];return 1===dimA&&1===dimB&&1===dimC}function eitherStridesOrDilationsAreOne(strides,dilations){return tupleValuesAreOne(strides)||tupleValuesAreOne(dilations)}function depthwiseConv2dDerInput(xShape,dy,filter,convInfo){var dy4D=dy,reshapedTo4D=!1;3===dy.rank&&(reshapedTo4D=!0,dy4D=dy.as4D(1,dy.shape[0],dy.shape[1],dy.shape[2]));var res=engine_1.ENGINE.runKernel((function(backend){return backend.depthwiseConv2DDerInput(dy4D,filter,convInfo)}),{dy4D:dy4D});return reshapedTo4D?res.as3D(res.shape[1],res.shape[2],res.shape[3]):res}function depthwiseConv2dDerFilter(x,dy,filterShape,convInfo){var x4D=x;3===x.rank&&(x4D=x.as4D(1,x.shape[0],x.shape[1],x.shape[2]));var dy4D=dy;return 3===dy4D.rank&&(dy4D=dy.as4D(1,dy.shape[0],dy.shape[1],dy.shape[2])),engine_1.ENGINE.runKernel((function(backend){return backend.depthwiseConv2DDerFilter(x4D,dy4D,convInfo)}),{x4D:x4D,dy4D:dy4D})}function conv3d_(x,filter,strides,pad,dataFormat,dilations){void 0===dataFormat&&(dataFormat="NDHWC"),void 0===dilations&&(dilations=[1,1,1]);var $x=tensor_util_env_1.convertToTensor(x,"x","conv3d"),$filter=tensor_util_env_1.convertToTensor(filter,"filter","conv3d"),x5D=$x,reshapedTo5D=!1;4===$x.rank&&(reshapedTo5D=!0,x5D=$x.as5D(1,$x.shape[0],$x.shape[1],$x.shape[2],$x.shape[3])),util.assert(5===x5D.rank,(function(){return"Error in conv3d: input must be rank 5, but got rank "+x5D.rank+"."})),util.assert(5===$filter.rank,(function(){return"Error in conv3d: filter must be rank 5, but got rank "+$filter.rank+"."})),util.assert(x5D.shape[4]===$filter.shape[3],(function(){return"Error in conv3d: depth of input ("+x5D.shape[4]+") must match input depth for filter "+$filter.shape[3]+"."})),util.assert(eitherStridesOrDilationsAreOne(strides,dilations),(function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+strides+" and dilations '"+dilations+"'"})),util.assert("NDHWC"===dataFormat,(function(){return"Error in conv3d: got dataFormat of "+dataFormat+" but only NDHWC is currently supported."}));var convInfo=conv_util.computeConv3DInfo(x5D.shape,$filter.shape,strides,dilations,pad),grad=function(dy,saved){util.assert(tupleValuesAreOne(dilations),(function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+dilations+"'"}));var x5D=saved[0],$filter=saved[1];return{x:function(){return conv3dDerInput_(x5D.shape,dy,$filter,strides,pad)},$filter:function(){return conv3dDerFilter_(x5D,dy,$filter.shape,strides,pad)}}},res=engine_1.ENGINE.runKernel((function(backend,save){var res=backend.conv3d(x5D,$filter,convInfo);return save([x5D,$filter]),res}),{x:x5D,$filter:$filter},grad);return reshapedTo5D?res.as4D(res.shape[1],res.shape[2],res.shape[3],res.shape[4]):res}function conv3dDerInput_(xShape,dy,filter,strides,pad){util.assert(xShape.length===dy.rank,(function(){return"Length of inShape ("+xShape.length+") and rank of dy ("+dy.rank+") must match"}));var xShape5D=xShape,dy5D=dy,reshapedTo5D=!1;4===dy.rank&&(reshapedTo5D=!0,dy5D=dy.as5D(1,dy.shape[0],dy.shape[1],dy.shape[2],dy.shape[3]),xShape5D=[1,xShape[0],xShape[1],xShape[2],xShape[3]]);var inDepth=xShape5D[4],outDepth=dy5D.shape[4];util.assert(5===xShape5D.length,(function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+xShape5D.length+"."})),util.assert(5===dy5D.rank,(function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+dy5D.rank})),util.assert(5===filter.rank,(function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+filter.rank})),util.assert(inDepth===filter.shape[3],(function(){return"Error in conv3dDerInput: depth of input ("+inDepth+") must match input depth for filter "+filter.shape[3]+"."})),util.assert(outDepth===filter.shape[4],(function(){return"Error in conv3dDerInput: depth of output ("+outDepth+") must match output depth for filter "+filter.shape[4]+"."}));var dilations=1,convInfo=conv_util.computeConv3DInfo(xShape5D,filter.shape,strides,1,pad),res=engine_1.ENGINE.runKernel((function(backend){return backend.conv3dDerInput(dy5D,filter,convInfo)}),{dy5D:dy5D});return reshapedTo5D?res.as4D(res.shape[1],res.shape[2],res.shape[3],res.shape[4]):res}function conv3dDerFilter_(x,dy,filterShape,strides,pad){var x5D=x;4===x.rank&&(x5D=x.as5D(1,x.shape[0],x.shape[1],x.shape[2],x.shape[3]));var dy5D=dy;4===dy5D.rank&&(dy5D=dy.as5D(1,dy.shape[0],dy.shape[1],dy.shape[2],dy.shape[3])),util.assert(5===x5D.rank,(function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+x5D.shape+"."})),util.assert(5===dy5D.rank,(function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+dy5D.shape+"."})),util.assert(5===filterShape.length,(function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+filterShape+"."})),util.assert(x5D.shape[4]===filterShape[3],(function(){return"Error in conv3dDerFilter: depth of input "+x5D.shape[4]+") must match input depth in filter ("+filterShape[3]+"."})),util.assert(dy5D.shape[4]===filterShape[4],(function(){return"Error in conv3dDerFilter: depth of dy ("+dy5D.shape[4]+") must match output depth for filter ("+filterShape[4]+")."}));var dilations=1,convInfo=conv_util.computeConv3DInfo(x5D.shape,filterShape,strides,1,pad);return engine_1.ENGINE.runKernel((function(backend){return backend.conv3dDerFilter(x5D,dy5D,convInfo)}),{x5D:x5D,dy5D:dy5D})}function conv3dTranspose_(x,filter,outputShape,strides,pad){var $x,$filter;return conv3dDerInput_(outputShape,tensor_util_env_1.convertToTensor(x,"x","conv3dTranspose"),tensor_util_env_1.convertToTensor(filter,"filter","conv3dTranspose"),strides,pad)}exports.conv1d=operation_1.op({conv1d_:conv1d_}),exports.conv2d=operation_1.op({conv2d_:conv2d_}),exports.conv3d=operation_1.op({conv3d_:conv3d_}),exports.conv2dDerFilter=operation_1.op({conv2dDerFilter_:conv2dDerFilter_}),exports.conv2dDerInput=operation_1.op({conv2dDerInput_:conv2dDerInput_}),exports.depthwiseConv2d=operation_1.op({depthwiseConv2d_:depthwiseConv2d_}),exports.separableConv2d=operation_1.op({separableConv2d_:separableConv2d_}),exports.conv2dTranspose=operation_1.op({conv2dTranspose_:conv2dTranspose_}),exports.conv3dTranspose=operation_1.op({conv3dTranspose_:conv3dTranspose_})},{"../engine":150,"../tensor_util_env":244,"../util":248,"./conv_util":184,"./operation":202}],184:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2017 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var util=require("../util");function computePool2DInfo(inShape,filterSize,strides,dilations,pad,roundingMode,dataFormat){void 0===dataFormat&&(dataFormat="channelsLast");var _a=parseTupleParam(filterSize),filterHeight=_a[0],filterWidth=_a[1],filterShape;if("channelsLast"===dataFormat)filterShape=[filterHeight,filterWidth,inShape[3],inShape[3]];else{if("channelsFirst"!==dataFormat)throw new Error("Unknown dataFormat "+dataFormat);filterShape=[filterHeight,filterWidth,inShape[1],inShape[1]]}return computeConv2DInfo(inShape,filterShape,strides,dilations,pad,roundingMode,!1,dataFormat)}function computePool3DInfo(inShape,filterSize,strides,dilations,pad,roundingMode,dataFormat){void 0===dataFormat&&(dataFormat="NDHWC");var _a=parse3TupleParam(filterSize),filterDepth=_a[0],filterHeight=_a[1],filterWidth=_a[2],filterShape,$dataFormat;if("NDHWC"===dataFormat)$dataFormat="channelsLast",filterShape=[filterDepth,filterHeight,filterWidth,inShape[4],inShape[4]];else{if("NCDHW"!==dataFormat)throw new Error("Unknown dataFormat "+dataFormat);$dataFormat="channelsFirst",filterShape=[filterDepth,filterHeight,filterWidth,inShape[1],inShape[1]]}return computeConv3DInfo(inShape,filterShape,strides,dilations,pad,!1,$dataFormat,roundingMode)}function computeConv2DInfo(inShape,filterShape,strides,dilations,pad,roundingMode,depthwise,dataFormat){void 0===depthwise&&(depthwise=!1),void 0===dataFormat&&(dataFormat="channelsLast");var _a=[-1,-1,-1,-1],batchSize=_a[0],inHeight=_a[1],inWidth=_a[2],inChannels=_a[3];if("channelsLast"===dataFormat)batchSize=inShape[0],inHeight=inShape[1],inWidth=inShape[2],inChannels=inShape[3];else{if("channelsFirst"!==dataFormat)throw new Error("Unknown dataFormat "+dataFormat);batchSize=inShape[0],inChannels=inShape[1],inHeight=inShape[2],inWidth=inShape[3]}var filterHeight=filterShape[0],filterWidth=filterShape[1],filterChannels=filterShape[3],_b=parseTupleParam(strides),strideHeight=_b[0],strideWidth=_b[1],_c=parseTupleParam(dilations),dilationHeight=_c[0],dilationWidth=_c[1],effectiveFilterHeight=getEffectiveFilterSize(filterHeight,dilationHeight),effectiveFilterWidth=getEffectiveFilterSize(filterWidth,dilationWidth),_d=getPadAndOutInfo(pad,inHeight,inWidth,strideHeight,strideWidth,effectiveFilterHeight,effectiveFilterWidth,roundingMode),padInfo=_d.padInfo,outHeight=_d.outHeight,outWidth=_d.outWidth,outChannels=depthwise?filterChannels*inChannels:filterChannels,outShape;return"channelsFirst"===dataFormat?outShape=[batchSize,outChannels,outHeight,outWidth]:"channelsLast"===dataFormat&&(outShape=[batchSize,outHeight,outWidth,outChannels]),{batchSize:batchSize,dataFormat:dataFormat,inHeight:inHeight,inWidth:inWidth,inChannels:inChannels,outHeight:outHeight,outWidth:outWidth,outChannels:outChannels,padInfo:padInfo,strideHeight:strideHeight,strideWidth:strideWidth,filterHeight:filterHeight,filterWidth:filterWidth,effectiveFilterHeight:effectiveFilterHeight,effectiveFilterWidth:effectiveFilterWidth,dilationHeight:dilationHeight,dilationWidth:dilationWidth,inShape:inShape,outShape:outShape,filterShape:filterShape}}function computeConv3DInfo(inShape,filterShape,strides,dilations,pad,depthwise,dataFormat,roundingMode){void 0===depthwise&&(depthwise=!1),void 0===dataFormat&&(dataFormat="channelsLast");var _a=[-1,-1,-1,-1,-1],batchSize=_a[0],inDepth=_a[1],inHeight=_a[2],inWidth=_a[3],inChannels=_a[4];if("channelsLast"===dataFormat)batchSize=inShape[0],inDepth=inShape[1],inHeight=inShape[2],inWidth=inShape[3],inChannels=inShape[4];else{if("channelsFirst"!==dataFormat)throw new Error("Unknown dataFormat "+dataFormat);batchSize=inShape[0],inChannels=inShape[1],inDepth=inShape[2],inHeight=inShape[3],inWidth=inShape[4]}var filterDepth=filterShape[0],filterHeight=filterShape[1],filterWidth=filterShape[2],filterChannels=filterShape[4],_b=parse3TupleParam(strides),strideDepth=_b[0],strideHeight=_b[1],strideWidth=_b[2],_c=parse3TupleParam(dilations),dilationDepth=_c[0],dilationHeight=_c[1],dilationWidth=_c[2],effectiveFilterDepth=getEffectiveFilterSize(filterDepth,dilationDepth),effectiveFilterHeight=getEffectiveFilterSize(filterHeight,dilationHeight),effectiveFilterWidth=getEffectiveFilterSize(filterWidth,dilationWidth),_d=get3DPadAndOutInfo(pad,inDepth,inHeight,inWidth,strideDepth,strideHeight,strideWidth,effectiveFilterDepth,effectiveFilterHeight,effectiveFilterWidth,roundingMode),padInfo=_d.padInfo,outDepth=_d.outDepth,outHeight=_d.outHeight,outWidth=_d.outWidth,outChannels=depthwise?filterChannels*inChannels:filterChannels,outShape;return"channelsFirst"===dataFormat?outShape=[batchSize,outChannels,outDepth,outHeight,outWidth]:"channelsLast"===dataFormat&&(outShape=[batchSize,outDepth,outHeight,outWidth,outChannels]),{batchSize:batchSize,dataFormat:dataFormat,inDepth:inDepth,inHeight:inHeight,inWidth:inWidth,inChannels:inChannels,outDepth:outDepth,outHeight:outHeight,outWidth:outWidth,outChannels:outChannels,padInfo:padInfo,strideDepth:strideDepth,strideHeight:strideHeight,strideWidth:strideWidth,filterDepth:filterDepth,filterHeight:filterHeight,filterWidth:filterWidth,effectiveFilterDepth:effectiveFilterDepth,effectiveFilterHeight:effectiveFilterHeight,effectiveFilterWidth:effectiveFilterWidth,dilationDepth:dilationDepth,dilationHeight:dilationHeight,dilationWidth:dilationWidth,inShape:inShape,outShape:outShape,filterShape:filterShape}}function computeOutputShape2D(inShape,fieldSize,stride,zeroPad,roundingMode){null==zeroPad&&(zeroPad=computeDefaultPad(inShape,fieldSize,stride));var inputRows=inShape[0],inputCols=inShape[1],outputRows=conditionalRound((inputRows-fieldSize+2*zeroPad)/stride+1,roundingMode);util.assert(util.isInt(outputRows),(function(){return"The output # of rows ("+outputRows+") must be an integer. Change the stride and/or zero pad parameters"}));var outputCols=conditionalRound((inputCols-fieldSize+2*zeroPad)/stride+1,roundingMode);return util.assert(util.isInt(outputCols),(function(){return"The output # of columns ("+outputCols+") must be an integer. Change the stride and/or zero pad parameters"})),[outputRows,outputCols]}function computeOutputShape4D(inShape,fieldSize,outChannels,stride,zeroPad,roundingMode){null==zeroPad&&(zeroPad=computeDefaultPad(inShape,fieldSize,stride));var inputDepth=inShape[0],inputRows=inShape[1],inputCols=inShape[2],outputDepths=conditionalRound((inputDepth-fieldSize+2*zeroPad)/stride+1,roundingMode);util.assert(util.isInt(outputDepths),(function(){return"The output # of depths ("+outputDepths+") must be an integer. Change the stride and/or zero pad parameters"}));var outputRows=conditionalRound((inputRows-fieldSize+2*zeroPad)/stride+1,roundingMode);util.assert(util.isInt(outputRows),(function(){return"The output # of rows ("+outputRows+") must be an integer. Change the stride and/or zero pad parameters"}));var outputCols=conditionalRound((inputCols-fieldSize+2*zeroPad)/stride+1,roundingMode);return util.assert(util.isInt(outputCols),(function(){return"The output # of columns ("+outputCols+") must be an integer. Change the stride and/or zero pad parameters"})),[outputDepths,outputRows,outputCols,outChannels]}function computeDefaultPad(inputShape,fieldSize,stride,dilation){void 0===dilation&&(dilation=1);var effectiveFieldSize=getEffectiveFilterSize(fieldSize,dilation);return Math.floor((inputShape[0]*(stride-1)-stride+effectiveFieldSize)/2)}function parseTupleParam(param){return"number"==typeof param?[param,param,param]:2===param.length?[param[0],param[1],1]:param}function parse3TupleParam(param){return"number"==typeof param?[param,param,param]:param}function getEffectiveFilterSize(filterSize,dilation){return dilation<=1?filterSize:filterSize+(filterSize-1)*(dilation-1)}function getPadAndOutInfo(pad,inHeight,inWidth,strideHeight,strideWidth,filterHeight,filterWidth,roundingMode){var padInfo,outHeight,outWidth;if("number"==typeof pad){var padType;padInfo={top:pad,bottom:pad,left:pad,right:pad,type:0===pad?"VALID":"NUMBER"};var outShape=computeOutputShape2D([inHeight,inWidth],filterHeight,strideHeight,pad,roundingMode);outHeight=outShape[0],outWidth=outShape[1]}else if("same"===pad){outHeight=Math.ceil(inHeight/strideHeight),outWidth=Math.ceil(inWidth/strideWidth);var padAlongHeight=Math.max(0,(outHeight-1)*strideHeight+filterHeight-inHeight),padAlongWidth=Math.max(0,(outWidth-1)*strideWidth+filterWidth-inWidth),top_1=Math.floor(padAlongHeight/2),bottom=padAlongHeight-top_1,left=Math.floor(padAlongWidth/2),right;padInfo={top:top_1,bottom:bottom,left:left,right:padAlongWidth-left,type:"SAME"}}else{if("valid"!==pad)throw Error("Unknown padding parameter: "+pad);padInfo={top:0,bottom:0,left:0,right:0,type:"VALID"},outHeight=Math.ceil((inHeight-filterHeight+1)/strideHeight),outWidth=Math.ceil((inWidth-filterWidth+1)/strideWidth)}return{padInfo:padInfo,outHeight:outHeight,outWidth:outWidth}}function get3DPadAndOutInfo(pad,inDepth,inHeight,inWidth,strideDepth,strideHeight,strideWidth,filterDepth,filterHeight,filterWidth,roundingMode){var padInfo,outDepth,outHeight,outWidth;if("number"==typeof pad){var padType;padInfo={top:pad,bottom:pad,left:pad,right:pad,front:pad,back:pad,type:0===pad?"VALID":"NUMBER"};var outShape=computeOutputShape4D([inDepth,inHeight,inWidth,1],filterDepth,1,strideDepth,pad,roundingMode);outDepth=outShape[0],outHeight=outShape[1],outWidth=outShape[2]}else if("same"===pad){var padAlongDepth=((outDepth=Math.ceil(inDepth/strideDepth))-1)*strideDepth+filterDepth-inDepth,padAlongHeight=((outHeight=Math.ceil(inHeight/strideHeight))-1)*strideHeight+filterHeight-inHeight,padAlongWidth=((outWidth=Math.ceil(inWidth/strideWidth))-1)*strideWidth+filterWidth-inWidth,front=Math.floor(padAlongDepth/2),back=padAlongDepth-front,top_2=Math.floor(padAlongHeight/2),bottom=padAlongHeight-top_2,left=Math.floor(padAlongWidth/2),right;padInfo={top:top_2,bottom:bottom,left:left,right:padAlongWidth-left,front:front,back:back,type:"SAME"}}else{if("valid"!==pad)throw Error("Unknown padding parameter: "+pad);padInfo={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},outDepth=Math.ceil((inDepth-filterDepth+1)/strideDepth),outHeight=Math.ceil((inHeight-filterHeight+1)/strideHeight),outWidth=Math.ceil((inWidth-filterWidth+1)/strideWidth)}return{padInfo:padInfo,outDepth:outDepth,outHeight:outHeight,outWidth:outWidth}}function conditionalRound(value,roundingMode){if(!roundingMode)return value;switch(roundingMode){case"round":return Math.round(value);case"ceil":return Math.ceil(value);case"floor":return Math.floor(value);default:throw new Error("Unknown roundingMode "+roundingMode)}}function tupleValuesAreOne(param){var _a=parseTupleParam(param),dimA=_a[0],dimB=_a[1],dimC=_a[2];return 1===dimA&&1===dimB&&1===dimC}function eitherStridesOrDilationsAreOne(strides,dilations){return tupleValuesAreOne(strides)||tupleValuesAreOne(dilations)}function convertConv2DDataFormat(dataFormat){if("NHWC"===dataFormat)return"channelsLast";if("NCHW"===dataFormat)return"channelsFirst";throw new Error("Unknown dataFormat "+dataFormat)}exports.computePool2DInfo=computePool2DInfo,exports.computePool3DInfo=computePool3DInfo,exports.computeConv2DInfo=computeConv2DInfo,exports.computeConv3DInfo=computeConv3DInfo,exports.computeDefaultPad=computeDefaultPad,exports.tupleValuesAreOne=tupleValuesAreOne,exports.eitherStridesOrDilationsAreOne=eitherStridesOrDilationsAreOne,exports.convertConv2DDataFormat=convertConv2DDataFormat},{"../util":248}],185:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),tensor_util_env_1=require("../tensor_util_env"),operation_1=require("./operation");function diag_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","diag").flatten(),outShape=x.shape.concat(x.shape);return engine_1.ENGINE.runKernel((function(backend){return backend.diag($x)}),{$x:$x}).reshape(outShape)}exports.diag=operation_1.op({diag_:diag_})},{"../engine":150,"../tensor_util_env":244,"./operation":202}],186:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var tensor_1=require("../tensor"),tensor_util_env_1=require("../tensor_util_env"),util=require("../util"),array_ops_1=require("./array_ops"),dropout_util_1=require("./dropout_util"),operation_1=require("./operation");function dropout_(x,rate,noiseShape,seed){var $x=tensor_util_env_1.convertToTensor(x,"x","dropout");if(util.assert("float32"===$x.dtype,(function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+$x.dtype+" tensor instead."})),util.assert(rate>=0&&rate<1,(function(){return"rate must be a float in the range [0, 1), but got "+rate+"."})),0===rate)return x instanceof tensor_1.Tensor?$x.clone():$x;var $noiseShape=dropout_util_1.getNoiseShape($x,noiseShape),keepProb=1-rate,multiplier=array_ops_1.randomUniform($noiseShape,0,1,"float32",seed).add(keepProb).floor().div(keepProb);return $x.mul(multiplier)}exports.dropout=operation_1.op({dropout_:dropout_})},{"../tensor":241,"../tensor_util_env":244,"../util":248,"./array_ops":170,"./dropout_util":187,"./operation":202}],187:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2019 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var util=require("../util");function getNoiseShape(x,noiseShape){if(null==noiseShape)return x.shape.slice();if(util.arraysEqual(x.shape,noiseShape))return noiseShape;if(x.shape.length===noiseShape.length){for(var newDimension=[],i=0;i<x.shape.length;i++)null==noiseShape[i]&&null!=x.shape[i]?newDimension.push(x.shape[i]):newDimension.push(noiseShape[i]);return newDimension}return noiseShape}exports.getNoiseShape=getNoiseShape},{"../util":248}],188:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0}),exports.ERF_P=.3275911,exports.ERF_A1=.254829592,exports.ERF_A2=-.284496736,exports.ERF_A3=1.421413741,exports.ERF_A4=-1.453152027,exports.ERF_A5=1.061405429},{}],189:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),conv_1=require("../ops/conv"),conv_util=require("../ops/conv_util"),operation_1=require("../ops/operation"),tensor_util_1=require("../tensor_util"),tensor_util_env_1=require("../tensor_util_env"),util=require("../util"),broadcast_util=require("./broadcast_util");function matMul_(_a){var _b,a=_a.a,b=_a.b,_c=_a.transposeA,transposeA=void 0!==_c&&_c,_d=_a.transposeB,transposeB=void 0!==_d&&_d,bias=_a.bias,_e=_a.activation,activation=void 0===_e?"linear":_e,preluActivationWeights=_a.preluActivationWeights,$a=tensor_util_env_1.convertToTensor(a,"a","fused matMul"),$b=tensor_util_env_1.convertToTensor(b,"b","fused matMul");_b=tensor_util_1.makeTypesMatch($a,$b),$a=_b[0],$b=_b[1];var innerShapeA=transposeA?$a.shape[$a.rank-2]:$a.shape[$a.rank-1],innerShapeB=transposeB?$b.shape[$b.rank-1]:$b.shape[$b.rank-2],outerShapeA=transposeA?$a.shape[$a.rank-1]:$a.shape[$a.rank-2],outerShapeB=transposeB?$b.shape[$b.rank-2]:$b.shape[$b.rank-1],outerDimsA=$a.shape.slice(0,-2),outerDimsB=$b.shape.slice(0,-2),batchDimA=util.sizeFromShape(outerDimsA),batchDimB=util.sizeFromShape(outerDimsB);util.assert($a.rank>=2&&$b.rank>=2&&$a.rank===$b.rank,(function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+$a.rank+" and "+$b.rank+"."})),util.assert(util.arraysEqual(outerDimsA,outerDimsB),(function(){return"Error in fused matMul: outer dimensions ("+outerDimsA+") and ("+outerDimsB+") of Tensors with shapes "+$a.shape+" and "+$b.shape+" must match."})),util.assert(innerShapeA===innerShapeB,(function(){return"Error in fused matMul: inner shapes ("+innerShapeA+") and ("+innerShapeB+") of Tensors with shapes "+$a.shape+" and "+$b.shape+" and transposeA="+transposeA+" and transposeB="+transposeB+" must match."}));var outShape=$a.shape.slice(0,-2).concat([outerShapeA,outerShapeB]),a3D=transposeA?$a.as3D(batchDimA,innerShapeA,outerShapeA):$a.as3D(batchDimA,outerShapeA,innerShapeA),b3D=transposeB?$b.as3D(batchDimB,outerShapeB,innerShapeB):$b.as3D(batchDimB,innerShapeB,outerShapeB),$bias,$preluActivationWeights;null!=bias&&($bias=tensor_util_env_1.convertToTensor(bias,"bias","fused matMul"),$bias=tensor_util_1.makeTypesMatch($bias,$a)[0],broadcast_util.assertAndGetBroadcastShape(outShape,$bias.shape)),null!=preluActivationWeights&&($preluActivationWeights=tensor_util_env_1.convertToTensor(preluActivationWeights,"prelu weights","fused matMul"));var grad=function(dy,saved){var a3D=saved[0],b3D=saved[1],y=saved[2],dyActivation;if(null==activation||"linear"===activation)dyActivation=dy;else{if("relu"!==activation)throw new Error("Gradient for activation "+activation+" has not been implemented yet.");dyActivation=dy.mul(y.step())}var biasGradient={};return null!=bias&&(biasGradient={$bias:function(){var res=dyActivation,reduceAxes=broadcast_util.getReductionAxes($bias.shape,dyActivation.shape);return reduceAxes.length>0&&(res=res.sum(reduceAxes)),res.reshape($bias.shape)}}),transposeA||transposeB?!transposeA&&transposeB?Object.assign({$a:function(){return dyActivation.matMul(b3D,!1,!1)},$b:function(){return dyActivation.matMul(a3D,!0,!1)}},biasGradient):transposeA&&!transposeB?Object.assign({$a:function(){return b3D.matMul(dyActivation,!1,!0)},$b:function(){return a3D.matMul(dyActivation,!1,!1)}},biasGradient):Object.assign({$a:function(){return b3D.matMul(dyActivation,!0,!0)},$b:function(){return dyActivation.matMul(a3D,!0,!0)}},biasGradient):Object.assign({$a:function(){return dyActivation.matMul(b3D,!1,!0)},$b:function(){return a3D.matMul(dyActivation,!0,!1)}},biasGradient)},inputs={$a:a3D,$b:b3D},res;return null!=bias&&(inputs.$bias=$bias),null!=preluActivationWeights&&(inputs.$preluActivationWeights=$preluActivationWeights),engine_1.ENGINE.runKernel((function(backend,save){var y=backend.fusedBatchMatMul({a:a3D,b:b3D,transposeA:transposeA,transposeB:transposeB,bias:$bias,activation:activation,preluActivationWeights:$preluActivationWeights});return save([a3D,b3D,y]),y}),inputs,grad).reshape(outShape)}function conv2d_(_a){var x=_a.x,filter=_a.filter,strides=_a.strides,pad=_a.pad,_b=_a.dataFormat,dataFormat=void 0===_b?"NHWC":_b,_c=_a.dilations,dilations=void 0===_c?[1,1]:_c,dimRoundingMode=_a.dimRoundingMode,bias=_a.bias,_d=_a.activation,activation=void 0===_d?"linear":_d,preluActivationWeights=_a.preluActivationWeights,$x=tensor_util_env_1.convertToTensor(x,"x","conv2d"),$filter=tensor_util_env_1.convertToTensor(filter,"filter","conv2d"),x4D=$x,reshapedTo4D=!1;3===$x.rank&&(reshapedTo4D=!0,x4D=$x.as4D(1,$x.shape[0],$x.shape[1],$x.shape[2])),util.assert(4===x4D.rank,(function(){return"Error in fused conv2d: input must be rank 4, but got rank "+x4D.rank+"."})),util.assert(4===$filter.rank,(function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+$filter.rank+"."})),null!=dimRoundingMode&&util.assert(util.isInt(pad),(function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+dimRoundingMode+" but got pad "+pad+"."})),util.assert(x4D.shape[3]===$filter.shape[2],(function(){return"Error in conv2d: depth of input ("+x4D.shape[3]+") must match input depth for filter "+$filter.shape[2]+"."})),util.assert(conv_util.eitherStridesOrDilationsAreOne(strides,dilations),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+strides+" and dilations '"+dilations+"'"})),util.assert("NHWC"===dataFormat,(function(){return"Error in conv2d: got dataFormat of "+dataFormat+" but only NHWC is currently supported."}));var convInfo=conv_util.computeConv2DInfo(x4D.shape,$filter.shape,strides,dilations,pad,dimRoundingMode),$bias,$preluActivationWeights;null!=bias&&($bias=tensor_util_env_1.convertToTensor(bias,"bias","fused conv2d"),$bias=tensor_util_1.makeTypesMatch($bias,$x)[0],broadcast_util.assertAndGetBroadcastShape(convInfo.outShape,$bias.shape)),null!=preluActivationWeights&&($preluActivationWeights=tensor_util_env_1.convertToTensor(preluActivationWeights,"prelu weights","fused conv2d"));var grad=function(dy,saved){var _a=saved,$filter=_a[0],x4D=_a[1],y=_a[2],dyActivation;if(null==activation||"linear"===activation)dyActivation=dy;else{if("relu"!==activation)throw new Error("Gradient for activation "+activation+" has not been implemented yet.");dyActivation=dy.mul(y.step())}util.assert(conv_util.tupleValuesAreOne(dilations),(function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+dilations+"'"}));var biasGradient={};return null!=bias&&(biasGradient={$bias:function(){var res=dyActivation,reduceAxes=broadcast_util.getReductionAxes($bias.shape,dyActivation.shape);return reduceAxes.length>0&&(res=res.sum(reduceAxes)),res.reshape($bias.shape)}}),Object.assign({x:function(){return conv_1.conv2dDerInput(x4D.shape,dyActivation,$filter,strides,pad)},$filter:function(){return conv_1.conv2dDerFilter(x4D,dyActivation,$filter.shape,strides,pad)}},biasGradient)},inputs={x:x4D,$filter:$filter};null!=bias&&(inputs.$bias=$bias),null!=preluActivationWeights&&(inputs.$preluActivationWeights=$preluActivationWeights);var res=engine_1.ENGINE.runKernel((function(backend,save){var res=backend.fusedConv2d(x4D,$filter,convInfo,$bias,activation,$preluActivationWeights);return save([$filter,x4D,res]),res}),inputs,grad);return reshapedTo4D?res.as3D(res.shape[1],res.shape[2],res.shape[3]):res}exports.matMul=operation_1.op({matMul_:matMul_}),exports.conv2d=operation_1.op({conv2d_:conv2d_})},{"../engine":150,"../ops/conv":183,"../ops/conv_util":184,"../ops/operation":202,"../tensor_util":243,"../tensor_util_env":244,"../util":248,"./broadcast_util":176}],190:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});
/**
 * @license
 * Copyright 2018 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
var engine_1=require("../engine"),tensor_util_env_1=require("../tensor_util_env"),operation_1=require("./operation");function gatherND_(x,indices){var $indices=tensor_util_env_1.convertToTensor(indices,"indices","gatherND","int32"),$x=tensor_util_env_1.convertToTensor(x,"x","gatherND");return engine_1.ENGINE.runKernel((function(backend){return backend.gatherND($x,$indices)}),{$x:$x,$indices:$indices})}exports.gatherND=operation_1.op({gatherND_:gatherND_})},{"../engine":150,"../tensor_util_env":244,"./operation":202}],191:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var util_1=require("../util");function prepareAndValidate(tensor,indices){if(tensor.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+tensor.rank+".");if(indices.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+indices.rank+".");if("int32"!==indices.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+indices.dtype+".");if(indices.shape[indices.rank-1]>tensor.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+indices.shape[indices.rank-1]+" vs. "+tensor.rank);if(0===tensor.size)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+tensor.shape+".");for(var indicesShape=indices.shape,sliceRank=indicesShape[indicesShape.length-1],nResult=1,i=0;i<indicesShape.length-1;++i)nResult*=indicesShape[i];var inputShape=tensor.shape,resultShape=indicesShape.slice();resultShape.pop();for(var sliceSize=1,i=sliceRank;i<tensor.rank;++i)sliceSize*=inputShape[i],resultShape.push(inputShape[i]);var strides=util_1.computeStrides(tensor.shape).map((function(stride){return stride/sliceSize})).concat([1]).slice(0,sliceRank);return[resultShape,nResult,sliceSize,strides]}exports.prepareAndValidate=prepareAndValidate},{"../util":248}],192:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P((function(resolve){resolve(result.value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},__generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}};Object.defineProperty(exports,"__esModule",{value:!0});var non_max_suppression_impl_1=require("../backends/non_max_suppression_impl"),engine_1=require("../engine"),tensor_util_env_1=require("../tensor_util_env"),util=require("../util"),operation_1=require("./operation");function resizeBilinear_(images,size,alignCorners){void 0===alignCorners&&(alignCorners=!1);var $images=tensor_util_env_1.convertToTensor(images,"images","resizeBilinear");util.assert(3===$images.rank||4===$images.rank,(function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+$images.rank+"."})),util.assert(2===size.length,(function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+size+"."}));var batchImages=$images,reshapedTo4D=!1;3===$images.rank&&(reshapedTo4D=!0,batchImages=$images.as4D(1,$images.shape[0],$images.shape[1],$images.shape[2]));var newHeight=size[0],newWidth=size[1],forward=function(backend,save){return save([batchImages]),backend.resizeBilinear(batchImages,newHeight,newWidth,alignCorners)},backward=function(dy,saved){return{batchImages:function(){return engine_1.ENGINE.runKernel((function(backend){return backend.resizeBilinearBackprop(dy,saved[0],alignCorners)}),{})}}},res=engine_1.ENGINE.runKernel(forward,{batchImages:batchImages},backward);return reshapedTo4D?res.as3D(res.shape[1],res.shape[2],res.shape[3]):res}function resizeNearestNeighbor_(images,size,alignCorners){void 0===alignCorners&&(alignCorners=!1);var $images=tensor_util_env_1.convertToTensor(images,"images","resizeNearestNeighbor");util.assert(3===$images.rank||4===$images.rank,(function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+$images.rank+"."})),util.assert(2===size.length,(function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+size+"."})),util.assert("float32"===$images.dtype||"int32"===$images.dtype,(function(){return"`images` must have `int32` or `float32` as dtype"}));var batchImages=$images,reshapedTo4D=!1;3===$images.rank&&(reshapedTo4D=!0,batchImages=$images.as4D(1,$images.shape[0],$images.shape[1],$images.shape[2]));var newHeight=size[0],newWidth=size[1],forward=function(backend,save){return save([batchImages]),backend.resizeNearestNeighbor(batchImages,newHeight,newWidth,alignCorners)},backward=function(dy,saved){return{batchImages:function(){return engine_1.ENGINE.runKernel((function(backend){return backend.resizeNearestNeighborBackprop(dy,saved[0],alignCorners)}),{})}}},res=engine_1.ENGINE.runKernel(forward,{batchImages:batchImages},backward);return reshapedTo4D?res.as3D(res.shape[1],res.shape[2],res.shape[3]):res}function nonMaxSuppression_(boxes,scores,maxOutputSize,iouThreshold,scoreThreshold){void 0===iouThreshold&&(iouThreshold=.5),void 0===scoreThreshold&&(scoreThreshold=Number.NEGATIVE_INFINITY);var $boxes=tensor_util_env_1.convertToTensor(boxes,"boxes","nonMaxSuppression"),$scores=tensor_util_env_1.convertToTensor(scores,"scores","nonMaxSuppression"),inputs=nonMaxSuppSanityCheck($boxes,$scores,maxOutputSize,iouThreshold,scoreThreshold);return maxOutputSize=inputs.maxOutputSize,iouThreshold=inputs.iouThreshold,scoreThreshold=inputs.scoreThreshold,engine_1.ENGINE.runKernel((function(b){return b.nonMaxSuppression($boxes,$scores,maxOutputSize,iouThreshold,scoreThreshold)}),{$boxes:$boxes})}function nonMaxSuppressionAsync_(boxes,scores,maxOutputSize,iouThreshold,scoreThreshold){return void 0===iouThreshold&&(iouThreshold=.5),void 0===scoreThreshold&&(scoreThreshold=Number.NEGATIVE_INFINITY),__awaiter(this,void 0,void 0,(function(){var $boxes,$scores,inputs,_a,boxesVals,scoresVals,res;return __generator(this,(function(_b){switch(_b.label){case 0:return $boxes=tensor_util_env_1.convertToTensor(boxes,"boxes","nonMaxSuppressionAsync"),$scores=tensor_util_env_1.convertToTensor(scores,"scores","nonMaxSuppressionAsync"),inputs=nonMaxSuppSanityCheck($boxes,$scores,maxOutputSize,iouThreshold,scoreThreshold),maxOutputSize=inputs.maxOutputSize,iouThreshold=inputs.iouThreshold,scoreThreshold=inputs.scoreThreshold,[4,Promise.all([$boxes.data(),$scores.data()])];case 1:return _a=_b.sent(),boxesVals=_a[0],scoresVals=_a[1],res=non_max_suppression_impl_1.nonMaxSuppressionImpl(boxesVals,scoresVals,maxOutputSize,iouThreshold,scoreThreshold),$boxes!==boxes&&$boxes.dispose(),$scores!==scores&&$scores.dispose(),[2,res]}}))}))}function nonMaxSuppSanityCheck(boxes,scores,maxOutputSize,iouThreshold,scoreThreshold){null==iouThreshold&&(iouThreshold=.5),null==scoreThreshold&&(scoreThreshold=Number.NEGATIVE_INFINITY);var numBoxes=boxes.shape[0];return maxOutputSize=Math.min(maxOutputSize,numBoxes),util.assert(0<=iouThreshold&&iouThreshold<=1,(function(){return"iouThreshold must be in [0, 1], but was '"+iouThreshold+"'"})),util.assert(2===boxes.rank,(function(){return"boxes must be a 2D tensor, but was of rank '"+boxes.rank+"'"})),util.assert(4===boxes.shape[1],(function(){return"boxes must have 4 columns, but 2nd dimension was "+boxes.shape[1]})),util.assert(1===scores.rank,(function(){return"scores must be a 1D tensor"})),util.assert(scores.shape[0]===numBoxes,(function(){return"scores has incompatible shape with boxes. Expected "+numBoxes+", but was "+scores.shape[0]})),{maxOutputSize:maxOutputSize,iouThreshold:iouThreshold,scoreThreshold:scoreThreshold}}function cropAndResize_(image,boxes,boxInd,cropSize,method,extrapolationValue){var $image=tensor_util_env_1.convertToTensor(image,"image","cropAndResize","float32"),$boxes=tensor_util_env_1.convertToTensor(boxes,"boxes","cropAndResize","float32"),$boxInd=tensor_util_env_1.convertToTensor(boxInd,"boxInd","cropAndResize","int32");method=method||"bilinear",extrapolationValue=extrapolationValue||0;var numBoxes=$boxes.shape[0];util.assert(4===$image.rank,(function(){return"Error in cropAndResize: image must be rank 4,but got rank "+$image.rank+"."})),util.assert(2===$boxes.rank&&4===$boxes.shape[1],(function(){return"Error in cropAndResize: boxes must be have size ["+numBoxes+",4] but had shape "+$boxes.shape+"."})),util.assert(1===$boxInd.rank&&$boxInd.shape[0]===numBoxes,(function(){return"Error in cropAndResize: boxInd must be have size ["+numBoxes+"] but had shape "+$boxes.shape+"."})),util.assert(2===cropSize.length,(function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+cropSize.length+"."})),util.assert(cropSize[0]>=1&&cropSize[1]>=1,(function(){return"cropSize must be atleast [1,1], but was "+cropSize})),util.assert("bilinear"===method||"nearest"===method,(function(){return"method must be bilinear or nearest, but was "+method}));var forward=function(backend,save){return backend.cropAndResize($image,$boxes,$boxInd,cropSize,method,extrapolationValue)},res;return engine_1.ENGINE.runKernel(forward,{$image:$image,$boxes:$boxes})}exports.resizeBilinear=operation_1.op({resizeBilinear_:resizeBilinear_}),exports.resizeNearestNeighbor=operation_1.op({resizeNearestNeighbor_:resizeNearestNeighbor_}),exports.nonMaxSuppression=operation_1.op({nonMaxSuppression_:nonMaxSuppression_}),exports.nonMaxSuppressionAsync=nonMaxSuppressionAsync_,exports.cropAndResize=operation_1.op({cropAndResize_:cropAndResize_})},{"../backends/non_max_suppression_impl":61,"../engine":150,"../tensor_util_env":244,"../util":248,"./operation":202}],193:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P((function(resolve){resolve(result.value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},__generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}};Object.defineProperty(exports,"__esModule",{value:!0});var tensor_util_env_1=require("../tensor_util_env"),util_1=require("../util"),tensor_ops_1=require("./tensor_ops");function inTopKAsync_(predictions,targets,k){return void 0===k&&(k=1),__awaiter(this,void 0,void 0,(function(){var $predictions,$targets,lastDim,predictionsVals,targetsVals,_a,batch,size,precision,b,offset,vals,valAndInd,i,i;return __generator(this,(function(_b){switch(_b.label){case 0:return $predictions=tensor_util_env_1.convertToTensor(predictions,"predictions","inTopK"),$targets=tensor_util_env_1.convertToTensor(targets,"targets","inTopK"),util_1.assert($predictions.rank>1,(function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+$predictions.rank})),util_1.assert($predictions.rank-1===$targets.rank,(function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+$predictions.rank+" and targets rank "+$targets.rank})),util_1.assertShapesMatch($predictions.shape.slice(0,$predictions.shape.length-1),$targets.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),lastDim=$predictions.shape[$predictions.shape.length-1],util_1.assert(k>0&&k<=lastDim,(function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+lastDim+"), but got "+k})),[4,$predictions.data()];case 1:return predictionsVals=_b.sent(),[4,$targets.data()];case 2:for(targetsVals=_b.sent(),_a=[predictionsVals.length/lastDim,lastDim],batch=_a[0],size=_a[1],precision=util_1.getTypedArrayFromDType("bool",batch),b=0;b<batch;b++){for(offset=b*size,vals=predictionsVals.subarray(offset,offset+size),valAndInd=[],i=0;i<vals.length;i++)valAndInd.push({value:vals[i],index:i});for(valAndInd.sort((function(a,b){return b.value-a.value})),precision[b]=0,i=0;i<k;i++)if(valAndInd[i].index===targetsVals[b]){precision[b]=1;break}}return predictions!==$predictions&&$predictions.dispose(),targets!==$targets&&$targets.dispose(),[2,tensor_ops_1.tensor(precision,$targets.shape,"bool")]}}))}))}exports.inTopKAsync=inTopKAsync_},{"../tensor_util_env":244,"../util":248,"./tensor_ops":223}],194:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),globals_1=require("../globals"),util_1=require("../util"),array_ops_1=require("./array_ops"),concat_split_1=require("./concat_split"),norm_1=require("./norm"),operation_1=require("./operation"),reduction_ops_1=require("./reduction_ops"),tensor_ops_1=require("./tensor_ops");function gramSchmidt_(xs){var inputIsTensor2D;if(Array.isArray(xs)){inputIsTensor2D=!1,util_1.assert(null!=xs&&xs.length>0,(function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"}));for(var dim_1=xs[0].shape[0],_loop_1=function(i){util_1.assert(xs[i].shape[0]===dim_1,(function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+xs[i].shape[0]+" vs. "+dim_1+")"}))},i=1;i<xs.length;++i)_loop_1(i)}else inputIsTensor2D=!0,xs=concat_split_1.split(xs,xs.shape[0],0).map((function(x){return array_ops_1.squeeze(x,[0])}));util_1.assert(xs.length<=xs[0].shape[0],(function(){return"Gram-Schmidt: Number of vectors ("+xs.length+") exceeds number of dimensions ("+xs[0].shape[0]+")."}));for(var ys=[],xs1d=xs,_loop_2=function(i){ys.push(engine_1.ENGINE.tidy((function(){var x=xs1d[i];if(i>0)for(var j=0;j<i;++j){var proj=reduction_ops_1.sum(ys[j].mulStrict(x)).mul(ys[j]);x=x.sub(proj)}return x.div(norm_1.norm(x,"euclidean"))})))},i=0;i<xs.length;++i)_loop_2(i);return inputIsTensor2D?array_ops_1.stack(ys,0):ys}function qr_(x,fullMatrices){if(void 0===fullMatrices&&(fullMatrices=!1),x.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+x.rank);if(2===x.rank)return qr2d(x,fullMatrices);var outerDimsProd=x.shape.slice(0,x.shape.length-2).reduce((function(value,prev){return value*prev})),x2ds=array_ops_1.unstack(x.reshape([outerDimsProd,x.shape[x.shape.length-2],x.shape[x.shape.length-1]]),0),q2ds_1=[],r2ds_1=[],q,r;return x2ds.forEach((function(x2d){var _a=qr2d(x2d,fullMatrices),q2d=_a[0],r2d=_a[1];q2ds_1.push(q2d),r2ds_1.push(r2d)})),[array_ops_1.stack(q2ds_1,0).reshape(x.shape),array_ops_1.stack(r2ds_1,0).reshape(x.shape)]}function qr2d(x,fullMatrices){return void 0===fullMatrices&&(fullMatrices=!1),engine_1.ENGINE.tidy((function(){if(2!==x.shape.length)throw new Error("qr2d() requires a 2D Tensor, but got a "+x.shape.length+"D Tensor.");for(var m=x.shape[0],n=x.shape[1],q=array_ops_1.eye(m),r=x.clone(),one2D=tensor_ops_1.tensor2d([[1]],[1,1]),w=one2D.clone(),iters=m>=n?n:m,_loop_3=function(j){var _a,rTemp=r,wTemp=w,qTemp=q;_a=engine_1.ENGINE.tidy((function(){var rjEnd1=r.slice([j,j],[m-j,1]),normX=rjEnd1.norm(),rjj=r.slice([j,j],[1,1]),s=tensor_ops_1.tensor2d([[-1]]).where(rjj.greater(0),tensor_ops_1.tensor2d([[1]])),u1=rjj.sub(s.mul(normX)),wPre=rjEnd1.div(u1);w=1===wPre.shape[0]?one2D.clone():one2D.concat(wPre.slice([1,0],[wPre.shape[0]-1,wPre.shape[1]]),0);var tau=s.matMul(u1).div(normX).neg(),rjEndAll=r.slice([j,0],[m-j,n]),tauTimesW=tau.mul(w);if(0===j)r=rjEndAll.sub(tauTimesW.matMul(w.transpose().matMul(rjEndAll)));else{var rTimesTau=rjEndAll.sub(tauTimesW.matMul(w.transpose().matMul(rjEndAll)));r=r.slice([0,0],[j,n]).concat(rTimesTau,0)}var qAllJEnd=q.slice([0,j],[m,q.shape[1]-j]);if(0===j)q=qAllJEnd.sub(qAllJEnd.matMul(w).matMul(tauTimesW.transpose()));else{var qTimesTau=qAllJEnd.sub(qAllJEnd.matMul(w).matMul(tauTimesW.transpose()));q=q.slice([0,0],[m,j]).concat(qTimesTau,1)}return[w,r,q]})),w=_a[0],r=_a[1],q=_a[2],globals_1.dispose([rTemp,wTemp,qTemp])},j=0;j<iters;++j)_loop_3(j);return!fullMatrices&&m>n&&(q=q.slice([0,0],[m,n]),r=r.slice([0,0],[n,n])),[q,r]}))}exports.gramSchmidt=operation_1.op({gramSchmidt_:gramSchmidt_}),exports.qr=operation_1.op({qr_:qr_})},{"../engine":150,"../globals":153,"../util":248,"./array_ops":170,"./concat_split":180,"./norm":201,"./operation":202,"./reduction_ops":207,"./tensor_ops":223}],195:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P((function(resolve){resolve(result.value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},__generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}};Object.defineProperty(exports,"__esModule",{value:!0});var where_impl_1=require("../backends/where_impl"),engine_1=require("../engine"),tensor_util_env_1=require("../tensor_util_env"),util_1=require("../util"),broadcast_util_1=require("./broadcast_util"),operation_1=require("./operation"),tensor_ops_1=require("./tensor_ops");function logicalNot_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","logicalNot","bool");return engine_1.ENGINE.runKernel((function(backend){return backend.logicalNot($x)}),{$x:$x})}function logicalAnd_(a,b){var $a=tensor_util_env_1.convertToTensor(a,"a","logicalAnd","bool"),$b=tensor_util_env_1.convertToTensor(b,"b","logicalAnd","bool");return broadcast_util_1.assertAndGetBroadcastShape($a.shape,$b.shape),engine_1.ENGINE.runKernel((function(backend){return backend.logicalAnd($a,$b)}),{$a:$a,$b:$b})}function logicalOr_(a,b){var $a=tensor_util_env_1.convertToTensor(a,"a","logicalOr","bool"),$b=tensor_util_env_1.convertToTensor(b,"b","logicalOr","bool");return broadcast_util_1.assertAndGetBroadcastShape($a.shape,$b.shape),engine_1.ENGINE.runKernel((function(backend){return backend.logicalOr($a,$b)}),{$a:$a,$b:$b})}function logicalXor_(a,b){var $a=tensor_util_env_1.convertToTensor(a,"a","logicalXor","bool"),$b=tensor_util_env_1.convertToTensor(b,"b","logicalXor","bool");return broadcast_util_1.assertAndGetBroadcastShape($a.shape,$b.shape),exports.logicalOr(a,b).logicalAnd(exports.logicalAnd(a,b).logicalNot())}function where_(condition,a,b){var $a=tensor_util_env_1.convertToTensor(a,"a","where"),$b=tensor_util_env_1.convertToTensor(b,"b","where"),$condition=tensor_util_env_1.convertToTensor(condition,"condition","where","bool");util_1.assertShapesMatch($a.shape,$b.shape,"Error in where: "),1===$condition.rank?util_1.assert($condition.shape[0]===$a.shape[0],(function(){return"The first dimension of `a` must match the size of `condition`."})):util_1.assertShapesMatch($condition.shape,$b.shape,"Error in where: ");var grad=function(dy,saved){var $condition=saved[0];return{$condition:function(){return tensor_ops_1.zerosLike($condition).toFloat()},$a:function(){return dy.mul($condition.cast(dy.dtype))},$b:function(){return dy.mul($condition.logicalNot().cast(dy.dtype))}}};return engine_1.ENGINE.runKernel((function(backend,save){var res=backend.select($condition,$a,$b);return save([$condition]),res}),{$condition:$condition,$a:$a,$b:$b},grad)}function whereAsync_(condition){return __awaiter(this,void 0,void 0,(function(){var $condition,vals,res;return __generator(this,(function(_a){switch(_a.label){case 0:return[4,($condition=tensor_util_env_1.convertToTensor(condition,"condition","whereAsync","bool")).data()];case 1:return vals=_a.sent(),res=where_impl_1.whereImpl($condition.shape,vals),condition!==$condition&&$condition.dispose(),[2,res]}}))}))}exports.logicalAnd=operation_1.op({logicalAnd_:logicalAnd_}),exports.logicalNot=operation_1.op({logicalNot_:logicalNot_}),exports.logicalOr=operation_1.op({logicalOr_:logicalOr_}),exports.logicalXor=operation_1.op({logicalXor_:logicalXor_}),exports.where=operation_1.op({where_:where_}),exports.whereAsync=whereAsync_},{"../backends/where_impl":147,"../engine":150,"../tensor_util_env":244,"../util":248,"./broadcast_util":176,"./operation":202,"./tensor_ops":223}],196:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var gradients_1=require("../gradients"),tensor_util_env_1=require("../tensor_util_env"),util_1=require("../util"),axis_util_1=require("./axis_util"),binary_ops_1=require("./binary_ops"),operation_1=require("./operation"),tensor_ops_1=require("./tensor_ops"),Reduction;function computeWeightedLoss_(losses,weights,reduction){void 0===reduction&&(reduction=Reduction.SUM_BY_NONZERO_WEIGHTS);var $losses=tensor_util_env_1.convertToTensor(losses,"losses","computeWeightedLoss"),$weights=null;null!=weights&&($weights=tensor_util_env_1.convertToTensor(weights,"weights","computeWeightedLoss"));var weightedLoss=null==$weights?$losses:$losses.mul($weights);if(reduction===Reduction.NONE)return weightedLoss;if(reduction===Reduction.SUM)return weightedLoss.sum();if(reduction===Reduction.MEAN){if(null==$weights)return weightedLoss.mean();var broadcastFactor=$losses.size/$weights.size,result=weightedLoss.sum().div($weights.sum());return broadcastFactor>1?result.div(tensor_ops_1.scalar(broadcastFactor)):result}if(reduction===Reduction.SUM_BY_NONZERO_WEIGHTS){if(null==$weights)return weightedLoss.sum().div(tensor_ops_1.scalar($losses.size));var broadcastedWeights,numNonZeros=$weights.mul(tensor_ops_1.ones($losses.shape)).notEqual(tensor_ops_1.scalar(0)).sum().toFloat();return weightedLoss.sum().div(numNonZeros)}throw Error("Unknown reduction: "+reduction)}function absoluteDifference_(labels,predictions,weights,reduction){void 0===reduction&&(reduction=Reduction.SUM_BY_NONZERO_WEIGHTS);var $labels=tensor_util_env_1.convertToTensor(labels,"labels","absoluteDifference"),$predictions=tensor_util_env_1.convertToTensor(predictions,"predictions","absoluteDifference"),$weights=null;null!=weights&&($weights=tensor_util_env_1.convertToTensor(weights,"weights","absoluteDifference")),util_1.assertShapesMatch($labels.shape,$predictions.shape,"Error in absoluteDifference: ");var losses=$labels.sub($predictions).abs();return exports.computeWeightedLoss(losses,$weights,reduction)}function meanSquaredError_(labels,predictions,weights,reduction){void 0===reduction&&(reduction=Reduction.SUM_BY_NONZERO_WEIGHTS);var $labels=tensor_util_env_1.convertToTensor(labels,"labels","meanSquaredError"),$predictions=tensor_util_env_1.convertToTensor(predictions,"predictions","meanSquaredError"),$weights=null;null!=weights&&($weights=tensor_util_env_1.convertToTensor(weights,"weights","meanSquaredError")),util_1.assertShapesMatch($labels.shape,$predictions.shape,"Error in meanSquaredError: ");var losses=$labels.squaredDifference($predictions);return exports.computeWeightedLoss(losses,$weights,reduction)}function cosineDistance_(labels,predictions,axis,weights,reduction){void 0===reduction&&(reduction=Reduction.SUM_BY_NONZERO_WEIGHTS);var $labels=tensor_util_env_1.convertToTensor(labels,"labels","cosineDistance"),$predictions=tensor_util_env_1.convertToTensor(predictions,"predictions","cosineDistance"),$weights=null;null!=weights&&($weights=tensor_util_env_1.convertToTensor(weights,"weights","cosineDistance")),util_1.assertShapesMatch($labels.shape,$predictions.shape,"Error in cosineDistance: ");var one,losses=tensor_ops_1.scalar(1).sub($labels.mul($predictions).sum(axis,!0));return exports.computeWeightedLoss(losses,$weights,reduction)}function hingeLoss_(labels,predictions,weights,reduction){void 0===reduction&&(reduction=Reduction.SUM_BY_NONZERO_WEIGHTS);var $labels=tensor_util_env_1.convertToTensor(labels,"labels","hingeLoss"),$predictions=tensor_util_env_1.convertToTensor(predictions,"predictions","hingeLoss"),$weights=null;null!=weights&&($weights=tensor_util_env_1.convertToTensor(weights,"weights","hingeLoss")),util_1.assertShapesMatch($labels.shape,$predictions.shape,"Error in hingeLoss: ");var one=tensor_ops_1.scalar(1);$labels=tensor_ops_1.scalar(2).mul($labels).sub(one);var losses=one.sub($labels.mul($predictions)).relu();return exports.computeWeightedLoss(losses,$weights,reduction)}function logLoss_(labels,predictions,weights,epsilon,reduction){void 0===epsilon&&(epsilon=1e-7),void 0===reduction&&(reduction=Reduction.SUM_BY_NONZERO_WEIGHTS);var $labels=tensor_util_env_1.convertToTensor(labels,"labels","logLoss"),$predictions=tensor_util_env_1.convertToTensor(predictions,"predictions","logLoss"),$weights=null;null!=weights&&($weights=tensor_util_env_1.convertToTensor(weights,"weights","logLoss")),util_1.assertShapesMatch($labels.shape,$predictions.shape,"Error in logLoss: ");var one=tensor_ops_1.scalar(1),epsilonScalar=tensor_ops_1.scalar(epsilon),losses=$labels.mul($predictions.add(epsilonScalar).log()).neg().sub(one.sub($labels).mul(one.sub($predictions).add(epsilonScalar).log()));return exports.computeWeightedLoss(losses,$weights,reduction)}function sigmoidCrossEntropyWithLogits_(labels,logits){var $labels=tensor_util_env_1.convertToTensor(labels,"labels","sigmoidCrossEntropyWithLogits"),$logits=tensor_util_env_1.convertToTensor(logits,"logits","sigmoidCrossEntropyWithLogits");util_1.assertShapesMatch($labels.shape,$logits.shape,"Error in sigmoidCrossEntropyWithLogits: ");var maxOutput=$logits.relu(),outputXTarget=$logits.mul($labels),sigmoidOutput=$logits.abs().neg().exp().log1p();return maxOutput.sub(outputXTarget).add(sigmoidOutput)}function sigmoidCrossEntropy_(multiClassLabels,logits,weights,labelSmoothing,reduction){void 0===labelSmoothing&&(labelSmoothing=0),void 0===reduction&&(reduction=Reduction.SUM_BY_NONZERO_WEIGHTS);var $multiClassLabels=tensor_util_env_1.convertToTensor(multiClassLabels,"multiClassLabels","sigmoidCrossEntropy"),$logits=tensor_util_env_1.convertToTensor(logits,"logits","sigmoidCrossEntropy"),$weights=null;if(null!=weights&&($weights=tensor_util_env_1.convertToTensor(weights,"weights","sigmoidCrossEntropy")),util_1.assertShapesMatch($multiClassLabels.shape,$logits.shape,"Error in sigmoidCrossEntropy: "),labelSmoothing>0){var labelSmoothingScalar=tensor_ops_1.scalar(labelSmoothing),one=tensor_ops_1.scalar(1),half=tensor_ops_1.scalar(.5);$multiClassLabels=$multiClassLabels.mul(one.sub(labelSmoothingScalar)).add(half.mul(labelSmoothingScalar))}var losses=sigmoidCrossEntropyWithLogits_($multiClassLabels,$logits);return exports.computeWeightedLoss(losses,$weights,reduction)}function huberLoss_(labels,predictions,weights,delta,reduction){void 0===delta&&(delta=1),void 0===reduction&&(reduction=Reduction.SUM_BY_NONZERO_WEIGHTS);var $labels=tensor_util_env_1.convertToTensor(labels,"labels","huberLoss"),$predictions=tensor_util_env_1.convertToTensor(predictions,"predictions","huberLoss"),$weights=null;null!=weights&&($weights=tensor_util_env_1.convertToTensor(weights,"weights","huberLoss")),util_1.assertShapesMatch($labels.shape,$predictions.shape,"Error in huberLoss: ");var deltaScalar=tensor_ops_1.scalar(delta),error=$predictions.sub($labels).abs(),quadratic=binary_ops_1.minimum(error,deltaScalar),linear=error.sub(quadratic),losses=tensor_ops_1.scalar(.5).mul(quadratic.square()).add(deltaScalar.mul(linear));return exports.computeWeightedLoss(losses,$weights,reduction)}function softmaxCrossEntropyWithLogits_(labels,logits,dim){if(void 0===dim&&(dim=-1),-1===dim&&(dim=logits.rank-1),dim!==logits.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+logits.rank+" and dim was "+dim);var customOp;return gradients_1.customGrad((function(labels,logits,save){var keepDims=!0,lse=logits.logSumExp([dim],!0),logResult=logits.toFloat().sub(lse),costVector,value,gradFunc;return save([labels,logResult]),{value:logResult.mul(labels).neg().sum([dim]),gradFunc:function(dy,saved){var labels=saved[0],logResult=saved[1],dyShape=axis_util_1.expandShapeToKeepDim(dy.shape,[dim]);return[dy.reshape(dyShape).mul(labels.toFloat().sub(logResult.exp())),dy.reshape(dyShape).mul(logResult.exp().sub(labels.toFloat()))]}}}))(labels,logits)}function softmaxCrossEntropy_(onehotLabels,logits,weights,labelSmoothing,reduction){void 0===labelSmoothing&&(labelSmoothing=0),void 0===reduction&&(reduction=Reduction.SUM_BY_NONZERO_WEIGHTS);var $onehotLabels=tensor_util_env_1.convertToTensor(onehotLabels,"onehotLabels","softmaxCrossEntropy"),$logits=tensor_util_env_1.convertToTensor(logits,"logits","softmaxCrossEntropy"),$weights=null;if(null!=weights&&($weights=tensor_util_env_1.convertToTensor(weights,"weights","softmaxCrossEntropy")),util_1.assertShapesMatch($onehotLabels.shape,$logits.shape,"Error in softmaxCrossEntropy: "),labelSmoothing>0){var labelSmoothingScalar=tensor_ops_1.scalar(labelSmoothing),one=tensor_ops_1.scalar(1),numClasses=tensor_ops_1.scalar($onehotLabels.shape[1]);$onehotLabels=$onehotLabels.mul(one.sub(labelSmoothingScalar)).add(labelSmoothingScalar.div(numClasses))}var losses=softmaxCrossEntropyWithLogits_($onehotLabels,$logits);return exports.computeWeightedLoss(losses,$weights,reduction)}!function(Reduction){Reduction[Reduction.NONE=0]="NONE",Reduction[Reduction.MEAN=1]="MEAN",Reduction[Reduction.SUM=2]="SUM",Reduction[Reduction.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(Reduction=exports.Reduction||(exports.Reduction={})),exports.absoluteDifference=operation_1.op({absoluteDifference_:absoluteDifference_}),exports.computeWeightedLoss=operation_1.op({computeWeightedLoss_:computeWeightedLoss_}),exports.cosineDistance=operation_1.op({cosineDistance_:cosineDistance_}),exports.hingeLoss=operation_1.op({hingeLoss_:hingeLoss_}),exports.huberLoss=operation_1.op({huberLoss_:huberLoss_}),exports.logLoss=operation_1.op({logLoss_:logLoss_}),exports.meanSquaredError=operation_1.op({meanSquaredError_:meanSquaredError_}),exports.sigmoidCrossEntropy=operation_1.op({sigmoidCrossEntropy_:sigmoidCrossEntropy_}),exports.softmaxCrossEntropy=operation_1.op({softmaxCrossEntropy_:softmaxCrossEntropy_})},{"../gradients":154,"../tensor_util_env":244,"../util":248,"./axis_util":172,"./binary_ops":174,"./operation":202,"./tensor_ops":223}],197:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),tensor_util_env_1=require("../tensor_util_env"),util=require("../util"),operation_1=require("./operation");function localResponseNormalization_(x,depthRadius,bias,alpha,beta){void 0===depthRadius&&(depthRadius=5),void 0===bias&&(bias=1),void 0===alpha&&(alpha=1),void 0===beta&&(beta=.5);var $x=tensor_util_env_1.convertToTensor(x,"x","localResponseNormalization");util.assert(4===$x.rank||3===$x.rank,(function(){return"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank "+$x.rank+"."})),util.assert(util.isInt(depthRadius),(function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+depthRadius+"."}));var x4D=$x,reshapedTo4D=!1;3===$x.rank&&(reshapedTo4D=!0,x4D=$x.as4D(1,$x.shape[0],$x.shape[1],$x.shape[2]));var backward=function(dy,saved){var x4D=saved[0],y=saved[1];return{x4D:function(){return engine_1.ENGINE.runKernel((function(backend){return backend.LRNGrad(dy,x4D,y,depthRadius,bias,alpha,beta)}),{})}}},res=engine_1.ENGINE.runKernel((function(backend,save){var y=backend.localResponseNormalization4D(x4D,depthRadius,bias,alpha,beta);return save([x4D,y]),y}),{x4D:x4D},backward);return reshapedTo4D?res.as3D(res.shape[1],res.shape[2],res.shape[3]):res}exports.localResponseNormalization=operation_1.op({localResponseNormalization_:localResponseNormalization_})},{"../engine":150,"../tensor_util_env":244,"../util":248,"./operation":202}],198:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var tensor_util_env_1=require("../tensor_util_env"),operation_1=require("./operation");function multiRNNCell_(lstmCells,data,c,h){for(var $data=tensor_util_env_1.convertToTensor(data,"data","multiRNNCell"),$c=tensor_util_env_1.convertToTensorArray(c,"c","multiRNNCell"),$h=tensor_util_env_1.convertToTensorArray(h,"h","multiRNNCell"),input=$data,newStates=[],i=0;i<lstmCells.length;i++){var output=lstmCells[i](input,$c[i],$h[i]);newStates.push(output[0]),newStates.push(output[1]),input=output[1]}for(var newC=[],newH=[],i=0;i<newStates.length;i+=2)newC.push(newStates[i]),newH.push(newStates[i+1]);return[newC,newH]}function basicLSTMCell_(forgetBias,lstmKernel,lstmBias,data,c,h){var $forgetBias=tensor_util_env_1.convertToTensor(forgetBias,"forgetBias","basicLSTMCell"),$lstmKernel=tensor_util_env_1.convertToTensor(lstmKernel,"lstmKernel","basicLSTMCell"),$lstmBias=tensor_util_env_1.convertToTensor(lstmBias,"lstmBias","basicLSTMCell"),$data=tensor_util_env_1.convertToTensor(data,"data","basicLSTMCell"),$c=tensor_util_env_1.convertToTensor(c,"c","basicLSTMCell"),$h=tensor_util_env_1.convertToTensor(h,"h","basicLSTMCell"),combined,weighted,res=$data.concat($h,1).matMul($lstmKernel).add($lstmBias),batchSize=res.shape[0],sliceCols=res.shape[1]/4,sliceSize=[batchSize,sliceCols],i=res.slice([0,0],sliceSize),j=res.slice([0,sliceCols],sliceSize),f=res.slice([0,2*sliceCols],sliceSize),o=res.slice([0,3*sliceCols],sliceSize),newC=i.sigmoid().mulStrict(j.tanh()).addStrict($c.mulStrict($forgetBias.add(f).sigmoid())),newH=newC.tanh().mulStrict(o.sigmoid());return[newC,newH]}exports.basicLSTMCell=operation_1.op({basicLSTMCell_:basicLSTMCell_}),exports.multiRNNCell=operation_1.op({multiRNNCell_:multiRNNCell_})},{"../tensor_util_env":244,"./operation":202}],199:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),tensor_util_1=require("../tensor_util"),tensor_util_env_1=require("../tensor_util_env"),util=require("../util"),operation_1=require("./operation");function matMul_(a,b,transposeA,transposeB){var _a;void 0===transposeA&&(transposeA=!1),void 0===transposeB&&(transposeB=!1);var $a=tensor_util_env_1.convertToTensor(a,"a","matMul"),$b=tensor_util_env_1.convertToTensor(b,"b","matMul");_a=tensor_util_1.makeTypesMatch($a,$b),$a=_a[0],$b=_a[1];var innerShapeA=transposeA?$a.shape[$a.rank-2]:$a.shape[$a.rank-1],innerShapeB=transposeB?$b.shape[$b.rank-1]:$b.shape[$b.rank-2],outerShapeA=transposeA?$a.shape[$a.rank-1]:$a.shape[$a.rank-2],outerShapeB=transposeB?$b.shape[$b.rank-2]:$b.shape[$b.rank-1],outerDimsA=$a.shape.slice(0,-2),outerDimsB=$b.shape.slice(0,-2),batchDimA=util.sizeFromShape(outerDimsA),batchDimB=util.sizeFromShape(outerDimsB);util.assert($a.rank>=2&&$b.rank>=2&&$a.rank===$b.rank,(function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+$a.rank+" and "+$b.rank+"."})),util.assert(util.arraysEqual(outerDimsA,outerDimsB),(function(){return"Error in matMul: outer dimensions ("+outerDimsA+") and ("+outerDimsB+") of Tensors with shapes "+$a.shape+" and "+$b.shape+" must match."})),util.assert(innerShapeA===innerShapeB,(function(){return"Error in matMul: inner shapes ("+innerShapeA+") and ("+innerShapeB+") of Tensors with shapes "+$a.shape+" and "+$b.shape+" and transposeA="+transposeA+" and transposeB="+transposeB+" must match."}));var outShape=$a.shape.slice(0,-2).concat([outerShapeA,outerShapeB]),a3D=transposeA?$a.as3D(batchDimA,innerShapeA,outerShapeA):$a.as3D(batchDimA,outerShapeA,innerShapeA),b3D=transposeB?$b.as3D(batchDimB,outerShapeB,innerShapeB):$b.as3D(batchDimB,innerShapeB,outerShapeB),grad=function(dy,saved){var _a=saved,a3D=_a[0],b3D=_a[1];return transposeA||transposeB?!transposeA&&transposeB?{$a:function(){return dy.matMul(b3D,!1,!1)},$b:function(){return dy.matMul(a3D,!0,!1)}}:transposeA&&!transposeB?{$a:function(){return b3D.matMul(dy,!1,!0)},$b:function(){return a3D.matMul(dy,!1,!1)}}:{$a:function(){return b3D.matMul(dy,!0,!0)},$b:function(){return dy.matMul(a3D,!0,!0)}}:{$a:function(){return dy.matMul(b3D,!1,!0)},$b:function(){return a3D.matMul(dy,!0,!1)}}},res;return engine_1.ENGINE.runKernel((function(backend,save){var res=backend.batchMatMul(a3D,b3D,transposeA,transposeB);return save([a3D,b3D]),res}),{$a:a3D,$b:b3D},grad).reshape(outShape)}function outerProduct_(v1,v2){var $v1=tensor_util_env_1.convertToTensor(v1,"v1","outerProduct"),$v2=tensor_util_env_1.convertToTensor(v2,"v2","outerProduct");return util.assert(1===$v1.rank&&1===$v2.rank,(function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+$v1.rank+" and "+$v2.rank+"."})),$v1.as2D(-1,1).matMul($v2.as2D(1,-1))}function dot_(t1,t2){var $t1=tensor_util_env_1.convertToTensor(t1,"t1","dot"),$t2=tensor_util_env_1.convertToTensor(t2,"t2","dot");util.assert(!(1!==$t1.rank&&2!==$t1.rank||1!==$t2.rank&&2!==$t2.rank),(function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+$t1.rank+" and "+$t2.rank+"."}));var t1Inner=1===$t1.rank?$t1.size:$t1.shape[1],t2Inner=1===$t2.rank?$t2.size:$t2.shape[0];return util.assert(t1Inner===t2Inner,(function(){return"Error in dot: inner dimensions of inputs must match, but got "+t1Inner+" and "+t2Inner+"."})),1===$t1.rank&&1===$t2.rank?$t1.as2D(1,-1).matMul($t2.as2D(-1,1)).asScalar():1===$t1.rank&&2===$t2.rank?$t1.as2D(1,-1).matMul($t2.as2D($t2.shape[0],$t2.shape[1])).as1D():2===$t1.rank&&1===$t2.rank?$t1.matMul($t2.as2D(-1,1)).as1D():$t1.matMul($t2.as2D($t2.shape[0],$t2.shape[1]))}exports.matMul=operation_1.op({matMul_:matMul_}),exports.dot=operation_1.op({dot_:dot_}),exports.outerProduct=operation_1.op({outerProduct_:outerProduct_})},{"../engine":150,"../tensor_util":243,"../tensor_util_env":244,"../util":248,"./operation":202}],200:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var tensor_util_1=require("../tensor_util"),tensor_util_env_1=require("../tensor_util_env"),util=require("../util"),binary_ops_1=require("./binary_ops"),operation_1=require("./operation"),tensor_ops_1=require("./tensor_ops");function movingAverage_(v,x,decay,step,zeroDebias){void 0===zeroDebias&&(zeroDebias=!0);var $v=tensor_util_env_1.convertToTensor(v,"v","movingAverage"),$x=tensor_util_env_1.convertToTensor(x,"x","movingAverage"),$decay=tensor_util_env_1.convertToTensor(decay,"decay","movingAverage");tensor_util_1.assertTypesMatch($v,$x),util.assert(util.arraysEqual($v.shape,$x.shape),(function(){return"Shape mismatch in v and x"}));var one=tensor_ops_1.scalar(1),oneMinusDecay=one.sub($decay),update=$x.sub($v).mul(oneMinusDecay);if(zeroDebias){util.assert(null!=step,(function(){return"When using zeroDebias: true, step is required."}));var $step=tensor_util_env_1.convertToTensor(step,"step","movingAverage");update=update.div(one.sub(binary_ops_1.pow($decay,$step)))}return $v.add(update)}exports.movingAverage=operation_1.op({movingAverage_:movingAverage_})},{"../tensor_util":243,"../tensor_util_env":244,"../util":248,"./binary_ops":174,"./operation":202,"./tensor_ops":223}],201:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var tensor_util_env_1=require("../tensor_util_env"),util_1=require("../util"),axis_util=require("./axis_util"),operation_1=require("./operation"),tensor_ops_1=require("./tensor_ops");function norm_(x,ord,axis,keepDims){void 0===ord&&(ord="euclidean"),void 0===axis&&(axis=null),void 0===keepDims&&(keepDims=!1);var norm=normImpl(x=tensor_util_env_1.convertToTensor(x,"x","norm"),ord,axis),keepDimsShape=norm.shape;if(keepDims){var axes=util_1.parseAxisParam(axis,x.shape);keepDimsShape=axis_util.expandShapeToKeepDim(norm.shape,axes)}return norm.reshape(keepDimsShape)}function normImpl(x,p,axis){if(void 0===axis&&(axis=null),0===x.rank)return x.abs();if(1!==x.rank&&null===axis)return normImpl(x.reshape([-1]),p,axis);if(1===x.rank||"number"==typeof axis||Array.isArray(axis)&&1===axis.length){if(1===p)return x.abs().sum(axis);if(p===1/0)return x.abs().max(axis);if(p===-1/0)return x.abs().min(axis);if("euclidean"===p||2===p)return x.abs().pow(tensor_ops_1.scalar(2,"int32")).sum(axis).sqrt();throw new Error("Error in norm: invalid ord value: "+p)}if(Array.isArray(axis)&&2===axis.length){if(1===p)return x.abs().sum(axis[0]).max(axis[1]-1);if(p===1/0)return x.abs().sum(axis[1]).max(axis[0]);if(p===-1/0)return x.abs().sum(axis[1]).min(axis[0]);if("fro"===p||"euclidean"===p)return x.square().sum(axis).sqrt();throw new Error("Error in norm: invalid ord value: "+p)}throw new Error("Error in norm: invalid axis: "+axis)}exports.norm=operation_1.op({norm_:norm_})},{"../tensor_util_env":244,"../util":248,"./axis_util":172,"./operation":202,"./tensor_ops":223}],202:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});
/**
 * @license
 * Copyright 2018 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
var engine_1=require("../engine");function op(f){var keys=Object.keys(f);if(1!==keys.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+keys.length+" keys.");var opName=keys[0],fn=f[opName];opName.endsWith("_")&&(opName=opName.substring(0,opName.length-1));var f2=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];engine_1.ENGINE.startScope(opName);try{var result=fn.apply(void 0,args);return result instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),engine_1.ENGINE.endScope(result),result}catch(ex){throw engine_1.ENGINE.endScope(null),ex}};return Object.defineProperty(f2,"name",{value:opName,configurable:!0}),f2}exports.op=op},{"../engine":150}],203:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function __export(m){for(var p in m)exports.hasOwnProperty(p)||(exports[p]=m[p])}Object.defineProperty(exports,"__esModule",{value:!0}),__export(require("./batchnorm")),__export(require("./boolean_mask")),__export(require("./complex_ops")),__export(require("./concat_split")),__export(require("./conv")),__export(require("./matmul")),__export(require("./reverse")),__export(require("./pool")),__export(require("./slice")),__export(require("./unary_ops")),__export(require("./reduction_ops")),__export(require("./compare")),__export(require("./binary_ops")),__export(require("./relu_ops")),__export(require("./logical_ops")),__export(require("./array_ops")),__export(require("./tensor_ops")),__export(require("./transpose")),__export(require("./softmax")),__export(require("./lrn")),__export(require("./norm")),__export(require("./segment_ops")),__export(require("./lstm")),__export(require("./moving_average")),__export(require("./strided_slice")),__export(require("./topk")),__export(require("./scatter_nd")),__export(require("./spectral_ops")),__export(require("./sparse_to_dense")),__export(require("./gather_nd")),__export(require("./diag")),__export(require("./dropout")),__export(require("./signal_ops")),__export(require("./in_top_k"));var operation_1=require("./operation");exports.op=operation_1.op;var losses=require("./loss_ops");exports.losses=losses;var linalg=require("./linalg_ops");exports.linalg=linalg;var image=require("./image_ops");exports.image=image;var spectral=require("./spectral_ops");exports.spectral=spectral;var fused=require("./fused_ops");exports.fused=fused;var signal=require("./signal_ops");exports.signal=signal},{"./array_ops":170,"./batchnorm":173,"./binary_ops":174,"./boolean_mask":175,"./compare":178,"./complex_ops":179,"./concat_split":180,"./conv":183,"./diag":185,"./dropout":186,"./fused_ops":189,"./gather_nd":190,"./image_ops":192,"./in_top_k":193,"./linalg_ops":194,"./logical_ops":195,"./loss_ops":196,"./lrn":197,"./lstm":198,"./matmul":199,"./moving_average":200,"./norm":201,"./operation":202,"./pool":204,"./reduction_ops":207,"./relu_ops":208,"./reverse":209,"./scatter_nd":210,"./segment_ops":212,"./signal_ops":215,"./slice":216,"./softmax":218,"./sparse_to_dense":219,"./spectral_ops":221,"./strided_slice":222,"./tensor_ops":223,"./topk":224,"./transpose":225,"./unary_ops":226}],204:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),tensor_util_env_1=require("../tensor_util_env"),util=require("../util"),array_ops_1=require("./array_ops"),conv_util=require("./conv_util"),operation_1=require("./operation");function maxPoolImpl_(x,filterSize,strides,dilations,pad,dimRoundingMode){var $x=tensor_util_env_1.convertToTensor(x,"x","maxPool"),x4D=$x,reshapedTo4D=!1;3===$x.rank&&(reshapedTo4D=!0,x4D=$x.as4D(1,$x.shape[0],$x.shape[1],$x.shape[2])),null==dilations&&(dilations=[1,1]),util.assert(4===x4D.rank,(function(){return"Error in maxPool: input must be rank 4 but got rank "+x4D.rank+"."})),util.assert(conv_util.eitherStridesOrDilationsAreOne(strides,dilations),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+strides+" and dilations '"+dilations+"'"})),null!=dimRoundingMode&&util.assert(util.isInt(pad),(function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+dimRoundingMode+" but got pad "+pad+"."}));var convInfo=conv_util.computePool2DInfo(x4D.shape,filterSize,strides,dilations,pad,dimRoundingMode),grad=function(dy,saved){var x4D=saved[0],y=saved[1];return{x:function(){return maxPoolBackprop(dy,x4D,y,filterSize,strides,dilations,pad)}}},res=engine_1.ENGINE.runKernel((function(backend,save){var y=backend.maxPool(x4D,convInfo);return save([x4D,y]),y}),{x:x4D},grad);return reshapedTo4D?res.as3D(res.shape[1],res.shape[2],res.shape[3]):res}function maxPool_(x,filterSize,strides,pad,dimRoundingMode){return maxPoolImpl_(x,filterSize,strides,1,pad,dimRoundingMode)}function avgPoolImpl_(x,filterSize,strides,dilations,pad,dimRoundingMode){var $x=tensor_util_env_1.convertToTensor(x,"x","avgPool","float32");null==dilations&&(dilations=[1,1]),util.assert(conv_util.eitherStridesOrDilationsAreOne(strides,dilations),(function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+strides+" and dilations '"+dilations+"'"}));var x4D=$x,reshapedTo4D=!1;3===$x.rank&&(reshapedTo4D=!0,x4D=$x.as4D(1,$x.shape[0],$x.shape[1],$x.shape[2])),util.assert(4===x4D.rank,(function(){return"Error in avgPool: x must be rank 4 but got rank "+x4D.rank+"."})),null!=dimRoundingMode&&util.assert(util.isInt(pad),(function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+dimRoundingMode+" but got pad "+pad+"."}));var convInfo=conv_util.computePool2DInfo(x4D.shape,filterSize,strides,dilations,pad,dimRoundingMode),grad=function(dy){return{x:function(){return avgPoolBackprop(dy,x4D,filterSize,strides,dilations,pad)}}},res=engine_1.ENGINE.runKernel((function(backend){return backend.avgPool(x4D,convInfo)}),{x:x4D},grad);return res=res.cast($x.dtype),reshapedTo4D?res.as3D(res.shape[1],res.shape[2],res.shape[3]):res}function avgPool_(x,filterSize,strides,pad,dimRoundingMode){return avgPoolImpl_(x,filterSize,strides,1,pad,dimRoundingMode)}function pool_(input,windowShape,poolingType,pad,dilations,strides){null==dilations&&(dilations=[1,1]),null==strides&&(strides=1),0===pad&&(pad="valid");var $x=tensor_util_env_1.convertToTensor(input,"x","maxPool"),x4D=$x,reshapedTo4D=!1;3===$x.rank&&(reshapedTo4D=!0,x4D=$x.as4D(1,$x.shape[0],$x.shape[1],$x.shape[2])),util.assert(conv_util.eitherStridesOrDilationsAreOne(strides,dilations),(function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+strides+" and dilations '"+dilations+"'"}));var convInfo=conv_util.computePool2DInfo(x4D.shape,windowShape,strides,dilations,pad),dilation=[convInfo.dilationHeight,convInfo.dilationWidth],basePadding;basePadding="same"===pad?withSpaceToBatchBasePaddings([convInfo.filterHeight,convInfo.filterWidth],dilation):[[0,0],[0,0]];var isDilationOne=1===dilation[0]&&1===dilation[1],_a=requiredSpaceToBatchPaddings([convInfo.inHeight,convInfo.inWidth],dilation,basePadding),adjustedPadding=_a[0],adjustedCrops=_a[1],convertedPad=isDilationOne?pad:"valid",convertedX=isDilationOne?x4D:array_ops_1.spaceToBatchND(x4D,dilation,adjustedPadding),forwardOp,y=("avg"===poolingType?function(){return avgPoolImpl_(convertedX,windowShape,strides,1,convertedPad)}:function(){return maxPoolImpl_(convertedX,windowShape,strides,1,convertedPad)})(),res=isDilationOne?y:array_ops_1.batchToSpaceND(y,dilation,adjustedCrops);return reshapedTo4D?res.as3D(res.shape[1],res.shape[2],res.shape[3]):res}function maxPoolBackprop(dy,input,output,filterSize,strides,dilations,pad,dimRoundingMode){var $dy=tensor_util_env_1.convertToTensor(dy,"dy","maxPoolBackprop"),$input=tensor_util_env_1.convertToTensor(input,"input","maxPoolBackprop"),$output=tensor_util_env_1.convertToTensor(output,"output","maxPoolBackprop");util.assert($input.rank===$dy.rank,(function(){return"Rank of input ("+$input.rank+") does not match rank of dy ("+$dy.rank+")"})),null==dilations&&(dilations=[1,1]),util.assert(conv_util.eitherStridesOrDilationsAreOne(strides,dilations),(function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+strides+" and dilations '"+dilations+"'"})),util.assert(4===$dy.rank,(function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+$dy.rank+"."})),util.assert(4===$input.rank,(function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+$input.rank+"."})),null!=dimRoundingMode&&util.assert(util.isInt(pad),(function(){return"Error in maxPoolBackprop: pad must be an integer when using, dimRoundingMode "+dimRoundingMode+" but got pad "+pad+"."}));var convInfo=conv_util.computePool2DInfo($input.shape,filterSize,strides,dilations,pad,dimRoundingMode),res;return engine_1.ENGINE.runKernel((function(backend){return backend.maxPoolBackprop($dy,$input,$output,convInfo)}),{$dy:$dy,$input:$input})}function avgPoolBackprop(dy,input,filterSize,strides,dilations,pad){var $dy=tensor_util_env_1.convertToTensor(dy,"dy","avgPoolBackprop"),$input=tensor_util_env_1.convertToTensor(input,"input","avgPoolBackprop");util.assert($input.rank===$dy.rank,(function(){return"Rank of input ("+$input.rank+") does not match rank of dy ("+$dy.rank+")"})),null==dilations&&(dilations=[1,1]),util.assert(conv_util.eitherStridesOrDilationsAreOne(strides,dilations),(function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+strides+" and dilations '"+dilations+"'"}));var input4D=$input,dy4D=$dy,reshapedTo4D=!1;3===$input.rank&&(reshapedTo4D=!0,input4D=$input.as4D(1,$input.shape[0],$input.shape[1],$input.shape[2]),dy4D=$dy.as4D(1,$dy.shape[0],$dy.shape[1],$dy.shape[2])),util.assert(4===dy4D.rank,(function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+dy4D.rank+"."})),util.assert(4===input4D.rank,(function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+input4D.rank+"."}));var convInfo=conv_util.computePool2DInfo(input4D.shape,filterSize,strides,dilations,pad),res=engine_1.ENGINE.runKernel((function(backend){return backend.avgPoolBackprop(dy4D,input4D,convInfo)}),{dy4D:dy4D,input4D:input4D});return reshapedTo4D?res.as3D(res.shape[1],res.shape[2],res.shape[3]):res}function requiredSpaceToBatchPaddings(inputShape,blockShape,basePadding){var padStart=basePadding.map((function(b){return b[0]})),origPadEnd=basePadding.map((function(b){return b[1]})),fullInputShape=inputShape.concat(padStart,origPadEnd),padEndExtra=blockShape.map((function(b,i){return(b-fullInputShape[i]%b)%b})),padEnd=origPadEnd.map((function(s,i){return s+padEndExtra[i]})),paddings,crops;return[blockShape.map((function(_,i){return[padStart[i],padEnd[i]]})),blockShape.map((function(_,i){return[0,padEndExtra[i]]}))]}function withSpaceToBatchBasePaddings(filterShape,dilation){var dilatedFilterShape,padExtraShape=filterShape.map((function(s,i){return s+(s-1)*(dilation[i]-1)})).map((function(s){return s-1})),padExtraStart=padExtraShape.map((function(s){return Math.floor(s/2)})),padExtraEnd=padExtraShape.map((function(s,i){return s-padExtraStart[i]}));return padExtraShape.map((function(_,i){return[padExtraStart[i],padExtraEnd[i]]}))}function avgPool3d_(x,filterSize,strides,pad,dimRoundingMode,dataFormat,dilations){void 0===dataFormat&&(dataFormat="NDHWC");var $x=tensor_util_env_1.convertToTensor(x,"x","avgPool3d","float32"),x5D=$x,reshapedTo5D=!1;4===$x.rank&&(reshapedTo5D=!0,x5D=$x.as5D(1,$x.shape[0],$x.shape[1],$x.shape[2],$x.shape[3])),null==dilations&&(dilations=[1,1,1]),util.assert(5===x5D.rank,(function(){return"Error in avgPool3d: x must be rank 5 but got rank "+x5D.rank+"."})),util.assert("NDHWC"===dataFormat,(function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+dataFormat})),util.assert(conv_util.eitherStridesOrDilationsAreOne(strides,dilations),(function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+strides+" and dilations '"+dilations+"'"})),null!=dimRoundingMode&&util.assert(util.isInt(pad),(function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+dimRoundingMode+" but got pad "+pad+"."}));var convInfo=conv_util.computePool3DInfo(x5D.shape,filterSize,strides,dilations,pad,dimRoundingMode,dataFormat),grad=function(dy){return{x:function(){return avgPool3dBackprop(dy,x5D,filterSize,strides,dilations,pad,dimRoundingMode)}}},res=engine_1.ENGINE.runKernel((function(backend){return backend.avgPool3d(x5D,convInfo)}),{x:x5D},grad);return res=res.cast(x5D.dtype),reshapedTo5D?res.as4D(res.shape[1],res.shape[2],res.shape[3],res.shape[4]):res}function avgPool3dBackprop(dy,input,filterSize,strides,dilations,pad,dimRoundingMode){var $dy=tensor_util_env_1.convertToTensor(dy,"dy","avgPool3dBackprop"),$input=tensor_util_env_1.convertToTensor(input,"input","avgPool3dBackprop"),dy5D=$dy,input5D=$input,reshapedTo5D=!1;4===$input.rank&&(reshapedTo5D=!0,dy5D=$dy.as5D(1,$dy.shape[0],$dy.shape[1],$dy.shape[2],$dy.shape[3]),input5D=$input.as5D(1,$input.shape[0],$input.shape[1],$input.shape[2],$input.shape[3])),util.assert(5===dy5D.rank,(function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+dy5D.rank+"."})),util.assert(5===input5D.rank,(function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+input5D.rank+"."})),null==dilations&&(dilations=[1,1,1]),util.assert(conv_util.eitherStridesOrDilationsAreOne(strides,dilations),(function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+strides+" and dilations '"+dilations+"'"})),null!=dimRoundingMode&&util.assert(util.isInt(pad),(function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+dimRoundingMode+" but got pad "+pad+"."}));var convInfo=conv_util.computePool3DInfo(input5D.shape,filterSize,strides,dilations,pad,dimRoundingMode),res=engine_1.ENGINE.runKernel((function(backend){return backend.avgPool3dBackprop(dy5D,input5D,convInfo)}),{dy5D:dy5D,input5D:input5D});return reshapedTo5D?res.as4D(res.shape[1],res.shape[2],res.shape[3],res.shape[4]):res}function maxPool3d_(x,filterSize,strides,pad,dimRoundingMode,dataFormat,dilations){void 0===dataFormat&&(dataFormat="NDHWC");var $x=tensor_util_env_1.convertToTensor(x,"x","maxPool3d"),x5D=$x,reshapedTo5D=!1;4===$x.rank&&(reshapedTo5D=!0,x5D=$x.as5D(1,$x.shape[0],$x.shape[1],$x.shape[2],$x.shape[3])),null==dilations&&(dilations=[1,1,1]),util.assert(5===x5D.rank,(function(){return"Error in maxPool3d: x must be rank 5 but got rank "+x5D.rank+"."})),util.assert("NDHWC"===dataFormat,(function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+dataFormat})),util.assert(conv_util.eitherStridesOrDilationsAreOne(strides,dilations),(function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+strides+" and dilations '"+dilations+"'"})),null!=dimRoundingMode&&util.assert(util.isInt(pad),(function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+dimRoundingMode+" but got pad "+pad+"."}));var convInfo=conv_util.computePool3DInfo(x5D.shape,filterSize,strides,dilations,pad,dimRoundingMode,dataFormat),grad=function(dy,saved){var x5D=saved[0],y=saved[1];return{x:function(){return maxPool3dBackprop(dy,x5D,y,filterSize,strides,dilations,pad,dimRoundingMode)}}},res=engine_1.ENGINE.runKernel((function(backend,save){var y=backend.maxPool3d(x5D,convInfo);return save([x5D,y]),y}),{x:x5D},grad);return reshapedTo5D?res.as4D(res.shape[1],res.shape[2],res.shape[3],res.shape[4]):res}function maxPool3dBackprop(dy,input,output,filterSize,strides,dilations,pad,dimRoundingMode){var $dy=tensor_util_env_1.convertToTensor(dy,"dy","maxPool3dBackprop"),$input=tensor_util_env_1.convertToTensor(input,"input","maxPool3dBackprop"),$output=tensor_util_env_1.convertToTensor(output,"output","maxPool3dBackprop"),dy5D=$dy,input5D=$input,output5D=$output,reshapedTo5D=!1;4===$input.rank&&(reshapedTo5D=!0,dy5D=$dy.as5D(1,$dy.shape[0],$dy.shape[1],$dy.shape[2],$dy.shape[3]),input5D=$input.as5D(1,$input.shape[0],$input.shape[1],$input.shape[2],$input.shape[3]),output5D=$output.as5D(1,$output.shape[0],$output.shape[1],$output.shape[2],$output.shape[3])),util.assert(5===dy5D.rank,(function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+dy5D.rank+"."})),util.assert(5===input5D.rank,(function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+input5D.rank+"."})),util.assert(5===output5D.rank,(function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+output5D.rank+"."})),null==dilations&&(dilations=[1,1,1]),util.assert(conv_util.eitherStridesOrDilationsAreOne(strides,dilations),(function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+strides+" and dilations '"+dilations+"'"})),null!=dimRoundingMode&&util.assert(util.isInt(pad),(function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+dimRoundingMode+" but got pad "+pad+"."}));var convInfo=conv_util.computePool3DInfo(input5D.shape,filterSize,strides,dilations,pad,dimRoundingMode),res=engine_1.ENGINE.runKernel((function(backend){return backend.maxPool3dBackprop(dy5D,input5D,output5D,convInfo)}),{dy5D:dy5D,input5D:input5D});return reshapedTo5D?res.as4D(res.shape[1],res.shape[2],res.shape[3],res.shape[4]):res}exports.maxPool=operation_1.op({maxPool_:maxPool_}),exports.avgPool=operation_1.op({avgPool_:avgPool_}),exports.pool=operation_1.op({pool_:pool_}),exports.maxPool3d=operation_1.op({maxPool3d_:maxPool3d_}),exports.avgPool3d=operation_1.op({avgPool3d_:avgPool3d_})},{"../engine":150,"../tensor_util_env":244,"../util":248,"./array_ops":170,"./conv_util":184,"./operation":202}],205:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2017 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var seedrandom=require("seedrandom"),MPRandGauss=function(){function MPRandGauss(mean,stdDeviation,dtype,truncated,seed){this.mean=mean,this.stdDev=stdDeviation,this.dtype=dtype,this.nextVal=NaN,this.truncated=truncated,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var seedValue=seed||Math.random();this.random=seedrandom.alea(seedValue.toString())}return MPRandGauss.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var value=this.nextVal;return this.nextVal=NaN,value}for(var resultX,resultY,isValid=!1;!isValid;){var v1=void 0,v2=void 0,s=void 0;do{s=(v1=2*this.random()-1)*v1+(v2=2*this.random()-1)*v2}while(s>=1||0===s);var mul=Math.sqrt(-2*Math.log(s)/s);resultX=this.mean+this.stdDev*v1*mul,resultY=this.mean+this.stdDev*v2*mul,this.truncated&&!this.isValidTruncated(resultX)||(isValid=!0)}return this.truncated&&!this.isValidTruncated(resultY)||(this.nextVal=this.convertValue(resultY)),this.convertValue(resultX)},MPRandGauss.prototype.convertValue=function(value){return null==this.dtype||"float32"===this.dtype?value:Math.round(value)},MPRandGauss.prototype.isValidTruncated=function(value){return value<=this.upper&&value>=this.lower},MPRandGauss}();exports.MPRandGauss=MPRandGauss;var RandGamma=function(){function RandGamma(alpha,beta,dtype,seed){this.alpha=alpha,this.beta=1/beta,this.dtype=dtype;var seedValue=seed||Math.random();this.randu=seedrandom.alea(seedValue.toString()),this.randn=new MPRandGauss(0,1,dtype,!1,this.randu()),this.d=alpha<1?alpha+2/3:alpha-1/3,this.c=1/Math.sqrt(9*this.d)}return RandGamma.prototype.nextValue=function(){for(var x2,v0,v1,x,u,v;;){do{x=this.randn.nextValue(),v=1+this.c*x}while(v<=0);if(v*=v*v,v0=1-.331*(x2=x*x)*x2,v1=.5*x2+this.d*(1-v+Math.log(v)),(u=this.randu())<v0||Math.log(u)<v1)break}return v=1/this.beta*this.d*v,this.alpha<1&&(v*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(v)},RandGamma.prototype.convertValue=function(value){return"float32"===this.dtype?value:Math.round(value)},RandGamma}();exports.RandGamma=RandGamma;var UniformRandom=function(){function UniformRandom(min,max,dtype,seed){var _this=this;if(void 0===min&&(min=0),void 0===max&&(max=1),this.canReturnFloat=function(){return null==_this.dtype||"float32"===_this.dtype},this.min=min,this.range=max-min,this.dtype=dtype,null==seed&&(seed=Math.random()),"number"==typeof seed&&(seed=seed.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+min+" - "+max+" <= 1 and dtype is not float");this.random=seedrandom.alea(seed)}return UniformRandom.prototype.convertValue=function(value){return this.canReturnFloat()?value:Math.round(value)},UniformRandom.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},UniformRandom}();exports.UniformRandom=UniformRandom},{seedrandom:512}],206:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2017 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var util_1=require("../util");function computeOptimalWindowSize(inSize){return inSize<=exports.PARALLELIZE_THRESHOLD?inSize:util_1.nearestDivisor(inSize,Math.floor(Math.sqrt(inSize)))}exports.PARALLELIZE_THRESHOLD=30,exports.computeOptimalWindowSize=computeOptimalWindowSize},{"../util":248}],207:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),gradients_1=require("../gradients"),tensor_util_env_1=require("../tensor_util_env"),util=require("../util"),axis_util=require("./axis_util"),operation_1=require("./operation"),tensor_ops_1=require("./tensor_ops");function logSumExp_(x,axis,keepDims){void 0===axis&&(axis=null),void 0===keepDims&&(keepDims=!1);var $x=tensor_util_env_1.convertToTensor(x,"x","logSumExp"),axes=util.parseAxisParam(axis,$x.shape),xMax=$x.max(axes,!0),a,b,c,d=$x.sub(xMax).exp().sum(axes).log(),res=xMax.reshape(d.shape).add(d);if(keepDims){var newShape=axis_util.expandShapeToKeepDim(res.shape,axes);return res.reshape(newShape)}return res}function sum_(x,axis,keepDims){void 0===axis&&(axis=null),void 0===keepDims&&(keepDims=!1);var $x=tensor_util_env_1.convertToTensor(x,"x","sum");"bool"===$x.dtype&&($x=$x.toInt());var axes=util.parseAxisParam(axis,$x.shape),customOp;return gradients_1.customGrad((function(x){var permutation=axis_util.getAxesPermutation(axes,x.rank),reductionAxes=axes,permutedX=x;null!=permutation&&(permutedX=x.transpose(permutation),reductionAxes=axis_util.getInnerMostAxes(reductionAxes.length,x.rank));var value=engine_1.ENGINE.runKernel((function(backend){return backend.sum(permutedX,reductionAxes)}),{permutedX:permutedX}),gradFunc;if(keepDims){var newShape=axis_util.expandShapeToKeepDim(value.shape,axes);value=value.reshape(newShape)}return{value:value,gradFunc:function(dy){var expandedDyShape=x.shape.slice(),expandedDy,derX;return axes.forEach((function(axis){expandedDyShape[axis]=1})),dy.reshape(expandedDyShape).mul(tensor_ops_1.ones(x.shape,"float32"))}}}))($x)}function prod_(x,axis,keepDims){void 0===axis&&(axis=null),void 0===keepDims&&(keepDims=!1);var $x=tensor_util_env_1.convertToTensor(x,"x","prod");"bool"===$x.dtype&&($x=$x.toInt());var axes=util.parseAxisParam(axis,$x.shape),permutation=axis_util.getAxesPermutation(axes,$x.rank),reductionAxes=axes,permutedX=$x;null!=permutation&&(permutedX=$x.transpose(permutation),reductionAxes=axis_util.getInnerMostAxes(reductionAxes.length,$x.rank));var value=engine_1.ENGINE.runKernel((function(backend){return backend.prod(permutedX,reductionAxes)}),{permutedX:permutedX});if(keepDims){var newShape=axis_util.expandShapeToKeepDim(value.shape,axes);value=value.reshape(newShape)}return value}function mean_(x,axis,keepDims){void 0===axis&&(axis=null),void 0===keepDims&&(keepDims=!1);var $x=tensor_util_env_1.convertToTensor(x,"x","mean"),axes=util.parseAxisParam(axis,$x.shape),shapes,reduceShape=axis_util.computeOutAndReduceShapes($x.shape,axes)[1],reduceSize=util.sizeFromShape(reduceShape),customOp;return gradients_1.customGrad((function(x){var reduceSizeScalar=tensor_ops_1.scalar(reduceSize),xReduce,res,value,gradFunc;return{value:(reduceSizeScalar.dtype===x.dtype?x:x.cast(reduceSizeScalar.dtype)).div(reduceSizeScalar).sum(axis,keepDims),gradFunc:function(dy){var expandedDyShape=x.shape.slice(),expandedDy,derX;return axes.forEach((function(axis){expandedDyShape[axis]=1})),dy.reshape(expandedDyShape).mul(tensor_ops_1.ones(x.shape,"float32")).div(reduceSize)}}}))($x)}function gradForMinAndMax(dy,y,xOrig,origAxes,permutedAxes){return y.rank<xOrig.rank&&(y=y.reshape(axis_util.expandShapeToKeepDim(y.shape,origAxes))),dy.rank<xOrig.rank&&(dy=dy.reshape(axis_util.expandShapeToKeepDim(dy.shape,origAxes))),{$x:function(){var dx=dy.mul(xOrig.equal(y).cast(dy.dtype));return null==permutedAxes?dx:dx.transpose(permutedAxes)}}}function min_(x,axis,keepDims){void 0===axis&&(axis=null),void 0===keepDims&&(keepDims=!1);var $x=tensor_util_env_1.convertToTensor(x,"x","min"),xOrig=$x,origAxes=util.parseAxisParam(axis,$x.shape),axes=origAxes,permutedAxes=axis_util.getAxesPermutation(axes,$x.rank);null!=permutedAxes&&($x=$x.transpose(permutedAxes),axes=axis_util.getInnerMostAxes(axes.length,$x.rank));var grad=function(dy,saved){return gradForMinAndMax(dy,saved[1],saved[0],origAxes,permutedAxes)},res=engine_1.ENGINE.runKernel((function(backend,save){var y=backend.min($x,axes);return save([xOrig,y]),y}),{$x:$x},grad);if(keepDims){var newShape=axis_util.expandShapeToKeepDim(res.shape,origAxes);res=res.reshape(newShape)}return res}function max_(x,axis,keepDims){void 0===axis&&(axis=null),void 0===keepDims&&(keepDims=!1);var $x=tensor_util_env_1.convertToTensor(x,"x","max"),xOrig=$x,origAxes=util.parseAxisParam(axis,$x.shape),axes=origAxes,permutedAxes=axis_util.getAxesPermutation(axes,$x.rank);null!=permutedAxes&&($x=$x.transpose(permutedAxes),axes=axis_util.getInnerMostAxes(axes.length,$x.rank));var grad=function(dy,saved){return gradForMinAndMax(dy,saved[1],saved[0],origAxes,permutedAxes)},res=engine_1.ENGINE.runKernel((function(backend,save){var y=backend.max($x,axes);return save([xOrig,y]),y}),{$x:$x},grad);if(keepDims){var newShape=axis_util.expandShapeToKeepDim(res.shape,origAxes);res=res.reshape(newShape)}return res}function argMin_(x,axis){void 0===axis&&(axis=0);var $x=tensor_util_env_1.convertToTensor(x,"x","argMin");null==axis&&(axis=0);var axes=util.parseAxisParam(axis,$x.shape),permutedAxes=axis_util.getAxesPermutation(axes,$x.rank);null!=permutedAxes&&($x=$x.transpose(permutedAxes),axes=axis_util.getInnerMostAxes(axes.length,$x.rank));var grad=function(dy,saved){var $x=saved[0];return{$x:function(){return tensor_ops_1.zerosLike($x)}}};return engine_1.ENGINE.runKernel((function(backend,save){var res=backend.argMin($x,axes[0]);return save([$x]),res}),{$x:$x},grad)}function argMax_(x,axis){void 0===axis&&(axis=0);var $x=tensor_util_env_1.convertToTensor(x,"x","argMax");null==axis&&(axis=0);var axes=util.parseAxisParam(axis,$x.shape),permutedAxes=axis_util.getAxesPermutation(axes,$x.rank);null!=permutedAxes&&($x=$x.transpose(permutedAxes),axes=axis_util.getInnerMostAxes(axes.length,$x.rank));var grad=function(dy,saved){var $x=saved[0];return{$x:function(){return tensor_ops_1.zerosLike($x)}}};return engine_1.ENGINE.runKernel((function(backend,save){var res=backend.argMax($x,axes[0]);return save([$x]),res}),{$x:$x},grad)}function all_(x,axis,keepDims){void 0===axis&&(axis=null),void 0===keepDims&&(keepDims=!1);var $x=tensor_util_env_1.convertToTensor(x,"x","all","bool"),origAxes=util.parseAxisParam(axis,$x.shape),axes=origAxes,permutedAxes=axis_util.getAxesPermutation(axes,$x.rank);null!=permutedAxes&&($x=$x.transpose(permutedAxes),axes=axis_util.getInnerMostAxes(axes.length,$x.rank));var res=engine_1.ENGINE.runKernel((function(backend){return backend.all($x,axes)}),{$x:$x});if(keepDims){var newShape=axis_util.expandShapeToKeepDim(res.shape,origAxes);return res.reshape(newShape)}return res}function any_(x,axis,keepDims){void 0===axis&&(axis=null),void 0===keepDims&&(keepDims=!1);var $x=tensor_util_env_1.convertToTensor(x,"x","any","bool"),origAxes=util.parseAxisParam(axis,$x.shape),axes=origAxes,permutedAxes=axis_util.getAxesPermutation(axes,$x.rank);null!=permutedAxes&&($x=$x.transpose(permutedAxes),axes=axis_util.getInnerMostAxes(axes.length,$x.rank));var res=engine_1.ENGINE.runKernel((function(backend){return backend.any($x,axes)}),{$x:$x});if(keepDims){var newShape=axis_util.expandShapeToKeepDim(res.shape,origAxes);return res.reshape(newShape)}return res}function moments_(x,axis,keepDims){void 0===axis&&(axis=null),void 0===keepDims&&(keepDims=!1),x=tensor_util_env_1.convertToTensor(x,"x","moments");var axes=util.parseAxisParam(axis,x.shape),mean=x.mean(axes,keepDims),keepDimsShape=mean.shape;keepDims||(keepDimsShape=axis_util.expandShapeToKeepDim(mean.shape,axes));var devSquared=x.toFloat().sub(mean.reshape(keepDimsShape)).square(),variance;return{mean:mean,variance:devSquared.mean(axes,keepDims)}}exports.all=operation_1.op({all_:all_}),exports.any=operation_1.op({any_:any_}),exports.argMax=operation_1.op({argMax_:argMax_}),exports.argMin=operation_1.op({argMin_:argMin_}),exports.logSumExp=operation_1.op({logSumExp_:logSumExp_}),exports.max=operation_1.op({max_:max_}),exports.mean=operation_1.op({mean_:mean_}),exports.min=operation_1.op({min_:min_}),exports.moments=operation_1.op({moments_:moments_}),exports.sum=operation_1.op({sum_:sum_}),exports.prod=operation_1.op({prod_:prod_})},{"../engine":150,"../gradients":154,"../tensor_util_env":244,"../util":248,"./axis_util":172,"./operation":202,"./tensor_ops":223}],208:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),tensor_util_env_1=require("../tensor_util_env"),binary_ops_1=require("./binary_ops"),broadcast_util_1=require("./broadcast_util"),logical_ops_1=require("./logical_ops"),operation_1=require("./operation"),selu_util_1=require("./selu_util"),tensor_ops_1=require("./tensor_ops");function relu_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","relu");if("bool"===$x.dtype)return $x.toInt();var grad=function(dy,saved){var $x=saved[0];return{$x:function(){return dy.mulStrict($x.step().toFloat())}}};return engine_1.ENGINE.runKernel((function(backend,save){var res=backend.relu($x);return save([$x]),res}),{$x:$x},grad)}function elu_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","elu"),grad=function(dy,saved){var y=saved[0];return{$x:function(){return engine_1.ENGINE.runKernel((function(backend){return backend.eluDer(dy,y)}),{dy:dy,y:y})}}};return engine_1.ENGINE.runKernel((function(backend,save){var y=backend.elu($x);return save([y]),y}),{$x:$x},grad)}function selu_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","selu"),grad=function(dy,saved){var $x=saved[0];return{$x:function(){var mask=$x.greater(tensor_ops_1.scalar(0)),scaleAlpha=tensor_ops_1.scalar(selu_util_1.SELU_SCALEALPHA),scale=tensor_ops_1.scalar(selu_util_1.SELU_SCALE),greaterThanZeroDer=dy.mul(scale),lessEqualZeroDer=dy.mul(scaleAlpha).mul($x.toFloat().exp());return logical_ops_1.where(mask,greaterThanZeroDer,lessEqualZeroDer)}}};return engine_1.ENGINE.runKernel((function(backend,save){var res=backend.selu($x);return save([$x]),res}),{$x:$x},grad)}function leakyRelu_(x,alpha){void 0===alpha&&(alpha=.2);var $x=tensor_util_env_1.convertToTensor(x,"x","leakyRelu");return binary_ops_1.maximum(tensor_ops_1.scalar(alpha).mul($x),$x)}function prelu_(x,alpha){var $x=tensor_util_env_1.convertToTensor(x,"x","prelu"),$alpha=tensor_util_env_1.convertToTensor(alpha,"alpha","prelu"),grad=function(dy,saved){var $x=saved[0],$alpha=saved[1],mask=$x.greater(0);return{$x:function(){return logical_ops_1.where(mask,dy,dy.mul($alpha))},$alpha:function(){var res=logical_ops_1.where(mask,tensor_ops_1.zerosLike(dy),dy.mul($x)),reduceAxes=broadcast_util_1.getReductionAxes($alpha.shape,dy.shape);return reduceAxes.length>0&&(res=res.sum(reduceAxes)),res.reshape($alpha.shape)}}};return engine_1.ENGINE.runKernel((function(backend,save){var res=backend.prelu($x,$alpha);return save([$x,$alpha]),res}),{$x:$x,$alpha:$alpha},grad)}exports.elu=operation_1.op({elu_:elu_}),exports.leakyRelu=operation_1.op({leakyRelu_:leakyRelu_}),exports.prelu=operation_1.op({prelu_:prelu_}),exports.relu=operation_1.op({relu_:relu_}),exports.selu=operation_1.op({selu_:selu_})},{"../engine":150,"../tensor_util_env":244,"./binary_ops":174,"./broadcast_util":176,"./logical_ops":195,"./operation":202,"./selu_util":214,"./tensor_ops":223}],209:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),tensor_util_env_1=require("../tensor_util_env"),util=require("../util"),operation_1=require("./operation");function reverse1d_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","reverse");return util.assert(1===$x.rank,(function(){return"Error in reverse1D: x must be rank 1 but got rank "+$x.rank+"."})),exports.reverse($x,0)}function reverse2d_(x,axis){var $x=tensor_util_env_1.convertToTensor(x,"x","reverse");return util.assert(2===$x.rank,(function(){return"Error in reverse2D: x must be rank 2 but got rank "+$x.rank+"."})),exports.reverse($x,axis)}function reverse3d_(x,axis){var $x=tensor_util_env_1.convertToTensor(x,"x","reverse");return util.assert(3===$x.rank,(function(){return"Error in reverse3D: x must be rank 3 but got rank "+$x.rank+"."})),exports.reverse($x,axis)}function reverse4d_(x,axis){var $x=tensor_util_env_1.convertToTensor(x,"x","reverse");return util.assert(4===$x.rank,(function(){return"Error in reverse4D: x must be rank 4 but got rank "+$x.rank+"."})),exports.reverse($x,axis)}function reverse_(x,axis){var $x=tensor_util_env_1.convertToTensor(x,"x","reverse");if(0===$x.rank)return $x.clone();var axes=util.parseAxisParam(axis,$x.shape),grad=function(dy){return{$x:function(){return dy.reverse(axes)}}},res;return engine_1.ENGINE.runKernel((function(backend){return backend.reverse($x,axes)}),{$x:$x},grad).reshapeAs($x)}exports.reverse=operation_1.op({reverse_:reverse_}),exports.reverse1d=operation_1.op({reverse1d_:reverse1d_}),exports.reverse2d=operation_1.op({reverse2d_:reverse2d_}),exports.reverse3d=operation_1.op({reverse3d_:reverse3d_}),exports.reverse4d=operation_1.op({reverse4d_:reverse4d_})},{"../engine":150,"../tensor_util_env":244,"../util":248,"./operation":202}],210:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),tensor_util_env_1=require("../tensor_util_env"),operation_1=require("./operation"),scatter_nd_util=require("./scatter_nd_util");function scatterND_(indices,updates,shape){var $indices=tensor_util_env_1.convertToTensor(indices,"indices","scatterND","int32"),$updates=tensor_util_env_1.convertToTensor(updates,"updates","scatterND");return scatter_nd_util.validateInput($updates,$indices,shape),engine_1.ENGINE.runKernel((function(backend){return backend.scatterND($indices,$updates,shape)}),{$indices:$indices,$updates:$updates})}exports.scatterND=operation_1.op({scatterND_:scatterND_})},{"../engine":150,"../tensor_util_env":244,"./operation":202,"./scatter_nd_util":211}],211:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var util_1=require("../util");function validateUpdateShape(shape,indices,updates){var sliceDim=indices.rank>1?indices.shape[indices.rank-1]:1,batchDim=indices.rank>1?indices.rank-1:1,shapeError="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+updates.shape+", indices.shape: "+indices.shape+", shape: "+shape+", sliceDim: "+sliceDim+", and batchDim: "+batchDim+".";if(updates.rank<batchDim)throw new Error(shapeError+" update.rank < "+batchDim+". ");if(shape.length<sliceDim+(updates.rank-batchDim))throw new Error(shapeError+" Output shape length < "+(sliceDim+(updates.rank-batchDim)));if(updates.rank!==batchDim+shape.length-sliceDim)throw new Error(shapeError+" update.rank != "+(batchDim+shape.length-sliceDim));for(var d=0;d<batchDim;++d)if(updates.shape[d]!==indices.shape[d])throw new Error(shapeError+" updates.shape["+d+"] ("+updates.shape[d]+") != indices.shape["+d+"] ("+indices.shape[d]+").");for(var d=0;d<updates.rank-batchDim;++d)if(updates.shape[d+batchDim]!==shape[d+sliceDim])throw new Error(shapeError+" updates.shape["+(d+batchDim)+"] ("+updates.shape[d+batchDim]+") != shape["+(d+batchDim)+"] ("+shape[d+batchDim]+")")}function validateInput(updates,indices,shape){if(indices.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+indices.rank+".");if(updates.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+updates.rank+".");if("int32"!==indices.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: "+indices.dtype);if(shape.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+shape);if(0===shape.length){if(0===indices.size)throw new Error("Indices specified for empty output. indices shape: "+indices.shape);if(0===updates.size)throw new Error("Updates specified for empty output. updates shape: "+updates.shape)}validateUpdateShape(shape,indices,updates)}function calculateShapes(updates,indices,shape){for(var sliceRank=indices.rank>1?indices.shape[indices.rank-1]:1,totalNd=shape.length,sliceSize=1,i=sliceRank;i<totalNd;++i)sliceSize*=shape[i];var safeSliceDim=sliceRank<1?1:sliceRank,numUpdates,strides,outputSize;return{sliceRank:sliceRank,numUpdates:indices.size/safeSliceDim,sliceSize:sliceSize,strides:util_1.computeStrides(shape.slice(0,sliceRank)).concat([1]),outputSize:util_1.sizeFromShape(shape)}}exports.validateUpdateShape=validateUpdateShape,exports.validateInput=validateInput,exports.calculateShapes=calculateShapes},{"../util":248}],212:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),tensor_util_env_1=require("../tensor_util_env"),util_1=require("../util"),array_ops_1=require("./array_ops"),axis_util_1=require("./axis_util"),binary_ops_1=require("./binary_ops"),compare_1=require("./compare"),logical_ops_1=require("./logical_ops"),operation_1=require("./operation"),segment_util_1=require("./segment_util"),tensor_ops_1=require("./tensor_ops");function unsortedSegmentSum_(x,segmentIds,numSegments){var $x=tensor_util_env_1.convertToTensor(x,"x","unsortedSegmentSum"),$segmentIds=tensor_util_env_1.convertToTensor(segmentIds,"segmentIds","unsortedSegmentSum","int32");util_1.assert(util_1.isInt(numSegments),(function(){return"numSegments must be of dtype int"}));var gradFunc=function(dy,saved){var $segmentIds=saved[0],derX;return{$x:function(){return gatherDropNegatives(dy,$segmentIds)}}};return engine_1.ENGINE.runKernel((function(backend,save){var res=backend.unsortedSegmentSum($x,$segmentIds,numSegments);return save([$segmentIds]),res}),{$x:$x},gradFunc)}function gather_(x,indices,axis){void 0===axis&&(axis=0);var $x=tensor_util_env_1.convertToTensor(x,"x","gather"),$indices=tensor_util_env_1.convertToTensor(indices,"indices","gather","int32");axis=util_1.parseAxisParam(axis,$x.shape)[0];var shapeInfo=segment_util_1.collectGatherOpShapeInfo($x,$indices,axis),grad=function(dy,saved){var $indices=saved[0],derX;return{$x:function(){var paramsShape=$x.shape,indicesSize=$indices.size,outerShape=paramsShape.slice(0,axis),outerDims=outerShape.length,innerShape=paramsShape.slice(axis,paramsShape.length).slice(1),innerDims=innerShape.length,outerAxesIndices=arrayRange(0,outerDims),innerAxesIndices=arrayRange(outerDims+1,outerDims+1+innerDims),valuesShape=arrayConcat([outerShape,[indicesSize],innerShape]),values=dy.reshape(valuesShape),reshapedIndices=$indices.reshape([indicesSize]),transposeDims=arrayConcat([[outerDims],outerAxesIndices,innerAxesIndices]),valuesTranspose=values.transpose(transposeDims),paramsGrad=exports.unsortedSegmentSum(valuesTranspose,reshapedIndices,$x.shape[axis]),invertTransposeDims=axis_util_1.getUndoAxesPermutation(transposeDims);return paramsGrad=paramsGrad.transpose(invertTransposeDims)}}};return engine_1.ENGINE.runKernel((function(backend,save){var res=backend.gather($x,$indices.flatten(),axis);return save([$indices]),res}),{$x:$x},grad).reshape(shapeInfo.outputShape)}function arrayRange(start,stop){for(var result=[],i=start;i<stop;++i)result.push(i);return result}function arrayConcat(arrays){for(var result=[],i=0;i<arrays.length;++i)for(var j=0;j<arrays[i].length;++j)result.push(arrays[i][j]);return result}function gatherDropNegatives(x,indices){for(var zeroClippedIndices=binary_ops_1.maximum(indices,tensor_ops_1.zerosLike(indices)),gathered=exports.gather(x,zeroClippedIndices),isPositive=compare_1.greaterEqual(indices,tensor_ops_1.scalar(0,"int32")),numIters=gathered.rank-isPositive.rank,i=0;i<numIters;++i)isPositive=array_ops_1.expandDims(isPositive,i+1);isPositive=logical_ops_1.logicalAnd(isPositive,tensor_ops_1.ones(gathered.shape,"bool"));var zeroSlice=tensor_ops_1.zerosLike(gathered);return logical_ops_1.where(isPositive,gathered,zeroSlice)}exports.gather=operation_1.op({gather_:gather_}),exports.unsortedSegmentSum=operation_1.op({unsortedSegmentSum_:unsortedSegmentSum_})},{"../engine":150,"../tensor_util_env":244,"../util":248,"./array_ops":170,"./axis_util":172,"./binary_ops":174,"./compare":178,"./logical_ops":195,"./operation":202,"./segment_util":213,"./tensor_ops":223}],213:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var util_1=require("../util"),reduce_util_1=require("./reduce_util");function segOpComputeOptimalWindowSize(inSize,numSegments){var done=!1,res;for(inSize<=reduce_util_1.PARALLELIZE_THRESHOLD?(res=inSize,done=!0):res=util_1.nearestDivisor(inSize,Math.floor(Math.sqrt(inSize)));!done;)res>numSegments||res===inSize?done=!0:res=util_1.nearestDivisor(inSize,res+1);return res}function computeOutShape(aShape,axis,numSegments){for(var outShape=[],rank=aShape.length,dim=0;dim<rank;dim++)dim!==axis?outShape.push(aShape[dim]):outShape.push(numSegments);return outShape}function collectGatherOpShapeInfo(x,indices,axis){for(var dimSize=x.shape[axis],outputShape=[],batchSize=1,sliceSize=1,i=0;i<axis;i++)outputShape.push(x.shape[i]),batchSize*=x.shape[i];for(var i=0;i<indices.rank;i++)outputShape.push(indices.shape[i]);for(var i=axis+1;i<x.rank;i++)outputShape.push(x.shape[i]),sliceSize*=x.shape[i];return{batchSize:batchSize,sliceSize:sliceSize,dimSize:dimSize,outputShape:outputShape}}exports.segOpComputeOptimalWindowSize=segOpComputeOptimalWindowSize,exports.computeOutShape=computeOutShape,exports.collectGatherOpShapeInfo=collectGatherOpShapeInfo},{"../util":248,"./reduce_util":206}],214:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0}),exports.SELU_SCALEALPHA=1.7580993408473768,exports.SELU_SCALE=1.0507009873554805},{}],215:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var operation_1=require("../ops/operation"),binary_ops_1=require("./binary_ops"),concat_split_1=require("./concat_split"),slice_1=require("./slice"),spectral_ops_1=require("./spectral_ops"),tensor_ops_1=require("./tensor_ops");function hannWindow_(windowLength){return cosineWindow(windowLength,.5,.5)}function hammingWindow_(windowLength){return cosineWindow(windowLength,.54,.46)}function frame_(signal,frameLength,frameStep,padEnd,padValue){void 0===padEnd&&(padEnd=!1),void 0===padValue&&(padValue=0);for(var start=0,output=[];start+frameLength<=signal.size;)output.push(slice_1.slice(signal,start,frameLength)),start+=frameStep;if(padEnd)for(;start<signal.size;){var padLen=start+frameLength-signal.size,pad=concat_split_1.concat([slice_1.slice(signal,start,frameLength-padLen),tensor_ops_1.fill([padLen],padValue)]);output.push(pad),start+=frameStep}return 0===output.length?tensor_ops_1.tensor2d([],[0,frameLength]):concat_split_1.concat(output).as2D(output.length,frameLength)}function stft_(signal,frameLength,frameStep,fftLength,windowFn){void 0===windowFn&&(windowFn=exports.hannWindow),null==fftLength&&(fftLength=enclosingPowerOfTwo(frameLength));for(var framedSignal=exports.frame(signal,frameLength,frameStep),windowedSignal=binary_ops_1.mul(framedSignal,windowFn(frameLength)),output=[],i=0;i<framedSignal.shape[0];i++)output.push(spectral_ops_1.rfft(windowedSignal.slice([i,0],[1,frameLength]),fftLength));return concat_split_1.concat(output)}function enclosingPowerOfTwo(value){return Math.floor(Math.pow(2,Math.ceil(Math.log(value)/Math.log(2))))}function cosineWindow(windowLength,a,b){for(var even=1-windowLength%2,newValues=new Float32Array(windowLength),i=0;i<windowLength;++i){var cosArg=2*Math.PI*i/(windowLength+even-1);newValues[i]=a-b*Math.cos(cosArg)}return tensor_ops_1.tensor1d(newValues,"float32")}exports.hannWindow=operation_1.op({hannWindow_:hannWindow_}),exports.hammingWindow=operation_1.op({hammingWindow_:hammingWindow_}),exports.frame=operation_1.op({frame_:frame_}),exports.stft=operation_1.op({stft_:stft_})},{"../ops/operation":202,"./binary_ops":174,"./concat_split":180,"./slice":216,"./spectral_ops":221,"./tensor_ops":223}],216:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),tensor_util_env_1=require("../tensor_util_env"),util=require("../util"),operation_1=require("./operation"),slice_util=require("./slice_util");function slice1d_(x,begin,size){var $x=tensor_util_env_1.convertToTensor(x,"x","slice1d");return util.assert(1===$x.rank,(function(){return"slice1d expects a rank-1 tensor, but got a rank-"+$x.rank+" tensor"})),exports.slice($x,[begin],[size])}function slice2d_(x,begin,size){var $x=tensor_util_env_1.convertToTensor(x,"x","slice2d");return util.assert(2===$x.rank,(function(){return"slice2d expects a rank-2 tensor, but got a rank-"+$x.rank+" tensor"})),exports.slice($x,begin,size)}function slice3d_(x,begin,size){var $x=tensor_util_env_1.convertToTensor(x,"x","slice3d");return util.assert(3===$x.rank,(function(){return"slice3d expects a rank-3 tensor, but got a rank-"+$x.rank+" tensor"})),exports.slice($x,begin,size)}function slice4d_(x,begin,size){var $x=tensor_util_env_1.convertToTensor(x,"x","slice4d");return util.assert(4===$x.rank,(function(){return"slice4d expects a rank-4 tensor, but got a rank-"+$x.rank+" tensor"})),exports.slice($x,begin,size)}function slice_(x,begin,size){var $x=tensor_util_env_1.convertToTensor(x,"x","slice"),begin_,size_;if(0===$x.rank)throw new Error("Slicing scalar is not possible");(begin_="number"==typeof begin?[begin].concat(new Array($x.rank-1).fill(0)):begin.length<$x.rank?begin.concat(new Array($x.rank-begin.length).fill(0)):begin.slice()).forEach((function(d){util.assert(-1!==d,(function(){return"slice() does not support negative begin indexing."}))})),size_=(size_=null==size?new Array($x.rank).fill(-1):"number"==typeof size?[size].concat(new Array($x.rank-1).fill(-1)):size.length<$x.rank?size.concat(new Array($x.rank-size.length).fill(-1)):size).map((function(d,i){return d>=0?d:(util.assert(-1===d,(function(){return"Negative size values should be exactly -1 but got "+d+" for the slice() size at index "+i+"."})),$x.shape[i]-begin_[i])})),slice_util.assertParamsValid($x,begin_,size_);var inputShape=$x.shape,grad=function(dy){for(var paddings=[],i=0;i<dy.rank;i++)paddings.push([begin_[i],inputShape[i]-begin_[i]-size_[i]]);return{$x:function(){return dy.pad(paddings)}}};return engine_1.ENGINE.runKernel((function(backend){return backend.slice($x,begin_,size_)}),{$x:$x},grad)}exports.slice=operation_1.op({slice_:slice_}),exports.slice1d=operation_1.op({slice1d_:slice1d_}),exports.slice2d=operation_1.op({slice2d_:slice2d_}),exports.slice3d=operation_1.op({slice3d_:slice3d_}),exports.slice4d=operation_1.op({slice4d_:slice4d_})},{"../engine":150,"../tensor_util_env":244,"../util":248,"./operation":202,"./slice_util":217}],217:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2017 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var util=require("../util");function assertParamsValid(input,begin,size){util.assert(input.rank===begin.length,(function(){return"Error in slice"+input.rank+"D: Length of begin "+begin+" must match the rank of the array ("+input.rank+")."})),util.assert(input.rank===size.length,(function(){return"Error in slice"+input.rank+"D: Length of size "+size+" must match the rank of the array ("+input.rank+")."}));for(var _loop_1=function(i){util.assert(begin[i]+size[i]<=input.shape[i],(function(){return"Error in slice"+input.rank+"D: begin["+i+"] + size["+i+"] ("+(begin[i]+size[i])+") would overflow input.shape["+i+"] ("+input.shape[i]+")"}))},i=0;i<input.rank;++i)_loop_1(i)}function maskToAxes(mask){for(var axes=[],axis=0;mask>0;)1&mask&&axes.push(axis),mask/=2,axis++;return axes}function computeOutShape(begin,end,strides){for(var size=[],axis=0;axis<begin.length;axis++)size[axis]=Math.ceil((end[axis]-begin[axis])/strides[axis]);return size}function startForAxis(beginMask,startIndices,strides,inputShape,axis){var start=startIndices[axis],stride=strides[axis]||1;(beginMask&1<<axis||null==start)&&(start=stride>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var axisSize=inputShape[axis];return start<0&&(start+=axisSize),start=util.clamp(0,start,axisSize-1)}function stopForAxis(endMask,stopIndices,strides,inputShape,axis){var stop=stopIndices[axis],stride=strides[axis]||1;(endMask&1<<axis||null==stop)&&(stop=stride>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var axisSize=inputShape[axis];return stop<0&&(stop+=axisSize),stop=stride>0?util.clamp(0,stop,axisSize):util.clamp(-1,stop,axisSize-1)}function isSliceContinous(shape,begin,size){for(var firstNonOneAxis=size.length,i=0;i<size.length;i++)if(size[i]>1){firstNonOneAxis=i;break}for(var i=firstNonOneAxis+1;i<size.length;i++)if(begin[i]>0||size[i]!==shape[i])return!1;return!0}function computeFlatOffset(begin,strides){for(var flatOffset=begin.length>0?begin[begin.length-1]:1,i=0;i<begin.length-1;i++)flatOffset+=begin[i]*strides[i];return flatOffset}exports.assertParamsValid=assertParamsValid,exports.maskToAxes=maskToAxes,exports.computeOutShape=computeOutShape,exports.startForAxis=startForAxis,exports.stopForAxis=stopForAxis,exports.isSliceContinous=isSliceContinous,exports.computeFlatOffset=computeFlatOffset},{"../util":248}],218:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var gradients_1=require("../gradients"),tensor_util_env_1=require("../tensor_util_env"),operation_1=require("./operation");function softmax_(logits,dim){void 0===dim&&(dim=-1);var $logits=tensor_util_env_1.convertToTensor(logits,"logits","softmax"),customOp;if(-1===dim&&(dim=$logits.rank-1),dim!==$logits.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+$logits.rank+" and dim was "+dim);return gradients_1.customGrad((function(logits,save){var keepDims=!0,lse=logits.logSumExp([dim],!0),logResult,y=logits.toFloat().sub(lse).exp(),gradFunc;return save([y]),{value:y,gradFunc:function(dy,saved){var y=saved[0],dyTimesY=dy.mul(y),keepDims=!0;return dyTimesY.sub(dyTimesY.sum([dim],!0).mul(y))}}}))($logits)}function logSoftmax_(logits,axis){void 0===axis&&(axis=-1);var $logits=tensor_util_env_1.convertToTensor(logits,"logits","logSoftmax"),customOp;if(-1===axis&&(axis=$logits.rank-1),axis!==$logits.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+$logits.rank+" and axis was "+axis);return gradients_1.customGrad((function(logits,save){var keepDims=!0,xMax=logits.max(axis,!0),shifted=logits.sub(xMax),value=shifted.toFloat().sub(shifted.exp().sum(axis,!0).log()),gradFunc;return save([value]),{value:value,gradFunc:function(dy,saved){var value,softmax=saved[0].exp();return dy.sub(dy.sum(axis,!0).mul(softmax))}}}))($logits)}exports.softmax=operation_1.op({softmax_:softmax_}),exports.logSoftmax=operation_1.op({logSoftmax_:logSoftmax_})},{"../gradients":154,"../tensor_util_env":244,"./operation":202}],219:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),sparse_to_dense=require("../ops/sparse_to_dense_util"),tensor_util_env_1=require("../tensor_util_env"),operation_1=require("./operation");function sparseToDense_(sparseIndices,sparseValues,outputShape,defaultValue){void 0===defaultValue&&(defaultValue=0);var $sparseIndices=tensor_util_env_1.convertToTensor(sparseIndices,"sparseIndices","sparseToDense","int32"),$sparseValues=tensor_util_env_1.convertToTensor(sparseValues,"sparseValues","sparseToDense"),$defaultValue=tensor_util_env_1.convertToTensor(defaultValue,"defaultValue","sparseToDense",$sparseValues.dtype);return sparse_to_dense.validateInput($sparseIndices,$sparseValues,outputShape,$defaultValue),engine_1.ENGINE.runKernel((function(backend){return backend.sparseToDense($sparseIndices,$sparseValues,outputShape,$defaultValue)}),{$sparseIndices:$sparseIndices,$sparseValues:$sparseValues,$defaultValue:$defaultValue})}exports.sparseToDense=operation_1.op({sparseToDense_:sparseToDense_})},{"../engine":150,"../ops/sparse_to_dense_util":220,"../tensor_util_env":244,"./operation":202}],220:[function(require,module,exports){"use strict";function validateInput(sparseIndices,sparseValues,outputShape,defaultValues){if("int32"!==sparseIndices.dtype)throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+sparseIndices.dtype+".");if(sparseIndices.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+sparseIndices.shape+".");var numElems=sparseIndices.rank>0?sparseIndices.shape[0]:1,numDims=sparseIndices.rank>1?sparseIndices.shape[1]:1;if(outputShape.length!==numDims)throw new Error("outputShape has incorrect number of elements:, "+outputShape.length+", should be: "+numDims+".");var numValues=sparseValues.size;if(0!==sparseValues.rank&&(1!==sparseValues.rank||numValues!==numElems))throw new Error("sparseValues has incorrect shape "+sparseValues.shape+", should be [] or ["+numElems+"]");if(sparseValues.dtype!==defaultValues.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}Object.defineProperty(exports,"__esModule",{value:!0}),exports.validateInput=validateInput},{}],221:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),complex_ops_1=require("../ops/complex_ops"),operation_1=require("../ops/operation"),util_1=require("../util"),tensor_ops_1=require("./tensor_ops");function fft_(input){util_1.assert("complex64"===input.dtype,(function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+input.dtype+"."}));var innerDimensionSize=input.shape[input.shape.length-1],batch=input.size/innerDimensionSize,input2D=input.as2D(batch,innerDimensionSize),ret;return engine_1.ENGINE.runKernel((function(backend){return backend.fft(input2D)}),{input:input}).reshape(input.shape)}function ifft_(input){util_1.assert("complex64"===input.dtype,(function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+input.dtype+"."}));var innerDimensionSize=input.shape[input.shape.length-1],batch=input.size/innerDimensionSize,input2D=input.as2D(batch,innerDimensionSize),ret;return engine_1.ENGINE.runKernel((function(backend){return backend.ifft(input2D)}),{input:input}).reshape(input.shape)}function rfft_(input,fftLength){util_1.assert("float32"===input.dtype,(function(){return"The dtype for rfft() must be real value but got "+input.dtype}));var innerDimensionSize=input.shape[input.shape.length-1],batch=input.size/innerDimensionSize,adjustedInput;if(null!=fftLength&&fftLength<innerDimensionSize){var begin=input.shape.map((function(v){return 0})),size=input.shape.map((function(v){return v}));size[input.shape.length-1]=fftLength,adjustedInput=input.slice(begin,size),innerDimensionSize=fftLength}else if(null!=fftLength&&fftLength>innerDimensionSize){var zerosShape=input.shape.map((function(v){return v}));zerosShape[input.shape.length-1]=fftLength-innerDimensionSize,adjustedInput=input.concat(tensor_ops_1.zeros(zerosShape),input.shape.length-1),innerDimensionSize=fftLength}else adjustedInput=input;var zerosInput=adjustedInput.zerosLike(),complexInput=complex_ops_1.complex(adjustedInput,zerosInput).as2D(batch,innerDimensionSize),ret=exports.fft(complexInput),half=Math.floor(innerDimensionSize/2)+1,realValues=complex_ops_1.real(ret),imagValues=complex_ops_1.imag(ret),realComplexConjugate=realValues.split([half,innerDimensionSize-half],realValues.shape.length-1),imagComplexConjugate=imagValues.split([half,innerDimensionSize-half],imagValues.shape.length-1),outputShape=adjustedInput.shape.slice();return outputShape[adjustedInput.shape.length-1]=half,complex_ops_1.complex(realComplexConjugate[0],imagComplexConjugate[0]).reshape(outputShape)}function irfft_(input){var innerDimensionSize=input.shape[input.shape.length-1],batch=input.size/innerDimensionSize;if(innerDimensionSize<=2){var complexInput=input.as2D(batch,innerDimensionSize),ret=exports.ifft(complexInput);return complex_ops_1.real(ret)}var outputShape=[batch,2*(innerDimensionSize-1)],realInput=complex_ops_1.real(input).as2D(batch,innerDimensionSize),imagInput=complex_ops_1.imag(input).as2D(batch,innerDimensionSize),realConjugate=realInput.slice([0,1],[batch,innerDimensionSize-2]).reverse(1),imagConjugate=imagInput.slice([0,1],[batch,innerDimensionSize-2]).reverse(1).mul(tensor_ops_1.scalar(-1)),r=realInput.concat(realConjugate,1),i=imagInput.concat(imagConjugate,1),complexInput=complex_ops_1.complex(r,i).as2D(outputShape[0],outputShape[1]),ret=exports.ifft(complexInput);return complex_ops_1.real(ret)}exports.fft=operation_1.op({fft_:fft_}),exports.ifft=operation_1.op({ifft_:ifft_}),exports.rfft=operation_1.op({rfft_:rfft_}),exports.irfft=operation_1.op({irfft_:irfft_})},{"../engine":150,"../ops/complex_ops":179,"../ops/operation":202,"../util":248,"./tensor_ops":223}],222:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),tensor_util_env_1=require("../tensor_util_env"),operation_1=require("./operation"),slice_1=require("./slice"),slice_util_1=require("./slice_util");function stridedSlice_(x,begin,end,strides,beginMask,endMask,ellipsisMask,newAxisMask,shrinkAxisMask){if(void 0===beginMask&&(beginMask=0),void 0===endMask&&(endMask=0),void 0===ellipsisMask&&(ellipsisMask=0),void 0===newAxisMask&&(newAxisMask=0),void 0===shrinkAxisMask&&(shrinkAxisMask=0),null==strides&&(strides=new Array(begin.length)),0!==ellipsisMask)throw new Error("ellipsis mask is not yet supported");var $x=tensor_util_env_1.convertToTensor(x,"x","stridedSlice"),expandAxes=slice_util_1.maskToAxes(newAxisMask),newShape=$x.shape.slice();expandAxes.forEach((function(axis){begin[axis]=0,end[axis]=1,newShape.splice(axis,0,1)})),$x=$x.reshape(newShape);for(var axis=0;axis<$x.rank;axis++)begin[axis]=slice_util_1.startForAxis(beginMask,begin,strides,$x.shape,axis),end[axis]=slice_util_1.stopForAxis(endMask,end,strides,$x.shape,axis),strides[axis]=strides[axis]||1;var shrinkAxes=slice_util_1.maskToAxes(shrinkAxisMask);shrinkAxes.forEach((function(axis){end[axis]=begin[axis]+1,strides[axis]=1}));var size=slice_util_1.computeOutShape(begin,end,strides),outShape=size.filter((function(_,axis){return-1===shrinkAxes.indexOf(axis)})),nonStrided,res;return strides.every((function(v){return 1===v}))?slice_1.slice($x,begin,size).reshape(outShape):engine_1.ENGINE.runKernel((function(backend){return backend.stridedSlice($x,begin,end,strides)}),{$x:$x}).reshape(outShape)}exports.stridedSlice=operation_1.op({stridedSlice_:stridedSlice_})},{"../engine":150,"../tensor_util_env":244,"./operation":202,"./slice":216,"./slice_util":217}],223:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),environment_1=require("../environment"),tensor_1=require("../tensor"),tensor_util_env_1=require("../tensor_util_env"),util_1=require("../util"),complex_ops_1=require("./complex_ops"),operation_1=require("./operation");function tensor(values,shape,dtype){var inferredShape;return makeTensor(values,shape,tensor_util_env_1.inferShape(values,dtype),dtype)}function makeTensor(values,shape,inferredShape,dtype){if(null==dtype&&(dtype=util_1.inferDtype(values)),"complex64"===dtype)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!util_1.isTypedArray(values)&&!Array.isArray(values)&&"number"!=typeof values&&"boolean"!=typeof values&&"string"!=typeof values)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=shape){util_1.assertNonNegativeIntegerDimensions(shape);var providedSize_1=util_1.sizeFromShape(shape),inferredSize_1=util_1.sizeFromShape(inferredShape);util_1.assert(providedSize_1===inferredSize_1,(function(){return"Based on the provided shape, ["+shape+"], the tensor should have "+providedSize_1+" values but has "+inferredSize_1}));for(var i=0;i<inferredShape.length;++i){var inferred=inferredShape[i],flatDimsDontMatch=i!==inferredShape.length-1||inferred!==util_1.sizeFromShape(shape.slice(i));util_1.assert(inferredShape[i]===shape[i]||!flatDimsDontMatch,(function(){return"Error creating a new Tensor. Inferred shape ("+inferredShape+") does not match the provided shape ("+shape+"). "}))}}return util_1.isTypedArray(values)||Array.isArray(values)||(values=[values]),shape=shape||inferredShape,values="string"!==dtype?util_1.toTypedArray(values,dtype,environment_1.ENV.getBool("DEBUG")):util_1.flatten(values,[],!0),tensor_1.Tensor.make(shape,{values:values},dtype)}function scalar(value,dtype){if((util_1.isTypedArray(value)&&"string"!==dtype||Array.isArray(value))&&"complex64"!==dtype)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===dtype&&util_1.isTypedArray(value)&&!(value instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");var shape,inferredShape;return makeTensor(value,[],[],dtype)}function tensor1d(values,dtype){util_1.assertNonNull(values);var inferredShape=tensor_util_env_1.inferShape(values,dtype);if(1!==inferredShape.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");var shape=null;return makeTensor(values,null,inferredShape,dtype)}function tensor2d(values,shape,dtype){if(util_1.assertNonNull(values),null!=shape&&2!==shape.length)throw new Error("tensor2d() requires shape to have two numbers");var inferredShape=tensor_util_env_1.inferShape(values,dtype);if(2!==inferredShape.length&&1!==inferredShape.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===inferredShape.length&&null==shape)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return makeTensor(values,shape,inferredShape,dtype)}function tensor3d(values,shape,dtype){if(util_1.assertNonNull(values),null!=shape&&3!==shape.length)throw new Error("tensor3d() requires shape to have three numbers");var inferredShape=tensor_util_env_1.inferShape(values,dtype);if(3!==inferredShape.length&&1!==inferredShape.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===inferredShape.length&&null==shape)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return makeTensor(values,shape,inferredShape,dtype)}function tensor4d(values,shape,dtype){if(util_1.assertNonNull(values),null!=shape&&4!==shape.length)throw new Error("tensor4d() requires shape to have four numbers");var inferredShape=tensor_util_env_1.inferShape(values,dtype);if(4!==inferredShape.length&&1!==inferredShape.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===inferredShape.length&&null==shape)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return makeTensor(values,shape,inferredShape,dtype)}function tensor5d(values,shape,dtype){if(util_1.assertNonNull(values),null!=shape&&5!==shape.length)throw new Error("tensor5d() requires shape to have five numbers");var inferredShape=tensor_util_env_1.inferShape(values,dtype);if(5!==inferredShape.length&&1!==inferredShape.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===inferredShape.length&&null==shape)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return makeTensor(values,shape,inferredShape,dtype)}function tensor6d(values,shape,dtype){if(util_1.assertNonNull(values),null!=shape&&6!==shape.length)throw new Error("tensor6d() requires shape to have six numbers");var inferredShape=tensor_util_env_1.inferShape(values,dtype);if(6!==inferredShape.length&&1!==inferredShape.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===inferredShape.length&&null==shape)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return makeTensor(values,shape=shape||inferredShape,inferredShape,dtype)}function ones(shape,dtype){if(void 0===dtype&&(dtype="float32"),"complex64"===dtype){var real_1=ones(shape,"float32"),imag_1=zeros(shape,"float32");return complex_ops_1.complex(real_1,imag_1)}var values=util_1.makeOnesTypedArray(util_1.sizeFromShape(shape),dtype);return tensor_1.Tensor.make(shape,{values:values},dtype)}function zeros(shape,dtype){if(void 0===dtype&&(dtype="float32"),"complex64"===dtype){var real_2=zeros(shape,"float32"),imag_2=zeros(shape,"float32");return complex_ops_1.complex(real_2,imag_2)}var values=util_1.makeZerosTypedArray(util_1.sizeFromShape(shape),dtype);return tensor_1.Tensor.make(shape,{values:values},dtype)}function fill(shape,value,dtype){return engine_1.ENGINE.runKernel((function(backend){return backend.fill(shape,value,dtype)}),{})}function onesLike_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","onesLike");if("complex64"===$x.dtype){var r=exports.onesLike(complex_ops_1.real($x)),i=exports.zerosLike(complex_ops_1.imag($x));return complex_ops_1.complex(r,i)}var der=function(dy,saved){return{$x:function(){return exports.zerosLike(dy)}}};return engine_1.ENGINE.runKernel((function(backend){return backend.onesLike($x)}),{$x:$x},der)}function zerosLike_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","zerosLike"),der=function(dy,saved){return{$x:function(){return exports.zerosLike(dy)}}};return engine_1.ENGINE.runKernel((function(backend){return backend.zerosLike($x)}),{$x:$x},der)}function linspace(start,stop,num){if(num<=0)throw new Error("The number of values should be positive.");return engine_1.ENGINE.runKernel((function(backend){return backend.linspace(start,stop,num)}),{})}function range(start,stop,step,dtype){if(void 0===step&&(step=1),void 0===dtype&&(dtype="float32"),0===step)throw new Error("Cannot have a step of zero");var sameStartStop,increasingRangeNegativeStep,decreasingRangePositiveStep;if(start===stop||start<stop&&step<0||stop<start&&step>1)return zeros([0],dtype);var numElements=Math.abs(Math.ceil((stop-start)/step)),values=util_1.makeZerosTypedArray(numElements,dtype);stop<start&&1===step&&(step=-1),values[0]=start;for(var i=1;i<values.length;i++)values[i]=values[i-1]+step;return tensor1d(values,dtype)}exports.tensor=tensor,exports.scalar=scalar,exports.tensor1d=tensor1d,exports.tensor2d=tensor2d,exports.tensor3d=tensor3d,exports.tensor4d=tensor4d,exports.tensor5d=tensor5d,exports.tensor6d=tensor6d,exports.ones=ones,exports.zeros=zeros,exports.fill=fill,exports.linspace=linspace,exports.range=range,exports.onesLike=operation_1.op({onesLike_:onesLike_}),exports.zerosLike=operation_1.op({zerosLike_:zerosLike_})},{"../engine":150,"../environment":151,"../tensor":241,"../tensor_util_env":244,"../util":248,"./complex_ops":179,"./operation":202}],224:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),tensor_util_env_1=require("../tensor_util_env"),operation_1=require("./operation");function topk_(x,k,sorted){void 0===k&&(k=1),void 0===sorted&&(sorted=!0);var $x=tensor_util_env_1.convertToTensor(x,"x","topk");if(0===$x.rank)throw new Error("topk() expects the input to be of rank 1 or higher");var lastDim=$x.shape[$x.shape.length-1];if(k>lastDim)throw new Error("'k' passed to topk() must be <= the last dimension ("+lastDim+") but got "+k);var _a=engine_1.ENGINE.runKernel((function(b){return b.topk($x,k,sorted)}),{$x:$x}),values,indices;return{values:_a[0],indices:_a[1]}}exports.topk=operation_1.op({topk_:topk_})},{"../engine":150,"../tensor_util_env":244,"./operation":202}],225:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),tensor_util_env_1=require("../tensor_util_env"),util=require("../util"),axis_util=require("./axis_util"),operation_1=require("./operation");function transpose_(x,perm){var $x=tensor_util_env_1.convertToTensor(x,"x","transpose");if(null==perm&&(perm=$x.shape.map((function(s,i){return i})).reverse()),util.assert($x.rank===perm.length,(function(){return"Error in transpose: rank of input "+$x.rank+" must match length of perm "+perm+"."})),perm.forEach((function(axis){util.assert(axis>=0&&axis<$x.rank,(function(){return"All entries in 'perm' must be between 0 and "+($x.rank-1)+" but got "+perm}))})),$x.rank<=1)return $x.clone();var der=function(dy){var undoPerm=axis_util.getUndoAxesPermutation(perm);return{$x:function(){return dy.transpose(undoPerm)}}};return engine_1.ENGINE.runKernel((function(backend){return backend.transpose($x,perm)}),{$x:$x},der)}exports.transpose=operation_1.op({transpose_:transpose_})},{"../engine":150,"../tensor_util_env":244,"../util":248,"./axis_util":172,"./operation":202}],226:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),tensor_util_env_1=require("../tensor_util_env"),util=require("../util"),operation_1=require("./operation"),tensor_ops_1=require("./tensor_ops");function neg_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","neg"),grad=function(dy){return{$x:function(){return dy.neg()}}};return engine_1.ENGINE.runKernel((function(backend){return backend.neg($x)}),{$x:$x},grad)}function ceil_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","ceil"),grad=function(dy){return{$x:function(){return tensor_ops_1.zerosLike(dy)}}};return engine_1.ENGINE.runKernel((function(backend){return backend.ceil($x)}),{$x:$x},grad)}function floor_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","floor"),grad=function(dy){return{$x:function(){return tensor_ops_1.zerosLike(dy)}}};return engine_1.ENGINE.runKernel((function(backend){return backend.floor($x)}),{$x:$x},grad)}function sign_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","sign"),grad=function(dy){return{$x:function(){return tensor_ops_1.zerosLike(dy)}}};return engine_1.ENGINE.runKernel((function(backend){return backend.sign($x)}),{$x:$x},grad)}function isNaN_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","isNaN"),grad=function(dy){return{$x:function(){return tensor_ops_1.zerosLike(dy)}}};return engine_1.ENGINE.runKernel((function(backend){return backend.isNaN($x)}),{$x:$x},grad)}function isInf_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","isInf"),grad=function(dy){return{$x:function(){return tensor_ops_1.zerosLike(dy)}}};return engine_1.ENGINE.runKernel((function(backend){return backend.isInf($x)}),{$x:$x},grad)}function isFinite_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","isFinite"),grad=function(dy){return{$x:function(){return tensor_ops_1.zerosLike(dy)}}};return engine_1.ENGINE.runKernel((function(backend){return backend.isFinite($x)}),{$x:$x},grad)}function round_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","round"),grad=function(dy){return{$x:function(){return tensor_ops_1.zerosLike(dy)}}};return engine_1.ENGINE.runKernel((function(backend){return backend.round($x)}),{$x:$x},grad)}function exp_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","exp"),bck=function(dy,saved){return{$x:function(){return dy.mulStrict(saved[0])}}};return engine_1.ENGINE.runKernel((function(backend,save){var y=backend.exp($x);return save([y]),y}),{$x:$x},bck)}function expm1_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","expm1"),grad=function(dy,saved){var $x=saved[0];return{$x:function(){return dy.mul($x.exp())}}};return engine_1.ENGINE.runKernel((function(backend,save){var res=backend.expm1($x);return save([$x]),res}),{$x:$x},grad)}function log_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","log"),grad=function(dy,saved){var $x=saved[0];return{$x:function(){return dy.div($x.toFloat())}}};return engine_1.ENGINE.runKernel((function(backend,save){var res=backend.log($x);return save([$x]),res}),{$x:$x},grad)}function log1p_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","log1p"),grad=function(dy,saved){var $x=saved[0];return{$x:function(){return dy.div($x.add(1))}}};return engine_1.ENGINE.runKernel((function(backend,save){var res=backend.log1p($x);return save([$x]),res}),{$x:$x},grad)}function sqrt_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","sqrt"),grad=function(dy,saved){var $x=saved[0];return{$x:function(){return dy.div($x.toFloat().sqrt().mul(2))}}};return engine_1.ENGINE.runKernel((function(backend,save){var res=backend.sqrt($x);return save([$x]),res}),{$x:$x},grad)}function rsqrt_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","rsqrt"),grad=function(dy,saved){var $x=saved[0];return{$x:function(){return dy.div($x.pow(1.5).mul(2)).neg()}}};return engine_1.ENGINE.runKernel((function(backend,save){var res=backend.rsqrt($x);return save([$x]),res}),{$x:$x},grad)}function square_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","square"),grad=function(dy,saved){var $x=saved[0];return{$x:function(){return dy.mul($x.toFloat().mul(2))}}};return engine_1.ENGINE.runKernel((function(backend,save){return save([$x]),backend.square($x)}),{$x:$x},grad)}function reciprocal_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","reciprocal"),grad=function(dy,saved){var $x=saved[0];return{$x:function(){return dy.div($x.square().neg())}}};return engine_1.ENGINE.runKernel((function(backend,save){var res=backend.reciprocal($x);return save([$x]),res}),{$x:$x},grad)}function abs_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","abs");if("complex64"===$x.dtype)return engine_1.ENGINE.runKernel((function(backend){return backend.complexAbs($x)}),{$x:$x});var grad=function(dy,saved){var $x=saved[0];return{$x:function(){return dy.mul($x.toFloat().step(-1))}}};return engine_1.ENGINE.runKernel((function(backend,save){var res=backend.abs($x);return save([$x]),res}),{$x:$x},grad)}function clipByValue_(x,clipValueMin,clipValueMax){var $x=tensor_util_env_1.convertToTensor(x,"x","clipByValue");util.assert(clipValueMin<=clipValueMax,(function(){return"Error in clip: min ("+clipValueMin+") must be less than or equal to max ("+clipValueMax+")."}));var grad=function(dy,saved){var $x=saved[0];return{$x:function(){return dy.where($x.greaterEqual(clipValueMin).logicalAnd($x.lessEqual(clipValueMax)),tensor_ops_1.zerosLike(dy))}}};return engine_1.ENGINE.runKernel((function(backend,save){var res=backend.clip($x,clipValueMin,clipValueMax);return save([$x]),res}),{$x:$x},grad)}function sigmoid_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","sigmoid"),grad=function(dy,saved){var y=saved[0];return{$x:function(){return dy.mul(y.mul(tensor_ops_1.scalar(1).sub(y)))}}};return engine_1.ENGINE.runKernel((function(backend,save){var y=backend.sigmoid($x);return save([y]),y}),{$x:$x},grad)}function logSigmoid_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","logSigmoid"),grad=function(dy,saved){var $x=saved[0];return{$x:function(){return dy.mul($x.neg().sigmoid())}}};return engine_1.ENGINE.runKernel((function(backend,save){var res=backend.softplus($x.neg()).neg();return save([$x]),res}),{$x:$x},grad)}function softplus_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","softplus"),grad=function(dy,saved){var $x=saved[0];return{$x:function(){return dy.mul($x.sigmoid())}}};return engine_1.ENGINE.runKernel((function(backend,save){var res=backend.softplus($x);return save([$x]),res}),{$x:$x},grad)}function sin_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","sin"),grad=function(dy,saved){var $x=saved[0];return{$x:function(){return $x.toFloat().cos().mul(dy)}}};return engine_1.ENGINE.runKernel((function(backend,save){var res=backend.sin($x);return save([$x]),res}),{$x:$x},grad)}function cos_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","cos"),grad=function(dy,saved){var $x=saved[0];return{$x:function(){return $x.toFloat().sin().neg().mul(dy)}}};return engine_1.ENGINE.runKernel((function(backend,save){var res=backend.cos($x);return save([$x]),res}),{$x:$x},grad)}function tan_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","tan"),grad=function(dy,saved){var $x=saved[0];return{$x:function(){return dy.div($x.cos().square())}}};return engine_1.ENGINE.runKernel((function(backend,save){var res=backend.tan($x);return save([$x]),res}),{$x:$x},grad)}function asin_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","asin"),grad=function(dy,saved){var $x=saved[0];return{$x:function(){return dy.divStrict(tensor_ops_1.scalar(1).sub($x.toFloat().square()).sqrt())}}};return engine_1.ENGINE.runKernel((function(backend,save){var res=backend.asin($x);return save([$x]),res}),{$x:$x},grad)}function acos_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","acos"),grad=function(dy,saved){var $x=saved[0];return{$x:function(){return dy.divStrict(tensor_ops_1.scalar(1).sub($x.toFloat().square()).sqrt()).neg()}}};return engine_1.ENGINE.runKernel((function(backend,save){var res=backend.acos($x);return save([$x]),res}),{$x:$x},grad)}function atan_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","atan"),grad=function(dy,saved){var $x=saved[0];return{$x:function(){return dy.div($x.toFloat().square().add(1))}}};return engine_1.ENGINE.runKernel((function(backend,save){var res=backend.atan($x);return save([$x]),res}),{$x:$x},grad)}function sinh_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","sinh"),grad=function(dy,saved){var $x=saved[0];return{$x:function(){return $x.toFloat().cosh().mulStrict(dy)}}};return engine_1.ENGINE.runKernel((function(backend,save){var res=backend.sinh($x);return save([$x]),res}),{$x:$x},grad)}function cosh_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","cosh"),grad=function(dy,saved){var $x=saved[0];return{$x:function(){return $x.toFloat().sinh().mulStrict(dy)}}};return engine_1.ENGINE.runKernel((function(backend,save){var res=backend.cosh($x);return save([$x]),res}),{$x:$x},grad)}function tanh_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","tanh"),grad=function(dy,saved){var y=saved[0];return{$x:function(){return tensor_ops_1.scalar(1).sub(y.square()).mulStrict(dy)}}};return engine_1.ENGINE.runKernel((function(backend,save){var y=backend.tanh($x);return save([y]),y}),{$x:$x},grad)}function asinh_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","asinh"),grad=function(dy,saved){var $x=saved[0];return{$x:function(){return dy.divStrict(tensor_ops_1.scalar(1).add($x.toFloat().square()).sqrt())}}};return engine_1.ENGINE.runKernel((function(backend,save){var res=backend.asinh($x);return save([$x]),res}),{$x:$x},grad)}function acosh_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","acosh"),grad=function(dy,saved){var $x=saved[0];return{$x:function(){return dy.divStrict($x.toFloat().square().sub(1).sqrt())}}};return engine_1.ENGINE.runKernel((function(backend,save){var res=backend.acosh($x);return save([$x]),res}),{$x:$x},grad)}function atanh_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","atanh"),grad=function(dy,saved){var $x=saved[0];return{$x:function(){return dy.div(tensor_ops_1.scalar(1).sub($x.toFloat().square()))}}};return engine_1.ENGINE.runKernel((function(backend,save){var res=backend.atanh($x);return save([$x]),res}),{$x:$x},grad)}function erf_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","erf");util.assert("int32"===$x.dtype||"float32"===$x.dtype,(function(){return"Input dtype must be `int32` or `float32`."})),"int32"===$x.dtype&&($x=$x.toFloat());var grad=function(dy,saved){var $x=saved[0];return{$x:function(){return dy.mul($x.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}};return engine_1.ENGINE.runKernel((function(backend,save){var res=backend.erf($x);return save([$x]),res}),{$x:$x},grad)}function step_(x,alpha){void 0===alpha&&(alpha=0);var $x=tensor_util_env_1.convertToTensor(x,"x","step"),grad=function(dy){return{$x:function(){return tensor_ops_1.zerosLike(dy)}}};return engine_1.ENGINE.runKernel((function(backend){return backend.step($x,alpha)}),{$x:$x},grad)}exports.abs=operation_1.op({abs_:abs_}),exports.acos=operation_1.op({acos_:acos_}),exports.acosh=operation_1.op({acosh_:acosh_}),exports.asin=operation_1.op({asin_:asin_}),exports.asinh=operation_1.op({asinh_:asinh_}),exports.atan=operation_1.op({atan_:atan_}),exports.atanh=operation_1.op({atanh_:atanh_}),exports.ceil=operation_1.op({ceil_:ceil_}),exports.clipByValue=operation_1.op({clipByValue_:clipByValue_}),exports.cos=operation_1.op({cos_:cos_}),exports.cosh=operation_1.op({cosh_:cosh_}),exports.erf=operation_1.op({erf_:erf_}),exports.exp=operation_1.op({exp_:exp_}),exports.expm1=operation_1.op({expm1_:expm1_}),exports.floor=operation_1.op({floor_:floor_}),exports.log=operation_1.op({log_:log_}),exports.log1p=operation_1.op({log1p_:log1p_}),exports.logSigmoid=operation_1.op({logSigmoid_:logSigmoid_}),exports.neg=operation_1.op({neg_:neg_}),exports.reciprocal=operation_1.op({reciprocal_:reciprocal_}),exports.round=operation_1.op({round_:round_}),exports.rsqrt=operation_1.op({rsqrt_:rsqrt_}),exports.sigmoid=operation_1.op({sigmoid_:sigmoid_}),exports.sign=operation_1.op({sign_:sign_}),exports.isNaN=operation_1.op({isNaN_:isNaN_}),exports.isInf=operation_1.op({isInf_:isInf_}),exports.isFinite=operation_1.op({isFinite_:isFinite_}),exports.sin=operation_1.op({sin_:sin_}),exports.sinh=operation_1.op({sinh_:sinh_}),exports.softplus=operation_1.op({softplus_:softplus_}),exports.sqrt=operation_1.op({sqrt_:sqrt_}),exports.square=operation_1.op({square_:square_}),exports.step=operation_1.op({step_:step_}),exports.tan=operation_1.op({tan_:tan_}),exports.tanh=operation_1.op({tanh_:tanh_})},{"../engine":150,"../tensor_util_env":244,"../util":248,"./operation":202,"./tensor_ops":223}],227:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var __extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}),extendStatics,__awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P((function(resolve){resolve(result.value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},__generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}};Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),globals_1=require("../globals"),ops_1=require("../ops/ops"),serialization_1=require("../serialization"),optimizer_1,AdadeltaOptimizer=function(_super){function AdadeltaOptimizer(learningRate,rho,epsilon){void 0===epsilon&&(epsilon=null);var _this=_super.call(this)||this;return _this.learningRate=learningRate,_this.rho=rho,_this.epsilon=epsilon,_this.accumulatedGrads=[],_this.accumulatedUpdates=[],null==epsilon&&(_this.epsilon=engine_1.ENGINE.backend.epsilon()),_this}return __extends(AdadeltaOptimizer,_super),AdadeltaOptimizer.prototype.applyGradients=function(variableGradients){var _this=this,variableNames;(Array.isArray(variableGradients)?variableGradients.map((function(item){return item.name})):Object.keys(variableGradients)).forEach((function(name,i){var value=engine_1.ENGINE.registeredVariables[name],trainable=!1;null==_this.accumulatedGrads[i]&&(_this.accumulatedGrads[i]={originalName:name+"/accum_grad",variable:globals_1.tidy((function(){return ops_1.zerosLike(value).variable(!1)}))}),null==_this.accumulatedUpdates[i]&&(_this.accumulatedUpdates[i]={originalName:name+"/accum_var",variable:globals_1.tidy((function(){return ops_1.zerosLike(value).variable(!1)}))});var gradient=Array.isArray(variableGradients)?variableGradients[i].tensor:variableGradients[name];if(null!=gradient){var accumulatedGrad=_this.accumulatedGrads[i].variable,accumulatedUpdate=_this.accumulatedUpdates[i].variable;globals_1.tidy((function(){var newAccumulatedGrad=accumulatedGrad.mul(_this.rho).add(gradient.square().mul(1-_this.rho)),updates=accumulatedUpdate.add(_this.epsilon).sqrt().div(accumulatedGrad.add(_this.epsilon).sqrt()).mul(gradient),newAccumulatedUpdate=accumulatedUpdate.mul(_this.rho).add(updates.square().mul(1-_this.rho));accumulatedGrad.assign(newAccumulatedGrad),accumulatedUpdate.assign(newAccumulatedUpdate);var newValue=updates.mul(-_this.learningRate).add(value);value.assign(newValue)}))}})),this.incrementIterations()},AdadeltaOptimizer.prototype.dispose=function(){null!=this.accumulatedUpdates&&(globals_1.dispose(this.accumulatedGrads.map((function(v){return v.variable}))),globals_1.dispose(this.accumulatedUpdates.map((function(v){return v.variable}))))},AdadeltaOptimizer.prototype.getWeights=function(){return __awaiter(this,void 0,void 0,(function(){var variables;return __generator(this,(function(_a){switch(_a.label){case 0:return variables=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[_a.sent()].concat(variables.map((function(v){return{name:v.originalName,tensor:v.variable}})))]}}))}))},AdadeltaOptimizer.prototype.setWeights=function(weightValues){return __awaiter(this,void 0,void 0,(function(){var variableCount,trainable;return __generator(this,(function(_a){switch(_a.label){case 0:return[4,this.extractIterations(weightValues)];case 1:return weightValues=_a.sent(),variableCount=weightValues.length/2,trainable=!1,this.accumulatedGrads=weightValues.slice(0,variableCount).map((function(v){return{originalName:v.name,variable:v.tensor.variable(!1)}})),this.accumulatedUpdates=weightValues.slice(variableCount,2*variableCount).map((function(v){return{originalName:v.name,variable:v.tensor.variable(!1)}})),[2]}}))}))},AdadeltaOptimizer.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},AdadeltaOptimizer.fromConfig=function(cls,config){return new cls(config.learningRate,config.rho,config.epsilon)},AdadeltaOptimizer.className="Adadelta",AdadeltaOptimizer}(require("./optimizer").Optimizer);exports.AdadeltaOptimizer=AdadeltaOptimizer,serialization_1.registerClass(AdadeltaOptimizer)},{"../engine":150,"../globals":153,"../ops/ops":203,"../serialization":239,"./optimizer":232}],228:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var __extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}),extendStatics,__awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P((function(resolve){resolve(result.value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},__generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}};Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),globals_1=require("../globals"),ops_1=require("../ops/ops"),serialization_1=require("../serialization"),optimizer_1,AdagradOptimizer=function(_super){function AdagradOptimizer(learningRate,initialAccumulatorValue){void 0===initialAccumulatorValue&&(initialAccumulatorValue=.1);var _this=_super.call(this)||this;return _this.learningRate=learningRate,_this.initialAccumulatorValue=initialAccumulatorValue,_this.accumulatedGrads=[],_this}return __extends(AdagradOptimizer,_super),AdagradOptimizer.prototype.applyGradients=function(variableGradients){var _this=this,variableNames;(Array.isArray(variableGradients)?variableGradients.map((function(item){return item.name})):Object.keys(variableGradients)).forEach((function(name,i){var value=engine_1.ENGINE.registeredVariables[name];if(null==_this.accumulatedGrads[i]){var trainable_1=!1;_this.accumulatedGrads[i]={originalName:name+"/accumulator",variable:globals_1.tidy((function(){return ops_1.fill(value.shape,_this.initialAccumulatorValue).variable(!1)}))}}var gradient=Array.isArray(variableGradients)?variableGradients[i].tensor:variableGradients[name];if(null!=gradient){var accumulatedGrad=_this.accumulatedGrads[i].variable;globals_1.tidy((function(){var newAccumulatedGrad=accumulatedGrad.add(gradient.square());accumulatedGrad.assign(newAccumulatedGrad);var newValue=gradient.div(newAccumulatedGrad.add(engine_1.ENGINE.backend.epsilon()).sqrt()).mul(-_this.learningRate).add(value);value.assign(newValue)}))}})),this.incrementIterations()},AdagradOptimizer.prototype.dispose=function(){null!=this.accumulatedGrads&&globals_1.dispose(this.accumulatedGrads.map((function(v){return v.variable})))},AdagradOptimizer.prototype.getWeights=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(_a){switch(_a.label){case 0:return[4,this.saveIterations()];case 1:return[2,[_a.sent()].concat(this.accumulatedGrads.map((function(v){return{name:v.originalName,tensor:v.variable}})))]}}))}))},AdagradOptimizer.prototype.setWeights=function(weightValues){return __awaiter(this,void 0,void 0,(function(){var trainable;return __generator(this,(function(_a){switch(_a.label){case 0:return[4,this.extractIterations(weightValues)];case 1:return weightValues=_a.sent(),trainable=!1,this.accumulatedGrads=weightValues.map((function(v){return{originalName:v.name,variable:v.tensor.variable(!1)}})),[2]}}))}))},AdagradOptimizer.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},AdagradOptimizer.fromConfig=function(cls,config){return new cls(config.learningRate,config.initialAccumulatorValue)},AdagradOptimizer.className="Adagrad",AdagradOptimizer}(require("./optimizer").Optimizer);exports.AdagradOptimizer=AdagradOptimizer,serialization_1.registerClass(AdagradOptimizer)},{"../engine":150,"../globals":153,"../ops/ops":203,"../serialization":239,"./optimizer":232}],229:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var __extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}),extendStatics,__awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P((function(resolve){resolve(result.value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},__generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}};Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),globals_1=require("../globals"),ops_1=require("../ops/ops"),serialization_1=require("../serialization"),optimizer_1,AdamOptimizer=function(_super){function AdamOptimizer(learningRate,beta1,beta2,epsilon){void 0===epsilon&&(epsilon=null);var _this=_super.call(this)||this;return _this.learningRate=learningRate,_this.beta1=beta1,_this.beta2=beta2,_this.epsilon=epsilon,_this.accumulatedFirstMoment=[],_this.accumulatedSecondMoment=[],globals_1.tidy((function(){_this.accBeta1=ops_1.scalar(beta1).variable(),_this.accBeta2=ops_1.scalar(beta2).variable()})),null==epsilon&&(_this.epsilon=engine_1.ENGINE.backend.epsilon()),_this}return __extends(AdamOptimizer,_super),AdamOptimizer.prototype.applyGradients=function(variableGradients){var _this=this,varNames=Array.isArray(variableGradients)?variableGradients.map((function(v){return v.name})):Object.keys(variableGradients);globals_1.tidy((function(){var oneMinusAccBeta1=ops_1.sub(1,_this.accBeta1),oneMinusAccBeta2=ops_1.sub(1,_this.accBeta2);varNames.forEach((function(name,i){var value=engine_1.ENGINE.registeredVariables[name],trainable=!1;null==_this.accumulatedFirstMoment[i]&&(_this.accumulatedFirstMoment[i]={originalName:name+"/m",variable:globals_1.tidy((function(){return ops_1.zerosLike(value).variable(!1)}))}),null==_this.accumulatedSecondMoment[i]&&(_this.accumulatedSecondMoment[i]={originalName:name+"/v",variable:globals_1.tidy((function(){return ops_1.zerosLike(value).variable(!1)}))});var gradient=Array.isArray(variableGradients)?variableGradients[i].tensor:variableGradients[name];if(null!=gradient){var firstMoment=_this.accumulatedFirstMoment[i].variable,secondMoment=_this.accumulatedSecondMoment[i].variable,newFirstMoment=firstMoment.mul(_this.beta1).add(gradient.mul(1-_this.beta1)),newSecondMoment=secondMoment.mul(_this.beta2).add(gradient.square().mul(1-_this.beta2)),biasCorrectedFirstMoment=newFirstMoment.div(oneMinusAccBeta1),biasCorrectedSecondMoment=newSecondMoment.div(oneMinusAccBeta2);firstMoment.assign(newFirstMoment),secondMoment.assign(newSecondMoment);var newValue=biasCorrectedFirstMoment.div(biasCorrectedSecondMoment.sqrt().add(_this.epsilon)).mul(-_this.learningRate).add(value);value.assign(newValue)}})),_this.accBeta1.assign(_this.accBeta1.mul(_this.beta1)),_this.accBeta2.assign(_this.accBeta2.mul(_this.beta2))})),this.incrementIterations()},AdamOptimizer.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&globals_1.dispose(this.accumulatedFirstMoment.map((function(v){return v.variable}))),null!=this.accumulatedSecondMoment&&globals_1.dispose(this.accumulatedSecondMoment.map((function(v){return v.variable})))},AdamOptimizer.prototype.getWeights=function(){return __awaiter(this,void 0,void 0,(function(){var variables;return __generator(this,(function(_a){switch(_a.label){case 0:return variables=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[_a.sent()].concat(variables.map((function(v){return{name:v.originalName,tensor:v.variable}})))]}}))}))},AdamOptimizer.prototype.setWeights=function(weightValues){return __awaiter(this,void 0,void 0,(function(){var variableCount,trainable,_this=this;return __generator(this,(function(_a){switch(_a.label){case 0:return[4,this.extractIterations(weightValues)];case 1:return weightValues=_a.sent(),globals_1.tidy((function(){_this.accBeta1.assign(ops_1.pow(_this.beta1,_this.iterations_+1)),_this.accBeta2.assign(ops_1.pow(_this.beta2,_this.iterations_+1))})),variableCount=weightValues.length/2,trainable=!1,this.accumulatedFirstMoment=weightValues.slice(0,variableCount).map((function(v){return{originalName:v.name,variable:v.tensor.variable(!1)}})),this.accumulatedSecondMoment=weightValues.slice(variableCount,2*variableCount).map((function(v){return{originalName:v.name,variable:v.tensor.variable(!1)}})),[2]}}))}))},AdamOptimizer.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},AdamOptimizer.fromConfig=function(cls,config){return new cls(config.learningRate,config.beta1,config.beta2,config.epsilon)},AdamOptimizer.className="Adam",AdamOptimizer}(require("./optimizer").Optimizer);exports.AdamOptimizer=AdamOptimizer,serialization_1.registerClass(AdamOptimizer)},{"../engine":150,"../globals":153,"../ops/ops":203,"../serialization":239,"./optimizer":232}],230:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var __extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}),extendStatics,__awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P((function(resolve){resolve(result.value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},__generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}};Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),globals_1=require("../globals"),ops_1=require("../ops/ops"),serialization_1=require("../serialization"),optimizer_1,AdamaxOptimizer=function(_super){function AdamaxOptimizer(learningRate,beta1,beta2,epsilon,decay){void 0===epsilon&&(epsilon=null),void 0===decay&&(decay=0);var _this=_super.call(this)||this;return _this.learningRate=learningRate,_this.beta1=beta1,_this.beta2=beta2,_this.epsilon=epsilon,_this.decay=decay,_this.accumulatedFirstMoment=[],_this.accumulatedWeightedInfNorm=[],globals_1.tidy((function(){_this.iteration=ops_1.scalar(0).variable(),_this.accBeta1=ops_1.scalar(beta1).variable()})),null==epsilon&&(_this.epsilon=engine_1.ENGINE.backend.epsilon()),_this}return __extends(AdamaxOptimizer,_super),AdamaxOptimizer.prototype.applyGradients=function(variableGradients){var _this=this,variableNames=Array.isArray(variableGradients)?variableGradients.map((function(item){return item.name})):Object.keys(variableGradients);globals_1.tidy((function(){var oneMinusAccBeta1=ops_1.sub(1,_this.accBeta1),lr=ops_1.div(-_this.learningRate,_this.iteration.mul(_this.decay).add(1));variableNames.forEach((function(name,i){var value=engine_1.ENGINE.registeredVariables[name],trainable=!1;null==_this.accumulatedFirstMoment[i]&&(_this.accumulatedFirstMoment[i]={originalName:name+"/m",variable:ops_1.zerosLike(value).variable(!1)}),null==_this.accumulatedWeightedInfNorm[i]&&(_this.accumulatedWeightedInfNorm[i]={originalName:name+"/v",variable:ops_1.zerosLike(value).variable(!1)});var gradient=Array.isArray(variableGradients)?variableGradients[i].tensor:variableGradients[name];if(null!=gradient){var firstMoment=_this.accumulatedFirstMoment[i].variable,weightedInfNorm=_this.accumulatedWeightedInfNorm[i].variable,newFirstMoment=firstMoment.mul(_this.beta1).add(gradient.mul(1-_this.beta1)),ut0=weightedInfNorm.mul(_this.beta2),ut1=gradient.abs(),newWeightedInfNorm=ut0.maximum(ut1);firstMoment.assign(newFirstMoment),weightedInfNorm.assign(newWeightedInfNorm);var newValue=lr.div(oneMinusAccBeta1).mul(newFirstMoment.div(newWeightedInfNorm.add(_this.epsilon))).add(value);value.assign(newValue)}})),_this.iteration.assign(_this.iteration.add(1)),_this.accBeta1.assign(_this.accBeta1.mul(_this.beta1))})),this.incrementIterations()},AdamaxOptimizer.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&globals_1.dispose(this.accumulatedFirstMoment.map((function(v){return v.variable}))),null!=this.accumulatedWeightedInfNorm&&globals_1.dispose(this.accumulatedWeightedInfNorm.map((function(v){return v.variable})))},AdamaxOptimizer.prototype.getWeights=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(_a){throw new Error("getWeights() is not implemented for Adamax yet.")}))}))},AdamaxOptimizer.prototype.setWeights=function(weightValues){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(_a){throw new Error("setWeights() is not implemented for Adamax yet.")}))}))},AdamaxOptimizer.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},AdamaxOptimizer.fromConfig=function(cls,config){return new cls(config.learningRate,config.beta1,config.beta2,config.epsilon,config.decay)},AdamaxOptimizer.className="Adamax",AdamaxOptimizer}(require("./optimizer").Optimizer);exports.AdamaxOptimizer=AdamaxOptimizer,serialization_1.registerClass(AdamaxOptimizer)},{"../engine":150,"../globals":153,"../ops/ops":203,"../serialization":239,"./optimizer":232}],231:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var __extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}),extendStatics,__awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P((function(resolve){resolve(result.value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},__generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}};Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),globals_1=require("../globals"),ops_1=require("../ops/ops"),serialization_1=require("../serialization"),sgd_optimizer_1,MomentumOptimizer=function(_super){function MomentumOptimizer(learningRate,momentum,useNesterov){void 0===useNesterov&&(useNesterov=!1);var _this=_super.call(this,learningRate)||this;return _this.learningRate=learningRate,_this.momentum=momentum,_this.useNesterov=useNesterov,_this.accumulations=[],_this.m=ops_1.scalar(_this.momentum),_this}return __extends(MomentumOptimizer,_super),MomentumOptimizer.prototype.applyGradients=function(variableGradients){var _this=this,variableNames;(Array.isArray(variableGradients)?variableGradients.map((function(item){return item.name})):Object.keys(variableGradients)).forEach((function(name,i){var value=engine_1.ENGINE.registeredVariables[name];if(null==_this.accumulations[i]){var trainable_1=!1;_this.accumulations[i]={originalName:name+"/momentum",variable:globals_1.tidy((function(){return ops_1.zerosLike(value).variable(!1)}))}}var accumulation=_this.accumulations[i].variable,gradient=Array.isArray(variableGradients)?variableGradients[i].tensor:variableGradients[name];null!=gradient&&globals_1.tidy((function(){var newValue,newAccumulation=_this.m.mul(accumulation).add(gradient);newValue=_this.useNesterov?_this.c.mul(gradient.add(newAccumulation.mul(_this.m))).add(value):_this.c.mul(newAccumulation).add(value),accumulation.assign(newAccumulation),value.assign(newValue)}))})),this.incrementIterations()},MomentumOptimizer.prototype.dispose=function(){this.m.dispose(),null!=this.accumulations&&globals_1.dispose(this.accumulations.map((function(v){return v.variable})))},MomentumOptimizer.prototype.setMomentum=function(momentum){this.momentum=momentum},MomentumOptimizer.prototype.getWeights=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(_a){switch(_a.label){case 0:return[4,this.saveIterations()];case 1:return[2,[_a.sent()].concat(this.accumulations.map((function(v){return{name:v.originalName,tensor:v.variable}})))]}}))}))},MomentumOptimizer.prototype.setWeights=function(weightValues){return __awaiter(this,void 0,void 0,(function(){var trainable;return __generator(this,(function(_a){switch(_a.label){case 0:return[4,this.extractIterations(weightValues)];case 1:return weightValues=_a.sent(),trainable=!1,this.accumulations=weightValues.map((function(v){return{originalName:v.name,variable:v.tensor.variable(!1)}})),[2]}}))}))},MomentumOptimizer.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},MomentumOptimizer.fromConfig=function(cls,config){return new cls(config.learningRate,config.momentum,config.useNesterov)},MomentumOptimizer.className="Momentum",MomentumOptimizer}(require("./sgd_optimizer").SGDOptimizer);exports.MomentumOptimizer=MomentumOptimizer,serialization_1.registerClass(MomentumOptimizer)},{"../engine":150,"../globals":153,"../ops/ops":203,"../serialization":239,"./sgd_optimizer":235}],232:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var __extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}),extendStatics,__awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P((function(resolve){resolve(result.value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},__generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}};Object.defineProperty(exports,"__esModule",{value:!0});var globals_1=require("../globals"),gradients_1=require("../gradients"),ops_1=require("../ops/ops"),serialization_1,Optimizer=function(_super){function Optimizer(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(Optimizer,_super),Optimizer.prototype.minimize=function(f,returnCost,varList){void 0===returnCost&&(returnCost=!1);var _a=this.computeGradients(f,varList),value=_a.value,grads=_a.grads;if(null!=varList){var gradArray=varList.map((function(v){return{name:v.name,tensor:grads[v.name]}}));this.applyGradients(gradArray)}else this.applyGradients(grads);return globals_1.dispose(grads),returnCost?value:(value.dispose(),null)},Object.defineProperty(Optimizer.prototype,"iterations",{get:function(){return null==this.iterations_&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),Optimizer.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},Optimizer.prototype.computeGradients=function(f,varList){return gradients_1.variableGrads(f,varList)},Optimizer.prototype.dispose=function(){null!=this.iterations_&&globals_1.dispose(this.iterations_)},Optimizer.prototype.saveIterations=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(_a){return null==this.iterations_&&(this.iterations_=0),[2,{name:"iter",tensor:ops_1.scalar(this.iterations_,"int32")}]}))}))},Optimizer.prototype.getWeights=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(_a){throw new Error("getWeights() is not implemented for this optimizer yet.")}))}))},Optimizer.prototype.setWeights=function(weightValues){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(_a){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())}))}))},Optimizer.prototype.extractIterations=function(weightValues){return __awaiter(this,void 0,void 0,(function(){var _a;return __generator(this,(function(_b){switch(_b.label){case 0:return _a=this,[4,weightValues[0].tensor.data()];case 1:return _a.iterations_=_b.sent()[0],[2,weightValues.slice(1)]}}))}))},Optimizer}(require("../serialization").Serializable);exports.Optimizer=Optimizer,Object.defineProperty(Optimizer,Symbol.hasInstance,{value:function(instance){return null!=instance.minimize&&null!=instance.computeGradients&&null!=instance.applyGradients}})},{"../globals":153,"../gradients":154,"../ops/ops":203,"../serialization":239}],233:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var adadelta_optimizer_1=require("./adadelta_optimizer"),adagrad_optimizer_1=require("./adagrad_optimizer"),adam_optimizer_1=require("./adam_optimizer"),adamax_optimizer_1=require("./adamax_optimizer"),momentum_optimizer_1=require("./momentum_optimizer"),rmsprop_optimizer_1=require("./rmsprop_optimizer"),sgd_optimizer_1=require("./sgd_optimizer"),OptimizerConstructors=function(){function OptimizerConstructors(){}return OptimizerConstructors.sgd=function(learningRate){return new sgd_optimizer_1.SGDOptimizer(learningRate)},OptimizerConstructors.momentum=function(learningRate,momentum,useNesterov){return void 0===useNesterov&&(useNesterov=!1),new momentum_optimizer_1.MomentumOptimizer(learningRate,momentum,useNesterov)},OptimizerConstructors.rmsprop=function(learningRate,decay,momentum,epsilon,centered){return void 0===decay&&(decay=.9),void 0===momentum&&(momentum=0),void 0===epsilon&&(epsilon=null),void 0===centered&&(centered=!1),new rmsprop_optimizer_1.RMSPropOptimizer(learningRate,decay,momentum,epsilon,centered)},OptimizerConstructors.adam=function(learningRate,beta1,beta2,epsilon){return void 0===learningRate&&(learningRate=.001),void 0===beta1&&(beta1=.9),void 0===beta2&&(beta2=.999),void 0===epsilon&&(epsilon=null),new adam_optimizer_1.AdamOptimizer(learningRate,beta1,beta2,epsilon)},OptimizerConstructors.adadelta=function(learningRate,rho,epsilon){return void 0===learningRate&&(learningRate=.001),void 0===rho&&(rho=.95),void 0===epsilon&&(epsilon=null),new adadelta_optimizer_1.AdadeltaOptimizer(learningRate,rho,epsilon)},OptimizerConstructors.adamax=function(learningRate,beta1,beta2,epsilon,decay){return void 0===learningRate&&(learningRate=.002),void 0===beta1&&(beta1=.9),void 0===beta2&&(beta2=.999),void 0===epsilon&&(epsilon=null),void 0===decay&&(decay=0),new adamax_optimizer_1.AdamaxOptimizer(learningRate,beta1,beta2,epsilon,decay)},OptimizerConstructors.adagrad=function(learningRate,initialAccumulatorValue){return void 0===initialAccumulatorValue&&(initialAccumulatorValue=.1),new adagrad_optimizer_1.AdagradOptimizer(learningRate,initialAccumulatorValue)},OptimizerConstructors}();exports.OptimizerConstructors=OptimizerConstructors},{"./adadelta_optimizer":227,"./adagrad_optimizer":228,"./adam_optimizer":229,"./adamax_optimizer":230,"./momentum_optimizer":231,"./rmsprop_optimizer":234,"./sgd_optimizer":235}],234:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var __extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}),extendStatics,__awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P((function(resolve){resolve(result.value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},__generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}};Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),globals_1=require("../globals"),ops_1=require("../ops/ops"),serialization_1=require("../serialization"),optimizer_1,RMSPropOptimizer=function(_super){function RMSPropOptimizer(learningRate,decay,momentum,epsilon,centered){void 0===decay&&(decay=.9),void 0===momentum&&(momentum=0),void 0===epsilon&&(epsilon=null),void 0===centered&&(centered=!1);var _this=_super.call(this)||this;return _this.learningRate=learningRate,_this.decay=decay,_this.momentum=momentum,_this.epsilon=epsilon,_this.accumulatedMeanSquares=[],_this.accumulatedMoments=[],_this.accumulatedMeanGrads=[],_this.centered=centered,null==epsilon&&(_this.epsilon=engine_1.ENGINE.backend.epsilon()),_this}return __extends(RMSPropOptimizer,_super),RMSPropOptimizer.prototype.applyGradients=function(variableGradients){var _this=this,variableNames;(Array.isArray(variableGradients)?variableGradients.map((function(item){return item.name})):Object.keys(variableGradients)).forEach((function(name,i){var value=engine_1.ENGINE.registeredVariables[name],trainable=!1;null==_this.accumulatedMeanSquares[i]&&(_this.accumulatedMeanSquares[i]={originalName:name+"/rms",variable:globals_1.tidy((function(){return ops_1.zerosLike(value).variable(!1)}))}),null==_this.accumulatedMoments[i]&&(_this.accumulatedMoments[i]={originalName:name+"/momentum",variable:globals_1.tidy((function(){return ops_1.zerosLike(value).variable(!1)}))}),null==_this.accumulatedMeanGrads[i]&&_this.centered&&(_this.accumulatedMeanGrads[i]={originalName:name+"/mg",variable:globals_1.tidy((function(){return ops_1.zerosLike(value).variable(!1)}))});var gradient=Array.isArray(variableGradients)?variableGradients[i].tensor:variableGradients[name];if(null!=gradient){var accumulatedMeanSquare=_this.accumulatedMeanSquares[i].variable,accumulatedMoments=_this.accumulatedMoments[i].variable;globals_1.tidy((function(){var newAccumulatedMeanSquare=accumulatedMeanSquare.mul(_this.decay).add(gradient.square().mul(1-_this.decay));if(_this.centered){var accumulatedMeanGrad=_this.accumulatedMeanGrads[i].variable,newAccumulatedMeanGrad=accumulatedMeanGrad.mul(_this.decay).add(gradient.mul(1-_this.decay)),newAccumulatedMoments=accumulatedMoments.mul(_this.momentum).add(gradient.mul(_this.learningRate).div(newAccumulatedMeanSquare.sub(newAccumulatedMeanGrad.square().add(_this.epsilon)).sqrt()));accumulatedMeanSquare.assign(newAccumulatedMeanSquare),accumulatedMeanGrad.assign(newAccumulatedMeanGrad),accumulatedMoments.assign(newAccumulatedMoments);var newValue=value.sub(newAccumulatedMoments);value.assign(newValue)}else{var newAccumulatedMeanSquare_1=accumulatedMeanSquare.mul(_this.decay).add(gradient.square().mul(1-_this.decay)),newAccumulatedMoments=accumulatedMoments.mul(_this.momentum).add(gradient.mul(_this.learningRate).div(newAccumulatedMeanSquare_1.add(_this.epsilon).sqrt()));accumulatedMeanSquare.assign(newAccumulatedMeanSquare_1),accumulatedMoments.assign(newAccumulatedMoments);var newValue=value.sub(newAccumulatedMoments);value.assign(newValue)}}))}})),this.incrementIterations()},RMSPropOptimizer.prototype.dispose=function(){null!=this.accumulatedMeanSquares&&globals_1.dispose(this.accumulatedMeanSquares.map((function(v){return v.variable}))),null!=this.accumulatedMeanGrads&&this.centered&&globals_1.dispose(this.accumulatedMeanGrads.map((function(v){return v.variable}))),null!=this.accumulatedMoments&&globals_1.dispose(this.accumulatedMoments.map((function(v){return v.variable})))},RMSPropOptimizer.prototype.getWeights=function(){return __awaiter(this,void 0,void 0,(function(){var variables;return __generator(this,(function(_a){switch(_a.label){case 0:return variables=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&variables.push.apply(variables,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[_a.sent()].concat(variables.map((function(v){return{name:v.originalName,tensor:v.variable}})))]}}))}))},RMSPropOptimizer.prototype.setWeights=function(weightValues){return __awaiter(this,void 0,void 0,(function(){var variableCount,trainable;return __generator(this,(function(_a){switch(_a.label){case 0:return[4,this.extractIterations(weightValues)];case 1:return weightValues=_a.sent(),variableCount=this.centered?weightValues.length/3:weightValues.length/2,trainable=!1,this.accumulatedMeanSquares=weightValues.slice(0,variableCount).map((function(v){return{originalName:v.name,variable:v.tensor.variable(!1)}})),this.accumulatedMoments=weightValues.slice(variableCount,2*variableCount).map((function(v){return{originalName:v.name,variable:v.tensor.variable(!1)}})),this.centered&&(this.accumulatedMeanGrads=weightValues.slice(2*variableCount,3*variableCount).map((function(v){return{originalName:v.name,variable:v.tensor.variable(!1)}}))),[2]}}))}))},RMSPropOptimizer.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},RMSPropOptimizer.fromConfig=function(cls,config){return new cls(config.learningRate,config.decay,config.momentum,config.epsilon,config.centered)},RMSPropOptimizer.className="RMSProp",RMSPropOptimizer}(require("./optimizer").Optimizer);exports.RMSPropOptimizer=RMSPropOptimizer,serialization_1.registerClass(RMSPropOptimizer)},{"../engine":150,"../globals":153,"../ops/ops":203,"../serialization":239,"./optimizer":232}],235:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var __extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}),extendStatics,__awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P((function(resolve){resolve(result.value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},__generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}};Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("../engine"),globals_1=require("../globals"),ops_1=require("../ops/ops"),serialization_1=require("../serialization"),optimizer_1,SGDOptimizer=function(_super){function SGDOptimizer(learningRate){var _this=_super.call(this)||this;return _this.learningRate=learningRate,_this.setLearningRate(learningRate),_this}return __extends(SGDOptimizer,_super),SGDOptimizer.prototype.applyGradients=function(variableGradients){var _this=this,varNames;(Array.isArray(variableGradients)?variableGradients.map((function(v){return v.name})):Object.keys(variableGradients)).forEach((function(name,i){var gradient=Array.isArray(variableGradients)?variableGradients[i].tensor:variableGradients[name];if(null!=gradient){var value=engine_1.ENGINE.registeredVariables[name];globals_1.tidy((function(){var newValue=_this.c.mul(gradient).add(value);value.assign(newValue)}))}})),this.incrementIterations()},SGDOptimizer.prototype.setLearningRate=function(learningRate){this.learningRate=learningRate,null!=this.c&&this.c.dispose(),this.c=globals_1.keep(ops_1.scalar(-learningRate))},SGDOptimizer.prototype.dispose=function(){this.c.dispose()},SGDOptimizer.prototype.getWeights=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(_a){switch(_a.label){case 0:return[4,this.saveIterations()];case 1:return[2,[_a.sent()]]}}))}))},SGDOptimizer.prototype.setWeights=function(weightValues){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(_a){switch(_a.label){case 0:return[4,this.extractIterations(weightValues)];case 1:if(0!==(weightValues=_a.sent()).length)throw new Error("SGD optimizer does not have settable weights.");return[2]}}))}))},SGDOptimizer.prototype.getConfig=function(){return{learningRate:this.learningRate}},SGDOptimizer.fromConfig=function(cls,config){return new cls(config.learningRate)},SGDOptimizer.className="SGD",SGDOptimizer}(require("./optimizer").Optimizer);exports.SGDOptimizer=SGDOptimizer,serialization_1.registerClass(SGDOptimizer)},{"../engine":150,"../globals":153,"../ops/ops":203,"../serialization":239,"./optimizer":232}],236:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
var environment_1=require("../environment"),PlatformBrowser=function(){function PlatformBrowser(){this.textEncoder=new TextEncoder}return PlatformBrowser.prototype.fetch=function(path,init){return fetch(path,init)},PlatformBrowser.prototype.now=function(){return performance.now()},PlatformBrowser.prototype.encode=function(text,encoding){if("utf-8"!==encoding&&"utf8"!==encoding)throw new Error("Browser's encoder only supports utf-8, but got "+encoding);return this.textEncoder.encode(text)},PlatformBrowser.prototype.decode=function(bytes,encoding){return new TextDecoder(encoding).decode(bytes)},PlatformBrowser}();exports.PlatformBrowser=PlatformBrowser,environment_1.ENV.get("IS_BROWSER")&&environment_1.ENV.setPlatform("browser",new PlatformBrowser)},{"../environment":151}],237:[function(require,module,exports){(function(process){(function(){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
var environment_1=require("../environment"),systemFetch;function resetSystemFetch(){systemFetch=null}function setSystemFetch(fetchFn){systemFetch=fetchFn}function getSystemFetch(){return systemFetch}exports.getNodeFetch={importFetch:function(){return require("node-fetch")}},exports.resetSystemFetch=resetSystemFetch,exports.setSystemFetch=setSystemFetch,exports.getSystemFetch=getSystemFetch;var PlatformNode=function(){function PlatformNode(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}return PlatformNode.prototype.fetch=function(path,requestInits){return null!=environment_1.ENV.global.fetch?environment_1.ENV.global.fetch(path,requestInits):(null==systemFetch&&(systemFetch=exports.getNodeFetch.importFetch()),systemFetch(path,requestInits))},PlatformNode.prototype.now=function(){var time=process.hrtime();return 1e3*time[0]+time[1]/1e6},PlatformNode.prototype.encode=function(text,encoding){if("utf-8"!==encoding&&"utf8"!==encoding)throw new Error("Node built-in encoder only supports utf-8, but got "+encoding);return this.textEncoder.encode(text)},PlatformNode.prototype.decode=function(bytes,encoding){return 0===bytes.length?"":new this.util.TextDecoder(encoding).decode(bytes)},PlatformNode}();exports.PlatformNode=PlatformNode,environment_1.ENV.get("IS_NODE")&&environment_1.ENV.setPlatform("node",new PlatformNode)}).call(this)}).call(this,require("_process"))},{"../environment":151,_process:422,"node-fetch":254,util:254}],238:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var util=require("./util"),Profiler=function(){function Profiler(backendTimer,logger){this.backendTimer=backendTimer,this.logger=logger,null==logger&&(this.logger=new Logger)}return Profiler.prototype.profileKernel=function(kernelName,inputs,f){var _this=this,result,holdResultWrapperFn=function(){result=f()},timer=this.backendTimer.time(holdResultWrapperFn),results;return(Array.isArray(result)?result:[result]).forEach((function(r){r.data().then((function(vals){checkComputationForErrors(vals,r.dtype,kernelName),timer.then((function(timing){var extraInfo="";null!=timing.getExtraProfileInfo&&(extraInfo=timing.getExtraProfileInfo()),_this.logger.logKernelProfile(kernelName,r,vals,timing.kernelMs,inputs,extraInfo)}))}))})),result},Profiler}();function checkComputationForErrors(vals,dtype,kernelName){if("float32"!==dtype)return!1;for(var i=0;i<vals.length;i++){var num=vals[i];if(isNaN(num)||!isFinite(num))return console.warn("Found "+num+" in the result of '"+kernelName+"'"),!0}return!1}exports.Profiler=Profiler,exports.checkComputationForErrors=checkComputationForErrors;var Logger=function(){function Logger(){}return Logger.prototype.logKernelProfile=function(name,result,vals,timeMs,inputs,extraInfo){var time=util.rightPad(timeMs+"ms",9),paddedName=util.rightPad(name,25),rank=result.rank,size=result.size,shape=util.rightPad(result.shape.toString(),14),inputShapesDescription="";for(var name_1 in inputs){var inputShape=inputs[name_1].shape,inputRank=inputShape.length;inputShapesDescription+=name_1+": "+inputRank+"D "+(inputRank>0?inputShape:"")+" "}console.log("%c"+paddedName+"\t%c"+time+"\t%c"+rank+"D "+shape+"\t%c"+size+"\t%c"+inputShapesDescription+"\t%c"+extraInfo,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},Logger}();exports.Logger=Logger},{"./util":248}],239:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var util_1=require("./util"),Serializable=function(){function Serializable(){}return Serializable.prototype.getClassName=function(){return this.constructor.className},Serializable.fromConfig=function(cls,config){return new cls(config)},Serializable}();exports.Serializable=Serializable;var SerializationMap=function(){function SerializationMap(){this.classNameMap={}}return SerializationMap.getMap=function(){return null==SerializationMap.instance&&(SerializationMap.instance=new SerializationMap),SerializationMap.instance},SerializationMap.register=function(cls){SerializationMap.getMap().classNameMap[cls.className]=[cls,cls.fromConfig]},SerializationMap}();function registerClass(cls){util_1.assert(null!=cls.className,(function(){return"Class being registered does not have the static className property defined."})),util_1.assert("string"==typeof cls.className,(function(){return"className is required to be a string, but got type "+typeof cls.className})),util_1.assert(cls.className.length>0,(function(){return"Class being registered has an empty-string as its className, which is disallowed."})),SerializationMap.register(cls)}exports.SerializationMap=SerializationMap,exports.registerClass=registerClass},{"./util":248}],240:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2017 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var tensor_1=require("./tensor"),util=require("./util");function getFilteredNodesXToY(tape,xs,y){for(var tensorsFromX={},nodesFromX={},i=0;i<xs.length;i++)tensorsFromX[xs[i].id]=!0;for(var i=0;i<tape.length;i++){var node,nodeInputs=(node=tape[i]).inputs;for(var inputName in nodeInputs){for(var input=nodeInputs[inputName],anyInputFromX=!1,j=0;j<xs.length;j++)if(tensorsFromX[input.id]){node.outputs.forEach((function(output){return tensorsFromX[output.id]=!0})),anyInputFromX=!0,nodesFromX[node.id]=!0;break}if(anyInputFromX)break}}var tensorsLeadToY={};tensorsLeadToY[y.id]=!0;for(var nodesToY={},i=tape.length-1;i>=0;i--)for(var node,nodeInputs=(node=tape[i]).inputs,j=0;j<node.outputs.length;j++)if(tensorsLeadToY[node.outputs[j].id]){for(var inputName in nodeInputs)tensorsLeadToY[nodeInputs[inputName].id]=!0,nodesToY[node.id]=!0;break}for(var filteredTape=[],i=0;i<tape.length;i++){var node;if(nodesFromX[(node=tape[i]).id]&&nodesToY[node.id]){var prunedInputs={};for(var inputName in node.inputs){var nodeInput=node.inputs[inputName];tensorsFromX[nodeInput.id]&&(prunedInputs[inputName]=nodeInput)}var prunedNode=Object.assign({},node);prunedNode.inputs=prunedInputs,prunedNode.outputs=node.outputs,filteredTape.push(prunedNode)}}return filteredTape}function backpropagateGradients(tensorAccumulatedGradientMap,filteredTape,tidy){for(var _loop_1=function(i){var node=filteredTape[i],dys=[];if(node.outputs.forEach((function(o){var gradTensor=tensorAccumulatedGradientMap[o.id];if(null!=gradTensor)dys.push(gradTensor);else{var dy=tensor_1.Tensor.make(o.shape,{values:util.makeZerosTypedArray(o.size,o.dtype)},o.dtype);dys.push(dy)}})),null==node.gradient)throw new Error("Cannot compute gradient: gradient function not found for "+node.name+".");var inputGradients=node.gradient(1===node.outputs.length?dys[0]:dys),_loop_2=function(inputName){if(!(inputName in inputGradients))throw new Error("Cannot backprop through input "+inputName+". Available gradients found: "+Object.keys(inputGradients)+".");var dx=tidy((function(){return inputGradients[inputName]()}));if("float32"!==dx.dtype)throw new Error("Error in gradient for op "+node.name+". The gradient of input "+inputName+" must have 'float32' dtype, but has '"+dx.dtype+"'");var x=node.inputs[inputName];if(!util.arraysEqual(dx.shape,x.shape))throw new Error("Error in gradient for op "+node.name+". The gradient of input '"+inputName+"' has shape '"+dx.shape+"', which does not match the shape of the input '"+x.shape+"'");if(null==tensorAccumulatedGradientMap[x.id])tensorAccumulatedGradientMap[x.id]=dx;else{var curGradient=tensorAccumulatedGradientMap[x.id];tensorAccumulatedGradientMap[x.id]=curGradient.add(dx),curGradient.dispose()}};for(var inputName in node.inputs)_loop_2(inputName)},i=filteredTape.length-1;i>=0;i--)_loop_1(i)}exports.getFilteredNodesXToY=getFilteredNodesXToY,exports.backpropagateGradients=backpropagateGradients},{"./tensor":241,"./util":248}],241:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2017 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var __extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}),extendStatics,__awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P((function(resolve){resolve(result.value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},__generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}};Object.defineProperty(exports,"__esModule",{value:!0});var tensor_format_1=require("./tensor_format"),util=require("./util"),util_1=require("./util"),TensorBuffer=function(){function TensorBuffer(shape,dtype,values){var _this=this;if(this.dtype=dtype,this.shape=shape.slice(),this.size=util.sizeFromShape(shape),null!=values){var n_1=values.length;util.assert(n_1===this.size,(function(){return"Length of values '"+n_1+"' does not match the size inferred by the shape '"+_this.size+"'."}))}if("complex64"===dtype)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=values||util.getArrayFromDType(dtype,this.size),this.strides=util_1.computeStrides(shape)}return TensorBuffer.prototype.set=function(value){for(var _this=this,locs=[],_i=1;_i<arguments.length;_i++)locs[_i-1]=arguments[_i];0===locs.length&&(locs=[0]),util.assert(locs.length===this.rank,(function(){return"The number of provided coordinates ("+locs.length+") must match the rank ("+_this.rank+")"}));var index=this.locToIndex(locs);this.values[index]=value},TensorBuffer.prototype.get=function(){for(var locs=[],_i=0;_i<arguments.length;_i++)locs[_i]=arguments[_i];0===locs.length&&(locs=[0]);for(var i=0,_a=0,locs_1=locs;_a<locs_1.length;_a++){var loc=locs_1[_a];if(loc<0||loc>=this.shape[i]){var msg="Requested out of range element at "+locs+".   Buffer shape="+this.shape;throw new Error(msg)}i++}for(var index=locs[locs.length-1],i_1=0;i_1<locs.length-1;++i_1)index+=this.strides[i_1]*locs[i_1];return this.values[index]},TensorBuffer.prototype.locToIndex=function(locs){if(0===this.rank)return 0;if(1===this.rank)return locs[0];for(var index=locs[locs.length-1],i=0;i<locs.length-1;++i)index+=this.strides[i]*locs[i];return index},TensorBuffer.prototype.indexToLoc=function(index){if(0===this.rank)return[];if(1===this.rank)return[index];for(var locs=new Array(this.shape.length),i=0;i<locs.length-1;++i)locs[i]=Math.floor(index/this.strides[i]),index-=locs[i]*this.strides[i];return locs[locs.length-1]=index,locs},Object.defineProperty(TensorBuffer.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),TensorBuffer.prototype.toTensor=function(){return Tensor.make(this.shape,{values:this.values},this.dtype)},TensorBuffer}();exports.TensorBuffer=TensorBuffer;var trackerFn=null,opHandler=null,deprecationWarningFn=null;function setTensorTracker(fn){trackerFn=fn}function setOpHandler(handler){opHandler=handler}function setDeprecationWarningFn(fn){deprecationWarningFn=fn}exports.setTensorTracker=setTensorTracker,exports.setOpHandler=setOpHandler,exports.setDeprecationWarningFn=setDeprecationWarningFn;var Tensor=function(){function Tensor(shape,dtype,values,dataId,backend){this.kept=!1,this.isDisposedInternal=!1,this.shape=shape.slice(),this.dtype=dtype||"float32",this.size=util.sizeFromShape(shape),this.strides=util_1.computeStrides(shape),this.dataId=null!=dataId?dataId:{},this.id=trackerFn().nextTensorId(),this.rankType=this.rank<5?this.rank.toString():"higher",trackerFn().registerTensor(this,backend),null!=values&&trackerFn().write(backend,this.dataId,values)}return Tensor.make=function(shape,data,dtype,backend){var backendVals=data.values;return null!=data.values&&"string"===dtype&&util.isString(data.values[0])&&(backendVals=data.values.map((function(d){return util.encodeString(d)}))),new Tensor(shape,dtype,backendVals,data.dataId,backend)},Tensor.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},Tensor.prototype.asScalar=function(){return this.throwIfDisposed(),util.assert(1===this.size,(function(){return"The array must have only 1 element."})),this.reshape([])},Tensor.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},Tensor.prototype.as2D=function(rows,columns){return this.throwIfDisposed(),this.reshape([rows,columns])},Tensor.prototype.as3D=function(rows,columns,depth){return this.throwIfDisposed(),this.reshape([rows,columns,depth])},Tensor.prototype.as4D=function(rows,columns,depth,depth2){return this.throwIfDisposed(),this.reshape([rows,columns,depth,depth2])},Tensor.prototype.as5D=function(rows,columns,depth,depth2,depth3){return this.throwIfDisposed(),this.reshape([rows,columns,depth,depth2,depth3])},Tensor.prototype.asType=function(dtype){return this.throwIfDisposed(),opHandler.cast(this,dtype)},Object.defineProperty(Tensor.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),Tensor.prototype.buffer=function(){return __awaiter(this,void 0,void 0,(function(){var vals;return __generator(this,(function(_a){switch(_a.label){case 0:return[4,this.data()];case 1:return vals=_a.sent(),[2,opHandler.buffer(this.shape,this.dtype,vals)]}}))}))},Tensor.prototype.bufferSync=function(){return opHandler.buffer(this.shape,this.dtype,this.dataSync())},Tensor.prototype.array=function(){return __awaiter(this,void 0,void 0,(function(){var vals;return __generator(this,(function(_a){switch(_a.label){case 0:return[4,this.data()];case 1:return vals=_a.sent(),[2,util_1.toNestedArray(this.shape,vals)]}}))}))},Tensor.prototype.arraySync=function(){return util_1.toNestedArray(this.shape,this.dataSync())},Tensor.prototype.data=function(){return __awaiter(this,void 0,void 0,(function(){var data,bytes;return __generator(this,(function(_a){switch(_a.label){case 0:return this.throwIfDisposed(),data=trackerFn().read(this.dataId),"string"!==this.dtype?[3,2]:[4,data];case 1:bytes=_a.sent();try{return[2,bytes.map((function(b){return util.decodeString(b)}))]}catch(_b){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}_a.label=2;case 2:return[2,data]}}))}))},Tensor.prototype.dataSync=function(){this.throwIfDisposed();var data=trackerFn().readSync(this.dataId);if("string"===this.dtype)try{return data.map((function(b){return util.decodeString(b)}))}catch(_a){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return data},Tensor.prototype.bytes=function(){return __awaiter(this,void 0,void 0,(function(){var data;return __generator(this,(function(_a){switch(_a.label){case 0:return this.throwIfDisposed(),[4,trackerFn().read(this.dataId)];case 1:return data=_a.sent(),"string"===this.dtype?[2,data]:[2,new Uint8Array(data.buffer)]}}))}))},Tensor.prototype.dispose=function(){this.isDisposed||(trackerFn().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(Tensor.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),Tensor.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},Tensor.prototype.toFloat=function(){return this.asType("float32")},Tensor.prototype.toInt=function(){return this.asType("int32")},Tensor.prototype.toBool=function(){return this.asType("bool")},Tensor.prototype.print=function(verbose){return void 0===verbose&&(verbose=!1),opHandler.print(this,verbose)},Tensor.prototype.reshape=function(newShape){return this.throwIfDisposed(),opHandler.reshape(this,newShape)},Tensor.prototype.reshapeAs=function(x){return this.throwIfDisposed(),this.reshape(x.shape)},Tensor.prototype.expandDims=function(axis){return void 0===axis&&(axis=0),opHandler.expandDims(this,axis)},Tensor.prototype.cumsum=function(axis,exclusive,reverse){return void 0===axis&&(axis=0),void 0===exclusive&&(exclusive=!1),void 0===reverse&&(reverse=!1),opHandler.cumsum(this,axis,exclusive,reverse)},Tensor.prototype.squeeze=function(axis){return this.throwIfDisposed(),opHandler.squeeze(this,axis)},Tensor.prototype.clone=function(){return this.throwIfDisposed(),opHandler.clone(this)},Tensor.prototype.oneHot=function(depth,onValue,offValue){return this.throwIfDisposed(),opHandler.oneHot(this,depth,onValue,offValue)},Tensor.prototype.toString=function(verbose){void 0===verbose&&(verbose=!1);var vals=this.dataSync();return tensor_format_1.tensorToString(vals,this.shape,this.dtype,verbose)},Tensor.prototype.tile=function(reps){return this.throwIfDisposed(),opHandler.tile(this,reps)},Tensor.prototype.gather=function(indices,axis){return void 0===axis&&(axis=0),this.throwIfDisposed(),opHandler.gather(this,indices,axis)},Tensor.prototype.matMul=function(b,transposeA,transposeB){return void 0===transposeA&&(transposeA=!1),void 0===transposeB&&(transposeB=!1),this.throwIfDisposed(),opHandler.matMul(this,b,transposeA,transposeB)},Tensor.prototype.dot=function(b){return this.throwIfDisposed(),opHandler.dot(this,b)},Tensor.prototype.norm=function(ord,axis,keepDims){return void 0===ord&&(ord="euclidean"),void 0===axis&&(axis=null),void 0===keepDims&&(keepDims=!1),this.throwIfDisposed(),opHandler.norm(this,ord,axis,keepDims)},Tensor.prototype.slice=function(begin,size){return this.throwIfDisposed(),opHandler.slice(this,begin,size)},Tensor.prototype.reverse=function(axis){return this.throwIfDisposed(),opHandler.reverse(this,axis)},Tensor.prototype.concat=function(x,axis){return void 0===axis&&(axis=0),this.throwIfDisposed(),x instanceof Tensor&&(x=[x]),opHandler.concat([this].concat(x),axis)},Tensor.prototype.split=function(numOrSizeSplits,axis){return void 0===axis&&(axis=0),this.throwIfDisposed(),opHandler.split(this,numOrSizeSplits,axis)},Tensor.prototype.stack=function(x,axis){return void 0===axis&&(axis=0),opHandler.stack([this,x],axis)},Tensor.prototype.unstack=function(axis){return void 0===axis&&(axis=0),opHandler.unstack(this,axis)},Tensor.prototype.pad=function(paddings,constantValue){return void 0===constantValue&&(constantValue=0),opHandler.pad(this,paddings,constantValue)},Tensor.prototype.batchNormalization=function(mean,variance,varianceEpsilon,scale,offset){return void 0===varianceEpsilon&&(varianceEpsilon=.001),deprecationWarningFn("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(mean,variance,offset,scale,varianceEpsilon)},Tensor.prototype.batchNorm=function(mean,variance,offset,scale,varianceEpsilon){return void 0===varianceEpsilon&&(varianceEpsilon=.001),this.throwIfDisposed(),opHandler.batchNorm(this,mean,variance,offset,scale,varianceEpsilon)},Tensor.prototype.all=function(axis,keepDims){return void 0===axis&&(axis=null),void 0===keepDims&&(keepDims=!1),this.throwIfDisposed(),opHandler.all(this,axis,keepDims)},Tensor.prototype.any=function(axis,keepDims){return void 0===axis&&(axis=null),void 0===keepDims&&(keepDims=!1),this.throwIfDisposed(),opHandler.any(this,axis,keepDims)},Tensor.prototype.logSumExp=function(axis,keepDims){return void 0===axis&&(axis=null),void 0===keepDims&&(keepDims=!1),this.throwIfDisposed(),opHandler.logSumExp(this,axis,keepDims)},Tensor.prototype.sum=function(axis,keepDims){return void 0===axis&&(axis=null),void 0===keepDims&&(keepDims=!1),this.throwIfDisposed(),opHandler.sum(this,axis,keepDims)},Tensor.prototype.prod=function(axis,keepDims){return void 0===axis&&(axis=null),void 0===keepDims&&(keepDims=!1),this.throwIfDisposed(),opHandler.prod(this,axis,keepDims)},Tensor.prototype.mean=function(axis,keepDims){return void 0===axis&&(axis=null),void 0===keepDims&&(keepDims=!1),this.throwIfDisposed(),opHandler.mean(this,axis,keepDims)},Tensor.prototype.min=function(axis,keepDims){return void 0===axis&&(axis=null),void 0===keepDims&&(keepDims=!1),this.throwIfDisposed(),opHandler.min(this,axis,keepDims)},Tensor.prototype.max=function(axis,keepDims){return void 0===axis&&(axis=null),void 0===keepDims&&(keepDims=!1),this.throwIfDisposed(),opHandler.max(this,axis,keepDims)},Tensor.prototype.argMin=function(axis){return void 0===axis&&(axis=null),this.throwIfDisposed(),opHandler.argMin(this,axis)},Tensor.prototype.argMax=function(axis){return void 0===axis&&(axis=null),this.throwIfDisposed(),opHandler.argMax(this,axis)},Tensor.prototype.cast=function(dtype){return this.throwIfDisposed(),opHandler.cast(this,dtype)},Tensor.prototype.add=function(x){return this.throwIfDisposed(),opHandler.add(this,x)},Tensor.prototype.addStrict=function(x){return this.throwIfDisposed(),opHandler.addStrict(this,x)},Tensor.prototype.atan2=function(x){return this.throwIfDisposed(),opHandler.atan2(this,x)},Tensor.prototype.sub=function(x){return this.throwIfDisposed(),opHandler.sub(this,x)},Tensor.prototype.subStrict=function(x){return this.throwIfDisposed(),opHandler.subStrict(this,x)},Tensor.prototype.pow=function(exp){return this.throwIfDisposed(),opHandler.pow(this,exp)},Tensor.prototype.powStrict=function(exp){return this.throwIfDisposed(),opHandler.powStrict(this,exp)},Tensor.prototype.mul=function(x){return this.throwIfDisposed(),opHandler.mul(this,x)},Tensor.prototype.mulStrict=function(x){return this.throwIfDisposed(),opHandler.mulStrict(this,x)},Tensor.prototype.div=function(x){return this.throwIfDisposed(),opHandler.div(this,x)},Tensor.prototype.floorDiv=function(x){return this.throwIfDisposed(),opHandler.floorDiv(this,x)},Tensor.prototype.divStrict=function(x){return this.throwIfDisposed(),opHandler.divStrict(this,x)},Tensor.prototype.minimum=function(x){return this.throwIfDisposed(),opHandler.minimum(this,x)},Tensor.prototype.minimumStrict=function(x){return this.throwIfDisposed(),opHandler.minimumStrict(this,x)},Tensor.prototype.maximum=function(x){return this.throwIfDisposed(),opHandler.maximum(this,x)},Tensor.prototype.maximumStrict=function(x){return this.throwIfDisposed(),opHandler.maximumStrict(this,x)},Tensor.prototype.mod=function(x){return this.throwIfDisposed(),opHandler.mod(this,x)},Tensor.prototype.modStrict=function(x){return this.throwIfDisposed(),opHandler.modStrict(this,x)},Tensor.prototype.squaredDifference=function(x){return this.throwIfDisposed(),opHandler.squaredDifference(this,x)},Tensor.prototype.squaredDifferenceStrict=function(x){return this.throwIfDisposed(),opHandler.squaredDifferenceStrict(this,x)},Tensor.prototype.transpose=function(perm){return this.throwIfDisposed(),opHandler.transpose(this,perm)},Tensor.prototype.notEqual=function(x){return this.throwIfDisposed(),opHandler.notEqual(this,x)},Tensor.prototype.notEqualStrict=function(x){return this.throwIfDisposed(),opHandler.notEqualStrict(this,x)},Tensor.prototype.less=function(x){return this.throwIfDisposed(),opHandler.less(this,x)},Tensor.prototype.lessStrict=function(x){return this.throwIfDisposed(),opHandler.lessStrict(this,x)},Tensor.prototype.equal=function(x){return this.throwIfDisposed(),opHandler.equal(this,x)},Tensor.prototype.equalStrict=function(x){return this.throwIfDisposed(),opHandler.equalStrict(this,x)},Tensor.prototype.lessEqual=function(x){return this.throwIfDisposed(),opHandler.lessEqual(this,x)},Tensor.prototype.lessEqualStrict=function(x){return this.throwIfDisposed(),opHandler.lessEqualStrict(this,x)},Tensor.prototype.greater=function(x){return this.throwIfDisposed(),opHandler.greater(this,x)},Tensor.prototype.greaterStrict=function(x){return this.throwIfDisposed(),opHandler.greaterStrict(this,x)},Tensor.prototype.greaterEqual=function(x){return this.throwIfDisposed(),opHandler.greaterEqual(this,x)},Tensor.prototype.greaterEqualStrict=function(x){return this.throwIfDisposed(),opHandler.greaterEqualStrict(this,x)},Tensor.prototype.logicalAnd=function(x){return this.throwIfDisposed(),opHandler.logicalAnd(this,x)},Tensor.prototype.logicalOr=function(x){return this.throwIfDisposed(),opHandler.logicalOr(this,x)},Tensor.prototype.logicalNot=function(){return this.throwIfDisposed(),opHandler.logicalNot(this)},Tensor.prototype.logicalXor=function(x){return this.throwIfDisposed(),opHandler.logicalXor(this,x)},Tensor.prototype.where=function(condition,x){return this.throwIfDisposed(),opHandler.where(condition,this,x)},Tensor.prototype.neg=function(){return this.throwIfDisposed(),opHandler.neg(this)},Tensor.prototype.ceil=function(){return this.throwIfDisposed(),opHandler.ceil(this)},Tensor.prototype.floor=function(){return this.throwIfDisposed(),opHandler.floor(this)},Tensor.prototype.sign=function(){return this.throwIfDisposed(),opHandler.sign(this)},Tensor.prototype.isNaN=function(){return this.throwIfDisposed(),opHandler.isNaN(this)},Tensor.prototype.isInf=function(){return this.throwIfDisposed(),opHandler.isInf(this)},Tensor.prototype.isFinite=function(){return this.throwIfDisposed(),opHandler.isFinite(this)},Tensor.prototype.exp=function(){return this.throwIfDisposed(),opHandler.exp(this)},Tensor.prototype.expm1=function(){return this.throwIfDisposed(),opHandler.expm1(this)},Tensor.prototype.log=function(){return this.throwIfDisposed(),opHandler.log(this)},Tensor.prototype.log1p=function(){return this.throwIfDisposed(),opHandler.log1p(this)},Tensor.prototype.sqrt=function(){return this.throwIfDisposed(),opHandler.sqrt(this)},Tensor.prototype.rsqrt=function(){return this.throwIfDisposed(),opHandler.rsqrt(this)},Tensor.prototype.square=function(){return this.throwIfDisposed(),opHandler.square(this)},Tensor.prototype.reciprocal=function(){return this.throwIfDisposed(),opHandler.reciprocal(this)},Tensor.prototype.abs=function(){return this.throwIfDisposed(),opHandler.abs(this)},Tensor.prototype.clipByValue=function(min,max){return this.throwIfDisposed(),opHandler.clipByValue(this,min,max)},Tensor.prototype.relu=function(){return this.throwIfDisposed(),opHandler.relu(this)},Tensor.prototype.elu=function(){return this.throwIfDisposed(),opHandler.elu(this)},Tensor.prototype.selu=function(){return this.throwIfDisposed(),opHandler.selu(this)},Tensor.prototype.leakyRelu=function(alpha){return void 0===alpha&&(alpha=.2),this.throwIfDisposed(),opHandler.leakyRelu(this,alpha)},Tensor.prototype.prelu=function(alpha){return this.throwIfDisposed(),opHandler.prelu(this,alpha)},Tensor.prototype.sigmoid=function(){return this.throwIfDisposed(),opHandler.sigmoid(this)},Tensor.prototype.logSigmoid=function(){return this.throwIfDisposed(),opHandler.logSigmoid(this)},Tensor.prototype.softplus=function(){return this.throwIfDisposed(),opHandler.softplus(this)},Tensor.prototype.zerosLike=function(){return this.throwIfDisposed(),opHandler.zerosLike(this)},Tensor.prototype.onesLike=function(){return this.throwIfDisposed(),opHandler.onesLike(this)},Tensor.prototype.sin=function(){return this.throwIfDisposed(),opHandler.sin(this)},Tensor.prototype.cos=function(){return this.throwIfDisposed(),opHandler.cos(this)},Tensor.prototype.tan=function(){return this.throwIfDisposed(),opHandler.tan(this)},Tensor.prototype.asin=function(){return this.throwIfDisposed(),opHandler.asin(this)},Tensor.prototype.acos=function(){return this.throwIfDisposed(),opHandler.acos(this)},Tensor.prototype.atan=function(){return this.throwIfDisposed(),opHandler.atan(this)},Tensor.prototype.sinh=function(){return this.throwIfDisposed(),opHandler.sinh(this)},Tensor.prototype.cosh=function(){return this.throwIfDisposed(),opHandler.cosh(this)},Tensor.prototype.tanh=function(){return this.throwIfDisposed(),opHandler.tanh(this)},Tensor.prototype.asinh=function(){return this.throwIfDisposed(),opHandler.asinh(this)},Tensor.prototype.acosh=function(){return this.throwIfDisposed(),opHandler.acosh(this)},Tensor.prototype.atanh=function(){return this.throwIfDisposed(),opHandler.atanh(this)},Tensor.prototype.erf=function(){return this.throwIfDisposed(),opHandler.erf(this)},Tensor.prototype.round=function(){return this.throwIfDisposed(),opHandler.round(this)},Tensor.prototype.step=function(alpha){return void 0===alpha&&(alpha=0),this.throwIfDisposed(),opHandler.step(this,alpha)},Tensor.prototype.softmax=function(dim){return void 0===dim&&(dim=-1),this.throwIfDisposed(),opHandler.softmax(this,dim)},Tensor.prototype.logSoftmax=function(axis){return void 0===axis&&(axis=-1),this.throwIfDisposed(),opHandler.logSoftmax(this,axis)},Tensor.prototype.resizeBilinear=function(newShape2D,alignCorners){return void 0===alignCorners&&(alignCorners=!1),this.throwIfDisposed(),opHandler.image.resizeBilinear(this,newShape2D,alignCorners)},Tensor.prototype.resizeNearestNeighbor=function(newShape2D,alignCorners){return void 0===alignCorners&&(alignCorners=!1),this.throwIfDisposed(),opHandler.image.resizeNearestNeighbor(this,newShape2D,alignCorners)},Tensor.prototype.conv1d=function(filter,stride,pad,dataFormat,dilation,dimRoundingMode){return void 0===dataFormat&&(dataFormat="NWC"),void 0===dilation&&(dilation=1),this.throwIfDisposed(),opHandler.conv1d(this,filter,stride,pad,dataFormat,dilation,dimRoundingMode)},Tensor.prototype.conv2d=function(filter,strides,pad,dataFormat,dilations,dimRoundingMode){return void 0===dataFormat&&(dataFormat="NHWC"),void 0===dilations&&(dilations=[1,1]),this.throwIfDisposed(),opHandler.conv2d(this,filter,strides,pad,dataFormat,dilations,dimRoundingMode)},Tensor.prototype.conv2dTranspose=function(filter,outputShape,strides,pad,dimRoundingMode){return this.throwIfDisposed(),opHandler.conv2dTranspose(this,filter,outputShape,strides,pad,dimRoundingMode)},Tensor.prototype.depthwiseConv2D=function(filter,strides,pad,dataFormat,dilations,dimRoundingMode){return void 0===dataFormat&&(dataFormat="NHWC"),void 0===dilations&&(dilations=[1,1]),this.throwIfDisposed(),opHandler.depthwiseConv2d(this,filter,strides,pad,dataFormat,dilations,dimRoundingMode)},Tensor.prototype.separableConv2d=function(depthwiseFilter,pointwiseFilter,strides,pad,dilation,dataFormat){return void 0===dilation&&(dilation=[1,1]),void 0===dataFormat&&(dataFormat="NHWC"),this.throwIfDisposed(),opHandler.separableConv2d(this,depthwiseFilter,pointwiseFilter,strides,pad,dilation,dataFormat)},Tensor.prototype.avgPool=function(filterSize,strides,pad,dimRoundingMode){return this.throwIfDisposed(),opHandler.avgPool(this,filterSize,strides,pad,dimRoundingMode)},Tensor.prototype.maxPool=function(filterSize,strides,pad,dimRoundingMode){return this.throwIfDisposed(),opHandler.maxPool(this,filterSize,strides,pad,dimRoundingMode)},Tensor.prototype.localResponseNormalization=function(radius,bias,alpha,beta){return void 0===radius&&(radius=5),void 0===bias&&(bias=1),void 0===alpha&&(alpha=1),void 0===beta&&(beta=.5),opHandler.localResponseNormalization(this,radius,bias,alpha,beta)},Tensor.prototype.pool=function(windowShape,poolingType,padding,dilationRate,strides){return this.throwIfDisposed(),opHandler.pool(this,windowShape,poolingType,padding,dilationRate,strides)},Tensor.prototype.variable=function(trainable,name,dtype){return void 0===trainable&&(trainable=!0),this.throwIfDisposed(),Variable.variable(this,trainable,name,dtype)},Tensor.prototype.unsortedSegmentSum=function(segmentIds,numSegments){return this.throwIfDisposed(),opHandler.unsortedSegmentSum(this,segmentIds,numSegments)},Tensor.prototype.batchToSpaceND=function(blockShape,crops){return this.throwIfDisposed(),opHandler.batchToSpaceND(this,blockShape,crops)},Tensor.prototype.spaceToBatchND=function(blockShape,paddings){return this.throwIfDisposed(),opHandler.spaceToBatchND(this,blockShape,paddings)},Tensor.prototype.topk=function(k,sorted){return void 0===k&&(k=1),void 0===sorted&&(sorted=!0),this.throwIfDisposed(),opHandler.topk(this,k,sorted)},Tensor.prototype.stridedSlice=function(begin,end,strides,beginMask,endMask,ellipsisMask,newAxisMask,shrinkAxisMask){return void 0===beginMask&&(beginMask=0),void 0===endMask&&(endMask=0),void 0===ellipsisMask&&(ellipsisMask=0),void 0===newAxisMask&&(newAxisMask=0),void 0===shrinkAxisMask&&(shrinkAxisMask=0),this.throwIfDisposed(),opHandler.stridedSlice(this,begin,end,strides,beginMask,endMask,ellipsisMask,newAxisMask,shrinkAxisMask)},Tensor.prototype.depthToSpace=function(blockSize,dataFormat){return this.throwIfDisposed(),opHandler.depthToSpace(this,blockSize,dataFormat)},Tensor.prototype.fft=function(){return this.throwIfDisposed(),opHandler.spectral.fft(this)},Tensor.prototype.ifft=function(){return this.throwIfDisposed(),opHandler.spectral.ifft(this)},Tensor.prototype.rfft=function(){return this.throwIfDisposed(),opHandler.spectral.rfft(this)},Tensor.prototype.irfft=function(){return this.throwIfDisposed(),opHandler.spectral.irfft(this)},Tensor}();exports.Tensor=Tensor,Object.defineProperty(Tensor,Symbol.hasInstance,{value:function(instance){return!!instance&&null!=instance.dataId&&null!=instance.shape&&null!=instance.dtype}});var Variable=function(_super){function Variable(initialValue,trainable,name){void 0===trainable&&(trainable=!0);var _this=_super.call(this,initialValue.shape,initialValue.dtype,null,initialValue.dataId)||this;_this.trainable=trainable,_this.name=name,null==_this.name&&(_this.name=trackerFn().nextVariableId().toString());try{trackerFn().registerVariable(_this)}catch(ex){throw trackerFn().disposeTensor(_this),ex}return _this}return __extends(Variable,_super),Variable.variable=function(initialValue,trainable,name,dtype){return void 0===trainable&&(trainable=!0),null!=dtype&&dtype!==initialValue.dtype&&(initialValue=initialValue.asType(dtype)),new Variable(initialValue,trainable,name)},Variable.prototype.assign=function(newValue){if(newValue.dtype!==this.dtype)throw new Error("dtype of the new value ("+newValue.dtype+") and previous value ("+this.dtype+") must match");if(!util.arraysEqual(newValue.shape,this.shape))throw new Error("shape of the new value ("+newValue.shape+") and previous value ("+this.shape+") must match");trackerFn().disposeTensor(this),this.dataId=newValue.dataId,trackerFn().registerTensor(this)},Variable.prototype.dispose=function(){trackerFn().disposeVariable(this),this.isDisposedInternal=!0},Variable}(Tensor);exports.Variable=Variable,Object.defineProperty(Variable,Symbol.hasInstance,{value:function(instance){return instance instanceof Tensor&&null!=instance.assign&&instance.assign instanceof Function}});var variable=Variable.variable;exports.variable=variable},{"./tensor_format":242,"./util":248}],242:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var util_1=require("./util"),FORMAT_LIMIT_NUM_VALS=20,FORMAT_NUM_FIRST_LAST_VALS=3,FORMAT_NUM_SIG_DIGITS=7;function tensorToString(vals,shape,dtype,verbose){var strides=util_1.computeStrides(shape),padPerCol=computeMaxSizePerColumn(vals,shape,dtype,strides),rank=shape.length,valsLines=subTensorToString(vals,shape,dtype,strides,padPerCol),lines=["Tensor"];return verbose&&(lines.push("  dtype: "+dtype),lines.push("  rank: "+rank),lines.push("  shape: ["+shape+"]"),lines.push("  values:")),lines.push(valsLines.map((function(l){return"    "+l})).join("\n")),lines.join("\n")}function computeMaxSizePerColumn(vals,shape,dtype,strides){var n=util_1.sizeFromShape(shape),numCols=strides[strides.length-1],padPerCol=new Array(numCols).fill(0),rank=shape.length,valuesOrTuples="complex64"===dtype?createComplexTuples(vals):vals;if(rank>1)for(var row=0;row<n/numCols;row++)for(var offset=row*numCols,j=0;j<numCols;j++)padPerCol[j]=Math.max(padPerCol[j],valToString(valuesOrTuples[offset+j],0,dtype).length);return padPerCol}function valToString(val,pad,dtype){var valStr;return valStr=Array.isArray(val)?parseFloat(val[0].toFixed(7))+" + "+parseFloat(val[1].toFixed(7))+"j":util_1.isString(val)?"'"+val+"'":"bool"===dtype?boolNumToString(val):parseFloat(val.toFixed(7)).toString(),util_1.rightPad(valStr,pad)}function boolNumToString(v){return 0===v?"false":"true"}function subTensorToString(vals,shape,dtype,strides,padPerCol,isLast){void 0===isLast&&(isLast=!0);var storagePerElement="complex64"===dtype?2:1,size=shape[0],rank=shape.length,complexTuple;if(0===rank)return"complex64"===dtype?[valToString(createComplexTuples(vals)[0],0,dtype)]:"bool"===dtype?[boolNumToString(vals[0])]:[vals[0].toString()];if(1===rank){if(size>20){var firstValsSize=3*storagePerElement,firstVals=Array.from(vals.slice(0,firstValsSize)),lastVals=Array.from(vals.slice(size-3*storagePerElement,size));return"complex64"===dtype&&(firstVals=createComplexTuples(firstVals),lastVals=createComplexTuples(lastVals)),["["+firstVals.map((function(x,i){return valToString(x,padPerCol[i],dtype)})).join(", ")+", ..., "+lastVals.map((function(x,i){return valToString(x,padPerCol[size-3+i],dtype)})).join(", ")+"]"]}var displayVals;return["["+("complex64"===dtype?createComplexTuples(vals):Array.from(vals)).map((function(x,i){return valToString(x,padPerCol[i],dtype)})).join(", ")+"]"]}var subshape=shape.slice(1),substrides=strides.slice(1),stride=strides[0]*storagePerElement,lines=[];if(size>20){for(var i=0;i<3;i++){var start,end=(start=i*stride)+stride;lines.push.apply(lines,subTensorToString(vals.slice(start,end),subshape,dtype,substrides,padPerCol,!1))}lines.push("...");for(var i=size-3;i<size;i++){var start,end=(start=i*stride)+stride;lines.push.apply(lines,subTensorToString(vals.slice(start,end),subshape,dtype,substrides,padPerCol,i===size-1))}}else for(var i=0;i<size;i++){var start,end=(start=i*stride)+stride;lines.push.apply(lines,subTensorToString(vals.slice(start,end),subshape,dtype,substrides,padPerCol,i===size-1))}var sep=2===rank?",":"";lines[0]="["+lines[0]+sep;for(var i=1;i<lines.length-1;i++)lines[i]=" "+lines[i]+sep;for(var newLineSep=",\n",i=2;i<rank;i++)newLineSep+="\n";return lines[lines.length-1]=" "+lines[lines.length-1]+"]"+(isLast?"":newLineSep),lines}function createComplexTuples(vals){for(var complexTuples=[],i=0;i<vals.length;i+=2)complexTuples.push([vals[i],vals[i+1]]);return complexTuples}exports.tensorToString=tensorToString},{"./util":248}],243:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var tensor_1=require("./tensor"),types_1=require("./types"),util_1=require("./util");function makeTypesMatch(a,b){if(a.dtype===b.dtype)return[a,b];var dtype=types_1.upcastType(a.dtype,b.dtype);return[a.cast(dtype),b.cast(dtype)]}function assertTypesMatch(a,b){util_1.assert(a.dtype===b.dtype,(function(){return"The dtypes of the first("+a.dtype+") and second("+b.dtype+") input must match"}))}function isTensorInList(tensor,tensorList){for(var i=0;i<tensorList.length;i++)if(tensorList[i].id===tensor.id)return!0;return!1}function getTensorsInContainer(result){var list=[],seen;return walkTensorContainer(result,list,new Set),list}function walkTensorContainer(container,list,seen){if(null!=container)if(container instanceof tensor_1.Tensor)list.push(container);else if(isIterable(container)){var iterable=container;for(var k in iterable){var val=iterable[k];seen.has(val)||(seen.add(val),walkTensorContainer(val,list,seen))}}}function isIterable(obj){return Array.isArray(obj)||"object"==typeof obj}exports.makeTypesMatch=makeTypesMatch,exports.assertTypesMatch=assertTypesMatch,exports.isTensorInList=isTensorInList,exports.getTensorsInContainer=getTensorsInContainer},{"./tensor":241,"./types":247,"./util":248}],244:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("./environment"),tensor_1=require("./tensor"),util_1=require("./util");function inferShape(val,dtype){var firstElem=val;if(util_1.isTypedArray(val))return"string"===dtype?[]:[val.length];if(!Array.isArray(val))return[];for(var shape=[];Array.isArray(firstElem)||util_1.isTypedArray(firstElem)&&"string"!==dtype;)shape.push(firstElem.length),firstElem=firstElem[0];return Array.isArray(val)&&environment_1.ENV.getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&deepAssertShapeConsistency(val,shape,[]),shape}function deepAssertShapeConsistency(val,shape,indices){if(indices=indices||[],Array.isArray(val)||util_1.isTypedArray(val)){util_1.assert(shape.length>0,(function(){return"Element arr["+indices.join("][")+"] should be a primitive, but is an array of "+val.length+" elements"})),util_1.assert(val.length===shape[0],(function(){return"Element arr["+indices.join("][")+"] should have "+shape[0]+" elements, but has "+val.length+" elements"}));for(var subShape=shape.slice(1),i=0;i<val.length;++i)deepAssertShapeConsistency(val[i],subShape,indices.concat(i))}else util_1.assert(0===shape.length,(function(){return"Element arr["+indices.join("][")+"] is a primitive, but should be an array/TypedArray of "+shape[0]+" elements"}))}function assertDtype(expectedDtype,actualDType,argName,functionName){if(null!=expectedDtype&&("numeric"!==expectedDtype&&expectedDtype!==actualDType||"numeric"===expectedDtype&&"string"===actualDType))throw new Error("Argument '"+argName+"' passed to '"+functionName+"' must be "+expectedDtype+" tensor, but got "+actualDType+" tensor")}function convertToTensor(x,argName,functionName,parseAsDtype){if(void 0===parseAsDtype&&(parseAsDtype="numeric"),x instanceof tensor_1.Tensor)return assertDtype(parseAsDtype,x.dtype,argName,functionName),x;var inferredDtype=util_1.inferDtype(x);if("string"!==inferredDtype&&["bool","int32","float32"].indexOf(parseAsDtype)>=0&&(inferredDtype=parseAsDtype),assertDtype(parseAsDtype,inferredDtype,argName,functionName),null==x||!util_1.isTypedArray(x)&&!Array.isArray(x)&&"number"!=typeof x&&"boolean"!=typeof x&&"string"!=typeof x){var type=null==x?"null":x.constructor.name;throw new Error("Argument '"+argName+"' passed to '"+functionName+"' must be a Tensor or TensorLike, but got '"+type+"'")}var inferredShape=inferShape(x,inferredDtype);util_1.isTypedArray(x)||Array.isArray(x)||(x=[x]);var skipTypedArray=!0,values="string"!==inferredDtype?util_1.toTypedArray(x,inferredDtype,environment_1.ENV.getBool("DEBUG")):util_1.flatten(x,[],!0);return tensor_1.Tensor.make(inferredShape,{values:values},inferredDtype)}function convertToTensorArray(arg,argName,functionName,parseAsDtype){if(void 0===parseAsDtype&&(parseAsDtype="numeric"),!Array.isArray(arg))throw new Error("Argument "+argName+" passed to "+functionName+" must be a `Tensor[]` or `TensorLike[]`");var tensors;return arg.map((function(t,i){return convertToTensor(t,argName+"["+i+"]",functionName)}),parseAsDtype)}exports.inferShape=inferShape,exports.convertToTensor=convertToTensor,exports.convertToTensorArray=convertToTensorArray},{"./environment":151,"./tensor":241,"./util":248}],245:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2017 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var engine_1=require("./engine"),tensor_util_env_1=require("./tensor_util_env"),util_1=require("./util"),TEST_EPSILON_FLOAT32=.001;function expectArraysClose(actual,expected,epsilon){return null==epsilon&&(epsilon=testEpsilon()),expectArraysPredicate(actual,expected,(function(a,b){return areClose(a,b,epsilon)}))}function testEpsilon(){return 32===engine_1.ENGINE.backend.floatPrecision()?.001:exports.TEST_EPSILON_FLOAT16}function expectArraysPredicate(actual,expected,predicate){var checkClassType=!0;if((util_1.isTypedArray(actual)||util_1.isTypedArray(expected))&&(checkClassType=!1),util_1.isTypedArray(actual)&&util_1.isTypedArray(expected)&&(checkClassType=!0),checkClassType){var aType=actual.constructor.name,bType=expected.constructor.name;if(aType!==bType)throw new Error("Arrays are of different type. Actual: "+aType+". Expected: "+bType)}if(Array.isArray(actual)&&Array.isArray(expected)){var actualShape=tensor_util_env_1.inferShape(actual),expectedShape=tensor_util_env_1.inferShape(expected);if(!util_1.arraysEqual(actualShape,expectedShape))throw new Error("Arrays have different shapes. Actual: ["+actualShape+"]. Expected: ["+expectedShape+"]")}var actualFlat=util_1.isTypedArray(actual)?actual:util_1.flatten(actual),expectedFlat=util_1.isTypedArray(expected)?expected:util_1.flatten(expected);if(actualFlat.length!==expectedFlat.length)throw new Error("Arrays have different lengths actual: "+actualFlat.length+" vs expected: "+expectedFlat.length+".\nActual:   "+actualFlat+".\nExpected: "+expectedFlat+".");for(var i=0;i<expectedFlat.length;++i){var a=actualFlat[i],e=expectedFlat[i];if(!predicate(a,e))throw new Error("Arrays differ: actual["+i+"] = "+a+", expected["+i+"] = "+e+".\nActual:   "+actualFlat+".\nExpected: "+expectedFlat+".")}}function expectPromiseToFail(fn,done){fn().then((function(){return done.fail()}),(function(){return done()}))}function expectArraysEqual(actual,expected){var exp="string"==typeof expected||"number"==typeof expected||"boolean"==typeof expected?[expected]:expected;return util_1.isString(actual)||util_1.isString(actual[0])||util_1.isString(expected)||util_1.isString(expected[0])?expectArraysPredicate(actual,exp,(function(a,b){return a==b})):expectArraysPredicate(actual,expected,(function(a,b){return areClose(a,b,0)}))}function expectNumbersClose(a,e,epsilon){if(null==epsilon&&(epsilon=testEpsilon()),!areClose(a,e,epsilon))throw new Error("Numbers differ: actual === "+a+", expected === "+e)}function areClose(a,e,epsilon){return!isFinite(a)&&!isFinite(e)||!(isNaN(a)||isNaN(e)||Math.abs(a-e)>epsilon)}function expectValuesInRange(actual,low,high){for(var i=0;i<actual.length;i++)if(actual[i]<low||actual[i]>high)throw new Error("Value out of range:"+actual[i]+" low: "+low+", high: "+high)}function expectArrayBuffersEqual(actual,expected){expect(new Float32Array(actual)).toEqual(new Float32Array(expected))}exports.TEST_EPSILON_FLOAT16=.1,exports.expectArraysClose=expectArraysClose,exports.testEpsilon=testEpsilon,exports.expectPromiseToFail=expectPromiseToFail,exports.expectArraysEqual=expectArraysEqual,exports.expectNumbersClose=expectNumbersClose,exports.expectValuesInRange=expectValuesInRange,exports.expectArrayBuffersEqual=expectArrayBuffersEqual},{"./engine":150,"./tensor_util_env":244,"./util":248}],246:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2018 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var adadelta_optimizer_1=require("./optimizers/adadelta_optimizer"),adagrad_optimizer_1=require("./optimizers/adagrad_optimizer"),adam_optimizer_1=require("./optimizers/adam_optimizer"),adamax_optimizer_1=require("./optimizers/adamax_optimizer"),momentum_optimizer_1=require("./optimizers/momentum_optimizer"),optimizer_constructors_1=require("./optimizers/optimizer_constructors"),rmsprop_optimizer_1=require("./optimizers/rmsprop_optimizer"),sgd_optimizer_1=require("./optimizers/sgd_optimizer");momentum_optimizer_1.MomentumOptimizer,sgd_optimizer_1.SGDOptimizer,adadelta_optimizer_1.AdadeltaOptimizer,adagrad_optimizer_1.AdagradOptimizer,rmsprop_optimizer_1.RMSPropOptimizer,adamax_optimizer_1.AdamaxOptimizer,adam_optimizer_1.AdamOptimizer,exports.train={sgd:optimizer_constructors_1.OptimizerConstructors.sgd,momentum:optimizer_constructors_1.OptimizerConstructors.momentum,adadelta:optimizer_constructors_1.OptimizerConstructors.adadelta,adagrad:optimizer_constructors_1.OptimizerConstructors.adagrad,rmsprop:optimizer_constructors_1.OptimizerConstructors.rmsprop,adamax:optimizer_constructors_1.OptimizerConstructors.adamax,adam:optimizer_constructors_1.OptimizerConstructors.adam}},{"./optimizers/adadelta_optimizer":227,"./optimizers/adagrad_optimizer":228,"./optimizers/adam_optimizer":229,"./optimizers/adamax_optimizer":230,"./optimizers/momentum_optimizer":231,"./optimizers/optimizer_constructors":233,"./optimizers/rmsprop_optimizer":234,"./optimizers/sgd_optimizer":235}],247:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2017 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Rank,UpcastInt32AndMap,UpcastBoolAndMap,UpcastFloat32AndMap,UpcastComplex64AndMap;Object.defineProperty(exports,"__esModule",{value:!0}),function(Rank){Rank.R0="R0",Rank.R1="R1",Rank.R2="R2",Rank.R3="R3",Rank.R4="R4",Rank.R5="R5",Rank.R6="R6"}(Rank=exports.Rank||(exports.Rank={})),function(UpcastInt32AndMap){UpcastInt32AndMap.float32="float32",UpcastInt32AndMap.int32="int32",UpcastInt32AndMap.bool="int32",UpcastInt32AndMap.complex64="complex64"}(UpcastInt32AndMap||(UpcastInt32AndMap={})),function(UpcastBoolAndMap){UpcastBoolAndMap.float32="float32",UpcastBoolAndMap.int32="int32",UpcastBoolAndMap.bool="bool",UpcastBoolAndMap.complex64="complex64"}(UpcastBoolAndMap||(UpcastBoolAndMap={})),function(UpcastFloat32AndMap){UpcastFloat32AndMap.float32="float32",UpcastFloat32AndMap.int32="float32",UpcastFloat32AndMap.bool="float32",UpcastFloat32AndMap.complex64="complex64"}(UpcastFloat32AndMap||(UpcastFloat32AndMap={})),function(UpcastComplex64AndMap){UpcastComplex64AndMap.float32="complex64",UpcastComplex64AndMap.int32="complex64",UpcastComplex64AndMap.bool="complex64",UpcastComplex64AndMap.complex64="complex64"}(UpcastComplex64AndMap||(UpcastComplex64AndMap={}));var upcastTypeMap={float32:UpcastFloat32AndMap,int32:UpcastInt32AndMap,bool:UpcastBoolAndMap,complex64:UpcastComplex64AndMap};function upcastType(typeA,typeB){if("string"===typeA||"string"===typeB){if("string"===typeA&&"string"===typeB)return"string";throw new Error("Can not upcast "+typeA+" with "+typeB)}return upcastTypeMap[typeA][typeB]}function sumOutType(type){return upcastType(type,"int32")}exports.upcastType=upcastType,exports.sumOutType=sumOutType},{}],248:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2017 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("./environment");function shuffle(array){for(var counter=array.length,temp=0,index=0;counter>0;)index=Math.random()*counter|0,temp=array[--counter],array[counter]=array[index],array[index]=temp}function clamp(min,x,max){return Math.max(min,Math.min(x,max))}function nearestLargerEven(val){return val%2==0?val:val+1}function sum(arr){for(var sum=0,i=0;i<arr.length;i++)sum+=arr[i];return sum}function randUniform(a,b){var r=Math.random();return b*r+(1-r)*a}function distSquared(a,b){for(var result=0,i=0;i<a.length;i++){var diff=Number(a[i])-Number(b[i]);result+=diff*diff}return result}function assert(expr,msg){if(!expr)throw new Error("string"==typeof msg?msg:msg())}function assertShapesMatch(shapeA,shapeB,errorMessagePrefix){void 0===errorMessagePrefix&&(errorMessagePrefix=""),assert(arraysEqual(shapeA,shapeB),(function(){return errorMessagePrefix+" Shapes "+shapeA+" and "+shapeB+" must match"}))}function assertNonNull(a){assert(null!=a,(function(){return"The input to the tensor constructor must be a non-null value."}))}function flatten(arr,result,skipTypedArray){if(void 0===result&&(result=[]),void 0===skipTypedArray&&(skipTypedArray=!1),null==result&&(result=[]),Array.isArray(arr)||isTypedArray(arr)&&!skipTypedArray)for(var i=0;i<arr.length;++i)flatten(arr[i],result,skipTypedArray);else result.push(arr);return result}function sizeFromShape(shape){if(0===shape.length)return 1;for(var size=shape[0],i=1;i<shape.length;i++)size*=shape[i];return size}function isScalarShape(shape){return 0===shape.length}function arraysEqual(n1,n2){if(n1===n2)return!0;if(null==n1||null==n2)return!1;if(n1.length!==n2.length)return!1;for(var i=0;i<n1.length;i++)if(n1[i]!==n2[i])return!1;return!0}function isInt(a){return a%1==0}function tanh(x){if(null!=Math.tanh)return Math.tanh(x);if(x===1/0)return 1;if(x===-1/0)return-1;var e2x=Math.exp(2*x);return(e2x-1)/(e2x+1)}function sizeToSquarishShape(size){var width=Math.ceil(Math.sqrt(size));return[width,Math.ceil(size/width)]}function createShuffledIndices(n){for(var shuffledIndices=new Uint32Array(n),i=0;i<n;++i)shuffledIndices[i]=i;return shuffle(shuffledIndices),shuffledIndices}function rightPad(a,size){return size<=a.length?a:a+" ".repeat(size-a.length)}function repeatedTry(checkFn,delayFn,maxCounter){return void 0===delayFn&&(delayFn=function(counter){return 0}),new Promise((function(resolve,reject){var tryCount=0,tryFn=function(){if(checkFn())resolve();else{tryCount++;var nextBackoff=delayFn(tryCount);null!=maxCounter&&tryCount>=maxCounter?reject():setTimeout(tryFn,nextBackoff)}};tryFn()}))}function inferFromImplicitShape(shape,size){for(var shapeProd=1,implicitIdx=-1,i=0;i<shape.length;++i)if(shape[i]>=0)shapeProd*=shape[i];else if(-1===shape[i]){if(-1!==implicitIdx)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+implicitIdx+" and dim "+i);implicitIdx=i}else if(shape[i]<0)throw Error("Shapes can not be < 0. Found "+shape[i]+" at dim "+i);if(-1===implicitIdx){if(size>0&&size!==shapeProd)throw Error("Size("+size+") must match the product of shape "+shape);return shape}if(0===shapeProd)throw Error("Cannot infer the missing size in ["+shape+"] when there are 0 elements");if(size%shapeProd!=0)throw Error("The implicit shape can't be a fractional number. Got "+size+" / "+shapeProd);var newShape=shape.slice();return newShape[implicitIdx]=size/shapeProd,newShape}function parseAxisParam(axis,shape){var rank=shape.length;return assert((axis=null==axis?shape.map((function(s,i){return i})):[].concat(axis)).every((function(ax){return ax>=-rank&&ax<rank})),(function(){return"All values in axis param must be in range [-"+rank+", "+rank+") but got axis "+axis})),assert(axis.every((function(ax){return isInt(ax)})),(function(){return"All values in axis param must be integers but got axis "+axis})),axis.map((function(a){return a<0?rank+a:a}))}function squeezeShape(shape,axis){for(var newShape=[],keptDims=[],isEmptyArray=null!=axis&&Array.isArray(axis)&&0===axis.length,axes=null==axis||isEmptyArray?null:parseAxisParam(axis,shape).sort(),j=0,i=0;i<shape.length;++i){if(null!=axes){if(axes[j]===i&&1!==shape[i])throw new Error("Can't squeeze axis "+i+" since its dim '"+shape[i]+"' is not 1");(null==axes[j]||axes[j]>i)&&1===shape[i]&&(newShape.push(shape[i]),keptDims.push(i)),axes[j]<=i&&j++}1!==shape[i]&&(newShape.push(shape[i]),keptDims.push(i))}return{newShape:newShape,keptDims:keptDims}}function getTypedArrayFromDType(dtype,size){var values=null;if(null==dtype||"float32"===dtype)values=new Float32Array(size);else if("int32"===dtype)values=new Int32Array(size);else{if("bool"!==dtype)throw new Error("Unknown data type "+dtype);values=new Uint8Array(size)}return values}function getArrayFromDType(dtype,size){var values=null;if(null==dtype||"float32"===dtype)values=new Float32Array(size);else if("int32"===dtype)values=new Int32Array(size);else if("bool"===dtype)values=new Uint8Array(size);else{if("string"!==dtype)throw new Error("Unknown data type "+dtype);values=new Array(size)}return values}function checkConversionForErrors(vals,dtype){for(var i=0;i<vals.length;i++){var num=vals[i];if(isNaN(num)||!isFinite(num))throw Error("A tensor of type "+dtype+" being uploaded contains "+num+".")}}function isValidDtype(dtype){return"bool"===dtype||"complex64"===dtype||"float32"===dtype||"int32"===dtype||"string"===dtype}function hasEncodingLoss(oldType,newType){return"complex64"!==newType&&(("float32"!==newType||"complex64"===oldType)&&(("int32"!==newType||"float32"===oldType||"complex64"===oldType)&&("bool"!==newType||"bool"!==oldType)))}function isTypedArray(a){return a instanceof Float32Array||a instanceof Int32Array||a instanceof Uint8Array}function bytesPerElement(dtype){if("float32"===dtype||"int32"===dtype)return 4;if("complex64"===dtype)return 8;if("bool"===dtype)return 1;throw new Error("Unknown dtype "+dtype)}function bytesFromStringArray(arr){if(null==arr)return 0;var bytes=0;return arr.forEach((function(x){return bytes+=x.length})),bytes}function isString(value){return"string"==typeof value||value instanceof String}function isBoolean(value){return"boolean"==typeof value}function isNumber(value){return"number"==typeof value}function inferDtype(values){return Array.isArray(values)?inferDtype(values[0]):values instanceof Float32Array?"float32":values instanceof Int32Array||values instanceof Uint8Array?"int32":isNumber(values)?"float32":isString(values)?"string":isBoolean(values)?"bool":"float32"}function isFunction(f){return!!(f&&f.constructor&&f.call&&f.apply)}function nearestDivisor(size,start){for(var i=start;i<size;++i)if(size%i==0)return i;return size}function computeStrides(shape){var rank=shape.length;if(rank<2)return[];var strides=new Array(rank-1);strides[rank-2]=shape[rank-1];for(var i=rank-3;i>=0;--i)strides[i]=strides[i+1]*shape[i+1];return strides}function toTypedArray(a,dtype,debugMode){if("string"===dtype)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(a)&&(a=flatten(a)),debugMode&&checkConversionForErrors(a,dtype),noConversionNeeded(a,dtype))return a;if(null==dtype||"float32"===dtype||"complex64"===dtype)return new Float32Array(a);if("int32"===dtype)return new Int32Array(a);if("bool"===dtype){for(var bool=new Uint8Array(a.length),i=0;i<bool.length;++i)0!==Math.round(a[i])&&(bool[i]=1);return bool}throw new Error("Unknown data type "+dtype)}function createNestedArray(offset,shape,a){var ret=new Array;if(1===shape.length)for(var d=shape[0],i=0;i<d;i++)ret[i]=a[offset+i];else for(var d=shape[0],rest=shape.slice(1),len=rest.reduce((function(acc,c){return acc*c})),i=0;i<d;i++)ret[i]=createNestedArray(offset+i*len,rest,a);return ret}function toNestedArray(shape,a){if(0===shape.length)return a[0];var size=shape.reduce((function(acc,c){return acc*c}));if(0===size)return[];if(size!==a.length)throw new Error("["+shape+"] does not match the input size.");return createNestedArray(0,shape,a)}function noConversionNeeded(a,dtype){return a instanceof Float32Array&&"float32"===dtype||a instanceof Int32Array&&"int32"===dtype||a instanceof Uint8Array&&"bool"===dtype}function makeOnesTypedArray(size,dtype){for(var array=makeZerosTypedArray(size,dtype),i=0;i<array.length;i++)array[i]=1;return array}function makeZerosTypedArray(size,dtype){if(null==dtype||"float32"===dtype||"complex64"===dtype)return new Float32Array(size);if("int32"===dtype)return new Int32Array(size);if("bool"===dtype)return new Uint8Array(size);throw new Error("Unknown data type "+dtype)}function now(){return environment_1.ENV.platform.now()}function assertNonNegativeIntegerDimensions(shape){shape.forEach((function(dimSize){assert(Number.isInteger(dimSize)&&dimSize>=0,(function(){return"Tensor must have a shape comprised of positive integers but got shape ["+shape+"]."}))}))}function fetch(path,requestInits){return environment_1.ENV.platform.fetch(path,requestInits)}function encodeString(s,encoding){return void 0===encoding&&(encoding="utf-8"),encoding=encoding||"utf-8",environment_1.ENV.platform.encode(s,encoding)}function decodeString(bytes,encoding){return void 0===encoding&&(encoding="utf-8"),encoding=encoding||"utf-8",environment_1.ENV.platform.decode(bytes,encoding)}exports.shuffle=shuffle,exports.clamp=clamp,exports.nearestLargerEven=nearestLargerEven,exports.sum=sum,exports.randUniform=randUniform,exports.distSquared=distSquared,exports.assert=assert,exports.assertShapesMatch=assertShapesMatch,exports.assertNonNull=assertNonNull,exports.flatten=flatten,exports.sizeFromShape=sizeFromShape,exports.isScalarShape=isScalarShape,exports.arraysEqual=arraysEqual,exports.isInt=isInt,exports.tanh=tanh,exports.sizeToSquarishShape=sizeToSquarishShape,exports.createShuffledIndices=createShuffledIndices,exports.rightPad=rightPad,exports.repeatedTry=repeatedTry,exports.inferFromImplicitShape=inferFromImplicitShape,exports.parseAxisParam=parseAxisParam,exports.squeezeShape=squeezeShape,exports.getTypedArrayFromDType=getTypedArrayFromDType,exports.getArrayFromDType=getArrayFromDType,exports.checkConversionForErrors=checkConversionForErrors,exports.isValidDtype=isValidDtype,exports.hasEncodingLoss=hasEncodingLoss,exports.isTypedArray=isTypedArray,exports.bytesPerElement=bytesPerElement,exports.bytesFromStringArray=bytesFromStringArray,exports.isString=isString,exports.isBoolean=isBoolean,exports.isNumber=isNumber,exports.inferDtype=inferDtype,exports.isFunction=isFunction,exports.nearestDivisor=nearestDivisor,exports.computeStrides=computeStrides,exports.toTypedArray=toTypedArray,exports.toNestedArray=toNestedArray,exports.makeOnesTypedArray=makeOnesTypedArray,exports.makeZerosTypedArray=makeZerosTypedArray,exports.now=now,exports.assertNonNegativeIntegerDimensions=assertNonNegativeIntegerDimensions,exports.fetch=fetch,exports.encodeString=encodeString,exports.decodeString=decodeString},{"./environment":151}],249:[function(require,module,exports){"use strict";
/** @license See the LICENSE file. */Object.defineProperty(exports,"__esModule",{value:!0});var version="1.2.9";exports.version="1.2.9"},{}],250:[function(require,module,exports){"use strict";
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(exports,"__esModule",{value:!0});var gpgpu_util=require("./backends/webgl/gpgpu_util");exports.gpgpu_util=gpgpu_util;var webgl_util=require("./backends/webgl/webgl_util");exports.webgl_util=webgl_util;var environment_1=require("./environment"),backend_webgl_1=require("./backends/webgl/backend_webgl");exports.MathBackendWebGL=backend_webgl_1.MathBackendWebGL;var canvas_util_1=require("./backends/webgl/canvas_util");exports.setWebGLContext=canvas_util_1.setWebGLContext;var gpgpu_context_1=require("./backends/webgl/gpgpu_context");function forceHalfFloat(){environment_1.ENV.set("WEBGL_FORCE_F16_TEXTURES",!0)}exports.GPGPUContext=gpgpu_context_1.GPGPUContext,exports.forceHalfFloat=forceHalfFloat},{"./backends/webgl/backend_webgl":71,"./backends/webgl/canvas_util":77,"./backends/webgl/gpgpu_context":106,"./backends/webgl/gpgpu_util":108,"./backends/webgl/webgl_util":146,"./environment":151}],251:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0});class AwaitQueue{constructor({ClosedErrorClass:ClosedErrorClass=Error,StoppedErrorClass:StoppedErrorClass=Error}={ClosedErrorClass:Error,StoppedErrorClass:Error}){this.closed=!1,this.pendingTasks=[],this.ClosedErrorClass=Error,this.StoppedErrorClass=Error,this.ClosedErrorClass=ClosedErrorClass,this.StoppedErrorClass=StoppedErrorClass}get size(){return this.pendingTasks.length}close(){if(!this.closed){this.closed=!0;for(const pendingTask of this.pendingTasks)pendingTask.stopped=!0,pendingTask.reject(new this.ClosedErrorClass("AwaitQueue closed"));this.pendingTasks.length=0}}push(task,name){return __awaiter(this,void 0,void 0,(function*(){if(this.closed)throw new this.ClosedErrorClass("AwaitQueue closed");if("function"!=typeof task)throw new TypeError("given task is not a function");if(!task.name&&name)try{Object.defineProperty(task,"name",{value:name})}catch(error){}return new Promise((resolve,reject)=>{const pendingTask={task:task,name:name,resolve:resolve,reject:reject,stopped:!1,enqueuedAt:new Date,executedAt:void 0};this.pendingTasks.push(pendingTask),1===this.pendingTasks.length&&this.next()})}))}stop(){if(!this.closed){for(const pendingTask of this.pendingTasks)pendingTask.stopped=!0,pendingTask.reject(new this.StoppedErrorClass("AwaitQueue stopped"));this.pendingTasks.length=0}}dump(){const now=new Date;return this.pendingTasks.map(pendingTask=>({task:pendingTask.task,name:pendingTask.name,enqueuedTime:pendingTask.executedAt?pendingTask.executedAt.getTime()-pendingTask.enqueuedAt.getTime():now.getTime()-pendingTask.enqueuedAt.getTime(),executingTime:pendingTask.executedAt?now.getTime()-pendingTask.executedAt.getTime():0}))}next(){return __awaiter(this,void 0,void 0,(function*(){const pendingTask=this.pendingTasks[0];pendingTask&&(yield this.executeTask(pendingTask),this.pendingTasks.shift(),this.next())}))}executeTask(pendingTask){return __awaiter(this,void 0,void 0,(function*(){if(!pendingTask.stopped){pendingTask.executedAt=new Date;try{const result=yield pendingTask.task();if(pendingTask.stopped)return;pendingTask.resolve(result)}catch(error){if(pendingTask.stopped)return;pendingTask.reject(error)}}}))}}exports.AwaitQueue=AwaitQueue},{}],252:[function(require,module,exports){"use strict";exports.byteLength=byteLength,exports.toByteArray=toByteArray,exports.fromByteArray=fromByteArray;for(var lookup=[],revLookup=[],Arr="undefined"!=typeof Uint8Array?Uint8Array:Array,code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0,len=code.length;i<len;++i)lookup[i]=code[i],revLookup[code.charCodeAt(i)]=i;function getLens(b64){var len=b64.length;if(len%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var validLen=b64.indexOf("="),placeHoldersLen;return-1===validLen&&(validLen=len),[validLen,validLen===len?0:4-validLen%4]}function byteLength(b64){var lens=getLens(b64),validLen=lens[0],placeHoldersLen=lens[1];return 3*(validLen+placeHoldersLen)/4-placeHoldersLen}function _byteLength(b64,validLen,placeHoldersLen){return 3*(validLen+placeHoldersLen)/4-placeHoldersLen}function toByteArray(b64){var tmp,lens=getLens(b64),validLen=lens[0],placeHoldersLen=lens[1],arr=new Arr(_byteLength(b64,validLen,placeHoldersLen)),curByte=0,len=placeHoldersLen>0?validLen-4:validLen,i;for(i=0;i<len;i+=4)tmp=revLookup[b64.charCodeAt(i)]<<18|revLookup[b64.charCodeAt(i+1)]<<12|revLookup[b64.charCodeAt(i+2)]<<6|revLookup[b64.charCodeAt(i+3)],arr[curByte++]=tmp>>16&255,arr[curByte++]=tmp>>8&255,arr[curByte++]=255&tmp;return 2===placeHoldersLen&&(tmp=revLookup[b64.charCodeAt(i)]<<2|revLookup[b64.charCodeAt(i+1)]>>4,arr[curByte++]=255&tmp),1===placeHoldersLen&&(tmp=revLookup[b64.charCodeAt(i)]<<10|revLookup[b64.charCodeAt(i+1)]<<4|revLookup[b64.charCodeAt(i+2)]>>2,arr[curByte++]=tmp>>8&255,arr[curByte++]=255&tmp),arr}function tripletToBase64(num){return lookup[num>>18&63]+lookup[num>>12&63]+lookup[num>>6&63]+lookup[63&num]}function encodeChunk(uint8,start,end){for(var tmp,output=[],i=start;i<end;i+=3)tmp=(uint8[i]<<16&16711680)+(uint8[i+1]<<8&65280)+(255&uint8[i+2]),output.push(tripletToBase64(tmp));return output.join("")}function fromByteArray(uint8){for(var tmp,len=uint8.length,extraBytes=len%3,parts=[],maxChunkLength=16383,i=0,len2=len-extraBytes;i<len2;i+=16383)parts.push(encodeChunk(uint8,i,i+16383>len2?len2:i+16383));return 1===extraBytes?(tmp=uint8[len-1],parts.push(lookup[tmp>>2]+lookup[tmp<<4&63]+"==")):2===extraBytes&&(tmp=(uint8[len-2]<<8)+uint8[len-1],parts.push(lookup[tmp>>10]+lookup[tmp>>4&63]+lookup[tmp<<2&63]+"=")),parts.join("")}revLookup["-".charCodeAt(0)]=62,revLookup["_".charCodeAt(0)]=63},{}],253:[function(require,module,exports){var e,t;e=this,t=function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=90)}({17:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var n=r(18),i=function(){function e(){}return e.getFirstMatch=function(e,t){var r=t.match(e);return r&&r.length>0&&r[1]||""},e.getSecondMatch=function(e,t){var r=t.match(e);return r&&r.length>1&&r[2]||""},e.matchAndReturnConst=function(e,t,r){if(e.test(t))return r},e.getWindowsVersionName=function(e){switch(e){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}},e.getMacOSVersionName=function(e){var t=e.split(".").splice(0,2).map((function(e){return parseInt(e,10)||0}));if(t.push(0),10===t[0])switch(t[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}},e.getAndroidVersionName=function(e){var t=e.split(".").splice(0,2).map((function(e){return parseInt(e,10)||0}));if(t.push(0),!(1===t[0]&&t[1]<5))return 1===t[0]&&t[1]<6?"Cupcake":1===t[0]&&t[1]>=6?"Donut":2===t[0]&&t[1]<2?"Eclair":2===t[0]&&2===t[1]?"Froyo":2===t[0]&&t[1]>2?"Gingerbread":3===t[0]?"Honeycomb":4===t[0]&&t[1]<1?"Ice Cream Sandwich":4===t[0]&&t[1]<4?"Jelly Bean":4===t[0]&&t[1]>=4?"KitKat":5===t[0]?"Lollipop":6===t[0]?"Marshmallow":7===t[0]?"Nougat":8===t[0]?"Oreo":9===t[0]?"Pie":void 0},e.getVersionPrecision=function(e){return e.split(".").length},e.compareVersions=function(t,r,n){void 0===n&&(n=!1);var i=e.getVersionPrecision(t),s=e.getVersionPrecision(r),a=Math.max(i,s),o=0,u=e.map([t,r],(function(t){var r=a-e.getVersionPrecision(t),n=t+new Array(r+1).join(".0");return e.map(n.split("."),(function(e){return new Array(20-e.length).join("0")+e})).reverse()}));for(n&&(o=a-Math.min(i,s)),a-=1;a>=o;){if(u[0][a]>u[1][a])return 1;if(u[0][a]===u[1][a]){if(a===o)return 0;a-=1}else if(u[0][a]<u[1][a])return-1}},e.map=function(e,t){var r,n=[];if(Array.prototype.map)return Array.prototype.map.call(e,t);for(r=0;r<e.length;r+=1)n.push(t(e[r]));return n},e.find=function(e,t){var r,n;if(Array.prototype.find)return Array.prototype.find.call(e,t);for(r=0,n=e.length;r<n;r+=1){var i=e[r];if(t(i,r))return i}},e.assign=function(e){for(var t,r,n=e,i=arguments.length,s=new Array(i>1?i-1:0),a=1;a<i;a++)s[a-1]=arguments[a];if(Object.assign)return Object.assign.apply(Object,[e].concat(s));var o=function(){var e=s[t];"object"==typeof e&&null!==e&&Object.keys(e).forEach((function(t){n[t]=e[t]}))};for(t=0,r=s.length;t<r;t+=1)o();return e},e.getBrowserAlias=function(e){return n.BROWSER_ALIASES_MAP[e]},e.getBrowserTypeByAlias=function(e){return n.BROWSER_MAP[e]||""},e}();t.default=i,e.exports=t.default},18:function(e,t,r){"use strict";t.__esModule=!0,t.ENGINE_MAP=t.OS_MAP=t.PLATFORMS_MAP=t.BROWSER_MAP=t.BROWSER_ALIASES_MAP=void 0,t.BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},t.BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},t.PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},t.OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},t.ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"}},90:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var n,i=(n=r(91))&&n.__esModule?n:{default:n},s=r(18);function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o=function(){function e(){}var t,r,n;return e.getParser=function(e,t){if(void 0===t&&(t=!1),"string"!=typeof e)throw new Error("UserAgent should be a string");return new i.default(e,t)},e.parse=function(e){return new i.default(e).getResult()},t=e,n=[{key:"BROWSER_MAP",get:function(){return s.BROWSER_MAP}},{key:"ENGINE_MAP",get:function(){return s.ENGINE_MAP}},{key:"OS_MAP",get:function(){return s.OS_MAP}},{key:"PLATFORMS_MAP",get:function(){return s.PLATFORMS_MAP}}],(r=null)&&a(t.prototype,r),n&&a(t,n),e}();t.default=o,e.exports=t.default},91:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var n=u(r(92)),i=u(r(93)),s=u(r(94)),a=u(r(95)),o=u(r(17));function u(e){return e&&e.__esModule?e:{default:e}}var d=function(){function e(e,t){if(void 0===t&&(t=!1),null==e||""===e)throw new Error("UserAgent parameter can't be empty");this._ua=e,this.parsedResult={},!0!==t&&this.parse()}var t=e.prototype;return t.getUA=function(){return this._ua},t.test=function(e){return e.test(this._ua)},t.parseBrowser=function(){var e=this;this.parsedResult.browser={};var t=o.default.find(n.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.browser=t.describe(this.getUA())),this.parsedResult.browser},t.getBrowser=function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()},t.getBrowserName=function(e){return e?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""},t.getBrowserVersion=function(){return this.getBrowser().version},t.getOS=function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()},t.parseOS=function(){var e=this;this.parsedResult.os={};var t=o.default.find(i.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.os=t.describe(this.getUA())),this.parsedResult.os},t.getOSName=function(e){var t=this.getOS().name;return e?String(t).toLowerCase()||"":t||""},t.getOSVersion=function(){return this.getOS().version},t.getPlatform=function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()},t.getPlatformType=function(e){void 0===e&&(e=!1);var t=this.getPlatform().type;return e?String(t).toLowerCase()||"":t||""},t.parsePlatform=function(){var e=this;this.parsedResult.platform={};var t=o.default.find(s.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.platform=t.describe(this.getUA())),this.parsedResult.platform},t.getEngine=function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()},t.getEngineName=function(e){return e?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""},t.parseEngine=function(){var e=this;this.parsedResult.engine={};var t=o.default.find(a.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.engine=t.describe(this.getUA())),this.parsedResult.engine},t.parse=function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this},t.getResult=function(){return o.default.assign({},this.parsedResult)},t.satisfies=function(e){var t=this,r={},n=0,i={},s=0;if(Object.keys(e).forEach((function(t){var a=e[t];"string"==typeof a?(i[t]=a,s+=1):"object"==typeof a&&(r[t]=a,n+=1)})),n>0){var a=Object.keys(r),u=o.default.find(a,(function(e){return t.isOS(e)}));if(u){var d=this.satisfies(r[u]);if(void 0!==d)return d}var c=o.default.find(a,(function(e){return t.isPlatform(e)}));if(c){var f=this.satisfies(r[c]);if(void 0!==f)return f}}if(s>0){var l=Object.keys(i),h=o.default.find(l,(function(e){return t.isBrowser(e,!0)}));if(void 0!==h)return this.compareVersion(i[h])}},t.isBrowser=function(e,t){void 0===t&&(t=!1);var r=this.getBrowserName().toLowerCase(),n=e.toLowerCase(),i=o.default.getBrowserTypeByAlias(n);return t&&i&&(n=i.toLowerCase()),n===r},t.compareVersion=function(e){var t=[0],r=e,n=!1,i=this.getBrowserVersion();if("string"==typeof i)return">"===e[0]||"<"===e[0]?(r=e.substr(1),"="===e[1]?(n=!0,r=e.substr(2)):t=[],">"===e[0]?t.push(1):t.push(-1)):"="===e[0]?r=e.substr(1):"~"===e[0]&&(n=!0,r=e.substr(1)),t.indexOf(o.default.compareVersions(i,r,n))>-1},t.isOS=function(e){return this.getOSName(!0)===String(e).toLowerCase()},t.isPlatform=function(e){return this.getPlatformType(!0)===String(e).toLowerCase()},t.isEngine=function(e){return this.getEngineName(!0)===String(e).toLowerCase()},t.is=function(e,t){return void 0===t&&(t=!1),this.isBrowser(e,t)||this.isOS(e)||this.isPlatform(e)},t.some=function(e){var t=this;return void 0===e&&(e=[]),e.some((function(e){return t.is(e)}))},e}();t.default=d,e.exports=t.default},92:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var n,i=(n=r(17))&&n.__esModule?n:{default:n},s=/version\/(\d+(\.?_?\d+)+)/i,a=[{test:[/googlebot/i],describe:function(e){var t={name:"Googlebot"},r=i.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,e)||i.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/opera/i],describe:function(e){var t={name:"Opera"},r=i.default.getFirstMatch(s,e)||i.default.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/opr\/|opios/i],describe:function(e){var t={name:"Opera"},r=i.default.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,e)||i.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/SamsungBrowser/i],describe:function(e){var t={name:"Samsung Internet for Android"},r=i.default.getFirstMatch(s,e)||i.default.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/Whale/i],describe:function(e){var t={name:"NAVER Whale Browser"},r=i.default.getFirstMatch(s,e)||i.default.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/MZBrowser/i],describe:function(e){var t={name:"MZ Browser"},r=i.default.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,e)||i.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/focus/i],describe:function(e){var t={name:"Focus"},r=i.default.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,e)||i.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/swing/i],describe:function(e){var t={name:"Swing"},r=i.default.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,e)||i.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/coast/i],describe:function(e){var t={name:"Opera Coast"},r=i.default.getFirstMatch(s,e)||i.default.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe:function(e){var t={name:"Opera Touch"},r=i.default.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/yabrowser/i],describe:function(e){var t={name:"Yandex Browser"},r=i.default.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/ucbrowser/i],describe:function(e){var t={name:"UC Browser"},r=i.default.getFirstMatch(s,e)||i.default.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/Maxthon|mxios/i],describe:function(e){var t={name:"Maxthon"},r=i.default.getFirstMatch(s,e)||i.default.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/epiphany/i],describe:function(e){var t={name:"Epiphany"},r=i.default.getFirstMatch(s,e)||i.default.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/puffin/i],describe:function(e){var t={name:"Puffin"},r=i.default.getFirstMatch(s,e)||i.default.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/sleipnir/i],describe:function(e){var t={name:"Sleipnir"},r=i.default.getFirstMatch(s,e)||i.default.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/k-meleon/i],describe:function(e){var t={name:"K-Meleon"},r=i.default.getFirstMatch(s,e)||i.default.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/micromessenger/i],describe:function(e){var t={name:"WeChat"},r=i.default.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/qqbrowser/i],describe:function(e){var t={name:/qqbrowserlite/i.test(e)?"QQ Browser Lite":"QQ Browser"},r=i.default.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/msie|trident/i],describe:function(e){var t={name:"Internet Explorer"},r=i.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/\sedg\//i],describe:function(e){var t={name:"Microsoft Edge"},r=i.default.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/edg([ea]|ios)/i],describe:function(e){var t={name:"Microsoft Edge"},r=i.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/vivaldi/i],describe:function(e){var t={name:"Vivaldi"},r=i.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/seamonkey/i],describe:function(e){var t={name:"SeaMonkey"},r=i.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/sailfish/i],describe:function(e){var t={name:"Sailfish"},r=i.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,e);return r&&(t.version=r),t}},{test:[/silk/i],describe:function(e){var t={name:"Amazon Silk"},r=i.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/phantom/i],describe:function(e){var t={name:"PhantomJS"},r=i.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/slimerjs/i],describe:function(e){var t={name:"SlimerJS"},r=i.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(e){var t={name:"BlackBerry"},r=i.default.getFirstMatch(s,e)||i.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/(web|hpw)[o0]s/i],describe:function(e){var t={name:"WebOS Browser"},r=i.default.getFirstMatch(s,e)||i.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/bada/i],describe:function(e){var t={name:"Bada"},r=i.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/tizen/i],describe:function(e){var t={name:"Tizen"},r=i.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/qupzilla/i],describe:function(e){var t={name:"QupZilla"},r=i.default.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/firefox|iceweasel|fxios/i],describe:function(e){var t={name:"Firefox"},r=i.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/electron/i],describe:function(e){var t={name:"Electron"},r=i.default.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/MiuiBrowser/i],describe:function(e){var t={name:"Miui"},r=i.default.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/chromium/i],describe:function(e){var t={name:"Chromium"},r=i.default.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/chrome|crios|crmo/i],describe:function(e){var t={name:"Chrome"},r=i.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/GSA/i],describe:function(e){var t={name:"Google Search"},r=i.default.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:function(e){var t=!e.test(/like android/i),r=e.test(/android/i);return t&&r},describe:function(e){var t={name:"Android Browser"},r=i.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/playstation 4/i],describe:function(e){var t={name:"PlayStation 4"},r=i.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/safari|applewebkit/i],describe:function(e){var t={name:"Safari"},r=i.default.getFirstMatch(s,e);return r&&(t.version=r),t}},{test:[/.*/i],describe:function(e){var t=-1!==e.search("\\(")?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:i.default.getFirstMatch(t,e),version:i.default.getSecondMatch(t,e)}}}];t.default=a,e.exports=t.default},93:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var n,i=(n=r(17))&&n.__esModule?n:{default:n},s=r(18),a=[{test:[/Roku\/DVP/],describe:function(e){var t=i.default.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,e);return{name:s.OS_MAP.Roku,version:t}}},{test:[/windows phone/i],describe:function(e){var t=i.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,e);return{name:s.OS_MAP.WindowsPhone,version:t}}},{test:[/windows /i],describe:function(e){var t=i.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,e),r=i.default.getWindowsVersionName(t);return{name:s.OS_MAP.Windows,version:t,versionName:r}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(e){var t={name:s.OS_MAP.iOS},r=i.default.getSecondMatch(/(Version\/)(\d[\d.]+)/,e);return r&&(t.version=r),t}},{test:[/macintosh/i],describe:function(e){var t=i.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,e).replace(/[_\s]/g,"."),r=i.default.getMacOSVersionName(t),n={name:s.OS_MAP.MacOS,version:t};return r&&(n.versionName=r),n}},{test:[/(ipod|iphone|ipad)/i],describe:function(e){var t=i.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,e).replace(/[_\s]/g,".");return{name:s.OS_MAP.iOS,version:t}}},{test:function(e){var t=!e.test(/like android/i),r=e.test(/android/i);return t&&r},describe:function(e){var t=i.default.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,e),r=i.default.getAndroidVersionName(t),n={name:s.OS_MAP.Android,version:t};return r&&(n.versionName=r),n}},{test:[/(web|hpw)[o0]s/i],describe:function(e){var t=i.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,e),r={name:s.OS_MAP.WebOS};return t&&t.length&&(r.version=t),r}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(e){var t=i.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,e)||i.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,e)||i.default.getFirstMatch(/\bbb(\d+)/i,e);return{name:s.OS_MAP.BlackBerry,version:t}}},{test:[/bada/i],describe:function(e){var t=i.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,e);return{name:s.OS_MAP.Bada,version:t}}},{test:[/tizen/i],describe:function(e){var t=i.default.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,e);return{name:s.OS_MAP.Tizen,version:t}}},{test:[/linux/i],describe:function(){return{name:s.OS_MAP.Linux}}},{test:[/CrOS/],describe:function(){return{name:s.OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe:function(e){var t=i.default.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,e);return{name:s.OS_MAP.PlayStation4,version:t}}}];t.default=a,e.exports=t.default},94:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var n,i=(n=r(17))&&n.__esModule?n:{default:n},s=r(18),a=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(e){var t=i.default.getFirstMatch(/(can-l01)/i,e)&&"Nova",r={type:s.PLATFORMS_MAP.mobile,vendor:"Huawei"};return t&&(r.model=t),r}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet}}},{test:function(e){var t=e.test(/ipod|iphone/i),r=e.test(/like (ipod|iphone)/i);return t&&!r},describe:function(e){var t=i.default.getFirstMatch(/(ipod|iphone)/i,e);return{type:s.PLATFORMS_MAP.mobile,vendor:"Apple",model:t}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:s.PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:s.PLATFORMS_MAP.mobile}}},{test:function(e){return"blackberry"===e.getBrowserName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test:function(e){return"bada"===e.getBrowserName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.mobile}}},{test:function(e){return"windows phone"===e.getBrowserName()},describe:function(){return{type:s.PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test:function(e){var t=Number(String(e.getOSVersion()).split(".")[0]);return"android"===e.getOSName(!0)&&t>=3},describe:function(){return{type:s.PLATFORMS_MAP.tablet}}},{test:function(e){return"android"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.mobile}}},{test:function(e){return"macos"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test:function(e){return"windows"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.desktop}}},{test:function(e){return"linux"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.desktop}}},{test:function(e){return"playstation 4"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.tv}}},{test:function(e){return"roku"===e.getOSName(!0)},describe:function(){return{type:s.PLATFORMS_MAP.tv}}}];t.default=a,e.exports=t.default},95:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var n,i=(n=r(17))&&n.__esModule?n:{default:n},s=r(18),a=[{test:function(e){return"microsoft edge"===e.getBrowserName(!0)},describe:function(e){if(/\sedg\//i.test(e))return{name:s.ENGINE_MAP.Blink};var t=i.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,e);return{name:s.ENGINE_MAP.EdgeHTML,version:t}}},{test:[/trident/i],describe:function(e){var t={name:s.ENGINE_MAP.Trident},r=i.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:function(e){return e.test(/presto/i)},describe:function(e){var t={name:s.ENGINE_MAP.Presto},r=i.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:function(e){var t=e.test(/gecko/i),r=e.test(/like gecko/i);return t&&!r},describe:function(e){var t={name:s.ENGINE_MAP.Gecko},r=i.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:s.ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe:function(e){var t={name:s.ENGINE_MAP.WebKit},r=i.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}}];t.default=a,e.exports=t.default}})},"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.bowser=t():e.bowser=t()},{}],254:[function(require,module,exports){},{}],255:[function(require,module,exports){arguments[4][254][0].apply(exports,arguments)},{dup:254}],256:[function(require,module,exports){var objectCreate=Object.create||objectCreatePolyfill,objectKeys=Object.keys||objectKeysPolyfill,bind=Function.prototype.bind||functionBindPolyfill;function EventEmitter(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=objectCreate(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}module.exports=EventEmitter,EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._maxListeners=void 0;var defaultMaxListeners=10,hasDefineProperty;try{var o={};Object.defineProperty&&Object.defineProperty(o,"x",{value:0}),hasDefineProperty=0===o.x}catch(err){hasDefineProperty=!1}function $getMaxListeners(that){return void 0===that._maxListeners?EventEmitter.defaultMaxListeners:that._maxListeners}function emitNone(handler,isFn,self){if(isFn)handler.call(self);else for(var len=handler.length,listeners=arrayClone(handler,len),i=0;i<len;++i)listeners[i].call(self)}function emitOne(handler,isFn,self,arg1){if(isFn)handler.call(self,arg1);else for(var len=handler.length,listeners=arrayClone(handler,len),i=0;i<len;++i)listeners[i].call(self,arg1)}function emitTwo(handler,isFn,self,arg1,arg2){if(isFn)handler.call(self,arg1,arg2);else for(var len=handler.length,listeners=arrayClone(handler,len),i=0;i<len;++i)listeners[i].call(self,arg1,arg2)}function emitThree(handler,isFn,self,arg1,arg2,arg3){if(isFn)handler.call(self,arg1,arg2,arg3);else for(var len=handler.length,listeners=arrayClone(handler,len),i=0;i<len;++i)listeners[i].call(self,arg1,arg2,arg3)}function emitMany(handler,isFn,self,args){if(isFn)handler.apply(self,args);else for(var len=handler.length,listeners=arrayClone(handler,len),i=0;i<len;++i)listeners[i].apply(self,args)}function _addListener(target,type,listener,prepend){var m,events,existing;if("function"!=typeof listener)throw new TypeError('"listener" argument must be a function');if((events=target._events)?(events.newListener&&(target.emit("newListener",type,listener.listener?listener.listener:listener),events=target._events),existing=events[type]):(events=target._events=objectCreate(null),target._eventsCount=0),existing){if("function"==typeof existing?existing=events[type]=prepend?[listener,existing]:[existing,listener]:prepend?existing.unshift(listener):existing.push(listener),!existing.warned&&(m=$getMaxListeners(target))&&m>0&&existing.length>m){existing.warned=!0;var w=new Error("Possible EventEmitter memory leak detected. "+existing.length+' "'+String(type)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');w.name="MaxListenersExceededWarning",w.emitter=target,w.type=type,w.count=existing.length,"object"==typeof console&&console.warn&&console.warn("%s: %s",w.name,w.message)}}else existing=events[type]=listener,++target._eventsCount;return target}function onceWrapper(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var args=new Array(arguments.length),i=0;i<args.length;++i)args[i]=arguments[i];this.listener.apply(this.target,args)}}function _onceWrap(target,type,listener){var state={fired:!1,wrapFn:void 0,target:target,type:type,listener:listener},wrapped=bind.call(onceWrapper,state);return wrapped.listener=listener,state.wrapFn=wrapped,wrapped}function _listeners(target,type,unwrap){var events=target._events;if(!events)return[];var evlistener=events[type];return evlistener?"function"==typeof evlistener?unwrap?[evlistener.listener||evlistener]:[evlistener]:unwrap?unwrapListeners(evlistener):arrayClone(evlistener,evlistener.length):[]}function listenerCount(type){var events=this._events;if(events){var evlistener=events[type];if("function"==typeof evlistener)return 1;if(evlistener)return evlistener.length}return 0}function spliceOne(list,index){for(var i=index,k=i+1,n=list.length;k<n;i+=1,k+=1)list[i]=list[k];list.pop()}function arrayClone(arr,n){for(var copy=new Array(n),i=0;i<n;++i)copy[i]=arr[i];return copy}function unwrapListeners(arr){for(var ret=new Array(arr.length),i=0;i<ret.length;++i)ret[i]=arr[i].listener||arr[i];return ret}function objectCreatePolyfill(proto){var F=function(){};return F.prototype=proto,new F}function objectKeysPolyfill(obj){var keys=[];for(var k in obj)Object.prototype.hasOwnProperty.call(obj,k)&&keys.push(k);return k}function functionBindPolyfill(context){var fn=this;return function(){return fn.apply(context,arguments)}}hasDefineProperty?Object.defineProperty(EventEmitter,"defaultMaxListeners",{enumerable:!0,get:function(){return defaultMaxListeners},set:function(arg){if("number"!=typeof arg||arg<0||arg!=arg)throw new TypeError('"defaultMaxListeners" must be a positive number');defaultMaxListeners=arg}}):EventEmitter.defaultMaxListeners=defaultMaxListeners,EventEmitter.prototype.setMaxListeners=function setMaxListeners(n){if("number"!=typeof n||n<0||isNaN(n))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=n,this},EventEmitter.prototype.getMaxListeners=function getMaxListeners(){return $getMaxListeners(this)},EventEmitter.prototype.emit=function emit(type){var er,handler,len,args,i,events,doError="error"===type;if(events=this._events)doError=doError&&null==events.error;else if(!doError)return!1;if(doError){if(arguments.length>1&&(er=arguments[1]),er instanceof Error)throw er;var err=new Error('Unhandled "error" event. ('+er+")");throw err.context=er,err}if(!(handler=events[type]))return!1;var isFn="function"==typeof handler;switch(len=arguments.length){case 1:emitNone(handler,isFn,this);break;case 2:emitOne(handler,isFn,this,arguments[1]);break;case 3:emitTwo(handler,isFn,this,arguments[1],arguments[2]);break;case 4:emitThree(handler,isFn,this,arguments[1],arguments[2],arguments[3]);break;default:for(args=new Array(len-1),i=1;i<len;i++)args[i-1]=arguments[i];emitMany(handler,isFn,this,args)}return!0},EventEmitter.prototype.addListener=function addListener(type,listener){return _addListener(this,type,listener,!1)},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.prependListener=function prependListener(type,listener){return _addListener(this,type,listener,!0)},EventEmitter.prototype.once=function once(type,listener){if("function"!=typeof listener)throw new TypeError('"listener" argument must be a function');return this.on(type,_onceWrap(this,type,listener)),this},EventEmitter.prototype.prependOnceListener=function prependOnceListener(type,listener){if("function"!=typeof listener)throw new TypeError('"listener" argument must be a function');return this.prependListener(type,_onceWrap(this,type,listener)),this},EventEmitter.prototype.removeListener=function removeListener(type,listener){var list,events,position,i,originalListener;if("function"!=typeof listener)throw new TypeError('"listener" argument must be a function');if(!(events=this._events))return this;if(!(list=events[type]))return this;if(list===listener||list.listener===listener)0==--this._eventsCount?this._events=objectCreate(null):(delete events[type],events.removeListener&&this.emit("removeListener",type,list.listener||listener));else if("function"!=typeof list){for(position=-1,i=list.length-1;i>=0;i--)if(list[i]===listener||list[i].listener===listener){originalListener=list[i].listener,position=i;break}if(position<0)return this;0===position?list.shift():spliceOne(list,position),1===list.length&&(events[type]=list[0]),events.removeListener&&this.emit("removeListener",type,originalListener||listener)}return this},EventEmitter.prototype.removeAllListeners=function removeAllListeners(type){var listeners,events,i;if(!(events=this._events))return this;if(!events.removeListener)return 0===arguments.length?(this._events=objectCreate(null),this._eventsCount=0):events[type]&&(0==--this._eventsCount?this._events=objectCreate(null):delete events[type]),this;if(0===arguments.length){var keys=objectKeys(events),key;for(i=0;i<keys.length;++i)"removeListener"!==(key=keys[i])&&this.removeAllListeners(key);return this.removeAllListeners("removeListener"),this._events=objectCreate(null),this._eventsCount=0,this}if("function"==typeof(listeners=events[type]))this.removeListener(type,listeners);else if(listeners)for(i=listeners.length-1;i>=0;i--)this.removeListener(type,listeners[i]);return this},EventEmitter.prototype.listeners=function listeners(type){return _listeners(this,type,!0)},EventEmitter.prototype.rawListeners=function rawListeners(type){return _listeners(this,type,!1)},EventEmitter.listenerCount=function(emitter,type){return"function"==typeof emitter.listenerCount?emitter.listenerCount(type):listenerCount.call(emitter,type)},EventEmitter.prototype.listenerCount=listenerCount,EventEmitter.prototype.eventNames=function eventNames(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]}},{}],257:[function(require,module,exports){(function(Buffer){(function(){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */
"use strict";var base64=require("base64-js"),ieee754=require("ieee754");exports.Buffer=Buffer,exports.SlowBuffer=SlowBuffer,exports.INSPECT_MAX_BYTES=50;var K_MAX_LENGTH=2147483647;function typedArraySupport(){try{var arr=new Uint8Array(1);return arr.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===arr.foo()}catch(e){return!1}}function createBuffer(length){if(length>2147483647)throw new RangeError('The value "'+length+'" is invalid for option "size"');var buf=new Uint8Array(length);return buf.__proto__=Buffer.prototype,buf}function Buffer(arg,encodingOrOffset,length){if("number"==typeof arg){if("string"==typeof encodingOrOffset)throw new TypeError('The "string" argument must be of type string. Received type number');return allocUnsafe(arg)}return from(arg,encodingOrOffset,length)}function from(value,encodingOrOffset,length){if("string"==typeof value)return fromString(value,encodingOrOffset);if(ArrayBuffer.isView(value))return fromArrayLike(value);if(null==value)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof value);if(isInstance(value,ArrayBuffer)||value&&isInstance(value.buffer,ArrayBuffer))return fromArrayBuffer(value,encodingOrOffset,length);if("number"==typeof value)throw new TypeError('The "value" argument must not be of type number. Received type number');var valueOf=value.valueOf&&value.valueOf();if(null!=valueOf&&valueOf!==value)return Buffer.from(valueOf,encodingOrOffset,length);var b=fromObject(value);if(b)return b;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof value[Symbol.toPrimitive])return Buffer.from(value[Symbol.toPrimitive]("string"),encodingOrOffset,length);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof value)}function assertSize(size){if("number"!=typeof size)throw new TypeError('"size" argument must be of type number');if(size<0)throw new RangeError('The value "'+size+'" is invalid for option "size"')}function alloc(size,fill,encoding){return assertSize(size),size<=0?createBuffer(size):void 0!==fill?"string"==typeof encoding?createBuffer(size).fill(fill,encoding):createBuffer(size).fill(fill):createBuffer(size)}function allocUnsafe(size){return assertSize(size),createBuffer(size<0?0:0|checked(size))}function fromString(string,encoding){if("string"==typeof encoding&&""!==encoding||(encoding="utf8"),!Buffer.isEncoding(encoding))throw new TypeError("Unknown encoding: "+encoding);var length=0|byteLength(string,encoding),buf=createBuffer(length),actual=buf.write(string,encoding);return actual!==length&&(buf=buf.slice(0,actual)),buf}function fromArrayLike(array){for(var length=array.length<0?0:0|checked(array.length),buf=createBuffer(length),i=0;i<length;i+=1)buf[i]=255&array[i];return buf}function fromArrayBuffer(array,byteOffset,length){if(byteOffset<0||array.byteLength<byteOffset)throw new RangeError('"offset" is outside of buffer bounds');if(array.byteLength<byteOffset+(length||0))throw new RangeError('"length" is outside of buffer bounds');var buf;return(buf=void 0===byteOffset&&void 0===length?new Uint8Array(array):void 0===length?new Uint8Array(array,byteOffset):new Uint8Array(array,byteOffset,length)).__proto__=Buffer.prototype,buf}function fromObject(obj){if(Buffer.isBuffer(obj)){var len=0|checked(obj.length),buf=createBuffer(len);return 0===buf.length?buf:(obj.copy(buf,0,0,len),buf)}return void 0!==obj.length?"number"!=typeof obj.length||numberIsNaN(obj.length)?createBuffer(0):fromArrayLike(obj):"Buffer"===obj.type&&Array.isArray(obj.data)?fromArrayLike(obj.data):void 0}function checked(length){if(length>=2147483647)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+2147483647..toString(16)+" bytes");return 0|length}function SlowBuffer(length){return+length!=length&&(length=0),Buffer.alloc(+length)}function byteLength(string,encoding){if(Buffer.isBuffer(string))return string.length;if(ArrayBuffer.isView(string)||isInstance(string,ArrayBuffer))return string.byteLength;if("string"!=typeof string)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof string);var len=string.length,mustMatch=arguments.length>2&&!0===arguments[2];if(!mustMatch&&0===len)return 0;for(var loweredCase=!1;;)switch(encoding){case"ascii":case"latin1":case"binary":return len;case"utf8":case"utf-8":return utf8ToBytes(string).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*len;case"hex":return len>>>1;case"base64":return base64ToBytes(string).length;default:if(loweredCase)return mustMatch?-1:utf8ToBytes(string).length;encoding=(""+encoding).toLowerCase(),loweredCase=!0}}function slowToString(encoding,start,end){var loweredCase=!1;if((void 0===start||start<0)&&(start=0),start>this.length)return"";if((void 0===end||end>this.length)&&(end=this.length),end<=0)return"";if((end>>>=0)<=(start>>>=0))return"";for(encoding||(encoding="utf8");;)switch(encoding){case"hex":return hexSlice(this,start,end);case"utf8":case"utf-8":return utf8Slice(this,start,end);case"ascii":return asciiSlice(this,start,end);case"latin1":case"binary":return latin1Slice(this,start,end);case"base64":return base64Slice(this,start,end);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,start,end);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(encoding+"").toLowerCase(),loweredCase=!0}}function swap(b,n,m){var i=b[n];b[n]=b[m],b[m]=i}function bidirectionalIndexOf(buffer,val,byteOffset,encoding,dir){if(0===buffer.length)return-1;if("string"==typeof byteOffset?(encoding=byteOffset,byteOffset=0):byteOffset>2147483647?byteOffset=2147483647:byteOffset<-2147483648&&(byteOffset=-2147483648),numberIsNaN(byteOffset=+byteOffset)&&(byteOffset=dir?0:buffer.length-1),byteOffset<0&&(byteOffset=buffer.length+byteOffset),byteOffset>=buffer.length){if(dir)return-1;byteOffset=buffer.length-1}else if(byteOffset<0){if(!dir)return-1;byteOffset=0}if("string"==typeof val&&(val=Buffer.from(val,encoding)),Buffer.isBuffer(val))return 0===val.length?-1:arrayIndexOf(buffer,val,byteOffset,encoding,dir);if("number"==typeof val)return val&=255,"function"==typeof Uint8Array.prototype.indexOf?dir?Uint8Array.prototype.indexOf.call(buffer,val,byteOffset):Uint8Array.prototype.lastIndexOf.call(buffer,val,byteOffset):arrayIndexOf(buffer,[val],byteOffset,encoding,dir);throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(arr,val,byteOffset,encoding,dir){var indexSize=1,arrLength=arr.length,valLength=val.length,i;if(void 0!==encoding&&("ucs2"===(encoding=String(encoding).toLowerCase())||"ucs-2"===encoding||"utf16le"===encoding||"utf-16le"===encoding)){if(arr.length<2||val.length<2)return-1;indexSize=2,arrLength/=2,valLength/=2,byteOffset/=2}function read(buf,i){return 1===indexSize?buf[i]:buf.readUInt16BE(i*indexSize)}if(dir){var foundIndex=-1;for(i=byteOffset;i<arrLength;i++)if(read(arr,i)===read(val,-1===foundIndex?0:i-foundIndex)){if(-1===foundIndex&&(foundIndex=i),i-foundIndex+1===valLength)return foundIndex*indexSize}else-1!==foundIndex&&(i-=i-foundIndex),foundIndex=-1}else for(byteOffset+valLength>arrLength&&(byteOffset=arrLength-valLength),i=byteOffset;i>=0;i--){for(var found=!0,j=0;j<valLength;j++)if(read(arr,i+j)!==read(val,j)){found=!1;break}if(found)return i}return-1}function hexWrite(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;length?(length=Number(length))>remaining&&(length=remaining):length=remaining;var strLen=string.length;length>strLen/2&&(length=strLen/2);for(var i=0;i<length;++i){var parsed=parseInt(string.substr(2*i,2),16);if(numberIsNaN(parsed))return i;buf[offset+i]=parsed}return i}function utf8Write(buf,string,offset,length){return blitBuffer(utf8ToBytes(string,buf.length-offset),buf,offset,length)}function asciiWrite(buf,string,offset,length){return blitBuffer(asciiToBytes(string),buf,offset,length)}function latin1Write(buf,string,offset,length){return asciiWrite(buf,string,offset,length)}function base64Write(buf,string,offset,length){return blitBuffer(base64ToBytes(string),buf,offset,length)}function ucs2Write(buf,string,offset,length){return blitBuffer(utf16leToBytes(string,buf.length-offset),buf,offset,length)}function base64Slice(buf,start,end){return 0===start&&end===buf.length?base64.fromByteArray(buf):base64.fromByteArray(buf.slice(start,end))}function utf8Slice(buf,start,end){end=Math.min(buf.length,end);for(var res=[],i=start;i<end;){var firstByte=buf[i],codePoint=null,bytesPerSequence=firstByte>239?4:firstByte>223?3:firstByte>191?2:1,secondByte,thirdByte,fourthByte,tempCodePoint;if(i+bytesPerSequence<=end)switch(bytesPerSequence){case 1:firstByte<128&&(codePoint=firstByte);break;case 2:128==(192&(secondByte=buf[i+1]))&&(tempCodePoint=(31&firstByte)<<6|63&secondByte)>127&&(codePoint=tempCodePoint);break;case 3:secondByte=buf[i+1],thirdByte=buf[i+2],128==(192&secondByte)&&128==(192&thirdByte)&&(tempCodePoint=(15&firstByte)<<12|(63&secondByte)<<6|63&thirdByte)>2047&&(tempCodePoint<55296||tempCodePoint>57343)&&(codePoint=tempCodePoint);break;case 4:secondByte=buf[i+1],thirdByte=buf[i+2],fourthByte=buf[i+3],128==(192&secondByte)&&128==(192&thirdByte)&&128==(192&fourthByte)&&(tempCodePoint=(15&firstByte)<<18|(63&secondByte)<<12|(63&thirdByte)<<6|63&fourthByte)>65535&&tempCodePoint<1114112&&(codePoint=tempCodePoint)}null===codePoint?(codePoint=65533,bytesPerSequence=1):codePoint>65535&&(codePoint-=65536,res.push(codePoint>>>10&1023|55296),codePoint=56320|1023&codePoint),res.push(codePoint),i+=bytesPerSequence}return decodeCodePointsArray(res)}exports.kMaxLength=2147483647,Buffer.TYPED_ARRAY_SUPPORT=typedArraySupport(),Buffer.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(Buffer.prototype,"parent",{enumerable:!0,get:function(){if(Buffer.isBuffer(this))return this.buffer}}),Object.defineProperty(Buffer.prototype,"offset",{enumerable:!0,get:function(){if(Buffer.isBuffer(this))return this.byteOffset}}),"undefined"!=typeof Symbol&&null!=Symbol.species&&Buffer[Symbol.species]===Buffer&&Object.defineProperty(Buffer,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),Buffer.poolSize=8192,Buffer.from=function(value,encodingOrOffset,length){return from(value,encodingOrOffset,length)},Buffer.prototype.__proto__=Uint8Array.prototype,Buffer.__proto__=Uint8Array,Buffer.alloc=function(size,fill,encoding){return alloc(size,fill,encoding)},Buffer.allocUnsafe=function(size){return allocUnsafe(size)},Buffer.allocUnsafeSlow=function(size){return allocUnsafe(size)},Buffer.isBuffer=function isBuffer(b){return null!=b&&!0===b._isBuffer&&b!==Buffer.prototype},Buffer.compare=function compare(a,b){if(isInstance(a,Uint8Array)&&(a=Buffer.from(a,a.offset,a.byteLength)),isInstance(b,Uint8Array)&&(b=Buffer.from(b,b.offset,b.byteLength)),!Buffer.isBuffer(a)||!Buffer.isBuffer(b))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(a===b)return 0;for(var x=a.length,y=b.length,i=0,len=Math.min(x,y);i<len;++i)if(a[i]!==b[i]){x=a[i],y=b[i];break}return x<y?-1:y<x?1:0},Buffer.isEncoding=function isEncoding(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.concat=function concat(list,length){if(!Array.isArray(list))throw new TypeError('"list" argument must be an Array of Buffers');if(0===list.length)return Buffer.alloc(0);var i;if(void 0===length)for(length=0,i=0;i<list.length;++i)length+=list[i].length;var buffer=Buffer.allocUnsafe(length),pos=0;for(i=0;i<list.length;++i){var buf=list[i];if(isInstance(buf,Uint8Array)&&(buf=Buffer.from(buf)),!Buffer.isBuffer(buf))throw new TypeError('"list" argument must be an Array of Buffers');buf.copy(buffer,pos),pos+=buf.length}return buffer},Buffer.byteLength=byteLength,Buffer.prototype._isBuffer=!0,Buffer.prototype.swap16=function swap16(){var len=this.length;if(len%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var i=0;i<len;i+=2)swap(this,i,i+1);return this},Buffer.prototype.swap32=function swap32(){var len=this.length;if(len%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var i=0;i<len;i+=4)swap(this,i,i+3),swap(this,i+1,i+2);return this},Buffer.prototype.swap64=function swap64(){var len=this.length;if(len%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var i=0;i<len;i+=8)swap(this,i,i+7),swap(this,i+1,i+6),swap(this,i+2,i+5),swap(this,i+3,i+4);return this},Buffer.prototype.toString=function toString(){var length=this.length;return 0===length?"":0===arguments.length?utf8Slice(this,0,length):slowToString.apply(this,arguments)},Buffer.prototype.toLocaleString=Buffer.prototype.toString,Buffer.prototype.equals=function equals(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");return this===b||0===Buffer.compare(this,b)},Buffer.prototype.inspect=function inspect(){var str="",max=exports.INSPECT_MAX_BYTES;return str=this.toString("hex",0,max).replace(/(.{2})/g,"$1 ").trim(),this.length>max&&(str+=" ... "),"<Buffer "+str+">"},Buffer.prototype.compare=function compare(target,start,end,thisStart,thisEnd){if(isInstance(target,Uint8Array)&&(target=Buffer.from(target,target.offset,target.byteLength)),!Buffer.isBuffer(target))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof target);if(void 0===start&&(start=0),void 0===end&&(end=target?target.length:0),void 0===thisStart&&(thisStart=0),void 0===thisEnd&&(thisEnd=this.length),start<0||end>target.length||thisStart<0||thisEnd>this.length)throw new RangeError("out of range index");if(thisStart>=thisEnd&&start>=end)return 0;if(thisStart>=thisEnd)return-1;if(start>=end)return 1;if(this===target)return 0;for(var x=(thisEnd>>>=0)-(thisStart>>>=0),y=(end>>>=0)-(start>>>=0),len=Math.min(x,y),thisCopy=this.slice(thisStart,thisEnd),targetCopy=target.slice(start,end),i=0;i<len;++i)if(thisCopy[i]!==targetCopy[i]){x=thisCopy[i],y=targetCopy[i];break}return x<y?-1:y<x?1:0},Buffer.prototype.includes=function includes(val,byteOffset,encoding){return-1!==this.indexOf(val,byteOffset,encoding)},Buffer.prototype.indexOf=function indexOf(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,!0)},Buffer.prototype.lastIndexOf=function lastIndexOf(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,!1)},Buffer.prototype.write=function write(string,offset,length,encoding){if(void 0===offset)encoding="utf8",length=this.length,offset=0;else if(void 0===length&&"string"==typeof offset)encoding=offset,length=this.length,offset=0;else{if(!isFinite(offset))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");offset>>>=0,isFinite(length)?(length>>>=0,void 0===encoding&&(encoding="utf8")):(encoding=length,length=void 0)}var remaining=this.length-offset;if((void 0===length||length>remaining)&&(length=remaining),string.length>0&&(length<0||offset<0)||offset>this.length)throw new RangeError("Attempt to write outside buffer bounds");encoding||(encoding="utf8");for(var loweredCase=!1;;)switch(encoding){case"hex":return hexWrite(this,string,offset,length);case"utf8":case"utf-8":return utf8Write(this,string,offset,length);case"ascii":return asciiWrite(this,string,offset,length);case"latin1":case"binary":return latin1Write(this,string,offset,length);case"base64":return base64Write(this,string,offset,length);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,string,offset,length);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(""+encoding).toLowerCase(),loweredCase=!0}},Buffer.prototype.toJSON=function toJSON(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var MAX_ARGUMENTS_LENGTH=4096;function decodeCodePointsArray(codePoints){var len=codePoints.length;if(len<=4096)return String.fromCharCode.apply(String,codePoints);for(var res="",i=0;i<len;)res+=String.fromCharCode.apply(String,codePoints.slice(i,i+=4096));return res}function asciiSlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i)ret+=String.fromCharCode(127&buf[i]);return ret}function latin1Slice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i)ret+=String.fromCharCode(buf[i]);return ret}function hexSlice(buf,start,end){var len=buf.length;(!start||start<0)&&(start=0),(!end||end<0||end>len)&&(end=len);for(var out="",i=start;i<end;++i)out+=toHex(buf[i]);return out}function utf16leSlice(buf,start,end){for(var bytes=buf.slice(start,end),res="",i=0;i<bytes.length;i+=2)res+=String.fromCharCode(bytes[i]+256*bytes[i+1]);return res}function checkOffset(offset,ext,length){if(offset%1!=0||offset<0)throw new RangeError("offset is not uint");if(offset+ext>length)throw new RangeError("Trying to access beyond buffer length")}function checkInt(buf,value,offset,ext,max,min){if(!Buffer.isBuffer(buf))throw new TypeError('"buffer" argument must be a Buffer instance');if(value>max||value<min)throw new RangeError('"value" argument is out of bounds');if(offset+ext>buf.length)throw new RangeError("Index out of range")}function checkIEEE754(buf,value,offset,ext,max,min){if(offset+ext>buf.length)throw new RangeError("Index out of range");if(offset<0)throw new RangeError("Index out of range")}function writeFloat(buf,value,offset,littleEndian,noAssert){return value=+value,offset>>>=0,noAssert||checkIEEE754(buf,value,offset,4,34028234663852886e22,-34028234663852886e22),ieee754.write(buf,value,offset,littleEndian,23,4),offset+4}function writeDouble(buf,value,offset,littleEndian,noAssert){return value=+value,offset>>>=0,noAssert||checkIEEE754(buf,value,offset,8,17976931348623157e292,-17976931348623157e292),ieee754.write(buf,value,offset,littleEndian,52,8),offset+8}Buffer.prototype.slice=function slice(start,end){var len=this.length;(start=~~start)<0?(start+=len)<0&&(start=0):start>len&&(start=len),(end=void 0===end?len:~~end)<0?(end+=len)<0&&(end=0):end>len&&(end=len),end<start&&(end=start);var newBuf=this.subarray(start,end);return newBuf.__proto__=Buffer.prototype,newBuf},Buffer.prototype.readUIntLE=function readUIntLE(offset,byteLength,noAssert){offset>>>=0,byteLength>>>=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset],mul=1,i=0;++i<byteLength&&(mul*=256);)val+=this[offset+i]*mul;return val},Buffer.prototype.readUIntBE=function readUIntBE(offset,byteLength,noAssert){offset>>>=0,byteLength>>>=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset+--byteLength],mul=1;byteLength>0&&(mul*=256);)val+=this[offset+--byteLength]*mul;return val},Buffer.prototype.readUInt8=function readUInt8(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,1,this.length),this[offset]},Buffer.prototype.readUInt16LE=function readUInt16LE(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,2,this.length),this[offset]|this[offset+1]<<8},Buffer.prototype.readUInt16BE=function readUInt16BE(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,2,this.length),this[offset]<<8|this[offset+1]},Buffer.prototype.readUInt32LE=function readUInt32LE(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),(this[offset]|this[offset+1]<<8|this[offset+2]<<16)+16777216*this[offset+3]},Buffer.prototype.readUInt32BE=function readUInt32BE(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),16777216*this[offset]+(this[offset+1]<<16|this[offset+2]<<8|this[offset+3])},Buffer.prototype.readIntLE=function readIntLE(offset,byteLength,noAssert){offset>>>=0,byteLength>>>=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset],mul=1,i=0;++i<byteLength&&(mul*=256);)val+=this[offset+i]*mul;return val>=(mul*=128)&&(val-=Math.pow(2,8*byteLength)),val},Buffer.prototype.readIntBE=function readIntBE(offset,byteLength,noAssert){offset>>>=0,byteLength>>>=0,noAssert||checkOffset(offset,byteLength,this.length);for(var i=byteLength,mul=1,val=this[offset+--i];i>0&&(mul*=256);)val+=this[offset+--i]*mul;return val>=(mul*=128)&&(val-=Math.pow(2,8*byteLength)),val},Buffer.prototype.readInt8=function readInt8(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,1,this.length),128&this[offset]?-1*(255-this[offset]+1):this[offset]},Buffer.prototype.readInt16LE=function readInt16LE(offset,noAssert){offset>>>=0,noAssert||checkOffset(offset,2,this.length);var val=this[offset]|this[offset+1]<<8;return 32768&val?4294901760|val:val},Buffer.prototype.readInt16BE=function readInt16BE(offset,noAssert){offset>>>=0,noAssert||checkOffset(offset,2,this.length);var val=this[offset+1]|this[offset]<<8;return 32768&val?4294901760|val:val},Buffer.prototype.readInt32LE=function readInt32LE(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),this[offset]|this[offset+1]<<8|this[offset+2]<<16|this[offset+3]<<24},Buffer.prototype.readInt32BE=function readInt32BE(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),this[offset]<<24|this[offset+1]<<16|this[offset+2]<<8|this[offset+3]},Buffer.prototype.readFloatLE=function readFloatLE(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),ieee754.read(this,offset,!0,23,4)},Buffer.prototype.readFloatBE=function readFloatBE(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),ieee754.read(this,offset,!1,23,4)},Buffer.prototype.readDoubleLE=function readDoubleLE(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,8,this.length),ieee754.read(this,offset,!0,52,8)},Buffer.prototype.readDoubleBE=function readDoubleBE(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,8,this.length),ieee754.read(this,offset,!1,52,8)},Buffer.prototype.writeUIntLE=function writeUIntLE(value,offset,byteLength,noAssert){var maxBytes;(value=+value,offset>>>=0,byteLength>>>=0,noAssert)||checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength)-1,0);var mul=1,i=0;for(this[offset]=255&value;++i<byteLength&&(mul*=256);)this[offset+i]=value/mul&255;return offset+byteLength},Buffer.prototype.writeUIntBE=function writeUIntBE(value,offset,byteLength,noAssert){var maxBytes;(value=+value,offset>>>=0,byteLength>>>=0,noAssert)||checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength)-1,0);var i=byteLength-1,mul=1;for(this[offset+i]=255&value;--i>=0&&(mul*=256);)this[offset+i]=value/mul&255;return offset+byteLength},Buffer.prototype.writeUInt8=function writeUInt8(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,1,255,0),this[offset]=255&value,offset+1},Buffer.prototype.writeUInt16LE=function writeUInt16LE(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,65535,0),this[offset]=255&value,this[offset+1]=value>>>8,offset+2},Buffer.prototype.writeUInt16BE=function writeUInt16BE(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,65535,0),this[offset]=value>>>8,this[offset+1]=255&value,offset+2},Buffer.prototype.writeUInt32LE=function writeUInt32LE(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,4294967295,0),this[offset+3]=value>>>24,this[offset+2]=value>>>16,this[offset+1]=value>>>8,this[offset]=255&value,offset+4},Buffer.prototype.writeUInt32BE=function writeUInt32BE(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,4294967295,0),this[offset]=value>>>24,this[offset+1]=value>>>16,this[offset+2]=value>>>8,this[offset+3]=255&value,offset+4},Buffer.prototype.writeIntLE=function writeIntLE(value,offset,byteLength,noAssert){if(value=+value,offset>>>=0,!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=0,mul=1,sub=0;for(this[offset]=255&value;++i<byteLength&&(mul*=256);)value<0&&0===sub&&0!==this[offset+i-1]&&(sub=1),this[offset+i]=(value/mul>>0)-sub&255;return offset+byteLength},Buffer.prototype.writeIntBE=function writeIntBE(value,offset,byteLength,noAssert){if(value=+value,offset>>>=0,!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=byteLength-1,mul=1,sub=0;for(this[offset+i]=255&value;--i>=0&&(mul*=256);)value<0&&0===sub&&0!==this[offset+i+1]&&(sub=1),this[offset+i]=(value/mul>>0)-sub&255;return offset+byteLength},Buffer.prototype.writeInt8=function writeInt8(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,1,127,-128),value<0&&(value=255+value+1),this[offset]=255&value,offset+1},Buffer.prototype.writeInt16LE=function writeInt16LE(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,32767,-32768),this[offset]=255&value,this[offset+1]=value>>>8,offset+2},Buffer.prototype.writeInt16BE=function writeInt16BE(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,32767,-32768),this[offset]=value>>>8,this[offset+1]=255&value,offset+2},Buffer.prototype.writeInt32LE=function writeInt32LE(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,2147483647,-2147483648),this[offset]=255&value,this[offset+1]=value>>>8,this[offset+2]=value>>>16,this[offset+3]=value>>>24,offset+4},Buffer.prototype.writeInt32BE=function writeInt32BE(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,2147483647,-2147483648),value<0&&(value=4294967295+value+1),this[offset]=value>>>24,this[offset+1]=value>>>16,this[offset+2]=value>>>8,this[offset+3]=255&value,offset+4},Buffer.prototype.writeFloatLE=function writeFloatLE(value,offset,noAssert){return writeFloat(this,value,offset,!0,noAssert)},Buffer.prototype.writeFloatBE=function writeFloatBE(value,offset,noAssert){return writeFloat(this,value,offset,!1,noAssert)},Buffer.prototype.writeDoubleLE=function writeDoubleLE(value,offset,noAssert){return writeDouble(this,value,offset,!0,noAssert)},Buffer.prototype.writeDoubleBE=function writeDoubleBE(value,offset,noAssert){return writeDouble(this,value,offset,!1,noAssert)},Buffer.prototype.copy=function copy(target,targetStart,start,end){if(!Buffer.isBuffer(target))throw new TypeError("argument should be a Buffer");if(start||(start=0),end||0===end||(end=this.length),targetStart>=target.length&&(targetStart=target.length),targetStart||(targetStart=0),end>0&&end<start&&(end=start),end===start)return 0;if(0===target.length||0===this.length)return 0;if(targetStart<0)throw new RangeError("targetStart out of bounds");if(start<0||start>=this.length)throw new RangeError("Index out of range");if(end<0)throw new RangeError("sourceEnd out of bounds");end>this.length&&(end=this.length),target.length-targetStart<end-start&&(end=target.length-targetStart+start);var len=end-start;if(this===target&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(targetStart,start,end);else if(this===target&&start<targetStart&&targetStart<end)for(var i=len-1;i>=0;--i)target[i+targetStart]=this[i+start];else Uint8Array.prototype.set.call(target,this.subarray(start,end),targetStart);return len},Buffer.prototype.fill=function fill(val,start,end,encoding){if("string"==typeof val){if("string"==typeof start?(encoding=start,start=0,end=this.length):"string"==typeof end&&(encoding=end,end=this.length),void 0!==encoding&&"string"!=typeof encoding)throw new TypeError("encoding must be a string");if("string"==typeof encoding&&!Buffer.isEncoding(encoding))throw new TypeError("Unknown encoding: "+encoding);if(1===val.length){var code=val.charCodeAt(0);("utf8"===encoding&&code<128||"latin1"===encoding)&&(val=code)}}else"number"==typeof val&&(val&=255);if(start<0||this.length<start||this.length<end)throw new RangeError("Out of range index");if(end<=start)return this;var i;if(start>>>=0,end=void 0===end?this.length:end>>>0,val||(val=0),"number"==typeof val)for(i=start;i<end;++i)this[i]=val;else{var bytes=Buffer.isBuffer(val)?val:Buffer.from(val,encoding),len=bytes.length;if(0===len)throw new TypeError('The value "'+val+'" is invalid for argument "value"');for(i=0;i<end-start;++i)this[i+start]=bytes[i%len]}return this};var INVALID_BASE64_RE=/[^+/0-9A-Za-z-_]/g;function base64clean(str){if((str=(str=str.split("=")[0]).trim().replace(INVALID_BASE64_RE,"")).length<2)return"";for(;str.length%4!=0;)str+="=";return str}function toHex(n){return n<16?"0"+n.toString(16):n.toString(16)}function utf8ToBytes(string,units){var codePoint;units=units||1/0;for(var length=string.length,leadSurrogate=null,bytes=[],i=0;i<length;++i){if((codePoint=string.charCodeAt(i))>55295&&codePoint<57344){if(!leadSurrogate){if(codePoint>56319){(units-=3)>-1&&bytes.push(239,191,189);continue}if(i+1===length){(units-=3)>-1&&bytes.push(239,191,189);continue}leadSurrogate=codePoint;continue}if(codePoint<56320){(units-=3)>-1&&bytes.push(239,191,189),leadSurrogate=codePoint;continue}codePoint=65536+(leadSurrogate-55296<<10|codePoint-56320)}else leadSurrogate&&(units-=3)>-1&&bytes.push(239,191,189);if(leadSurrogate=null,codePoint<128){if((units-=1)<0)break;bytes.push(codePoint)}else if(codePoint<2048){if((units-=2)<0)break;bytes.push(codePoint>>6|192,63&codePoint|128)}else if(codePoint<65536){if((units-=3)<0)break;bytes.push(codePoint>>12|224,codePoint>>6&63|128,63&codePoint|128)}else{if(!(codePoint<1114112))throw new Error("Invalid code point");if((units-=4)<0)break;bytes.push(codePoint>>18|240,codePoint>>12&63|128,codePoint>>6&63|128,63&codePoint|128)}}return bytes}function asciiToBytes(str){for(var byteArray=[],i=0;i<str.length;++i)byteArray.push(255&str.charCodeAt(i));return byteArray}function utf16leToBytes(str,units){for(var c,hi,lo,byteArray=[],i=0;i<str.length&&!((units-=2)<0);++i)hi=(c=str.charCodeAt(i))>>8,lo=c%256,byteArray.push(lo),byteArray.push(hi);return byteArray}function base64ToBytes(str){return base64.toByteArray(base64clean(str))}function blitBuffer(src,dst,offset,length){for(var i=0;i<length&&!(i+offset>=dst.length||i>=src.length);++i)dst[i+offset]=src[i];return i}function isInstance(obj,type){return obj instanceof type||null!=obj&&null!=obj.constructor&&null!=obj.constructor.name&&obj.constructor.name===type.name}function numberIsNaN(obj){return obj!=obj}}).call(this)}).call(this,require("buffer").Buffer)},{"base64-js":252,buffer:257,ieee754:384}],258:[function(require,module,exports){
/*!
  Copyright (c) 2018 Jed Watson.
  Licensed under the MIT License (MIT), see
  http://jedwatson.github.io/classnames
*/
!function(){"use strict";var hasOwn={}.hasOwnProperty;function classNames(){for(var classes=[],i=0;i<arguments.length;i++){var arg=arguments[i];if(arg){var argType=typeof arg;if("string"===argType||"number"===argType)classes.push(arg);else if(Array.isArray(arg)){if(arg.length){var inner=classNames.apply(null,arg);inner&&classes.push(inner)}}else if("object"===argType)if(arg.toString===Object.prototype.toString)for(var key in arg)hasOwn.call(arg,key)&&arg[key]&&classes.push(key);else classes.push(arg.toString())}}return classes.join(" ")}void 0!==module&&module.exports?(classNames.default=classNames,module.exports=classNames):"function"==typeof define&&"object"==typeof define.amd&&define.amd?define("classnames",[],(function(){return classNames})):window.classNames=classNames}()},{}],259:[function(require,module,exports){function clipboardCopy(text){if(navigator.clipboard)return navigator.clipboard.writeText(text).catch((function(err){throw void 0!==err?err:new DOMException("The request is not allowed","NotAllowedError")}));var span=document.createElement("span");span.textContent=text,span.style.whiteSpace="pre",span.style.webkitUserSelect="auto",span.style.userSelect="all",document.body.appendChild(span);var selection=window.getSelection(),range=window.document.createRange();selection.removeAllRanges(),range.selectNode(span),selection.addRange(range);var success=!1;try{success=window.document.execCommand("copy")}catch(err){console.log("error",err)}return selection.removeAllRanges(),window.document.body.removeChild(span),success?Promise.resolve():Promise.reject(new DOMException("The request is not allowed","NotAllowedError"))}
/*! clipboard-copy. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */
module.exports=clipboardCopy},{}],260:[function(require,module,exports){(function(process){(function(){function useColors(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))}function formatArgs(args){if(args[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+args[0]+(this.useColors?"%c ":" ")+"+"+module.exports.humanize(this.diff),!this.useColors)return;const c="color: "+this.color;args.splice(1,0,c,"color: inherit");let index=0,lastC=0;args[0].replace(/%[a-zA-Z%]/g,match=>{"%%"!==match&&(index++,"%c"===match&&(lastC=index))}),args.splice(lastC,0,c)}function save(namespaces){try{namespaces?exports.storage.setItem("debug",namespaces):exports.storage.removeItem("debug")}catch(error){}}function load(){let r;try{r=exports.storage.getItem("debug")}catch(error){}return!r&&void 0!==process&&"env"in process&&(r=process.env.DEBUG),r}function localstorage(){try{return localStorage}catch(error){}}exports.formatArgs=formatArgs,exports.save=save,exports.load=load,exports.useColors=useColors,exports.storage=localstorage(),exports.destroy=(()=>{let warned=!1;return()=>{warned||(warned=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),exports.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],exports.log=console.debug||console.log||(()=>{}),module.exports=require("./common")(exports);const{formatters:formatters}=module.exports;formatters.j=function(v){try{return JSON.stringify(v)}catch(error){return"[UnexpectedJSONParseError]: "+error.message}}}).call(this)}).call(this,require("_process"))},{"./common":261,_process:422}],261:[function(require,module,exports){function setup(env){function selectColor(namespace){let hash=0;for(let i=0;i<namespace.length;i++)hash=(hash<<5)-hash+namespace.charCodeAt(i),hash|=0;return createDebug.colors[Math.abs(hash)%createDebug.colors.length]}function createDebug(namespace){let prevTime,enableOverride=null;function debug(...args){if(!debug.enabled)return;const self=debug,curr=Number(new Date),ms=curr-(prevTime||curr);self.diff=ms,self.prev=prevTime,self.curr=curr,prevTime=curr,args[0]=createDebug.coerce(args[0]),"string"!=typeof args[0]&&args.unshift("%O");let index=0;args[0]=args[0].replace(/%([a-zA-Z%])/g,(match,format)=>{if("%%"===match)return"%";index++;const formatter=createDebug.formatters[format];if("function"==typeof formatter){const val=args[index];match=formatter.call(self,val),args.splice(index,1),index--}return match}),createDebug.formatArgs.call(self,args);const logFn=self.log||createDebug.log;logFn.apply(self,args)}return debug.namespace=namespace,debug.useColors=createDebug.useColors(),debug.color=createDebug.selectColor(namespace),debug.extend=extend,debug.destroy=createDebug.destroy,Object.defineProperty(debug,"enabled",{enumerable:!0,configurable:!1,get:()=>null===enableOverride?createDebug.enabled(namespace):enableOverride,set:v=>{enableOverride=v}}),"function"==typeof createDebug.init&&createDebug.init(debug),debug}function extend(namespace,delimiter){const newDebug=createDebug(this.namespace+(void 0===delimiter?":":delimiter)+namespace);return newDebug.log=this.log,newDebug}function enable(namespaces){let i;createDebug.save(namespaces),createDebug.names=[],createDebug.skips=[];const split=("string"==typeof namespaces?namespaces:"").split(/[\s,]+/),len=split.length;for(i=0;i<len;i++)split[i]&&("-"===(namespaces=split[i].replace(/\*/g,".*?"))[0]?createDebug.skips.push(new RegExp("^"+namespaces.substr(1)+"$")):createDebug.names.push(new RegExp("^"+namespaces+"$")))}function disable(){const namespaces=[...createDebug.names.map(toNamespace),...createDebug.skips.map(toNamespace).map(namespace=>"-"+namespace)].join(",");return createDebug.enable(""),namespaces}function enabled(name){if("*"===name[name.length-1])return!0;let i,len;for(i=0,len=createDebug.skips.length;i<len;i++)if(createDebug.skips[i].test(name))return!1;for(i=0,len=createDebug.names.length;i<len;i++)if(createDebug.names[i].test(name))return!0;return!1}function toNamespace(regexp){return regexp.toString().substring(2,regexp.toString().length-2).replace(/\.\*\?$/,"*")}function coerce(val){return val instanceof Error?val.stack||val.message:val}function destroy(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return createDebug.debug=createDebug,createDebug.default=createDebug,createDebug.coerce=coerce,createDebug.disable=disable,createDebug.enable=enable,createDebug.enabled=enabled,createDebug.humanize=require("ms"),createDebug.destroy=destroy,Object.keys(env).forEach(key=>{createDebug[key]=env[key]}),createDebug.names=[],createDebug.skips=[],createDebug.formatters={},createDebug.selectColor=selectColor,createDebug.enable(createDebug.load()),createDebug}module.exports=setup},{ms:418}],262:[function(require,module,exports){"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");exports.__esModule=!0,exports.default=addClass;var _hasClass=_interopRequireDefault(require("./hasClass"));function addClass(element,className){element.classList?element.classList.add(className):(0,_hasClass.default)(element,className)||("string"==typeof element.className?element.className=element.className+" "+className:element.setAttribute("class",(element.className&&element.className.baseVal||"")+" "+className))}module.exports=exports.default},{"./hasClass":263,"@babel/runtime/helpers/interopRequireDefault":45}],263:[function(require,module,exports){"use strict";function hasClass(element,className){return element.classList?!!className&&element.classList.contains(className):-1!==(" "+(element.className.baseVal||element.className)+" ").indexOf(" "+className+" ")}exports.__esModule=!0,exports.default=hasClass,module.exports=exports.default},{}],264:[function(require,module,exports){"use strict";function replaceClassName(origClass,classToRemove){return origClass.replace(new RegExp("(^|\\s)"+classToRemove+"(?:\\s|$)","g"),"$1").replace(/\s+/g," ").replace(/^\s*|\s*$/g,"")}function removeClass(element,className){element.classList?element.classList.remove(className):"string"==typeof element.className?element.className=replaceClassName(element.className,className):element.setAttribute("class",replaceClassName(element.className&&element.className.baseVal||"",className))}exports.__esModule=!0,exports.default=removeClass,module.exports=exports.default},{}],265:[function(require,module,exports){
/*!
  * domready (c) Dustin Diaz 2014 - License MIT
  */
!function(name,definition){void 0!==module?module.exports=definition():"function"==typeof define&&"object"==typeof define.amd?define(definition):this[name]=definition()}("domready",(function(){var fns=[],listener,doc=document,hack=doc.documentElement.doScroll,domContentLoaded="DOMContentLoaded",loaded=(hack?/^loaded|^c/:/^loaded|^i|^c/).test(doc.readyState);return loaded||doc.addEventListener(domContentLoaded,listener=function(){for(doc.removeEventListener(domContentLoaded,listener),loaded=1;listener=fns.shift();)listener()}),function(fn){loaded?setTimeout(fn,0):fns.push(fn)}}))},{}],266:[function(require,module,exports){var naiveFallback=function(){if("object"==typeof self&&self)return self;if("object"==typeof window&&window)return window;throw new Error("Unable to resolve global `this`")};module.exports=function(){if(this)return this;if("object"==typeof globalThis&&globalThis)return globalThis;try{Object.defineProperty(Object.prototype,"__global__",{get:function(){return this},configurable:!0})}catch(error){return naiveFallback()}try{return __global__||naiveFallback()}finally{delete Object.prototype.__global__}}()},{}],267:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),tf=require("@tensorflow/tfjs-core"),tfjs_image_recognition_base_1=require("tfjs-image-recognition-base"),fullyConnectedLayer_1=require("../common/fullyConnectedLayer"),util_1=require("../faceProcessor/util"),TinyXception_1=require("../xception/TinyXception"),extractParams_1=require("./extractParams"),extractParamsFromWeigthMap_1=require("./extractParamsFromWeigthMap"),types_1=require("./types"),AgeGenderNet=function(_super){function AgeGenderNet(faceFeatureExtractor){void 0===faceFeatureExtractor&&(faceFeatureExtractor=new TinyXception_1.TinyXception(2));var _this=_super.call(this,"AgeGenderNet")||this;return _this._faceFeatureExtractor=faceFeatureExtractor,_this}return tslib_1.__extends(AgeGenderNet,_super),Object.defineProperty(AgeGenderNet.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),AgeGenderNet.prototype.runNet=function(input){var _this=this,params=this.params;if(!params)throw new Error(this._name+" - load model before inference");return tf.tidy((function(){var bottleneckFeatures=input instanceof tfjs_image_recognition_base_1.NetInput?_this.faceFeatureExtractor.forwardInput(input):input,pooled=tf.avgPool(bottleneckFeatures,[7,7],[2,2],"valid").as2D(bottleneckFeatures.shape[0],-1),age,gender;return{age:fullyConnectedLayer_1.fullyConnectedLayer(pooled,params.fc.age).as1D(),gender:fullyConnectedLayer_1.fullyConnectedLayer(pooled,params.fc.gender)}}))},AgeGenderNet.prototype.forwardInput=function(input){var _this=this;return tf.tidy((function(){var _a=_this.runNet(input),age=_a.age,gender=_a.gender;return{age:age,gender:tf.softmax(gender)}}))},AgeGenderNet.prototype.forward=function(input){return tslib_1.__awaiter(this,void 0,void 0,(function(){var _a;return tslib_1.__generator(this,(function(_b){switch(_b.label){case 0:return _a=this.forwardInput,[4,tfjs_image_recognition_base_1.toNetInput(input)];case 1:return[2,_a.apply(this,[_b.sent()])]}}))}))},AgeGenderNet.prototype.predictAgeAndGender=function(input){return tslib_1.__awaiter(this,void 0,void 0,(function(){var netInput,out,ages,genders,ageAndGenderTensors,predictionsByBatch,_this=this;return tslib_1.__generator(this,(function(_a){switch(_a.label){case 0:return[4,tfjs_image_recognition_base_1.toNetInput(input)];case 1:return netInput=_a.sent(),[4,this.forwardInput(netInput)];case 2:return out=_a.sent(),ages=tf.unstack(out.age),genders=tf.unstack(out.gender),ageAndGenderTensors=ages.map((function(ageTensor,i){return{ageTensor:ageTensor,genderTensor:genders[i]}})),[4,Promise.all(ageAndGenderTensors.map((function(_a){var ageTensor=_a.ageTensor,genderTensor=_a.genderTensor;return tslib_1.__awaiter(_this,void 0,void 0,(function(){var age,probMale,isMale,gender,genderProbability;return tslib_1.__generator(this,(function(_b){switch(_b.label){case 0:return[4,ageTensor.data()];case 1:return age=_b.sent()[0],[4,genderTensor.data()];case 2:return probMale=_b.sent()[0],gender=(isMale=probMale>.5)?types_1.Gender.MALE:types_1.Gender.FEMALE,genderProbability=isMale?probMale:1-probMale,ageTensor.dispose(),genderTensor.dispose(),[2,{age:age,gender:gender,genderProbability:genderProbability}]}}))}))})))];case 3:return predictionsByBatch=_a.sent(),out.age.dispose(),out.gender.dispose(),[2,netInput.isBatchInput?predictionsByBatch:predictionsByBatch[0]]}}))}))},AgeGenderNet.prototype.getDefaultModelName=function(){return"age_gender_model"},AgeGenderNet.prototype.dispose=function(throwOnRedispose){void 0===throwOnRedispose&&(throwOnRedispose=!0),this.faceFeatureExtractor.dispose(throwOnRedispose),_super.prototype.dispose.call(this,throwOnRedispose)},AgeGenderNet.prototype.loadClassifierParams=function(weights){var _a=this.extractClassifierParams(weights),params=_a.params,paramMappings=_a.paramMappings;this._params=params,this._paramMappings=paramMappings},AgeGenderNet.prototype.extractClassifierParams=function(weights){return extractParams_1.extractParams(weights)},AgeGenderNet.prototype.extractParamsFromWeigthMap=function(weightMap){var _a=util_1.seperateWeightMaps(weightMap),featureExtractorMap=_a.featureExtractorMap,classifierMap=_a.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(featureExtractorMap),extractParamsFromWeigthMap_1.extractParamsFromWeigthMap(classifierMap)},AgeGenderNet.prototype.extractParams=function(weights){var classifierWeightSize=1539,featureExtractorWeights=weights.slice(0,weights.length-1539),classifierWeights=weights.slice(weights.length-1539);return this.faceFeatureExtractor.extractWeights(featureExtractorWeights),this.extractClassifierParams(classifierWeights)},AgeGenderNet}(tfjs_image_recognition_base_1.NeuralNetwork);exports.AgeGenderNet=AgeGenderNet},{"../common/fullyConnectedLayer":280,"../faceProcessor/util":310,"../xception/TinyXception":378,"./extractParams":268,"./extractParamsFromWeigthMap":269,"./types":271,"@tensorflow/tfjs-core":155,"tfjs-image-recognition-base":568,tslib:588}],268:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tfjs_image_recognition_base_1=require("tfjs-image-recognition-base");function extractParams(weights){var paramMappings=[],_a=tfjs_image_recognition_base_1.TfjsImageRecognitionBase.extractWeightsFactory(weights),extractWeights=_a.extractWeights,getRemainingWeights=_a.getRemainingWeights,extractFCParams=tfjs_image_recognition_base_1.TfjsImageRecognitionBase.extractFCParamsFactory(extractWeights,paramMappings),age=extractFCParams(512,1,"fc/age"),gender=extractFCParams(512,2,"fc/gender");if(0!==getRemainingWeights().length)throw new Error("weights remaing after extract: "+getRemainingWeights().length);return{paramMappings:paramMappings,params:{fc:{age:age,gender:gender}}}}exports.extractParams=extractParams},{"tfjs-image-recognition-base":568}],269:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tfjs_image_recognition_base_1=require("tfjs-image-recognition-base");function extractParamsFromWeigthMap(weightMap){var paramMappings=[],extractWeightEntry=tfjs_image_recognition_base_1.TfjsImageRecognitionBase.extractWeightEntryFactory(weightMap,paramMappings);function extractFcParams(prefix){var weights,bias;return{weights:extractWeightEntry(prefix+"/weights",2),bias:extractWeightEntry(prefix+"/bias",1)}}var params={fc:{age:extractFcParams("fc/age"),gender:extractFcParams("fc/gender")}};return tfjs_image_recognition_base_1.TfjsImageRecognitionBase.disposeUnusedWeightTensors(weightMap,paramMappings),{params:params,paramMappings:paramMappings}}exports.extractParamsFromWeigthMap=extractParamsFromWeigthMap},{"tfjs-image-recognition-base":568}],270:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib");tslib_1.__exportStar(require("./AgeGenderNet"),exports),tslib_1.__exportStar(require("./types"),exports)},{"./AgeGenderNet":267,"./types":271,tslib:588}],271:[function(require,module,exports){"use strict";var Gender;Object.defineProperty(exports,"__esModule",{value:!0}),function(Gender){Gender.FEMALE="female",Gender.MALE="male"}(Gender=exports.Gender||(exports.Gender={}))},{}],272:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),tfjs_image_recognition_base_1,FaceDetection=function(_super){function FaceDetection(score,relativeBox,imageDims){return _super.call(this,score,score,"",relativeBox,imageDims)||this}return tslib_1.__extends(FaceDetection,_super),FaceDetection.prototype.forSize=function(width,height){var _a=_super.prototype.forSize.call(this,width,height),score,relativeBox,imageDims;return new FaceDetection(_a.score,_a.relativeBox,_a.imageDims)},FaceDetection}(require("tfjs-image-recognition-base").ObjectDetection);exports.FaceDetection=FaceDetection},{"tfjs-image-recognition-base":568,tslib:588}],273:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tfjs_image_recognition_base_1=require("tfjs-image-recognition-base"),minBbox_1=require("../minBbox"),FaceDetection_1=require("./FaceDetection"),relX=.5,relY=.43,relScale=.45,FaceLandmarks=function(){function FaceLandmarks(relativeFaceLandmarkPositions,imgDims,shift){void 0===shift&&(shift=new tfjs_image_recognition_base_1.Point(0,0));var width=imgDims.width,height=imgDims.height;this._imgDims=new tfjs_image_recognition_base_1.Dimensions(width,height),this._shift=shift,this._positions=relativeFaceLandmarkPositions.map((function(pt){return pt.mul(new tfjs_image_recognition_base_1.Point(width,height)).add(shift)}))}return Object.defineProperty(FaceLandmarks.prototype,"shift",{get:function(){return new tfjs_image_recognition_base_1.Point(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(FaceLandmarks.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(FaceLandmarks.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(FaceLandmarks.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(FaceLandmarks.prototype,"relativePositions",{get:function(){var _this=this;return this._positions.map((function(pt){return pt.sub(_this._shift).div(new tfjs_image_recognition_base_1.Point(_this.imageWidth,_this.imageHeight))}))},enumerable:!0,configurable:!0}),FaceLandmarks.prototype.forSize=function(width,height){return new this.constructor(this.relativePositions,{width:width,height:height})},FaceLandmarks.prototype.shiftBy=function(x,y){return new this.constructor(this.relativePositions,this._imgDims,new tfjs_image_recognition_base_1.Point(x,y))},FaceLandmarks.prototype.shiftByPoint=function(pt){return this.shiftBy(pt.x,pt.y)},FaceLandmarks.prototype.align=function(detection,options){if(void 0===options&&(options={}),detection){var box=detection instanceof FaceDetection_1.FaceDetection?detection.box.floor():new tfjs_image_recognition_base_1.Box(detection);return this.shiftBy(box.x,box.y).align(null,options)}var _a=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},options),useDlibAlignment=_a.useDlibAlignment,minBoxPadding=_a.minBoxPadding;return useDlibAlignment?this.alignDlib():this.alignMinBbox(minBoxPadding)},FaceLandmarks.prototype.alignDlib=function(){var centers=this.getRefPointsForAlignment(),leftEyeCenter=centers[0],rightEyeCenter=centers[1],mouthCenter=centers[2],distToMouth=function(pt){return mouthCenter.sub(pt).magnitude()},eyeToMouthDist=(distToMouth(leftEyeCenter)+distToMouth(rightEyeCenter))/2,size=Math.floor(eyeToMouthDist/.45),refPoint=tfjs_image_recognition_base_1.getCenterPoint(centers),x=Math.floor(Math.max(0,refPoint.x-.5*size)),y=Math.floor(Math.max(0,refPoint.y-.43*size));return new tfjs_image_recognition_base_1.Rect(x,y,Math.min(size,this.imageWidth+x),Math.min(size,this.imageHeight+y))},FaceLandmarks.prototype.alignMinBbox=function(padding){var box=minBbox_1.minBbox(this.positions);return box.pad(box.width*padding,box.height*padding)},FaceLandmarks.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},FaceLandmarks}();exports.FaceLandmarks=FaceLandmarks},{"../minBbox":338,"./FaceDetection":272,"tfjs-image-recognition-base":568}],274:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),tfjs_image_recognition_base_1=require("tfjs-image-recognition-base"),FaceLandmarks_1,FaceLandmarks5=function(_super){function FaceLandmarks5(){return null!==_super&&_super.apply(this,arguments)||this}return tslib_1.__extends(FaceLandmarks5,_super),FaceLandmarks5.prototype.getRefPointsForAlignment=function(){var pts=this.positions;return[pts[0],pts[1],tfjs_image_recognition_base_1.getCenterPoint([pts[3],pts[4]])]},FaceLandmarks5}(require("./FaceLandmarks").FaceLandmarks);exports.FaceLandmarks5=FaceLandmarks5},{"./FaceLandmarks":273,"tfjs-image-recognition-base":568,tslib:588}],275:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),tfjs_image_recognition_base_1=require("tfjs-image-recognition-base"),FaceLandmarks_1,FaceLandmarks68=function(_super){function FaceLandmarks68(){return null!==_super&&_super.apply(this,arguments)||this}return tslib_1.__extends(FaceLandmarks68,_super),FaceLandmarks68.prototype.getJawOutline=function(){return this.positions.slice(0,17)},FaceLandmarks68.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},FaceLandmarks68.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},FaceLandmarks68.prototype.getNose=function(){return this.positions.slice(27,36)},FaceLandmarks68.prototype.getLeftEye=function(){return this.positions.slice(36,42)},FaceLandmarks68.prototype.getRightEye=function(){return this.positions.slice(42,48)},FaceLandmarks68.prototype.getMouth=function(){return this.positions.slice(48,68)},FaceLandmarks68.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(tfjs_image_recognition_base_1.getCenterPoint)},FaceLandmarks68}(require("../classes/FaceLandmarks").FaceLandmarks);exports.FaceLandmarks68=FaceLandmarks68},{"../classes/FaceLandmarks":273,"tfjs-image-recognition-base":568,tslib:588}],276:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tfjs_image_recognition_base_1=require("tfjs-image-recognition-base"),FaceMatch=function(){function FaceMatch(label,distance){this._label=label,this._distance=distance}return Object.defineProperty(FaceMatch.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(FaceMatch.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),FaceMatch.prototype.toString=function(withDistance){return void 0===withDistance&&(withDistance=!0),this.label+(withDistance?" ("+tfjs_image_recognition_base_1.round(this.distance)+")":"")},FaceMatch}();exports.FaceMatch=FaceMatch},{"tfjs-image-recognition-base":568}],277:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var LabeledFaceDescriptors=function(){function LabeledFaceDescriptors(label,descriptors){if("string"!=typeof label)throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(descriptors)||descriptors.some((function(desc){return!(desc instanceof Float32Array)})))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=label,this._descriptors=descriptors}return Object.defineProperty(LabeledFaceDescriptors.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(LabeledFaceDescriptors.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),LabeledFaceDescriptors.prototype.toJSON=function(){return{label:this.label,descriptors:this.descriptors.map((function(d){return Array.from(d)}))}},LabeledFaceDescriptors.fromJSON=function(json){var descriptors=json.descriptors.map((function(d){return new Float32Array(d)}));return new LabeledFaceDescriptors(json.label,descriptors)},LabeledFaceDescriptors}();exports.LabeledFaceDescriptors=LabeledFaceDescriptors},{}],278:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib");tslib_1.__exportStar(require("./FaceDetection"),exports),tslib_1.__exportStar(require("./FaceLandmarks"),exports),tslib_1.__exportStar(require("./FaceLandmarks5"),exports),tslib_1.__exportStar(require("./FaceLandmarks68"),exports),tslib_1.__exportStar(require("./FaceMatch"),exports),tslib_1.__exportStar(require("./LabeledFaceDescriptors"),exports)},{"./FaceDetection":272,"./FaceLandmarks":273,"./FaceLandmarks5":274,"./FaceLandmarks68":275,"./FaceMatch":276,"./LabeledFaceDescriptors":277,tslib:588}],279:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tf=require("@tensorflow/tfjs-core");function depthwiseSeparableConv(x,params,stride){return tf.tidy((function(){var out=tf.separableConv2d(x,params.depthwise_filter,params.pointwise_filter,stride,"same");return out=tf.add(out,params.bias)}))}exports.depthwiseSeparableConv=depthwiseSeparableConv},{"@tensorflow/tfjs-core":155}],280:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tf=require("@tensorflow/tfjs-core");function fullyConnectedLayer(x,params){return tf.tidy((function(){return tf.add(tf.matMul(x,params.weights),params.bias)}))}exports.fullyConnectedLayer=fullyConnectedLayer},{"@tensorflow/tfjs-core":155}],281:[function(require,module,exports){"use strict";function loadConvParamsFactory(extractWeightEntry){return function(prefix){var filters,bias;return{filters:extractWeightEntry(prefix+"/filters",4),bias:extractWeightEntry(prefix+"/bias",1)}}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.loadConvParamsFactory=loadConvParamsFactory},{}],282:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),tf=require("@tensorflow/tfjs-core"),tfjs_image_recognition_base_1=require("tfjs-image-recognition-base"),FaceDetection_1=require("../classes/FaceDetection");function extractFaceTensors(imageTensor,detections){return tslib_1.__awaiter(this,void 0,void 0,(function(){return tslib_1.__generator(this,(function(_a){if(!tfjs_image_recognition_base_1.isTensor3D(imageTensor)&&!tfjs_image_recognition_base_1.isTensor4D(imageTensor))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(tfjs_image_recognition_base_1.isTensor4D(imageTensor)&&imageTensor.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,tf.tidy((function(){var _a=imageTensor.shape.slice(tfjs_image_recognition_base_1.isTensor4D(imageTensor)?1:0),imgHeight=_a[0],imgWidth=_a[1],numChannels=_a[2],boxes,faceTensors;return detections.map((function(det){return det instanceof FaceDetection_1.FaceDetection?det.forSize(imgWidth,imgHeight).box:det})).map((function(box){return box.clipAtImageBorders(imgWidth,imgHeight)})).map((function(_a){var x=_a.x,y=_a.y,width=_a.width,height=_a.height;return tf.slice3d(imageTensor.as3D(imgHeight,imgWidth,numChannels),[y,x,0],[height,width,numChannels])}))}))]}))}))}exports.extractFaceTensors=extractFaceTensors},{"../classes/FaceDetection":272,"@tensorflow/tfjs-core":155,"tfjs-image-recognition-base":568,tslib:588}],283:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),tfjs_image_recognition_base_1=require("tfjs-image-recognition-base"),FaceDetection_1=require("../classes/FaceDetection");function extractFaces(input,detections){return tslib_1.__awaiter(this,void 0,void 0,(function(){var Canvas,canvas,netInput,tensorOrCanvas,_a,ctx,boxes;return tslib_1.__generator(this,(function(_b){switch(_b.label){case 0:return Canvas=tfjs_image_recognition_base_1.env.getEnv().Canvas,canvas=input,input instanceof Canvas?[3,5]:[4,tfjs_image_recognition_base_1.toNetInput(input)];case 1:if((netInput=_b.sent()).batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return(tensorOrCanvas=netInput.getInput(0))instanceof Canvas?(_a=tensorOrCanvas,[3,4]):[3,2];case 2:return[4,tfjs_image_recognition_base_1.imageTensorToCanvas(tensorOrCanvas)];case 3:_a=_b.sent(),_b.label=4;case 4:canvas=_a,_b.label=5;case 5:return ctx=tfjs_image_recognition_base_1.getContext2dOrThrow(canvas),[2,(boxes=detections.map((function(det){return det instanceof FaceDetection_1.FaceDetection?det.forSize(canvas.width,canvas.height).box.floor():det})).map((function(box){return box.clipAtImageBorders(canvas.width,canvas.height)}))).map((function(_a){var x=_a.x,y=_a.y,width=_a.width,height=_a.height,faceImg=tfjs_image_recognition_base_1.createCanvas({width:width,height:height});return tfjs_image_recognition_base_1.getContext2dOrThrow(faceImg).putImageData(ctx.getImageData(x,y,width,height),0,0),faceImg}))]}}))}))}exports.extractFaces=extractFaces},{"../classes/FaceDetection":272,"tfjs-image-recognition-base":568,tslib:588}],284:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib");tslib_1.__exportStar(require("./extractFaces"),exports),tslib_1.__exportStar(require("./extractFaceTensors"),exports)},{"./extractFaceTensors":282,"./extractFaces":283,tslib:588}],285:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tfjs_image_recognition_base_1=require("tfjs-image-recognition-base"),FaceLandmarks_1=require("../classes/FaceLandmarks"),FaceLandmarks68_1=require("../classes/FaceLandmarks68"),WithFaceLandmarks_1=require("../factories/WithFaceLandmarks"),drawContour_1=require("./drawContour"),DrawFaceLandmarksOptions=function(){function DrawFaceLandmarksOptions(options){void 0===options&&(options={});var _a=options.drawLines,drawLines=void 0===_a||_a,_b=options.drawPoints,drawPoints=void 0===_b||_b,lineWidth=options.lineWidth,lineColor=options.lineColor,pointSize=options.pointSize,pointColor=options.pointColor;this.drawLines=drawLines,this.drawPoints=drawPoints,this.lineWidth=lineWidth||1,this.pointSize=pointSize||2,this.lineColor=lineColor||"rgba(0, 255, 255, 1)",this.pointColor=pointColor||"rgba(255, 0, 255, 1)"}return DrawFaceLandmarksOptions}();exports.DrawFaceLandmarksOptions=DrawFaceLandmarksOptions;var DrawFaceLandmarks=function(){function DrawFaceLandmarks(faceLandmarks,options){void 0===options&&(options={}),this.faceLandmarks=faceLandmarks,this.options=new DrawFaceLandmarksOptions(options)}return DrawFaceLandmarks.prototype.draw=function(canvasArg){var ctx=tfjs_image_recognition_base_1.getContext2dOrThrow(canvasArg),_a=this.options,drawLines=_a.drawLines,drawPoints=_a.drawPoints,lineWidth=_a.lineWidth,lineColor=_a.lineColor,pointSize=_a.pointSize,pointColor=_a.pointColor;if(drawLines&&this.faceLandmarks instanceof FaceLandmarks68_1.FaceLandmarks68&&(ctx.strokeStyle=lineColor,ctx.lineWidth=lineWidth,drawContour_1.drawContour(ctx,this.faceLandmarks.getJawOutline()),drawContour_1.drawContour(ctx,this.faceLandmarks.getLeftEyeBrow()),drawContour_1.drawContour(ctx,this.faceLandmarks.getRightEyeBrow()),drawContour_1.drawContour(ctx,this.faceLandmarks.getNose()),drawContour_1.drawContour(ctx,this.faceLandmarks.getLeftEye(),!0),drawContour_1.drawContour(ctx,this.faceLandmarks.getRightEye(),!0),drawContour_1.drawContour(ctx,this.faceLandmarks.getMouth(),!0)),drawPoints){ctx.strokeStyle=pointColor,ctx.fillStyle=pointColor;var drawPoint=function(pt){ctx.beginPath(),ctx.arc(pt.x,pt.y,pointSize,0,2*Math.PI),ctx.fill()};this.faceLandmarks.positions.forEach(drawPoint)}},DrawFaceLandmarks}();function drawFaceLandmarks(canvasArg,faceLandmarks){var faceLandmarksArray;(Array.isArray(faceLandmarks)?faceLandmarks:[faceLandmarks]).forEach((function(f){var landmarks=f instanceof FaceLandmarks_1.FaceLandmarks?f:WithFaceLandmarks_1.isWithFaceLandmarks(f)?f.landmarks:void 0;if(!landmarks)throw new Error("drawFaceLandmarks - expected faceExpressions to be FaceLandmarks | WithFaceLandmarks<WithFaceDetection<{}>> or array thereof");new DrawFaceLandmarks(landmarks).draw(canvasArg)}))}exports.DrawFaceLandmarks=DrawFaceLandmarks,exports.drawFaceLandmarks=drawFaceLandmarks},{"../classes/FaceLandmarks":273,"../classes/FaceLandmarks68":275,"../factories/WithFaceLandmarks":322,"./drawContour":286,"tfjs-image-recognition-base":568}],286:[function(require,module,exports){"use strict";function drawContour(ctx,points,isClosed){if(void 0===isClosed&&(isClosed=!1),ctx.beginPath(),points.slice(1).forEach((function(_a,prevIdx){var x=_a.x,y=_a.y,from=points[prevIdx];ctx.moveTo(from.x,from.y),ctx.lineTo(x,y)})),isClosed){var from=points[points.length-1],to=points[0];if(!from||!to)return;ctx.moveTo(from.x,from.y),ctx.lineTo(to.x,to.y)}ctx.stroke()}Object.defineProperty(exports,"__esModule",{value:!0}),exports.drawContour=drawContour},{}],287:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tfjs_image_recognition_base_1=require("tfjs-image-recognition-base"),FaceDetection_1=require("../classes/FaceDetection"),WithFaceDetection_1=require("../factories/WithFaceDetection");function drawDetections(canvasArg,detections){var detectionsArray;(Array.isArray(detections)?detections:[detections]).forEach((function(det){var score=det instanceof FaceDetection_1.FaceDetection?det.score:WithFaceDetection_1.isWithFaceDetection(det)?det.detection.score:void 0,box=det instanceof FaceDetection_1.FaceDetection?det.box:WithFaceDetection_1.isWithFaceDetection(det)?det.detection.box:new tfjs_image_recognition_base_1.Box(det),label=score?""+tfjs_image_recognition_base_1.round(score):void 0;new tfjs_image_recognition_base_1.draw.DrawBox(box,{label:label}).draw(canvasArg)}))}exports.drawDetections=drawDetections},{"../classes/FaceDetection":272,"../factories/WithFaceDetection":320,"tfjs-image-recognition-base":568}],288:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tfjs_image_recognition_base_1=require("tfjs-image-recognition-base"),faceExpressionNet_1=require("../faceExpressionNet"),WithFaceDetection_1=require("../factories/WithFaceDetection"),WithFaceExpressions_1=require("../factories/WithFaceExpressions");function drawFaceExpressions(canvasArg,faceExpressions,minConfidence,textFieldAnchor){var faceExpressionsArray;void 0===minConfidence&&(minConfidence=.1),(Array.isArray(faceExpressions)?faceExpressions:[faceExpressions]).forEach((function(e){var expr=e instanceof faceExpressionNet_1.FaceExpressions?e:WithFaceExpressions_1.isWithFaceExpressions(e)?e.expressions:void 0;if(!expr)throw new Error("drawFaceExpressions - expected faceExpressions to be FaceExpressions | WithFaceExpressions<{}> or array thereof");var sorted,resultsToDisplay=expr.asSortedArray().filter((function(expr){return expr.probability>minConfidence})),anchor=WithFaceDetection_1.isWithFaceDetection(e)?e.detection.box.bottomLeft:textFieldAnchor||new tfjs_image_recognition_base_1.Point(0,0),drawTextField;new tfjs_image_recognition_base_1.draw.DrawTextField(resultsToDisplay.map((function(expr){return expr.expression+" ("+tfjs_image_recognition_base_1.round(expr.probability)+")"})),anchor).draw(canvasArg)}))}exports.drawFaceExpressions=drawFaceExpressions},{"../faceExpressionNet":293,"../factories/WithFaceDetection":320,"../factories/WithFaceExpressions":321,"tfjs-image-recognition-base":568}],289:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib");tslib_1.__exportStar(require("./drawContour"),exports),tslib_1.__exportStar(require("./drawDetections"),exports),tslib_1.__exportStar(require("./drawFaceExpressions"),exports),tslib_1.__exportStar(require("./DrawFaceLandmarks"),exports)},{"./DrawFaceLandmarks":285,"./drawContour":286,"./drawDetections":287,"./drawFaceExpressions":288,tslib:588}],290:[function(require,module,exports){"use strict";function euclideanDistance(arr1,arr2){if(arr1.length!==arr2.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var desc1=Array.from(arr1),desc2=Array.from(arr2);return Math.sqrt(desc1.map((function(val,i){return val-desc2[i]})).reduce((function(res,diff){return res+Math.pow(diff,2)}),0))}Object.defineProperty(exports,"__esModule",{value:!0}),exports.euclideanDistance=euclideanDistance},{}],291:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),tf=require("@tensorflow/tfjs-core"),tfjs_image_recognition_base_1=require("tfjs-image-recognition-base"),FaceFeatureExtractor_1=require("../faceFeatureExtractor/FaceFeatureExtractor"),FaceProcessor_1=require("../faceProcessor/FaceProcessor"),FaceExpressions_1=require("./FaceExpressions"),FaceExpressionNet=function(_super){function FaceExpressionNet(faceFeatureExtractor){return void 0===faceFeatureExtractor&&(faceFeatureExtractor=new FaceFeatureExtractor_1.FaceFeatureExtractor),_super.call(this,"FaceExpressionNet",faceFeatureExtractor)||this}return tslib_1.__extends(FaceExpressionNet,_super),FaceExpressionNet.prototype.forwardInput=function(input){var _this=this;return tf.tidy((function(){return tf.softmax(_this.runNet(input))}))},FaceExpressionNet.prototype.forward=function(input){return tslib_1.__awaiter(this,void 0,void 0,(function(){var _a;return tslib_1.__generator(this,(function(_b){switch(_b.label){case 0:return _a=this.forwardInput,[4,tfjs_image_recognition_base_1.toNetInput(input)];case 1:return[2,_a.apply(this,[_b.sent()])]}}))}))},FaceExpressionNet.prototype.predictExpressions=function(input){return tslib_1.__awaiter(this,void 0,void 0,(function(){var netInput,out,probabilitesByBatch,predictionsByBatch,_this=this;return tslib_1.__generator(this,(function(_a){switch(_a.label){case 0:return[4,tfjs_image_recognition_base_1.toNetInput(input)];case 1:return netInput=_a.sent(),[4,this.forwardInput(netInput)];case 2:return out=_a.sent(),[4,Promise.all(tf.unstack(out).map((function(t){return tslib_1.__awaiter(_this,void 0,void 0,(function(){var data;return tslib_1.__generator(this,(function(_a){switch(_a.label){case 0:return[4,t.data()];case 1:return data=_a.sent(),t.dispose(),[2,data]}}))}))})))];case 3:return probabilitesByBatch=_a.sent(),out.dispose(),predictionsByBatch=probabilitesByBatch.map((function(probabilites){return new FaceExpressions_1.FaceExpressions(probabilites)})),[2,netInput.isBatchInput?predictionsByBatch:predictionsByBatch[0]]}}))}))},FaceExpressionNet.prototype.getDefaultModelName=function(){return"face_expression_model"},FaceExpressionNet.prototype.getClassifierChannelsIn=function(){return 256},FaceExpressionNet.prototype.getClassifierChannelsOut=function(){return 7},FaceExpressionNet}(FaceProcessor_1.FaceProcessor);exports.FaceExpressionNet=FaceExpressionNet},{"../faceFeatureExtractor/FaceFeatureExtractor":294,"../faceProcessor/FaceProcessor":307,"./FaceExpressions":292,"@tensorflow/tfjs-core":155,"tfjs-image-recognition-base":568,tslib:588}],292:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.FACE_EXPRESSION_LABELS=["neutral","happy","sad","angry","fearful","disgusted","surprised"];var FaceExpressions=function(){function FaceExpressions(probabilities){var _this=this;if(7!==probabilities.length)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+probabilities.length);exports.FACE_EXPRESSION_LABELS.forEach((function(expression,idx){_this[expression]=probabilities[idx]}))}return FaceExpressions.prototype.asSortedArray=function(){var _this=this;return exports.FACE_EXPRESSION_LABELS.map((function(expression){return{expression:expression,probability:_this[expression]}})).sort((function(e0,e1){return e1.probability-e0.probability}))},FaceExpressions}();exports.FaceExpressions=FaceExpressions},{}],293:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib");tslib_1.__exportStar(require("./FaceExpressionNet"),exports),tslib_1.__exportStar(require("./FaceExpressions"),exports)},{"./FaceExpressionNet":291,"./FaceExpressions":292,tslib:588}],294:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),tf=require("@tensorflow/tfjs-core"),tfjs_image_recognition_base_1=require("tfjs-image-recognition-base"),denseBlock_1=require("./denseBlock"),extractParams_1=require("./extractParams"),extractParamsFromWeigthMap_1=require("./extractParamsFromWeigthMap"),FaceFeatureExtractor=function(_super){function FaceFeatureExtractor(){return _super.call(this,"FaceFeatureExtractor")||this}return tslib_1.__extends(FaceFeatureExtractor,_super),FaceFeatureExtractor.prototype.forwardInput=function(input){var params=this.params;if(!params)throw new Error("FaceFeatureExtractor - load model before inference");return tf.tidy((function(){var batchTensor=input.toBatchTensor(112,!0),meanRgb=[122.782,117.001,104.298],normalized=tfjs_image_recognition_base_1.normalize(batchTensor,meanRgb).div(tf.scalar(255)),out=denseBlock_1.denseBlock4(normalized,params.dense0,!0);return out=denseBlock_1.denseBlock4(out,params.dense1),out=denseBlock_1.denseBlock4(out,params.dense2),out=denseBlock_1.denseBlock4(out,params.dense3),out=tf.avgPool(out,[7,7],[2,2],"valid")}))},FaceFeatureExtractor.prototype.forward=function(input){return tslib_1.__awaiter(this,void 0,void 0,(function(){var _a;return tslib_1.__generator(this,(function(_b){switch(_b.label){case 0:return _a=this.forwardInput,[4,tfjs_image_recognition_base_1.toNetInput(input)];case 1:return[2,_a.apply(this,[_b.sent()])]}}))}))},FaceFeatureExtractor.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},FaceFeatureExtractor.prototype.extractParamsFromWeigthMap=function(weightMap){return extractParamsFromWeigthMap_1.extractParamsFromWeigthMap(weightMap)},FaceFeatureExtractor.prototype.extractParams=function(weights){return extractParams_1.extractParams(weights)},FaceFeatureExtractor}(tfjs_image_recognition_base_1.NeuralNetwork);exports.FaceFeatureExtractor=FaceFeatureExtractor},{"./denseBlock":296,"./extractParams":297,"./extractParamsFromWeigthMap":298,"@tensorflow/tfjs-core":155,"tfjs-image-recognition-base":568,tslib:588}],295:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),tf=require("@tensorflow/tfjs-core"),tfjs_image_recognition_base_1=require("tfjs-image-recognition-base"),denseBlock_1=require("./denseBlock"),extractParamsFromWeigthMapTiny_1=require("./extractParamsFromWeigthMapTiny"),extractParamsTiny_1=require("./extractParamsTiny"),TinyFaceFeatureExtractor=function(_super){function TinyFaceFeatureExtractor(){return _super.call(this,"TinyFaceFeatureExtractor")||this}return tslib_1.__extends(TinyFaceFeatureExtractor,_super),TinyFaceFeatureExtractor.prototype.forwardInput=function(input){var params=this.params;if(!params)throw new Error("TinyFaceFeatureExtractor - load model before inference");return tf.tidy((function(){var batchTensor=input.toBatchTensor(112,!0),meanRgb=[122.782,117.001,104.298],normalized=tfjs_image_recognition_base_1.normalize(batchTensor,meanRgb).div(tf.scalar(255)),out=denseBlock_1.denseBlock3(normalized,params.dense0,!0);return out=denseBlock_1.denseBlock3(out,params.dense1),out=denseBlock_1.denseBlock3(out,params.dense2),out=tf.avgPool(out,[14,14],[2,2],"valid")}))},TinyFaceFeatureExtractor.prototype.forward=function(input){return tslib_1.__awaiter(this,void 0,void 0,(function(){var _a;return tslib_1.__generator(this,(function(_b){switch(_b.label){case 0:return _a=this.forwardInput,[4,tfjs_image_recognition_base_1.toNetInput(input)];case 1:return[2,_a.apply(this,[_b.sent()])]}}))}))},TinyFaceFeatureExtractor.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},TinyFaceFeatureExtractor.prototype.extractParamsFromWeigthMap=function(weightMap){return extractParamsFromWeigthMapTiny_1.extractParamsFromWeigthMapTiny(weightMap)},TinyFaceFeatureExtractor.prototype.extractParams=function(weights){return extractParamsTiny_1.extractParamsTiny(weights)},TinyFaceFeatureExtractor}(tfjs_image_recognition_base_1.NeuralNetwork);exports.TinyFaceFeatureExtractor=TinyFaceFeatureExtractor},{"./denseBlock":296,"./extractParamsFromWeigthMapTiny":299,"./extractParamsTiny":300,"@tensorflow/tfjs-core":155,"tfjs-image-recognition-base":568,tslib:588}],296:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tf=require("@tensorflow/tfjs-core"),depthwiseSeparableConv_1=require("../common/depthwiseSeparableConv");function denseBlock3(x,denseBlockParams,isFirstLayer){return void 0===isFirstLayer&&(isFirstLayer=!1),tf.tidy((function(){var out1=tf.relu(isFirstLayer?tf.add(tf.conv2d(x,denseBlockParams.conv0.filters,[2,2],"same"),denseBlockParams.conv0.bias):depthwiseSeparableConv_1.depthwiseSeparableConv(x,denseBlockParams.conv0,[2,2])),out2=depthwiseSeparableConv_1.depthwiseSeparableConv(out1,denseBlockParams.conv1,[1,1]),in3=tf.relu(tf.add(out1,out2)),out3=depthwiseSeparableConv_1.depthwiseSeparableConv(in3,denseBlockParams.conv2,[1,1]);return tf.relu(tf.add(out1,tf.add(out2,out3)))}))}function denseBlock4(x,denseBlockParams,isFirstLayer,isScaleDown){return void 0===isFirstLayer&&(isFirstLayer=!1),void 0===isScaleDown&&(isScaleDown=!0),tf.tidy((function(){var out1=tf.relu(isFirstLayer?tf.add(tf.conv2d(x,denseBlockParams.conv0.filters,isScaleDown?[2,2]:[1,1],"same"),denseBlockParams.conv0.bias):depthwiseSeparableConv_1.depthwiseSeparableConv(x,denseBlockParams.conv0,isScaleDown?[2,2]:[1,1])),out2=depthwiseSeparableConv_1.depthwiseSeparableConv(out1,denseBlockParams.conv1,[1,1]),in3=tf.relu(tf.add(out1,out2)),out3=depthwiseSeparableConv_1.depthwiseSeparableConv(in3,denseBlockParams.conv2,[1,1]),in4=tf.relu(tf.add(out1,tf.add(out2,out3))),out4=depthwiseSeparableConv_1.depthwiseSeparableConv(in4,denseBlockParams.conv3,[1,1]);return tf.relu(tf.add(out1,tf.add(out2,tf.add(out3,out4))))}))}exports.denseBlock3=denseBlock3,exports.denseBlock4=denseBlock4},{"../common/depthwiseSeparableConv":279,"@tensorflow/tfjs-core":155}],297:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var extractorsFactory_1=require("./extractorsFactory"),tfjs_image_recognition_base_1=require("tfjs-image-recognition-base");function extractParams(weights){var paramMappings=[],_a=tfjs_image_recognition_base_1.TfjsImageRecognitionBase.extractWeightsFactory(weights),extractWeights=_a.extractWeights,getRemainingWeights=_a.getRemainingWeights,extractDenseBlock4Params=extractorsFactory_1.extractorsFactory(extractWeights,paramMappings).extractDenseBlock4Params,dense0=extractDenseBlock4Params(3,32,"dense0",!0),dense1=extractDenseBlock4Params(32,64,"dense1"),dense2=extractDenseBlock4Params(64,128,"dense2"),dense3=extractDenseBlock4Params(128,256,"dense3");if(0!==getRemainingWeights().length)throw new Error("weights remaing after extract: "+getRemainingWeights().length);return{paramMappings:paramMappings,params:{dense0:dense0,dense1:dense1,dense2:dense2,dense3:dense3}}}exports.extractParams=extractParams},{"./extractorsFactory":301,"tfjs-image-recognition-base":568}],298:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tfjs_image_recognition_base_1=require("tfjs-image-recognition-base"),loadParamsFactory_1=require("./loadParamsFactory");function extractParamsFromWeigthMap(weightMap){var paramMappings=[],extractDenseBlock4Params=loadParamsFactory_1.loadParamsFactory(weightMap,paramMappings).extractDenseBlock4Params,params={dense0:extractDenseBlock4Params("dense0",!0),dense1:extractDenseBlock4Params("dense1"),dense2:extractDenseBlock4Params("dense2"),dense3:extractDenseBlock4Params("dense3")};return tfjs_image_recognition_base_1.TfjsImageRecognitionBase.disposeUnusedWeightTensors(weightMap,paramMappings),{params:params,paramMappings:paramMappings}}exports.extractParamsFromWeigthMap=extractParamsFromWeigthMap},{"./loadParamsFactory":302,"tfjs-image-recognition-base":568}],299:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tfjs_image_recognition_base_1=require("tfjs-image-recognition-base"),loadParamsFactory_1=require("./loadParamsFactory");function extractParamsFromWeigthMapTiny(weightMap){var paramMappings=[],extractDenseBlock3Params=loadParamsFactory_1.loadParamsFactory(weightMap,paramMappings).extractDenseBlock3Params,params={dense0:extractDenseBlock3Params("dense0",!0),dense1:extractDenseBlock3Params("dense1"),dense2:extractDenseBlock3Params("dense2")};return tfjs_image_recognition_base_1.TfjsImageRecognitionBase.disposeUnusedWeightTensors(weightMap,paramMappings),{params:params,paramMappings:paramMappings}}exports.extractParamsFromWeigthMapTiny=extractParamsFromWeigthMapTiny},{"./loadParamsFactory":302,"tfjs-image-recognition-base":568}],300:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tfjs_image_recognition_base_1=require("tfjs-image-recognition-base"),extractorsFactory_1=require("./extractorsFactory");function extractParamsTiny(weights){var paramMappings=[],_a=tfjs_image_recognition_base_1.TfjsImageRecognitionBase.extractWeightsFactory(weights),extractWeights=_a.extractWeights,getRemainingWeights=_a.getRemainingWeights,extractDenseBlock3Params=extractorsFactory_1.extractorsFactory(extractWeights,paramMappings).extractDenseBlock3Params,dense0=extractDenseBlock3Params(3,32,"dense0",!0),dense1=extractDenseBlock3Params(32,64,"dense1"),dense2=extractDenseBlock3Params(64,128,"dense2");if(0!==getRemainingWeights().length)throw new Error("weights remaing after extract: "+getRemainingWeights().length);return{paramMappings:paramMappings,params:{dense0:dense0,dense1:dense1,dense2:dense2}}}exports.extractParamsTiny=extractParamsTiny},{"./extractorsFactory":301,"tfjs-image-recognition-base":568}],301:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tfjs_image_recognition_base_1=require("tfjs-image-recognition-base");function extractorsFactory(extractWeights,paramMappings){var extractConvParams=tfjs_image_recognition_base_1.TfjsImageRecognitionBase.extractConvParamsFactory(extractWeights,paramMappings),extractSeparableConvParams=tfjs_image_recognition_base_1.TfjsImageRecognitionBase.extractSeparableConvParamsFactory(extractWeights,paramMappings);function extractDenseBlock3Params(channelsIn,channelsOut,mappedPrefix,isFirstLayer){var conv0,conv1,conv2;return void 0===isFirstLayer&&(isFirstLayer=!1),{conv0:isFirstLayer?extractConvParams(channelsIn,channelsOut,3,mappedPrefix+"/conv0"):extractSeparableConvParams(channelsIn,channelsOut,mappedPrefix+"/conv0"),conv1:extractSeparableConvParams(channelsOut,channelsOut,mappedPrefix+"/conv1"),conv2:extractSeparableConvParams(channelsOut,channelsOut,mappedPrefix+"/conv2")}}function extractDenseBlock4Params(channelsIn,channelsOut,mappedPrefix,isFirstLayer){void 0===isFirstLayer&&(isFirstLayer=!1);var _a=extractDenseBlock3Params(channelsIn,channelsOut,mappedPrefix,isFirstLayer),conv0,conv1,conv2,conv3;return{conv0:_a.conv0,conv1:_a.conv1,conv2:_a.conv2,conv3:extractSeparableConvParams(channelsOut,channelsOut,mappedPrefix+"/conv3")}}return{extractDenseBlock3Params:extractDenseBlock3Params,extractDenseBlock4Params:extractDenseBlock4Params}}exports.extractorsFactory=extractorsFactory},{"tfjs-image-recognition-base":568}],302:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tfjs_image_recognition_base_1=require("tfjs-image-recognition-base"),loadConvParamsFactory_1=require("../common/loadConvParamsFactory");function loadParamsFactory(weightMap,paramMappings){var extractWeightEntry=tfjs_image_recognition_base_1.TfjsImageRecognitionBase.extractWeightEntryFactory(weightMap,paramMappings),extractConvParams=loadConvParamsFactory_1.loadConvParamsFactory(extractWeightEntry),extractSeparableConvParams=tfjs_image_recognition_base_1.TfjsImageRecognitionBase.loadSeparableConvParamsFactory(extractWeightEntry);function extractDenseBlock3Params(prefix,isFirstLayer){var conv0,conv1,conv2;return void 0===isFirstLayer&&(isFirstLayer=!1),{conv0:isFirstLayer?extractConvParams(prefix+"/conv0"):extractSeparableConvParams(prefix+"/conv0"),conv1:extractSeparableConvParams(prefix+"/conv1"),conv2:extractSeparableConvParams(prefix+"/conv2")}}function extractDenseBlock4Params(prefix,isFirstLayer){var conv0,conv1,conv2,conv3;return void 0===isFirstLayer&&(isFirstLayer=!1),{conv0:isFirstLayer?extractConvParams(prefix+"/conv0"):extractSeparableConvParams(prefix+"/conv0"),conv1:extractSeparableConvParams(prefix+"/conv1"),conv2:extractSeparableConvParams(prefix+"/conv2"),conv3:extractSeparableConvParams(prefix+"/conv3")}}return{extractDenseBlock3Params:extractDenseBlock3Params,extractDenseBlock4Params:extractDenseBlock4Params}}exports.loadParamsFactory=loadParamsFactory},{"../common/loadConvParamsFactory":281,"tfjs-image-recognition-base":568}],303:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),FaceFeatureExtractor_1=require("../faceFeatureExtractor/FaceFeatureExtractor"),FaceLandmark68NetBase_1,FaceLandmark68Net=function(_super){function FaceLandmark68Net(faceFeatureExtractor){return void 0===faceFeatureExtractor&&(faceFeatureExtractor=new FaceFeatureExtractor_1.FaceFeatureExtractor),_super.call(this,"FaceLandmark68Net",faceFeatureExtractor)||this}return tslib_1.__extends(FaceLandmark68Net,_super),FaceLandmark68Net.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},FaceLandmark68Net.prototype.getClassifierChannelsIn=function(){return 256},FaceLandmark68Net}(require("./FaceLandmark68NetBase").FaceLandmark68NetBase);exports.FaceLandmark68Net=FaceLandmark68Net},{"../faceFeatureExtractor/FaceFeatureExtractor":294,"./FaceLandmark68NetBase":304,tslib:588}],304:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),tf=require("@tensorflow/tfjs-core"),tfjs_image_recognition_base_1=require("tfjs-image-recognition-base"),FaceLandmarks68_1=require("../classes/FaceLandmarks68"),FaceProcessor_1,FaceLandmark68NetBase=function(_super){function FaceLandmark68NetBase(){return null!==_super&&_super.apply(this,arguments)||this}return tslib_1.__extends(FaceLandmark68NetBase,_super),FaceLandmark68NetBase.prototype.postProcess=function(output,inputSize,originalDimensions){var inputDimensions=originalDimensions.map((function(_a){var width=_a.width,height=_a.height,scale=inputSize/Math.max(height,width);return{width:width*scale,height:height*scale}})),batchSize=inputDimensions.length;return tf.tidy((function(){var createInterleavedTensor=function(fillX,fillY){return tf.stack([tf.fill([68],fillX),tf.fill([68],fillY)],1).as2D(1,136).as1D()},getPadding=function(batchIdx,cond){var _a=inputDimensions[batchIdx],width=_a.width,height=_a.height;return cond(width,height)?Math.abs(width-height)/2:0},getPaddingX=function(batchIdx){return getPadding(batchIdx,(function(w,h){return w<h}))},getPaddingY=function(batchIdx){return getPadding(batchIdx,(function(w,h){return h<w}))},landmarkTensors;return output.mul(tf.fill([batchSize,136],inputSize)).sub(tf.stack(Array.from(Array(batchSize),(function(_,batchIdx){return createInterleavedTensor(getPaddingX(batchIdx),getPaddingY(batchIdx))})))).div(tf.stack(Array.from(Array(batchSize),(function(_,batchIdx){return createInterleavedTensor(inputDimensions[batchIdx].width,inputDimensions[batchIdx].height)}))))}))},FaceLandmark68NetBase.prototype.forwardInput=function(input){var _this=this;return tf.tidy((function(){var out=_this.runNet(input);return _this.postProcess(out,input.inputSize,input.inputDimensions.map((function(_a){var height,width;return{height:_a[0],width:_a[1]}})))}))},FaceLandmark68NetBase.prototype.forward=function(input){return tslib_1.__awaiter(this,void 0,void 0,(function(){var _a;return tslib_1.__generator(this,(function(_b){switch(_b.label){case 0:return _a=this.forwardInput,[4,tfjs_image_recognition_base_1.toNetInput(input)];case 1:return[2,_a.apply(this,[_b.sent()])]}}))}))},FaceLandmark68NetBase.prototype.detectLandmarks=function(input){return tslib_1.__awaiter(this,void 0,void 0,(function(){var netInput,landmarkTensors,landmarksForBatch,_this=this;return tslib_1.__generator(this,(function(_a){switch(_a.label){case 0:return[4,tfjs_image_recognition_base_1.toNetInput(input)];case 1:return netInput=_a.sent(),landmarkTensors=tf.tidy((function(){return tf.unstack(_this.forwardInput(netInput))})),[4,Promise.all(landmarkTensors.map((function(landmarkTensor,batchIdx){return tslib_1.__awaiter(_this,void 0,void 0,(function(){var landmarksArray,_a,_b,xCoords,yCoords;return tslib_1.__generator(this,(function(_c){switch(_c.label){case 0:return _b=(_a=Array).from,[4,landmarkTensor.data()];case 1:return landmarksArray=_b.apply(_a,[_c.sent()]),xCoords=landmarksArray.filter((function(_,i){return tfjs_image_recognition_base_1.isEven(i)})),yCoords=landmarksArray.filter((function(_,i){return!tfjs_image_recognition_base_1.isEven(i)})),[2,new FaceLandmarks68_1.FaceLandmarks68(Array(68).fill(0).map((function(_,i){return new tfjs_image_recognition_base_1.Point(xCoords[i],yCoords[i])})),{height:netInput.getInputHeight(batchIdx),width:netInput.getInputWidth(batchIdx)})]}}))}))})))];case 2:return landmarksForBatch=_a.sent(),landmarkTensors.forEach((function(t){return t.dispose()})),[2,netInput.isBatchInput?landmarksForBatch:landmarksForBatch[0]]}}))}))},FaceLandmark68NetBase.prototype.getClassifierChannelsOut=function(){return 136},FaceLandmark68NetBase}(require("../faceProcessor/FaceProcessor").FaceProcessor);exports.FaceLandmark68NetBase=FaceLandmark68NetBase},{"../classes/FaceLandmarks68":275,"../faceProcessor/FaceProcessor":307,"@tensorflow/tfjs-core":155,"tfjs-image-recognition-base":568,tslib:588}],305:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),TinyFaceFeatureExtractor_1=require("../faceFeatureExtractor/TinyFaceFeatureExtractor"),FaceLandmark68NetBase_1,FaceLandmark68TinyNet=function(_super){function FaceLandmark68TinyNet(faceFeatureExtractor){return void 0===faceFeatureExtractor&&(faceFeatureExtractor=new TinyFaceFeatureExtractor_1.TinyFaceFeatureExtractor),_super.call(this,"FaceLandmark68TinyNet",faceFeatureExtractor)||this}return tslib_1.__extends(FaceLandmark68TinyNet,_super),FaceLandmark68TinyNet.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},FaceLandmark68TinyNet.prototype.getClassifierChannelsIn=function(){return 128},FaceLandmark68TinyNet}(require("./FaceLandmark68NetBase").FaceLandmark68NetBase);exports.FaceLandmark68TinyNet=FaceLandmark68TinyNet},{"../faceFeatureExtractor/TinyFaceFeatureExtractor":295,"./FaceLandmark68NetBase":304,tslib:588}],306:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),FaceLandmark68Net_1=require("./FaceLandmark68Net");tslib_1.__exportStar(require("./FaceLandmark68Net"),exports),tslib_1.__exportStar(require("./FaceLandmark68TinyNet"),exports);var FaceLandmarkNet=function(_super){function FaceLandmarkNet(){return null!==_super&&_super.apply(this,arguments)||this}return tslib_1.__extends(FaceLandmarkNet,_super),FaceLandmarkNet}(FaceLandmark68Net_1.FaceLandmark68Net);exports.FaceLandmarkNet=FaceLandmarkNet},{"./FaceLandmark68Net":303,"./FaceLandmark68TinyNet":305,tslib:588}],307:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),tf=require("@tensorflow/tfjs-core"),tfjs_image_recognition_base_1=require("tfjs-image-recognition-base"),fullyConnectedLayer_1=require("../common/fullyConnectedLayer"),extractParams_1=require("./extractParams"),extractParamsFromWeigthMap_1=require("./extractParamsFromWeigthMap"),util_1=require("./util"),FaceProcessor=function(_super){function FaceProcessor(_name,faceFeatureExtractor){var _this=_super.call(this,_name)||this;return _this._faceFeatureExtractor=faceFeatureExtractor,_this}return tslib_1.__extends(FaceProcessor,_super),Object.defineProperty(FaceProcessor.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),FaceProcessor.prototype.runNet=function(input){var _this=this,params=this.params;if(!params)throw new Error(this._name+" - load model before inference");return tf.tidy((function(){var bottleneckFeatures=input instanceof tfjs_image_recognition_base_1.NetInput?_this.faceFeatureExtractor.forwardInput(input):input;return fullyConnectedLayer_1.fullyConnectedLayer(bottleneckFeatures.as2D(bottleneckFeatures.shape[0],-1),params.fc)}))},FaceProcessor.prototype.dispose=function(throwOnRedispose){void 0===throwOnRedispose&&(throwOnRedispose=!0),this.faceFeatureExtractor.dispose(throwOnRedispose),_super.prototype.dispose.call(this,throwOnRedispose)},FaceProcessor.prototype.loadClassifierParams=function(weights){var _a=this.extractClassifierParams(weights),params=_a.params,paramMappings=_a.paramMappings;this._params=params,this._paramMappings=paramMappings},FaceProcessor.prototype.extractClassifierParams=function(weights){return extractParams_1.extractParams(weights,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},FaceProcessor.prototype.extractParamsFromWeigthMap=function(weightMap){var _a=util_1.seperateWeightMaps(weightMap),featureExtractorMap=_a.featureExtractorMap,classifierMap=_a.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(featureExtractorMap),extractParamsFromWeigthMap_1.extractParamsFromWeigthMap(classifierMap)},FaceProcessor.prototype.extractParams=function(weights){var cIn=this.getClassifierChannelsIn(),cOut=this.getClassifierChannelsOut(),classifierWeightSize=cOut*cIn+cOut,featureExtractorWeights=weights.slice(0,weights.length-classifierWeightSize),classifierWeights=weights.slice(weights.length-classifierWeightSize);return this.faceFeatureExtractor.extractWeights(featureExtractorWeights),this.extractClassifierParams(classifierWeights)},FaceProcessor}(tfjs_image_recognition_base_1.NeuralNetwork);exports.FaceProcessor=FaceProcessor},{"../common/fullyConnectedLayer":280,"./extractParams":308,"./extractParamsFromWeigthMap":309,"./util":310,"@tensorflow/tfjs-core":155,"tfjs-image-recognition-base":568,tslib:588}],308:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tfjs_image_recognition_base_1=require("tfjs-image-recognition-base");function extractParams(weights,channelsIn,channelsOut){var paramMappings=[],_a=tfjs_image_recognition_base_1.TfjsImageRecognitionBase.extractWeightsFactory(weights),extractWeights=_a.extractWeights,getRemainingWeights=_a.getRemainingWeights,extractFCParams,fc=tfjs_image_recognition_base_1.TfjsImageRecognitionBase.extractFCParamsFactory(extractWeights,paramMappings)(channelsIn,channelsOut,"fc");if(0!==getRemainingWeights().length)throw new Error("weights remaing after extract: "+getRemainingWeights().length);return{paramMappings:paramMappings,params:{fc:fc}}}exports.extractParams=extractParams},{"tfjs-image-recognition-base":568}],309:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tfjs_image_recognition_base_1=require("tfjs-image-recognition-base");function extractParamsFromWeigthMap(weightMap){var paramMappings=[],extractWeightEntry=tfjs_image_recognition_base_1.TfjsImageRecognitionBase.extractWeightEntryFactory(weightMap,paramMappings);function extractFcParams(prefix){var weights,bias;return{weights:extractWeightEntry(prefix+"/weights",2),bias:extractWeightEntry(prefix+"/bias",1)}}var params={fc:extractFcParams("fc")};return tfjs_image_recognition_base_1.TfjsImageRecognitionBase.disposeUnusedWeightTensors(weightMap,paramMappings),{params:params,paramMappings:paramMappings}}exports.extractParamsFromWeigthMap=extractParamsFromWeigthMap},{"tfjs-image-recognition-base":568}],310:[function(require,module,exports){"use strict";function seperateWeightMaps(weightMap){var featureExtractorMap={},classifierMap={};return Object.keys(weightMap).forEach((function(key){var map;(key.startsWith("fc")?classifierMap:featureExtractorMap)[key]=weightMap[key]})),{featureExtractorMap:featureExtractorMap,classifierMap:classifierMap}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.seperateWeightMaps=seperateWeightMaps},{}],311:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),tf=require("@tensorflow/tfjs-core"),tfjs_image_recognition_base_1=require("tfjs-image-recognition-base"),convLayer_1=require("./convLayer"),extractParams_1=require("./extractParams"),extractParamsFromWeigthMap_1=require("./extractParamsFromWeigthMap"),residualLayer_1=require("./residualLayer"),FaceRecognitionNet=function(_super){function FaceRecognitionNet(){return _super.call(this,"FaceRecognitionNet")||this}return tslib_1.__extends(FaceRecognitionNet,_super),FaceRecognitionNet.prototype.forwardInput=function(input){var params=this.params;if(!params)throw new Error("FaceRecognitionNet - load model before inference");return tf.tidy((function(){var batchTensor=input.toBatchTensor(150,!0).toFloat(),meanRgb=[122.782,117.001,104.298],normalized=tfjs_image_recognition_base_1.normalize(batchTensor,meanRgb).div(tf.scalar(256)),out=convLayer_1.convDown(normalized,params.conv32_down);out=tf.maxPool(out,3,2,"valid"),out=residualLayer_1.residual(out,params.conv32_1),out=residualLayer_1.residual(out,params.conv32_2),out=residualLayer_1.residual(out,params.conv32_3),out=residualLayer_1.residualDown(out,params.conv64_down),out=residualLayer_1.residual(out,params.conv64_1),out=residualLayer_1.residual(out,params.conv64_2),out=residualLayer_1.residual(out,params.conv64_3),out=residualLayer_1.residualDown(out,params.conv128_down),out=residualLayer_1.residual(out,params.conv128_1),out=residualLayer_1.residual(out,params.conv128_2),out=residualLayer_1.residualDown(out,params.conv256_down),out=residualLayer_1.residual(out,params.conv256_1),out=residualLayer_1.residual(out,params.conv256_2);var globalAvg=(out=residualLayer_1.residualDown(out,params.conv256_down_out)).mean([1,2]),fullyConnected;return tf.matMul(globalAvg,params.fc)}))},FaceRecognitionNet.prototype.forward=function(input){return tslib_1.__awaiter(this,void 0,void 0,(function(){var _a;return tslib_1.__generator(this,(function(_b){switch(_b.label){case 0:return _a=this.forwardInput,[4,tfjs_image_recognition_base_1.toNetInput(input)];case 1:return[2,_a.apply(this,[_b.sent()])]}}))}))},FaceRecognitionNet.prototype.computeFaceDescriptor=function(input){return tslib_1.__awaiter(this,void 0,void 0,(function(){var netInput,faceDescriptorTensors,faceDescriptorsForBatch,_this=this;return tslib_1.__generator(this,(function(_a){switch(_a.label){case 0:return[4,tfjs_image_recognition_base_1.toNetInput(input)];case 1:return netInput=_a.sent(),faceDescriptorTensors=tf.tidy((function(){return tf.unstack(_this.forwardInput(netInput))})),[4,Promise.all(faceDescriptorTensors.map((function(t){return t.data()})))];case 2:return faceDescriptorsForBatch=_a.sent(),faceDescriptorTensors.forEach((function(t){return t.dispose()})),[2,netInput.isBatchInput?faceDescriptorsForBatch:faceDescriptorsForBatch[0]]}}))}))},FaceRecognitionNet.prototype.getDefaultModelName=function(){return"face_recognition_model"},FaceRecognitionNet.prototype.extractParamsFromWeigthMap=function(weightMap){return extractParamsFromWeigthMap_1.extractParamsFromWeigthMap(weightMap)},FaceRecognitionNet.prototype.extractParams=function(weights){return extractParams_1.extractParams(weights)},FaceRecognitionNet}(tfjs_image_recognition_base_1.NeuralNetwork);exports.FaceRecognitionNet=FaceRecognitionNet},{"./convLayer":312,"./extractParams":313,"./extractParamsFromWeigthMap":314,"./residualLayer":316,"@tensorflow/tfjs-core":155,"tfjs-image-recognition-base":568,tslib:588}],312:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tf=require("@tensorflow/tfjs-core"),scaleLayer_1=require("./scaleLayer");function convLayer(x,params,strides,withRelu,padding){void 0===padding&&(padding="same");var _a=params.conv,filters=_a.filters,bias=_a.bias,out=tf.conv2d(x,filters,strides,padding);return out=tf.add(out,bias),out=scaleLayer_1.scale(out,params.scale),withRelu?tf.relu(out):out}function conv(x,params){return convLayer(x,params,[1,1],!0)}function convNoRelu(x,params){return convLayer(x,params,[1,1],!1)}function convDown(x,params){return convLayer(x,params,[2,2],!0,"valid")}exports.conv=conv,exports.convNoRelu=convNoRelu,exports.convDown=convDown},{"./scaleLayer":317,"@tensorflow/tfjs-core":155}],313:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tf=require("@tensorflow/tfjs-core"),tfjs_image_recognition_base_1=require("tfjs-image-recognition-base");function extractorsFactory(extractWeights,paramMappings){function extractFilterValues(numFilterValues,numFilters,filterSize){var weights=extractWeights(numFilterValues),depth=weights.length/(numFilters*filterSize*filterSize);if(tfjs_image_recognition_base_1.isFloat(depth))throw new Error("depth has to be an integer: "+depth+", weights.length: "+weights.length+", numFilters: "+numFilters+", filterSize: "+filterSize);return tf.tidy((function(){return tf.transpose(tf.tensor4d(weights,[numFilters,depth,filterSize,filterSize]),[2,3,1,0])}))}function extractConvParams(numFilterValues,numFilters,filterSize,mappedPrefix){var filters=extractFilterValues(numFilterValues,numFilters,filterSize),bias=tf.tensor1d(extractWeights(numFilters));return paramMappings.push({paramPath:mappedPrefix+"/filters"},{paramPath:mappedPrefix+"/bias"}),{filters:filters,bias:bias}}function extractScaleLayerParams(numWeights,mappedPrefix){var weights=tf.tensor1d(extractWeights(numWeights)),biases=tf.tensor1d(extractWeights(numWeights));return paramMappings.push({paramPath:mappedPrefix+"/weights"},{paramPath:mappedPrefix+"/biases"}),{weights:weights,biases:biases}}function extractConvLayerParams(numFilterValues,numFilters,filterSize,mappedPrefix){var conv,scale;return{conv:extractConvParams(numFilterValues,numFilters,filterSize,mappedPrefix+"/conv"),scale:extractScaleLayerParams(numFilters,mappedPrefix+"/scale")}}function extractResidualLayerParams(numFilterValues,numFilters,filterSize,mappedPrefix,isDown){var conv1,conv2;return void 0===isDown&&(isDown=!1),{conv1:extractConvLayerParams((isDown?.5:1)*numFilterValues,numFilters,filterSize,mappedPrefix+"/conv1"),conv2:extractConvLayerParams(numFilterValues,numFilters,filterSize,mappedPrefix+"/conv2")}}return{extractConvLayerParams:extractConvLayerParams,extractResidualLayerParams:extractResidualLayerParams}}function extractParams(weights){var _a=tfjs_image_recognition_base_1.TfjsImageRecognitionBase.extractWeightsFactory(weights),extractWeights=_a.extractWeights,getRemainingWeights=_a.getRemainingWeights,paramMappings=[],_b=extractorsFactory(extractWeights,paramMappings),extractConvLayerParams=_b.extractConvLayerParams,extractResidualLayerParams=_b.extractResidualLayerParams,conv32_down=extractConvLayerParams(4704,32,7,"conv32_down"),conv32_1=extractResidualLayerParams(9216,32,3,"conv32_1"),conv32_2=extractResidualLayerParams(9216,32,3,"conv32_2"),conv32_3=extractResidualLayerParams(9216,32,3,"conv32_3"),conv64_down=extractResidualLayerParams(36864,64,3,"conv64_down",!0),conv64_1=extractResidualLayerParams(36864,64,3,"conv64_1"),conv64_2=extractResidualLayerParams(36864,64,3,"conv64_2"),conv64_3=extractResidualLayerParams(36864,64,3,"conv64_3"),conv128_down=extractResidualLayerParams(147456,128,3,"conv128_down",!0),conv128_1=extractResidualLayerParams(147456,128,3,"conv128_1"),conv128_2=extractResidualLayerParams(147456,128,3,"conv128_2"),conv256_down=extractResidualLayerParams(589824,256,3,"conv256_down",!0),conv256_1=extractResidualLayerParams(589824,256,3,"conv256_1"),conv256_2=extractResidualLayerParams(589824,256,3,"conv256_2"),conv256_down_out=extractResidualLayerParams(589824,256,3,"conv256_down_out"),fc=tf.tidy((function(){return tf.transpose(tf.tensor2d(extractWeights(32768),[128,256]),[1,0])})),params;if(paramMappings.push({paramPath:"fc"}),0!==getRemainingWeights().length)throw new Error("weights remaing after extract: "+getRemainingWeights().length);return{params:{conv32_down:conv32_down,conv32_1:conv32_1,conv32_2:conv32_2,conv32_3:conv32_3,conv64_down:conv64_down,conv64_1:conv64_1,conv64_2:conv64_2,conv64_3:conv64_3,conv128_down:conv128_down,conv128_1:conv128_1,conv128_2:conv128_2,conv256_down:conv256_down,conv256_1:conv256_1,conv256_2:conv256_2,conv256_down_out:conv256_down_out,fc:fc},paramMappings:paramMappings}}exports.extractParams=extractParams},{"@tensorflow/tfjs-core":155,"tfjs-image-recognition-base":568}],314:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tfjs_image_recognition_base_1=require("tfjs-image-recognition-base");function extractorsFactory(weightMap,paramMappings){var extractWeightEntry=tfjs_image_recognition_base_1.TfjsImageRecognitionBase.extractWeightEntryFactory(weightMap,paramMappings);function extractScaleLayerParams(prefix){var weights,biases;return{weights:extractWeightEntry(prefix+"/scale/weights",1),biases:extractWeightEntry(prefix+"/scale/biases",1)}}function extractConvLayerParams(prefix){var filters,bias,scale;return{conv:{filters:extractWeightEntry(prefix+"/conv/filters",4),bias:extractWeightEntry(prefix+"/conv/bias",1)},scale:extractScaleLayerParams(prefix)}}function extractResidualLayerParams(prefix){return{conv1:extractConvLayerParams(prefix+"/conv1"),conv2:extractConvLayerParams(prefix+"/conv2")}}return{extractConvLayerParams:extractConvLayerParams,extractResidualLayerParams:extractResidualLayerParams}}function extractParamsFromWeigthMap(weightMap){var paramMappings=[],_a=extractorsFactory(weightMap,paramMappings),extractConvLayerParams=_a.extractConvLayerParams,extractResidualLayerParams=_a.extractResidualLayerParams,conv32_down=extractConvLayerParams("conv32_down"),conv32_1=extractResidualLayerParams("conv32_1"),conv32_2=extractResidualLayerParams("conv32_2"),conv32_3=extractResidualLayerParams("conv32_3"),conv64_down=extractResidualLayerParams("conv64_down"),conv64_1=extractResidualLayerParams("conv64_1"),conv64_2=extractResidualLayerParams("conv64_2"),conv64_3=extractResidualLayerParams("conv64_3"),conv128_down=extractResidualLayerParams("conv128_down"),conv128_1=extractResidualLayerParams("conv128_1"),conv128_2=extractResidualLayerParams("conv128_2"),conv256_down=extractResidualLayerParams("conv256_down"),conv256_1=extractResidualLayerParams("conv256_1"),conv256_2=extractResidualLayerParams("conv256_2"),conv256_down_out=extractResidualLayerParams("conv256_down_out"),fc=weightMap.fc;if(paramMappings.push({originalPath:"fc",paramPath:"fc"}),!tfjs_image_recognition_base_1.isTensor2D(fc))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+fc);var params={conv32_down:conv32_down,conv32_1:conv32_1,conv32_2:conv32_2,conv32_3:conv32_3,conv64_down:conv64_down,conv64_1:conv64_1,conv64_2:conv64_2,conv64_3:conv64_3,conv128_down:conv128_down,conv128_1:conv128_1,conv128_2:conv128_2,conv256_down:conv256_down,conv256_1:conv256_1,conv256_2:conv256_2,conv256_down_out:conv256_down_out,fc:fc};return tfjs_image_recognition_base_1.TfjsImageRecognitionBase.disposeUnusedWeightTensors(weightMap,paramMappings),{params:params,paramMappings:paramMappings}}exports.extractParamsFromWeigthMap=extractParamsFromWeigthMap},{"tfjs-image-recognition-base":568}],315:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),FaceRecognitionNet_1=require("./FaceRecognitionNet");function createFaceRecognitionNet(weights){var net=new FaceRecognitionNet_1.FaceRecognitionNet;return net.extractWeights(weights),net}tslib_1.__exportStar(require("./FaceRecognitionNet"),exports),exports.createFaceRecognitionNet=createFaceRecognitionNet},{"./FaceRecognitionNet":311,tslib:588}],316:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),tf=require("@tensorflow/tfjs-core"),convLayer_1=require("./convLayer");function residual(x,params){var out=convLayer_1.conv(x,params.conv1);return out=convLayer_1.convNoRelu(out,params.conv2),out=tf.add(out,x),out=tf.relu(out)}function residualDown(x,params){var out=convLayer_1.convDown(x,params.conv1);out=convLayer_1.convNoRelu(out,params.conv2);var pooled=tf.avgPool(x,2,2,"valid"),zeros=tf.zeros(pooled.shape),isPad=pooled.shape[3]!==out.shape[3],isAdjustShape;if(pooled.shape[1]!==out.shape[1]||pooled.shape[2]!==out.shape[2]){var padShapeX=tslib_1.__spreadArrays(out.shape);padShapeX[1]=1;var zerosW=tf.zeros(padShapeX);out=tf.concat([out,zerosW],1);var padShapeY=tslib_1.__spreadArrays(out.shape);padShapeY[2]=1;var zerosH=tf.zeros(padShapeY);out=tf.concat([out,zerosH],2)}return pooled=isPad?tf.concat([pooled,zeros],3):pooled,out=tf.add(pooled,out),out=tf.relu(out)}exports.residual=residual,exports.residualDown=residualDown},{"./convLayer":312,"@tensorflow/tfjs-core":155,tslib:588}],317:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tf=require("@tensorflow/tfjs-core");function scale(x,params){return tf.add(tf.mul(x,params.weights),params.biases)}exports.scale=scale},{"@tensorflow/tfjs-core":155}],318:[function(require,module,exports){"use strict";function isWithAge(obj){return"number"==typeof obj.age}function extendWithAge(sourceObj,age){var extension={age:age};return Object.assign({},sourceObj,extension)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.isWithAge=isWithAge,exports.extendWithAge=extendWithAge},{}],319:[function(require,module,exports){"use strict";function extendWithFaceDescriptor(sourceObj,descriptor){var extension={descriptor:descriptor};return Object.assign({},sourceObj,extension)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.extendWithFaceDescriptor=extendWithFaceDescriptor},{}],320:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var FaceDetection_1=require("../classes/FaceDetection");function isWithFaceDetection(obj){return obj.detection instanceof FaceDetection_1.FaceDetection}function extendWithFaceDetection(sourceObj,detection){var extension={detection:detection};return Object.assign({},sourceObj,extension)}exports.isWithFaceDetection=isWithFaceDetection,exports.extendWithFaceDetection=extendWithFaceDetection},{"../classes/FaceDetection":272}],321:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var FaceExpressions_1=require("../faceExpressionNet/FaceExpressions");function isWithFaceExpressions(obj){return obj.expressions instanceof FaceExpressions_1.FaceExpressions}function extendWithFaceExpressions(sourceObj,expressions){var extension={expressions:expressions};return Object.assign({},sourceObj,extension)}exports.isWithFaceExpressions=isWithFaceExpressions,exports.extendWithFaceExpressions=extendWithFaceExpressions},{"../faceExpressionNet/FaceExpressions":292}],322:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var FaceDetection_1=require("../classes/FaceDetection"),FaceLandmarks_1=require("../classes/FaceLandmarks"),WithFaceDetection_1=require("./WithFaceDetection");function isWithFaceLandmarks(obj){return WithFaceDetection_1.isWithFaceDetection(obj)&&obj.landmarks instanceof FaceLandmarks_1.FaceLandmarks&&obj.unshiftedLandmarks instanceof FaceLandmarks_1.FaceLandmarks&&obj.alignedRect instanceof FaceDetection_1.FaceDetection}function extendWithFaceLandmarks(sourceObj,unshiftedLandmarks){var shift=sourceObj.detection.box,landmarks=unshiftedLandmarks.shiftBy(shift.x,shift.y),rect=landmarks.align(),imageDims=sourceObj.detection.imageDims,alignedRect,extension={landmarks:landmarks,unshiftedLandmarks:unshiftedLandmarks,alignedRect:new FaceDetection_1.FaceDetection(sourceObj.detection.score,rect.rescale(imageDims.reverse()),imageDims)};return Object.assign({},sourceObj,extension)}exports.isWithFaceLandmarks=isWithFaceLandmarks,exports.extendWithFaceLandmarks=extendWithFaceLandmarks},{"../classes/FaceDetection":272,"../classes/FaceLandmarks":273,"./WithFaceDetection":320}],323:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tfjs_image_recognition_base_1=require("tfjs-image-recognition-base"),types_1=require("../ageGenderNet/types");function isWithGender(obj){return(obj.gender===types_1.Gender.MALE||obj.gender===types_1.Gender.FEMALE)&&tfjs_image_recognition_base_1.isValidProbablitiy(obj.genderProbability)}function extendWithGender(sourceObj,gender,genderProbability){var extension={gender:gender,genderProbability:genderProbability};return Object.assign({},sourceObj,extension)}exports.isWithGender=isWithGender,exports.extendWithGender=extendWithGender},{"../ageGenderNet/types":271,"tfjs-image-recognition-base":568}],324:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib");tslib_1.__exportStar(require("./WithFaceDescriptor"),exports),tslib_1.__exportStar(require("./WithFaceDetection"),exports),tslib_1.__exportStar(require("./WithFaceExpressions"),exports),tslib_1.__exportStar(require("./WithFaceLandmarks"),exports),tslib_1.__exportStar(require("./WithAge"),exports),tslib_1.__exportStar(require("./WithGender"),exports)},{"./WithAge":318,"./WithFaceDescriptor":319,"./WithFaceDetection":320,"./WithFaceExpressions":321,"./WithFaceLandmarks":322,"./WithGender":323,tslib:588}],325:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),ComposableTask=function(){function ComposableTask(){}return ComposableTask.prototype.then=function(onfulfilled){return tslib_1.__awaiter(this,void 0,void 0,(function(){var _a;return tslib_1.__generator(this,(function(_b){switch(_b.label){case 0:return _a=onfulfilled,[4,this.run()];case 1:return[2,_a.apply(void 0,[_b.sent()])]}}))}))},ComposableTask.prototype.run=function(){return tslib_1.__awaiter(this,void 0,void 0,(function(){return tslib_1.__generator(this,(function(_a){throw new Error("ComposableTask - run is not implemented")}))}))},ComposableTask}();exports.ComposableTask=ComposableTask},{tslib:588}],326:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),WithFaceDescriptor_1=require("../factories/WithFaceDescriptor"),ComposableTask_1=require("./ComposableTask"),extractFacesAndComputeResults_1=require("./extractFacesAndComputeResults"),nets_1=require("./nets"),PredictAgeAndGenderTask_1=require("./PredictAgeAndGenderTask"),PredictFaceExpressionsTask_1=require("./PredictFaceExpressionsTask"),ComputeFaceDescriptorsTaskBase=function(_super){function ComputeFaceDescriptorsTaskBase(parentTask,input){var _this=_super.call(this)||this;return _this.parentTask=parentTask,_this.input=input,_this}return tslib_1.__extends(ComputeFaceDescriptorsTaskBase,_super),ComputeFaceDescriptorsTaskBase}(ComposableTask_1.ComposableTask);exports.ComputeFaceDescriptorsTaskBase=ComputeFaceDescriptorsTaskBase;var ComputeAllFaceDescriptorsTask=function(_super){function ComputeAllFaceDescriptorsTask(){return null!==_super&&_super.apply(this,arguments)||this}return tslib_1.__extends(ComputeAllFaceDescriptorsTask,_super),ComputeAllFaceDescriptorsTask.prototype.run=function(){return tslib_1.__awaiter(this,void 0,void 0,(function(){var parentResults,descriptors;return tslib_1.__generator(this,(function(_a){switch(_a.label){case 0:return[4,this.parentTask];case 1:return parentResults=_a.sent(),[4,extractFacesAndComputeResults_1.extractAllFacesAndComputeResults(parentResults,this.input,(function(faces){return Promise.all(faces.map((function(face){return nets_1.nets.faceRecognitionNet.computeFaceDescriptor(face)})))}),null,(function(parentResult){return parentResult.landmarks.align(null,{useDlibAlignment:!0})}))];case 2:return[2,(descriptors=_a.sent()).map((function(descriptor,i){return WithFaceDescriptor_1.extendWithFaceDescriptor(parentResults[i],descriptor)}))]}}))}))},ComputeAllFaceDescriptorsTask.prototype.withFaceExpressions=function(){return new PredictFaceExpressionsTask_1.PredictAllFaceExpressionsWithFaceAlignmentTask(this,this.input)},ComputeAllFaceDescriptorsTask.prototype.withAgeAndGender=function(){return new PredictAgeAndGenderTask_1.PredictAllAgeAndGenderWithFaceAlignmentTask(this,this.input)},ComputeAllFaceDescriptorsTask}(ComputeFaceDescriptorsTaskBase);exports.ComputeAllFaceDescriptorsTask=ComputeAllFaceDescriptorsTask;var ComputeSingleFaceDescriptorTask=function(_super){function ComputeSingleFaceDescriptorTask(){return null!==_super&&_super.apply(this,arguments)||this}return tslib_1.__extends(ComputeSingleFaceDescriptorTask,_super),ComputeSingleFaceDescriptorTask.prototype.run=function(){return tslib_1.__awaiter(this,void 0,void 0,(function(){var parentResult,descriptor;return tslib_1.__generator(this,(function(_a){switch(_a.label){case 0:return[4,this.parentTask];case 1:return(parentResult=_a.sent())?[4,extractFacesAndComputeResults_1.extractSingleFaceAndComputeResult(parentResult,this.input,(function(face){return nets_1.nets.faceRecognitionNet.computeFaceDescriptor(face)}),null,(function(parentResult){return parentResult.landmarks.align(null,{useDlibAlignment:!0})}))]:[2];case 2:return descriptor=_a.sent(),[2,WithFaceDescriptor_1.extendWithFaceDescriptor(parentResult,descriptor)]}}))}))},ComputeSingleFaceDescriptorTask.prototype.withFaceExpressions=function(){return new PredictFaceExpressionsTask_1.PredictSingleFaceExpressionsWithFaceAlignmentTask(this,this.input)},ComputeSingleFaceDescriptorTask.prototype.withAgeAndGender=function(){return new PredictAgeAndGenderTask_1.PredictSingleAgeAndGenderWithFaceAlignmentTask(this,this.input)},ComputeSingleFaceDescriptorTask}(ComputeFaceDescriptorsTaskBase);exports.ComputeSingleFaceDescriptorTask=ComputeSingleFaceDescriptorTask},{"../factories/WithFaceDescriptor":319,"./ComposableTask":325,"./PredictAgeAndGenderTask":330,"./PredictFaceExpressionsTask":331,"./extractFacesAndComputeResults":334,"./nets":336,tslib:588}],327:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),tf=require("@tensorflow/tfjs-core"),dom_1=require("../dom"),WithFaceLandmarks_1=require("../factories/WithFaceLandmarks"),ComposableTask_1=require("./ComposableTask"),ComputeFaceDescriptorsTasks_1=require("./ComputeFaceDescriptorsTasks"),nets_1=require("./nets"),PredictAgeAndGenderTask_1=require("./PredictAgeAndGenderTask"),PredictFaceExpressionsTask_1=require("./PredictFaceExpressionsTask"),DetectFaceLandmarksTaskBase=function(_super){function DetectFaceLandmarksTaskBase(parentTask,input,useTinyLandmarkNet){var _this=_super.call(this)||this;return _this.parentTask=parentTask,_this.input=input,_this.useTinyLandmarkNet=useTinyLandmarkNet,_this}return tslib_1.__extends(DetectFaceLandmarksTaskBase,_super),Object.defineProperty(DetectFaceLandmarksTaskBase.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?nets_1.nets.faceLandmark68TinyNet:nets_1.nets.faceLandmark68Net},enumerable:!0,configurable:!0}),DetectFaceLandmarksTaskBase}(ComposableTask_1.ComposableTask);exports.DetectFaceLandmarksTaskBase=DetectFaceLandmarksTaskBase;var DetectAllFaceLandmarksTask=function(_super){function DetectAllFaceLandmarksTask(){return null!==_super&&_super.apply(this,arguments)||this}return tslib_1.__extends(DetectAllFaceLandmarksTask,_super),DetectAllFaceLandmarksTask.prototype.run=function(){return tslib_1.__awaiter(this,void 0,void 0,(function(){var parentResults,detections,faces,_a,faceLandmarksByFace,_this=this;return tslib_1.__generator(this,(function(_b){switch(_b.label){case 0:return[4,this.parentTask];case 1:return parentResults=_b.sent(),detections=parentResults.map((function(res){return res.detection})),this.input instanceof tf.Tensor?[4,dom_1.extractFaceTensors(this.input,detections)]:[3,3];case 2:return _a=_b.sent(),[3,5];case 3:return[4,dom_1.extractFaces(this.input,detections)];case 4:_a=_b.sent(),_b.label=5;case 5:return faces=_a,[4,Promise.all(faces.map((function(face){return _this.landmarkNet.detectLandmarks(face)})))];case 6:return faceLandmarksByFace=_b.sent(),faces.forEach((function(f){return f instanceof tf.Tensor&&f.dispose()})),[2,parentResults.map((function(parentResult,i){return WithFaceLandmarks_1.extendWithFaceLandmarks(parentResult,faceLandmarksByFace[i])}))]}}))}))},DetectAllFaceLandmarksTask.prototype.withFaceExpressions=function(){return new PredictFaceExpressionsTask_1.PredictAllFaceExpressionsWithFaceAlignmentTask(this,this.input)},DetectAllFaceLandmarksTask.prototype.withAgeAndGender=function(){return new PredictAgeAndGenderTask_1.PredictAllAgeAndGenderWithFaceAlignmentTask(this,this.input)},DetectAllFaceLandmarksTask.prototype.withFaceDescriptors=function(){return new ComputeFaceDescriptorsTasks_1.ComputeAllFaceDescriptorsTask(this,this.input)},DetectAllFaceLandmarksTask}(DetectFaceLandmarksTaskBase);exports.DetectAllFaceLandmarksTask=DetectAllFaceLandmarksTask;var DetectSingleFaceLandmarksTask=function(_super){function DetectSingleFaceLandmarksTask(){return null!==_super&&_super.apply(this,arguments)||this}return tslib_1.__extends(DetectSingleFaceLandmarksTask,_super),DetectSingleFaceLandmarksTask.prototype.run=function(){return tslib_1.__awaiter(this,void 0,void 0,(function(){var parentResult,detection,faces,_a,landmarks;return tslib_1.__generator(this,(function(_b){switch(_b.label){case 0:return[4,this.parentTask];case 1:return(parentResult=_b.sent())?(detection=parentResult.detection,this.input instanceof tf.Tensor?[4,dom_1.extractFaceTensors(this.input,[detection])]:[3,3]):[2];case 2:return _a=_b.sent(),[3,5];case 3:return[4,dom_1.extractFaces(this.input,[detection])];case 4:_a=_b.sent(),_b.label=5;case 5:return faces=_a,[4,this.landmarkNet.detectLandmarks(faces[0])];case 6:return landmarks=_b.sent(),faces.forEach((function(f){return f instanceof tf.Tensor&&f.dispose()})),[2,WithFaceLandmarks_1.extendWithFaceLandmarks(parentResult,landmarks)]}}))}))},DetectSingleFaceLandmarksTask.prototype.withFaceExpressions=function(){return new PredictFaceExpressionsTask_1.PredictSingleFaceExpressionsWithFaceAlignmentTask(this,this.input)},DetectSingleFaceLandmarksTask.prototype.withAgeAndGender=function(){return new PredictAgeAndGenderTask_1.PredictSingleAgeAndGenderWithFaceAlignmentTask(this,this.input)},DetectSingleFaceLandmarksTask.prototype.withFaceDescriptor=function(){return new ComputeFaceDescriptorsTasks_1.ComputeSingleFaceDescriptorTask(this,this.input)},DetectSingleFaceLandmarksTask}(DetectFaceLandmarksTaskBase);exports.DetectSingleFaceLandmarksTask=DetectSingleFaceLandmarksTask},{"../dom":284,"../factories/WithFaceLandmarks":322,"./ComposableTask":325,"./ComputeFaceDescriptorsTasks":326,"./PredictAgeAndGenderTask":330,"./PredictFaceExpressionsTask":331,"./nets":336,"@tensorflow/tfjs-core":155,tslib:588}],328:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),tfjs_image_recognition_base_1=require("tfjs-image-recognition-base"),WithFaceDetection_1=require("../factories/WithFaceDetection"),MtcnnOptions_1=require("../mtcnn/MtcnnOptions"),SsdMobilenetv1Options_1=require("../ssdMobilenetv1/SsdMobilenetv1Options"),TinyFaceDetectorOptions_1=require("../tinyFaceDetector/TinyFaceDetectorOptions"),ComposableTask_1=require("./ComposableTask"),DetectFaceLandmarksTasks_1=require("./DetectFaceLandmarksTasks"),nets_1=require("./nets"),PredictAgeAndGenderTask_1=require("./PredictAgeAndGenderTask"),PredictFaceExpressionsTask_1=require("./PredictFaceExpressionsTask"),DetectFacesTaskBase=function(_super){function DetectFacesTaskBase(input,options){void 0===options&&(options=new SsdMobilenetv1Options_1.SsdMobilenetv1Options);var _this=_super.call(this)||this;return _this.input=input,_this.options=options,_this}return tslib_1.__extends(DetectFacesTaskBase,_super),DetectFacesTaskBase}(ComposableTask_1.ComposableTask);exports.DetectFacesTaskBase=DetectFacesTaskBase;var DetectAllFacesTask=function(_super){function DetectAllFacesTask(){return null!==_super&&_super.apply(this,arguments)||this}return tslib_1.__extends(DetectAllFacesTask,_super),DetectAllFacesTask.prototype.run=function(){return tslib_1.__awaiter(this,void 0,void 0,(function(){var _a,input,options,faceDetectionFunction;return tslib_1.__generator(this,(function(_b){switch(_b.label){case 0:return input=(_a=this).input,(options=_a.options)instanceof MtcnnOptions_1.MtcnnOptions?[4,nets_1.nets.mtcnn.forward(input,options)]:[3,2];case 1:return[2,_b.sent().map((function(result){return result.detection}))];case 2:if(!(faceDetectionFunction=options instanceof TinyFaceDetectorOptions_1.TinyFaceDetectorOptions?function(input){return nets_1.nets.tinyFaceDetector.locateFaces(input,options)}:options instanceof SsdMobilenetv1Options_1.SsdMobilenetv1Options?function(input){return nets_1.nets.ssdMobilenetv1.locateFaces(input,options)}:options instanceof tfjs_image_recognition_base_1.TfjsImageRecognitionBase.TinyYolov2Options?function(input){return nets_1.nets.tinyYolov2.locateFaces(input,options)}:null))throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,faceDetectionFunction(input)]}}))}))},DetectAllFacesTask.prototype.runAndExtendWithFaceDetections=function(){var _this=this;return new Promise((function(res){return tslib_1.__awaiter(_this,void 0,void 0,(function(){var detections;return tslib_1.__generator(this,(function(_a){switch(_a.label){case 0:return[4,this.run()];case 1:return detections=_a.sent(),[2,res(detections.map((function(detection){return WithFaceDetection_1.extendWithFaceDetection({},detection)})))]}}))}))}))},DetectAllFacesTask.prototype.withFaceLandmarks=function(useTinyLandmarkNet){return void 0===useTinyLandmarkNet&&(useTinyLandmarkNet=!1),new DetectFaceLandmarksTasks_1.DetectAllFaceLandmarksTask(this.runAndExtendWithFaceDetections(),this.input,useTinyLandmarkNet)},DetectAllFacesTask.prototype.withFaceExpressions=function(){return new PredictFaceExpressionsTask_1.PredictAllFaceExpressionsTask(this.runAndExtendWithFaceDetections(),this.input)},DetectAllFacesTask.prototype.withAgeAndGender=function(){return new PredictAgeAndGenderTask_1.PredictAllAgeAndGenderTask(this.runAndExtendWithFaceDetections(),this.input)},DetectAllFacesTask}(DetectFacesTaskBase);exports.DetectAllFacesTask=DetectAllFacesTask;var DetectSingleFaceTask=function(_super){function DetectSingleFaceTask(){return null!==_super&&_super.apply(this,arguments)||this}return tslib_1.__extends(DetectSingleFaceTask,_super),DetectSingleFaceTask.prototype.run=function(){return tslib_1.__awaiter(this,void 0,void 0,(function(){var faceDetections,faceDetectionWithHighestScore;return tslib_1.__generator(this,(function(_a){switch(_a.label){case 0:return[4,new DetectAllFacesTask(this.input,this.options)];case 1:return faceDetections=_a.sent(),faceDetectionWithHighestScore=faceDetections[0],faceDetections.forEach((function(faceDetection){faceDetection.score>faceDetectionWithHighestScore.score&&(faceDetectionWithHighestScore=faceDetection)})),[2,faceDetectionWithHighestScore]}}))}))},DetectSingleFaceTask.prototype.runAndExtendWithFaceDetection=function(){var _this=this;return new Promise((function(res){return tslib_1.__awaiter(_this,void 0,void 0,(function(){var detection;return tslib_1.__generator(this,(function(_a){switch(_a.label){case 0:return[4,this.run()];case 1:return detection=_a.sent(),[2,res(detection?WithFaceDetection_1.extendWithFaceDetection({},detection):void 0)]}}))}))}))},DetectSingleFaceTask.prototype.withFaceLandmarks=function(useTinyLandmarkNet){return void 0===useTinyLandmarkNet&&(useTinyLandmarkNet=!1),new DetectFaceLandmarksTasks_1.DetectSingleFaceLandmarksTask(this.runAndExtendWithFaceDetection(),this.input,useTinyLandmarkNet)},DetectSingleFaceTask.prototype.withFaceExpressions=function(){return new PredictFaceExpressionsTask_1.PredictSingleFaceExpressionsTask(this.runAndExtendWithFaceDetection(),this.input)},DetectSingleFaceTask.prototype.withAgeAndGender=function(){return new PredictAgeAndGenderTask_1.PredictSingleAgeAndGenderTask(this.runAndExtendWithFaceDetection(),this.input)},DetectSingleFaceTask}(DetectFacesTaskBase);exports.DetectSingleFaceTask=DetectSingleFaceTask},{"../factories/WithFaceDetection":320,"../mtcnn/MtcnnOptions":341,"../ssdMobilenetv1/SsdMobilenetv1Options":361,"../tinyFaceDetector/TinyFaceDetectorOptions":372,"./ComposableTask":325,"./DetectFaceLandmarksTasks":327,"./PredictAgeAndGenderTask":330,"./PredictFaceExpressionsTask":331,"./nets":336,"tfjs-image-recognition-base":568,tslib:588}],329:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var FaceMatch_1=require("../classes/FaceMatch"),LabeledFaceDescriptors_1=require("../classes/LabeledFaceDescriptors"),euclideanDistance_1=require("../euclideanDistance"),FaceMatcher=function(){function FaceMatcher(inputs,distanceThreshold){void 0===distanceThreshold&&(distanceThreshold=.6),this._distanceThreshold=distanceThreshold;var inputArray=Array.isArray(inputs)?inputs:[inputs];if(!inputArray.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var count=1,createUniqueLabel=function(){return"person "+count++};this._labeledDescriptors=inputArray.map((function(desc){if(desc instanceof LabeledFaceDescriptors_1.LabeledFaceDescriptors)return desc;if(desc instanceof Float32Array)return new LabeledFaceDescriptors_1.LabeledFaceDescriptors(createUniqueLabel(),[desc]);if(desc.descriptor&&desc.descriptor instanceof Float32Array)return new LabeledFaceDescriptors_1.LabeledFaceDescriptors(createUniqueLabel(),[desc.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")}))}return Object.defineProperty(FaceMatcher.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(FaceMatcher.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),FaceMatcher.prototype.computeMeanDistance=function(queryDescriptor,descriptors){return descriptors.map((function(d){return euclideanDistance_1.euclideanDistance(d,queryDescriptor)})).reduce((function(d1,d2){return d1+d2}),0)/(descriptors.length||1)},FaceMatcher.prototype.matchDescriptor=function(queryDescriptor){var _this=this;return this.labeledDescriptors.map((function(_a){var descriptors=_a.descriptors,label=_a.label;return new FaceMatch_1.FaceMatch(label,_this.computeMeanDistance(queryDescriptor,descriptors))})).reduce((function(best,curr){return best.distance<curr.distance?best:curr}))},FaceMatcher.prototype.findBestMatch=function(queryDescriptor){var bestMatch=this.matchDescriptor(queryDescriptor);return bestMatch.distance<this.distanceThreshold?bestMatch:new FaceMatch_1.FaceMatch("unknown",bestMatch.distance)},FaceMatcher.prototype.toJSON=function(){return{distanceThreshold:this.distanceThreshold,labeledDescriptors:this.labeledDescriptors.map((function(ld){return ld.toJSON()}))}},FaceMatcher.fromJSON=function(json){var labeledDescriptors;return new FaceMatcher(json.labeledDescriptors.map((function(ld){return LabeledFaceDescriptors_1.LabeledFaceDescriptors.fromJSON(ld)})),json.distanceThreshold)},FaceMatcher}();exports.FaceMatcher=FaceMatcher},{"../classes/FaceMatch":276,"../classes/LabeledFaceDescriptors":277,"../euclideanDistance":290}],330:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),WithAge_1=require("../factories/WithAge"),WithGender_1=require("../factories/WithGender"),ComposableTask_1=require("./ComposableTask"),ComputeFaceDescriptorsTasks_1=require("./ComputeFaceDescriptorsTasks"),extractFacesAndComputeResults_1=require("./extractFacesAndComputeResults"),nets_1=require("./nets"),PredictFaceExpressionsTask_1=require("./PredictFaceExpressionsTask"),PredictAgeAndGenderTaskBase=function(_super){function PredictAgeAndGenderTaskBase(parentTask,input,extractedFaces){var _this=_super.call(this)||this;return _this.parentTask=parentTask,_this.input=input,_this.extractedFaces=extractedFaces,_this}return tslib_1.__extends(PredictAgeAndGenderTaskBase,_super),PredictAgeAndGenderTaskBase}(ComposableTask_1.ComposableTask);exports.PredictAgeAndGenderTaskBase=PredictAgeAndGenderTaskBase;var PredictAllAgeAndGenderTask=function(_super){function PredictAllAgeAndGenderTask(){return null!==_super&&_super.apply(this,arguments)||this}return tslib_1.__extends(PredictAllAgeAndGenderTask,_super),PredictAllAgeAndGenderTask.prototype.run=function(){return tslib_1.__awaiter(this,void 0,void 0,(function(){var parentResults,ageAndGenderByFace,_this=this;return tslib_1.__generator(this,(function(_a){switch(_a.label){case 0:return[4,this.parentTask];case 1:return parentResults=_a.sent(),[4,extractFacesAndComputeResults_1.extractAllFacesAndComputeResults(parentResults,this.input,(function(faces){return tslib_1.__awaiter(_this,void 0,void 0,(function(){return tslib_1.__generator(this,(function(_a){switch(_a.label){case 0:return[4,Promise.all(faces.map((function(face){return nets_1.nets.ageGenderNet.predictAgeAndGender(face)})))];case 1:return[2,_a.sent()]}}))}))}),this.extractedFaces)];case 2:return ageAndGenderByFace=_a.sent(),[2,parentResults.map((function(parentResult,i){var _a=ageAndGenderByFace[i],age=_a.age,gender=_a.gender,genderProbability=_a.genderProbability;return WithAge_1.extendWithAge(WithGender_1.extendWithGender(parentResult,gender,genderProbability),age)}))]}}))}))},PredictAllAgeAndGenderTask.prototype.withFaceExpressions=function(){return new PredictFaceExpressionsTask_1.PredictAllFaceExpressionsTask(this,this.input)},PredictAllAgeAndGenderTask}(PredictAgeAndGenderTaskBase);exports.PredictAllAgeAndGenderTask=PredictAllAgeAndGenderTask;var PredictSingleAgeAndGenderTask=function(_super){function PredictSingleAgeAndGenderTask(){return null!==_super&&_super.apply(this,arguments)||this}return tslib_1.__extends(PredictSingleAgeAndGenderTask,_super),PredictSingleAgeAndGenderTask.prototype.run=function(){return tslib_1.__awaiter(this,void 0,void 0,(function(){var parentResult,_a,age,gender,genderProbability;return tslib_1.__generator(this,(function(_b){switch(_b.label){case 0:return[4,this.parentTask];case 1:return(parentResult=_b.sent())?[4,extractFacesAndComputeResults_1.extractSingleFaceAndComputeResult(parentResult,this.input,(function(face){return nets_1.nets.ageGenderNet.predictAgeAndGender(face)}),this.extractedFaces)]:[2];case 2:return _a=_b.sent(),age=_a.age,gender=_a.gender,genderProbability=_a.genderProbability,[2,WithAge_1.extendWithAge(WithGender_1.extendWithGender(parentResult,gender,genderProbability),age)]}}))}))},PredictSingleAgeAndGenderTask.prototype.withFaceExpressions=function(){return new PredictFaceExpressionsTask_1.PredictSingleFaceExpressionsTask(this,this.input)},PredictSingleAgeAndGenderTask}(PredictAgeAndGenderTaskBase);exports.PredictSingleAgeAndGenderTask=PredictSingleAgeAndGenderTask;var PredictAllAgeAndGenderWithFaceAlignmentTask=function(_super){function PredictAllAgeAndGenderWithFaceAlignmentTask(){return null!==_super&&_super.apply(this,arguments)||this}return tslib_1.__extends(PredictAllAgeAndGenderWithFaceAlignmentTask,_super),PredictAllAgeAndGenderWithFaceAlignmentTask.prototype.withFaceExpressions=function(){return new PredictFaceExpressionsTask_1.PredictAllFaceExpressionsWithFaceAlignmentTask(this,this.input)},PredictAllAgeAndGenderWithFaceAlignmentTask.prototype.withFaceDescriptors=function(){return new ComputeFaceDescriptorsTasks_1.ComputeAllFaceDescriptorsTask(this,this.input)},PredictAllAgeAndGenderWithFaceAlignmentTask}(PredictAllAgeAndGenderTask);exports.PredictAllAgeAndGenderWithFaceAlignmentTask=PredictAllAgeAndGenderWithFaceAlignmentTask;var PredictSingleAgeAndGenderWithFaceAlignmentTask=function(_super){function PredictSingleAgeAndGenderWithFaceAlignmentTask(){return null!==_super&&_super.apply(this,arguments)||this}return tslib_1.__extends(PredictSingleAgeAndGenderWithFaceAlignmentTask,_super),PredictSingleAgeAndGenderWithFaceAlignmentTask.prototype.withFaceExpressions=function(){return new PredictFaceExpressionsTask_1.PredictSingleFaceExpressionsWithFaceAlignmentTask(this,this.input)},PredictSingleAgeAndGenderWithFaceAlignmentTask.prototype.withFaceDescriptor=function(){return new ComputeFaceDescriptorsTasks_1.ComputeSingleFaceDescriptorTask(this,this.input)},PredictSingleAgeAndGenderWithFaceAlignmentTask}(PredictSingleAgeAndGenderTask);exports.PredictSingleAgeAndGenderWithFaceAlignmentTask=PredictSingleAgeAndGenderWithFaceAlignmentTask},{"../factories/WithAge":318,"../factories/WithGender":323,"./ComposableTask":325,"./ComputeFaceDescriptorsTasks":326,"./PredictFaceExpressionsTask":331,"./extractFacesAndComputeResults":334,"./nets":336,tslib:588}],331:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),WithFaceExpressions_1=require("../factories/WithFaceExpressions"),ComposableTask_1=require("./ComposableTask"),ComputeFaceDescriptorsTasks_1=require("./ComputeFaceDescriptorsTasks"),extractFacesAndComputeResults_1=require("./extractFacesAndComputeResults"),nets_1=require("./nets"),PredictAgeAndGenderTask_1=require("./PredictAgeAndGenderTask"),PredictFaceExpressionsTaskBase=function(_super){function PredictFaceExpressionsTaskBase(parentTask,input,extractedFaces){var _this=_super.call(this)||this;return _this.parentTask=parentTask,_this.input=input,_this.extractedFaces=extractedFaces,_this}return tslib_1.__extends(PredictFaceExpressionsTaskBase,_super),PredictFaceExpressionsTaskBase}(ComposableTask_1.ComposableTask);exports.PredictFaceExpressionsTaskBase=PredictFaceExpressionsTaskBase;var PredictAllFaceExpressionsTask=function(_super){function PredictAllFaceExpressionsTask(){return null!==_super&&_super.apply(this,arguments)||this}return tslib_1.__extends(PredictAllFaceExpressionsTask,_super),PredictAllFaceExpressionsTask.prototype.run=function(){return tslib_1.__awaiter(this,void 0,void 0,(function(){var parentResults,faceExpressionsByFace,_this=this;return tslib_1.__generator(this,(function(_a){switch(_a.label){case 0:return[4,this.parentTask];case 1:return parentResults=_a.sent(),[4,extractFacesAndComputeResults_1.extractAllFacesAndComputeResults(parentResults,this.input,(function(faces){return tslib_1.__awaiter(_this,void 0,void 0,(function(){return tslib_1.__generator(this,(function(_a){switch(_a.label){case 0:return[4,Promise.all(faces.map((function(face){return nets_1.nets.faceExpressionNet.predictExpressions(face)})))];case 1:return[2,_a.sent()]}}))}))}),this.extractedFaces)];case 2:return faceExpressionsByFace=_a.sent(),[2,parentResults.map((function(parentResult,i){return WithFaceExpressions_1.extendWithFaceExpressions(parentResult,faceExpressionsByFace[i])}))]}}))}))},PredictAllFaceExpressionsTask.prototype.withAgeAndGender=function(){return new PredictAgeAndGenderTask_1.PredictAllAgeAndGenderTask(this,this.input)},PredictAllFaceExpressionsTask}(PredictFaceExpressionsTaskBase);exports.PredictAllFaceExpressionsTask=PredictAllFaceExpressionsTask;var PredictSingleFaceExpressionsTask=function(_super){function PredictSingleFaceExpressionsTask(){return null!==_super&&_super.apply(this,arguments)||this}return tslib_1.__extends(PredictSingleFaceExpressionsTask,_super),PredictSingleFaceExpressionsTask.prototype.run=function(){return tslib_1.__awaiter(this,void 0,void 0,(function(){var parentResult,faceExpressions;return tslib_1.__generator(this,(function(_a){switch(_a.label){case 0:return[4,this.parentTask];case 1:return(parentResult=_a.sent())?[4,extractFacesAndComputeResults_1.extractSingleFaceAndComputeResult(parentResult,this.input,(function(face){return nets_1.nets.faceExpressionNet.predictExpressions(face)}),this.extractedFaces)]:[2];case 2:return faceExpressions=_a.sent(),[2,WithFaceExpressions_1.extendWithFaceExpressions(parentResult,faceExpressions)]}}))}))},PredictSingleFaceExpressionsTask.prototype.withAgeAndGender=function(){return new PredictAgeAndGenderTask_1.PredictSingleAgeAndGenderTask(this,this.input)},PredictSingleFaceExpressionsTask}(PredictFaceExpressionsTaskBase);exports.PredictSingleFaceExpressionsTask=PredictSingleFaceExpressionsTask;var PredictAllFaceExpressionsWithFaceAlignmentTask=function(_super){function PredictAllFaceExpressionsWithFaceAlignmentTask(){return null!==_super&&_super.apply(this,arguments)||this}return tslib_1.__extends(PredictAllFaceExpressionsWithFaceAlignmentTask,_super),PredictAllFaceExpressionsWithFaceAlignmentTask.prototype.withAgeAndGender=function(){return new PredictAgeAndGenderTask_1.PredictAllAgeAndGenderWithFaceAlignmentTask(this,this.input)},PredictAllFaceExpressionsWithFaceAlignmentTask.prototype.withFaceDescriptors=function(){return new ComputeFaceDescriptorsTasks_1.ComputeAllFaceDescriptorsTask(this,this.input)},PredictAllFaceExpressionsWithFaceAlignmentTask}(PredictAllFaceExpressionsTask);exports.PredictAllFaceExpressionsWithFaceAlignmentTask=PredictAllFaceExpressionsWithFaceAlignmentTask;var PredictSingleFaceExpressionsWithFaceAlignmentTask=function(_super){function PredictSingleFaceExpressionsWithFaceAlignmentTask(){return null!==_super&&_super.apply(this,arguments)||this}return tslib_1.__extends(PredictSingleFaceExpressionsWithFaceAlignmentTask,_super),PredictSingleFaceExpressionsWithFaceAlignmentTask.prototype.withAgeAndGender=function(){return new PredictAgeAndGenderTask_1.PredictSingleAgeAndGenderWithFaceAlignmentTask(this,this.input)},PredictSingleFaceExpressionsWithFaceAlignmentTask.prototype.withFaceDescriptor=function(){return new ComputeFaceDescriptorsTasks_1.ComputeSingleFaceDescriptorTask(this,this.input)},PredictSingleFaceExpressionsWithFaceAlignmentTask}(PredictSingleFaceExpressionsTask);exports.PredictSingleFaceExpressionsWithFaceAlignmentTask=PredictSingleFaceExpressionsWithFaceAlignmentTask},{"../factories/WithFaceExpressions":321,"./ComposableTask":325,"./ComputeFaceDescriptorsTasks":326,"./PredictAgeAndGenderTask":330,"./extractFacesAndComputeResults":334,"./nets":336,tslib:588}],332:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),tfjs_image_recognition_base_1=require("tfjs-image-recognition-base"),MtcnnOptions_1=require("../mtcnn/MtcnnOptions"),ssdMobilenetv1_1=require("../ssdMobilenetv1"),detectFaces_1=require("./detectFaces");function allFacesSsdMobilenetv1(input,minConfidence){return tslib_1.__awaiter(this,void 0,void 0,(function(){return tslib_1.__generator(this,(function(_a){switch(_a.label){case 0:return[4,detectFaces_1.detectAllFaces(input,new ssdMobilenetv1_1.SsdMobilenetv1Options(minConfidence?{minConfidence:minConfidence}:{})).withFaceLandmarks().withFaceDescriptors()];case 1:return[2,_a.sent()]}}))}))}function allFacesTinyYolov2(input,forwardParams){return void 0===forwardParams&&(forwardParams={}),tslib_1.__awaiter(this,void 0,void 0,(function(){return tslib_1.__generator(this,(function(_a){switch(_a.label){case 0:return[4,detectFaces_1.detectAllFaces(input,new tfjs_image_recognition_base_1.TfjsImageRecognitionBase.TinyYolov2Options(forwardParams)).withFaceLandmarks().withFaceDescriptors()];case 1:return[2,_a.sent()]}}))}))}function allFacesMtcnn(input,forwardParams){return void 0===forwardParams&&(forwardParams={}),tslib_1.__awaiter(this,void 0,void 0,(function(){return tslib_1.__generator(this,(function(_a){switch(_a.label){case 0:return[4,detectFaces_1.detectAllFaces(input,new MtcnnOptions_1.MtcnnOptions(forwardParams)).withFaceLandmarks().withFaceDescriptors()];case 1:return[2,_a.sent()]}}))}))}exports.allFacesSsdMobilenetv1=allFacesSsdMobilenetv1,exports.allFacesTinyYolov2=allFacesTinyYolov2,exports.allFacesMtcnn=allFacesMtcnn,exports.allFaces=allFacesSsdMobilenetv1},{"../mtcnn/MtcnnOptions":341,"../ssdMobilenetv1":365,"./detectFaces":333,"tfjs-image-recognition-base":568,tslib:588}],333:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var SsdMobilenetv1Options_1=require("../ssdMobilenetv1/SsdMobilenetv1Options"),DetectFacesTasks_1=require("./DetectFacesTasks");function detectSingleFace(input,options){return void 0===options&&(options=new SsdMobilenetv1Options_1.SsdMobilenetv1Options),new DetectFacesTasks_1.DetectSingleFaceTask(input,options)}function detectAllFaces(input,options){return void 0===options&&(options=new SsdMobilenetv1Options_1.SsdMobilenetv1Options),new DetectFacesTasks_1.DetectAllFacesTask(input,options)}exports.detectSingleFace=detectSingleFace,exports.detectAllFaces=detectAllFaces},{"../ssdMobilenetv1/SsdMobilenetv1Options":361,"./DetectFacesTasks":328}],334:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),tf=require("@tensorflow/tfjs-core"),dom_1=require("../dom"),WithFaceLandmarks_1=require("../factories/WithFaceLandmarks");function extractAllFacesAndComputeResults(parentResults,input,computeResults,extractedFaces,getRectForAlignment){return void 0===getRectForAlignment&&(getRectForAlignment=function(_a){var alignedRect;return _a.alignedRect}),tslib_1.__awaiter(this,void 0,void 0,(function(){var faceBoxes,faces,_a,_b,results;return tslib_1.__generator(this,(function(_c){switch(_c.label){case 0:return faceBoxes=parentResults.map((function(parentResult){return WithFaceLandmarks_1.isWithFaceLandmarks(parentResult)?getRectForAlignment(parentResult):parentResult.detection})),(_a=extractedFaces)?[3,5]:input instanceof tf.Tensor?[4,dom_1.extractFaceTensors(input,faceBoxes)]:[3,2];case 1:return _b=_c.sent(),[3,4];case 2:return[4,dom_1.extractFaces(input,faceBoxes)];case 3:_b=_c.sent(),_c.label=4;case 4:_a=_b,_c.label=5;case 5:return[4,computeResults(faces=_a)];case 6:return results=_c.sent(),faces.forEach((function(f){return f instanceof tf.Tensor&&f.dispose()})),[2,results]}}))}))}function extractSingleFaceAndComputeResult(parentResult,input,computeResult,extractedFaces,getRectForAlignment){return tslib_1.__awaiter(this,void 0,void 0,(function(){var _this=this;return tslib_1.__generator(this,(function(_a){return[2,extractAllFacesAndComputeResults([parentResult],input,(function(faces){return tslib_1.__awaiter(_this,void 0,void 0,(function(){return tslib_1.__generator(this,(function(_a){return[2,computeResult(faces[0])]}))}))}),extractedFaces,getRectForAlignment)]}))}))}exports.extractAllFacesAndComputeResults=extractAllFacesAndComputeResults,exports.extractSingleFaceAndComputeResult=extractSingleFaceAndComputeResult},{"../dom":284,"../factories/WithFaceLandmarks":322,"@tensorflow/tfjs-core":155,tslib:588}],335:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib");tslib_1.__exportStar(require("./allFaces"),exports),tslib_1.__exportStar(require("./ComposableTask"),exports),tslib_1.__exportStar(require("./ComputeFaceDescriptorsTasks"),exports),tslib_1.__exportStar(require("./detectFaces"),exports),tslib_1.__exportStar(require("./DetectFacesTasks"),exports),tslib_1.__exportStar(require("./DetectFaceLandmarksTasks"),exports),tslib_1.__exportStar(require("./FaceMatcher"),exports),tslib_1.__exportStar(require("./nets"),exports)},{"./ComposableTask":325,"./ComputeFaceDescriptorsTasks":326,"./DetectFaceLandmarksTasks":327,"./DetectFacesTasks":328,"./FaceMatcher":329,"./allFaces":332,"./detectFaces":333,"./nets":336,tslib:588}],336:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var AgeGenderNet_1=require("../ageGenderNet/AgeGenderNet"),FaceExpressionNet_1=require("../faceExpressionNet/FaceExpressionNet"),FaceLandmark68Net_1=require("../faceLandmarkNet/FaceLandmark68Net"),FaceLandmark68TinyNet_1=require("../faceLandmarkNet/FaceLandmark68TinyNet"),FaceRecognitionNet_1=require("../faceRecognitionNet/FaceRecognitionNet"),Mtcnn_1=require("../mtcnn/Mtcnn"),SsdMobilenetv1_1=require("../ssdMobilenetv1/SsdMobilenetv1"),TinyFaceDetector_1=require("../tinyFaceDetector/TinyFaceDetector"),tinyYolov2_1=require("../tinyYolov2");exports.nets={ssdMobilenetv1:new SsdMobilenetv1_1.SsdMobilenetv1,tinyFaceDetector:new TinyFaceDetector_1.TinyFaceDetector,tinyYolov2:new tinyYolov2_1.TinyYolov2,mtcnn:new Mtcnn_1.Mtcnn,faceLandmark68Net:new FaceLandmark68Net_1.FaceLandmark68Net,faceLandmark68TinyNet:new FaceLandmark68TinyNet_1.FaceLandmark68TinyNet,faceRecognitionNet:new FaceRecognitionNet_1.FaceRecognitionNet,faceExpressionNet:new FaceExpressionNet_1.FaceExpressionNet,ageGenderNet:new AgeGenderNet_1.AgeGenderNet},exports.ssdMobilenetv1=function(input,options){return exports.nets.ssdMobilenetv1.locateFaces(input,options)},exports.tinyFaceDetector=function(input,options){return exports.nets.tinyFaceDetector.locateFaces(input,options)},exports.tinyYolov2=function(input,options){return exports.nets.tinyYolov2.locateFaces(input,options)},exports.mtcnn=function(input,options){return exports.nets.mtcnn.forward(input,options)},exports.detectFaceLandmarks=function(input){return exports.nets.faceLandmark68Net.detectLandmarks(input)},exports.detectFaceLandmarksTiny=function(input){return exports.nets.faceLandmark68TinyNet.detectLandmarks(input)},exports.computeFaceDescriptor=function(input){return exports.nets.faceRecognitionNet.computeFaceDescriptor(input)},exports.recognizeFaceExpressions=function(input){return exports.nets.faceExpressionNet.predictExpressions(input)},exports.predictAgeAndGender=function(input){return exports.nets.ageGenderNet.predictAgeAndGender(input)},exports.loadSsdMobilenetv1Model=function(url){return exports.nets.ssdMobilenetv1.load(url)},exports.loadTinyFaceDetectorModel=function(url){return exports.nets.tinyFaceDetector.load(url)},exports.loadMtcnnModel=function(url){return exports.nets.mtcnn.load(url)},exports.loadTinyYolov2Model=function(url){return exports.nets.tinyYolov2.load(url)},exports.loadFaceLandmarkModel=function(url){return exports.nets.faceLandmark68Net.load(url)},exports.loadFaceLandmarkTinyModel=function(url){return exports.nets.faceLandmark68TinyNet.load(url)},exports.loadFaceRecognitionModel=function(url){return exports.nets.faceRecognitionNet.load(url)},exports.loadFaceExpressionModel=function(url){return exports.nets.faceExpressionNet.load(url)},exports.loadAgeGenderModel=function(url){return exports.nets.ageGenderNet.load(url)},exports.loadFaceDetectionModel=exports.loadSsdMobilenetv1Model,exports.locateFaces=exports.ssdMobilenetv1,exports.detectLandmarks=exports.detectFaceLandmarks},{"../ageGenderNet/AgeGenderNet":267,"../faceExpressionNet/FaceExpressionNet":291,"../faceLandmarkNet/FaceLandmark68Net":303,"../faceLandmarkNet/FaceLandmark68TinyNet":305,"../faceRecognitionNet/FaceRecognitionNet":311,"../mtcnn/Mtcnn":339,"../ssdMobilenetv1/SsdMobilenetv1":360,"../tinyFaceDetector/TinyFaceDetector":371,"../tinyYolov2":377}],337:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),tf=require("@tensorflow/tfjs-core");exports.tf=tf;var tfjs_image_recognition_base_1=require("tfjs-image-recognition-base"),drawExtended=require("./draw");tslib_1.__exportStar(require("tfjs-image-recognition-base"),exports),tslib_1.__exportStar(require("./ageGenderNet/index"),exports);var draw=tslib_1.__assign(tslib_1.__assign({},tfjs_image_recognition_base_1.draw),drawExtended);exports.draw=draw,tslib_1.__exportStar(require("./classes/index"),exports),tslib_1.__exportStar(require("./dom/index"),exports),tslib_1.__exportStar(require("./faceExpressionNet/index"),exports),tslib_1.__exportStar(require("./faceLandmarkNet/index"),exports),tslib_1.__exportStar(require("./faceRecognitionNet/index"),exports),tslib_1.__exportStar(require("./factories/index"),exports),tslib_1.__exportStar(require("./globalApi/index"),exports),tslib_1.__exportStar(require("./mtcnn/index"),exports),tslib_1.__exportStar(require("./ssdMobilenetv1/index"),exports),tslib_1.__exportStar(require("./tinyFaceDetector/index"),exports),tslib_1.__exportStar(require("./tinyYolov2/index"),exports),tslib_1.__exportStar(require("./euclideanDistance"),exports),tslib_1.__exportStar(require("./resizeResults"),exports)},{"./ageGenderNet/index":270,"./classes/index":278,"./dom/index":284,"./draw":289,"./euclideanDistance":290,"./faceExpressionNet/index":293,"./faceLandmarkNet/index":306,"./faceRecognitionNet/index":315,"./factories/index":324,"./globalApi/index":335,"./mtcnn/index":351,"./resizeResults":359,"./ssdMobilenetv1/index":365,"./tinyFaceDetector/index":374,"./tinyYolov2/index":377,"@tensorflow/tfjs-core":155,"tfjs-image-recognition-base":568,tslib:588}],338:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tfjs_image_recognition_base_1=require("tfjs-image-recognition-base");function minBbox(pts){var xs=pts.map((function(pt){return pt.x})),ys=pts.map((function(pt){return pt.y})),minX=xs.reduce((function(min,x){return x<min?x:min}),1/0),minY=ys.reduce((function(min,y){return y<min?y:min}),1/0),maxX=xs.reduce((function(max,x){return max<x?x:max}),0),maxY=ys.reduce((function(max,y){return max<y?y:max}),0);return new tfjs_image_recognition_base_1.BoundingBox(minX,minY,maxX,maxY)}exports.minBbox=minBbox},{"tfjs-image-recognition-base":568}],339:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),tf=require("@tensorflow/tfjs-core"),tfjs_image_recognition_base_1=require("tfjs-image-recognition-base"),FaceDetection_1=require("../classes/FaceDetection"),FaceLandmarks5_1=require("../classes/FaceLandmarks5"),factories_1=require("../factories"),bgrToRgbTensor_1=require("./bgrToRgbTensor"),config_1=require("./config"),extractParams_1=require("./extractParams"),extractParamsFromWeigthMap_1=require("./extractParamsFromWeigthMap"),getSizesForScale_1=require("./getSizesForScale"),MtcnnOptions_1=require("./MtcnnOptions"),pyramidDown_1=require("./pyramidDown"),stage1_1=require("./stage1"),stage2_1=require("./stage2"),stage3_1=require("./stage3"),Mtcnn=function(_super){function Mtcnn(){return _super.call(this,"Mtcnn")||this}return tslib_1.__extends(Mtcnn,_super),Mtcnn.prototype.forwardInput=function(input,forwardParams){return void 0===forwardParams&&(forwardParams={}),tslib_1.__awaiter(this,void 0,void 0,(function(){var params,inputCanvas,stats,tsTotal,imgTensor,onReturn,_a,height,width,_b,minFaceSize,scaleFactor,maxNumScales,scoreThresholds,scaleSteps,scales,ts,out1,out2,out3,results;return tslib_1.__generator(this,(function(_c){switch(_c.label){case 0:if(!(params=this.params))throw new Error("Mtcnn - load model before inference");if(!(inputCanvas=input.canvases[0]))throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return stats={},tsTotal=Date.now(),imgTensor=tf.tidy((function(){return bgrToRgbTensor_1.bgrToRgbTensor(tf.expandDims(tf.browser.fromPixels(inputCanvas)).toFloat())})),onReturn=function(results){return imgTensor.dispose(),stats.total=Date.now()-tsTotal,results},_a=imgTensor.shape.slice(1),height=_a[0],width=_a[1],_b=new MtcnnOptions_1.MtcnnOptions(forwardParams),minFaceSize=_b.minFaceSize,scaleFactor=_b.scaleFactor,maxNumScales=_b.maxNumScales,scoreThresholds=_b.scoreThresholds,scaleSteps=_b.scaleSteps,scales=(scaleSteps||pyramidDown_1.pyramidDown(minFaceSize,scaleFactor,[height,width])).filter((function(scale){var sizes=getSizesForScale_1.getSizesForScale(scale,[height,width]);return Math.min(sizes.width,sizes.height)>config_1.CELL_SIZE})).slice(0,maxNumScales),stats.scales=scales,stats.pyramid=scales.map((function(scale){return getSizesForScale_1.getSizesForScale(scale,[height,width])})),ts=Date.now(),[4,stage1_1.stage1(imgTensor,scales,scoreThresholds[0],params.pnet,stats)];case 1:return out1=_c.sent(),stats.total_stage1=Date.now()-ts,out1.boxes.length?(stats.stage2_numInputBoxes=out1.boxes.length,ts=Date.now(),[4,stage2_1.stage2(inputCanvas,out1.boxes,scoreThresholds[1],params.rnet,stats)]):[2,onReturn({results:[],stats:stats})];case 2:return out2=_c.sent(),stats.total_stage2=Date.now()-ts,out2.boxes.length?(stats.stage3_numInputBoxes=out2.boxes.length,ts=Date.now(),[4,stage3_1.stage3(inputCanvas,out2.boxes,scoreThresholds[2],params.onet,stats)]):[2,onReturn({results:[],stats:stats})];case 3:return out3=_c.sent(),stats.total_stage3=Date.now()-ts,results=out3.boxes.map((function(box,idx){return factories_1.extendWithFaceLandmarks(factories_1.extendWithFaceDetection({},new FaceDetection_1.FaceDetection(out3.scores[idx],new tfjs_image_recognition_base_1.Rect(box.left/width,box.top/height,box.width/width,box.height/height),{height:height,width:width})),new FaceLandmarks5_1.FaceLandmarks5(out3.points[idx].map((function(pt){return pt.sub(new tfjs_image_recognition_base_1.Point(box.left,box.top)).div(new tfjs_image_recognition_base_1.Point(box.width,box.height))})),{width:box.width,height:box.height}))})),[2,onReturn({results:results,stats:stats})]}}))}))},Mtcnn.prototype.forward=function(input,forwardParams){return void 0===forwardParams&&(forwardParams={}),tslib_1.__awaiter(this,void 0,void 0,(function(){var _a;return tslib_1.__generator(this,(function(_b){switch(_b.label){case 0:return _a=this.forwardInput,[4,tfjs_image_recognition_base_1.toNetInput(input)];case 1:return[4,_a.apply(this,[_b.sent(),forwardParams])];case 2:return[2,_b.sent().results]}}))}))},Mtcnn.prototype.forwardWithStats=function(input,forwardParams){return void 0===forwardParams&&(forwardParams={}),tslib_1.__awaiter(this,void 0,void 0,(function(){var _a;return tslib_1.__generator(this,(function(_b){switch(_b.label){case 0:return _a=this.forwardInput,[4,tfjs_image_recognition_base_1.toNetInput(input)];case 1:return[2,_a.apply(this,[_b.sent(),forwardParams])]}}))}))},Mtcnn.prototype.getDefaultModelName=function(){return"mtcnn_model"},Mtcnn.prototype.extractParamsFromWeigthMap=function(weightMap){return extractParamsFromWeigthMap_1.extractParamsFromWeigthMap(weightMap)},Mtcnn.prototype.extractParams=function(weights){return extractParams_1.extractParams(weights)},Mtcnn}(tfjs_image_recognition_base_1.NeuralNetwork);exports.Mtcnn=Mtcnn},{"../classes/FaceDetection":272,"../classes/FaceLandmarks5":274,"../factories":324,"./MtcnnOptions":341,"./bgrToRgbTensor":345,"./config":346,"./extractParams":348,"./extractParamsFromWeigthMap":349,"./getSizesForScale":350,"./pyramidDown":354,"./stage1":356,"./stage2":357,"./stage3":358,"@tensorflow/tfjs-core":155,"tfjs-image-recognition-base":568,tslib:588}],340:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),tfjs_image_recognition_base_1,MtcnnBox=function(_super){function MtcnnBox(left,top,right,bottom){return _super.call(this,{left:left,top:top,right:right,bottom:bottom},!0)||this}return tslib_1.__extends(MtcnnBox,_super),MtcnnBox}(require("tfjs-image-recognition-base").Box);exports.MtcnnBox=MtcnnBox},{"tfjs-image-recognition-base":568,tslib:588}],341:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var MtcnnOptions=function(){function MtcnnOptions(_a){var _b=void 0===_a?{}:_a,minFaceSize=_b.minFaceSize,scaleFactor=_b.scaleFactor,maxNumScales=_b.maxNumScales,scoreThresholds=_b.scoreThresholds,scaleSteps=_b.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=minFaceSize||20,this._scaleFactor=scaleFactor||.709,this._maxNumScales=maxNumScales||10,this._scoreThresholds=scoreThresholds||[.6,.7,.7],this._scaleSteps=scaleSteps,"number"!=typeof this._minFaceSize||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if("number"!=typeof this._scaleFactor||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if("number"!=typeof this._maxNumScales||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||3!==this._scoreThresholds.length||this._scoreThresholds.some((function(th){return"number"!=typeof th})))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some((function(th){return"number"!=typeof th}))))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(MtcnnOptions.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(MtcnnOptions.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(MtcnnOptions.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(MtcnnOptions.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(MtcnnOptions.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),MtcnnOptions}();exports.MtcnnOptions=MtcnnOptions},{}],342:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tf=require("@tensorflow/tfjs-core"),tfjs_image_recognition_base_1=require("tfjs-image-recognition-base"),fullyConnectedLayer_1=require("../common/fullyConnectedLayer"),prelu_1=require("./prelu"),sharedLayers_1=require("./sharedLayers");function ONet(x,params){return tf.tidy((function(){var out=sharedLayers_1.sharedLayer(x,params);out=tf.maxPool(out,[2,2],[2,2],"same"),out=tfjs_image_recognition_base_1.TfjsImageRecognitionBase.convLayer(out,params.conv4,"valid"),out=prelu_1.prelu(out,params.prelu4_alpha);var vectorized=tf.reshape(out,[out.shape[0],params.fc1.weights.shape[0]]),fc1=fullyConnectedLayer_1.fullyConnectedLayer(vectorized,params.fc1),prelu5=prelu_1.prelu(fc1,params.prelu5_alpha),fc2_1=fullyConnectedLayer_1.fullyConnectedLayer(prelu5,params.fc2_1),max=tf.expandDims(tf.max(fc2_1,1),1),prob=tf.softmax(tf.sub(fc2_1,max),1),regions=fullyConnectedLayer_1.fullyConnectedLayer(prelu5,params.fc2_2),points=fullyConnectedLayer_1.fullyConnectedLayer(prelu5,params.fc2_3),scores;return{scores:tf.unstack(prob,1)[1],regions:regions,points:points}}))}exports.ONet=ONet},{"../common/fullyConnectedLayer":280,"./prelu":353,"./sharedLayers":355,"@tensorflow/tfjs-core":155,"tfjs-image-recognition-base":568}],343:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tf=require("@tensorflow/tfjs-core"),tfjs_image_recognition_base_1=require("tfjs-image-recognition-base"),sharedLayers_1=require("./sharedLayers");function PNet(x,params){return tf.tidy((function(){var out=sharedLayers_1.sharedLayer(x,params,!0),conv=tfjs_image_recognition_base_1.TfjsImageRecognitionBase.convLayer(out,params.conv4_1,"valid"),max=tf.expandDims(tf.max(conv,3),3),prob,regions;return{prob:tf.softmax(tf.sub(conv,max),3),regions:tfjs_image_recognition_base_1.TfjsImageRecognitionBase.convLayer(out,params.conv4_2,"valid")}}))}exports.PNet=PNet},{"./sharedLayers":355,"@tensorflow/tfjs-core":155,"tfjs-image-recognition-base":568}],344:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tf=require("@tensorflow/tfjs-core"),fullyConnectedLayer_1=require("../common/fullyConnectedLayer"),prelu_1=require("./prelu"),sharedLayers_1=require("./sharedLayers");function RNet(x,params){return tf.tidy((function(){var convOut=sharedLayers_1.sharedLayer(x,params),vectorized=tf.reshape(convOut,[convOut.shape[0],params.fc1.weights.shape[0]]),fc1=fullyConnectedLayer_1.fullyConnectedLayer(vectorized,params.fc1),prelu4=prelu_1.prelu(fc1,params.prelu4_alpha),fc2_1=fullyConnectedLayer_1.fullyConnectedLayer(prelu4,params.fc2_1),max=tf.expandDims(tf.max(fc2_1,1),1),prob=tf.softmax(tf.sub(fc2_1,max),1),regions=fullyConnectedLayer_1.fullyConnectedLayer(prelu4,params.fc2_2),scores;return{scores:tf.unstack(prob,1)[1],regions:regions}}))}exports.RNet=RNet},{"../common/fullyConnectedLayer":280,"./prelu":353,"./sharedLayers":355,"@tensorflow/tfjs-core":155}],345:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tf=require("@tensorflow/tfjs-core");function bgrToRgbTensor(tensor){return tf.tidy((function(){return tf.stack(tf.unstack(tensor,3).reverse(),3)}))}exports.bgrToRgbTensor=bgrToRgbTensor},{"@tensorflow/tfjs-core":155}],346:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.CELL_STRIDE=2,exports.CELL_SIZE=12},{}],347:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),tf=require("@tensorflow/tfjs-core"),tfjs_image_recognition_base_1=require("tfjs-image-recognition-base"),normalize_1=require("./normalize");function extractImagePatches(img,boxes,_a){var width=_a.width,height=_a.height;return tslib_1.__awaiter(this,void 0,void 0,(function(){var imgCtx,bitmaps,imagePatchesDatas,_this=this;return tslib_1.__generator(this,(function(_b){switch(_b.label){case 0:return imgCtx=tfjs_image_recognition_base_1.getContext2dOrThrow(img),[4,Promise.all(boxes.map((function(box){return tslib_1.__awaiter(_this,void 0,void 0,(function(){var _a,y,ey,x,ex,fromX,fromY,imgData;return tslib_1.__generator(this,(function(_b){return _a=box.padAtBorders(img.height,img.width),y=_a.y,ey=_a.ey,x=_a.x,ex=_a.ex,fromX=x-1,fromY=y-1,imgData=imgCtx.getImageData(fromX,fromY,ex-fromX,ey-fromY),[2,tfjs_image_recognition_base_1.env.isNodejs()?tfjs_image_recognition_base_1.createCanvasFromMedia(imgData):createImageBitmap(imgData)]}))}))})))];case 1:return bitmaps=_b.sent(),imagePatchesDatas=[],bitmaps.forEach((function(bmp){var patch=tfjs_image_recognition_base_1.createCanvas({width:width,height:height}),patchCtx=tfjs_image_recognition_base_1.getContext2dOrThrow(patch);patchCtx.drawImage(bmp,0,0,width,height);for(var data=patchCtx.getImageData(0,0,width,height).data,currData=[],i=0;i<data.length;i+=4)currData.push(data[i+2]),currData.push(data[i+1]),currData.push(data[i]);imagePatchesDatas.push(currData)})),[2,imagePatchesDatas.map((function(data){var t;return tf.tidy((function(){var imagePatchTensor=tf.transpose(tf.tensor4d(data,[1,width,height,3]),[0,2,1,3]).toFloat();return normalize_1.normalize(imagePatchTensor)}))}))]}}))}))}exports.extractImagePatches=extractImagePatches},{"./normalize":352,"@tensorflow/tfjs-core":155,"tfjs-image-recognition-base":568,tslib:588}],348:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),tf=require("@tensorflow/tfjs-core"),tfjs_image_recognition_base_1=require("tfjs-image-recognition-base");function extractorsFactory(extractWeights,paramMappings){var extractConvParams=tfjs_image_recognition_base_1.TfjsImageRecognitionBase.extractConvParamsFactory(extractWeights,paramMappings),extractFCParams=tfjs_image_recognition_base_1.TfjsImageRecognitionBase.extractFCParamsFactory(extractWeights,paramMappings);function extractPReluParams(size,paramPath){var alpha=tf.tensor1d(extractWeights(size));return paramMappings.push({paramPath:paramPath}),alpha}function extractSharedParams(numFilters,mappedPrefix,isRnet){var conv1,prelu1_alpha,conv2,prelu2_alpha,conv3,prelu3_alpha;return void 0===isRnet&&(isRnet=!1),{conv1:extractConvParams(numFilters[0],numFilters[1],3,mappedPrefix+"/conv1"),prelu1_alpha:extractPReluParams(numFilters[1],mappedPrefix+"/prelu1_alpha"),conv2:extractConvParams(numFilters[1],numFilters[2],3,mappedPrefix+"/conv2"),prelu2_alpha:extractPReluParams(numFilters[2],mappedPrefix+"/prelu2_alpha"),conv3:extractConvParams(numFilters[2],numFilters[3],isRnet?2:3,mappedPrefix+"/conv3"),prelu3_alpha:extractPReluParams(numFilters[3],mappedPrefix+"/prelu3_alpha")}}function extractPNetParams(){var sharedParams=extractSharedParams([3,10,16,32],"pnet"),conv4_1=extractConvParams(32,2,1,"pnet/conv4_1"),conv4_2=extractConvParams(32,4,1,"pnet/conv4_2");return tslib_1.__assign(tslib_1.__assign({},sharedParams),{conv4_1:conv4_1,conv4_2:conv4_2})}function extractRNetParams(){var sharedParams=extractSharedParams([3,28,48,64],"rnet",!0),fc1=extractFCParams(576,128,"rnet/fc1"),prelu4_alpha=extractPReluParams(128,"rnet/prelu4_alpha"),fc2_1=extractFCParams(128,2,"rnet/fc2_1"),fc2_2=extractFCParams(128,4,"rnet/fc2_2");return tslib_1.__assign(tslib_1.__assign({},sharedParams),{fc1:fc1,prelu4_alpha:prelu4_alpha,fc2_1:fc2_1,fc2_2:fc2_2})}function extractONetParams(){var sharedParams=extractSharedParams([3,32,64,64],"onet"),conv4=extractConvParams(64,128,2,"onet/conv4"),prelu4_alpha=extractPReluParams(128,"onet/prelu4_alpha"),fc1=extractFCParams(1152,256,"onet/fc1"),prelu5_alpha=extractPReluParams(256,"onet/prelu5_alpha"),fc2_1=extractFCParams(256,2,"onet/fc2_1"),fc2_2=extractFCParams(256,4,"onet/fc2_2"),fc2_3=extractFCParams(256,10,"onet/fc2_3");return tslib_1.__assign(tslib_1.__assign({},sharedParams),{conv4:conv4,prelu4_alpha:prelu4_alpha,fc1:fc1,prelu5_alpha:prelu5_alpha,fc2_1:fc2_1,fc2_2:fc2_2,fc2_3:fc2_3})}return{extractPNetParams:extractPNetParams,extractRNetParams:extractRNetParams,extractONetParams:extractONetParams}}function extractParams(weights){var _a=tfjs_image_recognition_base_1.TfjsImageRecognitionBase.extractWeightsFactory(weights),extractWeights=_a.extractWeights,getRemainingWeights=_a.getRemainingWeights,paramMappings=[],_b=extractorsFactory(extractWeights,paramMappings),extractPNetParams=_b.extractPNetParams,extractRNetParams=_b.extractRNetParams,extractONetParams=_b.extractONetParams,pnet=extractPNetParams(),rnet=extractRNetParams(),onet=extractONetParams();if(0!==getRemainingWeights().length)throw new Error("weights remaing after extract: "+getRemainingWeights().length);return{params:{pnet:pnet,rnet:rnet,onet:onet},paramMappings:paramMappings}}exports.extractParams=extractParams},{"@tensorflow/tfjs-core":155,"tfjs-image-recognition-base":568,tslib:588}],349:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),tfjs_image_recognition_base_1=require("tfjs-image-recognition-base");function extractorsFactory(weightMap,paramMappings){var extractWeightEntry=tfjs_image_recognition_base_1.TfjsImageRecognitionBase.extractWeightEntryFactory(weightMap,paramMappings);function extractConvParams(prefix){var filters,bias;return{filters:extractWeightEntry(prefix+"/weights",4,prefix+"/filters"),bias:extractWeightEntry(prefix+"/bias",1)}}function extractFCParams(prefix){var weights,bias;return{weights:extractWeightEntry(prefix+"/weights",2),bias:extractWeightEntry(prefix+"/bias",1)}}function extractPReluParams(paramPath){return extractWeightEntry(paramPath,1)}function extractSharedParams(prefix){var conv1,prelu1_alpha,conv2,prelu2_alpha,conv3,prelu3_alpha;return{conv1:extractConvParams(prefix+"/conv1"),prelu1_alpha:extractPReluParams(prefix+"/prelu1_alpha"),conv2:extractConvParams(prefix+"/conv2"),prelu2_alpha:extractPReluParams(prefix+"/prelu2_alpha"),conv3:extractConvParams(prefix+"/conv3"),prelu3_alpha:extractPReluParams(prefix+"/prelu3_alpha")}}function extractPNetParams(){var sharedParams=extractSharedParams("pnet"),conv4_1=extractConvParams("pnet/conv4_1"),conv4_2=extractConvParams("pnet/conv4_2");return tslib_1.__assign(tslib_1.__assign({},sharedParams),{conv4_1:conv4_1,conv4_2:conv4_2})}function extractRNetParams(){var sharedParams=extractSharedParams("rnet"),fc1=extractFCParams("rnet/fc1"),prelu4_alpha=extractPReluParams("rnet/prelu4_alpha"),fc2_1=extractFCParams("rnet/fc2_1"),fc2_2=extractFCParams("rnet/fc2_2");return tslib_1.__assign(tslib_1.__assign({},sharedParams),{fc1:fc1,prelu4_alpha:prelu4_alpha,fc2_1:fc2_1,fc2_2:fc2_2})}function extractONetParams(){var sharedParams=extractSharedParams("onet"),conv4=extractConvParams("onet/conv4"),prelu4_alpha=extractPReluParams("onet/prelu4_alpha"),fc1=extractFCParams("onet/fc1"),prelu5_alpha=extractPReluParams("onet/prelu5_alpha"),fc2_1=extractFCParams("onet/fc2_1"),fc2_2=extractFCParams("onet/fc2_2"),fc2_3=extractFCParams("onet/fc2_3");return tslib_1.__assign(tslib_1.__assign({},sharedParams),{conv4:conv4,prelu4_alpha:prelu4_alpha,fc1:fc1,prelu5_alpha:prelu5_alpha,fc2_1:fc2_1,fc2_2:fc2_2,fc2_3:fc2_3})}return{extractPNetParams:extractPNetParams,extractRNetParams:extractRNetParams,extractONetParams:extractONetParams}}function extractParamsFromWeigthMap(weightMap){var paramMappings=[],_a=extractorsFactory(weightMap,paramMappings),extractPNetParams=_a.extractPNetParams,extractRNetParams=_a.extractRNetParams,extractONetParams=_a.extractONetParams,pnet=extractPNetParams(),rnet=extractRNetParams(),onet=extractONetParams();return tfjs_image_recognition_base_1.TfjsImageRecognitionBase.disposeUnusedWeightTensors(weightMap,paramMappings),{params:{pnet:pnet,rnet:rnet,onet:onet},paramMappings:paramMappings}}exports.extractParamsFromWeigthMap=extractParamsFromWeigthMap},{"tfjs-image-recognition-base":568,tslib:588}],350:[function(require,module,exports){"use strict";function getSizesForScale(scale,_a){var height=_a[0],width=_a[1];return{height:Math.floor(height*scale),width:Math.floor(width*scale)}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.getSizesForScale=getSizesForScale},{}],351:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),Mtcnn_1=require("./Mtcnn");function createMtcnn(weights){var net=new Mtcnn_1.Mtcnn;return net.extractWeights(weights),net}tslib_1.__exportStar(require("./Mtcnn"),exports),tslib_1.__exportStar(require("./MtcnnOptions"),exports),exports.createMtcnn=createMtcnn},{"./Mtcnn":339,"./MtcnnOptions":341,tslib:588}],352:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tf=require("@tensorflow/tfjs-core");function normalize(x){return tf.tidy((function(){return tf.mul(tf.sub(x,tf.scalar(127.5)),tf.scalar(.0078125))}))}exports.normalize=normalize},{"@tensorflow/tfjs-core":155}],353:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tf=require("@tensorflow/tfjs-core");function prelu(x,alpha){return tf.tidy((function(){return tf.add(tf.relu(x),tf.mul(alpha,tf.neg(tf.relu(tf.neg(x)))))}))}exports.prelu=prelu},{"@tensorflow/tfjs-core":155}],354:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var config_1=require("./config");function pyramidDown(minFaceSize,scaleFactor,dims){for(var height=dims[0],width=dims[1],m=config_1.CELL_SIZE/minFaceSize,scales=[],minLayer=Math.min(height,width)*m,exp=0;minLayer>=12;)scales.push(m*Math.pow(scaleFactor,exp)),minLayer*=scaleFactor,exp+=1;return scales}exports.pyramidDown=pyramidDown},{"./config":346}],355:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tf=require("@tensorflow/tfjs-core"),tfjs_image_recognition_base_1=require("tfjs-image-recognition-base"),prelu_1=require("./prelu");function sharedLayer(x,params,isPnet){return void 0===isPnet&&(isPnet=!1),tf.tidy((function(){var out=tfjs_image_recognition_base_1.TfjsImageRecognitionBase.convLayer(x,params.conv1,"valid");return out=prelu_1.prelu(out,params.prelu1_alpha),out=tf.maxPool(out,isPnet?[2,2]:[3,3],[2,2],"same"),out=tfjs_image_recognition_base_1.TfjsImageRecognitionBase.convLayer(out,params.conv2,"valid"),out=prelu_1.prelu(out,params.prelu2_alpha),out=isPnet?out:tf.maxPool(out,[3,3],[2,2],"valid"),out=tfjs_image_recognition_base_1.TfjsImageRecognitionBase.convLayer(out,params.conv3,"valid"),out=prelu_1.prelu(out,params.prelu3_alpha)}))}exports.sharedLayer=sharedLayer},{"./prelu":353,"@tensorflow/tfjs-core":155,"tfjs-image-recognition-base":568}],356:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tf=require("@tensorflow/tfjs-core"),tfjs_image_recognition_base_1=require("tfjs-image-recognition-base"),config_1=require("./config"),getSizesForScale_1=require("./getSizesForScale"),MtcnnBox_1=require("./MtcnnBox"),normalize_1=require("./normalize"),PNet_1=require("./PNet");function rescaleAndNormalize(x,scale){return tf.tidy((function(){var _a=getSizesForScale_1.getSizesForScale(scale,x.shape.slice(1)),height=_a.height,width=_a.width,resized=tf.image.resizeBilinear(x,[height,width]),normalized=normalize_1.normalize(resized);return tf.transpose(normalized,[0,2,1,3])}))}function extractBoundingBoxes(scoresTensor,regionsTensor,scale,scoreThreshold){for(var indices=[],scoresData=scoresTensor.arraySync(),y=0;y<scoresTensor.shape[0];y++)for(var x=0;x<scoresTensor.shape[1];x++)scoresData[y][x]>=scoreThreshold&&indices.push(new tfjs_image_recognition_base_1.Point(x,y));var boundingBoxes;return indices.map((function(idx){var cell=new tfjs_image_recognition_base_1.BoundingBox(Math.round((idx.y*config_1.CELL_STRIDE+1)/scale),Math.round((idx.x*config_1.CELL_STRIDE+1)/scale),Math.round((idx.y*config_1.CELL_STRIDE+config_1.CELL_SIZE)/scale),Math.round((idx.x*config_1.CELL_STRIDE+config_1.CELL_SIZE)/scale)),score=scoresData[idx.y][idx.x],regionsData=regionsTensor.arraySync(),region;return{cell:cell,score:score,region:new MtcnnBox_1.MtcnnBox(regionsData[idx.y][idx.x][0],regionsData[idx.y][idx.x][1],regionsData[idx.y][idx.x][2],regionsData[idx.y][idx.x][3])}}))}function stage1(imgTensor,scales,scoreThreshold,params,stats){stats.stage1=[];var pnetOutputs,boxesForScale,allBoxes=scales.map((function(scale){return tf.tidy((function(){var statsForScale={scale:scale},resized=rescaleAndNormalize(imgTensor,scale),ts=Date.now(),_a=PNet_1.PNet(resized,params),prob=_a.prob,regions=_a.regions,scoresTensor,regionsTensor;return statsForScale.pnet=Date.now()-ts,{scoresTensor:tf.unstack(tf.unstack(prob,3)[1])[0],regionsTensor:tf.unstack(regions)[0],scale:scale,statsForScale:statsForScale}}))})).map((function(_a){var scoresTensor=_a.scoresTensor,regionsTensor=_a.regionsTensor,scale=_a.scale,statsForScale=_a.statsForScale,boundingBoxes=extractBoundingBoxes(scoresTensor,regionsTensor,scale,scoreThreshold);if(scoresTensor.dispose(),regionsTensor.dispose(),!boundingBoxes.length)return stats.stage1.push(statsForScale),[];var ts=Date.now(),indices=tfjs_image_recognition_base_1.nonMaxSuppression(boundingBoxes.map((function(bbox){return bbox.cell})),boundingBoxes.map((function(bbox){return bbox.score})),.5);return statsForScale.nms=Date.now()-ts,statsForScale.numBoxes=indices.length,stats.stage1.push(statsForScale),indices.map((function(boxIdx){return boundingBoxes[boxIdx]}))})).reduce((function(all,boxes){return all.concat(boxes)}),[]),finalBoxes=[],finalScores=[];if(allBoxes.length>0){var ts=Date.now(),indices=tfjs_image_recognition_base_1.nonMaxSuppression(allBoxes.map((function(bbox){return bbox.cell})),allBoxes.map((function(bbox){return bbox.score})),.7);stats.stage1_nms=Date.now()-ts,finalScores=indices.map((function(idx){return allBoxes[idx].score})),finalBoxes=indices.map((function(idx){return allBoxes[idx]})).map((function(_a){var cell=_a.cell,region=_a.region;return new tfjs_image_recognition_base_1.BoundingBox(cell.left+region.left*cell.width,cell.top+region.top*cell.height,cell.right+region.right*cell.width,cell.bottom+region.bottom*cell.height).toSquare().round()}))}return{boxes:finalBoxes,scores:finalScores}}exports.stage1=stage1},{"./MtcnnBox":340,"./PNet":343,"./config":346,"./getSizesForScale":350,"./normalize":352,"@tensorflow/tfjs-core":155,"tfjs-image-recognition-base":568}],357:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),tf=require("@tensorflow/tfjs-core"),tfjs_image_recognition_base_1=require("tfjs-image-recognition-base"),extractImagePatches_1=require("./extractImagePatches"),MtcnnBox_1=require("./MtcnnBox"),RNet_1=require("./RNet");function stage2(img,inputBoxes,scoreThreshold,params,stats){return tslib_1.__awaiter(this,void 0,void 0,(function(){var ts,rnetInputs,rnetOuts,scoresTensor,scores,_a,_b,indices,filteredBoxes,filteredScores,finalBoxes,finalScores,indicesNms,regions_1;return tslib_1.__generator(this,(function(_c){switch(_c.label){case 0:return ts=Date.now(),[4,extractImagePatches_1.extractImagePatches(img,inputBoxes,{width:24,height:24})];case 1:return rnetInputs=_c.sent(),stats.stage2_extractImagePatches=Date.now()-ts,ts=Date.now(),rnetOuts=rnetInputs.map((function(rnetInput){var out=RNet_1.RNet(rnetInput,params);return rnetInput.dispose(),out})),stats.stage2_rnet=Date.now()-ts,scoresTensor=rnetOuts.length>1?tf.concat(rnetOuts.map((function(out){return out.scores}))):rnetOuts[0].scores,_b=(_a=Array).from,[4,scoresTensor.data()];case 2:return scores=_b.apply(_a,[_c.sent()]),scoresTensor.dispose(),indices=scores.map((function(score,idx){return{score:score,idx:idx}})).filter((function(c){return c.score>scoreThreshold})).map((function(_a){var idx;return _a.idx})),filteredBoxes=indices.map((function(idx){return inputBoxes[idx]})),filteredScores=indices.map((function(idx){return scores[idx]})),finalBoxes=[],finalScores=[],filteredBoxes.length>0&&(ts=Date.now(),indicesNms=tfjs_image_recognition_base_1.nonMaxSuppression(filteredBoxes,filteredScores,.7),stats.stage2_nms=Date.now()-ts,regions_1=indicesNms.map((function(idx){var regionsData=rnetOuts[indices[idx]].regions.arraySync();return new MtcnnBox_1.MtcnnBox(regionsData[0][0],regionsData[0][1],regionsData[0][2],regionsData[0][3])})),finalScores=indicesNms.map((function(idx){return filteredScores[idx]})),finalBoxes=indicesNms.map((function(idx,i){return filteredBoxes[idx].calibrate(regions_1[i])}))),rnetOuts.forEach((function(t){t.regions.dispose(),t.scores.dispose()})),[2,{boxes:finalBoxes,scores:finalScores}]}}))}))}exports.stage2=stage2},{"./MtcnnBox":340,"./RNet":344,"./extractImagePatches":347,"@tensorflow/tfjs-core":155,"tfjs-image-recognition-base":568,tslib:588}],358:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),tf=require("@tensorflow/tfjs-core"),tfjs_image_recognition_base_1=require("tfjs-image-recognition-base"),extractImagePatches_1=require("./extractImagePatches"),MtcnnBox_1=require("./MtcnnBox"),ONet_1=require("./ONet");function stage3(img,inputBoxes,scoreThreshold,params,stats){return tslib_1.__awaiter(this,void 0,void 0,(function(){var ts,onetInputs,onetOuts,scoresTensor,scores,_a,_b,indices,filteredRegions,filteredBoxes,filteredScores,finalBoxes,finalScores,points,indicesNms;return tslib_1.__generator(this,(function(_c){switch(_c.label){case 0:return ts=Date.now(),[4,extractImagePatches_1.extractImagePatches(img,inputBoxes,{width:48,height:48})];case 1:return onetInputs=_c.sent(),stats.stage3_extractImagePatches=Date.now()-ts,ts=Date.now(),onetOuts=onetInputs.map((function(onetInput){var out=ONet_1.ONet(onetInput,params);return onetInput.dispose(),out})),stats.stage3_onet=Date.now()-ts,scoresTensor=onetOuts.length>1?tf.concat(onetOuts.map((function(out){return out.scores}))):onetOuts[0].scores,_b=(_a=Array).from,[4,scoresTensor.data()];case 2:return scores=_b.apply(_a,[_c.sent()]),scoresTensor.dispose(),indices=scores.map((function(score,idx){return{score:score,idx:idx}})).filter((function(c){return c.score>scoreThreshold})).map((function(_a){var idx;return _a.idx})),filteredRegions=indices.map((function(idx){var regionsData=onetOuts[idx].regions.arraySync();return new MtcnnBox_1.MtcnnBox(regionsData[0][0],regionsData[0][1],regionsData[0][2],regionsData[0][3])})),filteredBoxes=indices.map((function(idx,i){return inputBoxes[idx].calibrate(filteredRegions[i])})),filteredScores=indices.map((function(idx){return scores[idx]})),finalBoxes=[],finalScores=[],points=[],filteredBoxes.length>0&&(ts=Date.now(),indicesNms=tfjs_image_recognition_base_1.nonMaxSuppression(filteredBoxes,filteredScores,.7,!1),stats.stage3_nms=Date.now()-ts,finalBoxes=indicesNms.map((function(idx){return filteredBoxes[idx]})),finalScores=indicesNms.map((function(idx){return filteredScores[idx]})),points=indicesNms.map((function(idx,i){return Array(5).fill(0).map((function(_,ptIdx){var pointsData=onetOuts[idx].points.arraySync();return new tfjs_image_recognition_base_1.Point(pointsData[0][ptIdx]*(finalBoxes[i].width+1)+finalBoxes[i].left,pointsData[0][ptIdx+5]*(finalBoxes[i].height+1)+finalBoxes[i].top)}))}))),onetOuts.forEach((function(t){t.regions.dispose(),t.scores.dispose(),t.points.dispose()})),[2,{boxes:finalBoxes,scores:finalScores,points:points}]}}))}))}exports.stage3=stage3},{"./MtcnnBox":340,"./ONet":342,"./extractImagePatches":347,"@tensorflow/tfjs-core":155,"tfjs-image-recognition-base":568,tslib:588}],359:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tfjs_image_recognition_base_1=require("tfjs-image-recognition-base"),FaceDetection_1=require("./classes/FaceDetection"),FaceLandmarks_1=require("./classes/FaceLandmarks"),WithFaceDetection_1=require("./factories/WithFaceDetection"),WithFaceLandmarks_1=require("./factories/WithFaceLandmarks");function resizeResults(results,dimensions){var _a=new tfjs_image_recognition_base_1.Dimensions(dimensions.width,dimensions.height),width=_a.width,height=_a.height;if(width<=0||height<=0)throw new Error("resizeResults - invalid dimensions: "+JSON.stringify({width:width,height:height}));if(Array.isArray(results))return results.map((function(obj){return resizeResults(obj,{width:width,height:height})}));if(WithFaceLandmarks_1.isWithFaceLandmarks(results)){var resizedDetection=results.detection.forSize(width,height),resizedLandmarks=results.unshiftedLandmarks.forSize(resizedDetection.box.width,resizedDetection.box.height);return WithFaceLandmarks_1.extendWithFaceLandmarks(WithFaceDetection_1.extendWithFaceDetection(results,resizedDetection),resizedLandmarks)}return WithFaceDetection_1.isWithFaceDetection(results)?WithFaceDetection_1.extendWithFaceDetection(results,results.detection.forSize(width,height)):results instanceof FaceLandmarks_1.FaceLandmarks||results instanceof FaceDetection_1.FaceDetection?results.forSize(width,height):results}exports.resizeResults=resizeResults},{"./classes/FaceDetection":272,"./classes/FaceLandmarks":273,"./factories/WithFaceDetection":320,"./factories/WithFaceLandmarks":322,"tfjs-image-recognition-base":568}],360:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),tf=require("@tensorflow/tfjs-core"),tfjs_image_recognition_base_1=require("tfjs-image-recognition-base"),FaceDetection_1=require("../classes/FaceDetection"),extractParams_1=require("./extractParams"),extractParamsFromWeigthMap_1=require("./extractParamsFromWeigthMap"),mobileNetV1_1=require("./mobileNetV1"),nonMaxSuppression_1=require("./nonMaxSuppression"),outputLayer_1=require("./outputLayer"),predictionLayer_1=require("./predictionLayer"),SsdMobilenetv1Options_1=require("./SsdMobilenetv1Options"),SsdMobilenetv1=function(_super){function SsdMobilenetv1(){return _super.call(this,"SsdMobilenetv1")||this}return tslib_1.__extends(SsdMobilenetv1,_super),SsdMobilenetv1.prototype.forwardInput=function(input){var params=this.params;if(!params)throw new Error("SsdMobilenetv1 - load model before inference");return tf.tidy((function(){var batchTensor=input.toBatchTensor(512,!1).toFloat(),x=tf.sub(tf.mul(batchTensor,tf.scalar(.007843137718737125)),tf.scalar(1)),features=mobileNetV1_1.mobileNetV1(x,params.mobilenetv1),_a=predictionLayer_1.predictionLayer(features.out,features.conv11,params.prediction_layer),boxPredictions=_a.boxPredictions,classPredictions=_a.classPredictions;return outputLayer_1.outputLayer(boxPredictions,classPredictions,params.output_layer)}))},SsdMobilenetv1.prototype.forward=function(input){return tslib_1.__awaiter(this,void 0,void 0,(function(){var _a;return tslib_1.__generator(this,(function(_b){switch(_b.label){case 0:return _a=this.forwardInput,[4,tfjs_image_recognition_base_1.toNetInput(input)];case 1:return[2,_a.apply(this,[_b.sent()])]}}))}))},SsdMobilenetv1.prototype.locateFaces=function(input,options){return void 0===options&&(options={}),tslib_1.__awaiter(this,void 0,void 0,(function(){var _a,maxResults,minConfidence,netInput,_b,_boxes,_scores,boxes,scores,i,scoresData,_c,_d,iouThreshold,indices,reshapedDims,inputSize,padX,padY,boxesData,results;return tslib_1.__generator(this,(function(_e){switch(_e.label){case 0:return _a=new SsdMobilenetv1Options_1.SsdMobilenetv1Options(options),maxResults=_a.maxResults,minConfidence=_a.minConfidence,[4,tfjs_image_recognition_base_1.toNetInput(input)];case 1:for(netInput=_e.sent(),_b=this.forwardInput(netInput),_boxes=_b.boxes,_scores=_b.scores,boxes=_boxes[0],scores=_scores[0],i=1;i<_boxes.length;i++)_boxes[i].dispose(),_scores[i].dispose();return _d=(_c=Array).from,[4,scores.data()];case 2:return scoresData=_d.apply(_c,[_e.sent()]),iouThreshold=.5,indices=nonMaxSuppression_1.nonMaxSuppression(boxes,scoresData,maxResults,.5,minConfidence),reshapedDims=netInput.getReshapedInputDimensions(0),inputSize=netInput.inputSize,padX=inputSize/reshapedDims.width,padY=inputSize/reshapedDims.height,boxesData=boxes.arraySync(),results=indices.map((function(idx){var _a=[Math.max(0,boxesData[idx][0]),Math.min(1,boxesData[idx][2])].map((function(val){return val*padY})),top=_a[0],bottom=_a[1],_b=[Math.max(0,boxesData[idx][1]),Math.min(1,boxesData[idx][3])].map((function(val){return val*padX})),left=_b[0],right=_b[1];return new FaceDetection_1.FaceDetection(scoresData[idx],new tfjs_image_recognition_base_1.Rect(left,top,right-left,bottom-top),{height:netInput.getInputHeight(0),width:netInput.getInputWidth(0)})})),boxes.dispose(),scores.dispose(),[2,results]}}))}))},SsdMobilenetv1.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},SsdMobilenetv1.prototype.extractParamsFromWeigthMap=function(weightMap){return extractParamsFromWeigthMap_1.extractParamsFromWeigthMap(weightMap)},SsdMobilenetv1.prototype.extractParams=function(weights){return extractParams_1.extractParams(weights)},SsdMobilenetv1}(tfjs_image_recognition_base_1.NeuralNetwork);exports.SsdMobilenetv1=SsdMobilenetv1},{"../classes/FaceDetection":272,"./SsdMobilenetv1Options":361,"./extractParams":363,"./extractParamsFromWeigthMap":364,"./mobileNetV1":366,"./nonMaxSuppression":367,"./outputLayer":368,"./predictionLayer":370,"@tensorflow/tfjs-core":155,"tfjs-image-recognition-base":568,tslib:588}],361:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var SsdMobilenetv1Options=function(){function SsdMobilenetv1Options(_a){var _b=void 0===_a?{}:_a,minConfidence=_b.minConfidence,maxResults=_b.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=minConfidence||.5,this._maxResults=maxResults||100,"number"!=typeof this._minConfidence||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if("number"!=typeof this._maxResults)throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(SsdMobilenetv1Options.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(SsdMobilenetv1Options.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),SsdMobilenetv1Options}();exports.SsdMobilenetv1Options=SsdMobilenetv1Options},{}],362:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tf=require("@tensorflow/tfjs-core"),tfjs_image_recognition_base_1=require("tfjs-image-recognition-base");function boxPredictionLayer(x,params){return tf.tidy((function(){var batchSize=x.shape[0],boxPredictionEncoding,classPrediction;return{boxPredictionEncoding:tf.reshape(tfjs_image_recognition_base_1.TfjsImageRecognitionBase.convLayer(x,params.box_encoding_predictor),[batchSize,-1,1,4]),classPrediction:tf.reshape(tfjs_image_recognition_base_1.TfjsImageRecognitionBase.convLayer(x,params.class_predictor),[batchSize,-1,3])}}))}exports.boxPredictionLayer=boxPredictionLayer},{"@tensorflow/tfjs-core":155,"tfjs-image-recognition-base":568}],363:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tf=require("@tensorflow/tfjs-core"),tfjs_image_recognition_base_1=require("tfjs-image-recognition-base");function extractorsFactory(extractWeights,paramMappings){function extractDepthwiseConvParams(numChannels,mappedPrefix){var filters=tf.tensor4d(extractWeights(9*numChannels),[3,3,numChannels,1]),batch_norm_scale=tf.tensor1d(extractWeights(numChannels)),batch_norm_offset=tf.tensor1d(extractWeights(numChannels)),batch_norm_mean=tf.tensor1d(extractWeights(numChannels)),batch_norm_variance=tf.tensor1d(extractWeights(numChannels));return paramMappings.push({paramPath:mappedPrefix+"/filters"},{paramPath:mappedPrefix+"/batch_norm_scale"},{paramPath:mappedPrefix+"/batch_norm_offset"},{paramPath:mappedPrefix+"/batch_norm_mean"},{paramPath:mappedPrefix+"/batch_norm_variance"}),{filters:filters,batch_norm_scale:batch_norm_scale,batch_norm_offset:batch_norm_offset,batch_norm_mean:batch_norm_mean,batch_norm_variance:batch_norm_variance}}function extractConvParams(channelsIn,channelsOut,filterSize,mappedPrefix,isPointwiseConv){var filters=tf.tensor4d(extractWeights(channelsIn*channelsOut*filterSize*filterSize),[filterSize,filterSize,channelsIn,channelsOut]),bias=tf.tensor1d(extractWeights(channelsOut));return paramMappings.push({paramPath:mappedPrefix+"/filters"},{paramPath:mappedPrefix+"/"+(isPointwiseConv?"batch_norm_offset":"bias")}),{filters:filters,bias:bias}}function extractPointwiseConvParams(channelsIn,channelsOut,filterSize,mappedPrefix){var _a=extractConvParams(channelsIn,channelsOut,filterSize,mappedPrefix,!0),filters,bias;return{filters:_a.filters,batch_norm_offset:_a.bias}}function extractConvPairParams(channelsIn,channelsOut,mappedPrefix){var depthwise_conv,pointwise_conv;return{depthwise_conv:extractDepthwiseConvParams(channelsIn,mappedPrefix+"/depthwise_conv"),pointwise_conv:extractPointwiseConvParams(channelsIn,channelsOut,1,mappedPrefix+"/pointwise_conv")}}function extractMobilenetV1Params(){var conv_0,conv_1,conv_2,conv_3,conv_4,conv_5,conv_6,conv_7,conv_8,conv_9,conv_10,conv_11,conv_12,conv_13;return{conv_0:extractPointwiseConvParams(3,32,3,"mobilenetv1/conv_0"),conv_1:extractConvPairParams(32,64,"mobilenetv1/conv_1"),conv_2:extractConvPairParams(64,128,"mobilenetv1/conv_2"),conv_3:extractConvPairParams(128,128,"mobilenetv1/conv_3"),conv_4:extractConvPairParams(128,256,"mobilenetv1/conv_4"),conv_5:extractConvPairParams(256,256,"mobilenetv1/conv_5"),conv_6:extractConvPairParams(256,512,"mobilenetv1/conv_6"),conv_7:extractConvPairParams(512,512,"mobilenetv1/conv_7"),conv_8:extractConvPairParams(512,512,"mobilenetv1/conv_8"),conv_9:extractConvPairParams(512,512,"mobilenetv1/conv_9"),conv_10:extractConvPairParams(512,512,"mobilenetv1/conv_10"),conv_11:extractConvPairParams(512,512,"mobilenetv1/conv_11"),conv_12:extractConvPairParams(512,1024,"mobilenetv1/conv_12"),conv_13:extractConvPairParams(1024,1024,"mobilenetv1/conv_13")}}function extractPredictionLayerParams(){var conv_0,conv_1,conv_2,conv_3,conv_4,conv_5,conv_6,conv_7,box_encoding_0_predictor,class_predictor_0,box_encoding_1_predictor,class_predictor_1,box_encoding_2_predictor,class_predictor_2,box_encoding_3_predictor,class_predictor_3,box_encoding_4_predictor,class_predictor_4,box_encoding_5_predictor,class_predictor_5,box_predictor_0,box_predictor_1,box_predictor_2,box_predictor_3,box_predictor_4,box_predictor_5;return{conv_0:extractPointwiseConvParams(1024,256,1,"prediction_layer/conv_0"),conv_1:extractPointwiseConvParams(256,512,3,"prediction_layer/conv_1"),conv_2:extractPointwiseConvParams(512,128,1,"prediction_layer/conv_2"),conv_3:extractPointwiseConvParams(128,256,3,"prediction_layer/conv_3"),conv_4:extractPointwiseConvParams(256,128,1,"prediction_layer/conv_4"),conv_5:extractPointwiseConvParams(128,256,3,"prediction_layer/conv_5"),conv_6:extractPointwiseConvParams(256,64,1,"prediction_layer/conv_6"),conv_7:extractPointwiseConvParams(64,128,3,"prediction_layer/conv_7"),box_predictor_0:{box_encoding_predictor:extractConvParams(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),class_predictor:extractConvParams(512,9,1,"prediction_layer/box_predictor_0/class_predictor")},box_predictor_1:{box_encoding_predictor:extractConvParams(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),class_predictor:extractConvParams(1024,18,1,"prediction_layer/box_predictor_1/class_predictor")},box_predictor_2:{box_encoding_predictor:extractConvParams(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),class_predictor:extractConvParams(512,18,1,"prediction_layer/box_predictor_2/class_predictor")},box_predictor_3:{box_encoding_predictor:extractConvParams(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),class_predictor:extractConvParams(256,18,1,"prediction_layer/box_predictor_3/class_predictor")},box_predictor_4:{box_encoding_predictor:extractConvParams(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),class_predictor:extractConvParams(256,18,1,"prediction_layer/box_predictor_4/class_predictor")},box_predictor_5:{box_encoding_predictor:extractConvParams(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),class_predictor:extractConvParams(128,18,1,"prediction_layer/box_predictor_5/class_predictor")}}}return{extractMobilenetV1Params:extractMobilenetV1Params,extractPredictionLayerParams:extractPredictionLayerParams}}function extractParams(weights){var paramMappings=[],_a=tfjs_image_recognition_base_1.TfjsImageRecognitionBase.extractWeightsFactory(weights),extractWeights=_a.extractWeights,getRemainingWeights=_a.getRemainingWeights,_b=extractorsFactory(extractWeights,paramMappings),extractMobilenetV1Params=_b.extractMobilenetV1Params,extractPredictionLayerParams=_b.extractPredictionLayerParams,mobilenetv1=extractMobilenetV1Params(),prediction_layer=extractPredictionLayerParams(),extra_dim,output_layer={extra_dim:tf.tensor3d(extractWeights(20472),[1,5118,4])};if(paramMappings.push({paramPath:"output_layer/extra_dim"}),0!==getRemainingWeights().length)throw new Error("weights remaing after extract: "+getRemainingWeights().length);return{params:{mobilenetv1:mobilenetv1,prediction_layer:prediction_layer,output_layer:output_layer},paramMappings:paramMappings}}exports.extractParams=extractParams},{"@tensorflow/tfjs-core":155,"tfjs-image-recognition-base":568}],364:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tfjs_image_recognition_base_1=require("tfjs-image-recognition-base");function extractorsFactory(weightMap,paramMappings){var extractWeightEntry=tfjs_image_recognition_base_1.TfjsImageRecognitionBase.extractWeightEntryFactory(weightMap,paramMappings);function extractPointwiseConvParams(prefix,idx,mappedPrefix){var filters,batch_norm_offset;return{filters:extractWeightEntry(prefix+"/Conv2d_"+idx+"_pointwise/weights",4,mappedPrefix+"/filters"),batch_norm_offset:extractWeightEntry(prefix+"/Conv2d_"+idx+"_pointwise/convolution_bn_offset",1,mappedPrefix+"/batch_norm_offset")}}function extractConvPairParams(idx){var mappedPrefix="mobilenetv1/conv_"+idx,prefixDepthwiseConv="MobilenetV1/Conv2d_"+idx+"_depthwise",mappedPrefixDepthwiseConv=mappedPrefix+"/depthwise_conv",mappedPrefixPointwiseConv=mappedPrefix+"/pointwise_conv",filters,batch_norm_scale,batch_norm_offset,batch_norm_mean,batch_norm_variance;return{depthwise_conv:{filters:extractWeightEntry(prefixDepthwiseConv+"/depthwise_weights",4,mappedPrefixDepthwiseConv+"/filters"),batch_norm_scale:extractWeightEntry(prefixDepthwiseConv+"/BatchNorm/gamma",1,mappedPrefixDepthwiseConv+"/batch_norm_scale"),batch_norm_offset:extractWeightEntry(prefixDepthwiseConv+"/BatchNorm/beta",1,mappedPrefixDepthwiseConv+"/batch_norm_offset"),batch_norm_mean:extractWeightEntry(prefixDepthwiseConv+"/BatchNorm/moving_mean",1,mappedPrefixDepthwiseConv+"/batch_norm_mean"),batch_norm_variance:extractWeightEntry(prefixDepthwiseConv+"/BatchNorm/moving_variance",1,mappedPrefixDepthwiseConv+"/batch_norm_variance")},pointwise_conv:extractPointwiseConvParams("MobilenetV1",idx,mappedPrefixPointwiseConv)}}function extractMobilenetV1Params(){return{conv_0:extractPointwiseConvParams("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:extractConvPairParams(1),conv_2:extractConvPairParams(2),conv_3:extractConvPairParams(3),conv_4:extractConvPairParams(4),conv_5:extractConvPairParams(5),conv_6:extractConvPairParams(6),conv_7:extractConvPairParams(7),conv_8:extractConvPairParams(8),conv_9:extractConvPairParams(9),conv_10:extractConvPairParams(10),conv_11:extractConvPairParams(11),conv_12:extractConvPairParams(12),conv_13:extractConvPairParams(13)}}function extractConvParams(prefix,mappedPrefix){var filters,bias;return{filters:extractWeightEntry(prefix+"/weights",4,mappedPrefix+"/filters"),bias:extractWeightEntry(prefix+"/biases",1,mappedPrefix+"/bias")}}function extractBoxPredictorParams(idx){var box_encoding_predictor,class_predictor;return{box_encoding_predictor:extractConvParams("Prediction/BoxPredictor_"+idx+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+idx+"/box_encoding_predictor"),class_predictor:extractConvParams("Prediction/BoxPredictor_"+idx+"/ClassPredictor","prediction_layer/box_predictor_"+idx+"/class_predictor")}}function extractPredictionLayerParams(){return{conv_0:extractPointwiseConvParams("Prediction",0,"prediction_layer/conv_0"),conv_1:extractPointwiseConvParams("Prediction",1,"prediction_layer/conv_1"),conv_2:extractPointwiseConvParams("Prediction",2,"prediction_layer/conv_2"),conv_3:extractPointwiseConvParams("Prediction",3,"prediction_layer/conv_3"),conv_4:extractPointwiseConvParams("Prediction",4,"prediction_layer/conv_4"),conv_5:extractPointwiseConvParams("Prediction",5,"prediction_layer/conv_5"),conv_6:extractPointwiseConvParams("Prediction",6,"prediction_layer/conv_6"),conv_7:extractPointwiseConvParams("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:extractBoxPredictorParams(0),box_predictor_1:extractBoxPredictorParams(1),box_predictor_2:extractBoxPredictorParams(2),box_predictor_3:extractBoxPredictorParams(3),box_predictor_4:extractBoxPredictorParams(4),box_predictor_5:extractBoxPredictorParams(5)}}return{extractMobilenetV1Params:extractMobilenetV1Params,extractPredictionLayerParams:extractPredictionLayerParams}}function extractParamsFromWeigthMap(weightMap){var paramMappings=[],_a=extractorsFactory(weightMap,paramMappings),extractMobilenetV1Params=_a.extractMobilenetV1Params,extractPredictionLayerParams=_a.extractPredictionLayerParams,extra_dim=weightMap["Output/extra_dim"];if(paramMappings.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!tfjs_image_recognition_base_1.isTensor3D(extra_dim))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+extra_dim);var params={mobilenetv1:extractMobilenetV1Params(),prediction_layer:extractPredictionLayerParams(),output_layer:{extra_dim:extra_dim}};return tfjs_image_recognition_base_1.TfjsImageRecognitionBase.disposeUnusedWeightTensors(weightMap,paramMappings),{params:params,paramMappings:paramMappings}}exports.extractParamsFromWeigthMap=extractParamsFromWeigthMap},{"tfjs-image-recognition-base":568}],365:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),SsdMobilenetv1_1=require("./SsdMobilenetv1");function createSsdMobilenetv1(weights){var net=new SsdMobilenetv1_1.SsdMobilenetv1;return net.extractWeights(weights),net}function createFaceDetectionNet(weights){return createSsdMobilenetv1(weights)}tslib_1.__exportStar(require("./SsdMobilenetv1"),exports),tslib_1.__exportStar(require("./SsdMobilenetv1Options"),exports),exports.createSsdMobilenetv1=createSsdMobilenetv1,exports.createFaceDetectionNet=createFaceDetectionNet;var FaceDetectionNet=function(_super){function FaceDetectionNet(){return null!==_super&&_super.apply(this,arguments)||this}return tslib_1.__extends(FaceDetectionNet,_super),FaceDetectionNet}(SsdMobilenetv1_1.SsdMobilenetv1);exports.FaceDetectionNet=FaceDetectionNet},{"./SsdMobilenetv1":360,"./SsdMobilenetv1Options":361,tslib:588}],366:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tf=require("@tensorflow/tfjs-core"),pointwiseConvLayer_1=require("./pointwiseConvLayer"),epsilon=.0010000000474974513;function depthwiseConvLayer(x,params,strides){return tf.tidy((function(){var out=tf.depthwiseConv2d(x,params.filters,strides,"same");return out=tf.batchNorm(out,params.batch_norm_mean,params.batch_norm_variance,params.batch_norm_offset,params.batch_norm_scale,epsilon),tf.clipByValue(out,0,6)}))}function getStridesForLayerIdx(layerIdx){return[2,4,6,12].some((function(idx){return idx===layerIdx}))?[2,2]:[1,1]}function mobileNetV1(x,params){return tf.tidy((function(){var conv11=null,out=pointwiseConvLayer_1.pointwiseConvLayer(x,params.conv_0,[2,2]),convPairParams;if([params.conv_1,params.conv_2,params.conv_3,params.conv_4,params.conv_5,params.conv_6,params.conv_7,params.conv_8,params.conv_9,params.conv_10,params.conv_11,params.conv_12,params.conv_13].forEach((function(param,i){var layerIdx=i+1,depthwiseConvStrides=getStridesForLayerIdx(layerIdx);out=depthwiseConvLayer(out,param.depthwise_conv,depthwiseConvStrides),out=pointwiseConvLayer_1.pointwiseConvLayer(out,param.pointwise_conv,[1,1]),11===layerIdx&&(conv11=out)})),null===conv11)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:out,conv11:conv11}}))}exports.mobileNetV1=mobileNetV1},{"./pointwiseConvLayer":369,"@tensorflow/tfjs-core":155}],367:[function(require,module,exports){"use strict";function nonMaxSuppression(boxes,scores,maxOutputSize,iouThreshold,scoreThreshold){var numBoxes=boxes.shape[0],outputSize=Math.min(maxOutputSize,numBoxes),candidates=scores.map((function(score,boxIndex){return{score:score,boxIndex:boxIndex}})).filter((function(c){return c.score>scoreThreshold})).sort((function(c1,c2){return c2.score-c1.score})),suppressFunc=function(x){return x<=iouThreshold?1:0},selected=[];return candidates.forEach((function(c){if(!(selected.length>=outputSize)){for(var originalScore=c.score,j=selected.length-1;j>=0;--j){var iou=IOU(boxes,c.boxIndex,selected[j]);if(0!==iou&&(c.score*=suppressFunc(iou),c.score<=scoreThreshold))break}originalScore===c.score&&selected.push(c.boxIndex)}})),selected}function IOU(boxes,i,j){var boxesData=boxes.arraySync(),yminI=Math.min(boxesData[i][0],boxesData[i][2]),xminI=Math.min(boxesData[i][1],boxesData[i][3]),ymaxI=Math.max(boxesData[i][0],boxesData[i][2]),xmaxI=Math.max(boxesData[i][1],boxesData[i][3]),yminJ=Math.min(boxesData[j][0],boxesData[j][2]),xminJ=Math.min(boxesData[j][1],boxesData[j][3]),ymaxJ=Math.max(boxesData[j][0],boxesData[j][2]),xmaxJ=Math.max(boxesData[j][1],boxesData[j][3]),areaI=(ymaxI-yminI)*(xmaxI-xminI),areaJ=(ymaxJ-yminJ)*(xmaxJ-xminJ);if(areaI<=0||areaJ<=0)return 0;var intersectionYmin=Math.max(yminI,yminJ),intersectionXmin=Math.max(xminI,xminJ),intersectionYmax=Math.min(ymaxI,ymaxJ),intersectionXmax=Math.min(xmaxI,xmaxJ),intersectionArea=Math.max(intersectionYmax-intersectionYmin,0)*Math.max(intersectionXmax-intersectionXmin,0);return intersectionArea/(areaI+areaJ-intersectionArea)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.nonMaxSuppression=nonMaxSuppression},{}],368:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tf=require("@tensorflow/tfjs-core");function getCenterCoordinatesAndSizesLayer(x){var vec=tf.unstack(tf.transpose(x,[1,0])),sizes=[tf.sub(vec[2],vec[0]),tf.sub(vec[3],vec[1])],centers;return{sizes:sizes,centers:[tf.add(vec[0],tf.div(sizes[0],tf.scalar(2))),tf.add(vec[1],tf.div(sizes[1],tf.scalar(2)))]}}function decodeBoxesLayer(x0,x1){var _a=getCenterCoordinatesAndSizesLayer(x0),sizes=_a.sizes,centers=_a.centers,vec=tf.unstack(tf.transpose(x1,[1,0])),div0_out=tf.div(tf.mul(tf.exp(tf.div(vec[2],tf.scalar(5))),sizes[0]),tf.scalar(2)),add0_out=tf.add(tf.mul(tf.div(vec[0],tf.scalar(10)),sizes[0]),centers[0]),div1_out=tf.div(tf.mul(tf.exp(tf.div(vec[3],tf.scalar(5))),sizes[1]),tf.scalar(2)),add1_out=tf.add(tf.mul(tf.div(vec[1],tf.scalar(10)),sizes[1]),centers[1]);return tf.transpose(tf.stack([tf.sub(add0_out,div0_out),tf.sub(add1_out,div1_out),tf.add(add0_out,div0_out),tf.add(add1_out,div1_out)]),[1,0])}function outputLayer(boxPredictions,classPredictions,params){return tf.tidy((function(){var batchSize=boxPredictions.shape[0],boxes=decodeBoxesLayer(tf.reshape(tf.tile(params.extra_dim,[batchSize,1,1]),[-1,4]),tf.reshape(boxPredictions,[-1,4]));boxes=tf.reshape(boxes,[batchSize,boxes.shape[0]/batchSize,4]);var scoresAndClasses=tf.sigmoid(tf.slice(classPredictions,[0,0,1],[-1,-1,-1])),scores=tf.slice(scoresAndClasses,[0,0,0],[-1,-1,1]),boxesByBatch,scoresByBatch;return scores=tf.reshape(scores,[batchSize,scores.shape[1]]),{boxes:tf.unstack(boxes),scores:tf.unstack(scores)}}))}exports.outputLayer=outputLayer},{"@tensorflow/tfjs-core":155}],369:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tf=require("@tensorflow/tfjs-core");function pointwiseConvLayer(x,params,strides){return tf.tidy((function(){var out=tf.conv2d(x,params.filters,strides,"same");return out=tf.add(out,params.batch_norm_offset),tf.clipByValue(out,0,6)}))}exports.pointwiseConvLayer=pointwiseConvLayer},{"@tensorflow/tfjs-core":155}],370:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tf=require("@tensorflow/tfjs-core"),boxPredictionLayer_1=require("./boxPredictionLayer"),pointwiseConvLayer_1=require("./pointwiseConvLayer");function predictionLayer(x,conv11,params){return tf.tidy((function(){var conv0=pointwiseConvLayer_1.pointwiseConvLayer(x,params.conv_0,[1,1]),conv1=pointwiseConvLayer_1.pointwiseConvLayer(conv0,params.conv_1,[2,2]),conv2=pointwiseConvLayer_1.pointwiseConvLayer(conv1,params.conv_2,[1,1]),conv3=pointwiseConvLayer_1.pointwiseConvLayer(conv2,params.conv_3,[2,2]),conv4=pointwiseConvLayer_1.pointwiseConvLayer(conv3,params.conv_4,[1,1]),conv5=pointwiseConvLayer_1.pointwiseConvLayer(conv4,params.conv_5,[2,2]),conv6=pointwiseConvLayer_1.pointwiseConvLayer(conv5,params.conv_6,[1,1]),conv7=pointwiseConvLayer_1.pointwiseConvLayer(conv6,params.conv_7,[2,2]),boxPrediction0=boxPredictionLayer_1.boxPredictionLayer(conv11,params.box_predictor_0),boxPrediction1=boxPredictionLayer_1.boxPredictionLayer(x,params.box_predictor_1),boxPrediction2=boxPredictionLayer_1.boxPredictionLayer(conv1,params.box_predictor_2),boxPrediction3=boxPredictionLayer_1.boxPredictionLayer(conv3,params.box_predictor_3),boxPrediction4=boxPredictionLayer_1.boxPredictionLayer(conv5,params.box_predictor_4),boxPrediction5=boxPredictionLayer_1.boxPredictionLayer(conv7,params.box_predictor_5),boxPredictions,classPredictions;return{boxPredictions:tf.concat([boxPrediction0.boxPredictionEncoding,boxPrediction1.boxPredictionEncoding,boxPrediction2.boxPredictionEncoding,boxPrediction3.boxPredictionEncoding,boxPrediction4.boxPredictionEncoding,boxPrediction5.boxPredictionEncoding],1),classPredictions:tf.concat([boxPrediction0.classPrediction,boxPrediction1.classPrediction,boxPrediction2.classPrediction,boxPrediction3.classPrediction,boxPrediction4.classPrediction,boxPrediction5.classPrediction],1)}}))}exports.predictionLayer=predictionLayer},{"./boxPredictionLayer":362,"./pointwiseConvLayer":369,"@tensorflow/tfjs-core":155}],371:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),tfjs_image_recognition_base_1=require("tfjs-image-recognition-base"),classes_1=require("../classes"),const_1=require("./const"),TinyFaceDetector=function(_super){function TinyFaceDetector(){var _this=this,config={withSeparableConvs:!0,iouThreshold:const_1.IOU_THRESHOLD,classes:["face"],anchors:const_1.BOX_ANCHORS,meanRgb:const_1.MEAN_RGB,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]};return _this=_super.call(this,config)||this}return tslib_1.__extends(TinyFaceDetector,_super),Object.defineProperty(TinyFaceDetector.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),TinyFaceDetector.prototype.locateFaces=function(input,forwardParams){return tslib_1.__awaiter(this,void 0,void 0,(function(){var objectDetections;return tslib_1.__generator(this,(function(_a){switch(_a.label){case 0:return[4,this.detect(input,forwardParams)];case 1:return[2,(objectDetections=_a.sent()).map((function(det){return new classes_1.FaceDetection(det.score,det.relativeBox,{width:det.imageWidth,height:det.imageHeight})}))]}}))}))},TinyFaceDetector.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},TinyFaceDetector.prototype.extractParamsFromWeigthMap=function(weightMap){return _super.prototype.extractParamsFromWeigthMap.call(this,weightMap)},TinyFaceDetector}(tfjs_image_recognition_base_1.TfjsImageRecognitionBase.TinyYolov2);exports.TinyFaceDetector=TinyFaceDetector},{"../classes":278,"./const":373,"tfjs-image-recognition-base":568,tslib:588}],372:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),tfjs_image_recognition_base_1,TinyFaceDetectorOptions=function(_super){function TinyFaceDetectorOptions(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this._name="TinyFaceDetectorOptions",_this}return tslib_1.__extends(TinyFaceDetectorOptions,_super),TinyFaceDetectorOptions}(require("tfjs-image-recognition-base").TfjsImageRecognitionBase.TinyYolov2Options);exports.TinyFaceDetectorOptions=TinyFaceDetectorOptions},{"tfjs-image-recognition-base":568,tslib:588}],373:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tfjs_image_recognition_base_1=require("tfjs-image-recognition-base");exports.IOU_THRESHOLD=.4,exports.BOX_ANCHORS=[new tfjs_image_recognition_base_1.Point(1.603231,2.094468),new tfjs_image_recognition_base_1.Point(6.041143,7.080126),new tfjs_image_recognition_base_1.Point(2.882459,3.518061),new tfjs_image_recognition_base_1.Point(4.266906,5.178857),new tfjs_image_recognition_base_1.Point(9.041765,10.66308)],exports.MEAN_RGB=[117.001,114.697,97.404]},{"tfjs-image-recognition-base":568}],374:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),TinyFaceDetector_1=require("./TinyFaceDetector");function createTinyFaceDetector(weights){var net=new TinyFaceDetector_1.TinyFaceDetector;return net.extractWeights(weights),net}tslib_1.__exportStar(require("./TinyFaceDetector"),exports),tslib_1.__exportStar(require("./TinyFaceDetectorOptions"),exports),exports.createTinyFaceDetector=createTinyFaceDetector},{"./TinyFaceDetector":371,"./TinyFaceDetectorOptions":372,tslib:588}],375:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),tfjs_image_recognition_base_1=require("tfjs-image-recognition-base"),classes_1=require("../classes"),const_1=require("./const"),TinyYolov2=function(_super){function TinyYolov2(withSeparableConvs){void 0===withSeparableConvs&&(withSeparableConvs=!0);var _this=this,config=Object.assign({},{withSeparableConvs:withSeparableConvs,iouThreshold:const_1.IOU_THRESHOLD,classes:["face"]},withSeparableConvs?{anchors:const_1.BOX_ANCHORS_SEPARABLE,meanRgb:const_1.MEAN_RGB_SEPARABLE}:{anchors:const_1.BOX_ANCHORS,withClassScores:!0});return _this=_super.call(this,config)||this}return tslib_1.__extends(TinyYolov2,_super),Object.defineProperty(TinyYolov2.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(TinyYolov2.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),TinyYolov2.prototype.locateFaces=function(input,forwardParams){return tslib_1.__awaiter(this,void 0,void 0,(function(){var objectDetections;return tslib_1.__generator(this,(function(_a){switch(_a.label){case 0:return[4,this.detect(input,forwardParams)];case 1:return[2,(objectDetections=_a.sent()).map((function(det){return new classes_1.FaceDetection(det.score,det.relativeBox,{width:det.imageWidth,height:det.imageHeight})}))]}}))}))},TinyYolov2.prototype.getDefaultModelName=function(){return this.withSeparableConvs?const_1.DEFAULT_MODEL_NAME_SEPARABLE_CONV:const_1.DEFAULT_MODEL_NAME},TinyYolov2.prototype.extractParamsFromWeigthMap=function(weightMap){return _super.prototype.extractParamsFromWeigthMap.call(this,weightMap)},TinyYolov2}(tfjs_image_recognition_base_1.TfjsImageRecognitionBase.TinyYolov2);exports.TinyYolov2=TinyYolov2},{"../classes":278,"./const":376,"tfjs-image-recognition-base":568,tslib:588}],376:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tfjs_image_recognition_base_1=require("tfjs-image-recognition-base");exports.IOU_THRESHOLD=.4,exports.BOX_ANCHORS=[new tfjs_image_recognition_base_1.Point(.738768,.874946),new tfjs_image_recognition_base_1.Point(2.42204,2.65704),new tfjs_image_recognition_base_1.Point(4.30971,7.04493),new tfjs_image_recognition_base_1.Point(10.246,4.59428),new tfjs_image_recognition_base_1.Point(12.6868,11.8741)],exports.BOX_ANCHORS_SEPARABLE=[new tfjs_image_recognition_base_1.Point(1.603231,2.094468),new tfjs_image_recognition_base_1.Point(6.041143,7.080126),new tfjs_image_recognition_base_1.Point(2.882459,3.518061),new tfjs_image_recognition_base_1.Point(4.266906,5.178857),new tfjs_image_recognition_base_1.Point(9.041765,10.66308)],exports.MEAN_RGB_SEPARABLE=[117.001,114.697,97.404],exports.DEFAULT_MODEL_NAME="tiny_yolov2_model",exports.DEFAULT_MODEL_NAME_SEPARABLE_CONV="tiny_yolov2_separable_conv_model"},{"tfjs-image-recognition-base":568}],377:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var TinyYolov2_1=require("./TinyYolov2");function createTinyYolov2(weights,withSeparableConvs){void 0===withSeparableConvs&&(withSeparableConvs=!0);var net=new TinyYolov2_1.TinyYolov2(withSeparableConvs);return net.extractWeights(weights),net}exports.TinyYolov2=TinyYolov2_1.TinyYolov2,exports.createTinyYolov2=createTinyYolov2},{"./TinyYolov2":375}],378:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),tf=require("@tensorflow/tfjs-core"),tfjs_image_recognition_base_1=require("tfjs-image-recognition-base"),depthwiseSeparableConv_1=require("../common/depthwiseSeparableConv"),extractParams_1=require("./extractParams"),extractParamsFromWeigthMap_1=require("./extractParamsFromWeigthMap");function conv(x,params,stride){return tf.add(tf.conv2d(x,params.filters,stride,"same"),params.bias)}function reductionBlock(x,params,isActivateInput){void 0===isActivateInput&&(isActivateInput=!0);var out=isActivateInput?tf.relu(x):x;return out=depthwiseSeparableConv_1.depthwiseSeparableConv(out,params.separable_conv0,[1,1]),out=depthwiseSeparableConv_1.depthwiseSeparableConv(tf.relu(out),params.separable_conv1,[1,1]),out=tf.maxPool(out,[3,3],[2,2],"same"),out=tf.add(out,conv(x,params.expansion_conv,[2,2]))}function mainBlock(x,params){var out=depthwiseSeparableConv_1.depthwiseSeparableConv(tf.relu(x),params.separable_conv0,[1,1]);return out=depthwiseSeparableConv_1.depthwiseSeparableConv(tf.relu(out),params.separable_conv1,[1,1]),out=depthwiseSeparableConv_1.depthwiseSeparableConv(tf.relu(out),params.separable_conv2,[1,1]),out=tf.add(out,x)}var TinyXception=function(_super){function TinyXception(numMainBlocks){var _this=_super.call(this,"TinyXception")||this;return _this._numMainBlocks=numMainBlocks,_this}return tslib_1.__extends(TinyXception,_super),TinyXception.prototype.forwardInput=function(input){var _this=this,params=this.params;if(!params)throw new Error("TinyXception - load model before inference");return tf.tidy((function(){var batchTensor=input.toBatchTensor(112,!0),meanRgb=[122.782,117.001,104.298],normalized=tfjs_image_recognition_base_1.normalize(batchTensor,meanRgb).div(tf.scalar(256)),out=tf.relu(conv(normalized,params.entry_flow.conv_in,[2,2]));return out=reductionBlock(out,params.entry_flow.reduction_block_0,!1),out=reductionBlock(out,params.entry_flow.reduction_block_1),tfjs_image_recognition_base_1.range(_this._numMainBlocks,0,1).forEach((function(idx){out=mainBlock(out,params.middle_flow["main_block_"+idx])})),out=reductionBlock(out,params.exit_flow.reduction_block),out=tf.relu(depthwiseSeparableConv_1.depthwiseSeparableConv(out,params.exit_flow.separable_conv,[1,1]))}))},TinyXception.prototype.forward=function(input){return tslib_1.__awaiter(this,void 0,void 0,(function(){var _a;return tslib_1.__generator(this,(function(_b){switch(_b.label){case 0:return _a=this.forwardInput,[4,tfjs_image_recognition_base_1.toNetInput(input)];case 1:return[2,_a.apply(this,[_b.sent()])]}}))}))},TinyXception.prototype.getDefaultModelName=function(){return"tiny_xception_model"},TinyXception.prototype.extractParamsFromWeigthMap=function(weightMap){return extractParamsFromWeigthMap_1.extractParamsFromWeigthMap(weightMap,this._numMainBlocks)},TinyXception.prototype.extractParams=function(weights){return extractParams_1.extractParams(weights,this._numMainBlocks)},TinyXception}(tfjs_image_recognition_base_1.NeuralNetwork);exports.TinyXception=TinyXception},{"../common/depthwiseSeparableConv":279,"./extractParams":379,"./extractParamsFromWeigthMap":380,"@tensorflow/tfjs-core":155,"tfjs-image-recognition-base":568,tslib:588}],379:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tfjs_image_recognition_base_1=require("tfjs-image-recognition-base");function extractorsFactory(extractWeights,paramMappings){var extractConvParams=tfjs_image_recognition_base_1.TfjsImageRecognitionBase.extractConvParamsFactory(extractWeights,paramMappings),extractSeparableConvParams=tfjs_image_recognition_base_1.TfjsImageRecognitionBase.extractSeparableConvParamsFactory(extractWeights,paramMappings);function extractReductionBlockParams(channelsIn,channelsOut,mappedPrefix){var separable_conv0,separable_conv1,expansion_conv;return{separable_conv0:extractSeparableConvParams(channelsIn,channelsOut,mappedPrefix+"/separable_conv0"),separable_conv1:extractSeparableConvParams(channelsOut,channelsOut,mappedPrefix+"/separable_conv1"),expansion_conv:extractConvParams(channelsIn,channelsOut,1,mappedPrefix+"/expansion_conv")}}function extractMainBlockParams(channels,mappedPrefix){var separable_conv0,separable_conv1,separable_conv2;return{separable_conv0:extractSeparableConvParams(channels,channels,mappedPrefix+"/separable_conv0"),separable_conv1:extractSeparableConvParams(channels,channels,mappedPrefix+"/separable_conv1"),separable_conv2:extractSeparableConvParams(channels,channels,mappedPrefix+"/separable_conv2")}}return{extractConvParams:extractConvParams,extractSeparableConvParams:extractSeparableConvParams,extractReductionBlockParams:extractReductionBlockParams,extractMainBlockParams:extractMainBlockParams}}function extractParams(weights,numMainBlocks){var paramMappings=[],_a=tfjs_image_recognition_base_1.TfjsImageRecognitionBase.extractWeightsFactory(weights),extractWeights=_a.extractWeights,getRemainingWeights=_a.getRemainingWeights,_b=extractorsFactory(extractWeights,paramMappings),extractConvParams=_b.extractConvParams,extractSeparableConvParams=_b.extractSeparableConvParams,extractReductionBlockParams=_b.extractReductionBlockParams,extractMainBlockParams=_b.extractMainBlockParams,entry_flow_conv_in,entry_flow_reduction_block_0,entry_flow_reduction_block_1,entry_flow={conv_in:extractConvParams(3,32,3,"entry_flow/conv_in"),reduction_block_0:extractReductionBlockParams(32,64,"entry_flow/reduction_block_0"),reduction_block_1:extractReductionBlockParams(64,128,"entry_flow/reduction_block_1")},middle_flow={};tfjs_image_recognition_base_1.range(numMainBlocks,0,1).forEach((function(idx){middle_flow["main_block_"+idx]=extractMainBlockParams(128,"middle_flow/main_block_"+idx)}));var exit_flow_reduction_block,exit_flow_separable_conv,exit_flow={reduction_block:extractReductionBlockParams(128,256,"exit_flow/reduction_block"),separable_conv:extractSeparableConvParams(256,512,"exit_flow/separable_conv")};if(0!==getRemainingWeights().length)throw new Error("weights remaing after extract: "+getRemainingWeights().length);return{paramMappings:paramMappings,params:{entry_flow:entry_flow,middle_flow:middle_flow,exit_flow:exit_flow}}}exports.extractParams=extractParams},{"tfjs-image-recognition-base":568}],380:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tfjs_image_recognition_base_1=require("tfjs-image-recognition-base"),loadConvParamsFactory_1=require("../common/loadConvParamsFactory");function loadParamsFactory(weightMap,paramMappings){var extractWeightEntry=tfjs_image_recognition_base_1.TfjsImageRecognitionBase.extractWeightEntryFactory(weightMap,paramMappings),extractConvParams=loadConvParamsFactory_1.loadConvParamsFactory(extractWeightEntry),extractSeparableConvParams=tfjs_image_recognition_base_1.TfjsImageRecognitionBase.loadSeparableConvParamsFactory(extractWeightEntry);function extractReductionBlockParams(mappedPrefix){var separable_conv0,separable_conv1,expansion_conv;return{separable_conv0:extractSeparableConvParams(mappedPrefix+"/separable_conv0"),separable_conv1:extractSeparableConvParams(mappedPrefix+"/separable_conv1"),expansion_conv:extractConvParams(mappedPrefix+"/expansion_conv")}}function extractMainBlockParams(mappedPrefix){var separable_conv0,separable_conv1,separable_conv2;return{separable_conv0:extractSeparableConvParams(mappedPrefix+"/separable_conv0"),separable_conv1:extractSeparableConvParams(mappedPrefix+"/separable_conv1"),separable_conv2:extractSeparableConvParams(mappedPrefix+"/separable_conv2")}}return{extractConvParams:extractConvParams,extractSeparableConvParams:extractSeparableConvParams,extractReductionBlockParams:extractReductionBlockParams,extractMainBlockParams:extractMainBlockParams}}function extractParamsFromWeigthMap(weightMap,numMainBlocks){var paramMappings=[],_a=loadParamsFactory(weightMap,paramMappings),extractConvParams=_a.extractConvParams,extractSeparableConvParams=_a.extractSeparableConvParams,extractReductionBlockParams=_a.extractReductionBlockParams,extractMainBlockParams=_a.extractMainBlockParams,entry_flow_conv_in,entry_flow_reduction_block_0,entry_flow_reduction_block_1,entry_flow={conv_in:extractConvParams("entry_flow/conv_in"),reduction_block_0:extractReductionBlockParams("entry_flow/reduction_block_0"),reduction_block_1:extractReductionBlockParams("entry_flow/reduction_block_1")},middle_flow={};tfjs_image_recognition_base_1.range(numMainBlocks,0,1).forEach((function(idx){middle_flow["main_block_"+idx]=extractMainBlockParams("middle_flow/main_block_"+idx)}));var exit_flow_reduction_block,exit_flow_separable_conv,exit_flow={reduction_block:extractReductionBlockParams("exit_flow/reduction_block"),separable_conv:extractSeparableConvParams("exit_flow/separable_conv")};return tfjs_image_recognition_base_1.TfjsImageRecognitionBase.disposeUnusedWeightTensors(weightMap,paramMappings),{params:{entry_flow:entry_flow,middle_flow:middle_flow,exit_flow:exit_flow},paramMappings:paramMappings}}exports.extractParamsFromWeigthMap=extractParamsFromWeigthMap},{"../common/loadConvParamsFactory":281,"tfjs-image-recognition-base":568}],381:[function(require,module,exports){const debug=require("debug")("h264-profile-level-id");debug.log=console.info.bind(console);const ProfileConstrainedBaseline=1,ProfileBaseline=2,ProfileMain=3,ProfileConstrainedHigh=4,ProfileHigh=5;exports.ProfileConstrainedBaseline=1,exports.ProfileBaseline=2,exports.ProfileMain=3,exports.ProfileConstrainedHigh=4,exports.ProfileHigh=5;const Level1_b=0,Level1=10,Level1_1=11,Level1_2=12,Level1_3=13,Level2=20,Level2_1=21,Level2_2=22,Level3=30,Level3_1=31,Level3_2=32,Level4=40,Level4_1=41,Level4_2=42,Level5=50,Level5_1=51,Level5_2=52;exports.Level1_b=0,exports.Level1=10,exports.Level1_1=11,exports.Level1_2=12,exports.Level1_3=13,exports.Level2=20,exports.Level2_1=21,exports.Level2_2=22,exports.Level3=30,exports.Level3_1=31,exports.Level3_2=32,exports.Level4=40,exports.Level4_1=41,exports.Level4_2=42,exports.Level5=50,exports.Level5_1=51,exports.Level5_2=52;class ProfileLevelId{constructor(profile,level){this.profile=profile,this.level=level}}exports.ProfileLevelId=ProfileLevelId;const DefaultProfileLevelId=new ProfileLevelId(1,31),ConstraintSet3Flag=16;class BitPattern{constructor(str){this._mask=~byteMaskString("x",str),this._maskedValue=byteMaskString("1",str)}isMatch(value){return this._maskedValue===(value&this._mask)}}class ProfilePattern{constructor(profile_idc,profile_iop,profile){this.profile_idc=profile_idc,this.profile_iop=profile_iop,this.profile=profile}}const ProfilePatterns=[new ProfilePattern(66,new BitPattern("x1xx0000"),1),new ProfilePattern(77,new BitPattern("1xxx0000"),1),new ProfilePattern(88,new BitPattern("11xx0000"),1),new ProfilePattern(66,new BitPattern("x0xx0000"),2),new ProfilePattern(88,new BitPattern("10xx0000"),2),new ProfilePattern(77,new BitPattern("0x0x0000"),3),new ProfilePattern(100,new BitPattern("00000000"),5),new ProfilePattern(100,new BitPattern("00001100"),4)];function byteMaskString(c,str){return(str[0]===c)<<7|(str[1]===c)<<6|(str[2]===c)<<5|(str[3]===c)<<4|(str[4]===c)<<3|(str[5]===c)<<2|(str[6]===c)<<1|(str[7]===c)<<0}function isLessLevel(a,b){return 0===a?10!==b&&0!==b:0===b?10!==a:a<b}function minLevel(a,b){return isLessLevel(a,b)?a:b}function isLevelAsymmetryAllowed(params={}){const level_asymmetry_allowed=params["level-asymmetry-allowed"];return 1===level_asymmetry_allowed||"1"===level_asymmetry_allowed}exports.parseProfileLevelId=function(str){if("string"!=typeof str||6!==str.length)return null;const profile_level_id_numeric=parseInt(str,16);if(0===profile_level_id_numeric)return null;const level_idc=255&profile_level_id_numeric,profile_iop=profile_level_id_numeric>>8&255,profile_idc=profile_level_id_numeric>>16&255;let level;switch(level_idc){case 11:level=0!=(16&profile_iop)?0:11;break;case 10:case 12:case 13:case 20:case 21:case 22:case 30:case 31:case 32:case 40:case 41:case 42:case 50:case 51:case 52:level=level_idc;break;default:return debug("parseProfileLevelId() | unrecognized level_idc:%s",level_idc),null}for(const pattern of ProfilePatterns)if(profile_idc===pattern.profile_idc&&pattern.profile_iop.isMatch(profile_iop))return new ProfileLevelId(pattern.profile,level);return debug("parseProfileLevelId() | unrecognized profile_idc/profile_iop combination"),null},exports.profileLevelIdToString=function(profile_level_id){if(0==profile_level_id.level)switch(profile_level_id.profile){case 1:return"42f00b";case 2:return"42100b";case 3:return"4d100b";default:return debug("profileLevelIdToString() | Level 1_b not is allowed for profile:%s",profile_level_id.profile),null}let profile_idc_iop_string;switch(profile_level_id.profile){case 1:profile_idc_iop_string="42e0";break;case 2:profile_idc_iop_string="4200";break;case 3:profile_idc_iop_string="4d00";break;case 4:profile_idc_iop_string="640c";break;case 5:profile_idc_iop_string="6400";break;default:return debug("profileLevelIdToString() | unrecognized profile:%s",profile_level_id.profile),null}let levelStr=profile_level_id.level.toString(16);return 1===levelStr.length&&(levelStr=`0${levelStr}`),`${profile_idc_iop_string}${levelStr}`},exports.parseSdpProfileLevelId=function(params={}){const profile_level_id=params["profile-level-id"];return profile_level_id?exports.parseProfileLevelId(profile_level_id):DefaultProfileLevelId},exports.isSameProfile=function(params1={},params2={}){const profile_level_id_1=exports.parseSdpProfileLevelId(params1),profile_level_id_2=exports.parseSdpProfileLevelId(params2);return Boolean(profile_level_id_1&&profile_level_id_2&&profile_level_id_1.profile===profile_level_id_2.profile)},exports.generateProfileLevelIdForAnswer=function(local_supported_params={},remote_offered_params={}){if(!local_supported_params["profile-level-id"]&&!remote_offered_params["profile-level-id"])return debug("generateProfileLevelIdForAnswer() | no profile-level-id in local and remote params"),null;const local_profile_level_id=exports.parseSdpProfileLevelId(local_supported_params),remote_profile_level_id=exports.parseSdpProfileLevelId(remote_offered_params);if(!local_profile_level_id)throw new TypeError("invalid local_profile_level_id");if(!remote_profile_level_id)throw new TypeError("invalid remote_profile_level_id");if(local_profile_level_id.profile!==remote_profile_level_id.profile)throw new TypeError("H264 Profile mismatch");const level_asymmetry_allowed=isLevelAsymmetryAllowed(local_supported_params)&&isLevelAsymmetryAllowed(remote_offered_params),local_level=local_profile_level_id.level,remote_level=remote_profile_level_id.level,min_level=minLevel(local_level,remote_level),answer_level=level_asymmetry_allowed?local_level:min_level;return debug("generateProfileLevelIdForAnswer() | result: [profile:%s, level:%s]",local_profile_level_id.profile,answer_level),exports.profileLevelIdToString(new ProfileLevelId(local_profile_level_id.profile,answer_level))}},{debug:260}],382:[function(require,module,exports){var WildEmitter=require("wildemitter"),audioContextType;function getMaxVolume(analyser,fftBins){var maxVolume=-1/0;analyser.getFloatFrequencyData(fftBins);for(var i=4,ii=fftBins.length;i<ii;i++)fftBins[i]>maxVolume&&fftBins[i]<0&&(maxVolume=fftBins[i]);return maxVolume}"undefined"!=typeof window&&(audioContextType=window.AudioContext||window.webkitAudioContext);var audioContext=null;module.exports=function(stream,options){var harker=new WildEmitter;if(!audioContextType)return harker;var options,smoothing=(options=options||{}).smoothing||.1,interval=options.interval||50,threshold=options.threshold,play=options.play,history=options.history||10,running=!0,sourceNode,fftBins,analyser;audioContext=options.audioContext||audioContext||new audioContextType,(analyser=audioContext.createAnalyser()).fftSize=512,analyser.smoothingTimeConstant=smoothing,fftBins=new Float32Array(analyser.frequencyBinCount),stream.jquery&&(stream=stream[0]),stream instanceof HTMLAudioElement||stream instanceof HTMLVideoElement?(sourceNode=audioContext.createMediaElementSource(stream),void 0===play&&(play=!0),threshold=threshold||-50):(sourceNode=audioContext.createMediaStreamSource(stream),threshold=threshold||-50),sourceNode.connect(analyser),play&&analyser.connect(audioContext.destination),harker.speaking=!1,harker.suspend=function(){return audioContext.suspend()},harker.resume=function(){return audioContext.resume()},Object.defineProperty(harker,"state",{get:function(){return audioContext.state}}),audioContext.onstatechange=function(){harker.emit("state_change",audioContext.state)},harker.setThreshold=function(t){threshold=t},harker.setInterval=function(i){interval=i},harker.stop=function(){running=!1,harker.emit("volume_change",-100,threshold),harker.speaking&&(harker.speaking=!1,harker.emit("stopped_speaking")),analyser.disconnect(),sourceNode.disconnect()},harker.speakingHistory=[];for(var i=0;i<history;i++)harker.speakingHistory.push(0);var looper=function(){setTimeout((function(){if(running){var currentVolume=getMaxVolume(analyser,fftBins);harker.emit("volume_change",currentVolume,threshold);var history=0;if(currentVolume>threshold&&!harker.speaking){for(var i=harker.speakingHistory.length-3;i<harker.speakingHistory.length;i++)history+=harker.speakingHistory[i];history>=2&&(harker.speaking=!0,harker.emit("speaking"))}else if(currentVolume<threshold&&harker.speaking){for(var i=0;i<harker.speakingHistory.length;i++)history+=harker.speakingHistory[i];0==history&&(harker.speaking=!1,harker.emit("stopped_speaking"))}harker.speakingHistory.shift(),harker.speakingHistory.push(0+(currentVolume>threshold)),looper()}}),interval)};return looper(),harker}},{wildemitter:595}],383:[function(require,module,exports){"use strict";var reactIs=require("react-is"),REACT_STATICS={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},KNOWN_STATICS={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},FORWARD_REF_STATICS={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},MEMO_STATICS={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},TYPE_STATICS={};function getStatics(component){return reactIs.isMemo(component)?MEMO_STATICS:TYPE_STATICS[component.$$typeof]||REACT_STATICS}TYPE_STATICS[reactIs.ForwardRef]=FORWARD_REF_STATICS,TYPE_STATICS[reactIs.Memo]=MEMO_STATICS;var defineProperty=Object.defineProperty,getOwnPropertyNames=Object.getOwnPropertyNames,getOwnPropertySymbols=Object.getOwnPropertySymbols,getOwnPropertyDescriptor=Object.getOwnPropertyDescriptor,getPrototypeOf=Object.getPrototypeOf,objectPrototype=Object.prototype;function hoistNonReactStatics(targetComponent,sourceComponent,blacklist){if("string"!=typeof sourceComponent){if(objectPrototype){var inheritedComponent=getPrototypeOf(sourceComponent);inheritedComponent&&inheritedComponent!==objectPrototype&&hoistNonReactStatics(targetComponent,inheritedComponent,blacklist)}var keys=getOwnPropertyNames(sourceComponent);getOwnPropertySymbols&&(keys=keys.concat(getOwnPropertySymbols(sourceComponent)));for(var targetStatics=getStatics(targetComponent),sourceStatics=getStatics(sourceComponent),i=0;i<keys.length;++i){var key=keys[i];if(!(KNOWN_STATICS[key]||blacklist&&blacklist[key]||sourceStatics&&sourceStatics[key]||targetStatics&&targetStatics[key])){var descriptor=getOwnPropertyDescriptor(sourceComponent,key);try{defineProperty(targetComponent,key,descriptor)}catch(e){}}}}return targetComponent}module.exports=hoistNonReactStatics},{"react-is":444}],384:[function(require,module,exports){
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,nBits=-7,i=isLE?nBytes-1:0,d=isLE?-1:1,s=buffer[offset+i];for(i+=d,e=s&(1<<-nBits)-1,s>>=-nBits,nBits+=eLen;nBits>0;e=256*e+buffer[offset+i],i+=d,nBits-=8);for(m=e&(1<<-nBits)-1,e>>=-nBits,nBits+=mLen;nBits>0;m=256*m+buffer[offset+i],i+=d,nBits-=8);if(0===e)e=1-eBias;else{if(e===eMax)return m?NaN:1/0*(s?-1:1);m+=Math.pow(2,mLen),e-=eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)},exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,rt=23===mLen?Math.pow(2,-24)-Math.pow(2,-77):0,i=isLE?0:nBytes-1,d=isLE?1:-1,s=value<0||0===value&&1/value<0?1:0;for(value=Math.abs(value),isNaN(value)||value===1/0?(m=isNaN(value)?1:0,e=eMax):(e=Math.floor(Math.log(value)/Math.LN2),value*(c=Math.pow(2,-e))<1&&(e--,c*=2),(value+=e+eBias>=1?rt/c:rt*Math.pow(2,1-eBias))*c>=2&&(e++,c/=2),e+eBias>=eMax?(m=0,e=eMax):e+eBias>=1?(m=(value*c-1)*Math.pow(2,mLen),e+=eBias):(m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen),e=0));mLen>=8;buffer[offset+i]=255&m,i+=d,m/=256,mLen-=8);for(e=e<<mLen|m,eLen+=mLen;eLen>0;buffer[offset+i]=255&e,i+=d,e/=256,eLen-=8);buffer[offset+i-d]|=128*s}},{}],385:[function(require,module,exports){!function(factory){var registeredInModuleLoader;if("function"==typeof define&&define.amd&&(define(factory),registeredInModuleLoader=!0),"object"==typeof exports&&(module.exports=factory(),registeredInModuleLoader=!0),!registeredInModuleLoader){var OldCookies=window.Cookies,api=window.Cookies=factory();api.noConflict=function(){return window.Cookies=OldCookies,api}}}((function(){function extend(){for(var i=0,result={};i<arguments.length;i++){var attributes=arguments[i];for(var key in attributes)result[key]=attributes[key]}return result}function decode(s){return s.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}function init(converter){function api(){}function set(key,value,attributes){if("undefined"!=typeof document){"number"==typeof(attributes=extend({path:"/"},api.defaults,attributes)).expires&&(attributes.expires=new Date(1*new Date+864e5*attributes.expires)),attributes.expires=attributes.expires?attributes.expires.toUTCString():"";try{var result=JSON.stringify(value);/^[\{\[]/.test(result)&&(value=result)}catch(e){}value=converter.write?converter.write(value,key):encodeURIComponent(String(value)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),key=encodeURIComponent(String(key)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var stringifiedAttributes="";for(var attributeName in attributes)attributes[attributeName]&&(stringifiedAttributes+="; "+attributeName,!0!==attributes[attributeName]&&(stringifiedAttributes+="="+attributes[attributeName].split(";")[0]));return document.cookie=key+"="+value+stringifiedAttributes}}function get(key,json){if("undefined"!=typeof document){for(var jar={},cookies=document.cookie?document.cookie.split("; "):[],i=0;i<cookies.length;i++){var parts=cookies[i].split("="),cookie=parts.slice(1).join("=");json||'"'!==cookie.charAt(0)||(cookie=cookie.slice(1,-1));try{var name=decode(parts[0]);if(cookie=(converter.read||converter)(cookie,name)||decode(cookie),json)try{cookie=JSON.parse(cookie)}catch(e){}if(jar[name]=cookie,key===name)break}catch(e){}}return key?jar[key]:jar}}return api.set=set,api.get=function(key){return get(key,!1)},api.getJSON=function(key){return get(key,!0)},api.remove=function(key,attributes){set(key,"",extend(attributes,{expires:-1}))},api.defaults={},api.withConverter=init,api}return init((function(){}))}))},{}],386:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Consumer=void 0;const Logger_1=require("./Logger"),EnhancedEventEmitter_1=require("./EnhancedEventEmitter"),errors_1=require("./errors"),logger=new Logger_1.Logger("Consumer");class Consumer extends EnhancedEventEmitter_1.EnhancedEventEmitter{constructor({id:id,localId:localId,producerId:producerId,rtpReceiver:rtpReceiver,track:track,rtpParameters:rtpParameters,appData:appData}){super(),this._closed=!1,this._observer=new EnhancedEventEmitter_1.EnhancedEventEmitter,logger.debug("constructor()"),this._id=id,this._localId=localId,this._producerId=producerId,this._rtpReceiver=rtpReceiver,this._track=track,this._rtpParameters=rtpParameters,this._paused=!track.enabled,this._appData=appData,this._onTrackEnded=this._onTrackEnded.bind(this),this._handleTrack()}get id(){return this._id}get localId(){return this._localId}get producerId(){return this._producerId}get closed(){return this._closed}get kind(){return this._track.kind}get rtpReceiver(){return this._rtpReceiver}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get appData(){return this._appData}set appData(appData){throw new Error("cannot override appData object")}get observer(){return this._observer}close(){this._closed||(logger.debug("close()"),this._closed=!0,this._destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(logger.debug("transportClosed()"),this._closed=!0,this._destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}async getStats(){if(this._closed)throw new errors_1.InvalidStateError("closed");return this.safeEmitAsPromise("@getstats")}pause(){logger.debug("pause()"),this._closed?logger.error("pause() | Consumer closed"):(this._paused=!0,this._track.enabled=!1,this._observer.safeEmit("pause"))}resume(){logger.debug("resume()"),this._closed?logger.error("resume() | Consumer closed"):(this._paused=!1,this._track.enabled=!0,this._observer.safeEmit("resume"))}_onTrackEnded(){logger.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}_handleTrack(){this._track.addEventListener("ended",this._onTrackEnded)}_destroyTrack(){try{this._track.removeEventListener("ended",this._onTrackEnded),this._track.stop()}catch(error){}}}exports.Consumer=Consumer},{"./EnhancedEventEmitter":390,"./Logger":391,"./errors":396}],387:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.DataConsumer=void 0;const Logger_1=require("./Logger"),EnhancedEventEmitter_1=require("./EnhancedEventEmitter"),logger=new Logger_1.Logger("DataConsumer");class DataConsumer extends EnhancedEventEmitter_1.EnhancedEventEmitter{constructor({id:id,dataProducerId:dataProducerId,dataChannel:dataChannel,sctpStreamParameters:sctpStreamParameters,appData:appData}){super(),this._closed=!1,this._observer=new EnhancedEventEmitter_1.EnhancedEventEmitter,logger.debug("constructor()"),this._id=id,this._dataProducerId=dataProducerId,this._dataChannel=dataChannel,this._sctpStreamParameters=sctpStreamParameters,this._appData=appData,this._handleDataChannel()}get id(){return this._id}get dataProducerId(){return this._dataProducerId}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get binaryType(){return this._dataChannel.binaryType}set binaryType(binaryType){this._dataChannel.binaryType=binaryType}get appData(){return this._appData}set appData(appData){throw new Error("cannot override appData object")}get observer(){return this._observer}close(){this._closed||(logger.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(logger.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}_handleDataChannel(){this._dataChannel.addEventListener("open",()=>{this._closed||(logger.debug('DataChannel "open" event'),this.safeEmit("open"))}),this._dataChannel.addEventListener("error",event=>{if(this._closed)return;let{error:error}=event;error||(error=new Error("unknown DataChannel error")),"sctp-failure"===error.errorDetail?logger.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",error.sctpCauseCode,error.message):logger.error('DataChannel "error" event: %o',error),this.safeEmit("error",error)}),this._dataChannel.addEventListener("close",()=>{this._closed||(logger.warn('DataChannel "close" event'),this._closed=!0,this.emit("@close"),this.safeEmit("close"))}),this._dataChannel.addEventListener("message",event=>{this._closed||this.safeEmit("message",event.data)})}}exports.DataConsumer=DataConsumer},{"./EnhancedEventEmitter":390,"./Logger":391}],388:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.DataProducer=void 0;const Logger_1=require("./Logger"),EnhancedEventEmitter_1=require("./EnhancedEventEmitter"),errors_1=require("./errors"),logger=new Logger_1.Logger("DataProducer");class DataProducer extends EnhancedEventEmitter_1.EnhancedEventEmitter{constructor({id:id,dataChannel:dataChannel,sctpStreamParameters:sctpStreamParameters,appData:appData}){super(),this._closed=!1,this._observer=new EnhancedEventEmitter_1.EnhancedEventEmitter,logger.debug("constructor()"),this._id=id,this._dataChannel=dataChannel,this._sctpStreamParameters=sctpStreamParameters,this._appData=appData,this._handleDataChannel()}get id(){return this._id}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get bufferedAmount(){return this._dataChannel.bufferedAmount}get bufferedAmountLowThreshold(){return this._dataChannel.bufferedAmountLowThreshold}set bufferedAmountLowThreshold(bufferedAmountLowThreshold){this._dataChannel.bufferedAmountLowThreshold=bufferedAmountLowThreshold}get appData(){return this._appData}set appData(appData){throw new Error("cannot override appData object")}get observer(){return this._observer}close(){this._closed||(logger.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(logger.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}send(data){if(logger.debug("send()"),this._closed)throw new errors_1.InvalidStateError("closed");this._dataChannel.send(data)}_handleDataChannel(){this._dataChannel.addEventListener("open",()=>{this._closed||(logger.debug('DataChannel "open" event'),this.safeEmit("open"))}),this._dataChannel.addEventListener("error",event=>{if(this._closed)return;let{error:error}=event;error||(error=new Error("unknown DataChannel error")),"sctp-failure"===error.errorDetail?logger.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",error.sctpCauseCode,error.message):logger.error('DataChannel "error" event: %o',error),this.safeEmit("error",error)}),this._dataChannel.addEventListener("close",()=>{this._closed||(logger.warn('DataChannel "close" event'),this._closed=!0,this.emit("@close"),this.safeEmit("close"))}),this._dataChannel.addEventListener("message",()=>{this._closed||logger.warn('DataChannel "message" event in a DataProducer, message discarded')}),this._dataChannel.addEventListener("bufferedamountlow",()=>{this._closed||this.safeEmit("bufferedamountlow")})}}exports.DataProducer=DataProducer},{"./EnhancedEventEmitter":390,"./Logger":391,"./errors":396}],389:[function(require,module,exports){"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){void 0===k2&&(k2=k),Object.defineProperty(o,k2,{enumerable:!0,get:function(){return m[k]}})}:function(o,m,k,k2){void 0===k2&&(k2=k),o[k2]=m[k]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:!0,value:v})}:function(o,v){o.default=v}),__importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)"default"!==k&&Object.hasOwnProperty.call(mod,k)&&__createBinding(result,mod,k);return __setModuleDefault(result,mod),result},__importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Device=exports.detectDevice=void 0;const bowser_1=__importDefault(require("bowser")),Logger_1=require("./Logger"),EnhancedEventEmitter_1=require("./EnhancedEventEmitter"),errors_1=require("./errors"),utils=__importStar(require("./utils")),ortc=__importStar(require("./ortc")),Transport_1=require("./Transport"),Chrome74_1=require("./handlers/Chrome74"),Chrome70_1=require("./handlers/Chrome70"),Chrome67_1=require("./handlers/Chrome67"),Chrome55_1=require("./handlers/Chrome55"),Firefox60_1=require("./handlers/Firefox60"),Safari12_1=require("./handlers/Safari12"),Safari11_1=require("./handlers/Safari11"),Edge11_1=require("./handlers/Edge11"),ReactNative_1=require("./handlers/ReactNative"),logger=new Logger_1.Logger("Device");function detectDevice(){if("object"==typeof navigator&&"ReactNative"===navigator.product)return"undefined"==typeof RTCPeerConnection?void logger.warn("this._detectDevice() | unsupported ReactNative without RTCPeerConnection"):(logger.debug("this._detectDevice() | ReactNative handler chosen"),"ReactNative");if("object"!=typeof navigator||"string"!=typeof navigator.userAgent)logger.warn("this._detectDevice() | unknown device");else{const ua=navigator.userAgent,browser=bowser_1.default.getParser(ua),engine=browser.getEngine();if(browser.satisfies({chrome:">=74",chromium:">=74"}))return"Chrome74";if(browser.satisfies({chrome:">=70",chromium:">=70"}))return"Chrome70";if(browser.satisfies({chrome:">=67",chromium:">=67"}))return"Chrome67";if(browser.satisfies({chrome:">=55",chromium:">=55"}))return"Chrome55";if(browser.satisfies({firefox:">=60"}))return"Firefox60";if(browser.satisfies({safari:">=12.0"})&&"undefined"!=typeof RTCRtpTransceiver&&RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection"))return"Safari12";if(browser.satisfies({safari:">=11"}))return"Safari11";if(browser.satisfies({"microsoft edge":">=11"})&&browser.satisfies({"microsoft edge":"<=18"}))return"Edge11";if(engine.name&&"blink"===engine.name.toLowerCase()){const match=ua.match(/(?:(?:Chrome|Chromium))[ /](\w+)/i);if(match){const version=Number(match[1]);return version>=74?"Chrome74":version>=70?"Chrome70":version>=67?"Chrome67":"Chrome55"}return"Chrome74"}logger.warn("this._detectDevice() | browser not supported [name:%s, version:%s]",browser.getBrowserName(),browser.getBrowserVersion())}}exports.detectDevice=detectDevice;class Device{constructor({handlerName:handlerName,handlerFactory:handlerFactory,Handler:Handler}={}){if(this._loaded=!1,this._observer=new EnhancedEventEmitter_1.EnhancedEventEmitter,logger.debug("constructor()"),Handler){if(logger.warn("constructor() | Handler option is DEPRECATED, use handlerName or handlerFactory instead"),"string"!=typeof Handler)throw new TypeError("non string Handler option no longer supported, use handlerFactory instead");handlerName=Handler}if(handlerName&&handlerFactory)throw new TypeError("just one of handlerName or handlerInterface can be given");if(handlerFactory)this._handlerFactory=handlerFactory;else{if(handlerName)logger.debug("constructor() | handler given: %s",handlerName);else{if(!(handlerName=detectDevice()))throw new errors_1.UnsupportedError("device not supported");logger.debug("constructor() | detected handler: %s",handlerName)}switch(handlerName){case"Chrome74":this._handlerFactory=Chrome74_1.Chrome74.createFactory();break;case"Chrome70":this._handlerFactory=Chrome70_1.Chrome70.createFactory();break;case"Chrome67":this._handlerFactory=Chrome67_1.Chrome67.createFactory();break;case"Chrome55":this._handlerFactory=Chrome55_1.Chrome55.createFactory();break;case"Firefox60":this._handlerFactory=Firefox60_1.Firefox60.createFactory();break;case"Safari12":this._handlerFactory=Safari12_1.Safari12.createFactory();break;case"Safari11":this._handlerFactory=Safari11_1.Safari11.createFactory();break;case"Edge11":this._handlerFactory=Edge11_1.Edge11.createFactory();break;case"ReactNative":this._handlerFactory=ReactNative_1.ReactNative.createFactory();break;default:throw new TypeError(`unknown handlerName "${handlerName}"`)}}const handler=this._handlerFactory();this._handlerName=handler.name,handler.close(),this._extendedRtpCapabilities=void 0,this._recvRtpCapabilities=void 0,this._canProduceByKind={audio:!1,video:!1},this._sctpCapabilities=void 0}get handlerName(){return this._handlerName}get loaded(){return this._loaded}get rtpCapabilities(){if(!this._loaded)throw new errors_1.InvalidStateError("not loaded");return this._recvRtpCapabilities}get sctpCapabilities(){if(!this._loaded)throw new errors_1.InvalidStateError("not loaded");return this._sctpCapabilities}get observer(){return this._observer}async load({routerRtpCapabilities:routerRtpCapabilities}){let handler;logger.debug("load() [routerRtpCapabilities:%o]",routerRtpCapabilities),routerRtpCapabilities=utils.clone(routerRtpCapabilities,void 0);try{if(this._loaded)throw new errors_1.InvalidStateError("already loaded");ortc.validateRtpCapabilities(routerRtpCapabilities),handler=this._handlerFactory();const nativeRtpCapabilities=await handler.getNativeRtpCapabilities();logger.debug("load() | got native RTP capabilities:%o",nativeRtpCapabilities),ortc.validateRtpCapabilities(nativeRtpCapabilities),this._extendedRtpCapabilities=ortc.getExtendedRtpCapabilities(nativeRtpCapabilities,routerRtpCapabilities),logger.debug("load() | got extended RTP capabilities:%o",this._extendedRtpCapabilities),this._canProduceByKind.audio=ortc.canSend("audio",this._extendedRtpCapabilities),this._canProduceByKind.video=ortc.canSend("video",this._extendedRtpCapabilities),this._recvRtpCapabilities=ortc.getRecvRtpCapabilities(this._extendedRtpCapabilities),ortc.validateRtpCapabilities(this._recvRtpCapabilities),logger.debug("load() | got receiving RTP capabilities:%o",this._recvRtpCapabilities),this._sctpCapabilities=await handler.getNativeSctpCapabilities(),logger.debug("load() | got native SCTP capabilities:%o",this._sctpCapabilities),ortc.validateSctpCapabilities(this._sctpCapabilities),logger.debug("load() succeeded"),this._loaded=!0,handler.close()}catch(error){throw handler&&handler.close(),error}}canProduce(kind){if(!this._loaded)throw new errors_1.InvalidStateError("not loaded");if("audio"!==kind&&"video"!==kind)throw new TypeError(`invalid kind "${kind}"`);return this._canProduceByKind[kind]}createSendTransport({id:id,iceParameters:iceParameters,iceCandidates:iceCandidates,dtlsParameters:dtlsParameters,sctpParameters:sctpParameters,iceServers:iceServers,iceTransportPolicy:iceTransportPolicy,additionalSettings:additionalSettings,proprietaryConstraints:proprietaryConstraints,appData:appData={}}){return logger.debug("createSendTransport()"),this._createTransport({direction:"send",id:id,iceParameters:iceParameters,iceCandidates:iceCandidates,dtlsParameters:dtlsParameters,sctpParameters:sctpParameters,iceServers:iceServers,iceTransportPolicy:iceTransportPolicy,additionalSettings:additionalSettings,proprietaryConstraints:proprietaryConstraints,appData:appData})}createRecvTransport({id:id,iceParameters:iceParameters,iceCandidates:iceCandidates,dtlsParameters:dtlsParameters,sctpParameters:sctpParameters,iceServers:iceServers,iceTransportPolicy:iceTransportPolicy,additionalSettings:additionalSettings,proprietaryConstraints:proprietaryConstraints,appData:appData={}}){return logger.debug("createRecvTransport()"),this._createTransport({direction:"recv",id:id,iceParameters:iceParameters,iceCandidates:iceCandidates,dtlsParameters:dtlsParameters,sctpParameters:sctpParameters,iceServers:iceServers,iceTransportPolicy:iceTransportPolicy,additionalSettings:additionalSettings,proprietaryConstraints:proprietaryConstraints,appData:appData})}_createTransport({direction:direction,id:id,iceParameters:iceParameters,iceCandidates:iceCandidates,dtlsParameters:dtlsParameters,sctpParameters:sctpParameters,iceServers:iceServers,iceTransportPolicy:iceTransportPolicy,additionalSettings:additionalSettings,proprietaryConstraints:proprietaryConstraints,appData:appData={}}){if(!this._loaded)throw new errors_1.InvalidStateError("not loaded");if("string"!=typeof id)throw new TypeError("missing id");if("object"!=typeof iceParameters)throw new TypeError("missing iceParameters");if(!Array.isArray(iceCandidates))throw new TypeError("missing iceCandidates");if("object"!=typeof dtlsParameters)throw new TypeError("missing dtlsParameters");if(sctpParameters&&"object"!=typeof sctpParameters)throw new TypeError("wrong sctpParameters");if(appData&&"object"!=typeof appData)throw new TypeError("if given, appData must be an object");const transport=new Transport_1.Transport({direction:direction,id:id,iceParameters:iceParameters,iceCandidates:iceCandidates,dtlsParameters:dtlsParameters,sctpParameters:sctpParameters,iceServers:iceServers,iceTransportPolicy:iceTransportPolicy,additionalSettings:additionalSettings,proprietaryConstraints:proprietaryConstraints,appData:appData,handlerFactory:this._handlerFactory,extendedRtpCapabilities:this._extendedRtpCapabilities,canProduceByKind:this._canProduceByKind});return this._observer.safeEmit("newtransport",transport),transport}}exports.Device=Device},{"./EnhancedEventEmitter":390,"./Logger":391,"./Transport":395,"./errors":396,"./handlers/Chrome55":397,"./handlers/Chrome67":398,"./handlers/Chrome70":399,"./handlers/Chrome74":400,"./handlers/Edge11":401,"./handlers/Firefox60":402,"./handlers/ReactNative":404,"./handlers/Safari11":405,"./handlers/Safari12":406,"./ortc":414,"./utils":417,bowser:253}],390:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.EnhancedEventEmitter=void 0;const events_1=require("events"),Logger_1=require("./Logger"),logger=new Logger_1.Logger("EnhancedEventEmitter");class EnhancedEventEmitter extends events_1.EventEmitter{constructor(){super(),this.setMaxListeners(1/0)}safeEmit(event,...args){const numListeners=this.listenerCount(event);try{return this.emit(event,...args)}catch(error){return logger.error("safeEmit() | event listener threw an error [event:%s]:%o",event,error),Boolean(numListeners)}}async safeEmitAsPromise(event,...args){return new Promise((resolve,reject)=>{try{this.emit(event,...args,resolve,reject)}catch(error){logger.error("safeEmitAsPromise() | event listener threw an error [event:%s]:%o",event,error),reject(error)}})}}exports.EnhancedEventEmitter=EnhancedEventEmitter},{"./Logger":391,events:256}],391:[function(require,module,exports){"use strict";var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Logger=void 0;const debug_1=__importDefault(require("debug")),APP_NAME="mediasoup-client";class Logger{constructor(prefix){prefix?(this._debug=debug_1.default(`${APP_NAME}:${prefix}`),this._warn=debug_1.default(`${APP_NAME}:WARN:${prefix}`),this._error=debug_1.default(`${APP_NAME}:ERROR:${prefix}`)):(this._debug=debug_1.default(APP_NAME),this._warn=debug_1.default(`${APP_NAME}:WARN`),this._error=debug_1.default(`${APP_NAME}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}}exports.Logger=Logger},{debug:260}],392:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Producer=void 0;const Logger_1=require("./Logger"),EnhancedEventEmitter_1=require("./EnhancedEventEmitter"),errors_1=require("./errors"),logger=new Logger_1.Logger("Producer");class Producer extends EnhancedEventEmitter_1.EnhancedEventEmitter{constructor({id:id,localId:localId,rtpSender:rtpSender,track:track,rtpParameters:rtpParameters,stopTracks:stopTracks,disableTrackOnPause:disableTrackOnPause,zeroRtpOnPause:zeroRtpOnPause,appData:appData}){super(),this._closed=!1,this._observer=new EnhancedEventEmitter_1.EnhancedEventEmitter,logger.debug("constructor()"),this._id=id,this._localId=localId,this._rtpSender=rtpSender,this._track=track,this._kind=track.kind,this._rtpParameters=rtpParameters,this._paused=!!disableTrackOnPause&&!track.enabled,this._maxSpatialLayer=void 0,this._stopTracks=stopTracks,this._disableTrackOnPause=disableTrackOnPause,this._zeroRtpOnPause=zeroRtpOnPause,this._appData=appData,this._onTrackEnded=this._onTrackEnded.bind(this),this._handleTrack()}get id(){return this._id}get localId(){return this._localId}get closed(){return this._closed}get kind(){return this._kind}get rtpSender(){return this._rtpSender}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get maxSpatialLayer(){return this._maxSpatialLayer}get appData(){return this._appData}set appData(appData){throw new Error("cannot override appData object")}get observer(){return this._observer}close(){this._closed||(logger.debug("close()"),this._closed=!0,this._destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(logger.debug("transportClosed()"),this._closed=!0,this._destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}async getStats(){if(this._closed)throw new errors_1.InvalidStateError("closed");return this.safeEmitAsPromise("@getstats")}pause(){logger.debug("pause()"),this._closed?logger.error("pause() | Producer closed"):(this._paused=!0,this._track&&this._disableTrackOnPause&&(this._track.enabled=!1),this._zeroRtpOnPause&&this.safeEmitAsPromise("@replacetrack",null).catch(()=>{}),this._observer.safeEmit("pause"))}resume(){logger.debug("resume()"),this._closed?logger.error("resume() | Producer closed"):(this._paused=!1,this._track&&this._disableTrackOnPause&&(this._track.enabled=!0),this._zeroRtpOnPause&&this.safeEmitAsPromise("@replacetrack",this._track).catch(()=>{}),this._observer.safeEmit("resume"))}async replaceTrack({track:track}){if(logger.debug("replaceTrack() [track:%o]",track),this._closed){if(track&&this._stopTracks)try{track.stop()}catch(error){}throw new errors_1.InvalidStateError("closed")}if(track&&"ended"===track.readyState)throw new errors_1.InvalidStateError("track ended");track!==this._track?(this._zeroRtpOnPause&&this._paused||await this.safeEmitAsPromise("@replacetrack",track),this._destroyTrack(),this._track=track,this._track&&this._disableTrackOnPause&&(this._paused?this._paused&&(this._track.enabled=!1):this._track.enabled=!0),this._handleTrack()):logger.debug("replaceTrack() | same track, ignored")}async setMaxSpatialLayer(spatialLayer){if(this._closed)throw new errors_1.InvalidStateError("closed");if("video"!==this._kind)throw new errors_1.UnsupportedError("not a video Producer");if("number"!=typeof spatialLayer)throw new TypeError("invalid spatialLayer");spatialLayer!==this._maxSpatialLayer&&(await this.safeEmitAsPromise("@setmaxspatiallayer",spatialLayer),this._maxSpatialLayer=spatialLayer)}async setRtpEncodingParameters(params){if(this._closed)throw new errors_1.InvalidStateError("closed");if("object"!=typeof params)throw new TypeError("invalid params");await this.safeEmitAsPromise("@setrtpencodingparameters",params)}_onTrackEnded(){logger.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}_handleTrack(){this._track&&this._track.addEventListener("ended",this._onTrackEnded)}_destroyTrack(){if(this._track)try{this._track.removeEventListener("ended",this._onTrackEnded),this._stopTracks&&this._track.stop()}catch(error){}}}exports.Producer=Producer},{"./EnhancedEventEmitter":390,"./Logger":391,"./errors":396}],393:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0})},{}],394:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0})},{}],395:[function(require,module,exports){"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){void 0===k2&&(k2=k),Object.defineProperty(o,k2,{enumerable:!0,get:function(){return m[k]}})}:function(o,m,k,k2){void 0===k2&&(k2=k),o[k2]=m[k]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:!0,value:v})}:function(o,v){o.default=v}),__importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)"default"!==k&&Object.hasOwnProperty.call(mod,k)&&__createBinding(result,mod,k);return __setModuleDefault(result,mod),result};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Transport=void 0;const awaitqueue_1=require("awaitqueue"),Logger_1=require("./Logger"),EnhancedEventEmitter_1=require("./EnhancedEventEmitter"),errors_1=require("./errors"),utils=__importStar(require("./utils")),ortc=__importStar(require("./ortc")),Producer_1=require("./Producer"),Consumer_1=require("./Consumer"),DataProducer_1=require("./DataProducer"),DataConsumer_1=require("./DataConsumer"),logger=new Logger_1.Logger("Transport");class Transport extends EnhancedEventEmitter_1.EnhancedEventEmitter{constructor({direction:direction,id:id,iceParameters:iceParameters,iceCandidates:iceCandidates,dtlsParameters:dtlsParameters,sctpParameters:sctpParameters,iceServers:iceServers,iceTransportPolicy:iceTransportPolicy,additionalSettings:additionalSettings,proprietaryConstraints:proprietaryConstraints,appData:appData,handlerFactory:handlerFactory,extendedRtpCapabilities:extendedRtpCapabilities,canProduceByKind:canProduceByKind}){super(),this._closed=!1,this._connectionState="new",this._producers=new Map,this._consumers=new Map,this._dataProducers=new Map,this._dataConsumers=new Map,this._probatorConsumerCreated=!1,this._awaitQueue=new awaitqueue_1.AwaitQueue({ClosedErrorClass:errors_1.InvalidStateError}),this._observer=new EnhancedEventEmitter_1.EnhancedEventEmitter,logger.debug("constructor() [id:%s, direction:%s]",id,direction),this._id=id,this._direction=direction,this._extendedRtpCapabilities=extendedRtpCapabilities,this._canProduceByKind=canProduceByKind,this._maxSctpMessageSize=sctpParameters?sctpParameters.maxMessageSize:null,delete(additionalSettings=utils.clone(additionalSettings,{})).iceServers,delete additionalSettings.iceTransportPolicy,delete additionalSettings.bundlePolicy,delete additionalSettings.rtcpMuxPolicy,delete additionalSettings.sdpSemantics,this._handler=handlerFactory(),this._handler.run({direction:direction,iceParameters:iceParameters,iceCandidates:iceCandidates,dtlsParameters:dtlsParameters,sctpParameters:sctpParameters,iceServers:iceServers,iceTransportPolicy:iceTransportPolicy,additionalSettings:additionalSettings,proprietaryConstraints:proprietaryConstraints,extendedRtpCapabilities:extendedRtpCapabilities}),this._appData=appData,this._handleHandler()}get id(){return this._id}get closed(){return this._closed}get direction(){return this._direction}get handler(){return this._handler}get connectionState(){return this._connectionState}get appData(){return this._appData}set appData(appData){throw new Error("cannot override appData object")}get observer(){return this._observer}close(){if(!this._closed){logger.debug("close()"),this._closed=!0,this._awaitQueue.close(),this._handler.close();for(const producer of this._producers.values())producer.transportClosed();this._producers.clear();for(const consumer of this._consumers.values())consumer.transportClosed();this._consumers.clear();for(const dataProducer of this._dataProducers.values())dataProducer.transportClosed();this._dataProducers.clear();for(const dataConsumer of this._dataConsumers.values())dataConsumer.transportClosed();this._dataConsumers.clear(),this._observer.safeEmit("close")}}async getStats(){if(this._closed)throw new errors_1.InvalidStateError("closed");return this._handler.getTransportStats()}async restartIce({iceParameters:iceParameters}){if(logger.debug("restartIce()"),this._closed)throw new errors_1.InvalidStateError("closed");if(!iceParameters)throw new TypeError("missing iceParameters");return this._awaitQueue.push(async()=>this._handler.restartIce(iceParameters),"transport.restartIce()")}async updateIceServers({iceServers:iceServers}={}){if(logger.debug("updateIceServers()"),this._closed)throw new errors_1.InvalidStateError("closed");if(!Array.isArray(iceServers))throw new TypeError("missing iceServers");return this._awaitQueue.push(async()=>this._handler.updateIceServers(iceServers),"transport.updateIceServers()")}async produce({track:track,encodings:encodings,codecOptions:codecOptions,codec:codec,stopTracks:stopTracks=!0,disableTrackOnPause:disableTrackOnPause=!0,zeroRtpOnPause:zeroRtpOnPause=!1,appData:appData={}}={}){if(logger.debug("produce() [track:%o]",track),!track)throw new TypeError("missing track");if("send"!==this._direction)throw new errors_1.UnsupportedError("not a sending Transport");if(!this._canProduceByKind[track.kind])throw new errors_1.UnsupportedError(`cannot produce ${track.kind}`);if("ended"===track.readyState)throw new errors_1.InvalidStateError("track ended");if(0===this.listenerCount("connect")&&"new"===this._connectionState)throw new TypeError('no "connect" listener set into this transport');if(0===this.listenerCount("produce"))throw new TypeError('no "produce" listener set into this transport');if(appData&&"object"!=typeof appData)throw new TypeError("if given, appData must be an object");return this._awaitQueue.push(async()=>{let normalizedEncodings;if(encodings&&!Array.isArray(encodings))throw TypeError("encodings must be an array");encodings&&0===encodings.length?normalizedEncodings=void 0:encodings&&(normalizedEncodings=encodings.map(encoding=>{const normalizedEncoding={active:!0};return!1===encoding.active&&(normalizedEncoding.active=!1),"boolean"==typeof encoding.dtx&&(normalizedEncoding.dtx=encoding.dtx),"string"==typeof encoding.scalabilityMode&&(normalizedEncoding.scalabilityMode=encoding.scalabilityMode),"number"==typeof encoding.scaleResolutionDownBy&&(normalizedEncoding.scaleResolutionDownBy=encoding.scaleResolutionDownBy),"number"==typeof encoding.maxBitrate&&(normalizedEncoding.maxBitrate=encoding.maxBitrate),"number"==typeof encoding.maxFramerate&&(normalizedEncoding.maxFramerate=encoding.maxFramerate),"boolean"==typeof encoding.adaptivePtime&&(normalizedEncoding.adaptivePtime=encoding.adaptivePtime),"string"==typeof encoding.priority&&(normalizedEncoding.priority=encoding.priority),"string"==typeof encoding.networkPriority&&(normalizedEncoding.networkPriority=encoding.networkPriority),normalizedEncoding}));const{localId:localId,rtpParameters:rtpParameters,rtpSender:rtpSender}=await this._handler.send({track:track,encodings:normalizedEncodings,codecOptions:codecOptions,codec:codec});try{ortc.validateRtpParameters(rtpParameters);const{id:id}=await this.safeEmitAsPromise("produce",{kind:track.kind,rtpParameters:rtpParameters,appData:appData}),producer=new Producer_1.Producer({id:id,localId:localId,rtpSender:rtpSender,track:track,rtpParameters:rtpParameters,stopTracks:stopTracks,disableTrackOnPause:disableTrackOnPause,zeroRtpOnPause:zeroRtpOnPause,appData:appData});return this._producers.set(producer.id,producer),this._handleProducer(producer),this._observer.safeEmit("newproducer",producer),producer}catch(error){throw this._handler.stopSending(localId).catch(()=>{}),error}},"transport.produce()").catch(error=>{if(stopTracks)try{track.stop()}catch(error2){}throw error})}async consume({id:id,producerId:producerId,kind:kind,rtpParameters:rtpParameters,appData:appData={}}){if(logger.debug("consume()"),rtpParameters=utils.clone(rtpParameters,void 0),this._closed)throw new errors_1.InvalidStateError("closed");if("recv"!==this._direction)throw new errors_1.UnsupportedError("not a receiving Transport");if("string"!=typeof id)throw new TypeError("missing id");if("string"!=typeof producerId)throw new TypeError("missing producerId");if("audio"!==kind&&"video"!==kind)throw new TypeError(`invalid kind '${kind}'`);if(0===this.listenerCount("connect")&&"new"===this._connectionState)throw new TypeError('no "connect" listener set into this transport');if(appData&&"object"!=typeof appData)throw new TypeError("if given, appData must be an object");return this._awaitQueue.push(async()=>{const canConsume=ortc.canReceive(rtpParameters,this._extendedRtpCapabilities);if(!canConsume)throw new errors_1.UnsupportedError("cannot consume this Producer");const{localId:localId,rtpReceiver:rtpReceiver,track:track}=await this._handler.receive({trackId:id,kind:kind,rtpParameters:rtpParameters}),consumer=new Consumer_1.Consumer({id:id,localId:localId,producerId:producerId,rtpReceiver:rtpReceiver,track:track,rtpParameters:rtpParameters,appData:appData});if(this._consumers.set(consumer.id,consumer),this._handleConsumer(consumer),!this._probatorConsumerCreated&&"video"===kind)try{const probatorRtpParameters=ortc.generateProbatorRtpParameters(consumer.rtpParameters);await this._handler.receive({trackId:"probator",kind:"video",rtpParameters:probatorRtpParameters}),logger.debug("consume() | Consumer for RTP probation created"),this._probatorConsumerCreated=!0}catch(error){logger.error("consume() | failed to create Consumer for RTP probation:%o",error)}return this._observer.safeEmit("newconsumer",consumer),consumer},"transport.consume()")}async produceData({ordered:ordered=!0,maxPacketLifeTime:maxPacketLifeTime,maxRetransmits:maxRetransmits,priority:priority="low",label:label="",protocol:protocol="",appData:appData={}}={}){if(logger.debug("produceData()"),"send"!==this._direction)throw new errors_1.UnsupportedError("not a sending Transport");if(!this._maxSctpMessageSize)throw new errors_1.UnsupportedError("SCTP not enabled by remote Transport");if(!["very-low","low","medium","high"].includes(priority))throw new TypeError("wrong priority");if(0===this.listenerCount("connect")&&"new"===this._connectionState)throw new TypeError('no "connect" listener set into this transport');if(0===this.listenerCount("producedata"))throw new TypeError('no "producedata" listener set into this transport');if(appData&&"object"!=typeof appData)throw new TypeError("if given, appData must be an object");return(maxPacketLifeTime||maxRetransmits)&&(ordered=!1),this._awaitQueue.push(async()=>{const{dataChannel:dataChannel,sctpStreamParameters:sctpStreamParameters}=await this._handler.sendDataChannel({ordered:ordered,maxPacketLifeTime:maxPacketLifeTime,maxRetransmits:maxRetransmits,priority:priority,label:label,protocol:protocol});ortc.validateSctpStreamParameters(sctpStreamParameters);const{id:id}=await this.safeEmitAsPromise("producedata",{sctpStreamParameters:sctpStreamParameters,label:label,protocol:protocol,appData:appData}),dataProducer=new DataProducer_1.DataProducer({id:id,dataChannel:dataChannel,sctpStreamParameters:sctpStreamParameters,appData:appData});return this._dataProducers.set(dataProducer.id,dataProducer),this._handleDataProducer(dataProducer),this._observer.safeEmit("newdataproducer",dataProducer),dataProducer},"transport.produceData()")}async consumeData({id:id,dataProducerId:dataProducerId,sctpStreamParameters:sctpStreamParameters,label:label="",protocol:protocol="",appData:appData={}}){if(logger.debug("consumeData()"),sctpStreamParameters=utils.clone(sctpStreamParameters,void 0),this._closed)throw new errors_1.InvalidStateError("closed");if("recv"!==this._direction)throw new errors_1.UnsupportedError("not a receiving Transport");if(!this._maxSctpMessageSize)throw new errors_1.UnsupportedError("SCTP not enabled by remote Transport");if("string"!=typeof id)throw new TypeError("missing id");if("string"!=typeof dataProducerId)throw new TypeError("missing dataProducerId");if(0===this.listenerCount("connect")&&"new"===this._connectionState)throw new TypeError('no "connect" listener set into this transport');if(appData&&"object"!=typeof appData)throw new TypeError("if given, appData must be an object");return ortc.validateSctpStreamParameters(sctpStreamParameters),this._awaitQueue.push(async()=>{const{dataChannel:dataChannel}=await this._handler.receiveDataChannel({sctpStreamParameters:sctpStreamParameters,label:label,protocol:protocol}),dataConsumer=new DataConsumer_1.DataConsumer({id:id,dataProducerId:dataProducerId,dataChannel:dataChannel,sctpStreamParameters:sctpStreamParameters,appData:appData});return this._dataConsumers.set(dataConsumer.id,dataConsumer),this._handleDataConsumer(dataConsumer),this._observer.safeEmit("newdataconsumer",dataConsumer),dataConsumer},"transport.consumeData()")}_handleHandler(){const handler=this._handler;handler.on("@connect",({dtlsParameters:dtlsParameters},callback,errback)=>{this._closed?errback(new errors_1.InvalidStateError("closed")):this.safeEmit("connect",{dtlsParameters:dtlsParameters},callback,errback)}),handler.on("@connectionstatechange",connectionState=>{connectionState!==this._connectionState&&(logger.debug("connection state changed to %s",connectionState),this._connectionState=connectionState,this._closed||this.safeEmit("connectionstatechange",connectionState))})}_handleProducer(producer){producer.on("@close",()=>{this._producers.delete(producer.id),this._closed||this._awaitQueue.push(async()=>this._handler.stopSending(producer.localId),"producer @close event").catch(error=>logger.warn("producer.close() failed:%o",error))}),producer.on("@replacetrack",(track,callback,errback)=>{this._awaitQueue.push(async()=>this._handler.replaceTrack(producer.localId,track),"producer @replacetrack event").then(callback).catch(errback)}),producer.on("@setmaxspatiallayer",(spatialLayer,callback,errback)=>{this._awaitQueue.push(async()=>this._handler.setMaxSpatialLayer(producer.localId,spatialLayer),"producer @setmaxspatiallayer event").then(callback).catch(errback)}),producer.on("@setrtpencodingparameters",(params,callback,errback)=>{this._awaitQueue.push(async()=>this._handler.setRtpEncodingParameters(producer.localId,params),"producer @setrtpencodingparameters event").then(callback).catch(errback)}),producer.on("@getstats",(callback,errback)=>{if(this._closed)return errback(new errors_1.InvalidStateError("closed"));this._handler.getSenderStats(producer.localId).then(callback).catch(errback)})}_handleConsumer(consumer){consumer.on("@close",()=>{this._consumers.delete(consumer.id),this._closed||this._awaitQueue.push(async()=>this._handler.stopReceiving(consumer.localId),"consumer @close event").catch(()=>{})}),consumer.on("@getstats",(callback,errback)=>{if(this._closed)return errback(new errors_1.InvalidStateError("closed"));this._handler.getReceiverStats(consumer.localId).then(callback).catch(errback)})}_handleDataProducer(dataProducer){dataProducer.on("@close",()=>{this._dataProducers.delete(dataProducer.id)})}_handleDataConsumer(dataConsumer){dataConsumer.on("@close",()=>{this._dataConsumers.delete(dataConsumer.id)})}}exports.Transport=Transport},{"./Consumer":386,"./DataConsumer":387,"./DataProducer":388,"./EnhancedEventEmitter":390,"./Logger":391,"./Producer":392,"./errors":396,"./ortc":414,"./utils":417,awaitqueue:251}],396:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.InvalidStateError=exports.UnsupportedError=void 0;class UnsupportedError extends Error{constructor(message){super(message),this.name="UnsupportedError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,UnsupportedError):this.stack=new Error(message).stack}}exports.UnsupportedError=UnsupportedError;class InvalidStateError extends Error{constructor(message){super(message),this.name="InvalidStateError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,InvalidStateError):this.stack=new Error(message).stack}}exports.InvalidStateError=InvalidStateError},{}],397:[function(require,module,exports){"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){void 0===k2&&(k2=k),Object.defineProperty(o,k2,{enumerable:!0,get:function(){return m[k]}})}:function(o,m,k,k2){void 0===k2&&(k2=k),o[k2]=m[k]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:!0,value:v})}:function(o,v){o.default=v}),__importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)"default"!==k&&Object.hasOwnProperty.call(mod,k)&&__createBinding(result,mod,k);return __setModuleDefault(result,mod),result};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Chrome55=void 0;const sdpTransform=__importStar(require("sdp-transform")),Logger_1=require("../Logger"),errors_1=require("../errors"),utils=__importStar(require("../utils")),ortc=__importStar(require("../ortc")),sdpCommonUtils=__importStar(require("./sdp/commonUtils")),sdpPlanBUtils=__importStar(require("./sdp/planBUtils")),HandlerInterface_1=require("./HandlerInterface"),RemoteSdp_1=require("./sdp/RemoteSdp"),logger=new Logger_1.Logger("Chrome55"),SCTP_NUM_STREAMS={OS:1024,MIS:1024};class Chrome55 extends HandlerInterface_1.HandlerInterface{constructor(){super(),this._sendStream=new MediaStream,this._mapSendLocalIdTrack=new Map,this._nextSendLocalId=0,this._mapRecvLocalIdInfo=new Map,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}static createFactory(){return()=>new Chrome55}get name(){return"Chrome55"}close(){if(logger.debug("close()"),this._pc)try{this._pc.close()}catch(error){}}async getNativeRtpCapabilities(){logger.debug("getNativeRtpCapabilities()");const pc=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const offer=await pc.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{pc.close()}catch(error){}const sdpObject=sdpTransform.parse(offer.sdp),nativeRtpCapabilities=sdpCommonUtils.extractRtpCapabilities({sdpObject:sdpObject});return nativeRtpCapabilities}catch(error){try{pc.close()}catch(error2){}throw error}}async getNativeSctpCapabilities(){return logger.debug("getNativeSctpCapabilities()"),{numStreams:SCTP_NUM_STREAMS}}run({direction:direction,iceParameters:iceParameters,iceCandidates:iceCandidates,dtlsParameters:dtlsParameters,sctpParameters:sctpParameters,iceServers:iceServers,iceTransportPolicy:iceTransportPolicy,additionalSettings:additionalSettings,proprietaryConstraints:proprietaryConstraints,extendedRtpCapabilities:extendedRtpCapabilities}){logger.debug("run()"),this._direction=direction,this._remoteSdp=new RemoteSdp_1.RemoteSdp({iceParameters:iceParameters,iceCandidates:iceCandidates,dtlsParameters:dtlsParameters,sctpParameters:sctpParameters,planB:!0}),this._sendingRtpParametersByKind={audio:ortc.getSendingRtpParameters("audio",extendedRtpCapabilities),video:ortc.getSendingRtpParameters("video",extendedRtpCapabilities)},this._sendingRemoteRtpParametersByKind={audio:ortc.getSendingRemoteRtpParameters("audio",extendedRtpCapabilities),video:ortc.getSendingRemoteRtpParameters("video",extendedRtpCapabilities)},this._pc=new RTCPeerConnection(Object.assign({iceServers:iceServers||[],iceTransportPolicy:iceTransportPolicy||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"},additionalSettings),proprietaryConstraints),this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})}async updateIceServers(iceServers){logger.debug("updateIceServers()");const configuration=this._pc.getConfiguration();configuration.iceServers=iceServers,this._pc.setConfiguration(configuration)}async restartIce(iceParameters){if(logger.debug("restartIce()"),this._remoteSdp.updateIceParameters(iceParameters),this._transportReady)if("send"===this._direction){const offer=await this._pc.createOffer({iceRestart:!0});logger.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",offer),await this._pc.setLocalDescription(offer);const answer={type:"answer",sdp:this._remoteSdp.getSdp()};logger.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",answer),await this._pc.setRemoteDescription(answer)}else{const offer={type:"offer",sdp:this._remoteSdp.getSdp()};logger.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",offer),await this._pc.setRemoteDescription(offer);const answer=await this._pc.createAnswer();logger.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",answer),await this._pc.setLocalDescription(answer)}}async getTransportStats(){return this._pc.getStats()}async send({track:track,encodings:encodings,codecOptions:codecOptions,codec:codec}){this._assertSendDirection(),logger.debug("send() [kind:%s, track.id:%s]",track.kind,track.id),codec&&logger.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(track),this._pc.addStream(this._sendStream);let offer=await this._pc.createOffer(),localSdpObject=sdpTransform.parse(offer.sdp),offerMediaObject;const sendingRtpParameters=utils.clone(this._sendingRtpParametersByKind[track.kind],{});sendingRtpParameters.codecs=ortc.reduceCodecs(sendingRtpParameters.codecs);const sendingRemoteRtpParameters=utils.clone(this._sendingRemoteRtpParametersByKind[track.kind],{});if(sendingRemoteRtpParameters.codecs=ortc.reduceCodecs(sendingRemoteRtpParameters.codecs),this._transportReady||await this._setupTransport({localDtlsRole:"server",localSdpObject:localSdpObject}),"video"===track.kind&&encodings&&encodings.length>1&&(logger.debug("send() | enabling simulcast"),localSdpObject=sdpTransform.parse(offer.sdp),offerMediaObject=localSdpObject.media.find(m=>"video"===m.type),sdpPlanBUtils.addLegacySimulcast({offerMediaObject:offerMediaObject,track:track,numStreams:encodings.length}),offer={type:"offer",sdp:sdpTransform.write(localSdpObject)}),logger.debug("send() | calling pc.setLocalDescription() [offer:%o]",offer),await this._pc.setLocalDescription(offer),localSdpObject=sdpTransform.parse(this._pc.localDescription.sdp),offerMediaObject=localSdpObject.media.find(m=>m.type===track.kind),sendingRtpParameters.rtcp.cname=sdpCommonUtils.getCname({offerMediaObject:offerMediaObject}),sendingRtpParameters.encodings=sdpPlanBUtils.getRtpEncodings({offerMediaObject:offerMediaObject,track:track}),encodings)for(let idx=0;idx<sendingRtpParameters.encodings.length;++idx)encodings[idx]&&Object.assign(sendingRtpParameters.encodings[idx],encodings[idx]);if(sendingRtpParameters.encodings.length>1&&"video/vp8"===sendingRtpParameters.codecs[0].mimeType.toLowerCase())for(const encoding of sendingRtpParameters.encodings)encoding.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:offerMediaObject,offerRtpParameters:sendingRtpParameters,answerRtpParameters:sendingRemoteRtpParameters,codecOptions:codecOptions});const answer={type:"answer",sdp:this._remoteSdp.getSdp()};logger.debug("send() | calling pc.setRemoteDescription() [answer:%o]",answer),await this._pc.setRemoteDescription(answer);const localId=String(this._nextSendLocalId);return this._nextSendLocalId++,this._mapSendLocalIdTrack.set(localId,track),{localId:localId,rtpParameters:sendingRtpParameters}}async stopSending(localId){this._assertSendDirection(),logger.debug("stopSending() [localId:%s]",localId);const track=this._mapSendLocalIdTrack.get(localId);if(!track)throw new Error("track not found");this._mapSendLocalIdTrack.delete(localId),this._sendStream.removeTrack(track),this._pc.addStream(this._sendStream);const offer=await this._pc.createOffer();logger.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",offer);try{await this._pc.setLocalDescription(offer)}catch(error){if(0===this._sendStream.getTracks().length)return void logger.warn("stopSending() | ignoring expected error due no sending tracks: %s",error.toString());throw error}if("stable"===this._pc.signalingState)return;const answer={type:"answer",sdp:this._remoteSdp.getSdp()};logger.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",answer),await this._pc.setRemoteDescription(answer)}async replaceTrack(localId,track){throw new errors_1.UnsupportedError("not implemented")}async setMaxSpatialLayer(localId,spatialLayer){throw new errors_1.UnsupportedError(" not implemented")}async setRtpEncodingParameters(localId,params){throw new errors_1.UnsupportedError("not supported")}async getSenderStats(localId){throw new errors_1.UnsupportedError("not implemented")}async sendDataChannel({ordered:ordered,maxPacketLifeTime:maxPacketLifeTime,maxRetransmits:maxRetransmits,label:label,protocol:protocol,priority:priority}){this._assertSendDirection();const options={negotiated:!0,id:this._nextSendSctpStreamId,ordered:ordered,maxPacketLifeTime:maxPacketLifeTime,maxRetransmitTime:maxPacketLifeTime,maxRetransmits:maxRetransmits,protocol:protocol,priority:priority};logger.debug("sendDataChannel() [options:%o]",options);const dataChannel=this._pc.createDataChannel(label,options);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%SCTP_NUM_STREAMS.MIS,!this._hasDataChannelMediaSection){const offer=await this._pc.createOffer(),localSdpObject=sdpTransform.parse(offer.sdp),offerMediaObject=localSdpObject.media.find(m=>"application"===m.type);this._transportReady||await this._setupTransport({localDtlsRole:"server",localSdpObject:localSdpObject}),logger.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",offer),await this._pc.setLocalDescription(offer),this._remoteSdp.sendSctpAssociation({offerMediaObject:offerMediaObject});const answer={type:"answer",sdp:this._remoteSdp.getSdp()};logger.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",answer),await this._pc.setRemoteDescription(answer),this._hasDataChannelMediaSection=!0}const sctpStreamParameters={streamId:options.id,ordered:options.ordered,maxPacketLifeTime:options.maxPacketLifeTime,maxRetransmits:options.maxRetransmits};return{dataChannel:dataChannel,sctpStreamParameters:sctpStreamParameters}}async receive({trackId:trackId,kind:kind,rtpParameters:rtpParameters}){this._assertRecvDirection(),logger.debug("receive() [trackId:%s, kind:%s]",trackId,kind);const localId=trackId,mid=kind,streamId=rtpParameters.rtcp.cname;this._remoteSdp.receive({mid:mid,kind:kind,offerRtpParameters:rtpParameters,streamId:streamId,trackId:trackId});const offer={type:"offer",sdp:this._remoteSdp.getSdp()};logger.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",offer),await this._pc.setRemoteDescription(offer);let answer=await this._pc.createAnswer();const localSdpObject=sdpTransform.parse(answer.sdp),answerMediaObject=localSdpObject.media.find(m=>String(m.mid)===mid);sdpCommonUtils.applyCodecParameters({offerRtpParameters:rtpParameters,answerMediaObject:answerMediaObject}),answer={type:"answer",sdp:sdpTransform.write(localSdpObject)},this._transportReady||await this._setupTransport({localDtlsRole:"client",localSdpObject:localSdpObject}),logger.debug("receive() | calling pc.setLocalDescription() [answer:%o]",answer),await this._pc.setLocalDescription(answer);const stream=this._pc.getRemoteStreams().find(s=>s.id===streamId),track=stream.getTrackById(localId);if(!track)throw new Error("remote track not found");return this._mapRecvLocalIdInfo.set(localId,{mid:mid,rtpParameters:rtpParameters}),{localId:localId,track:track}}async stopReceiving(localId){this._assertRecvDirection(),logger.debug("stopReceiving() [localId:%s]",localId);const{mid:mid,rtpParameters:rtpParameters}=this._mapRecvLocalIdInfo.get(localId)||{};this._mapRecvLocalIdInfo.delete(localId),this._remoteSdp.planBStopReceiving({mid:mid,offerRtpParameters:rtpParameters});const offer={type:"offer",sdp:this._remoteSdp.getSdp()};logger.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",offer),await this._pc.setRemoteDescription(offer);const answer=await this._pc.createAnswer();logger.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",answer),await this._pc.setLocalDescription(answer)}async getReceiverStats(localId){throw new errors_1.UnsupportedError("not implemented")}async receiveDataChannel({sctpStreamParameters:sctpStreamParameters,label:label,protocol:protocol}){this._assertRecvDirection();const{streamId:streamId,ordered:ordered,maxPacketLifeTime:maxPacketLifeTime,maxRetransmits:maxRetransmits}=sctpStreamParameters,options={negotiated:!0,id:streamId,ordered:ordered,maxPacketLifeTime:maxPacketLifeTime,maxRetransmitTime:maxPacketLifeTime,maxRetransmits:maxRetransmits,protocol:protocol};logger.debug("receiveDataChannel() [options:%o]",options);const dataChannel=this._pc.createDataChannel(label,options);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const offer={type:"offer",sdp:this._remoteSdp.getSdp()};logger.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",offer),await this._pc.setRemoteDescription(offer);const answer=await this._pc.createAnswer();if(!this._transportReady){const localSdpObject=sdpTransform.parse(answer.sdp);await this._setupTransport({localDtlsRole:"client",localSdpObject:localSdpObject})}logger.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",answer),await this._pc.setLocalDescription(answer),this._hasDataChannelMediaSection=!0}return{dataChannel:dataChannel}}async _setupTransport({localDtlsRole:localDtlsRole,localSdpObject:localSdpObject}){localSdpObject||(localSdpObject=sdpTransform.parse(this._pc.localDescription.sdp));const dtlsParameters=sdpCommonUtils.extractDtlsParameters({sdpObject:localSdpObject});dtlsParameters.role=localDtlsRole,this._remoteSdp.updateDtlsRole("client"===localDtlsRole?"server":"client"),await this.safeEmitAsPromise("@connect",{dtlsParameters:dtlsParameters}),this._transportReady=!0}_assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}_assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}exports.Chrome55=Chrome55},{"../Logger":391,"../errors":396,"../ortc":414,"../utils":417,"./HandlerInterface":403,"./sdp/RemoteSdp":409,"./sdp/commonUtils":410,"./sdp/planBUtils":411,"sdp-transform":509}],398:[function(require,module,exports){"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){void 0===k2&&(k2=k),Object.defineProperty(o,k2,{enumerable:!0,get:function(){return m[k]}})}:function(o,m,k,k2){void 0===k2&&(k2=k),o[k2]=m[k]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:!0,value:v})}:function(o,v){o.default=v}),__importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)"default"!==k&&Object.hasOwnProperty.call(mod,k)&&__createBinding(result,mod,k);return __setModuleDefault(result,mod),result};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Chrome67=void 0;const sdpTransform=__importStar(require("sdp-transform")),Logger_1=require("../Logger"),utils=__importStar(require("../utils")),ortc=__importStar(require("../ortc")),sdpCommonUtils=__importStar(require("./sdp/commonUtils")),sdpPlanBUtils=__importStar(require("./sdp/planBUtils")),HandlerInterface_1=require("./HandlerInterface"),RemoteSdp_1=require("./sdp/RemoteSdp"),logger=new Logger_1.Logger("Chrome67"),SCTP_NUM_STREAMS={OS:1024,MIS:1024};class Chrome67 extends HandlerInterface_1.HandlerInterface{constructor(){super(),this._sendStream=new MediaStream,this._mapSendLocalIdRtpSender=new Map,this._nextSendLocalId=0,this._mapRecvLocalIdInfo=new Map,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}static createFactory(){return()=>new Chrome67}get name(){return"Chrome67"}close(){if(logger.debug("close()"),this._pc)try{this._pc.close()}catch(error){}}async getNativeRtpCapabilities(){logger.debug("getNativeRtpCapabilities()");const pc=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const offer=await pc.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{pc.close()}catch(error){}const sdpObject=sdpTransform.parse(offer.sdp),nativeRtpCapabilities=sdpCommonUtils.extractRtpCapabilities({sdpObject:sdpObject});return nativeRtpCapabilities}catch(error){try{pc.close()}catch(error2){}throw error}}async getNativeSctpCapabilities(){return logger.debug("getNativeSctpCapabilities()"),{numStreams:SCTP_NUM_STREAMS}}run({direction:direction,iceParameters:iceParameters,iceCandidates:iceCandidates,dtlsParameters:dtlsParameters,sctpParameters:sctpParameters,iceServers:iceServers,iceTransportPolicy:iceTransportPolicy,additionalSettings:additionalSettings,proprietaryConstraints:proprietaryConstraints,extendedRtpCapabilities:extendedRtpCapabilities}){logger.debug("run()"),this._direction=direction,this._remoteSdp=new RemoteSdp_1.RemoteSdp({iceParameters:iceParameters,iceCandidates:iceCandidates,dtlsParameters:dtlsParameters,sctpParameters:sctpParameters,planB:!0}),this._sendingRtpParametersByKind={audio:ortc.getSendingRtpParameters("audio",extendedRtpCapabilities),video:ortc.getSendingRtpParameters("video",extendedRtpCapabilities)},this._sendingRemoteRtpParametersByKind={audio:ortc.getSendingRemoteRtpParameters("audio",extendedRtpCapabilities),video:ortc.getSendingRemoteRtpParameters("video",extendedRtpCapabilities)},this._pc=new RTCPeerConnection(Object.assign({iceServers:iceServers||[],iceTransportPolicy:iceTransportPolicy||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"},additionalSettings),proprietaryConstraints),this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})}async updateIceServers(iceServers){logger.debug("updateIceServers()");const configuration=this._pc.getConfiguration();configuration.iceServers=iceServers,this._pc.setConfiguration(configuration)}async restartIce(iceParameters){if(logger.debug("restartIce()"),this._remoteSdp.updateIceParameters(iceParameters),this._transportReady)if("send"===this._direction){const offer=await this._pc.createOffer({iceRestart:!0});logger.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",offer),await this._pc.setLocalDescription(offer);const answer={type:"answer",sdp:this._remoteSdp.getSdp()};logger.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",answer),await this._pc.setRemoteDescription(answer)}else{const offer={type:"offer",sdp:this._remoteSdp.getSdp()};logger.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",offer),await this._pc.setRemoteDescription(offer);const answer=await this._pc.createAnswer();logger.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",answer),await this._pc.setLocalDescription(answer)}}async getTransportStats(){return this._pc.getStats()}async send({track:track,encodings:encodings,codecOptions:codecOptions,codec:codec}){this._assertSendDirection(),logger.debug("send() [kind:%s, track.id:%s]",track.kind,track.id),codec&&logger.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(track),this._pc.addTrack(track,this._sendStream);let offer=await this._pc.createOffer(),localSdpObject=sdpTransform.parse(offer.sdp),offerMediaObject;const sendingRtpParameters=utils.clone(this._sendingRtpParametersByKind[track.kind],{});sendingRtpParameters.codecs=ortc.reduceCodecs(sendingRtpParameters.codecs);const sendingRemoteRtpParameters=utils.clone(this._sendingRemoteRtpParametersByKind[track.kind],{});if(sendingRemoteRtpParameters.codecs=ortc.reduceCodecs(sendingRemoteRtpParameters.codecs),this._transportReady||await this._setupTransport({localDtlsRole:"server",localSdpObject:localSdpObject}),"video"===track.kind&&encodings&&encodings.length>1&&(logger.debug("send() | enabling simulcast"),localSdpObject=sdpTransform.parse(offer.sdp),offerMediaObject=localSdpObject.media.find(m=>"video"===m.type),sdpPlanBUtils.addLegacySimulcast({offerMediaObject:offerMediaObject,track:track,numStreams:encodings.length}),offer={type:"offer",sdp:sdpTransform.write(localSdpObject)}),logger.debug("send() | calling pc.setLocalDescription() [offer:%o]",offer),await this._pc.setLocalDescription(offer),localSdpObject=sdpTransform.parse(this._pc.localDescription.sdp),offerMediaObject=localSdpObject.media.find(m=>m.type===track.kind),sendingRtpParameters.rtcp.cname=sdpCommonUtils.getCname({offerMediaObject:offerMediaObject}),sendingRtpParameters.encodings=sdpPlanBUtils.getRtpEncodings({offerMediaObject:offerMediaObject,track:track}),encodings)for(let idx=0;idx<sendingRtpParameters.encodings.length;++idx)encodings[idx]&&Object.assign(sendingRtpParameters.encodings[idx],encodings[idx]);if(sendingRtpParameters.encodings.length>1&&"video/vp8"===sendingRtpParameters.codecs[0].mimeType.toLowerCase())for(const encoding of sendingRtpParameters.encodings)encoding.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:offerMediaObject,offerRtpParameters:sendingRtpParameters,answerRtpParameters:sendingRemoteRtpParameters,codecOptions:codecOptions});const answer={type:"answer",sdp:this._remoteSdp.getSdp()};logger.debug("send() | calling pc.setRemoteDescription() [answer:%o]",answer),await this._pc.setRemoteDescription(answer);const localId=String(this._nextSendLocalId);this._nextSendLocalId++;const rtpSender=this._pc.getSenders().find(s=>s.track===track);return this._mapSendLocalIdRtpSender.set(localId,rtpSender),{localId:localId,rtpParameters:sendingRtpParameters,rtpSender:rtpSender}}async stopSending(localId){this._assertSendDirection(),logger.debug("stopSending() [localId:%s]",localId);const rtpSender=this._mapSendLocalIdRtpSender.get(localId);if(!rtpSender)throw new Error("associated RTCRtpSender not found");this._pc.removeTrack(rtpSender),rtpSender.track&&this._sendStream.removeTrack(rtpSender.track),this._mapSendLocalIdRtpSender.delete(localId);const offer=await this._pc.createOffer();logger.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",offer);try{await this._pc.setLocalDescription(offer)}catch(error){if(0===this._sendStream.getTracks().length)return void logger.warn("stopSending() | ignoring expected error due no sending tracks: %s",error.toString());throw error}if("stable"===this._pc.signalingState)return;const answer={type:"answer",sdp:this._remoteSdp.getSdp()};logger.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",answer),await this._pc.setRemoteDescription(answer)}async replaceTrack(localId,track){this._assertSendDirection(),track?logger.debug("replaceTrack() [localId:%s, track.id:%s]",localId,track.id):logger.debug("replaceTrack() [localId:%s, no track]",localId);const rtpSender=this._mapSendLocalIdRtpSender.get(localId);if(!rtpSender)throw new Error("associated RTCRtpSender not found");const oldTrack=rtpSender.track;await rtpSender.replaceTrack(track),oldTrack&&this._sendStream.removeTrack(oldTrack),track&&this._sendStream.addTrack(track)}async setMaxSpatialLayer(localId,spatialLayer){this._assertSendDirection(),logger.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",localId,spatialLayer);const rtpSender=this._mapSendLocalIdRtpSender.get(localId);if(!rtpSender)throw new Error("associated RTCRtpSender not found");const parameters=rtpSender.getParameters();parameters.encodings.forEach((encoding,idx)=>{encoding.active=idx<=spatialLayer}),await rtpSender.setParameters(parameters)}async setRtpEncodingParameters(localId,params){this._assertSendDirection(),logger.debug("setRtpEncodingParameters() [localId:%s, params:%o]",localId,params);const rtpSender=this._mapSendLocalIdRtpSender.get(localId);if(!rtpSender)throw new Error("associated RTCRtpSender not found");const parameters=rtpSender.getParameters();parameters.encodings.forEach((encoding,idx)=>{parameters.encodings[idx]=Object.assign(Object.assign({},encoding),params)}),await rtpSender.setParameters(parameters)}async getSenderStats(localId){this._assertSendDirection();const rtpSender=this._mapSendLocalIdRtpSender.get(localId);if(!rtpSender)throw new Error("associated RTCRtpSender not found");return rtpSender.getStats()}async sendDataChannel({ordered:ordered,maxPacketLifeTime:maxPacketLifeTime,maxRetransmits:maxRetransmits,label:label,protocol:protocol,priority:priority}){this._assertSendDirection();const options={negotiated:!0,id:this._nextSendSctpStreamId,ordered:ordered,maxPacketLifeTime:maxPacketLifeTime,maxRetransmitTime:maxPacketLifeTime,maxRetransmits:maxRetransmits,protocol:protocol,priority:priority};logger.debug("sendDataChannel() [options:%o]",options);const dataChannel=this._pc.createDataChannel(label,options);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%SCTP_NUM_STREAMS.MIS,!this._hasDataChannelMediaSection){const offer=await this._pc.createOffer(),localSdpObject=sdpTransform.parse(offer.sdp),offerMediaObject=localSdpObject.media.find(m=>"application"===m.type);this._transportReady||await this._setupTransport({localDtlsRole:"server",localSdpObject:localSdpObject}),logger.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",offer),await this._pc.setLocalDescription(offer),this._remoteSdp.sendSctpAssociation({offerMediaObject:offerMediaObject});const answer={type:"answer",sdp:this._remoteSdp.getSdp()};logger.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",answer),await this._pc.setRemoteDescription(answer),this._hasDataChannelMediaSection=!0}const sctpStreamParameters={streamId:options.id,ordered:options.ordered,maxPacketLifeTime:options.maxPacketLifeTime,maxRetransmits:options.maxRetransmits};return{dataChannel:dataChannel,sctpStreamParameters:sctpStreamParameters}}async receive({trackId:trackId,kind:kind,rtpParameters:rtpParameters}){this._assertRecvDirection(),logger.debug("receive() [trackId:%s, kind:%s]",trackId,kind);const localId=trackId,mid=kind;this._remoteSdp.receive({mid:mid,kind:kind,offerRtpParameters:rtpParameters,streamId:rtpParameters.rtcp.cname,trackId:trackId});const offer={type:"offer",sdp:this._remoteSdp.getSdp()};logger.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",offer),await this._pc.setRemoteDescription(offer);let answer=await this._pc.createAnswer();const localSdpObject=sdpTransform.parse(answer.sdp),answerMediaObject=localSdpObject.media.find(m=>String(m.mid)===mid);sdpCommonUtils.applyCodecParameters({offerRtpParameters:rtpParameters,answerMediaObject:answerMediaObject}),answer={type:"answer",sdp:sdpTransform.write(localSdpObject)},this._transportReady||await this._setupTransport({localDtlsRole:"client",localSdpObject:localSdpObject}),logger.debug("receive() | calling pc.setLocalDescription() [answer:%o]",answer),await this._pc.setLocalDescription(answer);const rtpReceiver=this._pc.getReceivers().find(r=>r.track&&r.track.id===localId);if(!rtpReceiver)throw new Error("new RTCRtpReceiver not");return this._mapRecvLocalIdInfo.set(localId,{mid:mid,rtpParameters:rtpParameters,rtpReceiver:rtpReceiver}),{localId:localId,track:rtpReceiver.track,rtpReceiver:rtpReceiver}}async stopReceiving(localId){this._assertRecvDirection(),logger.debug("stopReceiving() [localId:%s]",localId);const{mid:mid,rtpParameters:rtpParameters}=this._mapRecvLocalIdInfo.get(localId)||{};this._mapRecvLocalIdInfo.delete(localId),this._remoteSdp.planBStopReceiving({mid:mid,offerRtpParameters:rtpParameters});const offer={type:"offer",sdp:this._remoteSdp.getSdp()};logger.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",offer),await this._pc.setRemoteDescription(offer);const answer=await this._pc.createAnswer();logger.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",answer),await this._pc.setLocalDescription(answer)}async getReceiverStats(localId){this._assertRecvDirection();const{rtpReceiver:rtpReceiver}=this._mapRecvLocalIdInfo.get(localId)||{};if(!rtpReceiver)throw new Error("associated RTCRtpReceiver not found");return rtpReceiver.getStats()}async receiveDataChannel({sctpStreamParameters:sctpStreamParameters,label:label,protocol:protocol}){this._assertRecvDirection();const{streamId:streamId,ordered:ordered,maxPacketLifeTime:maxPacketLifeTime,maxRetransmits:maxRetransmits}=sctpStreamParameters,options={negotiated:!0,id:streamId,ordered:ordered,maxPacketLifeTime:maxPacketLifeTime,maxRetransmitTime:maxPacketLifeTime,maxRetransmits:maxRetransmits,protocol:protocol};logger.debug("receiveDataChannel() [options:%o]",options);const dataChannel=this._pc.createDataChannel(label,options);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const offer={type:"offer",sdp:this._remoteSdp.getSdp()};logger.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",offer),await this._pc.setRemoteDescription(offer);const answer=await this._pc.createAnswer();if(!this._transportReady){const localSdpObject=sdpTransform.parse(answer.sdp);await this._setupTransport({localDtlsRole:"client",localSdpObject:localSdpObject})}logger.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",answer),await this._pc.setLocalDescription(answer),this._hasDataChannelMediaSection=!0}return{dataChannel:dataChannel}}async _setupTransport({localDtlsRole:localDtlsRole,localSdpObject:localSdpObject}){localSdpObject||(localSdpObject=sdpTransform.parse(this._pc.localDescription.sdp));const dtlsParameters=sdpCommonUtils.extractDtlsParameters({sdpObject:localSdpObject});dtlsParameters.role=localDtlsRole,this._remoteSdp.updateDtlsRole("client"===localDtlsRole?"server":"client"),await this.safeEmitAsPromise("@connect",{dtlsParameters:dtlsParameters}),this._transportReady=!0}_assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}_assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}exports.Chrome67=Chrome67},{"../Logger":391,"../ortc":414,"../utils":417,"./HandlerInterface":403,"./sdp/RemoteSdp":409,"./sdp/commonUtils":410,"./sdp/planBUtils":411,"sdp-transform":509}],399:[function(require,module,exports){"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){void 0===k2&&(k2=k),Object.defineProperty(o,k2,{enumerable:!0,get:function(){return m[k]}})}:function(o,m,k,k2){void 0===k2&&(k2=k),o[k2]=m[k]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:!0,value:v})}:function(o,v){o.default=v}),__importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)"default"!==k&&Object.hasOwnProperty.call(mod,k)&&__createBinding(result,mod,k);return __setModuleDefault(result,mod),result};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Chrome70=void 0;const sdpTransform=__importStar(require("sdp-transform")),Logger_1=require("../Logger"),utils=__importStar(require("../utils")),ortc=__importStar(require("../ortc")),sdpCommonUtils=__importStar(require("./sdp/commonUtils")),sdpUnifiedPlanUtils=__importStar(require("./sdp/unifiedPlanUtils")),HandlerInterface_1=require("./HandlerInterface"),RemoteSdp_1=require("./sdp/RemoteSdp"),scalabilityModes_1=require("../scalabilityModes"),logger=new Logger_1.Logger("Chrome70"),SCTP_NUM_STREAMS={OS:1024,MIS:1024};class Chrome70 extends HandlerInterface_1.HandlerInterface{constructor(){super(),this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}static createFactory(){return()=>new Chrome70}get name(){return"Chrome70"}close(){if(logger.debug("close()"),this._pc)try{this._pc.close()}catch(error){}}async getNativeRtpCapabilities(){logger.debug("getNativeRtpCapabilities()");const pc=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{pc.addTransceiver("audio"),pc.addTransceiver("video");const offer=await pc.createOffer();try{pc.close()}catch(error){}const sdpObject=sdpTransform.parse(offer.sdp),nativeRtpCapabilities=sdpCommonUtils.extractRtpCapabilities({sdpObject:sdpObject});return nativeRtpCapabilities}catch(error){try{pc.close()}catch(error2){}throw error}}async getNativeSctpCapabilities(){return logger.debug("getNativeSctpCapabilities()"),{numStreams:SCTP_NUM_STREAMS}}run({direction:direction,iceParameters:iceParameters,iceCandidates:iceCandidates,dtlsParameters:dtlsParameters,sctpParameters:sctpParameters,iceServers:iceServers,iceTransportPolicy:iceTransportPolicy,additionalSettings:additionalSettings,proprietaryConstraints:proprietaryConstraints,extendedRtpCapabilities:extendedRtpCapabilities}){logger.debug("run()"),this._direction=direction,this._remoteSdp=new RemoteSdp_1.RemoteSdp({iceParameters:iceParameters,iceCandidates:iceCandidates,dtlsParameters:dtlsParameters,sctpParameters:sctpParameters}),this._sendingRtpParametersByKind={audio:ortc.getSendingRtpParameters("audio",extendedRtpCapabilities),video:ortc.getSendingRtpParameters("video",extendedRtpCapabilities)},this._sendingRemoteRtpParametersByKind={audio:ortc.getSendingRemoteRtpParameters("audio",extendedRtpCapabilities),video:ortc.getSendingRemoteRtpParameters("video",extendedRtpCapabilities)},this._pc=new RTCPeerConnection(Object.assign({iceServers:iceServers||[],iceTransportPolicy:iceTransportPolicy||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"},additionalSettings),proprietaryConstraints),this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})}async updateIceServers(iceServers){logger.debug("updateIceServers()");const configuration=this._pc.getConfiguration();configuration.iceServers=iceServers,this._pc.setConfiguration(configuration)}async restartIce(iceParameters){if(logger.debug("restartIce()"),this._remoteSdp.updateIceParameters(iceParameters),this._transportReady)if("send"===this._direction){const offer=await this._pc.createOffer({iceRestart:!0});logger.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",offer),await this._pc.setLocalDescription(offer);const answer={type:"answer",sdp:this._remoteSdp.getSdp()};logger.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",answer),await this._pc.setRemoteDescription(answer)}else{const offer={type:"offer",sdp:this._remoteSdp.getSdp()};logger.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",offer),await this._pc.setRemoteDescription(offer);const answer=await this._pc.createAnswer();logger.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",answer),await this._pc.setLocalDescription(answer)}}async getTransportStats(){return this._pc.getStats()}async send({track:track,encodings:encodings,codecOptions:codecOptions,codec:codec}){this._assertSendDirection(),logger.debug("send() [kind:%s, track.id:%s]",track.kind,track.id);const sendingRtpParameters=utils.clone(this._sendingRtpParametersByKind[track.kind],{});sendingRtpParameters.codecs=ortc.reduceCodecs(sendingRtpParameters.codecs,codec);const sendingRemoteRtpParameters=utils.clone(this._sendingRemoteRtpParametersByKind[track.kind],{});sendingRemoteRtpParameters.codecs=ortc.reduceCodecs(sendingRemoteRtpParameters.codecs,codec);const mediaSectionIdx=this._remoteSdp.getNextMediaSectionIdx(),transceiver=this._pc.addTransceiver(track,{direction:"sendonly",streams:[this._sendStream]});let offer=await this._pc.createOffer(),localSdpObject=sdpTransform.parse(offer.sdp),offerMediaObject;this._transportReady||await this._setupTransport({localDtlsRole:"server",localSdpObject:localSdpObject}),encodings&&encodings.length>1&&(logger.debug("send() | enabling legacy simulcast"),localSdpObject=sdpTransform.parse(offer.sdp),offerMediaObject=localSdpObject.media[mediaSectionIdx.idx],sdpUnifiedPlanUtils.addLegacySimulcast({offerMediaObject:offerMediaObject,numStreams:encodings.length}),offer={type:"offer",sdp:sdpTransform.write(localSdpObject)});let hackVp9Svc=!1;const layers=scalabilityModes_1.parse((encodings||[{}])[0].scalabilityMode);if(encodings&&1===encodings.length&&layers.spatialLayers>1&&"video/vp9"===sendingRtpParameters.codecs[0].mimeType.toLowerCase()&&(logger.debug("send() | enabling legacy simulcast for VP9 SVC"),hackVp9Svc=!0,localSdpObject=sdpTransform.parse(offer.sdp),offerMediaObject=localSdpObject.media[mediaSectionIdx.idx],sdpUnifiedPlanUtils.addLegacySimulcast({offerMediaObject:offerMediaObject,numStreams:layers.spatialLayers}),offer={type:"offer",sdp:sdpTransform.write(localSdpObject)}),logger.debug("send() | calling pc.setLocalDescription() [offer:%o]",offer),await this._pc.setLocalDescription(offer),encodings){logger.debug("send() | applying given encodings");const parameters=transceiver.sender.getParameters();for(let idx=0;idx<(parameters.encodings||[]).length;++idx){const encoding=parameters.encodings[idx],desiredEncoding=encodings[idx];if(!desiredEncoding)break;parameters.encodings[idx]=Object.assign(encoding,desiredEncoding)}await transceiver.sender.setParameters(parameters)}const localId=transceiver.mid;if(sendingRtpParameters.mid=localId,localSdpObject=sdpTransform.parse(this._pc.localDescription.sdp),offerMediaObject=localSdpObject.media[mediaSectionIdx.idx],sendingRtpParameters.rtcp.cname=sdpCommonUtils.getCname({offerMediaObject:offerMediaObject}),sendingRtpParameters.encodings=sdpUnifiedPlanUtils.getRtpEncodings({offerMediaObject:offerMediaObject}),encodings)for(let idx=0;idx<sendingRtpParameters.encodings.length;++idx)encodings[idx]&&Object.assign(sendingRtpParameters.encodings[idx],encodings[idx]);if(hackVp9Svc&&(sendingRtpParameters.encodings=[sendingRtpParameters.encodings[0]]),sendingRtpParameters.encodings.length>1&&("video/vp8"===sendingRtpParameters.codecs[0].mimeType.toLowerCase()||"video/h264"===sendingRtpParameters.codecs[0].mimeType.toLowerCase()))for(const encoding of sendingRtpParameters.encodings)encoding.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:offerMediaObject,reuseMid:mediaSectionIdx.reuseMid,offerRtpParameters:sendingRtpParameters,answerRtpParameters:sendingRemoteRtpParameters,codecOptions:codecOptions});const answer={type:"answer",sdp:this._remoteSdp.getSdp()};return logger.debug("send() | calling pc.setRemoteDescription() [answer:%o]",answer),await this._pc.setRemoteDescription(answer),this._mapMidTransceiver.set(localId,transceiver),{localId:localId,rtpParameters:sendingRtpParameters,rtpSender:transceiver.sender}}async stopSending(localId){this._assertSendDirection(),logger.debug("stopSending() [localId:%s]",localId);const transceiver=this._mapMidTransceiver.get(localId);if(!transceiver)throw new Error("associated RTCRtpTransceiver not found");transceiver.sender.replaceTrack(null),this._pc.removeTrack(transceiver.sender),this._remoteSdp.closeMediaSection(transceiver.mid);const offer=await this._pc.createOffer();logger.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",offer),await this._pc.setLocalDescription(offer);const answer={type:"answer",sdp:this._remoteSdp.getSdp()};logger.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",answer),await this._pc.setRemoteDescription(answer)}async replaceTrack(localId,track){this._assertSendDirection(),track?logger.debug("replaceTrack() [localId:%s, track.id:%s]",localId,track.id):logger.debug("replaceTrack() [localId:%s, no track]",localId);const transceiver=this._mapMidTransceiver.get(localId);if(!transceiver)throw new Error("associated RTCRtpTransceiver not found");await transceiver.sender.replaceTrack(track)}async setMaxSpatialLayer(localId,spatialLayer){this._assertSendDirection(),logger.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",localId,spatialLayer);const transceiver=this._mapMidTransceiver.get(localId);if(!transceiver)throw new Error("associated RTCRtpTransceiver not found");const parameters=transceiver.sender.getParameters();parameters.encodings.forEach((encoding,idx)=>{encoding.active=idx<=spatialLayer}),await transceiver.sender.setParameters(parameters)}async setRtpEncodingParameters(localId,params){this._assertSendDirection(),logger.debug("setRtpEncodingParameters() [localId:%s, params:%o]",localId,params);const transceiver=this._mapMidTransceiver.get(localId);if(!transceiver)throw new Error("associated RTCRtpTransceiver not found");const parameters=transceiver.sender.getParameters();parameters.encodings.forEach((encoding,idx)=>{parameters.encodings[idx]=Object.assign(Object.assign({},encoding),params)}),await transceiver.sender.setParameters(parameters)}async getSenderStats(localId){this._assertSendDirection();const transceiver=this._mapMidTransceiver.get(localId);if(!transceiver)throw new Error("associated RTCRtpTransceiver not found");return transceiver.sender.getStats()}async sendDataChannel({ordered:ordered,maxPacketLifeTime:maxPacketLifeTime,maxRetransmits:maxRetransmits,label:label,protocol:protocol,priority:priority}){this._assertSendDirection();const options={negotiated:!0,id:this._nextSendSctpStreamId,ordered:ordered,maxPacketLifeTime:maxPacketLifeTime,maxRetransmitTime:maxPacketLifeTime,maxRetransmits:maxRetransmits,protocol:protocol,priority:priority};logger.debug("sendDataChannel() [options:%o]",options);const dataChannel=this._pc.createDataChannel(label,options);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%SCTP_NUM_STREAMS.MIS,!this._hasDataChannelMediaSection){const offer=await this._pc.createOffer(),localSdpObject=sdpTransform.parse(offer.sdp),offerMediaObject=localSdpObject.media.find(m=>"application"===m.type);this._transportReady||await this._setupTransport({localDtlsRole:"server",localSdpObject:localSdpObject}),logger.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",offer),await this._pc.setLocalDescription(offer),this._remoteSdp.sendSctpAssociation({offerMediaObject:offerMediaObject});const answer={type:"answer",sdp:this._remoteSdp.getSdp()};logger.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",answer),await this._pc.setRemoteDescription(answer),this._hasDataChannelMediaSection=!0}const sctpStreamParameters={streamId:options.id,ordered:options.ordered,maxPacketLifeTime:options.maxPacketLifeTime,maxRetransmits:options.maxRetransmits};return{dataChannel:dataChannel,sctpStreamParameters:sctpStreamParameters}}async receive({trackId:trackId,kind:kind,rtpParameters:rtpParameters}){this._assertRecvDirection(),logger.debug("receive() [trackId:%s, kind:%s]",trackId,kind);const localId=rtpParameters.mid||String(this._mapMidTransceiver.size);this._remoteSdp.receive({mid:localId,kind:kind,offerRtpParameters:rtpParameters,streamId:rtpParameters.rtcp.cname,trackId:trackId});const offer={type:"offer",sdp:this._remoteSdp.getSdp()};logger.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",offer),await this._pc.setRemoteDescription(offer);let answer=await this._pc.createAnswer();const localSdpObject=sdpTransform.parse(answer.sdp),answerMediaObject=localSdpObject.media.find(m=>String(m.mid)===localId);sdpCommonUtils.applyCodecParameters({offerRtpParameters:rtpParameters,answerMediaObject:answerMediaObject}),answer={type:"answer",sdp:sdpTransform.write(localSdpObject)},this._transportReady||await this._setupTransport({localDtlsRole:"client",localSdpObject:localSdpObject}),logger.debug("receive() | calling pc.setLocalDescription() [answer:%o]",answer),await this._pc.setLocalDescription(answer);const transceiver=this._pc.getTransceivers().find(t=>t.mid===localId);if(!transceiver)throw new Error("new RTCRtpTransceiver not found");return this._mapMidTransceiver.set(localId,transceiver),{localId:localId,track:transceiver.receiver.track,rtpReceiver:transceiver.receiver}}async stopReceiving(localId){this._assertRecvDirection(),logger.debug("stopReceiving() [localId:%s]",localId);const transceiver=this._mapMidTransceiver.get(localId);if(!transceiver)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(transceiver.mid);const offer={type:"offer",sdp:this._remoteSdp.getSdp()};logger.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",offer),await this._pc.setRemoteDescription(offer);const answer=await this._pc.createAnswer();logger.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",answer),await this._pc.setLocalDescription(answer)}async getReceiverStats(localId){this._assertRecvDirection();const transceiver=this._mapMidTransceiver.get(localId);if(!transceiver)throw new Error("associated RTCRtpTransceiver not found");return transceiver.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:sctpStreamParameters,label:label,protocol:protocol}){this._assertRecvDirection();const{streamId:streamId,ordered:ordered,maxPacketLifeTime:maxPacketLifeTime,maxRetransmits:maxRetransmits}=sctpStreamParameters,options={negotiated:!0,id:streamId,ordered:ordered,maxPacketLifeTime:maxPacketLifeTime,maxRetransmitTime:maxPacketLifeTime,maxRetransmits:maxRetransmits,protocol:protocol};logger.debug("receiveDataChannel() [options:%o]",options);const dataChannel=this._pc.createDataChannel(label,options);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const offer={type:"offer",sdp:this._remoteSdp.getSdp()};logger.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",offer),await this._pc.setRemoteDescription(offer);const answer=await this._pc.createAnswer();if(!this._transportReady){const localSdpObject=sdpTransform.parse(answer.sdp);await this._setupTransport({localDtlsRole:"client",localSdpObject:localSdpObject})}logger.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",answer),await this._pc.setLocalDescription(answer),this._hasDataChannelMediaSection=!0}return{dataChannel:dataChannel}}async _setupTransport({localDtlsRole:localDtlsRole,localSdpObject:localSdpObject}){localSdpObject||(localSdpObject=sdpTransform.parse(this._pc.localDescription.sdp));const dtlsParameters=sdpCommonUtils.extractDtlsParameters({sdpObject:localSdpObject});dtlsParameters.role=localDtlsRole,this._remoteSdp.updateDtlsRole("client"===localDtlsRole?"server":"client"),await this.safeEmitAsPromise("@connect",{dtlsParameters:dtlsParameters}),this._transportReady=!0}_assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}_assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}exports.Chrome70=Chrome70},{"../Logger":391,"../ortc":414,"../scalabilityModes":415,"../utils":417,"./HandlerInterface":403,"./sdp/RemoteSdp":409,"./sdp/commonUtils":410,"./sdp/unifiedPlanUtils":412,"sdp-transform":509}],400:[function(require,module,exports){"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){void 0===k2&&(k2=k),Object.defineProperty(o,k2,{enumerable:!0,get:function(){return m[k]}})}:function(o,m,k,k2){void 0===k2&&(k2=k),o[k2]=m[k]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:!0,value:v})}:function(o,v){o.default=v}),__importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)"default"!==k&&Object.hasOwnProperty.call(mod,k)&&__createBinding(result,mod,k);return __setModuleDefault(result,mod),result};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Chrome74=void 0;const sdpTransform=__importStar(require("sdp-transform")),Logger_1=require("../Logger"),utils=__importStar(require("../utils")),ortc=__importStar(require("../ortc")),sdpCommonUtils=__importStar(require("./sdp/commonUtils")),sdpUnifiedPlanUtils=__importStar(require("./sdp/unifiedPlanUtils")),HandlerInterface_1=require("./HandlerInterface"),RemoteSdp_1=require("./sdp/RemoteSdp"),scalabilityModes_1=require("../scalabilityModes"),logger=new Logger_1.Logger("Chrome74"),SCTP_NUM_STREAMS={OS:1024,MIS:1024};class Chrome74 extends HandlerInterface_1.HandlerInterface{constructor(){super(),this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}static createFactory(){return()=>new Chrome74}get name(){return"Chrome74"}close(){if(logger.debug("close()"),this._pc)try{this._pc.close()}catch(error){}}async getNativeRtpCapabilities(){logger.debug("getNativeRtpCapabilities()");const pc=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{pc.addTransceiver("audio"),pc.addTransceiver("video");const offer=await pc.createOffer();try{pc.close()}catch(error){}const sdpObject=sdpTransform.parse(offer.sdp),nativeRtpCapabilities=sdpCommonUtils.extractRtpCapabilities({sdpObject:sdpObject});return nativeRtpCapabilities}catch(error){try{pc.close()}catch(error2){}throw error}}async getNativeSctpCapabilities(){return logger.debug("getNativeSctpCapabilities()"),{numStreams:SCTP_NUM_STREAMS}}run({direction:direction,iceParameters:iceParameters,iceCandidates:iceCandidates,dtlsParameters:dtlsParameters,sctpParameters:sctpParameters,iceServers:iceServers,iceTransportPolicy:iceTransportPolicy,additionalSettings:additionalSettings,proprietaryConstraints:proprietaryConstraints,extendedRtpCapabilities:extendedRtpCapabilities}){logger.debug("run()"),this._direction=direction,this._remoteSdp=new RemoteSdp_1.RemoteSdp({iceParameters:iceParameters,iceCandidates:iceCandidates,dtlsParameters:dtlsParameters,sctpParameters:sctpParameters}),this._sendingRtpParametersByKind={audio:ortc.getSendingRtpParameters("audio",extendedRtpCapabilities),video:ortc.getSendingRtpParameters("video",extendedRtpCapabilities)},this._sendingRemoteRtpParametersByKind={audio:ortc.getSendingRemoteRtpParameters("audio",extendedRtpCapabilities),video:ortc.getSendingRemoteRtpParameters("video",extendedRtpCapabilities)},this._pc=new RTCPeerConnection(Object.assign({iceServers:iceServers||[],iceTransportPolicy:iceTransportPolicy||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"},additionalSettings),proprietaryConstraints),this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})}async updateIceServers(iceServers){logger.debug("updateIceServers()");const configuration=this._pc.getConfiguration();configuration.iceServers=iceServers,this._pc.setConfiguration(configuration)}async restartIce(iceParameters){if(logger.debug("restartIce()"),this._remoteSdp.updateIceParameters(iceParameters),this._transportReady)if("send"===this._direction){const offer=await this._pc.createOffer({iceRestart:!0});logger.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",offer),await this._pc.setLocalDescription(offer);const answer={type:"answer",sdp:this._remoteSdp.getSdp()};logger.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",answer),await this._pc.setRemoteDescription(answer)}else{const offer={type:"offer",sdp:this._remoteSdp.getSdp()};logger.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",offer),await this._pc.setRemoteDescription(offer);const answer=await this._pc.createAnswer();logger.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",answer),await this._pc.setLocalDescription(answer)}}async getTransportStats(){return this._pc.getStats()}async send({track:track,encodings:encodings,codecOptions:codecOptions,codec:codec}){this._assertSendDirection(),logger.debug("send() [kind:%s, track.id:%s]",track.kind,track.id),encodings&&encodings.length>1&&encodings.forEach((encoding,idx)=>{encoding.rid=`r${idx}`});const sendingRtpParameters=utils.clone(this._sendingRtpParametersByKind[track.kind],{});sendingRtpParameters.codecs=ortc.reduceCodecs(sendingRtpParameters.codecs,codec);const sendingRemoteRtpParameters=utils.clone(this._sendingRemoteRtpParametersByKind[track.kind],{});sendingRemoteRtpParameters.codecs=ortc.reduceCodecs(sendingRemoteRtpParameters.codecs,codec);const mediaSectionIdx=this._remoteSdp.getNextMediaSectionIdx(),transceiver=this._pc.addTransceiver(track,{direction:"sendonly",streams:[this._sendStream],sendEncodings:encodings});let offer=await this._pc.createOffer(),localSdpObject=sdpTransform.parse(offer.sdp),offerMediaObject;this._transportReady||await this._setupTransport({localDtlsRole:"server",localSdpObject:localSdpObject});let hackVp9Svc=!1;const layers=scalabilityModes_1.parse((encodings||[{}])[0].scalabilityMode);encodings&&1===encodings.length&&layers.spatialLayers>1&&"video/vp9"===sendingRtpParameters.codecs[0].mimeType.toLowerCase()&&(logger.debug("send() | enabling legacy simulcast for VP9 SVC"),hackVp9Svc=!0,localSdpObject=sdpTransform.parse(offer.sdp),offerMediaObject=localSdpObject.media[mediaSectionIdx.idx],sdpUnifiedPlanUtils.addLegacySimulcast({offerMediaObject:offerMediaObject,numStreams:layers.spatialLayers}),offer={type:"offer",sdp:sdpTransform.write(localSdpObject)}),logger.debug("send() | calling pc.setLocalDescription() [offer:%o]",offer),await this._pc.setLocalDescription(offer);const localId=transceiver.mid;if(sendingRtpParameters.mid=localId,localSdpObject=sdpTransform.parse(this._pc.localDescription.sdp),offerMediaObject=localSdpObject.media[mediaSectionIdx.idx],sendingRtpParameters.rtcp.cname=sdpCommonUtils.getCname({offerMediaObject:offerMediaObject}),encodings)if(1===encodings.length){let newEncodings=sdpUnifiedPlanUtils.getRtpEncodings({offerMediaObject:offerMediaObject});Object.assign(newEncodings[0],encodings[0]),hackVp9Svc&&(newEncodings=[newEncodings[0]]),sendingRtpParameters.encodings=newEncodings}else sendingRtpParameters.encodings=encodings;else sendingRtpParameters.encodings=sdpUnifiedPlanUtils.getRtpEncodings({offerMediaObject:offerMediaObject});if(sendingRtpParameters.encodings.length>1&&("video/vp8"===sendingRtpParameters.codecs[0].mimeType.toLowerCase()||"video/h264"===sendingRtpParameters.codecs[0].mimeType.toLowerCase()))for(const encoding of sendingRtpParameters.encodings)encoding.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:offerMediaObject,reuseMid:mediaSectionIdx.reuseMid,offerRtpParameters:sendingRtpParameters,answerRtpParameters:sendingRemoteRtpParameters,codecOptions:codecOptions,extmapAllowMixed:!0});const answer={type:"answer",sdp:this._remoteSdp.getSdp()};return logger.debug("send() | calling pc.setRemoteDescription() [answer:%o]",answer),await this._pc.setRemoteDescription(answer),this._mapMidTransceiver.set(localId,transceiver),{localId:localId,rtpParameters:sendingRtpParameters,rtpSender:transceiver.sender}}async stopSending(localId){this._assertSendDirection(),logger.debug("stopSending() [localId:%s]",localId);const transceiver=this._mapMidTransceiver.get(localId);if(!transceiver)throw new Error("associated RTCRtpTransceiver not found");transceiver.sender.replaceTrack(null),this._pc.removeTrack(transceiver.sender),this._remoteSdp.closeMediaSection(transceiver.mid);const offer=await this._pc.createOffer();logger.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",offer),await this._pc.setLocalDescription(offer);const answer={type:"answer",sdp:this._remoteSdp.getSdp()};logger.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",answer),await this._pc.setRemoteDescription(answer)}async replaceTrack(localId,track){this._assertSendDirection(),track?logger.debug("replaceTrack() [localId:%s, track.id:%s]",localId,track.id):logger.debug("replaceTrack() [localId:%s, no track]",localId);const transceiver=this._mapMidTransceiver.get(localId);if(!transceiver)throw new Error("associated RTCRtpTransceiver not found");await transceiver.sender.replaceTrack(track)}async setMaxSpatialLayer(localId,spatialLayer){this._assertSendDirection(),logger.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",localId,spatialLayer);const transceiver=this._mapMidTransceiver.get(localId);if(!transceiver)throw new Error("associated RTCRtpTransceiver not found");const parameters=transceiver.sender.getParameters();parameters.encodings.forEach((encoding,idx)=>{encoding.active=idx<=spatialLayer}),await transceiver.sender.setParameters(parameters)}async setRtpEncodingParameters(localId,params){this._assertSendDirection(),logger.debug("setRtpEncodingParameters() [localId:%s, params:%o]",localId,params);const transceiver=this._mapMidTransceiver.get(localId);if(!transceiver)throw new Error("associated RTCRtpTransceiver not found");const parameters=transceiver.sender.getParameters();parameters.encodings.forEach((encoding,idx)=>{parameters.encodings[idx]=Object.assign(Object.assign({},encoding),params)}),await transceiver.sender.setParameters(parameters)}async getSenderStats(localId){this._assertSendDirection();const transceiver=this._mapMidTransceiver.get(localId);if(!transceiver)throw new Error("associated RTCRtpTransceiver not found");return transceiver.sender.getStats()}async sendDataChannel({ordered:ordered,maxPacketLifeTime:maxPacketLifeTime,maxRetransmits:maxRetransmits,label:label,protocol:protocol,priority:priority}){this._assertSendDirection();const options={negotiated:!0,id:this._nextSendSctpStreamId,ordered:ordered,maxPacketLifeTime:maxPacketLifeTime,maxRetransmits:maxRetransmits,protocol:protocol,priority:priority};logger.debug("sendDataChannel() [options:%o]",options);const dataChannel=this._pc.createDataChannel(label,options);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%SCTP_NUM_STREAMS.MIS,!this._hasDataChannelMediaSection){const offer=await this._pc.createOffer(),localSdpObject=sdpTransform.parse(offer.sdp),offerMediaObject=localSdpObject.media.find(m=>"application"===m.type);this._transportReady||await this._setupTransport({localDtlsRole:"server",localSdpObject:localSdpObject}),logger.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",offer),await this._pc.setLocalDescription(offer),this._remoteSdp.sendSctpAssociation({offerMediaObject:offerMediaObject});const answer={type:"answer",sdp:this._remoteSdp.getSdp()};logger.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",answer),await this._pc.setRemoteDescription(answer),this._hasDataChannelMediaSection=!0}const sctpStreamParameters={streamId:options.id,ordered:options.ordered,maxPacketLifeTime:options.maxPacketLifeTime,maxRetransmits:options.maxRetransmits};return{dataChannel:dataChannel,sctpStreamParameters:sctpStreamParameters}}async receive({trackId:trackId,kind:kind,rtpParameters:rtpParameters}){this._assertRecvDirection(),logger.debug("receive() [trackId:%s, kind:%s]",trackId,kind);const localId=rtpParameters.mid||String(this._mapMidTransceiver.size);this._remoteSdp.receive({mid:localId,kind:kind,offerRtpParameters:rtpParameters,streamId:rtpParameters.rtcp.cname,trackId:trackId});const offer={type:"offer",sdp:this._remoteSdp.getSdp()};logger.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",offer),await this._pc.setRemoteDescription(offer);let answer=await this._pc.createAnswer();const localSdpObject=sdpTransform.parse(answer.sdp),answerMediaObject=localSdpObject.media.find(m=>String(m.mid)===localId);sdpCommonUtils.applyCodecParameters({offerRtpParameters:rtpParameters,answerMediaObject:answerMediaObject}),answer={type:"answer",sdp:sdpTransform.write(localSdpObject)},this._transportReady||await this._setupTransport({localDtlsRole:"client",localSdpObject:localSdpObject}),logger.debug("receive() | calling pc.setLocalDescription() [answer:%o]",answer),await this._pc.setLocalDescription(answer);const transceiver=this._pc.getTransceivers().find(t=>t.mid===localId);if(!transceiver)throw new Error("new RTCRtpTransceiver not found");return this._mapMidTransceiver.set(localId,transceiver),{localId:localId,track:transceiver.receiver.track,rtpReceiver:transceiver.receiver}}async stopReceiving(localId){this._assertRecvDirection(),logger.debug("stopReceiving() [localId:%s]",localId);const transceiver=this._mapMidTransceiver.get(localId);if(!transceiver)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(transceiver.mid);const offer={type:"offer",sdp:this._remoteSdp.getSdp()};logger.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",offer),await this._pc.setRemoteDescription(offer);const answer=await this._pc.createAnswer();logger.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",answer),await this._pc.setLocalDescription(answer)}async getReceiverStats(localId){this._assertRecvDirection();const transceiver=this._mapMidTransceiver.get(localId);if(!transceiver)throw new Error("associated RTCRtpTransceiver not found");return transceiver.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:sctpStreamParameters,label:label,protocol:protocol}){this._assertRecvDirection();const{streamId:streamId,ordered:ordered,maxPacketLifeTime:maxPacketLifeTime,maxRetransmits:maxRetransmits}=sctpStreamParameters,options={negotiated:!0,id:streamId,ordered:ordered,maxPacketLifeTime:maxPacketLifeTime,maxRetransmits:maxRetransmits,protocol:protocol};logger.debug("receiveDataChannel() [options:%o]",options);const dataChannel=this._pc.createDataChannel(label,options);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const offer={type:"offer",sdp:this._remoteSdp.getSdp()};logger.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",offer),await this._pc.setRemoteDescription(offer);const answer=await this._pc.createAnswer();if(!this._transportReady){const localSdpObject=sdpTransform.parse(answer.sdp);await this._setupTransport({localDtlsRole:"client",localSdpObject:localSdpObject})}logger.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",answer),await this._pc.setLocalDescription(answer),this._hasDataChannelMediaSection=!0}return{dataChannel:dataChannel}}async _setupTransport({localDtlsRole:localDtlsRole,localSdpObject:localSdpObject}){localSdpObject||(localSdpObject=sdpTransform.parse(this._pc.localDescription.sdp));const dtlsParameters=sdpCommonUtils.extractDtlsParameters({sdpObject:localSdpObject});dtlsParameters.role=localDtlsRole,this._remoteSdp.updateDtlsRole("client"===localDtlsRole?"server":"client"),await this.safeEmitAsPromise("@connect",{dtlsParameters:dtlsParameters}),this._transportReady=!0}_assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}_assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}exports.Chrome74=Chrome74},{"../Logger":391,"../ortc":414,"../scalabilityModes":415,"../utils":417,"./HandlerInterface":403,"./sdp/RemoteSdp":409,"./sdp/commonUtils":410,"./sdp/unifiedPlanUtils":412,"sdp-transform":509}],401:[function(require,module,exports){"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){void 0===k2&&(k2=k),Object.defineProperty(o,k2,{enumerable:!0,get:function(){return m[k]}})}:function(o,m,k,k2){void 0===k2&&(k2=k),o[k2]=m[k]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:!0,value:v})}:function(o,v){o.default=v}),__importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)"default"!==k&&Object.hasOwnProperty.call(mod,k)&&__createBinding(result,mod,k);return __setModuleDefault(result,mod),result};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Edge11=void 0;const Logger_1=require("../Logger"),errors_1=require("../errors"),utils=__importStar(require("../utils")),ortc=__importStar(require("../ortc")),edgeUtils=__importStar(require("./ortc/edgeUtils")),HandlerInterface_1=require("./HandlerInterface"),logger=new Logger_1.Logger("Edge11");class Edge11 extends HandlerInterface_1.HandlerInterface{constructor(){super(),this._rtpSenders=new Map,this._rtpReceivers=new Map,this._nextSendLocalId=0,this._transportReady=!1}static createFactory(){return()=>new Edge11}get name(){return"Edge11"}close(){logger.debug("close()");try{this._iceGatherer.close()}catch(error){}try{this._iceTransport.stop()}catch(error){}try{this._dtlsTransport.stop()}catch(error){}for(const rtpSender of this._rtpSenders.values())try{rtpSender.stop()}catch(error){}for(const rtpReceiver of this._rtpReceivers.values())try{rtpReceiver.stop()}catch(error){}}async getNativeRtpCapabilities(){return logger.debug("getNativeRtpCapabilities()"),edgeUtils.getCapabilities()}async getNativeSctpCapabilities(){return logger.debug("getNativeSctpCapabilities()"),{numStreams:{OS:0,MIS:0}}}run({direction:direction,iceParameters:iceParameters,iceCandidates:iceCandidates,dtlsParameters:dtlsParameters,sctpParameters:sctpParameters,iceServers:iceServers,iceTransportPolicy:iceTransportPolicy,additionalSettings:additionalSettings,proprietaryConstraints:proprietaryConstraints,extendedRtpCapabilities:extendedRtpCapabilities}){logger.debug("run()"),this._sendingRtpParametersByKind={audio:ortc.getSendingRtpParameters("audio",extendedRtpCapabilities),video:ortc.getSendingRtpParameters("video",extendedRtpCapabilities)},this._remoteIceParameters=iceParameters,this._remoteIceCandidates=iceCandidates,this._remoteDtlsParameters=dtlsParameters,this._cname=`CNAME-${utils.generateRandomNumber()}`,this._setIceGatherer({iceServers:iceServers,iceTransportPolicy:iceTransportPolicy}),this._setIceTransport(),this._setDtlsTransport()}async updateIceServers(iceServers){throw new errors_1.UnsupportedError("not supported")}async restartIce(iceParameters){if(logger.debug("restartIce()"),this._remoteIceParameters=iceParameters,this._transportReady){logger.debug("restartIce() | calling iceTransport.start()"),this._iceTransport.start(this._iceGatherer,iceParameters,"controlling");for(const candidate of this._remoteIceCandidates)this._iceTransport.addRemoteCandidate(candidate);this._iceTransport.addRemoteCandidate({})}}async getTransportStats(){return this._iceTransport.getStats()}async send({track:track,encodings:encodings,codecOptions:codecOptions,codec:codec}){logger.debug("send() [kind:%s, track.id:%s]",track.kind,track.id),this._transportReady||await this._setupTransport({localDtlsRole:"server"}),logger.debug("send() | calling new RTCRtpSender()");const rtpSender=new RTCRtpSender(track,this._dtlsTransport),rtpParameters=utils.clone(this._sendingRtpParametersByKind[track.kind],{});rtpParameters.codecs=ortc.reduceCodecs(rtpParameters.codecs,codec);const useRtx=rtpParameters.codecs.some(_codec=>/.+\/rtx$/i.test(_codec.mimeType));encodings||(encodings=[{}]);for(const encoding of encodings)encoding.ssrc=utils.generateRandomNumber(),useRtx&&(encoding.rtx={ssrc:utils.generateRandomNumber()});rtpParameters.encodings=encodings,rtpParameters.rtcp={cname:this._cname,reducedSize:!0,mux:!0};const edgeRtpParameters=edgeUtils.mangleRtpParameters(rtpParameters);logger.debug("send() | calling rtpSender.send() [params:%o]",edgeRtpParameters),await rtpSender.send(edgeRtpParameters);const localId=String(this._nextSendLocalId);return this._nextSendLocalId++,this._rtpSenders.set(localId,rtpSender),{localId:localId,rtpParameters:rtpParameters,rtpSender:rtpSender}}async stopSending(localId){logger.debug("stopSending() [localId:%s]",localId);const rtpSender=this._rtpSenders.get(localId);if(!rtpSender)throw new Error("RTCRtpSender not found");this._rtpSenders.delete(localId);try{logger.debug("stopSending() | calling rtpSender.stop()"),rtpSender.stop()}catch(error){throw logger.warn("stopSending() | rtpSender.stop() failed:%o",error),error}}async replaceTrack(localId,track){track?logger.debug("replaceTrack() [localId:%s, track.id:%s]",localId,track.id):logger.debug("replaceTrack() [localId:%s, no track]",localId);const rtpSender=this._rtpSenders.get(localId);if(!rtpSender)throw new Error("RTCRtpSender not found");rtpSender.setTrack(track)}async setMaxSpatialLayer(localId,spatialLayer){logger.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",localId,spatialLayer);const rtpSender=this._rtpSenders.get(localId);if(!rtpSender)throw new Error("RTCRtpSender not found");const parameters=rtpSender.getParameters();parameters.encodings.forEach((encoding,idx)=>{encoding.active=idx<=spatialLayer}),await rtpSender.setParameters(parameters)}async setRtpEncodingParameters(localId,params){logger.debug("setRtpEncodingParameters() [localId:%s, params:%o]",localId,params);const rtpSender=this._rtpSenders.get(localId);if(!rtpSender)throw new Error("RTCRtpSender not found");const parameters=rtpSender.getParameters();parameters.encodings.forEach((encoding,idx)=>{parameters.encodings[idx]=Object.assign(Object.assign({},encoding),params)}),await rtpSender.setParameters(parameters)}async getSenderStats(localId){const rtpSender=this._rtpSenders.get(localId);if(!rtpSender)throw new Error("RTCRtpSender not found");return rtpSender.getStats()}async sendDataChannel(options){throw new errors_1.UnsupportedError("not implemented")}async receive({trackId:trackId,kind:kind,rtpParameters:rtpParameters}){logger.debug("receive() [trackId:%s, kind:%s]",trackId,kind),this._transportReady||await this._setupTransport({localDtlsRole:"server"}),logger.debug("receive() | calling new RTCRtpReceiver()");const rtpReceiver=new RTCRtpReceiver(this._dtlsTransport,kind);rtpReceiver.addEventListener("error",event=>{logger.error('rtpReceiver "error" event [event:%o]',event)});const edgeRtpParameters=edgeUtils.mangleRtpParameters(rtpParameters);logger.debug("receive() | calling rtpReceiver.receive() [params:%o]",edgeRtpParameters),await rtpReceiver.receive(edgeRtpParameters);const localId=trackId;return this._rtpReceivers.set(localId,rtpReceiver),{localId:localId,track:rtpReceiver.track,rtpReceiver:rtpReceiver}}async stopReceiving(localId){logger.debug("stopReceiving() [localId:%s]",localId);const rtpReceiver=this._rtpReceivers.get(localId);if(!rtpReceiver)throw new Error("RTCRtpReceiver not found");this._rtpReceivers.delete(localId);try{logger.debug("stopReceiving() | calling rtpReceiver.stop()"),rtpReceiver.stop()}catch(error){logger.warn("stopReceiving() | rtpReceiver.stop() failed:%o",error)}}async getReceiverStats(localId){const rtpReceiver=this._rtpReceivers.get(localId);if(!rtpReceiver)throw new Error("RTCRtpReceiver not found");return rtpReceiver.getStats()}async receiveDataChannel(options){throw new errors_1.UnsupportedError("not implemented")}_setIceGatherer({iceServers:iceServers,iceTransportPolicy:iceTransportPolicy}){const iceGatherer=new RTCIceGatherer({iceServers:iceServers||[],gatherPolicy:iceTransportPolicy||"all"});iceGatherer.addEventListener("error",event=>{logger.error('iceGatherer "error" event [event:%o]',event)});try{iceGatherer.gather()}catch(error){logger.debug("_setIceGatherer() | iceGatherer.gather() failed: %s",error.toString())}this._iceGatherer=iceGatherer}_setIceTransport(){const iceTransport=new RTCIceTransport(this._iceGatherer);iceTransport.addEventListener("statechange",()=>{switch(iceTransport.state){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}),iceTransport.addEventListener("icestatechange",()=>{switch(iceTransport.state){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}),iceTransport.addEventListener("candidatepairchange",event=>{logger.debug('iceTransport "candidatepairchange" event [pair:%o]',event.pair)}),this._iceTransport=iceTransport}_setDtlsTransport(){const dtlsTransport=new RTCDtlsTransport(this._iceTransport);dtlsTransport.addEventListener("statechange",()=>{logger.debug('dtlsTransport "statechange" event [state:%s]',dtlsTransport.state)}),dtlsTransport.addEventListener("dtlsstatechange",()=>{logger.debug('dtlsTransport "dtlsstatechange" event [state:%s]',dtlsTransport.state),"closed"===dtlsTransport.state&&this.emit("@connectionstatechange","closed")}),dtlsTransport.addEventListener("error",event=>{logger.error('dtlsTransport "error" event [event:%o]',event)}),this._dtlsTransport=dtlsTransport}async _setupTransport({localDtlsRole:localDtlsRole}){logger.debug("_setupTransport()");const dtlsParameters=this._dtlsTransport.getLocalParameters();dtlsParameters.role=localDtlsRole,await this.safeEmitAsPromise("@connect",{dtlsParameters:dtlsParameters}),this._iceTransport.start(this._iceGatherer,this._remoteIceParameters,"controlling");for(const candidate of this._remoteIceCandidates)this._iceTransport.addRemoteCandidate(candidate);this._iceTransport.addRemoteCandidate({}),this._remoteDtlsParameters.fingerprints=this._remoteDtlsParameters.fingerprints.filter(fingerprint=>"sha-256"===fingerprint.algorithm||"sha-384"===fingerprint.algorithm||"sha-512"===fingerprint.algorithm),this._dtlsTransport.start(this._remoteDtlsParameters),this._transportReady=!0}}exports.Edge11=Edge11},{"../Logger":391,"../errors":396,"../ortc":414,"../utils":417,"./HandlerInterface":403,"./ortc/edgeUtils":407}],402:[function(require,module,exports){"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){void 0===k2&&(k2=k),Object.defineProperty(o,k2,{enumerable:!0,get:function(){return m[k]}})}:function(o,m,k,k2){void 0===k2&&(k2=k),o[k2]=m[k]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:!0,value:v})}:function(o,v){o.default=v}),__importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)"default"!==k&&Object.hasOwnProperty.call(mod,k)&&__createBinding(result,mod,k);return __setModuleDefault(result,mod),result};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Firefox60=void 0;const sdpTransform=__importStar(require("sdp-transform")),Logger_1=require("../Logger"),errors_1=require("../errors"),utils=__importStar(require("../utils")),ortc=__importStar(require("../ortc")),sdpCommonUtils=__importStar(require("./sdp/commonUtils")),sdpUnifiedPlanUtils=__importStar(require("./sdp/unifiedPlanUtils")),HandlerInterface_1=require("./HandlerInterface"),RemoteSdp_1=require("./sdp/RemoteSdp"),logger=new Logger_1.Logger("Firefox60"),SCTP_NUM_STREAMS={OS:16,MIS:2048};class Firefox60 extends HandlerInterface_1.HandlerInterface{constructor(){super(),this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}static createFactory(){return()=>new Firefox60}get name(){return"Firefox60"}close(){if(logger.debug("close()"),this._pc)try{this._pc.close()}catch(error){}}async getNativeRtpCapabilities(){logger.debug("getNativeRtpCapabilities()");const pc=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),canvas=document.createElement("canvas");canvas.getContext("2d");const fakeStream=canvas.captureStream(),fakeVideoTrack=fakeStream.getVideoTracks()[0];try{pc.addTransceiver("audio",{direction:"sendrecv"});const videoTransceiver=pc.addTransceiver(fakeVideoTrack,{direction:"sendrecv"}),parameters=videoTransceiver.sender.getParameters(),encodings=[{rid:"r0",maxBitrate:1e5},{rid:"r1",maxBitrate:5e5}];parameters.encodings=encodings,await videoTransceiver.sender.setParameters(parameters);const offer=await pc.createOffer();try{canvas.remove()}catch(error){}try{fakeVideoTrack.stop()}catch(error){}try{pc.close()}catch(error){}const sdpObject=sdpTransform.parse(offer.sdp),nativeRtpCapabilities=sdpCommonUtils.extractRtpCapabilities({sdpObject:sdpObject});return nativeRtpCapabilities}catch(error){try{canvas.remove()}catch(error2){}try{fakeVideoTrack.stop()}catch(error2){}try{pc.close()}catch(error2){}throw error}}async getNativeSctpCapabilities(){return logger.debug("getNativeSctpCapabilities()"),{numStreams:SCTP_NUM_STREAMS}}run({direction:direction,iceParameters:iceParameters,iceCandidates:iceCandidates,dtlsParameters:dtlsParameters,sctpParameters:sctpParameters,iceServers:iceServers,iceTransportPolicy:iceTransportPolicy,additionalSettings:additionalSettings,proprietaryConstraints:proprietaryConstraints,extendedRtpCapabilities:extendedRtpCapabilities}){logger.debug("run()"),this._direction=direction,this._remoteSdp=new RemoteSdp_1.RemoteSdp({iceParameters:iceParameters,iceCandidates:iceCandidates,dtlsParameters:dtlsParameters,sctpParameters:sctpParameters}),this._sendingRtpParametersByKind={audio:ortc.getSendingRtpParameters("audio",extendedRtpCapabilities),video:ortc.getSendingRtpParameters("video",extendedRtpCapabilities)},this._sendingRemoteRtpParametersByKind={audio:ortc.getSendingRemoteRtpParameters("audio",extendedRtpCapabilities),video:ortc.getSendingRemoteRtpParameters("video",extendedRtpCapabilities)},this._pc=new RTCPeerConnection(Object.assign({iceServers:iceServers||[],iceTransportPolicy:iceTransportPolicy||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},additionalSettings),proprietaryConstraints),this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})}async updateIceServers(iceServers){throw new errors_1.UnsupportedError("not supported")}async restartIce(iceParameters){if(logger.debug("restartIce()"),this._remoteSdp.updateIceParameters(iceParameters),this._transportReady)if("send"===this._direction){const offer=await this._pc.createOffer({iceRestart:!0});logger.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",offer),await this._pc.setLocalDescription(offer);const answer={type:"answer",sdp:this._remoteSdp.getSdp()};logger.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",answer),await this._pc.setRemoteDescription(answer)}else{const offer={type:"offer",sdp:this._remoteSdp.getSdp()};logger.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",offer),await this._pc.setRemoteDescription(offer);const answer=await this._pc.createAnswer();logger.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",answer),await this._pc.setLocalDescription(answer)}}async getTransportStats(){return this._pc.getStats()}async send({track:track,encodings:encodings,codecOptions:codecOptions,codec:codec}){this._assertSendDirection(),logger.debug("send() [kind:%s, track.id:%s]",track.kind,track.id),encodings&&(encodings=utils.clone(encodings,[])).length>1&&(encodings.forEach((encoding,idx)=>{encoding.rid=`r${idx}`}),encodings.reverse());const sendingRtpParameters=utils.clone(this._sendingRtpParametersByKind[track.kind],{});sendingRtpParameters.codecs=ortc.reduceCodecs(sendingRtpParameters.codecs,codec);const sendingRemoteRtpParameters=utils.clone(this._sendingRemoteRtpParametersByKind[track.kind],{});sendingRemoteRtpParameters.codecs=ortc.reduceCodecs(sendingRemoteRtpParameters.codecs,codec);const transceiver=this._pc.addTransceiver(track,{direction:"sendonly",streams:[this._sendStream]});if(encodings){const parameters=transceiver.sender.getParameters();parameters.encodings=encodings,await transceiver.sender.setParameters(parameters)}const offer=await this._pc.createOffer();let localSdpObject=sdpTransform.parse(offer.sdp);this._transportReady||await this._setupTransport({localDtlsRole:"client",localSdpObject:localSdpObject}),logger.debug("send() | calling pc.setLocalDescription() [offer:%o]",offer),await this._pc.setLocalDescription(offer);const localId=transceiver.mid;sendingRtpParameters.mid=localId,localSdpObject=sdpTransform.parse(this._pc.localDescription.sdp);const offerMediaObject=localSdpObject.media[localSdpObject.media.length-1];if(sendingRtpParameters.rtcp.cname=sdpCommonUtils.getCname({offerMediaObject:offerMediaObject}),encodings)if(1===encodings.length){const newEncodings=sdpUnifiedPlanUtils.getRtpEncodings({offerMediaObject:offerMediaObject});Object.assign(newEncodings[0],encodings[0]),sendingRtpParameters.encodings=newEncodings}else sendingRtpParameters.encodings=encodings.reverse();else sendingRtpParameters.encodings=sdpUnifiedPlanUtils.getRtpEncodings({offerMediaObject:offerMediaObject});if(sendingRtpParameters.encodings.length>1&&("video/vp8"===sendingRtpParameters.codecs[0].mimeType.toLowerCase()||"video/h264"===sendingRtpParameters.codecs[0].mimeType.toLowerCase()))for(const encoding of sendingRtpParameters.encodings)encoding.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:offerMediaObject,offerRtpParameters:sendingRtpParameters,answerRtpParameters:sendingRemoteRtpParameters,codecOptions:codecOptions,extmapAllowMixed:!0});const answer={type:"answer",sdp:this._remoteSdp.getSdp()};return logger.debug("send() | calling pc.setRemoteDescription() [answer:%o]",answer),await this._pc.setRemoteDescription(answer),this._mapMidTransceiver.set(localId,transceiver),{localId:localId,rtpParameters:sendingRtpParameters,rtpSender:transceiver.sender}}async stopSending(localId){logger.debug("stopSending() [localId:%s]",localId);const transceiver=this._mapMidTransceiver.get(localId);if(!transceiver)throw new Error("associated transceiver not found");transceiver.sender.replaceTrack(null),this._pc.removeTrack(transceiver.sender),this._remoteSdp.disableMediaSection(transceiver.mid);const offer=await this._pc.createOffer();logger.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",offer),await this._pc.setLocalDescription(offer);const answer={type:"answer",sdp:this._remoteSdp.getSdp()};logger.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",answer),await this._pc.setRemoteDescription(answer)}async replaceTrack(localId,track){this._assertSendDirection(),track?logger.debug("replaceTrack() [localId:%s, track.id:%s]",localId,track.id):logger.debug("replaceTrack() [localId:%s, no track]",localId);const transceiver=this._mapMidTransceiver.get(localId);if(!transceiver)throw new Error("associated RTCRtpTransceiver not found");await transceiver.sender.replaceTrack(track)}async setMaxSpatialLayer(localId,spatialLayer){this._assertSendDirection(),logger.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",localId,spatialLayer);const transceiver=this._mapMidTransceiver.get(localId);if(!transceiver)throw new Error("associated transceiver not found");const parameters=transceiver.sender.getParameters();spatialLayer=parameters.encodings.length-1-spatialLayer,parameters.encodings.forEach((encoding,idx)=>{encoding.active=idx>=spatialLayer}),await transceiver.sender.setParameters(parameters)}async setRtpEncodingParameters(localId,params){this._assertSendDirection(),logger.debug("setRtpEncodingParameters() [localId:%s, params:%o]",localId,params);const transceiver=this._mapMidTransceiver.get(localId);if(!transceiver)throw new Error("associated RTCRtpTransceiver not found");const parameters=transceiver.sender.getParameters();parameters.encodings.forEach((encoding,idx)=>{parameters.encodings[idx]=Object.assign(Object.assign({},encoding),params)}),await transceiver.sender.setParameters(parameters)}async getSenderStats(localId){this._assertSendDirection();const transceiver=this._mapMidTransceiver.get(localId);if(!transceiver)throw new Error("associated RTCRtpTransceiver not found");return transceiver.sender.getStats()}async sendDataChannel({ordered:ordered,maxPacketLifeTime:maxPacketLifeTime,maxRetransmits:maxRetransmits,label:label,protocol:protocol,priority:priority}){this._assertSendDirection();const options={negotiated:!0,id:this._nextSendSctpStreamId,ordered:ordered,maxPacketLifeTime:maxPacketLifeTime,maxRetransmits:maxRetransmits,protocol:protocol,priority:priority};logger.debug("sendDataChannel() [options:%o]",options);const dataChannel=this._pc.createDataChannel(label,options);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%SCTP_NUM_STREAMS.MIS,!this._hasDataChannelMediaSection){const offer=await this._pc.createOffer(),localSdpObject=sdpTransform.parse(offer.sdp),offerMediaObject=localSdpObject.media.find(m=>"application"===m.type);this._transportReady||await this._setupTransport({localDtlsRole:"server",localSdpObject:localSdpObject}),logger.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",offer),await this._pc.setLocalDescription(offer),this._remoteSdp.sendSctpAssociation({offerMediaObject:offerMediaObject});const answer={type:"answer",sdp:this._remoteSdp.getSdp()};logger.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",answer),await this._pc.setRemoteDescription(answer),this._hasDataChannelMediaSection=!0}const sctpStreamParameters={streamId:options.id,ordered:options.ordered,maxPacketLifeTime:options.maxPacketLifeTime,maxRetransmits:options.maxRetransmits};return{dataChannel:dataChannel,sctpStreamParameters:sctpStreamParameters}}async receive({trackId:trackId,kind:kind,rtpParameters:rtpParameters}){this._assertRecvDirection(),logger.debug("receive() [trackId:%s, kind:%s]",trackId,kind);const localId=rtpParameters.mid||String(this._mapMidTransceiver.size);this._remoteSdp.receive({mid:localId,kind:kind,offerRtpParameters:rtpParameters,streamId:rtpParameters.rtcp.cname,trackId:trackId});const offer={type:"offer",sdp:this._remoteSdp.getSdp()};logger.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",offer),await this._pc.setRemoteDescription(offer);let answer=await this._pc.createAnswer();const localSdpObject=sdpTransform.parse(answer.sdp),answerMediaObject=localSdpObject.media.find(m=>String(m.mid)===localId);sdpCommonUtils.applyCodecParameters({offerRtpParameters:rtpParameters,answerMediaObject:answerMediaObject}),answer={type:"answer",sdp:sdpTransform.write(localSdpObject)},this._transportReady||await this._setupTransport({localDtlsRole:"client",localSdpObject:localSdpObject}),logger.debug("receive() | calling pc.setLocalDescription() [answer:%o]",answer),await this._pc.setLocalDescription(answer);const transceiver=this._pc.getTransceivers().find(t=>t.mid===localId);if(!transceiver)throw new Error("new RTCRtpTransceiver not found");return this._mapMidTransceiver.set(localId,transceiver),{localId:localId,track:transceiver.receiver.track,rtpReceiver:transceiver.receiver}}async stopReceiving(localId){this._assertRecvDirection(),logger.debug("stopReceiving() [localId:%s]",localId);const transceiver=this._mapMidTransceiver.get(localId);if(!transceiver)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(transceiver.mid);const offer={type:"offer",sdp:this._remoteSdp.getSdp()};logger.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",offer),await this._pc.setRemoteDescription(offer);const answer=await this._pc.createAnswer();logger.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",answer),await this._pc.setLocalDescription(answer)}async getReceiverStats(localId){this._assertRecvDirection();const transceiver=this._mapMidTransceiver.get(localId);if(!transceiver)throw new Error("associated RTCRtpTransceiver not found");return transceiver.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:sctpStreamParameters,label:label,protocol:protocol}){this._assertRecvDirection();const{streamId:streamId,ordered:ordered,maxPacketLifeTime:maxPacketLifeTime,maxRetransmits:maxRetransmits}=sctpStreamParameters,options={negotiated:!0,id:streamId,ordered:ordered,maxPacketLifeTime:maxPacketLifeTime,maxRetransmits:maxRetransmits,protocol:protocol};logger.debug("receiveDataChannel() [options:%o]",options);const dataChannel=this._pc.createDataChannel(label,options);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const offer={type:"offer",sdp:this._remoteSdp.getSdp()};logger.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",offer),await this._pc.setRemoteDescription(offer);const answer=await this._pc.createAnswer();if(!this._transportReady){const localSdpObject=sdpTransform.parse(answer.sdp);await this._setupTransport({localDtlsRole:"client",localSdpObject:localSdpObject})}logger.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",answer),await this._pc.setLocalDescription(answer),this._hasDataChannelMediaSection=!0}return{dataChannel:dataChannel}}async _setupTransport({localDtlsRole:localDtlsRole,localSdpObject:localSdpObject}){localSdpObject||(localSdpObject=sdpTransform.parse(this._pc.localDescription.sdp));const dtlsParameters=sdpCommonUtils.extractDtlsParameters({sdpObject:localSdpObject});dtlsParameters.role=localDtlsRole,this._remoteSdp.updateDtlsRole("client"===localDtlsRole?"server":"client"),await this.safeEmitAsPromise("@connect",{dtlsParameters:dtlsParameters}),this._transportReady=!0}_assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}_assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}exports.Firefox60=Firefox60},{"../Logger":391,"../errors":396,"../ortc":414,"../utils":417,"./HandlerInterface":403,"./sdp/RemoteSdp":409,"./sdp/commonUtils":410,"./sdp/unifiedPlanUtils":412,"sdp-transform":509}],403:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.HandlerInterface=void 0;const EnhancedEventEmitter_1=require("../EnhancedEventEmitter");class HandlerInterface extends EnhancedEventEmitter_1.EnhancedEventEmitter{constructor(){super()}}exports.HandlerInterface=HandlerInterface},{"../EnhancedEventEmitter":390}],404:[function(require,module,exports){"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){void 0===k2&&(k2=k),Object.defineProperty(o,k2,{enumerable:!0,get:function(){return m[k]}})}:function(o,m,k,k2){void 0===k2&&(k2=k),o[k2]=m[k]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:!0,value:v})}:function(o,v){o.default=v}),__importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)"default"!==k&&Object.hasOwnProperty.call(mod,k)&&__createBinding(result,mod,k);return __setModuleDefault(result,mod),result};Object.defineProperty(exports,"__esModule",{value:!0}),exports.ReactNative=void 0;const sdpTransform=__importStar(require("sdp-transform")),Logger_1=require("../Logger"),errors_1=require("../errors"),utils=__importStar(require("../utils")),ortc=__importStar(require("../ortc")),sdpCommonUtils=__importStar(require("./sdp/commonUtils")),sdpPlanBUtils=__importStar(require("./sdp/planBUtils")),HandlerInterface_1=require("./HandlerInterface"),RemoteSdp_1=require("./sdp/RemoteSdp"),logger=new Logger_1.Logger("ReactNative"),SCTP_NUM_STREAMS={OS:1024,MIS:1024};class ReactNative extends HandlerInterface_1.HandlerInterface{constructor(){super(),this._sendStream=new MediaStream,this._mapSendLocalIdTrack=new Map,this._nextSendLocalId=0,this._mapRecvLocalIdInfo=new Map,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}static createFactory(){return()=>new ReactNative}get name(){return"ReactNative"}close(){if(logger.debug("close()"),this._pc)try{this._pc.close()}catch(error){}}async getNativeRtpCapabilities(){logger.debug("getNativeRtpCapabilities()");const pc=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const offer=await pc.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{pc.close()}catch(error){}const sdpObject=sdpTransform.parse(offer.sdp),nativeRtpCapabilities=sdpCommonUtils.extractRtpCapabilities({sdpObject:sdpObject});return nativeRtpCapabilities}catch(error){try{pc.close()}catch(error2){}throw error}}async getNativeSctpCapabilities(){return logger.debug("getNativeSctpCapabilities()"),{numStreams:SCTP_NUM_STREAMS}}run({direction:direction,iceParameters:iceParameters,iceCandidates:iceCandidates,dtlsParameters:dtlsParameters,sctpParameters:sctpParameters,iceServers:iceServers,iceTransportPolicy:iceTransportPolicy,additionalSettings:additionalSettings,proprietaryConstraints:proprietaryConstraints,extendedRtpCapabilities:extendedRtpCapabilities}){logger.debug("run()"),this._direction=direction,this._remoteSdp=new RemoteSdp_1.RemoteSdp({iceParameters:iceParameters,iceCandidates:iceCandidates,dtlsParameters:dtlsParameters,sctpParameters:sctpParameters,planB:!0}),this._sendingRtpParametersByKind={audio:ortc.getSendingRtpParameters("audio",extendedRtpCapabilities),video:ortc.getSendingRtpParameters("video",extendedRtpCapabilities)},this._sendingRemoteRtpParametersByKind={audio:ortc.getSendingRemoteRtpParameters("audio",extendedRtpCapabilities),video:ortc.getSendingRemoteRtpParameters("video",extendedRtpCapabilities)},this._pc=new RTCPeerConnection(Object.assign({iceServers:iceServers||[],iceTransportPolicy:iceTransportPolicy||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"},additionalSettings),proprietaryConstraints),this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})}async updateIceServers(iceServers){logger.debug("updateIceServers()");const configuration=this._pc.getConfiguration();configuration.iceServers=iceServers,this._pc.setConfiguration(configuration)}async restartIce(iceParameters){if(logger.debug("restartIce()"),this._remoteSdp.updateIceParameters(iceParameters),this._transportReady)if("send"===this._direction){const offer=await this._pc.createOffer({iceRestart:!0});logger.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",offer),await this._pc.setLocalDescription(offer);const answer={type:"answer",sdp:this._remoteSdp.getSdp()};logger.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",answer),await this._pc.setRemoteDescription(answer)}else{const offer={type:"offer",sdp:this._remoteSdp.getSdp()};logger.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",offer),await this._pc.setRemoteDescription(offer);const answer=await this._pc.createAnswer();logger.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",answer),await this._pc.setLocalDescription(answer)}}async getTransportStats(){return this._pc.getStats()}async send({track:track,encodings:encodings,codecOptions:codecOptions,codec:codec}){this._assertSendDirection(),logger.debug("send() [kind:%s, track.id:%s]",track.kind,track.id),codec&&logger.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(track),this._pc.addStream(this._sendStream);let offer=await this._pc.createOffer(),localSdpObject=sdpTransform.parse(offer.sdp),offerMediaObject;const sendingRtpParameters=utils.clone(this._sendingRtpParametersByKind[track.kind],{});sendingRtpParameters.codecs=ortc.reduceCodecs(sendingRtpParameters.codecs);const sendingRemoteRtpParameters=utils.clone(this._sendingRemoteRtpParametersByKind[track.kind],{});if(sendingRemoteRtpParameters.codecs=ortc.reduceCodecs(sendingRemoteRtpParameters.codecs),this._transportReady||await this._setupTransport({localDtlsRole:"server",localSdpObject:localSdpObject}),"video"===track.kind&&encodings&&encodings.length>1&&(logger.debug("send() | enabling simulcast"),localSdpObject=sdpTransform.parse(offer.sdp),offerMediaObject=localSdpObject.media.find(m=>"video"===m.type),sdpPlanBUtils.addLegacySimulcast({offerMediaObject:offerMediaObject,track:track,numStreams:encodings.length}),offer={type:"offer",sdp:sdpTransform.write(localSdpObject)}),logger.debug("send() | calling pc.setLocalDescription() [offer:%o]",offer),await this._pc.setLocalDescription(offer),localSdpObject=sdpTransform.parse(this._pc.localDescription.sdp),offerMediaObject=localSdpObject.media.find(m=>m.type===track.kind),sendingRtpParameters.rtcp.cname=sdpCommonUtils.getCname({offerMediaObject:offerMediaObject}),sendingRtpParameters.encodings=sdpPlanBUtils.getRtpEncodings({offerMediaObject:offerMediaObject,track:track}),encodings)for(let idx=0;idx<sendingRtpParameters.encodings.length;++idx)encodings[idx]&&Object.assign(sendingRtpParameters.encodings[idx],encodings[idx]);if(sendingRtpParameters.encodings.length>1&&("video/vp8"===sendingRtpParameters.codecs[0].mimeType.toLowerCase()||"video/h264"===sendingRtpParameters.codecs[0].mimeType.toLowerCase()))for(const encoding of sendingRtpParameters.encodings)encoding.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:offerMediaObject,offerRtpParameters:sendingRtpParameters,answerRtpParameters:sendingRemoteRtpParameters,codecOptions:codecOptions});const answer={type:"answer",sdp:this._remoteSdp.getSdp()};logger.debug("send() | calling pc.setRemoteDescription() [answer:%o]",answer),await this._pc.setRemoteDescription(answer);const localId=String(this._nextSendLocalId);return this._nextSendLocalId++,this._mapSendLocalIdTrack.set(localId,track),{localId:localId,rtpParameters:sendingRtpParameters}}async stopSending(localId){this._assertSendDirection(),logger.debug("stopSending() [localId:%s]",localId);const track=this._mapSendLocalIdTrack.get(localId);if(!track)throw new Error("track not found");this._mapSendLocalIdTrack.delete(localId),this._sendStream.removeTrack(track),this._pc.addStream(this._sendStream);const offer=await this._pc.createOffer();logger.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",offer);try{await this._pc.setLocalDescription(offer)}catch(error){if(0===this._sendStream.getTracks().length)return void logger.warn("stopSending() | ignoring expected error due no sending tracks: %s",error.toString());throw error}if("stable"===this._pc.signalingState)return;const answer={type:"answer",sdp:this._remoteSdp.getSdp()};logger.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",answer),await this._pc.setRemoteDescription(answer)}async replaceTrack(localId,track){throw new errors_1.UnsupportedError("not implemented")}async setMaxSpatialLayer(localId,spatialLayer){throw new errors_1.UnsupportedError("not implemented")}async setRtpEncodingParameters(localId,params){throw new errors_1.UnsupportedError("not implemented")}async getSenderStats(localId){throw new errors_1.UnsupportedError("not implemented")}async sendDataChannel({ordered:ordered,maxPacketLifeTime:maxPacketLifeTime,maxRetransmits:maxRetransmits,label:label,protocol:protocol,priority:priority}){this._assertSendDirection();const options={negotiated:!0,id:this._nextSendSctpStreamId,ordered:ordered,maxPacketLifeTime:maxPacketLifeTime,maxRetransmitTime:maxPacketLifeTime,maxRetransmits:maxRetransmits,protocol:protocol,priority:priority};logger.debug("sendDataChannel() [options:%o]",options);const dataChannel=this._pc.createDataChannel(label,options);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%SCTP_NUM_STREAMS.MIS,!this._hasDataChannelMediaSection){const offer=await this._pc.createOffer(),localSdpObject=sdpTransform.parse(offer.sdp),offerMediaObject=localSdpObject.media.find(m=>"application"===m.type);this._transportReady||await this._setupTransport({localDtlsRole:"server",localSdpObject:localSdpObject}),logger.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",offer),await this._pc.setLocalDescription(offer),this._remoteSdp.sendSctpAssociation({offerMediaObject:offerMediaObject});const answer={type:"answer",sdp:this._remoteSdp.getSdp()};logger.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",answer),await this._pc.setRemoteDescription(answer),this._hasDataChannelMediaSection=!0}const sctpStreamParameters={streamId:options.id,ordered:options.ordered,maxPacketLifeTime:options.maxPacketLifeTime,maxRetransmits:options.maxRetransmits};return{dataChannel:dataChannel,sctpStreamParameters:sctpStreamParameters}}async receive({trackId:trackId,kind:kind,rtpParameters:rtpParameters}){this._assertRecvDirection(),logger.debug("receive() [trackId:%s, kind:%s]",trackId,kind);const localId=trackId,mid=kind;let streamId=rtpParameters.rtcp.cname;logger.debug("receive() | forcing a random remote streamId to avoid well known bug in react-native-webrtc"),streamId+=`-hack-${utils.generateRandomNumber()}`,this._remoteSdp.receive({mid:mid,kind:kind,offerRtpParameters:rtpParameters,streamId:streamId,trackId:trackId});const offer={type:"offer",sdp:this._remoteSdp.getSdp()};logger.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",offer),await this._pc.setRemoteDescription(offer);let answer=await this._pc.createAnswer();const localSdpObject=sdpTransform.parse(answer.sdp),answerMediaObject=localSdpObject.media.find(m=>String(m.mid)===mid);sdpCommonUtils.applyCodecParameters({offerRtpParameters:rtpParameters,answerMediaObject:answerMediaObject}),answer={type:"answer",sdp:sdpTransform.write(localSdpObject)},this._transportReady||await this._setupTransport({localDtlsRole:"client",localSdpObject:localSdpObject}),logger.debug("receive() | calling pc.setLocalDescription() [answer:%o]",answer),await this._pc.setLocalDescription(answer);const stream=this._pc.getRemoteStreams().find(s=>s.id===streamId),track=stream.getTrackById(localId);if(!track)throw new Error("remote track not found");return this._mapRecvLocalIdInfo.set(localId,{mid:mid,rtpParameters:rtpParameters}),{localId:localId,track:track}}async stopReceiving(localId){this._assertRecvDirection(),logger.debug("stopReceiving() [localId:%s]",localId);const{mid:mid,rtpParameters:rtpParameters}=this._mapRecvLocalIdInfo.get(localId)||{};this._mapRecvLocalIdInfo.delete(localId),this._remoteSdp.planBStopReceiving({mid:mid,offerRtpParameters:rtpParameters});const offer={type:"offer",sdp:this._remoteSdp.getSdp()};logger.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",offer),await this._pc.setRemoteDescription(offer);const answer=await this._pc.createAnswer();logger.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",answer),await this._pc.setLocalDescription(answer)}async getReceiverStats(localId){throw new errors_1.UnsupportedError("not implemented")}async receiveDataChannel({sctpStreamParameters:sctpStreamParameters,label:label,protocol:protocol}){this._assertRecvDirection();const{streamId:streamId,ordered:ordered,maxPacketLifeTime:maxPacketLifeTime,maxRetransmits:maxRetransmits}=sctpStreamParameters,options={negotiated:!0,id:streamId,ordered:ordered,maxPacketLifeTime:maxPacketLifeTime,maxRetransmitTime:maxPacketLifeTime,maxRetransmits:maxRetransmits,protocol:protocol};logger.debug("receiveDataChannel() [options:%o]",options);const dataChannel=this._pc.createDataChannel(label,options);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const offer={type:"offer",sdp:this._remoteSdp.getSdp()};logger.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",offer),await this._pc.setRemoteDescription(offer);const answer=await this._pc.createAnswer();if(!this._transportReady){const localSdpObject=sdpTransform.parse(answer.sdp);await this._setupTransport({localDtlsRole:"client",localSdpObject:localSdpObject})}logger.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",answer),await this._pc.setLocalDescription(answer),this._hasDataChannelMediaSection=!0}return{dataChannel:dataChannel}}async _setupTransport({localDtlsRole:localDtlsRole,localSdpObject:localSdpObject}){localSdpObject||(localSdpObject=sdpTransform.parse(this._pc.localDescription.sdp));const dtlsParameters=sdpCommonUtils.extractDtlsParameters({sdpObject:localSdpObject});dtlsParameters.role=localDtlsRole,this._remoteSdp.updateDtlsRole("client"===localDtlsRole?"server":"client"),await this.safeEmitAsPromise("@connect",{dtlsParameters:dtlsParameters}),this._transportReady=!0}_assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}_assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}exports.ReactNative=ReactNative},{"../Logger":391,"../errors":396,"../ortc":414,"../utils":417,"./HandlerInterface":403,"./sdp/RemoteSdp":409,"./sdp/commonUtils":410,"./sdp/planBUtils":411,"sdp-transform":509}],405:[function(require,module,exports){"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){void 0===k2&&(k2=k),Object.defineProperty(o,k2,{enumerable:!0,get:function(){return m[k]}})}:function(o,m,k,k2){void 0===k2&&(k2=k),o[k2]=m[k]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:!0,value:v})}:function(o,v){o.default=v}),__importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)"default"!==k&&Object.hasOwnProperty.call(mod,k)&&__createBinding(result,mod,k);return __setModuleDefault(result,mod),result};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Safari11=void 0;const sdpTransform=__importStar(require("sdp-transform")),Logger_1=require("../Logger"),utils=__importStar(require("../utils")),ortc=__importStar(require("../ortc")),sdpCommonUtils=__importStar(require("./sdp/commonUtils")),sdpPlanBUtils=__importStar(require("./sdp/planBUtils")),HandlerInterface_1=require("./HandlerInterface"),RemoteSdp_1=require("./sdp/RemoteSdp"),logger=new Logger_1.Logger("Safari11"),SCTP_NUM_STREAMS={OS:1024,MIS:1024};class Safari11 extends HandlerInterface_1.HandlerInterface{constructor(){super(),this._sendStream=new MediaStream,this._mapSendLocalIdRtpSender=new Map,this._nextSendLocalId=0,this._mapRecvLocalIdInfo=new Map,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}static createFactory(){return()=>new Safari11}get name(){return"Safari11"}close(){if(logger.debug("close()"),this._pc)try{this._pc.close()}catch(error){}}async getNativeRtpCapabilities(){logger.debug("getNativeRtpCapabilities()");const pc=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const offer=await pc.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{pc.close()}catch(error){}const sdpObject=sdpTransform.parse(offer.sdp),nativeRtpCapabilities=sdpCommonUtils.extractRtpCapabilities({sdpObject:sdpObject});return nativeRtpCapabilities}catch(error){try{pc.close()}catch(error2){}throw error}}async getNativeSctpCapabilities(){return logger.debug("getNativeSctpCapabilities()"),{numStreams:SCTP_NUM_STREAMS}}run({direction:direction,iceParameters:iceParameters,iceCandidates:iceCandidates,dtlsParameters:dtlsParameters,sctpParameters:sctpParameters,iceServers:iceServers,iceTransportPolicy:iceTransportPolicy,additionalSettings:additionalSettings,proprietaryConstraints:proprietaryConstraints,extendedRtpCapabilities:extendedRtpCapabilities}){logger.debug("run()"),this._direction=direction,this._remoteSdp=new RemoteSdp_1.RemoteSdp({iceParameters:iceParameters,iceCandidates:iceCandidates,dtlsParameters:dtlsParameters,sctpParameters:sctpParameters,planB:!0}),this._sendingRtpParametersByKind={audio:ortc.getSendingRtpParameters("audio",extendedRtpCapabilities),video:ortc.getSendingRtpParameters("video",extendedRtpCapabilities)},this._sendingRemoteRtpParametersByKind={audio:ortc.getSendingRemoteRtpParameters("audio",extendedRtpCapabilities),video:ortc.getSendingRemoteRtpParameters("video",extendedRtpCapabilities)},this._pc=new RTCPeerConnection(Object.assign({iceServers:iceServers||[],iceTransportPolicy:iceTransportPolicy||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},additionalSettings),proprietaryConstraints),this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})}async updateIceServers(iceServers){logger.debug("updateIceServers()");const configuration=this._pc.getConfiguration();configuration.iceServers=iceServers,this._pc.setConfiguration(configuration)}async restartIce(iceParameters){if(logger.debug("restartIce()"),this._remoteSdp.updateIceParameters(iceParameters),this._transportReady)if("send"===this._direction){const offer=await this._pc.createOffer({iceRestart:!0});logger.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",offer),await this._pc.setLocalDescription(offer);const answer={type:"answer",sdp:this._remoteSdp.getSdp()};logger.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",answer),await this._pc.setRemoteDescription(answer)}else{const offer={type:"offer",sdp:this._remoteSdp.getSdp()};logger.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",offer),await this._pc.setRemoteDescription(offer);const answer=await this._pc.createAnswer();logger.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",answer),await this._pc.setLocalDescription(answer)}}async getTransportStats(){return this._pc.getStats()}async send({track:track,encodings:encodings,codecOptions:codecOptions,codec:codec}){this._assertSendDirection(),logger.debug("send() [kind:%s, track.id:%s]",track.kind,track.id),codec&&logger.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(track),this._pc.addTrack(track,this._sendStream);let offer=await this._pc.createOffer(),localSdpObject=sdpTransform.parse(offer.sdp),offerMediaObject;const sendingRtpParameters=utils.clone(this._sendingRtpParametersByKind[track.kind],{});sendingRtpParameters.codecs=ortc.reduceCodecs(sendingRtpParameters.codecs);const sendingRemoteRtpParameters=utils.clone(this._sendingRemoteRtpParametersByKind[track.kind],{});if(sendingRemoteRtpParameters.codecs=ortc.reduceCodecs(sendingRemoteRtpParameters.codecs),this._transportReady||await this._setupTransport({localDtlsRole:"server",localSdpObject:localSdpObject}),"video"===track.kind&&encodings&&encodings.length>1&&(logger.debug("send() | enabling simulcast"),localSdpObject=sdpTransform.parse(offer.sdp),offerMediaObject=localSdpObject.media.find(m=>"video"===m.type),sdpPlanBUtils.addLegacySimulcast({offerMediaObject:offerMediaObject,track:track,numStreams:encodings.length}),offer={type:"offer",sdp:sdpTransform.write(localSdpObject)}),logger.debug("send() | calling pc.setLocalDescription() [offer:%o]",offer),await this._pc.setLocalDescription(offer),localSdpObject=sdpTransform.parse(this._pc.localDescription.sdp),offerMediaObject=localSdpObject.media.find(m=>m.type===track.kind),sendingRtpParameters.rtcp.cname=sdpCommonUtils.getCname({offerMediaObject:offerMediaObject}),sendingRtpParameters.encodings=sdpPlanBUtils.getRtpEncodings({offerMediaObject:offerMediaObject,track:track}),encodings)for(let idx=0;idx<sendingRtpParameters.encodings.length;++idx)encodings[idx]&&Object.assign(sendingRtpParameters.encodings[idx],encodings[idx]);if(sendingRtpParameters.encodings.length>1&&"video/vp8"===sendingRtpParameters.codecs[0].mimeType.toLowerCase())for(const encoding of sendingRtpParameters.encodings)encoding.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:offerMediaObject,offerRtpParameters:sendingRtpParameters,answerRtpParameters:sendingRemoteRtpParameters,codecOptions:codecOptions});const answer={type:"answer",sdp:this._remoteSdp.getSdp()};logger.debug("send() | calling pc.setRemoteDescription() [answer:%o]",answer),await this._pc.setRemoteDescription(answer);const localId=String(this._nextSendLocalId);this._nextSendLocalId++;const rtpSender=this._pc.getSenders().find(s=>s.track===track);return this._mapSendLocalIdRtpSender.set(localId,rtpSender),{localId:localId,rtpParameters:sendingRtpParameters,rtpSender:rtpSender}}async stopSending(localId){this._assertSendDirection();const rtpSender=this._mapSendLocalIdRtpSender.get(localId);if(!rtpSender)throw new Error("associated RTCRtpSender not found");rtpSender.track&&this._sendStream.removeTrack(rtpSender.track),this._mapSendLocalIdRtpSender.delete(localId);const offer=await this._pc.createOffer();logger.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",offer);try{await this._pc.setLocalDescription(offer)}catch(error){if(0===this._sendStream.getTracks().length)return void logger.warn("stopSending() | ignoring expected error due no sending tracks: %s",error.toString());throw error}if("stable"===this._pc.signalingState)return;const answer={type:"answer",sdp:this._remoteSdp.getSdp()};logger.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",answer),await this._pc.setRemoteDescription(answer)}async replaceTrack(localId,track){this._assertSendDirection(),track?logger.debug("replaceTrack() [localId:%s, track.id:%s]",localId,track.id):logger.debug("replaceTrack() [localId:%s, no track]",localId);const rtpSender=this._mapSendLocalIdRtpSender.get(localId);if(!rtpSender)throw new Error("associated RTCRtpSender not found");const oldTrack=rtpSender.track;await rtpSender.replaceTrack(track),oldTrack&&this._sendStream.removeTrack(oldTrack),track&&this._sendStream.addTrack(track)}async setMaxSpatialLayer(localId,spatialLayer){this._assertSendDirection(),logger.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",localId,spatialLayer);const rtpSender=this._mapSendLocalIdRtpSender.get(localId);if(!rtpSender)throw new Error("associated RTCRtpSender not found");const parameters=rtpSender.getParameters();parameters.encodings.forEach((encoding,idx)=>{encoding.active=idx<=spatialLayer}),await rtpSender.setParameters(parameters)}async setRtpEncodingParameters(localId,params){this._assertSendDirection(),logger.debug("setRtpEncodingParameters() [localId:%s, params:%o]",localId,params);const rtpSender=this._mapSendLocalIdRtpSender.get(localId);if(!rtpSender)throw new Error("associated RTCRtpSender not found");const parameters=rtpSender.getParameters();parameters.encodings.forEach((encoding,idx)=>{parameters.encodings[idx]=Object.assign(Object.assign({},encoding),params)}),await rtpSender.setParameters(parameters)}async getSenderStats(localId){this._assertSendDirection();const rtpSender=this._mapSendLocalIdRtpSender.get(localId);if(!rtpSender)throw new Error("associated RTCRtpSender not found");return rtpSender.getStats()}async sendDataChannel({ordered:ordered,maxPacketLifeTime:maxPacketLifeTime,maxRetransmits:maxRetransmits,label:label,protocol:protocol,priority:priority}){this._assertSendDirection();const options={negotiated:!0,id:this._nextSendSctpStreamId,ordered:ordered,maxPacketLifeTime:maxPacketLifeTime,maxRetransmits:maxRetransmits,protocol:protocol,priority:priority};logger.debug("sendDataChannel() [options:%o]",options);const dataChannel=this._pc.createDataChannel(label,options);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%SCTP_NUM_STREAMS.MIS,!this._hasDataChannelMediaSection){const offer=await this._pc.createOffer(),localSdpObject=sdpTransform.parse(offer.sdp),offerMediaObject=localSdpObject.media.find(m=>"application"===m.type);this._transportReady||await this._setupTransport({localDtlsRole:"server",localSdpObject:localSdpObject}),logger.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",offer),await this._pc.setLocalDescription(offer),this._remoteSdp.sendSctpAssociation({offerMediaObject:offerMediaObject});const answer={type:"answer",sdp:this._remoteSdp.getSdp()};logger.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",answer),await this._pc.setRemoteDescription(answer),this._hasDataChannelMediaSection=!0}const sctpStreamParameters={streamId:options.id,ordered:options.ordered,maxPacketLifeTime:options.maxPacketLifeTime,maxRetransmits:options.maxRetransmits};return{dataChannel:dataChannel,sctpStreamParameters:sctpStreamParameters}}async receive({trackId:trackId,kind:kind,rtpParameters:rtpParameters}){this._assertRecvDirection(),logger.debug("receive() [trackId:%s, kind:%s]",trackId,kind);const localId=trackId,mid=kind;this._remoteSdp.receive({mid:mid,kind:kind,offerRtpParameters:rtpParameters,streamId:rtpParameters.rtcp.cname,trackId:trackId});const offer={type:"offer",sdp:this._remoteSdp.getSdp()};logger.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",offer),await this._pc.setRemoteDescription(offer);let answer=await this._pc.createAnswer();const localSdpObject=sdpTransform.parse(answer.sdp),answerMediaObject=localSdpObject.media.find(m=>String(m.mid)===mid);sdpCommonUtils.applyCodecParameters({offerRtpParameters:rtpParameters,answerMediaObject:answerMediaObject}),answer={type:"answer",sdp:sdpTransform.write(localSdpObject)},this._transportReady||await this._setupTransport({localDtlsRole:"client",localSdpObject:localSdpObject}),logger.debug("receive() | calling pc.setLocalDescription() [answer:%o]",answer),await this._pc.setLocalDescription(answer);const rtpReceiver=this._pc.getReceivers().find(r=>r.track&&r.track.id===localId);if(!rtpReceiver)throw new Error("new RTCRtpReceiver not");return this._mapRecvLocalIdInfo.set(localId,{mid:mid,rtpParameters:rtpParameters,rtpReceiver:rtpReceiver}),{localId:localId,track:rtpReceiver.track,rtpReceiver:rtpReceiver}}async stopReceiving(localId){this._assertRecvDirection(),logger.debug("stopReceiving() [localId:%s]",localId);const{mid:mid,rtpParameters:rtpParameters}=this._mapRecvLocalIdInfo.get(localId)||{};this._mapRecvLocalIdInfo.delete(localId),this._remoteSdp.planBStopReceiving({mid:mid,offerRtpParameters:rtpParameters});const offer={type:"offer",sdp:this._remoteSdp.getSdp()};logger.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",offer),await this._pc.setRemoteDescription(offer);const answer=await this._pc.createAnswer();logger.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",answer),await this._pc.setLocalDescription(answer)}async getReceiverStats(localId){this._assertRecvDirection();const{rtpReceiver:rtpReceiver}=this._mapRecvLocalIdInfo.get(localId)||{};if(!rtpReceiver)throw new Error("associated RTCRtpReceiver not found");return rtpReceiver.getStats()}async receiveDataChannel({sctpStreamParameters:sctpStreamParameters,label:label,protocol:protocol}){this._assertRecvDirection();const{streamId:streamId,ordered:ordered,maxPacketLifeTime:maxPacketLifeTime,maxRetransmits:maxRetransmits}=sctpStreamParameters,options={negotiated:!0,id:streamId,ordered:ordered,maxPacketLifeTime:maxPacketLifeTime,maxRetransmits:maxRetransmits,protocol:protocol};logger.debug("receiveDataChannel() [options:%o]",options);const dataChannel=this._pc.createDataChannel(label,options);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const offer={type:"offer",sdp:this._remoteSdp.getSdp()};logger.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",offer),await this._pc.setRemoteDescription(offer);const answer=await this._pc.createAnswer();if(!this._transportReady){const localSdpObject=sdpTransform.parse(answer.sdp);await this._setupTransport({localDtlsRole:"client",localSdpObject:localSdpObject})}logger.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",answer),await this._pc.setLocalDescription(answer),this._hasDataChannelMediaSection=!0}return{dataChannel:dataChannel}}async _setupTransport({localDtlsRole:localDtlsRole,localSdpObject:localSdpObject}){localSdpObject||(localSdpObject=sdpTransform.parse(this._pc.localDescription.sdp));const dtlsParameters=sdpCommonUtils.extractDtlsParameters({sdpObject:localSdpObject});dtlsParameters.role=localDtlsRole,this._remoteSdp.updateDtlsRole("client"===localDtlsRole?"server":"client"),await this.safeEmitAsPromise("@connect",{dtlsParameters:dtlsParameters}),this._transportReady=!0}_assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}_assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}exports.Safari11=Safari11},{"../Logger":391,"../ortc":414,"../utils":417,"./HandlerInterface":403,"./sdp/RemoteSdp":409,"./sdp/commonUtils":410,"./sdp/planBUtils":411,"sdp-transform":509}],406:[function(require,module,exports){"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){void 0===k2&&(k2=k),Object.defineProperty(o,k2,{enumerable:!0,get:function(){return m[k]}})}:function(o,m,k,k2){void 0===k2&&(k2=k),o[k2]=m[k]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:!0,value:v})}:function(o,v){o.default=v}),__importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)"default"!==k&&Object.hasOwnProperty.call(mod,k)&&__createBinding(result,mod,k);return __setModuleDefault(result,mod),result};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Safari12=void 0;const sdpTransform=__importStar(require("sdp-transform")),Logger_1=require("../Logger"),utils=__importStar(require("../utils")),ortc=__importStar(require("../ortc")),sdpCommonUtils=__importStar(require("./sdp/commonUtils")),sdpUnifiedPlanUtils=__importStar(require("./sdp/unifiedPlanUtils")),HandlerInterface_1=require("./HandlerInterface"),RemoteSdp_1=require("./sdp/RemoteSdp"),logger=new Logger_1.Logger("Safari12"),SCTP_NUM_STREAMS={OS:1024,MIS:1024};class Safari12 extends HandlerInterface_1.HandlerInterface{constructor(){super(),this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}static createFactory(){return()=>new Safari12}get name(){return"Safari12"}close(){if(logger.debug("close()"),this._pc)try{this._pc.close()}catch(error){}}async getNativeRtpCapabilities(){logger.debug("getNativeRtpCapabilities()");const pc=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});try{pc.addTransceiver("audio"),pc.addTransceiver("video");const offer=await pc.createOffer();try{pc.close()}catch(error){}const sdpObject=sdpTransform.parse(offer.sdp),nativeRtpCapabilities=sdpCommonUtils.extractRtpCapabilities({sdpObject:sdpObject});return nativeRtpCapabilities}catch(error){try{pc.close()}catch(error2){}throw error}}async getNativeSctpCapabilities(){return logger.debug("getNativeSctpCapabilities()"),{numStreams:SCTP_NUM_STREAMS}}run({direction:direction,iceParameters:iceParameters,iceCandidates:iceCandidates,dtlsParameters:dtlsParameters,sctpParameters:sctpParameters,iceServers:iceServers,iceTransportPolicy:iceTransportPolicy,additionalSettings:additionalSettings,proprietaryConstraints:proprietaryConstraints,extendedRtpCapabilities:extendedRtpCapabilities}){logger.debug("run()"),this._direction=direction,this._remoteSdp=new RemoteSdp_1.RemoteSdp({iceParameters:iceParameters,iceCandidates:iceCandidates,dtlsParameters:dtlsParameters,sctpParameters:sctpParameters}),this._sendingRtpParametersByKind={audio:ortc.getSendingRtpParameters("audio",extendedRtpCapabilities),video:ortc.getSendingRtpParameters("video",extendedRtpCapabilities)},this._sendingRemoteRtpParametersByKind={audio:ortc.getSendingRemoteRtpParameters("audio",extendedRtpCapabilities),video:ortc.getSendingRemoteRtpParameters("video",extendedRtpCapabilities)},this._pc=new RTCPeerConnection(Object.assign({iceServers:iceServers||[],iceTransportPolicy:iceTransportPolicy||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},additionalSettings),proprietaryConstraints),this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})}async updateIceServers(iceServers){logger.debug("updateIceServers()");const configuration=this._pc.getConfiguration();configuration.iceServers=iceServers,this._pc.setConfiguration(configuration)}async restartIce(iceParameters){if(logger.debug("restartIce()"),this._remoteSdp.updateIceParameters(iceParameters),this._transportReady)if("send"===this._direction){const offer=await this._pc.createOffer({iceRestart:!0});logger.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",offer),await this._pc.setLocalDescription(offer);const answer={type:"answer",sdp:this._remoteSdp.getSdp()};logger.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",answer),await this._pc.setRemoteDescription(answer)}else{const offer={type:"offer",sdp:this._remoteSdp.getSdp()};logger.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",offer),await this._pc.setRemoteDescription(offer);const answer=await this._pc.createAnswer();logger.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",answer),await this._pc.setLocalDescription(answer)}}async getTransportStats(){return this._pc.getStats()}async send({track:track,encodings:encodings,codecOptions:codecOptions,codec:codec}){this._assertSendDirection(),logger.debug("send() [kind:%s, track.id:%s]",track.kind,track.id);const sendingRtpParameters=utils.clone(this._sendingRtpParametersByKind[track.kind],{});sendingRtpParameters.codecs=ortc.reduceCodecs(sendingRtpParameters.codecs,codec);const sendingRemoteRtpParameters=utils.clone(this._sendingRemoteRtpParametersByKind[track.kind],{});sendingRemoteRtpParameters.codecs=ortc.reduceCodecs(sendingRemoteRtpParameters.codecs,codec);const mediaSectionIdx=this._remoteSdp.getNextMediaSectionIdx(),transceiver=this._pc.addTransceiver(track,{direction:"sendonly",streams:[this._sendStream]});let offer=await this._pc.createOffer(),localSdpObject=sdpTransform.parse(offer.sdp),offerMediaObject;this._transportReady||await this._setupTransport({localDtlsRole:"server",localSdpObject:localSdpObject}),encodings&&encodings.length>1&&(logger.debug("send() | enabling legacy simulcast"),localSdpObject=sdpTransform.parse(offer.sdp),offerMediaObject=localSdpObject.media[mediaSectionIdx.idx],sdpUnifiedPlanUtils.addLegacySimulcast({offerMediaObject:offerMediaObject,numStreams:encodings.length}),offer={type:"offer",sdp:sdpTransform.write(localSdpObject)}),logger.debug("send() | calling pc.setLocalDescription() [offer:%o]",offer),await this._pc.setLocalDescription(offer);const localId=transceiver.mid;if(sendingRtpParameters.mid=localId,localSdpObject=sdpTransform.parse(this._pc.localDescription.sdp),offerMediaObject=localSdpObject.media[mediaSectionIdx.idx],sendingRtpParameters.rtcp.cname=sdpCommonUtils.getCname({offerMediaObject:offerMediaObject}),sendingRtpParameters.encodings=sdpUnifiedPlanUtils.getRtpEncodings({offerMediaObject:offerMediaObject}),encodings)for(let idx=0;idx<sendingRtpParameters.encodings.length;++idx)encodings[idx]&&Object.assign(sendingRtpParameters.encodings[idx],encodings[idx]);if(sendingRtpParameters.encodings.length>1&&("video/vp8"===sendingRtpParameters.codecs[0].mimeType.toLowerCase()||"video/h264"===sendingRtpParameters.codecs[0].mimeType.toLowerCase()))for(const encoding of sendingRtpParameters.encodings)encoding.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:offerMediaObject,reuseMid:mediaSectionIdx.reuseMid,offerRtpParameters:sendingRtpParameters,answerRtpParameters:sendingRemoteRtpParameters,codecOptions:codecOptions});const answer={type:"answer",sdp:this._remoteSdp.getSdp()};return logger.debug("send() | calling pc.setRemoteDescription() [answer:%o]",answer),await this._pc.setRemoteDescription(answer),this._mapMidTransceiver.set(localId,transceiver),{localId:localId,rtpParameters:sendingRtpParameters,rtpSender:transceiver.sender}}async stopSending(localId){this._assertSendDirection(),logger.debug("stopSending() [localId:%s]",localId);const transceiver=this._mapMidTransceiver.get(localId);if(!transceiver)throw new Error("associated RTCRtpTransceiver not found");transceiver.sender.replaceTrack(null),this._pc.removeTrack(transceiver.sender),this._remoteSdp.closeMediaSection(transceiver.mid);const offer=await this._pc.createOffer();logger.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",offer),await this._pc.setLocalDescription(offer);const answer={type:"answer",sdp:this._remoteSdp.getSdp()};logger.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",answer),await this._pc.setRemoteDescription(answer)}async replaceTrack(localId,track){this._assertSendDirection(),track?logger.debug("replaceTrack() [localId:%s, track.id:%s]",localId,track.id):logger.debug("replaceTrack() [localId:%s, no track]",localId);const transceiver=this._mapMidTransceiver.get(localId);if(!transceiver)throw new Error("associated RTCRtpTransceiver not found");await transceiver.sender.replaceTrack(track)}async setMaxSpatialLayer(localId,spatialLayer){this._assertSendDirection(),logger.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",localId,spatialLayer);const transceiver=this._mapMidTransceiver.get(localId);if(!transceiver)throw new Error("associated RTCRtpTransceiver not found");const parameters=transceiver.sender.getParameters();parameters.encodings.forEach((encoding,idx)=>{encoding.active=idx<=spatialLayer}),await transceiver.sender.setParameters(parameters)}async setRtpEncodingParameters(localId,params){this._assertSendDirection(),logger.debug("setRtpEncodingParameters() [localId:%s, params:%o]",localId,params);const transceiver=this._mapMidTransceiver.get(localId);if(!transceiver)throw new Error("associated RTCRtpTransceiver not found");const parameters=transceiver.sender.getParameters();parameters.encodings.forEach((encoding,idx)=>{parameters.encodings[idx]=Object.assign(Object.assign({},encoding),params)}),await transceiver.sender.setParameters(parameters)}async getSenderStats(localId){this._assertSendDirection();const transceiver=this._mapMidTransceiver.get(localId);if(!transceiver)throw new Error("associated RTCRtpTransceiver not found");return transceiver.sender.getStats()}async sendDataChannel({ordered:ordered,maxPacketLifeTime:maxPacketLifeTime,maxRetransmits:maxRetransmits,label:label,protocol:protocol,priority:priority}){this._assertSendDirection();const options={negotiated:!0,id:this._nextSendSctpStreamId,ordered:ordered,maxPacketLifeTime:maxPacketLifeTime,maxRetransmits:maxRetransmits,protocol:protocol,priority:priority};logger.debug("sendDataChannel() [options:%o]",options);const dataChannel=this._pc.createDataChannel(label,options);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%SCTP_NUM_STREAMS.MIS,!this._hasDataChannelMediaSection){const offer=await this._pc.createOffer(),localSdpObject=sdpTransform.parse(offer.sdp),offerMediaObject=localSdpObject.media.find(m=>"application"===m.type);this._transportReady||await this._setupTransport({localDtlsRole:"server",localSdpObject:localSdpObject}),logger.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",offer),await this._pc.setLocalDescription(offer),this._remoteSdp.sendSctpAssociation({offerMediaObject:offerMediaObject});const answer={type:"answer",sdp:this._remoteSdp.getSdp()};logger.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",answer),await this._pc.setRemoteDescription(answer),this._hasDataChannelMediaSection=!0}const sctpStreamParameters={streamId:options.id,ordered:options.ordered,maxPacketLifeTime:options.maxPacketLifeTime,maxRetransmits:options.maxRetransmits};return{dataChannel:dataChannel,sctpStreamParameters:sctpStreamParameters}}async receive({trackId:trackId,kind:kind,rtpParameters:rtpParameters}){this._assertRecvDirection(),logger.debug("receive() [trackId:%s, kind:%s]",trackId,kind);const localId=rtpParameters.mid||String(this._mapMidTransceiver.size);this._remoteSdp.receive({mid:localId,kind:kind,offerRtpParameters:rtpParameters,streamId:rtpParameters.rtcp.cname,trackId:trackId});const offer={type:"offer",sdp:this._remoteSdp.getSdp()};logger.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",offer),await this._pc.setRemoteDescription(offer);let answer=await this._pc.createAnswer();const localSdpObject=sdpTransform.parse(answer.sdp),answerMediaObject=localSdpObject.media.find(m=>String(m.mid)===localId);sdpCommonUtils.applyCodecParameters({offerRtpParameters:rtpParameters,answerMediaObject:answerMediaObject}),answer={type:"answer",sdp:sdpTransform.write(localSdpObject)},this._transportReady||await this._setupTransport({localDtlsRole:"client",localSdpObject:localSdpObject}),logger.debug("receive() | calling pc.setLocalDescription() [answer:%o]",answer),await this._pc.setLocalDescription(answer);const transceiver=this._pc.getTransceivers().find(t=>t.mid===localId);if(!transceiver)throw new Error("new RTCRtpTransceiver not found");return this._mapMidTransceiver.set(localId,transceiver),{localId:localId,track:transceiver.receiver.track,rtpReceiver:transceiver.receiver}}async stopReceiving(localId){this._assertRecvDirection(),logger.debug("stopReceiving() [localId:%s]",localId);const transceiver=this._mapMidTransceiver.get(localId);if(!transceiver)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(transceiver.mid);const offer={type:"offer",sdp:this._remoteSdp.getSdp()};logger.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",offer),await this._pc.setRemoteDescription(offer);const answer=await this._pc.createAnswer();logger.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",answer),await this._pc.setLocalDescription(answer)}async getReceiverStats(localId){this._assertRecvDirection();const transceiver=this._mapMidTransceiver.get(localId);if(!transceiver)throw new Error("associated RTCRtpTransceiver not found");return transceiver.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:sctpStreamParameters,label:label,protocol:protocol}){this._assertRecvDirection();const{streamId:streamId,ordered:ordered,maxPacketLifeTime:maxPacketLifeTime,maxRetransmits:maxRetransmits}=sctpStreamParameters,options={negotiated:!0,id:streamId,ordered:ordered,maxPacketLifeTime:maxPacketLifeTime,maxRetransmits:maxRetransmits,protocol:protocol};logger.debug("receiveDataChannel() [options:%o]",options);const dataChannel=this._pc.createDataChannel(label,options);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const offer={type:"offer",sdp:this._remoteSdp.getSdp()};logger.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",offer),await this._pc.setRemoteDescription(offer);const answer=await this._pc.createAnswer();if(!this._transportReady){const localSdpObject=sdpTransform.parse(answer.sdp);await this._setupTransport({localDtlsRole:"client",localSdpObject:localSdpObject})}logger.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",answer),await this._pc.setLocalDescription(answer),this._hasDataChannelMediaSection=!0}return{dataChannel:dataChannel}}async _setupTransport({localDtlsRole:localDtlsRole,localSdpObject:localSdpObject}){localSdpObject||(localSdpObject=sdpTransform.parse(this._pc.localDescription.sdp));const dtlsParameters=sdpCommonUtils.extractDtlsParameters({sdpObject:localSdpObject});dtlsParameters.role=localDtlsRole,this._remoteSdp.updateDtlsRole("client"===localDtlsRole?"server":"client"),await this.safeEmitAsPromise("@connect",{dtlsParameters:dtlsParameters}),this._transportReady=!0}_assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}_assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}exports.Safari12=Safari12},{"../Logger":391,"../ortc":414,"../utils":417,"./HandlerInterface":403,"./sdp/RemoteSdp":409,"./sdp/commonUtils":410,"./sdp/unifiedPlanUtils":412,"sdp-transform":509}],407:[function(require,module,exports){"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){void 0===k2&&(k2=k),Object.defineProperty(o,k2,{enumerable:!0,get:function(){return m[k]}})}:function(o,m,k,k2){void 0===k2&&(k2=k),o[k2]=m[k]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:!0,value:v})}:function(o,v){o.default=v}),__importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)"default"!==k&&Object.hasOwnProperty.call(mod,k)&&__createBinding(result,mod,k);return __setModuleDefault(result,mod),result};Object.defineProperty(exports,"__esModule",{value:!0}),exports.mangleRtpParameters=exports.getCapabilities=void 0;const utils=__importStar(require("../../utils"));function getCapabilities(){const nativeCaps=RTCRtpReceiver.getCapabilities(),caps=utils.clone(nativeCaps,{});for(const codec of caps.codecs){if(codec.channels=codec.numChannels,delete codec.numChannels,codec.mimeType=codec.mimeType||`${codec.kind}/${codec.name}`,codec.parameters){const parameters=codec.parameters;parameters.apt&&(parameters.apt=Number(parameters.apt)),parameters["packetization-mode"]&&(parameters["packetization-mode"]=Number(parameters["packetization-mode"]))}for(const feedback of codec.rtcpFeedback||[])feedback.parameter||(feedback.parameter="")}return caps}function mangleRtpParameters(rtpParameters){const params=utils.clone(rtpParameters,{});params.mid&&(params.muxId=params.mid,delete params.mid);for(const codec of params.codecs)codec.channels&&(codec.numChannels=codec.channels,delete codec.channels),codec.mimeType&&!codec.name&&(codec.name=codec.mimeType.split("/")[1]),delete codec.mimeType;return params}exports.getCapabilities=getCapabilities,exports.mangleRtpParameters=mangleRtpParameters},{"../../utils":417}],408:[function(require,module,exports){"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){void 0===k2&&(k2=k),Object.defineProperty(o,k2,{enumerable:!0,get:function(){return m[k]}})}:function(o,m,k,k2){void 0===k2&&(k2=k),o[k2]=m[k]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:!0,value:v})}:function(o,v){o.default=v}),__importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)"default"!==k&&Object.hasOwnProperty.call(mod,k)&&__createBinding(result,mod,k);return __setModuleDefault(result,mod),result};Object.defineProperty(exports,"__esModule",{value:!0}),exports.OfferMediaSection=exports.AnswerMediaSection=exports.MediaSection=void 0;const utils=__importStar(require("../../utils"));class MediaSection{constructor({iceParameters:iceParameters,iceCandidates:iceCandidates,dtlsParameters:dtlsParameters,planB:planB=!1}){if(this._mediaObject={},this._planB=planB,iceParameters&&this.setIceParameters(iceParameters),iceCandidates){this._mediaObject.candidates=[];for(const candidate of iceCandidates){const candidateObject={component:1};candidateObject.foundation=candidate.foundation,candidateObject.ip=candidate.ip,candidateObject.port=candidate.port,candidateObject.priority=candidate.priority,candidateObject.transport=candidate.protocol,candidateObject.type=candidate.type,candidate.tcpType&&(candidateObject.tcptype=candidate.tcpType),this._mediaObject.candidates.push(candidateObject)}this._mediaObject.endOfCandidates="end-of-candidates",this._mediaObject.iceOptions="renomination"}dtlsParameters&&this.setDtlsRole(dtlsParameters.role)}get mid(){return String(this._mediaObject.mid)}get closed(){return 0===this._mediaObject.port}getObject(){return this._mediaObject}setIceParameters(iceParameters){this._mediaObject.iceUfrag=iceParameters.usernameFragment,this._mediaObject.icePwd=iceParameters.password}disable(){this._mediaObject.direction="inactive",delete this._mediaObject.ext,delete this._mediaObject.ssrcs,delete this._mediaObject.ssrcGroups,delete this._mediaObject.simulcast,delete this._mediaObject.simulcast_03,delete this._mediaObject.rids}close(){this._mediaObject.direction="inactive",this._mediaObject.port=0,delete this._mediaObject.ext,delete this._mediaObject.ssrcs,delete this._mediaObject.ssrcGroups,delete this._mediaObject.simulcast,delete this._mediaObject.simulcast_03,delete this._mediaObject.rids,delete this._mediaObject.extmapAllowMixed}}exports.MediaSection=MediaSection;class AnswerMediaSection extends MediaSection{constructor({iceParameters:iceParameters,iceCandidates:iceCandidates,dtlsParameters:dtlsParameters,sctpParameters:sctpParameters,plainRtpParameters:plainRtpParameters,planB:planB=!1,offerMediaObject:offerMediaObject,offerRtpParameters:offerRtpParameters,answerRtpParameters:answerRtpParameters,codecOptions:codecOptions,extmapAllowMixed:extmapAllowMixed=!1}){switch(super({iceParameters:iceParameters,iceCandidates:iceCandidates,dtlsParameters:dtlsParameters,planB:planB}),this._mediaObject.mid=String(offerMediaObject.mid),this._mediaObject.type=offerMediaObject.type,this._mediaObject.protocol=offerMediaObject.protocol,plainRtpParameters?(this._mediaObject.connection={ip:plainRtpParameters.ip,version:plainRtpParameters.ipVersion},this._mediaObject.port=plainRtpParameters.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},this._mediaObject.port=7),offerMediaObject.type){case"audio":case"video":this._mediaObject.direction="recvonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[];for(const codec of answerRtpParameters.codecs){const rtp={payload:codec.payloadType,codec:getCodecName(codec),rate:codec.clockRate};codec.channels>1&&(rtp.encoding=codec.channels),this._mediaObject.rtp.push(rtp);const codecParameters=utils.clone(codec.parameters,{});if(codecOptions){const{opusStereo:opusStereo,opusFec:opusFec,opusDtx:opusDtx,opusMaxPlaybackRate:opusMaxPlaybackRate,opusMaxAverageBitrate:opusMaxAverageBitrate,opusPtime:opusPtime,videoGoogleStartBitrate:videoGoogleStartBitrate,videoGoogleMaxBitrate:videoGoogleMaxBitrate,videoGoogleMinBitrate:videoGoogleMinBitrate}=codecOptions,offerCodec=offerRtpParameters.codecs.find(c=>c.payloadType===codec.payloadType);switch(codec.mimeType.toLowerCase()){case"audio/opus":void 0!==opusStereo&&(offerCodec.parameters["sprop-stereo"]=opusStereo?1:0,codecParameters.stereo=opusStereo?1:0),void 0!==opusFec&&(offerCodec.parameters.useinbandfec=opusFec?1:0,codecParameters.useinbandfec=opusFec?1:0),void 0!==opusDtx&&(offerCodec.parameters.usedtx=opusDtx?1:0,codecParameters.usedtx=opusDtx?1:0),void 0!==opusMaxPlaybackRate&&(codecParameters.maxplaybackrate=opusMaxPlaybackRate),void 0!==opusMaxAverageBitrate&&(codecParameters.maxaveragebitrate=opusMaxAverageBitrate),void 0!==opusPtime&&(offerCodec.parameters.ptime=opusPtime,codecParameters.ptime=opusPtime);break;case"video/vp8":case"video/vp9":case"video/h264":case"video/h265":void 0!==videoGoogleStartBitrate&&(codecParameters["x-google-start-bitrate"]=videoGoogleStartBitrate),void 0!==videoGoogleMaxBitrate&&(codecParameters["x-google-max-bitrate"]=videoGoogleMaxBitrate),void 0!==videoGoogleMinBitrate&&(codecParameters["x-google-min-bitrate"]=videoGoogleMinBitrate)}}const fmtp={payload:codec.payloadType,config:""};for(const key of Object.keys(codecParameters))fmtp.config&&(fmtp.config+=";"),fmtp.config+=`${key}=${codecParameters[key]}`;fmtp.config&&this._mediaObject.fmtp.push(fmtp);for(const fb of codec.rtcpFeedback)this._mediaObject.rtcpFb.push({payload:codec.payloadType,type:fb.type,subtype:fb.parameter})}this._mediaObject.payloads=answerRtpParameters.codecs.map(codec=>codec.payloadType).join(" "),this._mediaObject.ext=[];for(const ext of answerRtpParameters.headerExtensions){const found=(offerMediaObject.ext||[]).some(localExt=>localExt.uri===ext.uri);found&&this._mediaObject.ext.push({uri:ext.uri,value:ext.id})}if(extmapAllowMixed&&"extmap-allow-mixed"===offerMediaObject.extmapAllowMixed&&(this._mediaObject.extmapAllowMixed="extmap-allow-mixed"),offerMediaObject.simulcast){this._mediaObject.simulcast={dir1:"recv",list1:offerMediaObject.simulcast.list1},this._mediaObject.rids=[];for(const rid of offerMediaObject.rids||[])"send"===rid.direction&&this._mediaObject.rids.push({id:rid.id,direction:"recv"})}else if(offerMediaObject.simulcast_03){this._mediaObject.simulcast_03={value:offerMediaObject.simulcast_03.value.replace(/send/g,"recv")},this._mediaObject.rids=[];for(const rid of offerMediaObject.rids||[])"send"===rid.direction&&this._mediaObject.rids.push({id:rid.id,direction:"recv"})}this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize",this._planB&&"video"===this._mediaObject.type&&(this._mediaObject.xGoogleFlag="conference");break;case"application":"number"==typeof offerMediaObject.sctpPort?(this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=sctpParameters.port,this._mediaObject.maxMessageSize=sctpParameters.maxMessageSize):offerMediaObject.sctpmap&&(this._mediaObject.payloads=sctpParameters.port,this._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:sctpParameters.port,maxMessageSize:sctpParameters.maxMessageSize})}}setDtlsRole(role){switch(role){case"client":this._mediaObject.setup="active";break;case"server":this._mediaObject.setup="passive";break;case"auto":this._mediaObject.setup="actpass"}}}exports.AnswerMediaSection=AnswerMediaSection;class OfferMediaSection extends MediaSection{constructor({iceParameters:iceParameters,iceCandidates:iceCandidates,dtlsParameters:dtlsParameters,sctpParameters:sctpParameters,plainRtpParameters:plainRtpParameters,planB:planB=!1,mid:mid,kind:kind,offerRtpParameters:offerRtpParameters,streamId:streamId,trackId:trackId,oldDataChannelSpec:oldDataChannelSpec=!1}){switch(super({iceParameters:iceParameters,iceCandidates:iceCandidates,dtlsParameters:dtlsParameters,planB:planB}),this._mediaObject.mid=String(mid),this._mediaObject.type=kind,plainRtpParameters?(this._mediaObject.connection={ip:plainRtpParameters.ip,version:plainRtpParameters.ipVersion},this._mediaObject.protocol="RTP/AVP",this._mediaObject.port=plainRtpParameters.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},this._mediaObject.protocol=sctpParameters?"UDP/DTLS/SCTP":"UDP/TLS/RTP/SAVPF",this._mediaObject.port=7),kind){case"audio":case"video":{this._mediaObject.direction="sendonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[],this._planB||(this._mediaObject.msid=`${streamId||"-"} ${trackId}`);for(const codec of offerRtpParameters.codecs){const rtp={payload:codec.payloadType,codec:getCodecName(codec),rate:codec.clockRate};codec.channels>1&&(rtp.encoding=codec.channels),this._mediaObject.rtp.push(rtp);const fmtp={payload:codec.payloadType,config:""};for(const key of Object.keys(codec.parameters))fmtp.config&&(fmtp.config+=";"),fmtp.config+=`${key}=${codec.parameters[key]}`;fmtp.config&&this._mediaObject.fmtp.push(fmtp);for(const fb of codec.rtcpFeedback)this._mediaObject.rtcpFb.push({payload:codec.payloadType,type:fb.type,subtype:fb.parameter})}this._mediaObject.payloads=offerRtpParameters.codecs.map(codec=>codec.payloadType).join(" "),this._mediaObject.ext=[];for(const ext of offerRtpParameters.headerExtensions)this._mediaObject.ext.push({uri:ext.uri,value:ext.id});this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize";const encoding=offerRtpParameters.encodings[0],ssrc=encoding.ssrc,rtxSsrc=encoding.rtx&&encoding.rtx.ssrc?encoding.rtx.ssrc:void 0;this._mediaObject.ssrcs=[],this._mediaObject.ssrcGroups=[],offerRtpParameters.rtcp.cname&&this._mediaObject.ssrcs.push({id:ssrc,attribute:"cname",value:offerRtpParameters.rtcp.cname}),this._planB&&this._mediaObject.ssrcs.push({id:ssrc,attribute:"msid",value:`${streamId||"-"} ${trackId}`}),rtxSsrc&&(offerRtpParameters.rtcp.cname&&this._mediaObject.ssrcs.push({id:rtxSsrc,attribute:"cname",value:offerRtpParameters.rtcp.cname}),this._planB&&this._mediaObject.ssrcs.push({id:rtxSsrc,attribute:"msid",value:`${streamId||"-"} ${trackId}`}),this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:`${ssrc} ${rtxSsrc}`}));break}case"application":oldDataChannelSpec?(this._mediaObject.payloads=sctpParameters.port,this._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:sctpParameters.port,maxMessageSize:sctpParameters.maxMessageSize}):(this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=sctpParameters.port,this._mediaObject.maxMessageSize=sctpParameters.maxMessageSize)}}setDtlsRole(role){this._mediaObject.setup="actpass"}planBReceive({offerRtpParameters:offerRtpParameters,streamId:streamId,trackId:trackId}){const encoding=offerRtpParameters.encodings[0],ssrc=encoding.ssrc,rtxSsrc=encoding.rtx&&encoding.rtx.ssrc?encoding.rtx.ssrc:void 0;offerRtpParameters.rtcp.cname&&this._mediaObject.ssrcs.push({id:ssrc,attribute:"cname",value:offerRtpParameters.rtcp.cname}),this._mediaObject.ssrcs.push({id:ssrc,attribute:"msid",value:`${streamId||"-"} ${trackId}`}),rtxSsrc&&(offerRtpParameters.rtcp.cname&&this._mediaObject.ssrcs.push({id:rtxSsrc,attribute:"cname",value:offerRtpParameters.rtcp.cname}),this._mediaObject.ssrcs.push({id:rtxSsrc,attribute:"msid",value:`${streamId||"-"} ${trackId}`}),this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:`${ssrc} ${rtxSsrc}`}))}planBStopReceiving({offerRtpParameters:offerRtpParameters}){const encoding=offerRtpParameters.encodings[0],ssrc=encoding.ssrc,rtxSsrc=encoding.rtx&&encoding.rtx.ssrc?encoding.rtx.ssrc:void 0;this._mediaObject.ssrcs=this._mediaObject.ssrcs.filter(s=>s.id!==ssrc&&s.id!==rtxSsrc),rtxSsrc&&(this._mediaObject.ssrcGroups=this._mediaObject.ssrcGroups.filter(group=>group.ssrcs!==`${ssrc} ${rtxSsrc}`))}}function getCodecName(codec){const MimeTypeRegex=new RegExp("^(audio|video)/(.+)","i"),mimeTypeMatch=MimeTypeRegex.exec(codec.mimeType);if(!mimeTypeMatch)throw new TypeError("invalid codec.mimeType");return mimeTypeMatch[2]}exports.OfferMediaSection=OfferMediaSection},{"../../utils":417}],409:[function(require,module,exports){"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){void 0===k2&&(k2=k),Object.defineProperty(o,k2,{enumerable:!0,get:function(){return m[k]}})}:function(o,m,k,k2){void 0===k2&&(k2=k),o[k2]=m[k]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:!0,value:v})}:function(o,v){o.default=v}),__importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)"default"!==k&&Object.hasOwnProperty.call(mod,k)&&__createBinding(result,mod,k);return __setModuleDefault(result,mod),result};Object.defineProperty(exports,"__esModule",{value:!0}),exports.RemoteSdp=void 0;const sdpTransform=__importStar(require("sdp-transform")),Logger_1=require("../../Logger"),MediaSection_1=require("./MediaSection"),logger=new Logger_1.Logger("RemoteSdp");class RemoteSdp{constructor({iceParameters:iceParameters,iceCandidates:iceCandidates,dtlsParameters:dtlsParameters,sctpParameters:sctpParameters,plainRtpParameters:plainRtpParameters,planB:planB=!1}){if(this._mediaSections=[],this._midToIndex=new Map,this._iceParameters=iceParameters,this._iceCandidates=iceCandidates,this._dtlsParameters=dtlsParameters,this._sctpParameters=sctpParameters,this._plainRtpParameters=plainRtpParameters,this._planB=planB,this._sdpObject={version:0,origin:{address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:1e4,sessionVersion:0,username:"mediasoup-client"},name:"-",timing:{start:0,stop:0},media:[]},iceParameters&&iceParameters.iceLite&&(this._sdpObject.icelite="ice-lite"),dtlsParameters){this._sdpObject.msidSemantic={semantic:"WMS",token:"*"};const numFingerprints=this._dtlsParameters.fingerprints.length;this._sdpObject.fingerprint={type:dtlsParameters.fingerprints[numFingerprints-1].algorithm,hash:dtlsParameters.fingerprints[numFingerprints-1].value},this._sdpObject.groups=[{type:"BUNDLE",mids:""}]}plainRtpParameters&&(this._sdpObject.origin.address=plainRtpParameters.ip,this._sdpObject.origin.ipVer=plainRtpParameters.ipVersion)}updateIceParameters(iceParameters){logger.debug("updateIceParameters() [iceParameters:%o]",iceParameters),this._iceParameters=iceParameters,this._sdpObject.icelite=iceParameters.iceLite?"ice-lite":void 0;for(const mediaSection of this._mediaSections)mediaSection.setIceParameters(iceParameters)}updateDtlsRole(role){logger.debug("updateDtlsRole() [role:%s]",role),this._dtlsParameters.role=role;for(const mediaSection of this._mediaSections)mediaSection.setDtlsRole(role)}getNextMediaSectionIdx(){for(let idx=0;idx<this._mediaSections.length;++idx){const mediaSection=this._mediaSections[idx];if(mediaSection.closed)return{idx:idx,reuseMid:mediaSection.mid}}return{idx:this._mediaSections.length}}send({offerMediaObject:offerMediaObject,reuseMid:reuseMid,offerRtpParameters:offerRtpParameters,answerRtpParameters:answerRtpParameters,codecOptions:codecOptions,extmapAllowMixed:extmapAllowMixed=!1}){const mediaSection=new MediaSection_1.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,offerMediaObject:offerMediaObject,offerRtpParameters:offerRtpParameters,answerRtpParameters:answerRtpParameters,codecOptions:codecOptions,extmapAllowMixed:extmapAllowMixed});reuseMid?this._replaceMediaSection(mediaSection,reuseMid):this._midToIndex.has(mediaSection.mid)?this._replaceMediaSection(mediaSection):this._addMediaSection(mediaSection)}receive({mid:mid,kind:kind,offerRtpParameters:offerRtpParameters,streamId:streamId,trackId:trackId}){const idx=this._midToIndex.get(mid);let mediaSection;if(void 0!==idx&&(mediaSection=this._mediaSections[idx]),mediaSection)mediaSection.planBReceive({offerRtpParameters:offerRtpParameters,streamId:streamId,trackId:trackId}),this._replaceMediaSection(mediaSection);else{mediaSection=new MediaSection_1.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,mid:mid,kind:kind,offerRtpParameters:offerRtpParameters,streamId:streamId,trackId:trackId});const oldMediaSection=this._mediaSections.find(m=>m.closed);oldMediaSection?this._replaceMediaSection(mediaSection,oldMediaSection.mid):this._addMediaSection(mediaSection)}}disableMediaSection(mid){const idx=this._midToIndex.get(mid);if(void 0===idx)throw new Error(`no media section found with mid '${mid}'`);const mediaSection=this._mediaSections[idx];mediaSection.disable()}closeMediaSection(mid){const idx=this._midToIndex.get(mid);if(void 0===idx)throw new Error(`no media section found with mid '${mid}'`);const mediaSection=this._mediaSections[idx];if(mid===this._firstMid)return logger.debug("closeMediaSection() | cannot close first media section, disabling it instead [mid:%s]",mid),void this.disableMediaSection(mid);mediaSection.close(),this._regenerateBundleMids()}planBStopReceiving({mid:mid,offerRtpParameters:offerRtpParameters}){const idx=this._midToIndex.get(mid);if(void 0===idx)throw new Error(`no media section found with mid '${mid}'`);const mediaSection=this._mediaSections[idx];mediaSection.planBStopReceiving({offerRtpParameters:offerRtpParameters}),this._replaceMediaSection(mediaSection)}sendSctpAssociation({offerMediaObject:offerMediaObject}){const mediaSection=new MediaSection_1.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,offerMediaObject:offerMediaObject});this._addMediaSection(mediaSection)}receiveSctpAssociation({oldDataChannelSpec:oldDataChannelSpec=!1}={}){const mediaSection=new MediaSection_1.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,mid:"datachannel",kind:"application",oldDataChannelSpec:oldDataChannelSpec});this._addMediaSection(mediaSection)}getSdp(){return this._sdpObject.origin.sessionVersion++,sdpTransform.write(this._sdpObject)}_addMediaSection(newMediaSection){this._firstMid||(this._firstMid=newMediaSection.mid),this._mediaSections.push(newMediaSection),this._midToIndex.set(newMediaSection.mid,this._mediaSections.length-1),this._sdpObject.media.push(newMediaSection.getObject()),this._regenerateBundleMids()}_replaceMediaSection(newMediaSection,reuseMid){if("string"==typeof reuseMid){const idx=this._midToIndex.get(reuseMid);if(void 0===idx)throw new Error(`no media section found for reuseMid '${reuseMid}'`);const oldMediaSection=this._mediaSections[idx];this._mediaSections[idx]=newMediaSection,this._midToIndex.delete(oldMediaSection.mid),this._midToIndex.set(newMediaSection.mid,idx),this._sdpObject.media[idx]=newMediaSection.getObject(),this._regenerateBundleMids()}else{const idx=this._midToIndex.get(newMediaSection.mid);if(void 0===idx)throw new Error(`no media section found with mid '${newMediaSection.mid}'`);this._mediaSections[idx]=newMediaSection,this._sdpObject.media[idx]=newMediaSection.getObject()}}_regenerateBundleMids(){this._dtlsParameters&&(this._sdpObject.groups[0].mids=this._mediaSections.filter(mediaSection=>!mediaSection.closed).map(mediaSection=>mediaSection.mid).join(" "))}}exports.RemoteSdp=RemoteSdp},{"../../Logger":391,"./MediaSection":408,"sdp-transform":509}],410:[function(require,module,exports){"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){void 0===k2&&(k2=k),Object.defineProperty(o,k2,{enumerable:!0,get:function(){return m[k]}})}:function(o,m,k,k2){void 0===k2&&(k2=k),o[k2]=m[k]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:!0,value:v})}:function(o,v){o.default=v}),__importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)"default"!==k&&Object.hasOwnProperty.call(mod,k)&&__createBinding(result,mod,k);return __setModuleDefault(result,mod),result};Object.defineProperty(exports,"__esModule",{value:!0}),exports.applyCodecParameters=exports.getCname=exports.extractDtlsParameters=exports.extractRtpCapabilities=void 0;const sdpTransform=__importStar(require("sdp-transform"));function extractRtpCapabilities({sdpObject:sdpObject}){const codecsMap=new Map,headerExtensions=[];let gotAudio=!1,gotVideo=!1;for(const m of sdpObject.media){const kind=m.type;switch(kind){case"audio":if(gotAudio)continue;gotAudio=!0;break;case"video":if(gotVideo)continue;gotVideo=!0;break;default:continue}for(const rtp of m.rtp){const codec={kind:kind,mimeType:`${kind}/${rtp.codec}`,preferredPayloadType:rtp.payload,clockRate:rtp.rate,channels:rtp.encoding,parameters:{},rtcpFeedback:[]};codecsMap.set(codec.preferredPayloadType,codec)}for(const fmtp of m.fmtp||[]){const parameters=sdpTransform.parseParams(fmtp.config),codec=codecsMap.get(fmtp.payload);codec&&(parameters&&parameters.hasOwnProperty("profile-level-id")&&(parameters["profile-level-id"]=String(parameters["profile-level-id"])),codec.parameters=parameters)}for(const fb of m.rtcpFb||[]){const codec=codecsMap.get(fb.payload);if(!codec)continue;const feedback={type:fb.type,parameter:fb.subtype};feedback.parameter||delete feedback.parameter,codec.rtcpFeedback.push(feedback)}for(const ext of m.ext||[]){if(ext["encrypt-uri"])continue;const headerExtension={kind:kind,uri:ext.uri,preferredId:ext.value};headerExtensions.push(headerExtension)}}const rtpCapabilities={codecs:Array.from(codecsMap.values()),headerExtensions:headerExtensions};return rtpCapabilities}function extractDtlsParameters({sdpObject:sdpObject}){const mediaObject=(sdpObject.media||[]).find(m=>m.iceUfrag&&0!==m.port);if(!mediaObject)throw new Error("no active media section found");const fingerprint=mediaObject.fingerprint||sdpObject.fingerprint;let role;switch(mediaObject.setup){case"active":role="client";break;case"passive":role="server";break;case"actpass":role="auto"}const dtlsParameters={role:role,fingerprints:[{algorithm:fingerprint.type,value:fingerprint.hash}]};return dtlsParameters}function getCname({offerMediaObject:offerMediaObject}){const ssrcCnameLine=(offerMediaObject.ssrcs||[]).find(line=>"cname"===line.attribute);return ssrcCnameLine?ssrcCnameLine.value:""}function applyCodecParameters({offerRtpParameters:offerRtpParameters,answerMediaObject:answerMediaObject}){for(const codec of offerRtpParameters.codecs){const mimeType=codec.mimeType.toLowerCase();if("audio/opus"!==mimeType)continue;const rtp=(answerMediaObject.rtp||[]).find(r=>r.payload===codec.payloadType);if(!rtp)continue;answerMediaObject.fmtp=answerMediaObject.fmtp||[];let fmtp=answerMediaObject.fmtp.find(f=>f.payload===codec.payloadType);fmtp||(fmtp={payload:codec.payloadType,config:""},answerMediaObject.fmtp.push(fmtp));const parameters=sdpTransform.parseParams(fmtp.config);switch(mimeType){case"audio/opus":{const spropStereo=codec.parameters["sprop-stereo"];void 0!==spropStereo&&(parameters.stereo=spropStereo?1:0);break}}fmtp.config="";for(const key of Object.keys(parameters))fmtp.config&&(fmtp.config+=";"),fmtp.config+=`${key}=${parameters[key]}`}}exports.extractRtpCapabilities=extractRtpCapabilities,exports.extractDtlsParameters=extractDtlsParameters,exports.getCname=getCname,exports.applyCodecParameters=applyCodecParameters},{"sdp-transform":509}],411:[function(require,module,exports){"use strict";function getRtpEncodings({offerMediaObject:offerMediaObject,track:track}){let firstSsrc;const ssrcs=new Set;for(const line of offerMediaObject.ssrcs||[]){if("msid"!==line.attribute)continue;const trackId=line.value.split(" ")[1];if(trackId===track.id){const ssrc=line.id;ssrcs.add(ssrc),firstSsrc||(firstSsrc=ssrc)}}if(0===ssrcs.size)throw new Error(`a=ssrc line with msid information not found [track.id:${track.id}]`);const ssrcToRtxSsrc=new Map;for(const line of offerMediaObject.ssrcGroups||[]){if("FID"!==line.semantics)continue;let[ssrc,rtxSsrc]=line.ssrcs.split(/\s+/);ssrc=Number(ssrc),rtxSsrc=Number(rtxSsrc),ssrcs.has(ssrc)&&(ssrcs.delete(ssrc),ssrcs.delete(rtxSsrc),ssrcToRtxSsrc.set(ssrc,rtxSsrc))}for(const ssrc of ssrcs)ssrcToRtxSsrc.set(ssrc,null);const encodings=[];for(const[ssrc,rtxSsrc]of ssrcToRtxSsrc){const encoding={ssrc:ssrc};rtxSsrc&&(encoding.rtx={ssrc:rtxSsrc}),encodings.push(encoding)}return encodings}function addLegacySimulcast({offerMediaObject:offerMediaObject,track:track,numStreams:numStreams}){if(numStreams<=1)throw new TypeError("numStreams must be greater than 1");let firstSsrc,firstRtxSsrc,streamId;const ssrcMsidLine=(offerMediaObject.ssrcs||[]).find(line=>{if("msid"!==line.attribute)return!1;const trackId=line.value.split(" ")[1];return trackId===track.id&&(firstSsrc=line.id,streamId=line.value.split(" ")[0],!0)});if(!ssrcMsidLine)throw new Error(`a=ssrc line with msid information not found [track.id:${track.id}]`);(offerMediaObject.ssrcGroups||[]).some(line=>{if("FID"!==line.semantics)return!1;const ssrcs=line.ssrcs.split(/\s+/);return Number(ssrcs[0])===firstSsrc&&(firstRtxSsrc=Number(ssrcs[1]),!0)});const ssrcCnameLine=offerMediaObject.ssrcs.find(line=>"cname"===line.attribute&&line.id===firstSsrc);if(!ssrcCnameLine)throw new Error(`a=ssrc line with cname information not found [track.id:${track.id}]`);const cname=ssrcCnameLine.value,ssrcs=[],rtxSsrcs=[];for(let i=0;i<numStreams;++i)ssrcs.push(firstSsrc+i),firstRtxSsrc&&rtxSsrcs.push(firstRtxSsrc+i);offerMediaObject.ssrcGroups=offerMediaObject.ssrcGroups||[],offerMediaObject.ssrcs=offerMediaObject.ssrcs||[],offerMediaObject.ssrcGroups.push({semantics:"SIM",ssrcs:ssrcs.join(" ")});for(let i=0;i<ssrcs.length;++i){const ssrc=ssrcs[i];offerMediaObject.ssrcs.push({id:ssrc,attribute:"cname",value:cname}),offerMediaObject.ssrcs.push({id:ssrc,attribute:"msid",value:`${streamId} ${track.id}`})}for(let i=0;i<rtxSsrcs.length;++i){const ssrc=ssrcs[i],rtxSsrc=rtxSsrcs[i];offerMediaObject.ssrcs.push({id:rtxSsrc,attribute:"cname",value:cname}),offerMediaObject.ssrcs.push({id:rtxSsrc,attribute:"msid",value:`${streamId} ${track.id}`}),offerMediaObject.ssrcGroups.push({semantics:"FID",ssrcs:`${ssrc} ${rtxSsrc}`})}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.addLegacySimulcast=exports.getRtpEncodings=void 0,exports.getRtpEncodings=getRtpEncodings,exports.addLegacySimulcast=addLegacySimulcast},{}],412:[function(require,module,exports){"use strict";function getRtpEncodings({offerMediaObject:offerMediaObject}){const ssrcs=new Set;for(const line of offerMediaObject.ssrcs||[]){const ssrc=line.id;ssrcs.add(ssrc)}if(0===ssrcs.size)throw new Error("no a=ssrc lines found");const ssrcToRtxSsrc=new Map;for(const line of offerMediaObject.ssrcGroups||[]){if("FID"!==line.semantics)continue;let[ssrc,rtxSsrc]=line.ssrcs.split(/\s+/);ssrc=Number(ssrc),rtxSsrc=Number(rtxSsrc),ssrcs.has(ssrc)&&(ssrcs.delete(ssrc),ssrcs.delete(rtxSsrc),ssrcToRtxSsrc.set(ssrc,rtxSsrc))}for(const ssrc of ssrcs)ssrcToRtxSsrc.set(ssrc,null);const encodings=[];for(const[ssrc,rtxSsrc]of ssrcToRtxSsrc){const encoding={ssrc:ssrc};rtxSsrc&&(encoding.rtx={ssrc:rtxSsrc}),encodings.push(encoding)}return encodings}function addLegacySimulcast({offerMediaObject:offerMediaObject,numStreams:numStreams}){if(numStreams<=1)throw new TypeError("numStreams must be greater than 1");const ssrcMsidLine=(offerMediaObject.ssrcs||[]).find(line=>"msid"===line.attribute);if(!ssrcMsidLine)throw new Error("a=ssrc line with msid information not found");const[streamId,trackId]=ssrcMsidLine.value.split(" "),firstSsrc=ssrcMsidLine.id;let firstRtxSsrc;(offerMediaObject.ssrcGroups||[]).some(line=>{if("FID"!==line.semantics)return!1;const ssrcs=line.ssrcs.split(/\s+/);return Number(ssrcs[0])===firstSsrc&&(firstRtxSsrc=Number(ssrcs[1]),!0)});const ssrcCnameLine=offerMediaObject.ssrcs.find(line=>"cname"===line.attribute);if(!ssrcCnameLine)throw new Error("a=ssrc line with cname information not found");const cname=ssrcCnameLine.value,ssrcs=[],rtxSsrcs=[];for(let i=0;i<numStreams;++i)ssrcs.push(firstSsrc+i),firstRtxSsrc&&rtxSsrcs.push(firstRtxSsrc+i);offerMediaObject.ssrcGroups=[],offerMediaObject.ssrcs=[],offerMediaObject.ssrcGroups.push({semantics:"SIM",ssrcs:ssrcs.join(" ")});for(let i=0;i<ssrcs.length;++i){const ssrc=ssrcs[i];offerMediaObject.ssrcs.push({id:ssrc,attribute:"cname",value:cname}),offerMediaObject.ssrcs.push({id:ssrc,attribute:"msid",value:`${streamId} ${trackId}`})}for(let i=0;i<rtxSsrcs.length;++i){const ssrc=ssrcs[i],rtxSsrc=rtxSsrcs[i];offerMediaObject.ssrcs.push({id:rtxSsrc,attribute:"cname",value:cname}),offerMediaObject.ssrcs.push({id:rtxSsrc,attribute:"msid",value:`${streamId} ${trackId}`}),offerMediaObject.ssrcGroups.push({semantics:"FID",ssrcs:`${ssrc} ${rtxSsrc}`})}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.addLegacySimulcast=exports.getRtpEncodings=void 0,exports.getRtpEncodings=getRtpEncodings,exports.addLegacySimulcast=addLegacySimulcast},{}],413:[function(require,module,exports){"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){void 0===k2&&(k2=k),Object.defineProperty(o,k2,{enumerable:!0,get:function(){return m[k]}})}:function(o,m,k,k2){void 0===k2&&(k2=k),o[k2]=m[k]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:!0,value:v})}:function(o,v){o.default=v}),__importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)"default"!==k&&Object.hasOwnProperty.call(mod,k)&&__createBinding(result,mod,k);return __setModuleDefault(result,mod),result};Object.defineProperty(exports,"__esModule",{value:!0}),exports.detectDevice=exports.Device=exports.version=exports.types=void 0;const Device_1=require("./Device");Object.defineProperty(exports,"Device",{enumerable:!0,get:function(){return Device_1.Device}}),Object.defineProperty(exports,"detectDevice",{enumerable:!0,get:function(){return Device_1.detectDevice}});const types=__importStar(require("./types"));exports.types=types,exports.version="3.6.30";var scalabilityModes_1=require("./scalabilityModes");Object.defineProperty(exports,"parseScalabilityMode",{enumerable:!0,get:function(){return scalabilityModes_1.parse}})},{"./Device":389,"./scalabilityModes":415,"./types":416}],414:[function(require,module,exports){"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){void 0===k2&&(k2=k),Object.defineProperty(o,k2,{enumerable:!0,get:function(){return m[k]}})}:function(o,m,k,k2){void 0===k2&&(k2=k),o[k2]=m[k]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:!0,value:v})}:function(o,v){o.default=v}),__importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)"default"!==k&&Object.hasOwnProperty.call(mod,k)&&__createBinding(result,mod,k);return __setModuleDefault(result,mod),result};Object.defineProperty(exports,"__esModule",{value:!0}),exports.canReceive=exports.canSend=exports.generateProbatorRtpParameters=exports.reduceCodecs=exports.getSendingRemoteRtpParameters=exports.getSendingRtpParameters=exports.getRecvRtpCapabilities=exports.getExtendedRtpCapabilities=exports.validateSctpStreamParameters=exports.validateSctpParameters=exports.validateNumSctpStreams=exports.validateSctpCapabilities=exports.validateRtcpParameters=exports.validateRtpEncodingParameters=exports.validateRtpHeaderExtensionParameters=exports.validateRtpCodecParameters=exports.validateRtpParameters=exports.validateRtpHeaderExtension=exports.validateRtcpFeedback=exports.validateRtpCodecCapability=exports.validateRtpCapabilities=void 0;const h264=__importStar(require("h264-profile-level-id")),utils=__importStar(require("./utils")),RTP_PROBATOR_MID="probator",RTP_PROBATOR_SSRC=1234,RTP_PROBATOR_CODEC_PAYLOAD_TYPE=127;function validateRtpCapabilities(caps){if("object"!=typeof caps)throw new TypeError("caps is not an object");if(caps.codecs&&!Array.isArray(caps.codecs))throw new TypeError("caps.codecs is not an array");caps.codecs||(caps.codecs=[]);for(const codec of caps.codecs)validateRtpCodecCapability(codec);if(caps.headerExtensions&&!Array.isArray(caps.headerExtensions))throw new TypeError("caps.headerExtensions is not an array");caps.headerExtensions||(caps.headerExtensions=[]);for(const ext of caps.headerExtensions)validateRtpHeaderExtension(ext)}function validateRtpCodecCapability(codec){const MimeTypeRegex=new RegExp("^(audio|video)/(.+)","i");if("object"!=typeof codec)throw new TypeError("codec is not an object");if(!codec.mimeType||"string"!=typeof codec.mimeType)throw new TypeError("missing codec.mimeType");const mimeTypeMatch=MimeTypeRegex.exec(codec.mimeType);if(!mimeTypeMatch)throw new TypeError("invalid codec.mimeType");if(codec.kind=mimeTypeMatch[1].toLowerCase(),codec.preferredPayloadType&&"number"!=typeof codec.preferredPayloadType)throw new TypeError("invalid codec.preferredPayloadType");if("number"!=typeof codec.clockRate)throw new TypeError("missing codec.clockRate");"audio"===codec.kind?"number"!=typeof codec.channels&&(codec.channels=1):delete codec.channels,codec.parameters&&"object"==typeof codec.parameters||(codec.parameters={});for(const key of Object.keys(codec.parameters)){let value=codec.parameters[key];if(void 0===value&&(codec.parameters[key]="",value=""),"string"!=typeof value&&"number"!=typeof value)throw new TypeError(`invalid codec parameter [key:${key}s, value:${value}]`);if("apt"===key&&"number"!=typeof value)throw new TypeError("invalid codec apt parameter")}codec.rtcpFeedback&&Array.isArray(codec.rtcpFeedback)||(codec.rtcpFeedback=[]);for(const fb of codec.rtcpFeedback)validateRtcpFeedback(fb)}function validateRtcpFeedback(fb){if("object"!=typeof fb)throw new TypeError("fb is not an object");if(!fb.type||"string"!=typeof fb.type)throw new TypeError("missing fb.type");fb.parameter&&"string"==typeof fb.parameter||(fb.parameter="")}function validateRtpHeaderExtension(ext){if("object"!=typeof ext)throw new TypeError("ext is not an object");if(ext.kind&&"string"==typeof ext.kind||(ext.kind=""),""!==ext.kind&&"audio"!==ext.kind&&"video"!==ext.kind)throw new TypeError("invalid ext.kind");if(!ext.uri||"string"!=typeof ext.uri)throw new TypeError("missing ext.uri");if("number"!=typeof ext.preferredId)throw new TypeError("missing ext.preferredId");if(ext.preferredEncrypt&&"boolean"!=typeof ext.preferredEncrypt)throw new TypeError("invalid ext.preferredEncrypt");if(ext.preferredEncrypt||(ext.preferredEncrypt=!1),ext.direction&&"string"!=typeof ext.direction)throw new TypeError("invalid ext.direction");ext.direction||(ext.direction="sendrecv")}function validateRtpParameters(params){if("object"!=typeof params)throw new TypeError("params is not an object");if(params.mid&&"string"!=typeof params.mid)throw new TypeError("params.mid is not a string");if(!Array.isArray(params.codecs))throw new TypeError("missing params.codecs");for(const codec of params.codecs)validateRtpCodecParameters(codec);if(params.headerExtensions&&!Array.isArray(params.headerExtensions))throw new TypeError("params.headerExtensions is not an array");params.headerExtensions||(params.headerExtensions=[]);for(const ext of params.headerExtensions)validateRtpHeaderExtensionParameters(ext);if(params.encodings&&!Array.isArray(params.encodings))throw new TypeError("params.encodings is not an array");params.encodings||(params.encodings=[]);for(const encoding of params.encodings)validateRtpEncodingParameters(encoding);if(params.rtcp&&"object"!=typeof params.rtcp)throw new TypeError("params.rtcp is not an object");params.rtcp||(params.rtcp={}),validateRtcpParameters(params.rtcp)}function validateRtpCodecParameters(codec){const MimeTypeRegex=new RegExp("^(audio|video)/(.+)","i");if("object"!=typeof codec)throw new TypeError("codec is not an object");if(!codec.mimeType||"string"!=typeof codec.mimeType)throw new TypeError("missing codec.mimeType");const mimeTypeMatch=MimeTypeRegex.exec(codec.mimeType);if(!mimeTypeMatch)throw new TypeError("invalid codec.mimeType");if("number"!=typeof codec.payloadType)throw new TypeError("missing codec.payloadType");if("number"!=typeof codec.clockRate)throw new TypeError("missing codec.clockRate");const kind=mimeTypeMatch[1].toLowerCase();"audio"===kind?"number"!=typeof codec.channels&&(codec.channels=1):delete codec.channels,codec.parameters&&"object"==typeof codec.parameters||(codec.parameters={});for(const key of Object.keys(codec.parameters)){let value=codec.parameters[key];if(void 0===value&&(codec.parameters[key]="",value=""),"string"!=typeof value&&"number"!=typeof value)throw new TypeError(`invalid codec parameter [key:${key}s, value:${value}]`);if("apt"===key&&"number"!=typeof value)throw new TypeError("invalid codec apt parameter")}codec.rtcpFeedback&&Array.isArray(codec.rtcpFeedback)||(codec.rtcpFeedback=[]);for(const fb of codec.rtcpFeedback)validateRtcpFeedback(fb)}function validateRtpHeaderExtensionParameters(ext){if("object"!=typeof ext)throw new TypeError("ext is not an object");if(!ext.uri||"string"!=typeof ext.uri)throw new TypeError("missing ext.uri");if("number"!=typeof ext.id)throw new TypeError("missing ext.id");if(ext.encrypt&&"boolean"!=typeof ext.encrypt)throw new TypeError("invalid ext.encrypt");ext.encrypt||(ext.encrypt=!1),ext.parameters&&"object"==typeof ext.parameters||(ext.parameters={});for(const key of Object.keys(ext.parameters)){let value=ext.parameters[key];if(void 0===value&&(ext.parameters[key]="",value=""),"string"!=typeof value&&"number"!=typeof value)throw new TypeError("invalid header extension parameter")}}function validateRtpEncodingParameters(encoding){if("object"!=typeof encoding)throw new TypeError("encoding is not an object");if(encoding.ssrc&&"number"!=typeof encoding.ssrc)throw new TypeError("invalid encoding.ssrc");if(encoding.rid&&"string"!=typeof encoding.rid)throw new TypeError("invalid encoding.rid");if(encoding.rtx&&"object"!=typeof encoding.rtx)throw new TypeError("invalid encoding.rtx");if(encoding.rtx&&"number"!=typeof encoding.rtx.ssrc)throw new TypeError("missing encoding.rtx.ssrc");if(encoding.dtx&&"boolean"==typeof encoding.dtx||(encoding.dtx=!1),encoding.scalabilityMode&&"string"!=typeof encoding.scalabilityMode)throw new TypeError("invalid encoding.scalabilityMode")}function validateRtcpParameters(rtcp){if("object"!=typeof rtcp)throw new TypeError("rtcp is not an object");if(rtcp.cname&&"string"!=typeof rtcp.cname)throw new TypeError("invalid rtcp.cname");rtcp.reducedSize&&"boolean"==typeof rtcp.reducedSize||(rtcp.reducedSize=!0)}function validateSctpCapabilities(caps){if("object"!=typeof caps)throw new TypeError("caps is not an object");if(!caps.numStreams||"object"!=typeof caps.numStreams)throw new TypeError("missing caps.numStreams");validateNumSctpStreams(caps.numStreams)}function validateNumSctpStreams(numStreams){if("object"!=typeof numStreams)throw new TypeError("numStreams is not an object");if("number"!=typeof numStreams.OS)throw new TypeError("missing numStreams.OS");if("number"!=typeof numStreams.MIS)throw new TypeError("missing numStreams.MIS")}function validateSctpParameters(params){if("object"!=typeof params)throw new TypeError("params is not an object");if("number"!=typeof params.port)throw new TypeError("missing params.port");if("number"!=typeof params.OS)throw new TypeError("missing params.OS");if("number"!=typeof params.MIS)throw new TypeError("missing params.MIS");if("number"!=typeof params.maxMessageSize)throw new TypeError("missing params.maxMessageSize")}function validateSctpStreamParameters(params){if("object"!=typeof params)throw new TypeError("params is not an object");if("number"!=typeof params.streamId)throw new TypeError("missing params.streamId");let orderedGiven=!1;if("boolean"==typeof params.ordered?orderedGiven=!0:params.ordered=!0,params.maxPacketLifeTime&&"number"!=typeof params.maxPacketLifeTime)throw new TypeError("invalid params.maxPacketLifeTime");if(params.maxRetransmits&&"number"!=typeof params.maxRetransmits)throw new TypeError("invalid params.maxRetransmits");if(params.maxPacketLifeTime&&params.maxRetransmits)throw new TypeError("cannot provide both maxPacketLifeTime and maxRetransmits");if(orderedGiven&&params.ordered&&(params.maxPacketLifeTime||params.maxRetransmits))throw new TypeError("cannot be ordered with maxPacketLifeTime or maxRetransmits");if(orderedGiven||!params.maxPacketLifeTime&&!params.maxRetransmits||(params.ordered=!1),params.priority&&"string"!=typeof params.priority)throw new TypeError("invalid params.priority");if(params.label&&"string"!=typeof params.label)throw new TypeError("invalid params.label");if(params.protocol&&"string"!=typeof params.protocol)throw new TypeError("invalid params.protocol")}function getExtendedRtpCapabilities(localCaps,remoteCaps){const extendedRtpCapabilities={codecs:[],headerExtensions:[]};for(const remoteCodec of remoteCaps.codecs||[]){if(isRtxCodec(remoteCodec))continue;const matchingLocalCodec=(localCaps.codecs||[]).find(localCodec=>matchCodecs(localCodec,remoteCodec,{strict:!0,modify:!0}));if(!matchingLocalCodec)continue;const extendedCodec={mimeType:matchingLocalCodec.mimeType,kind:matchingLocalCodec.kind,clockRate:matchingLocalCodec.clockRate,channels:matchingLocalCodec.channels,localPayloadType:matchingLocalCodec.preferredPayloadType,localRtxPayloadType:void 0,remotePayloadType:remoteCodec.preferredPayloadType,remoteRtxPayloadType:void 0,localParameters:matchingLocalCodec.parameters,remoteParameters:remoteCodec.parameters,rtcpFeedback:reduceRtcpFeedback(matchingLocalCodec,remoteCodec)};extendedRtpCapabilities.codecs.push(extendedCodec)}for(const extendedCodec of extendedRtpCapabilities.codecs){const matchingLocalRtxCodec=localCaps.codecs.find(localCodec=>isRtxCodec(localCodec)&&localCodec.parameters.apt===extendedCodec.localPayloadType),matchingRemoteRtxCodec=remoteCaps.codecs.find(remoteCodec=>isRtxCodec(remoteCodec)&&remoteCodec.parameters.apt===extendedCodec.remotePayloadType);matchingLocalRtxCodec&&matchingRemoteRtxCodec&&(extendedCodec.localRtxPayloadType=matchingLocalRtxCodec.preferredPayloadType,extendedCodec.remoteRtxPayloadType=matchingRemoteRtxCodec.preferredPayloadType)}for(const remoteExt of remoteCaps.headerExtensions){const matchingLocalExt=localCaps.headerExtensions.find(localExt=>matchHeaderExtensions(localExt,remoteExt));if(!matchingLocalExt)continue;const extendedExt={kind:remoteExt.kind,uri:remoteExt.uri,sendId:matchingLocalExt.preferredId,recvId:remoteExt.preferredId,encrypt:matchingLocalExt.preferredEncrypt,direction:"sendrecv"};switch(remoteExt.direction){case"sendrecv":extendedExt.direction="sendrecv";break;case"recvonly":extendedExt.direction="sendonly";break;case"sendonly":extendedExt.direction="recvonly";break;case"inactive":extendedExt.direction="inactive"}extendedRtpCapabilities.headerExtensions.push(extendedExt)}return extendedRtpCapabilities}function getRecvRtpCapabilities(extendedRtpCapabilities){const rtpCapabilities={codecs:[],headerExtensions:[]};for(const extendedCodec of extendedRtpCapabilities.codecs){const codec={mimeType:extendedCodec.mimeType,kind:extendedCodec.kind,preferredPayloadType:extendedCodec.remotePayloadType,clockRate:extendedCodec.clockRate,channels:extendedCodec.channels,parameters:extendedCodec.localParameters,rtcpFeedback:extendedCodec.rtcpFeedback};if(rtpCapabilities.codecs.push(codec),!extendedCodec.remoteRtxPayloadType)continue;const rtxCodec={mimeType:`${extendedCodec.kind}/rtx`,kind:extendedCodec.kind,preferredPayloadType:extendedCodec.remoteRtxPayloadType,clockRate:extendedCodec.clockRate,parameters:{apt:extendedCodec.remotePayloadType},rtcpFeedback:[]};rtpCapabilities.codecs.push(rtxCodec)}for(const extendedExtension of extendedRtpCapabilities.headerExtensions){if("sendrecv"!==extendedExtension.direction&&"recvonly"!==extendedExtension.direction)continue;const ext={kind:extendedExtension.kind,uri:extendedExtension.uri,preferredId:extendedExtension.recvId,preferredEncrypt:extendedExtension.encrypt,direction:extendedExtension.direction};rtpCapabilities.headerExtensions.push(ext)}return rtpCapabilities}function getSendingRtpParameters(kind,extendedRtpCapabilities){const rtpParameters={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(const extendedCodec of extendedRtpCapabilities.codecs){if(extendedCodec.kind!==kind)continue;const codec={mimeType:extendedCodec.mimeType,payloadType:extendedCodec.localPayloadType,clockRate:extendedCodec.clockRate,channels:extendedCodec.channels,parameters:extendedCodec.localParameters,rtcpFeedback:extendedCodec.rtcpFeedback};if(rtpParameters.codecs.push(codec),extendedCodec.localRtxPayloadType){const rtxCodec={mimeType:`${extendedCodec.kind}/rtx`,payloadType:extendedCodec.localRtxPayloadType,clockRate:extendedCodec.clockRate,parameters:{apt:extendedCodec.localPayloadType},rtcpFeedback:[]};rtpParameters.codecs.push(rtxCodec)}}for(const extendedExtension of extendedRtpCapabilities.headerExtensions){if(extendedExtension.kind&&extendedExtension.kind!==kind||"sendrecv"!==extendedExtension.direction&&"sendonly"!==extendedExtension.direction)continue;const ext={uri:extendedExtension.uri,id:extendedExtension.sendId,encrypt:extendedExtension.encrypt,parameters:{}};rtpParameters.headerExtensions.push(ext)}return rtpParameters}function getSendingRemoteRtpParameters(kind,extendedRtpCapabilities){const rtpParameters={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(const extendedCodec of extendedRtpCapabilities.codecs){if(extendedCodec.kind!==kind)continue;const codec={mimeType:extendedCodec.mimeType,payloadType:extendedCodec.localPayloadType,clockRate:extendedCodec.clockRate,channels:extendedCodec.channels,parameters:extendedCodec.remoteParameters,rtcpFeedback:extendedCodec.rtcpFeedback};if(rtpParameters.codecs.push(codec),extendedCodec.localRtxPayloadType){const rtxCodec={mimeType:`${extendedCodec.kind}/rtx`,payloadType:extendedCodec.localRtxPayloadType,clockRate:extendedCodec.clockRate,parameters:{apt:extendedCodec.localPayloadType},rtcpFeedback:[]};rtpParameters.codecs.push(rtxCodec)}}for(const extendedExtension of extendedRtpCapabilities.headerExtensions){if(extendedExtension.kind&&extendedExtension.kind!==kind||"sendrecv"!==extendedExtension.direction&&"sendonly"!==extendedExtension.direction)continue;const ext={uri:extendedExtension.uri,id:extendedExtension.sendId,encrypt:extendedExtension.encrypt,parameters:{}};rtpParameters.headerExtensions.push(ext)}if(rtpParameters.headerExtensions.some(ext=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===ext.uri))for(const codec of rtpParameters.codecs)codec.rtcpFeedback=(codec.rtcpFeedback||[]).filter(fb=>"goog-remb"!==fb.type);else if(rtpParameters.headerExtensions.some(ext=>"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===ext.uri))for(const codec of rtpParameters.codecs)codec.rtcpFeedback=(codec.rtcpFeedback||[]).filter(fb=>"transport-cc"!==fb.type);else for(const codec of rtpParameters.codecs)codec.rtcpFeedback=(codec.rtcpFeedback||[]).filter(fb=>"transport-cc"!==fb.type&&"goog-remb"!==fb.type);return rtpParameters}function reduceCodecs(codecs,capCodec){const filteredCodecs=[];if(capCodec){for(let idx=0;idx<codecs.length;++idx)if(matchCodecs(codecs[idx],capCodec)){filteredCodecs.push(codecs[idx]),isRtxCodec(codecs[idx+1])&&filteredCodecs.push(codecs[idx+1]);break}if(0===filteredCodecs.length)throw new TypeError("no matching codec found")}else filteredCodecs.push(codecs[0]),isRtxCodec(codecs[1])&&filteredCodecs.push(codecs[1]);return filteredCodecs}function generateProbatorRtpParameters(videoRtpParameters){validateRtpParameters(videoRtpParameters=utils.clone(videoRtpParameters,{}));const rtpParameters={mid:"probator",codecs:[],headerExtensions:[],encodings:[{ssrc:1234}],rtcp:{cname:"probator"}};return rtpParameters.codecs.push(videoRtpParameters.codecs[0]),rtpParameters.codecs[0].payloadType=127,rtpParameters.headerExtensions=videoRtpParameters.headerExtensions,rtpParameters}function canSend(kind,extendedRtpCapabilities){return extendedRtpCapabilities.codecs.some(codec=>codec.kind===kind)}function canReceive(rtpParameters,extendedRtpCapabilities){if(validateRtpParameters(rtpParameters),0===rtpParameters.codecs.length)return!1;const firstMediaCodec=rtpParameters.codecs[0];return extendedRtpCapabilities.codecs.some(codec=>codec.remotePayloadType===firstMediaCodec.payloadType)}function isRtxCodec(codec){return!!codec&&/.+\/rtx$/i.test(codec.mimeType)}function matchCodecs(aCodec,bCodec,{strict:strict=!1,modify:modify=!1}={}){const aMimeType=aCodec.mimeType.toLowerCase(),bMimeType=bCodec.mimeType.toLowerCase();if(aMimeType!==bMimeType)return!1;if(aCodec.clockRate!==bCodec.clockRate)return!1;if(aCodec.channels!==bCodec.channels)return!1;switch(aMimeType){case"video/h264":{const aPacketizationMode=aCodec.parameters["packetization-mode"]||0,bPacketizationMode=bCodec.parameters["packetization-mode"]||0;if(aPacketizationMode!==bPacketizationMode)return!1;if(strict){if(!h264.isSameProfile(aCodec.parameters,bCodec.parameters))return!1;let selectedProfileLevelId;try{selectedProfileLevelId=h264.generateProfileLevelIdForAnswer(aCodec.parameters,bCodec.parameters)}catch(error){return!1}modify&&(selectedProfileLevelId?(aCodec.parameters["profile-level-id"]=selectedProfileLevelId,bCodec.parameters["profile-level-id"]=selectedProfileLevelId):(delete aCodec.parameters["profile-level-id"],delete bCodec.parameters["profile-level-id"]))}break}case"video/vp9":if(strict){const aProfileId=aCodec.parameters["profile-id"]||0,bProfileId=bCodec.parameters["profile-id"]||0;if(aProfileId!==bProfileId)return!1}}return!0}function matchHeaderExtensions(aExt,bExt){return(!aExt.kind||!bExt.kind||aExt.kind===bExt.kind)&&aExt.uri===bExt.uri}function reduceRtcpFeedback(codecA,codecB){const reducedRtcpFeedback=[];for(const aFb of codecA.rtcpFeedback||[]){const matchingBFb=(codecB.rtcpFeedback||[]).find(bFb=>bFb.type===aFb.type&&(bFb.parameter===aFb.parameter||!bFb.parameter&&!aFb.parameter));matchingBFb&&reducedRtcpFeedback.push(matchingBFb)}return reducedRtcpFeedback}exports.validateRtpCapabilities=validateRtpCapabilities,exports.validateRtpCodecCapability=validateRtpCodecCapability,exports.validateRtcpFeedback=validateRtcpFeedback,exports.validateRtpHeaderExtension=validateRtpHeaderExtension,exports.validateRtpParameters=validateRtpParameters,exports.validateRtpCodecParameters=validateRtpCodecParameters,exports.validateRtpHeaderExtensionParameters=validateRtpHeaderExtensionParameters,exports.validateRtpEncodingParameters=validateRtpEncodingParameters,exports.validateRtcpParameters=validateRtcpParameters,exports.validateSctpCapabilities=validateSctpCapabilities,exports.validateNumSctpStreams=validateNumSctpStreams,exports.validateSctpParameters=validateSctpParameters,exports.validateSctpStreamParameters=validateSctpStreamParameters,exports.getExtendedRtpCapabilities=getExtendedRtpCapabilities,exports.getRecvRtpCapabilities=getRecvRtpCapabilities,exports.getSendingRtpParameters=getSendingRtpParameters,exports.getSendingRemoteRtpParameters=getSendingRemoteRtpParameters,exports.reduceCodecs=reduceCodecs,exports.generateProbatorRtpParameters=generateProbatorRtpParameters,exports.canSend=canSend,exports.canReceive=canReceive},{"./utils":417,"h264-profile-level-id":381}],415:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.parse=void 0;const ScalabilityModeRegex=new RegExp("^[LS]([1-9]\\d{0,1})T([1-9]\\d{0,1})");function parse(scalabilityMode){const match=ScalabilityModeRegex.exec(scalabilityMode||"");return match?{spatialLayers:Number(match[1]),temporalLayers:Number(match[2])}:{spatialLayers:1,temporalLayers:1}}exports.parse=parse},{}],416:[function(require,module,exports){"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){void 0===k2&&(k2=k),Object.defineProperty(o,k2,{enumerable:!0,get:function(){return m[k]}})}:function(o,m,k,k2){void 0===k2&&(k2=k),o[k2]=m[k]}),__exportStar=this&&this.__exportStar||function(m,exports){for(var p in m)"default"===p||exports.hasOwnProperty(p)||__createBinding(exports,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(require("./Device"),exports),__exportStar(require("./Transport"),exports),__exportStar(require("./Producer"),exports),__exportStar(require("./Consumer"),exports),__exportStar(require("./DataProducer"),exports),__exportStar(require("./DataConsumer"),exports),__exportStar(require("./RtpParameters"),exports),__exportStar(require("./SctpParameters"),exports),__exportStar(require("./handlers/HandlerInterface"),exports),__exportStar(require("./errors"),exports)},{"./Consumer":386,"./DataConsumer":387,"./DataProducer":388,"./Device":389,"./Producer":392,"./RtpParameters":393,"./SctpParameters":394,"./Transport":395,"./errors":396,"./handlers/HandlerInterface":403}],417:[function(require,module,exports){"use strict";function clone(data,defaultValue){return void 0===data?defaultValue:JSON.parse(JSON.stringify(data))}function generateRandomNumber(){return Math.round(1e7*Math.random())}Object.defineProperty(exports,"__esModule",{value:!0}),exports.generateRandomNumber=exports.clone=void 0,exports.clone=clone,exports.generateRandomNumber=generateRandomNumber},{}],418:[function(require,module,exports){var s=1e3,m=6e4,h=36e5,d=24*h,w=7*d,y=315576e5;function parse(str){if(!((str=String(str)).length>100)){var match=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(str);if(match){var n=parseFloat(match[1]),type;switch((match[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return n*y;case"weeks":case"week":case"w":return n*w;case"days":case"day":case"d":return n*d;case"hours":case"hour":case"hrs":case"hr":case"h":return n*h;case"minutes":case"minute":case"mins":case"min":case"m":return n*m;case"seconds":case"second":case"secs":case"sec":case"s":return n*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}}}function fmtShort(ms){var msAbs=Math.abs(ms);return msAbs>=d?Math.round(ms/d)+"d":msAbs>=h?Math.round(ms/h)+"h":msAbs>=m?Math.round(ms/m)+"m":msAbs>=s?Math.round(ms/s)+"s":ms+"ms"}function fmtLong(ms){var msAbs=Math.abs(ms);return msAbs>=d?plural(ms,msAbs,d,"day"):msAbs>=h?plural(ms,msAbs,h,"hour"):msAbs>=m?plural(ms,msAbs,m,"minute"):msAbs>=s?plural(ms,msAbs,s,"second"):ms+" ms"}function plural(ms,msAbs,n,name){var isPlural=msAbs>=1.5*n;return Math.round(ms/n)+" "+name+(isPlural?"s":"")}module.exports=function(val,options){options=options||{};var type=typeof val;if("string"===type&&val.length>0)return parse(val);if("number"===type&&isFinite(val))return options.long?fmtLong(val):fmtShort(val);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(val))}},{}],419:[function(require,module,exports){
/*
object-assign
(c) Sindre Sorhus
@license MIT
*/
"use strict";var getOwnPropertySymbols=Object.getOwnPropertySymbols,hasOwnProperty=Object.prototype.hasOwnProperty,propIsEnumerable=Object.prototype.propertyIsEnumerable;function toObject(val){if(null==val)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(val)}function shouldUseNative(){try{if(!Object.assign)return!1;var test1=new String("abc"),order2;if(test1[5]="de","5"===Object.getOwnPropertyNames(test1)[0])return!1;for(var test2={},i=0;i<10;i++)test2["_"+String.fromCharCode(i)]=i;if("0123456789"!==Object.getOwnPropertyNames(test2).map((function(n){return test2[n]})).join(""))return!1;var test3={};return"abcdefghijklmnopqrst".split("").forEach((function(letter){test3[letter]=letter})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},test3)).join("")}catch(err){return!1}}module.exports=shouldUseNative()?Object.assign:function(target,source){for(var from,to=toObject(target),symbols,s=1;s<arguments.length;s++){for(var key in from=Object(arguments[s]))hasOwnProperty.call(from,key)&&(to[key]=from[key]);if(getOwnPropertySymbols){symbols=getOwnPropertySymbols(from);for(var i=0;i<symbols.length;i++)propIsEnumerable.call(from,symbols[i])&&(to[symbols[i]]=from[symbols[i]])}}return to}},{}],420:[function(require,module,exports){module.exports=["Bulbasaur","Ivysaur","Venusaur","Charmander","Charmeleon","Charizard","Squirtle","Wartortle","Blastoise","Caterpie","Metapod","Butterfree","Weedle","Kakuna","Beedrill","Pidgey","Pidgeotto","Pidgeot","Rattata","Raticate","Spearow","Fearow","Ekans","Arbok","Pikachu","Raichu","Sandshrew","Sandslash","Nidoran","Nidorina","Nidoqueen","Nidoran","Nidorino","Nidoking","Clefairy","Clefable","Vulpix","Ninetales","Jigglypuff","Wigglytuff","Zubat","Golbat","Oddish","Gloom","Vileplume","Paras","Parasect","Venonat","Venomoth","Diglett","Dugtrio","Meowth","Persian","Psyduck","Golduck","Mankey","Primeape","Growlithe","Arcanine","Poliwag","Poliwhirl","Poliwrath","Abra","Kadabra","Alakazam","Machop","Machoke","Machamp","Bellsprout","Weepinbell","Victreebel","Tentacool","Tentacruel","Geodude","Graveler","Golem","Ponyta","Rapidash","Slowpoke","Slowbro","Magnemite","Magneton","Farfetchd","Doduo","Dodrio","Seel","Dewgong","Grimer","Muk","Shellder","Cloyster","Gastly","Haunter","Gengar","Onix","Drowzee","Hypno","Krabby","Kingler","Voltorb","Electrode","Exeggcute","Exeggutor","Cubone","Marowak","Hitmonlee","Hitmonchan","Lickitung","Koffing","Weezing","Rhyhorn","Rhydon","Chansey","Tangela","Kangaskhan","Horsea","Seadra","Goldeen","Seaking","Staryu","Starmie","Mr. Mime","Scyther","Jynx","Electabuzz","Magmar","Pinsir","Tauros","Magikarp","Gyarados","Lapras","Ditto","Eevee","Vaporeon","Jolteon","Flareon","Porygon","Omanyte","Omastar","Kabuto","Kabutops","Aerodactyl","Snorlax","Articuno","Zapdos","Moltres","Dratini","Dragonair","Dragonite","Mewtwo","Mew","Chikorita","Bayleef","Meganium","Cyndaquil","Quilava","Typhlosion","Totodile","Croconaw","Feraligatr","Sentret","Furret","Hoothoot","Noctowl","Ledyba","Ledian","Spinarak","Ariados","Crobat","Chinchou","Lanturn","Pichu","Cleffa","Igglybuff","Togepi","Togetic","Natu","Xatu","Mareep","Flaaffy","Ampharos","Bellossom","Marill","Azumarill","Sudowoodo","Politoed","Hoppip","Skiploom","Jumpluff","Aipom","Sunkern","Sunflora","Yanma","Wooper","Quagsire","Espeon","Umbreon","Murkrow","Slowking","Misdreavus","Unown","Wobbuffet","Girafarig","Pineco","Forretress","Dunsparce","Gligar","Steelix","Snubbull","Granbull","Qwilfish","Scizor","Shuckle","Heracross","Sneasel","Teddiursa","Ursaring","Slugma","Magcargo","Swinub","Piloswine","Corsola","Remoraid","Octillery","Delibird","Mantine","Skarmory","Houndour","Houndoom","Kingdra","Phanpy","Donphan","Porygon2","Stantler","Smeargle","Tyrogue","Hitmontop","Smoochum","Elekid","Magby","Miltank","Blissey","Raikou","Entei","Suicune","Larvitar","Pupitar","Tyranitar","Lugia","Ho-Oh","Celebi","Treecko","Grovyle","Sceptile","Torchic","Combusken","Blaziken","Mudkip","Marshtomp","Swampert","Poochyena","Mightyena","Zigzagoon","Linoone","Wurmple","Silcoon","Beautifly","Cascoon","Dustox","Lotad","Lombre","Ludicolo","Seedot","Nuzleaf","Shiftry","Taillow","Swellow","Wingull","Pelipper","Ralts","Kirlia","Gardevoir","Surskit","Masquerain","Shroomish","Breloom","Slakoth","Vigoroth","Slaking","Nincada","Ninjask","Shedinja","Whismur","Loudred","Exploud","Makuhita","Hariyama","Azurill","Nosepass","Skitty","Delcatty","Sableye","Mawile","Aron","Lairon","Aggron","Meditite","Medicham","Electrike","Manectric","Plusle","Minun","Volbeat","Illumise","Roselia","Gulpin","Swalot","Carvanha","Sharpedo","Wailmer","Wailord","Numel","Camerupt","Torkoal","Spoink","Grumpig","Spinda","Trapinch","Vibrava","Flygon","Cacnea","Cacturne","Swablu","Altaria","Zangoose","Seviper","Lunatone","Solrock","Barboach","Whiscash","Corphish","Crawdaunt","Baltoy","Claydol","Lileep","Cradily","Anorith","Armaldo","Feebas","Milotic","Castform","Kecleon","Shuppet","Banette","Duskull","Dusclops","Tropius","Chimecho","Absol","Wynaut","Snorunt","Glalie","Spheal","Sealeo","Walrein","Clamperl","Huntail","Gorebyss","Relicanth","Luvdisc","Bagon","Shelgon","Salamence","Beldum","Metang","Metagross","Regirock","Regice","Registeel","Latias","Latios","Kyogre","Groudon","Rayquaza","Jirachi","Deoxys","Turtwig","Grotle","Torterra","Chimchar","Monferno","Infernape","Piplup","Prinplup","Empoleon","Starly","Staravia","Staraptor","Bidoof","Bibarel","Kricketot","Kricketune","Shinx","Luxio","Luxray","Budew","Roserade","Cranidos","Rampardos","Shieldon","Bastiodon","Burmy","Wormadam","Mothim","Combee","Vespiquen","Pachirisu","Buizel","Floatzel","Cherubi","Cherrim","Shellos","Gastrodon","Ambipom","Drifloon","Drifblim","Buneary","Lopunny","Mismagius","Honchkrow","Glameow","Purugly","Chingling","Stunky","Skuntank","Bronzor","Bronzong","Bonsly","Mime Jr.","Happiny","Chatot","Spiritomb","Gible","Gabite","Garchomp","Munchlax","Riolu","Lucario","Hippopotas","Hippowdon","Skorupi","Drapion","Croagunk","Toxicroak","Carnivine","Finneon","Lumineon","Mantyke","Snover","Abomasnow","Weavile","Magnezone","Lickilicky","Rhyperior","Tangrowth","Electivire","Magmortar","Togekiss","Yanmega","Leafeon","Glaceon","Gliscor","Mamoswine","Porygon-Z","Gallade","Probopass","Dusknoir","Froslass","Rotom","Uxie","Mesprit","Azelf","Dialga","Palkia","Heatran","Regigigas","Giratina","Cresselia","Phione","Manaphy","Darkrai","Shaymin","Arceus","Victini","Snivy","Servine","Serperior","Tepig","Pignite","Emboar","Oshawott","Dewott","Samurott","Patrat","Watchog","Lillipup","Herdier","Stoutland","Purrloin","Liepard","Pansage","Simisage","Pansear","Simisear","Panpour","Simipour","Munna","Musharna","Pidove","Tranquill","Unfezant","Blitzle","Zebstrika","Roggenrola","Boldore","Gigalith","Woobat","Swoobat","Drilbur","Excadrill","Audino","Timburr","Gurdurr","Conkeldurr","Tympole","Palpitoad","Seismitoad","Throh","Sawk","Sewaddle","Swadloon","Leavanny","Venipede","Whirlipede","Scolipede","Cottonee","Whimsicott","Petilil","Lilligant","Basculin","Sandile","Krokorok","Krookodile","Darumaka","Darmanitan","Maractus","Dwebble","Crustle","Scraggy","Scrafty","Sigilyph","Yamask","Cofagrigus","Tirtouga","Carracosta","Archen","Archeops","Trubbish","Garbodor","Zorua","Zoroark","Minccino","Cinccino","Gothita","Gothorita","Gothitelle","Solosis","Duosion","Reuniclus","Ducklett","Swanna","Vanillite","Vanillish","Vanilluxe","Deerling","Sawsbuck","Emolga","Karrablast","Escavalier","Foongus","Amoonguss","Frillish","Jellicent","Alomomola","Joltik","Galvantula","Ferroseed","Ferrothorn","Klink","Klang","Klinklang","Tynamo","Eelektrik","Eelektross","Elgyem","Beheeyem","Litwick","Lampent","Chandelure","Axew","Fraxure","Haxorus","Cubchoo","Beartic","Cryogonal","Shelmet","Accelgor","Stunfisk","Mienfoo","Mienshao","Druddigon","Golett","Golurk","Pawniard","Bisharp","Bouffalant","Rufflet","Braviary","Vullaby","Mandibuzz","Heatmor","Durant","Deino","Zweilous","Hydreigon","Larvesta","Volcarona","Cobalion","Terrakion","Virizion","Tornadus","Thundurus","Reshiram","Zekrom","Landorus","Kyurem","Keldeo","Meloetta","Genesect","Chespin","Quilladin","Chesnaught","Fennekin","Braixen","Delphox","Froakie","Frogadier","Greninja","Bunnelby","Diggersby","Fletchling","Fletchinder","Talonflame","Scatterbug","Spewpa","Vivillon","Litleo","Pyroar","Flabebe","Floette","Florges","Skiddo","Gogoat","Pancham","Pangoro","Furfrou","Espurr","Meowstic","Honedge","Doublade","Aegislash","Spritzee","Aromatisse","Swirlix","Slurpuff","Inkay","Malamar","Binacle","Barbaracle","Skrelp","Dragalge","Clauncher","Clawitzer","Helioptile","Heliolisk","Tyrunt","Tyrantrum","Amaura","Aurorus","Sylveon","Hawlucha","Dedenne","Carbink","Goomy","Sliggoo","Goodra","Klefki","Phantump","Trevenant","Pumpkaboo","Gourgeist","Bergmite","Avalugg","Noibat","Noivern","Xerneas","Yveltal","Zygarde","Diancie","Hoopa","Volcanion","Rowlet","Dartrix","Decidueye","Litten","Torracat","Incineroar","Popplio","Brionne","Primarina","Pikipek","Trumbeak","Toucannon","Yungoos","Gumshoos","Grubbin","Charjabug","Vikavolt","Crabrawler","Crabominable","Oricorio","Cutiefly","Ribombee","Rockruff","Lycanroc","Wishiwashi","Mareanie","Toxapex","Mudbray","Mudsdale","Dewpider","Araquanid","Fomantis","Lurantis","Morelull","Shiinotic","Salandit","Salazzle","Stufful","Bewear","Bounsweet","Steenee","Tsareena","Comfey","Oranguru","Passimian","Wimpod","Golisopod","Sandygast","Palossand","Pyukumuku","Type: Null","Silvally","Minior","Komala","Turtonator","Togedemaru","Mimikyu","Bruxish","Drampa","Dhelmise","Jangmo-o","Hakamo-o","Kommo-o","Tapu Koko","Tapu Lele","Tapu Bulu","Tapu Fini","Cosmog","Cosmoem","Solgaleo","Lunala","Nihilego","Buzzwole","Pheromosa","Xurkitree","Celesteela","Kartana","Guzzlord","Necrozma","Magearna","Marshadow","Poipole","Naganadel","Stakataka","Blacephalon","Zeraora","Meltan","Melmetal"]},{}],421:[function(require,module,exports){"use strict";const uniqueRandomArray=require("unique-random-array"),pokemon=require("./data/en.json"),repositoryUrl="https://github.com/sindresorhus/pokemon",reportText=`Please report to ${repositoryUrl}/issues if we missed something.`,languages=new Set(["de","en","fr","ja","ko","ru","zh-Hans","zh-Hant"]),randomNameGenerators=new Map;function getLocalizedList(language="en"){if("en"===language)return pokemon;if(!languages.has(language))throw new Error(`Localized list for language code '${language}' does not exist. Pull request welcome: ${repositoryUrl}`);return require(`./data/${language.toLowerCase()}.json`)}exports.all=getLocalizedList,exports.random=(language="en")=>{if(randomNameGenerators.has(language))return randomNameGenerators.get(language)();const list=getLocalizedList(language),random=uniqueRandomArray(list);return randomNameGenerators.set(language,random),random()},exports.getName=(id,language="en")=>{const list=getLocalizedList(language),name=list[id-1];if(!name)throw new Error(`Pokmon with ID '${id}' does not exist. ${reportText}`);return name},exports.getId=(name,language="en")=>{const list=getLocalizedList(language),index=list.indexOf(name);if(-1===index)throw new Error(`Pokmon with name '${name}' does not exist for language code '${language}'. ${reportText}`);return index+1},exports.languages=languages},{"./data/en.json":420,"unique-random-array":589}],422:[function(require,module,exports){var process=module.exports={},cachedSetTimeout,cachedClearTimeout;function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(fun){if(cachedSetTimeout===setTimeout)return setTimeout(fun,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(fun,0);try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}function runClearTimeout(marker){if(cachedClearTimeout===clearTimeout)return clearTimeout(marker);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(marker);try{return cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}!function(){try{cachedSetTimeout="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(e){cachedSetTimeout=defaultSetTimout}try{cachedClearTimeout="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(e){cachedClearTimeout=defaultClearTimeout}}();var queue=[],draining=!1,currentQueue,queueIndex=-1;function cleanUpNextTick(){draining&&currentQueue&&(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var timeout=runTimeout(cleanUpNextTick);draining=!0;for(var len=queue.length;len;){for(currentQueue=queue,queue=[];++queueIndex<len;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,len=queue.length}currentQueue=null,draining=!1,runClearTimeout(timeout)}}function Item(fun,array){this.fun=fun,this.array=array}function noop(){}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)args[i-1]=arguments[i];queue.push(new Item(fun,args)),1!==queue.length||draining||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},process.title="browser",process.browser=!0,process.env={},process.argv=[],process.version="",process.versions={},process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.prependListener=noop,process.prependOnceListener=noop,process.listeners=function(name){return[]},process.binding=function(name){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(dir){throw new Error("process.chdir is not supported")},process.umask=function(){return 0}},{}],423:[function(require,module,exports){"use strict";var printWarning=function(){},ReactPropTypesSecret=require("./lib/ReactPropTypesSecret"),loggedTypeFailures={},has=Function.call.bind(Object.prototype.hasOwnProperty);function checkPropTypes(typeSpecs,values,location,componentName,getStack){for(var typeSpecName in typeSpecs)if(has(typeSpecs,typeSpecName)){var error;try{if("function"!=typeof typeSpecs[typeSpecName]){var err=Error((componentName||"React class")+": "+location+" type `"+typeSpecName+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof typeSpecs[typeSpecName]+"`.");throw err.name="Invariant Violation",err}error=typeSpecs[typeSpecName](values,typeSpecName,componentName,location,null,ReactPropTypesSecret)}catch(ex){error=ex}if(!error||error instanceof Error||printWarning((componentName||"React class")+": type specification of "+location+" `"+typeSpecName+"` is invalid; the type checker function must return `null` or an `Error` but returned a "+typeof error+". You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument)."),error instanceof Error&&!(error.message in loggedTypeFailures)){loggedTypeFailures[error.message]=!0;var stack=getStack?getStack():"";printWarning("Failed "+location+" type: "+error.message+(null!=stack?stack:""))}}}printWarning=function(text){var message="Warning: "+text;"undefined"!=typeof console&&console.error(message);try{throw new Error(message)}catch(x){}},checkPropTypes.resetWarningCache=function(){loggedTypeFailures={}},module.exports=checkPropTypes},{"./lib/ReactPropTypesSecret":427}],424:[function(require,module,exports){"use strict";var ReactPropTypesSecret=require("./lib/ReactPropTypesSecret");function emptyFunction(){}function emptyFunctionWithReset(){}emptyFunctionWithReset.resetWarningCache=emptyFunction,module.exports=function(){function shim(props,propName,componentName,location,propFullName,secret){if(secret!==ReactPropTypesSecret){var err=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw err.name="Invariant Violation",err}}function getShim(){return shim}shim.isRequired=shim;var ReactPropTypes={array:shim,bool:shim,func:shim,number:shim,object:shim,string:shim,symbol:shim,any:shim,arrayOf:getShim,element:shim,elementType:shim,instanceOf:getShim,node:shim,objectOf:getShim,oneOf:getShim,oneOfType:getShim,shape:getShim,exact:getShim,checkPropTypes:emptyFunctionWithReset,resetWarningCache:emptyFunction};return ReactPropTypes.PropTypes=ReactPropTypes,ReactPropTypes}},{"./lib/ReactPropTypesSecret":427}],425:[function(require,module,exports){"use strict";var ReactIs=require("react-is"),assign=require("object-assign"),ReactPropTypesSecret=require("./lib/ReactPropTypesSecret"),checkPropTypes=require("./checkPropTypes"),has=Function.call.bind(Object.prototype.hasOwnProperty),printWarning=function(){};function emptyFunctionThatReturnsNull(){return null}printWarning=function(text){var message="Warning: "+text;"undefined"!=typeof console&&console.error(message);try{throw new Error(message)}catch(x){}},module.exports=function(isValidElement,throwOnDirectAccess){var ITERATOR_SYMBOL="function"==typeof Symbol&&Symbol.iterator,FAUX_ITERATOR_SYMBOL="@@iterator";function getIteratorFn(maybeIterable){var iteratorFn=maybeIterable&&(ITERATOR_SYMBOL&&maybeIterable[ITERATOR_SYMBOL]||maybeIterable["@@iterator"]);if("function"==typeof iteratorFn)return iteratorFn}var ANONYMOUS="<<anonymous>>",ReactPropTypes={array:createPrimitiveTypeChecker("array"),bool:createPrimitiveTypeChecker("boolean"),func:createPrimitiveTypeChecker("function"),number:createPrimitiveTypeChecker("number"),object:createPrimitiveTypeChecker("object"),string:createPrimitiveTypeChecker("string"),symbol:createPrimitiveTypeChecker("symbol"),any:createAnyTypeChecker(),arrayOf:createArrayOfTypeChecker,element:createElementTypeChecker(),elementType:createElementTypeTypeChecker(),instanceOf:createInstanceTypeChecker,node:createNodeChecker(),objectOf:createObjectOfTypeChecker,oneOf:createEnumTypeChecker,oneOfType:createUnionTypeChecker,shape:createShapeTypeChecker,exact:createStrictShapeTypeChecker};function is(x,y){return x===y?0!==x||1/x==1/y:x!=x&&y!=y}function PropTypeError(message){this.message=message,this.stack=""}function createChainableTypeChecker(validate){var manualPropTypeCallCache={},manualPropTypeWarningCount=0;function checkType(isRequired,props,propName,componentName,location,propFullName,secret){if(componentName=componentName||ANONYMOUS,propFullName=propFullName||propName,secret!==ReactPropTypesSecret){if(throwOnDirectAccess){var err=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use `PropTypes.checkPropTypes()` to call them. Read more at http://fb.me/use-check-prop-types");throw err.name="Invariant Violation",err}if("undefined"!=typeof console){var cacheKey=componentName+":"+propName;!manualPropTypeCallCache[cacheKey]&&manualPropTypeWarningCount<3&&(printWarning("You are manually calling a React.PropTypes validation function for the `"+propFullName+"` prop on `"+componentName+"`. This is deprecated and will throw in the standalone `prop-types` package. You may be seeing this warning due to a third-party PropTypes library. See https://fb.me/react-warning-dont-call-proptypes for details."),manualPropTypeCallCache[cacheKey]=!0,manualPropTypeWarningCount++)}}return null==props[propName]?isRequired?null===props[propName]?new PropTypeError("The "+location+" `"+propFullName+"` is marked as required in `"+componentName+"`, but its value is `null`."):new PropTypeError("The "+location+" `"+propFullName+"` is marked as required in `"+componentName+"`, but its value is `undefined`."):null:validate(props,propName,componentName,location,propFullName)}var chainedCheckType=checkType.bind(null,!1);return chainedCheckType.isRequired=checkType.bind(null,!0),chainedCheckType}function createPrimitiveTypeChecker(expectedType){function validate(props,propName,componentName,location,propFullName,secret){var propValue=props[propName],propType,preciseType;return getPropType(propValue)!==expectedType?new PropTypeError("Invalid "+location+" `"+propFullName+"` of type `"+getPreciseType(propValue)+"` supplied to `"+componentName+"`, expected `"+expectedType+"`."):null}return createChainableTypeChecker(validate)}function createAnyTypeChecker(){return createChainableTypeChecker(emptyFunctionThatReturnsNull)}function createArrayOfTypeChecker(typeChecker){function validate(props,propName,componentName,location,propFullName){if("function"!=typeof typeChecker)return new PropTypeError("Property `"+propFullName+"` of component `"+componentName+"` has invalid PropType notation inside arrayOf.");var propValue=props[propName],propType;if(!Array.isArray(propValue))return new PropTypeError("Invalid "+location+" `"+propFullName+"` of type `"+getPropType(propValue)+"` supplied to `"+componentName+"`, expected an array.");for(var i=0;i<propValue.length;i++){var error=typeChecker(propValue,i,componentName,location,propFullName+"["+i+"]",ReactPropTypesSecret);if(error instanceof Error)return error}return null}return createChainableTypeChecker(validate)}function createElementTypeChecker(){function validate(props,propName,componentName,location,propFullName){var propValue=props[propName],propType;return isValidElement(propValue)?null:new PropTypeError("Invalid "+location+" `"+propFullName+"` of type `"+getPropType(propValue)+"` supplied to `"+componentName+"`, expected a single ReactElement.")}return createChainableTypeChecker(validate)}function createElementTypeTypeChecker(){function validate(props,propName,componentName,location,propFullName){var propValue=props[propName],propType;return ReactIs.isValidElementType(propValue)?null:new PropTypeError("Invalid "+location+" `"+propFullName+"` of type `"+getPropType(propValue)+"` supplied to `"+componentName+"`, expected a single ReactElement type.")}return createChainableTypeChecker(validate)}function createInstanceTypeChecker(expectedClass){function validate(props,propName,componentName,location,propFullName){if(!(props[propName]instanceof expectedClass)){var expectedClassName=expectedClass.name||ANONYMOUS,actualClassName;return new PropTypeError("Invalid "+location+" `"+propFullName+"` of type `"+getClassName(props[propName])+"` supplied to `"+componentName+"`, expected instance of `"+expectedClassName+"`.")}return null}return createChainableTypeChecker(validate)}function createEnumTypeChecker(expectedValues){if(!Array.isArray(expectedValues))return arguments.length>1?printWarning("Invalid arguments supplied to oneOf, expected an array, got "+arguments.length+" arguments. A common mistake is to write oneOf(x, y, z) instead of oneOf([x, y, z])."):printWarning("Invalid argument supplied to oneOf, expected an array."),emptyFunctionThatReturnsNull;function validate(props,propName,componentName,location,propFullName){for(var propValue=props[propName],i=0;i<expectedValues.length;i++)if(is(propValue,expectedValues[i]))return null;var valuesString=JSON.stringify(expectedValues,(function replacer(key,value){var type;return"symbol"===getPreciseType(value)?String(value):value}));return new PropTypeError("Invalid "+location+" `"+propFullName+"` of value `"+String(propValue)+"` supplied to `"+componentName+"`, expected one of "+valuesString+".")}return createChainableTypeChecker(validate)}function createObjectOfTypeChecker(typeChecker){function validate(props,propName,componentName,location,propFullName){if("function"!=typeof typeChecker)return new PropTypeError("Property `"+propFullName+"` of component `"+componentName+"` has invalid PropType notation inside objectOf.");var propValue=props[propName],propType=getPropType(propValue);if("object"!==propType)return new PropTypeError("Invalid "+location+" `"+propFullName+"` of type `"+propType+"` supplied to `"+componentName+"`, expected an object.");for(var key in propValue)if(has(propValue,key)){var error=typeChecker(propValue,key,componentName,location,propFullName+"."+key,ReactPropTypesSecret);if(error instanceof Error)return error}return null}return createChainableTypeChecker(validate)}function createUnionTypeChecker(arrayOfTypeCheckers){if(!Array.isArray(arrayOfTypeCheckers))return printWarning("Invalid argument supplied to oneOfType, expected an instance of array."),emptyFunctionThatReturnsNull;for(var i=0;i<arrayOfTypeCheckers.length;i++){var checker=arrayOfTypeCheckers[i];if("function"!=typeof checker)return printWarning("Invalid argument supplied to oneOfType. Expected an array of check functions, but received "+getPostfixForTypeWarning(checker)+" at index "+i+"."),emptyFunctionThatReturnsNull}function validate(props,propName,componentName,location,propFullName){for(var i=0;i<arrayOfTypeCheckers.length;i++){var checker;if(null==(0,arrayOfTypeCheckers[i])(props,propName,componentName,location,propFullName,ReactPropTypesSecret))return null}return new PropTypeError("Invalid "+location+" `"+propFullName+"` supplied to `"+componentName+"`.")}return createChainableTypeChecker(validate)}function createNodeChecker(){function validate(props,propName,componentName,location,propFullName){return isNode(props[propName])?null:new PropTypeError("Invalid "+location+" `"+propFullName+"` supplied to `"+componentName+"`, expected a ReactNode.")}return createChainableTypeChecker(validate)}function createShapeTypeChecker(shapeTypes){function validate(props,propName,componentName,location,propFullName){var propValue=props[propName],propType=getPropType(propValue);if("object"!==propType)return new PropTypeError("Invalid "+location+" `"+propFullName+"` of type `"+propType+"` supplied to `"+componentName+"`, expected `object`.");for(var key in shapeTypes){var checker=shapeTypes[key];if(checker){var error=checker(propValue,key,componentName,location,propFullName+"."+key,ReactPropTypesSecret);if(error)return error}}return null}return createChainableTypeChecker(validate)}function createStrictShapeTypeChecker(shapeTypes){function validate(props,propName,componentName,location,propFullName){var propValue=props[propName],propType=getPropType(propValue);if("object"!==propType)return new PropTypeError("Invalid "+location+" `"+propFullName+"` of type `"+propType+"` supplied to `"+componentName+"`, expected `object`.");var allKeys=assign({},props[propName],shapeTypes);for(var key in allKeys){var checker=shapeTypes[key];if(!checker)return new PropTypeError("Invalid "+location+" `"+propFullName+"` key `"+key+"` supplied to `"+componentName+"`.\nBad object: "+JSON.stringify(props[propName],null,"  ")+"\nValid keys: "+JSON.stringify(Object.keys(shapeTypes),null,"  "));var error=checker(propValue,key,componentName,location,propFullName+"."+key,ReactPropTypesSecret);if(error)return error}return null}return createChainableTypeChecker(validate)}function isNode(propValue){switch(typeof propValue){case"number":case"string":case"undefined":return!0;case"boolean":return!propValue;case"object":if(Array.isArray(propValue))return propValue.every(isNode);if(null===propValue||isValidElement(propValue))return!0;var iteratorFn=getIteratorFn(propValue);if(!iteratorFn)return!1;var iterator=iteratorFn.call(propValue),step;if(iteratorFn!==propValue.entries){for(;!(step=iterator.next()).done;)if(!isNode(step.value))return!1}else for(;!(step=iterator.next()).done;){var entry=step.value;if(entry&&!isNode(entry[1]))return!1}return!0;default:return!1}}function isSymbol(propType,propValue){return"symbol"===propType||!!propValue&&("Symbol"===propValue["@@toStringTag"]||"function"==typeof Symbol&&propValue instanceof Symbol)}function getPropType(propValue){var propType=typeof propValue;return Array.isArray(propValue)?"array":propValue instanceof RegExp?"object":isSymbol(propType,propValue)?"symbol":propType}function getPreciseType(propValue){if(null==propValue)return""+propValue;var propType=getPropType(propValue);if("object"===propType){if(propValue instanceof Date)return"date";if(propValue instanceof RegExp)return"regexp"}return propType}function getPostfixForTypeWarning(value){var type=getPreciseType(value);switch(type){case"array":case"object":return"an "+type;case"boolean":case"date":case"regexp":return"a "+type;default:return type}}function getClassName(propValue){return propValue.constructor&&propValue.constructor.name?propValue.constructor.name:ANONYMOUS}return PropTypeError.prototype=Error.prototype,ReactPropTypes.checkPropTypes=checkPropTypes,ReactPropTypes.resetWarningCache=checkPropTypes.resetWarningCache,ReactPropTypes.PropTypes=ReactPropTypes,ReactPropTypes}},{"./checkPropTypes":423,"./lib/ReactPropTypesSecret":427,"object-assign":419,"react-is":444}],426:[function(require,module,exports){var ReactIs=require("react-is"),throwOnDirectAccess=!0;module.exports=require("./factoryWithTypeCheckers")(ReactIs.isElement,!0)},{"./factoryWithThrowingShims":424,"./factoryWithTypeCheckers":425,"react-is":444}],427:[function(require,module,exports){"use strict";var ReactPropTypesSecret="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";module.exports=ReactPropTypesSecret},{}],428:[function(require,module,exports){const{EventEmitter:EventEmitter}=require("events"),Logger=require("./Logger");class EnhancedEventEmitter extends EventEmitter{constructor(logger){super(),this.setMaxListeners(1/0),this._logger=logger||new Logger("EnhancedEventEmitter")}safeEmit(event,...args){try{this.emit(event,...args)}catch(error){this._logger.error("safeEmit() | event listener threw an error [event:%s]:%o",event,error)}}async safeEmitAsPromise(event,...args){return new Promise((resolve,reject)=>{this.safeEmit(event,...args,resolve,reject)})}}module.exports=EnhancedEventEmitter},{"./Logger":429,events:256}],429:[function(require,module,exports){const debug=require("debug"),APP_NAME="protoo-client";class Logger{constructor(prefix){prefix?(this._debug=debug(`${APP_NAME}:${prefix}`),this._warn=debug(`${APP_NAME}:WARN:${prefix}`),this._error=debug(`${APP_NAME}:ERROR:${prefix}`)):(this._debug=debug(APP_NAME),this._warn=debug(`${APP_NAME}:WARN`),this._error=debug(`${APP_NAME}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}}module.exports=Logger},{debug:260}],430:[function(require,module,exports){const Logger=require("./Logger"),{generateRandomNumber:generateRandomNumber}=require("./utils"),logger=new Logger("Message");class Message{static parse(raw){let object;const message={};try{object=JSON.parse(raw)}catch(error){return void logger.error("parse() | invalid JSON: %s",error)}if("object"==typeof object&&!Array.isArray(object)){if(object.request){if(message.request=!0,"string"!=typeof object.method)return void logger.error("parse() | missing/invalid method field");if("number"!=typeof object.id)return void logger.error("parse() | missing/invalid id field");message.id=object.id,message.method=object.method,message.data=object.data||{}}else if(object.response){if(message.response=!0,"number"!=typeof object.id)return void logger.error("parse() | missing/invalid id field");message.id=object.id,object.ok?(message.ok=!0,message.data=object.data||{}):(message.ok=!1,message.errorCode=object.errorCode,message.errorReason=object.errorReason)}else{if(!object.notification)return void logger.error("parse() | missing request/response field");if(message.notification=!0,"string"!=typeof object.method)return void logger.error("parse() | missing/invalid method field");message.method=object.method,message.data=object.data||{}}return message}logger.error("parse() | not an object")}static createRequest(method,data){const request={request:!0,id:generateRandomNumber(),method:method,data:data||{}};return request}static createSuccessResponse(request,data){const response={response:!0,id:request.id,ok:!0,data:data||{}};return response}static createErrorResponse(request,errorCode,errorReason){const response={response:!0,id:request.id,ok:!1,errorCode:errorCode,errorReason:errorReason};return response}static createNotification(method,data){const notification={notification:!0,method:method,data:data||{}};return notification}}module.exports=Message},{"./Logger":429,"./utils":434}],431:[function(require,module,exports){const Logger=require("./Logger"),EnhancedEventEmitter=require("./EnhancedEventEmitter"),Message=require("./Message"),logger=new Logger("Peer");class Peer extends EnhancedEventEmitter{constructor(transport){super(logger),logger.debug("constructor()"),this._closed=!1,this._transport=transport,this._connected=!1,this._data={},this._sents=new Map,this._handleTransport()}get closed(){return this._closed}get connected(){return this._connected}get data(){return this._data}set data(data){throw new Error("cannot override data object")}close(){if(!this._closed){logger.debug("close()"),this._closed=!0,this._connected=!1,this._transport.close();for(const sent of this._sents.values())sent.close();this.safeEmit("close")}}async request(method,data){const request=Message.createRequest(method,data);return this._logger.debug("request() [method:%s, id:%s]",method,request.id),await this._transport.send(request),new Promise((pResolve,pReject)=>{const timeout=1500*(15+.1*this._sents.size),sent={id:request.id,method:request.method,resolve:data2=>{this._sents.delete(request.id)&&(clearTimeout(sent.timer),pResolve(data2))},reject:error=>{this._sents.delete(request.id)&&(clearTimeout(sent.timer),pReject(error))},timer:setTimeout(()=>{this._sents.delete(request.id)&&pReject(new Error("request timeout"))},timeout),close:()=>{clearTimeout(sent.timer),pReject(new Error("peer closed"))}};this._sents.set(request.id,sent)})}async notify(method,data){const notification=Message.createNotification(method,data);this._logger.debug("notify() [method:%s]",method),await this._transport.send(notification)}_handleTransport(){if(this._transport.closed)return this._closed=!0,void setTimeout(()=>{this._closed||(this._connected=!1,this.safeEmit("close"))});this._transport.on("open",()=>{this._closed||(logger.debug('emit "open"'),this._connected=!0,this.safeEmit("open"))}),this._transport.on("disconnected",()=>{this._closed||(logger.debug('emit "disconnected"'),this._connected=!1,this.safeEmit("disconnected"))}),this._transport.on("failed",currentAttempt=>{this._closed||(logger.debug('emit "failed" [currentAttempt:%s]',currentAttempt),this._connected=!1,this.safeEmit("failed",currentAttempt))}),this._transport.on("close",()=>{this._closed||(this._closed=!0,logger.debug('emit "close"'),this._connected=!1,this.safeEmit("close"))}),this._transport.on("message",message=>{message.request?this._handleRequest(message):message.response?this._handleResponse(message):message.notification&&this._handleNotification(message)})}_handleRequest(request){try{this.emit("request",request,data=>{const response=Message.createSuccessResponse(request,data);this._transport.send(response).catch(()=>{})},(errorCode,errorReason)=>{errorCode instanceof Error?(errorReason=errorCode.message,errorCode=500):"number"==typeof errorCode&&errorReason instanceof Error&&(errorReason=errorReason.message);const response=Message.createErrorResponse(request,errorCode,errorReason);this._transport.send(response).catch(()=>{})})}catch(error){const response=Message.createErrorResponse(request,500,String(error));this._transport.send(response).catch(()=>{})}}_handleResponse(response){const sent=this._sents.get(response.id);if(sent)if(response.ok)sent.resolve(response.data);else{const error=new Error(response.errorReason);error.code=response.errorCode,sent.reject(error)}else logger.error("received response does not match any sent request [id:%s]",response.id)}_handleNotification(notification){this.safeEmit("notification",notification)}}module.exports=Peer},{"./EnhancedEventEmitter":428,"./Logger":429,"./Message":430}],432:[function(require,module,exports){const{version:version}=require("../package.json"),Peer=require("./Peer"),WebSocketTransport=require("./transports/WebSocketTransport");exports.version=version,exports.Peer=Peer,exports.WebSocketTransport=WebSocketTransport},{"../package.json":435,"./Peer":431,"./transports/WebSocketTransport":433}],433:[function(require,module,exports){const W3CWebSocket=require("websocket").w3cwebsocket,retry=require("retry"),Logger=require("../Logger"),EnhancedEventEmitter=require("../EnhancedEventEmitter"),Message=require("../Message"),WS_SUBPROTOCOL="protoo",DEFAULT_RETRY_OPTIONS={retries:10,factor:2,minTimeout:1e3,maxTimeout:8e3},logger=new Logger("WebSocketTransport");class WebSocketTransport extends EnhancedEventEmitter{constructor(url,options){super(logger),logger.debug("constructor() [url:%s, options:%o]",url,options),this._closed=!1,this._url=url,this._options=options||{},this._ws=null,this._runWebSocket()}get closed(){return this._closed}close(){if(!this._closed){logger.debug("close()"),this._closed=!0,this.safeEmit("close");try{this._ws.onopen=null,this._ws.onclose=null,this._ws.onerror=null,this._ws.onmessage=null,this._ws.close()}catch(error){logger.error("close() | error closing the WebSocket: %o",error)}}}async send(message){if(this._closed)throw new Error("transport closed");try{this._ws.send(JSON.stringify(message))}catch(error){throw logger.warn("send() failed:%o",error),error}}_runWebSocket(){const operation=retry.operation(this._options.retry||DEFAULT_RETRY_OPTIONS);let wasConnected=!1;operation.attempt(currentAttempt=>{this._closed?operation.stop():(logger.debug("_runWebSocket() [currentAttempt:%s]",currentAttempt),this._ws=new W3CWebSocket(this._url,"protoo",this._options.origin,this._options.headers,this._options.requestOptions,this._options.clientConfig),this._ws.onopen=()=>{this._closed||(wasConnected=!0,this.safeEmit("open"))},this._ws.onclose=event=>{if(!this._closed){if(logger.warn('WebSocket "close" event [wasClean:%s, code:%s, reason:"%s"]',event.wasClean,event.code,event.reason),4e3!==event.code){if(wasConnected){if(operation.stop(),this.safeEmit("disconnected"),this._closed)return;return void this._runWebSocket()}if(this.safeEmit("failed",currentAttempt),this._closed)return;if(operation.retry(!0))return}this._closed=!0,this.safeEmit("close")}},this._ws.onerror=()=>{this._closed||logger.error('WebSocket "error" event')},this._ws.onmessage=event=>{if(this._closed)return;const message=Message.parse(event.data);message&&(0!==this.listenerCount("message")?this.safeEmit("message",message):logger.error('no listeners for WebSocket "message" event, ignoring received message'))})})}}module.exports=WebSocketTransport},{"../EnhancedEventEmitter":428,"../Logger":429,"../Message":430,retry:488,websocket:592}],434:[function(require,module,exports){exports.generateRandomNumber=function(){return Math.round(1e7*Math.random())}},{}],435:[function(require,module,exports){module.exports={_from:"protoo-client@^4.0.5",_id:"protoo-client@4.0.6",_inBundle:!1,_integrity:"sha512-ZqImkKHpeJhSlgvyI6QAfZNc/aXcCgmmocMx4S1w2lAaxXtckxxeDtcVNtkOISUWm/mbC+BrmYPXoGMkfhkKOQ==",_location:"/protoo-client",_phantomChildren:{},_requested:{type:"range",registry:!0,raw:"protoo-client@^4.0.5",name:"protoo-client",escapedName:"protoo-client",rawSpec:"^4.0.5",saveSpec:null,fetchSpec:"^4.0.5"},_requiredBy:["/"],_resolved:"https://registry.npmjs.org/protoo-client/-/protoo-client-4.0.6.tgz",_shasum:"02a89f997ee5a4f385dab7be938dda1a2c5158e4",_spec:"protoo-client@^4.0.5",_where:"H:\\t\\mediasoap\\v1\\mediasoup-demo\\app",author:{name:"Iaki Baz Castillo",email:"ibc@aliax.net"},bugs:{url:"https://github.com/ibc/protoo/issues"},bundleDependencies:!1,dependencies:{debug:"^4.3.1",events:"^3.2.0",retry:"^0.12.0",websocket:"^1.0.33"},deprecated:!1,description:"protoo JavaScript client module",devDependencies:{eslint:"^5.16.0"},engines:{node:">=8.0.0"},homepage:"https://protoo.versatica.com",keywords:["nodejs","browser","websocket"],license:"MIT",main:"lib/index.js",name:"protoo-client",optionalDependencies:{websocket:"^1.0.33"},repository:{type:"git",url:"git+https://github.com/ibc/protoo.git"},scripts:{lint:"eslint -c .eslintrc.js lib"},version:"4.0.6"}},{}],436:[function(require,module,exports){"use strict";var has=Object.prototype.hasOwnProperty,undef;function decode(input){try{return decodeURIComponent(input.replace(/\+/g," "))}catch(e){return null}}function encode(input){try{return encodeURIComponent(input)}catch(e){return null}}function querystring(query){for(var parser=/([^=?#&]+)=?([^&]*)/g,result={},part;part=parser.exec(query);){var key=decode(part[1]),value=decode(part[2]);null===key||null===value||key in result||(result[key]=value)}return result}function querystringify(obj,prefix){prefix=prefix||"";var pairs=[],value,key;for(key in"string"!=typeof prefix&&(prefix="?"),obj)if(has.call(obj,key)){if((value=obj[key])||null!==value&&value!==undef&&!isNaN(value)||(value=""),key=encode(key),value=encode(value),null===key||null===value)continue;pairs.push(key+"="+value)}return pairs.length?prefix+pairs.join("&"):""}exports.stringify=querystringify,exports.parse=querystring},{}],437:[function(require,module,exports){"use strict";var numbers="0123456789",letters="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",specials="!$%^&*()_+|~-=`{}[]:;<>?,./";function _defaults(opts){return opts||(opts={}),{length:opts.length||8,numeric:"boolean"!=typeof opts.numeric||opts.numeric,letters:"boolean"!=typeof opts.letters||opts.letters,special:"boolean"==typeof opts.special&&opts.special,exclude:Array.isArray(opts.exclude)?opts.exclude:[]}}function _buildChars(opts){var chars="";opts.numeric&&(chars+=numbers),opts.letters&&(chars+=letters),opts.special&&(chars+=specials);for(var i=0;i<=opts.exclude.length;i++)chars=chars.replace(opts.exclude[i],"");return chars}module.exports=function randomString(opts){var i,rn,rnd="",len=(opts=_defaults(opts)).length,exclude=opts.exclude,randomChars=_buildChars(opts);for(i=1;i<=len;i++)rnd+=randomChars.substring(rn=Math.floor(Math.random()*randomChars.length),rn+1);return rnd}},{}],438:[function(require,module,exports){
/** @license React v16.14.0
 * react-dom.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
"use strict";(function(){var React=require("react"),_assign=require("object-assign"),Scheduler=require("scheduler"),checkPropTypes=require("prop-types/checkPropTypes"),tracing=require("scheduler/tracing"),ReactSharedInternals=React.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function warn(format){for(var _len=arguments.length,args=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)args[_key-1]=arguments[_key];printWarning("warn",format,args)}function error(format){for(var _len2=arguments.length,args=new Array(_len2>1?_len2-1:0),_key2=1;_key2<_len2;_key2++)args[_key2-1]=arguments[_key2];printWarning("error",format,args)}function printWarning(level,format,args){var hasExistingStack;if(!(args.length>0&&"string"==typeof args[args.length-1]&&0===args[args.length-1].indexOf("\n    in"))){var ReactDebugCurrentFrame,stack=ReactSharedInternals.ReactDebugCurrentFrame.getStackAddendum();""!==stack&&(format+="%s",args=args.concat([stack]))}var argsWithFormat=args.map((function(item){return""+item}));argsWithFormat.unshift("Warning: "+format),Function.prototype.apply.call(console[level],console,argsWithFormat);try{var argIndex=0,message="Warning: "+format.replace(/%s/g,(function(){return args[argIndex++]}));throw new Error(message)}catch(x){}}if(ReactSharedInternals.hasOwnProperty("ReactCurrentDispatcher")||(ReactSharedInternals.ReactCurrentDispatcher={current:null}),ReactSharedInternals.hasOwnProperty("ReactCurrentBatchConfig")||(ReactSharedInternals.ReactCurrentBatchConfig={suspense:null}),!React)throw Error("ReactDOM was loaded before React. Make sure you load the React package before loading ReactDOM.");var invokeGuardedCallbackImpl=function(name,func,context,a,b,c,d,e,f){var funcArgs=Array.prototype.slice.call(arguments,3);try{func.apply(context,funcArgs)}catch(error){this.onError(error)}};if("undefined"!=typeof window&&"function"==typeof window.dispatchEvent&&"undefined"!=typeof document&&"function"==typeof document.createEvent){var fakeNode=document.createElement("react"),invokeGuardedCallbackDev;invokeGuardedCallbackImpl=function(name,func,context,a,b,c,d,e,f){if("undefined"==typeof document)throw Error("The `document` global was defined when React was initialized, but is not defined anymore. This can happen in a test environment if a component schedules an update from an asynchronous callback, but the test has already finished running. To solve this, you can either unmount the component at the end of your test (and ensure that any asynchronous operations get canceled in `componentWillUnmount`), or you can change the test itself to be asynchronous.");var evt=document.createEvent("Event"),didError=!0,windowEvent=window.event,windowEventDescriptor=Object.getOwnPropertyDescriptor(window,"event"),funcArgs=Array.prototype.slice.call(arguments,3),error;function callCallback(){fakeNode.removeEventListener(evtType,callCallback,!1),void 0!==window.event&&window.hasOwnProperty("event")&&(window.event=windowEvent),func.apply(context,funcArgs),didError=!1}var didSetError=!1,isCrossOriginError=!1;function handleWindowError(event){if(error=event.error,didSetError=!0,null===error&&0===event.colno&&0===event.lineno&&(isCrossOriginError=!0),event.defaultPrevented&&null!=error&&"object"==typeof error)try{error._suppressLogging=!0}catch(inner){}}var evtType="react-"+(name||"invokeguardedcallback");window.addEventListener("error",handleWindowError),fakeNode.addEventListener(evtType,callCallback,!1),evt.initEvent(evtType,!1,!1),fakeNode.dispatchEvent(evt),windowEventDescriptor&&Object.defineProperty(window,"event",windowEventDescriptor),didError&&(didSetError?isCrossOriginError&&(error=new Error("A cross-origin error was thrown. React doesn't have access to the actual error object in development. See https://fb.me/react-crossorigin-error for more information.")):error=new Error("An error was thrown inside one of your components, but React doesn't know what it was. This is likely due to browser flakiness. React does its best to preserve the \"Pause on exceptions\" behavior of the DevTools, which requires some DEV-mode only tricks. It's possible that these don't work in your browser. Try triggering the error in production mode, or switching to a modern browser. If you suspect that this is actually an issue with React, please file an issue."),this.onError(error)),window.removeEventListener("error",handleWindowError)}}var invokeGuardedCallbackImpl$1=invokeGuardedCallbackImpl,hasError=!1,caughtError=null,hasRethrowError=!1,rethrowError=null,reporter={onError:function(error){hasError=!0,caughtError=error}};function invokeGuardedCallback(name,func,context,a,b,c,d,e,f){hasError=!1,caughtError=null,invokeGuardedCallbackImpl$1.apply(reporter,arguments)}function invokeGuardedCallbackAndCatchFirstError(name,func,context,a,b,c,d,e,f){if(invokeGuardedCallback.apply(this,arguments),hasError){var error=clearCaughtError();hasRethrowError||(hasRethrowError=!0,rethrowError=error)}}function rethrowCaughtError(){if(hasRethrowError){var error=rethrowError;throw hasRethrowError=!1,rethrowError=null,error}}function hasCaughtError(){return hasError}function clearCaughtError(){if(hasError){var error=caughtError;return hasError=!1,caughtError=null,error}throw Error("clearCaughtError was called but no error was captured. This error is likely caused by a bug in React. Please file an issue.")}var getFiberCurrentPropsFromNode=null,getInstanceFromNode=null,getNodeFromInstance=null,validateEventDispatches;function setComponentTree(getFiberCurrentPropsFromNodeImpl,getInstanceFromNodeImpl,getNodeFromInstanceImpl){getFiberCurrentPropsFromNode=getFiberCurrentPropsFromNodeImpl,getInstanceFromNode=getInstanceFromNodeImpl,(getNodeFromInstance=getNodeFromInstanceImpl)&&getInstanceFromNode||error("EventPluginUtils.setComponentTree(...): Injected module is missing getNodeFromInstance or getInstanceFromNode.")}function executeDispatch(event,listener,inst){var type=event.type||"unknown-event";event.currentTarget=getNodeFromInstance(inst),invokeGuardedCallbackAndCatchFirstError(type,listener,void 0,event),event.currentTarget=null}function executeDispatchesInOrder(event){var dispatchListeners=event._dispatchListeners,dispatchInstances=event._dispatchInstances;if(validateEventDispatches(event),Array.isArray(dispatchListeners))for(var i=0;i<dispatchListeners.length&&!event.isPropagationStopped();i++)executeDispatch(event,dispatchListeners[i],dispatchInstances[i]);else dispatchListeners&&executeDispatch(event,dispatchListeners,dispatchInstances);event._dispatchListeners=null,event._dispatchInstances=null}validateEventDispatches=function(event){var dispatchListeners=event._dispatchListeners,dispatchInstances=event._dispatchInstances,listenersIsArr=Array.isArray(dispatchListeners),listenersLen=listenersIsArr?dispatchListeners.length:dispatchListeners?1:0,instancesIsArr=Array.isArray(dispatchInstances),instancesLen=instancesIsArr?dispatchInstances.length:dispatchInstances?1:0;instancesIsArr===listenersIsArr&&instancesLen===listenersLen||error("EventPluginUtils: Invalid `event`.")};var FunctionComponent=0,ClassComponent=1,IndeterminateComponent=2,HostRoot=3,HostPortal=4,HostComponent=5,HostText=6,Fragment=7,Mode=8,ContextConsumer=9,ContextProvider=10,ForwardRef=11,Profiler=12,SuspenseComponent=13,MemoComponent=14,SimpleMemoComponent=15,LazyComponent=16,IncompleteClassComponent=17,DehydratedFragment=18,SuspenseListComponent=19,FundamentalComponent=20,ScopeComponent=21,Block=22,eventPluginOrder=null,namesToPlugins={};function recomputePluginOrdering(){if(eventPluginOrder)for(var pluginName in namesToPlugins){var pluginModule=namesToPlugins[pluginName],pluginIndex=eventPluginOrder.indexOf(pluginName);if(!(pluginIndex>-1))throw Error("EventPluginRegistry: Cannot inject event plugins that do not exist in the plugin ordering, `"+pluginName+"`.");if(!plugins[pluginIndex]){if(!pluginModule.extractEvents)throw Error("EventPluginRegistry: Event plugins must implement an `extractEvents` method, but `"+pluginName+"` does not.");plugins[pluginIndex]=pluginModule;var publishedEvents=pluginModule.eventTypes;for(var eventName in publishedEvents)if(!publishEventForPlugin(publishedEvents[eventName],pluginModule,eventName))throw Error("EventPluginRegistry: Failed to publish event `"+eventName+"` for plugin `"+pluginName+"`.")}}}function publishEventForPlugin(dispatchConfig,pluginModule,eventName){if(eventNameDispatchConfigs.hasOwnProperty(eventName))throw Error("EventPluginRegistry: More than one plugin attempted to publish the same event name, `"+eventName+"`.");eventNameDispatchConfigs[eventName]=dispatchConfig;var phasedRegistrationNames=dispatchConfig.phasedRegistrationNames;if(phasedRegistrationNames){for(var phaseName in phasedRegistrationNames){var phasedRegistrationName;if(phasedRegistrationNames.hasOwnProperty(phaseName))publishRegistrationName(phasedRegistrationNames[phaseName],pluginModule,eventName)}return!0}return!!dispatchConfig.registrationName&&(publishRegistrationName(dispatchConfig.registrationName,pluginModule,eventName),!0)}function publishRegistrationName(registrationName,pluginModule,eventName){if(registrationNameModules[registrationName])throw Error("EventPluginRegistry: More than one plugin attempted to publish the same registration name, `"+registrationName+"`.");registrationNameModules[registrationName]=pluginModule,registrationNameDependencies[registrationName]=pluginModule.eventTypes[eventName].dependencies;var lowerCasedName=registrationName.toLowerCase();possibleRegistrationNames[lowerCasedName]=registrationName,"onDoubleClick"===registrationName&&(possibleRegistrationNames.ondblclick=registrationName)}var plugins=[],eventNameDispatchConfigs={},registrationNameModules={},registrationNameDependencies={},possibleRegistrationNames={};function injectEventPluginOrder(injectedEventPluginOrder){if(eventPluginOrder)throw Error("EventPluginRegistry: Cannot inject event plugin ordering more than once. You are likely trying to load more than one copy of React.");eventPluginOrder=Array.prototype.slice.call(injectedEventPluginOrder),recomputePluginOrdering()}function injectEventPluginsByName(injectedNamesToPlugins){var isOrderingDirty=!1;for(var pluginName in injectedNamesToPlugins)if(injectedNamesToPlugins.hasOwnProperty(pluginName)){var pluginModule=injectedNamesToPlugins[pluginName];if(!namesToPlugins.hasOwnProperty(pluginName)||namesToPlugins[pluginName]!==pluginModule){if(namesToPlugins[pluginName])throw Error("EventPluginRegistry: Cannot inject two different event plugins using the same name, `"+pluginName+"`.");namesToPlugins[pluginName]=pluginModule,isOrderingDirty=!0}}isOrderingDirty&&recomputePluginOrdering()}var canUseDOM=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement),PLUGIN_EVENT_SYSTEM=1,IS_REPLAYED=32,IS_FIRST_ANCESTOR=64,restoreImpl=null,restoreTarget=null,restoreQueue=null;function restoreStateOfTarget(target){var internalInstance=getInstanceFromNode(target);if(internalInstance){if("function"!=typeof restoreImpl)throw Error("setRestoreImplementation() needs to be called to handle a target for controlled events. This error is likely caused by a bug in React. Please file an issue.");var stateNode=internalInstance.stateNode;if(stateNode){var _props=getFiberCurrentPropsFromNode(stateNode);restoreImpl(internalInstance.stateNode,internalInstance.type,_props)}}}function setRestoreImplementation(impl){restoreImpl=impl}function enqueueStateRestore(target){restoreTarget?restoreQueue?restoreQueue.push(target):restoreQueue=[target]:restoreTarget=target}function needsStateRestore(){return null!==restoreTarget||null!==restoreQueue}function restoreStateIfNeeded(){if(restoreTarget){var target=restoreTarget,queuedTargets=restoreQueue;if(restoreTarget=null,restoreQueue=null,restoreStateOfTarget(target),queuedTargets)for(var i=0;i<queuedTargets.length;i++)restoreStateOfTarget(queuedTargets[i])}}var enableProfilerTimer=!0,enableDeprecatedFlareAPI=!1,enableFundamentalAPI=!1,warnAboutStringRefs=!1,batchedUpdatesImpl=function(fn,bookkeeping){return fn(bookkeeping)},discreteUpdatesImpl=function(fn,a,b,c,d){return fn(a,b,c,d)},flushDiscreteUpdatesImpl=function(){},batchedEventUpdatesImpl=batchedUpdatesImpl,isInsideEventHandler=!1,isBatchingEventUpdates=!1;function finishEventHandler(){var controlledComponentsHavePendingUpdates;needsStateRestore()&&(flushDiscreteUpdatesImpl(),restoreStateIfNeeded())}function batchedUpdates(fn,bookkeeping){if(isInsideEventHandler)return fn(bookkeeping);isInsideEventHandler=!0;try{return batchedUpdatesImpl(fn,bookkeeping)}finally{isInsideEventHandler=!1,finishEventHandler()}}function batchedEventUpdates(fn,a,b){if(isBatchingEventUpdates)return fn(a,b);isBatchingEventUpdates=!0;try{return batchedEventUpdatesImpl(fn,a,b)}finally{isBatchingEventUpdates=!1,finishEventHandler()}}function discreteUpdates(fn,a,b,c,d){var prevIsInsideEventHandler=isInsideEventHandler;isInsideEventHandler=!0;try{return discreteUpdatesImpl(fn,a,b,c,d)}finally{(isInsideEventHandler=prevIsInsideEventHandler)||finishEventHandler()}}function flushDiscreteUpdatesIfNeeded(timeStamp){isInsideEventHandler||flushDiscreteUpdatesImpl()}function setBatchingImplementation(_batchedUpdatesImpl,_discreteUpdatesImpl,_flushDiscreteUpdatesImpl,_batchedEventUpdatesImpl){batchedUpdatesImpl=_batchedUpdatesImpl,discreteUpdatesImpl=_discreteUpdatesImpl,flushDiscreteUpdatesImpl=_flushDiscreteUpdatesImpl,batchedEventUpdatesImpl=_batchedEventUpdatesImpl}var DiscreteEvent=0,UserBlockingEvent=1,ContinuousEvent=2,RESERVED=0,STRING=1,BOOLEANISH_STRING=2,BOOLEAN=3,OVERLOADED_BOOLEAN=4,NUMERIC=5,POSITIVE_NUMERIC=6,ATTRIBUTE_NAME_START_CHAR=":A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",ATTRIBUTE_NAME_CHAR=ATTRIBUTE_NAME_START_CHAR+"\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040",ROOT_ATTRIBUTE_NAME="data-reactroot",VALID_ATTRIBUTE_NAME_REGEX=new RegExp("^["+ATTRIBUTE_NAME_START_CHAR+"]["+ATTRIBUTE_NAME_CHAR+"]*$"),hasOwnProperty=Object.prototype.hasOwnProperty,illegalAttributeNameCache={},validatedAttributeNameCache={};function isAttributeNameSafe(attributeName){return!!hasOwnProperty.call(validatedAttributeNameCache,attributeName)||!hasOwnProperty.call(illegalAttributeNameCache,attributeName)&&(VALID_ATTRIBUTE_NAME_REGEX.test(attributeName)?(validatedAttributeNameCache[attributeName]=!0,!0):(illegalAttributeNameCache[attributeName]=!0,error("Invalid attribute name: `%s`",attributeName),!1))}function shouldIgnoreAttribute(name,propertyInfo,isCustomComponentTag){return null!==propertyInfo?0===propertyInfo.type:!isCustomComponentTag&&(name.length>2&&("o"===name[0]||"O"===name[0])&&("n"===name[1]||"N"===name[1]))}function shouldRemoveAttributeWithWarning(name,value,propertyInfo,isCustomComponentTag){if(null!==propertyInfo&&0===propertyInfo.type)return!1;switch(typeof value){case"function":case"symbol":return!0;case"boolean":if(isCustomComponentTag)return!1;if(null!==propertyInfo)return!propertyInfo.acceptsBooleans;var prefix=name.toLowerCase().slice(0,5);return"data-"!==prefix&&"aria-"!==prefix;default:return!1}}function shouldRemoveAttribute(name,value,propertyInfo,isCustomComponentTag){if(null==value)return!0;if(shouldRemoveAttributeWithWarning(name,value,propertyInfo,isCustomComponentTag))return!0;if(isCustomComponentTag)return!1;if(null!==propertyInfo)switch(propertyInfo.type){case 3:return!value;case 4:return!1===value;case 5:return isNaN(value);case 6:return isNaN(value)||value<1}return!1}function getPropertyInfo(name){return properties.hasOwnProperty(name)?properties[name]:null}function PropertyInfoRecord(name,type,mustUseProperty,attributeName,attributeNamespace,sanitizeURL){this.acceptsBooleans=2===type||3===type||4===type,this.attributeName=attributeName,this.attributeNamespace=attributeNamespace,this.mustUseProperty=mustUseProperty,this.propertyName=name,this.type=type,this.sanitizeURL=sanitizeURL}var properties={},reservedProps;["children","dangerouslySetInnerHTML","defaultValue","defaultChecked","innerHTML","suppressContentEditableWarning","suppressHydrationWarning","style"].forEach((function(name){properties[name]=new PropertyInfoRecord(name,0,!1,name,null,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(_ref){var name=_ref[0],attributeName=_ref[1];properties[name]=new PropertyInfoRecord(name,1,!1,attributeName,null,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(name){properties[name]=new PropertyInfoRecord(name,2,!1,name.toLowerCase(),null,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(name){properties[name]=new PropertyInfoRecord(name,2,!1,name,null,!1)})),["allowFullScreen","async","autoFocus","autoPlay","controls","default","defer","disabled","disablePictureInPicture","formNoValidate","hidden","loop","noModule","noValidate","open","playsInline","readOnly","required","reversed","scoped","seamless","itemScope"].forEach((function(name){properties[name]=new PropertyInfoRecord(name,3,!1,name.toLowerCase(),null,!1)})),["checked","multiple","muted","selected"].forEach((function(name){properties[name]=new PropertyInfoRecord(name,3,!0,name,null,!1)})),["capture","download"].forEach((function(name){properties[name]=new PropertyInfoRecord(name,4,!1,name,null,!1)})),["cols","rows","size","span"].forEach((function(name){properties[name]=new PropertyInfoRecord(name,6,!1,name,null,!1)})),["rowSpan","start"].forEach((function(name){properties[name]=new PropertyInfoRecord(name,5,!1,name.toLowerCase(),null,!1)}));var CAMELIZE=/[\-\:]([a-z])/g,capitalize=function(token){return token[1].toUpperCase()};["accent-height","alignment-baseline","arabic-form","baseline-shift","cap-height","clip-path","clip-rule","color-interpolation","color-interpolation-filters","color-profile","color-rendering","dominant-baseline","enable-background","fill-opacity","fill-rule","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","glyph-name","glyph-orientation-horizontal","glyph-orientation-vertical","horiz-adv-x","horiz-origin-x","image-rendering","letter-spacing","lighting-color","marker-end","marker-mid","marker-start","overline-position","overline-thickness","paint-order","panose-1","pointer-events","rendering-intent","shape-rendering","stop-color","stop-opacity","strikethrough-position","strikethrough-thickness","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","text-anchor","text-decoration","text-rendering","underline-position","underline-thickness","unicode-bidi","unicode-range","units-per-em","v-alphabetic","v-hanging","v-ideographic","v-mathematical","vector-effect","vert-adv-y","vert-origin-x","vert-origin-y","word-spacing","writing-mode","xmlns:xlink","x-height"].forEach((function(attributeName){var name=attributeName.replace(CAMELIZE,capitalize);properties[name]=new PropertyInfoRecord(name,1,!1,attributeName,null,!1)})),["xlink:actuate","xlink:arcrole","xlink:role","xlink:show","xlink:title","xlink:type"].forEach((function(attributeName){var name=attributeName.replace(CAMELIZE,capitalize);properties[name]=new PropertyInfoRecord(name,1,!1,attributeName,"http://www.w3.org/1999/xlink",!1)})),["xml:base","xml:lang","xml:space"].forEach((function(attributeName){var name=attributeName.replace(CAMELIZE,capitalize);properties[name]=new PropertyInfoRecord(name,1,!1,attributeName,"http://www.w3.org/XML/1998/namespace",!1)})),["tabIndex","crossOrigin"].forEach((function(attributeName){properties[attributeName]=new PropertyInfoRecord(attributeName,1,!1,attributeName.toLowerCase(),null,!1)}));var xlinkHref="xlinkHref";properties.xlinkHref=new PropertyInfoRecord("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0),["src","href","action","formAction"].forEach((function(attributeName){properties[attributeName]=new PropertyInfoRecord(attributeName,1,!1,attributeName.toLowerCase(),null,!0)}));var ReactDebugCurrentFrame=null;ReactDebugCurrentFrame=ReactSharedInternals.ReactDebugCurrentFrame;var isJavaScriptProtocol=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*\:/i,didWarn=!1;function sanitizeURL(url){!didWarn&&isJavaScriptProtocol.test(url)&&(didWarn=!0,error("A future version of React will block javascript: URLs as a security precaution. Use event handlers instead if you can. If you need to generate unsafe HTML try using dangerouslySetInnerHTML instead. React was passed %s.",JSON.stringify(url)))}function getValueForProperty(node,name,expected,propertyInfo){var propertyName;if(propertyInfo.mustUseProperty)return node[propertyInfo.propertyName];propertyInfo.sanitizeURL&&sanitizeURL(""+expected);var attributeName=propertyInfo.attributeName,stringValue=null;if(4===propertyInfo.type){if(node.hasAttribute(attributeName)){var value=node.getAttribute(attributeName);return""===value||(shouldRemoveAttribute(name,expected,propertyInfo,!1)?value:value===""+expected?expected:value)}}else if(node.hasAttribute(attributeName)){if(shouldRemoveAttribute(name,expected,propertyInfo,!1))return node.getAttribute(attributeName);if(3===propertyInfo.type)return expected;stringValue=node.getAttribute(attributeName)}return shouldRemoveAttribute(name,expected,propertyInfo,!1)?null===stringValue?expected:stringValue:stringValue===""+expected?expected:stringValue}function getValueForAttribute(node,name,expected){if(isAttributeNameSafe(name)){if(!node.hasAttribute(name))return void 0===expected?void 0:null;var value=node.getAttribute(name);return value===""+expected?expected:value}}function setValueForProperty(node,name,value,isCustomComponentTag){var propertyInfo=getPropertyInfo(name),mustUseProperty;if(!shouldIgnoreAttribute(name,propertyInfo,isCustomComponentTag))if(shouldRemoveAttribute(name,value,propertyInfo,isCustomComponentTag)&&(value=null),isCustomComponentTag||null===propertyInfo){if(isAttributeNameSafe(name)){var _attributeName=name;null===value?node.removeAttribute(_attributeName):node.setAttribute(_attributeName,""+value)}}else if(propertyInfo.mustUseProperty){var propertyName=propertyInfo.propertyName;if(null===value){var type=propertyInfo.type;node[propertyName]=3!==type&&""}else node[propertyName]=value}else{var attributeName=propertyInfo.attributeName,attributeNamespace=propertyInfo.attributeNamespace;if(null===value)node.removeAttribute(attributeName);else{var _type=propertyInfo.type,attributeValue;3===_type||4===_type&&!0===value?attributeValue="":(attributeValue=""+value,propertyInfo.sanitizeURL&&sanitizeURL(attributeValue.toString())),attributeNamespace?node.setAttributeNS(attributeNamespace,attributeName,attributeValue):node.setAttribute(attributeName,attributeValue)}}}var BEFORE_SLASH_RE=/^(.*)[\\\/]/;function describeComponentFrame(name,source,ownerName){var sourceInfo="";if(source){var path=source.fileName,fileName=path.replace(BEFORE_SLASH_RE,"");if(/^index\./.test(fileName)){var match=path.match(BEFORE_SLASH_RE);if(match){var pathBeforeSlash=match[1],folderName;if(pathBeforeSlash)fileName=pathBeforeSlash.replace(BEFORE_SLASH_RE,"")+"/"+fileName}}sourceInfo=" (at "+fileName+":"+source.lineNumber+")"}else ownerName&&(sourceInfo=" (created by "+ownerName+")");return"\n    in "+(name||"Unknown")+sourceInfo}var hasSymbol="function"==typeof Symbol&&Symbol.for,REACT_ELEMENT_TYPE=hasSymbol?Symbol.for("react.element"):60103,REACT_PORTAL_TYPE=hasSymbol?Symbol.for("react.portal"):60106,REACT_FRAGMENT_TYPE=hasSymbol?Symbol.for("react.fragment"):60107,REACT_STRICT_MODE_TYPE=hasSymbol?Symbol.for("react.strict_mode"):60108,REACT_PROFILER_TYPE=hasSymbol?Symbol.for("react.profiler"):60114,REACT_PROVIDER_TYPE=hasSymbol?Symbol.for("react.provider"):60109,REACT_CONTEXT_TYPE=hasSymbol?Symbol.for("react.context"):60110,REACT_CONCURRENT_MODE_TYPE=hasSymbol?Symbol.for("react.concurrent_mode"):60111,REACT_FORWARD_REF_TYPE=hasSymbol?Symbol.for("react.forward_ref"):60112,REACT_SUSPENSE_TYPE=hasSymbol?Symbol.for("react.suspense"):60113,REACT_SUSPENSE_LIST_TYPE=hasSymbol?Symbol.for("react.suspense_list"):60120,REACT_MEMO_TYPE=hasSymbol?Symbol.for("react.memo"):60115,REACT_LAZY_TYPE=hasSymbol?Symbol.for("react.lazy"):60116,REACT_BLOCK_TYPE=hasSymbol?Symbol.for("react.block"):60121,MAYBE_ITERATOR_SYMBOL="function"==typeof Symbol&&Symbol.iterator,FAUX_ITERATOR_SYMBOL="@@iterator";function getIteratorFn(maybeIterable){if(null===maybeIterable||"object"!=typeof maybeIterable)return null;var maybeIterator=MAYBE_ITERATOR_SYMBOL&&maybeIterable[MAYBE_ITERATOR_SYMBOL]||maybeIterable["@@iterator"];return"function"==typeof maybeIterator?maybeIterator:null}var Uninitialized=-1,Pending=0,Resolved=1,Rejected=2;function refineResolvedLazyComponent(lazyComponent){return 1===lazyComponent._status?lazyComponent._result:null}function initializeLazyComponentType(lazyComponent){if(-1===lazyComponent._status){lazyComponent._status=0;var ctor,thenable=(0,lazyComponent._ctor)();lazyComponent._result=thenable,thenable.then((function(moduleObject){if(0===lazyComponent._status){var defaultExport=moduleObject.default;void 0===defaultExport&&error("lazy: Expected the result of a dynamic import() call. Instead received: %s\n\nYour code should look like: \n  const MyComponent = lazy(() => import('./MyComponent'))",moduleObject),lazyComponent._status=1,lazyComponent._result=defaultExport}}),(function(error){0===lazyComponent._status&&(lazyComponent._status=2,lazyComponent._result=error)}))}}function getWrappedName(outerType,innerType,wrapperName){var functionName=innerType.displayName||innerType.name||"";return outerType.displayName||(""!==functionName?wrapperName+"("+functionName+")":wrapperName)}function getComponentName(type){if(null==type)return null;if("number"==typeof type.tag&&error("Received an unexpected object in getComponentName(). This is likely a bug in React. Please file an issue."),"function"==typeof type)return type.displayName||type.name||null;if("string"==typeof type)return type;switch(type){case REACT_FRAGMENT_TYPE:return"Fragment";case REACT_PORTAL_TYPE:return"Portal";case REACT_PROFILER_TYPE:return"Profiler";case REACT_STRICT_MODE_TYPE:return"StrictMode";case REACT_SUSPENSE_TYPE:return"Suspense";case REACT_SUSPENSE_LIST_TYPE:return"SuspenseList"}if("object"==typeof type)switch(type.$$typeof){case REACT_CONTEXT_TYPE:return"Context.Consumer";case REACT_PROVIDER_TYPE:return"Context.Provider";case REACT_FORWARD_REF_TYPE:return getWrappedName(type,type.render,"ForwardRef");case REACT_MEMO_TYPE:return getComponentName(type.type);case REACT_BLOCK_TYPE:return getComponentName(type.render);case REACT_LAZY_TYPE:var thenable,resolvedThenable=refineResolvedLazyComponent(type);if(resolvedThenable)return getComponentName(resolvedThenable)}return null}var ReactDebugCurrentFrame$1=ReactSharedInternals.ReactDebugCurrentFrame;function describeFiber(fiber){switch(fiber.tag){case 3:case 4:case 6:case 7:case 10:case 9:return"";default:var owner=fiber._debugOwner,source=fiber._debugSource,name=getComponentName(fiber.type),ownerName=null;return owner&&(ownerName=getComponentName(owner.type)),describeComponentFrame(name,source,ownerName)}}function getStackByFiberInDevAndProd(workInProgress){var info="",node=workInProgress;do{info+=describeFiber(node),node=node.return}while(node);return info}var current=null,isRendering=!1;function getCurrentFiberOwnerNameInDevOrNull(){if(null===current)return null;var owner=current._debugOwner;return null!=owner?getComponentName(owner.type):null}function getCurrentFiberStackInDev(){return null===current?"":getStackByFiberInDevAndProd(current)}function resetCurrentFiber(){ReactDebugCurrentFrame$1.getCurrentStack=null,current=null,isRendering=!1}function setCurrentFiber(fiber){ReactDebugCurrentFrame$1.getCurrentStack=getCurrentFiberStackInDev,current=fiber,isRendering=!1}function setIsRendering(rendering){isRendering=rendering}function toString(value){return""+value}function getToStringValue(value){switch(typeof value){case"boolean":case"number":case"object":case"string":case"undefined":return value;default:return""}}var ReactDebugCurrentFrame$2=null,ReactControlledValuePropTypes={checkPropTypes:null};ReactDebugCurrentFrame$2=ReactSharedInternals.ReactDebugCurrentFrame;var hasReadOnlyValue={button:!0,checkbox:!0,image:!0,hidden:!0,radio:!0,reset:!0,submit:!0},propTypes={value:function(props,propName,componentName){return hasReadOnlyValue[props.type]||props.onChange||props.readOnly||props.disabled||null==props[propName]?null:new Error("You provided a `value` prop to a form field without an `onChange` handler. This will render a read-only field. If the field should be mutable use `defaultValue`. Otherwise, set either `onChange` or `readOnly`.")},checked:function(props,propName,componentName){return props.onChange||props.readOnly||props.disabled||null==props[propName]?null:new Error("You provided a `checked` prop to a form field without an `onChange` handler. This will render a read-only field. If the field should be mutable use `defaultChecked`. Otherwise, set either `onChange` or `readOnly`.")}};function isCheckable(elem){var type=elem.type,nodeName=elem.nodeName;return nodeName&&"input"===nodeName.toLowerCase()&&("checkbox"===type||"radio"===type)}function getTracker(node){return node._valueTracker}function detachTracker(node){node._valueTracker=null}function getValueFromNode(node){var value="";return node?value=isCheckable(node)?node.checked?"true":"false":node.value:value}function trackValueOnNode(node){var valueField=isCheckable(node)?"checked":"value",descriptor=Object.getOwnPropertyDescriptor(node.constructor.prototype,valueField),currentValue=""+node[valueField];if(!node.hasOwnProperty(valueField)&&void 0!==descriptor&&"function"==typeof descriptor.get&&"function"==typeof descriptor.set){var get=descriptor.get,set=descriptor.set,tracker;return Object.defineProperty(node,valueField,{configurable:!0,get:function(){return get.call(this)},set:function(value){currentValue=""+value,set.call(this,value)}}),Object.defineProperty(node,valueField,{enumerable:descriptor.enumerable}),{getValue:function(){return currentValue},setValue:function(value){currentValue=""+value},stopTracking:function(){detachTracker(node),delete node[valueField]}}}}function track(node){getTracker(node)||(node._valueTracker=trackValueOnNode(node))}function updateValueIfChanged(node){if(!node)return!1;var tracker=getTracker(node);if(!tracker)return!0;var lastValue=tracker.getValue(),nextValue=getValueFromNode(node);return nextValue!==lastValue&&(tracker.setValue(nextValue),!0)}ReactControlledValuePropTypes.checkPropTypes=function(tagName,props){checkPropTypes(propTypes,props,"prop",tagName,ReactDebugCurrentFrame$2.getStackAddendum)};var didWarnValueDefaultValue=!1,didWarnCheckedDefaultChecked=!1,didWarnControlledToUncontrolled=!1,didWarnUncontrolledToControlled=!1;function isControlled(props){var usesChecked;return"checkbox"===props.type||"radio"===props.type?null!=props.checked:null!=props.value}function getHostProps(element,props){var node=element,checked=props.checked,hostProps;return _assign({},props,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=checked?checked:node._wrapperState.initialChecked})}function initWrapperState(element,props){ReactControlledValuePropTypes.checkPropTypes("input",props),void 0===props.checked||void 0===props.defaultChecked||didWarnCheckedDefaultChecked||(error("%s contains an input of type %s with both checked and defaultChecked props. Input elements must be either controlled or uncontrolled (specify either the checked prop, or the defaultChecked prop, but not both). Decide between using a controlled or uncontrolled input element and remove one of these props. More info: https://fb.me/react-controlled-components",getCurrentFiberOwnerNameInDevOrNull()||"A component",props.type),didWarnCheckedDefaultChecked=!0),void 0===props.value||void 0===props.defaultValue||didWarnValueDefaultValue||(error("%s contains an input of type %s with both value and defaultValue props. Input elements must be either controlled or uncontrolled (specify either the value prop, or the defaultValue prop, but not both). Decide between using a controlled or uncontrolled input element and remove one of these props. More info: https://fb.me/react-controlled-components",getCurrentFiberOwnerNameInDevOrNull()||"A component",props.type),didWarnValueDefaultValue=!0);var node=element,defaultValue=null==props.defaultValue?"":props.defaultValue;node._wrapperState={initialChecked:null!=props.checked?props.checked:props.defaultChecked,initialValue:getToStringValue(null!=props.value?props.value:defaultValue),controlled:isControlled(props)}}function updateChecked(element,props){var node=element,checked=props.checked;null!=checked&&setValueForProperty(node,"checked",checked,!1)}function updateWrapper(element,props){var node=element,controlled=isControlled(props);node._wrapperState.controlled||!controlled||didWarnUncontrolledToControlled||(error("A component is changing an uncontrolled input of type %s to be controlled. Input elements should not switch from uncontrolled to controlled (or vice versa). Decide between using a controlled or uncontrolled input element for the lifetime of the component. More info: https://fb.me/react-controlled-components",props.type),didWarnUncontrolledToControlled=!0),!node._wrapperState.controlled||controlled||didWarnControlledToUncontrolled||(error("A component is changing a controlled input of type %s to be uncontrolled. Input elements should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled input element for the lifetime of the component. More info: https://fb.me/react-controlled-components",props.type),didWarnControlledToUncontrolled=!0),updateChecked(element,props);var value=getToStringValue(props.value),type=props.type;if(null!=value)"number"===type?(0===value&&""===node.value||node.value!=value)&&(node.value=toString(value)):node.value!==toString(value)&&(node.value=toString(value));else if("submit"===type||"reset"===type)return void node.removeAttribute("value");props.hasOwnProperty("value")?setDefaultValue(node,props.type,value):props.hasOwnProperty("defaultValue")&&setDefaultValue(node,props.type,getToStringValue(props.defaultValue)),null==props.checked&&null!=props.defaultChecked&&(node.defaultChecked=!!props.defaultChecked)}function postMountWrapper(element,props,isHydrating){var node=element;if(props.hasOwnProperty("value")||props.hasOwnProperty("defaultValue")){var type=props.type,isButton;if(("submit"===type||"reset"===type)&&(void 0===props.value||null===props.value))return;var initialValue=toString(node._wrapperState.initialValue);isHydrating||initialValue!==node.value&&(node.value=initialValue),node.defaultValue=initialValue}var name=node.name;""!==name&&(node.name=""),node.defaultChecked=!node.defaultChecked,node.defaultChecked=!!node._wrapperState.initialChecked,""!==name&&(node.name=name)}function restoreControlledState(element,props){var node=element;updateWrapper(node,props),updateNamedCousins(node,props)}function updateNamedCousins(rootNode,props){var name=props.name;if("radio"===props.type&&null!=name){for(var queryRoot=rootNode;queryRoot.parentNode;)queryRoot=queryRoot.parentNode;for(var group=queryRoot.querySelectorAll("input[name="+JSON.stringify(""+name)+'][type="radio"]'),i=0;i<group.length;i++){var otherNode=group[i];if(otherNode!==rootNode&&otherNode.form===rootNode.form){var otherProps=getFiberCurrentPropsFromNode$1(otherNode);if(!otherProps)throw Error("ReactDOMInput: Mixing React and non-React radio inputs with the same `name` is not supported.");updateValueIfChanged(otherNode),updateWrapper(otherNode,otherProps)}}}}function setDefaultValue(node,type,value){"number"===type&&node.ownerDocument.activeElement===node||(null==value?node.defaultValue=toString(node._wrapperState.initialValue):node.defaultValue!==toString(value)&&(node.defaultValue=toString(value)))}var didWarnSelectedSetOnOption=!1,didWarnInvalidChild=!1,didWarnValueDefaultValue$1;function flattenChildren(children){var content="";return React.Children.forEach(children,(function(child){null!=child&&(content+=child)})),content}function validateProps(element,props){"object"==typeof props.children&&null!==props.children&&React.Children.forEach(props.children,(function(child){null!=child&&"string"!=typeof child&&"number"!=typeof child&&"string"==typeof child.type&&(didWarnInvalidChild||(didWarnInvalidChild=!0,error("Only strings and numbers are supported as <option> children.")))})),null==props.selected||didWarnSelectedSetOnOption||(error("Use the `defaultValue` or `value` props on <select> instead of setting `selected` on <option>."),didWarnSelectedSetOnOption=!0)}function postMountWrapper$1(element,props){null!=props.value&&element.setAttribute("value",toString(getToStringValue(props.value)))}function getHostProps$1(element,props){var hostProps=_assign({children:void 0},props),content=flattenChildren(props.children);return content&&(hostProps.children=content),hostProps}function getDeclarationErrorAddendum(){var ownerName=getCurrentFiberOwnerNameInDevOrNull();return ownerName?"\n\nCheck the render method of `"+ownerName+"`.":""}didWarnValueDefaultValue$1=!1;var valuePropNames=["value","defaultValue"];function checkSelectPropTypes(props){ReactControlledValuePropTypes.checkPropTypes("select",props);for(var i=0;i<valuePropNames.length;i++){var propName=valuePropNames[i];if(null!=props[propName]){var isArray=Array.isArray(props[propName]);props.multiple&&!isArray?error("The `%s` prop supplied to <select> must be an array if `multiple` is true.%s",propName,getDeclarationErrorAddendum()):!props.multiple&&isArray&&error("The `%s` prop supplied to <select> must be a scalar value if `multiple` is false.%s",propName,getDeclarationErrorAddendum())}}}function updateOptions(node,multiple,propValue,setDefaultSelected){var options=node.options;if(multiple){for(var selectedValues=propValue,selectedValue={},i=0;i<selectedValues.length;i++)selectedValue["$"+selectedValues[i]]=!0;for(var _i=0;_i<options.length;_i++){var selected=selectedValue.hasOwnProperty("$"+options[_i].value);options[_i].selected!==selected&&(options[_i].selected=selected),selected&&setDefaultSelected&&(options[_i].defaultSelected=!0)}}else{for(var _selectedValue=toString(getToStringValue(propValue)),defaultSelected=null,_i2=0;_i2<options.length;_i2++){if(options[_i2].value===_selectedValue)return options[_i2].selected=!0,void(setDefaultSelected&&(options[_i2].defaultSelected=!0));null!==defaultSelected||options[_i2].disabled||(defaultSelected=options[_i2])}null!==defaultSelected&&(defaultSelected.selected=!0)}}function getHostProps$2(element,props){return _assign({},props,{value:void 0})}function initWrapperState$1(element,props){var node=element;checkSelectPropTypes(props),node._wrapperState={wasMultiple:!!props.multiple},void 0===props.value||void 0===props.defaultValue||didWarnValueDefaultValue$1||(error("Select elements must be either controlled or uncontrolled (specify either the value prop, or the defaultValue prop, but not both). Decide between using a controlled or uncontrolled select element and remove one of these props. More info: https://fb.me/react-controlled-components"),didWarnValueDefaultValue$1=!0)}function postMountWrapper$2(element,props){var node=element;node.multiple=!!props.multiple;var value=props.value;null!=value?updateOptions(node,!!props.multiple,value,!1):null!=props.defaultValue&&updateOptions(node,!!props.multiple,props.defaultValue,!0)}function postUpdateWrapper(element,props){var node=element,wasMultiple=node._wrapperState.wasMultiple;node._wrapperState.wasMultiple=!!props.multiple;var value=props.value;null!=value?updateOptions(node,!!props.multiple,value,!1):wasMultiple!==!!props.multiple&&(null!=props.defaultValue?updateOptions(node,!!props.multiple,props.defaultValue,!0):updateOptions(node,!!props.multiple,props.multiple?[]:"",!1))}function restoreControlledState$1(element,props){var node=element,value=props.value;null!=value&&updateOptions(node,!!props.multiple,value,!1)}var didWarnValDefaultVal=!1;function getHostProps$3(element,props){var node=element,hostProps;if(null!=props.dangerouslySetInnerHTML)throw Error("`dangerouslySetInnerHTML` does not make sense on <textarea>.");return _assign({},props,{value:void 0,defaultValue:void 0,children:toString(node._wrapperState.initialValue)})}function initWrapperState$2(element,props){var node=element;ReactControlledValuePropTypes.checkPropTypes("textarea",props),void 0===props.value||void 0===props.defaultValue||didWarnValDefaultVal||(error("%s contains a textarea with both value and defaultValue props. Textarea elements must be either controlled or uncontrolled (specify either the value prop, or the defaultValue prop, but not both). Decide between using a controlled or uncontrolled textarea and remove one of these props. More info: https://fb.me/react-controlled-components",getCurrentFiberOwnerNameInDevOrNull()||"A component"),didWarnValDefaultVal=!0);var initialValue=props.value;if(null==initialValue){var children=props.children,defaultValue=props.defaultValue;if(null!=children){if(error("Use the `defaultValue` or `value` props instead of setting children on <textarea>."),null!=defaultValue)throw Error("If you supply `defaultValue` on a <textarea>, do not pass children.");if(Array.isArray(children)){if(!(children.length<=1))throw Error("<textarea> can only have at most one child.");children=children[0]}defaultValue=children}null==defaultValue&&(defaultValue=""),initialValue=defaultValue}node._wrapperState={initialValue:getToStringValue(initialValue)}}function updateWrapper$1(element,props){var node=element,value=getToStringValue(props.value),defaultValue=getToStringValue(props.defaultValue);if(null!=value){var newValue=toString(value);newValue!==node.value&&(node.value=newValue),null==props.defaultValue&&node.defaultValue!==newValue&&(node.defaultValue=newValue)}null!=defaultValue&&(node.defaultValue=toString(defaultValue))}function postMountWrapper$3(element,props){var node=element,textContent=node.textContent;textContent===node._wrapperState.initialValue&&""!==textContent&&null!==textContent&&(node.value=textContent)}function restoreControlledState$2(element,props){updateWrapper$1(element,props)}var HTML_NAMESPACE="http://www.w3.org/1999/xhtml",MATH_NAMESPACE="http://www.w3.org/1998/Math/MathML",SVG_NAMESPACE="http://www.w3.org/2000/svg",Namespaces_html=HTML_NAMESPACE,Namespaces_mathml=MATH_NAMESPACE,Namespaces_svg=SVG_NAMESPACE;function getIntrinsicNamespace(type){switch(type){case"svg":return SVG_NAMESPACE;case"math":return MATH_NAMESPACE;default:return HTML_NAMESPACE}}function getChildNamespace(parentNamespace,type){return null==parentNamespace||parentNamespace===HTML_NAMESPACE?getIntrinsicNamespace(type):parentNamespace===SVG_NAMESPACE&&"foreignObject"===type?HTML_NAMESPACE:parentNamespace}var createMicrosoftUnsafeLocalFunction,reusableSVGContainer,setInnerHTML=function(func){return"undefined"!=typeof MSApp&&MSApp.execUnsafeLocalFunction?function(arg0,arg1,arg2,arg3){MSApp.execUnsafeLocalFunction((function(){return func(arg0,arg1,arg2,arg3)}))}:func}((function(node,html){if(node.namespaceURI!==Namespaces_svg||"innerHTML"in node)node.innerHTML=html;else{(reusableSVGContainer=reusableSVGContainer||document.createElement("div")).innerHTML="<svg>"+html.valueOf().toString()+"</svg>";for(var svgNode=reusableSVGContainer.firstChild;node.firstChild;)node.removeChild(node.firstChild);for(;svgNode.firstChild;)node.appendChild(svgNode.firstChild)}})),ELEMENT_NODE=1,TEXT_NODE=3,COMMENT_NODE=8,DOCUMENT_NODE=9,DOCUMENT_FRAGMENT_NODE=11,setTextContent=function(node,text){if(text){var firstChild=node.firstChild;if(firstChild&&firstChild===node.lastChild&&3===firstChild.nodeType)return void(firstChild.nodeValue=text)}node.textContent=text};function unsafeCastStringToDOMTopLevelType(topLevelType){return topLevelType}function unsafeCastDOMTopLevelTypeToString(topLevelType){return topLevelType}function makePrefixMap(styleProp,eventName){var prefixes={};return prefixes[styleProp.toLowerCase()]=eventName.toLowerCase(),prefixes["Webkit"+styleProp]="webkit"+eventName,prefixes["Moz"+styleProp]="moz"+eventName,prefixes}var vendorPrefixes={animationend:makePrefixMap("Animation","AnimationEnd"),animationiteration:makePrefixMap("Animation","AnimationIteration"),animationstart:makePrefixMap("Animation","AnimationStart"),transitionend:makePrefixMap("Transition","TransitionEnd")},prefixedEventNames={},style={};function getVendorPrefixedEventName(eventName){if(prefixedEventNames[eventName])return prefixedEventNames[eventName];if(!vendorPrefixes[eventName])return eventName;var prefixMap=vendorPrefixes[eventName];for(var styleProp in prefixMap)if(prefixMap.hasOwnProperty(styleProp)&&styleProp in style)return prefixedEventNames[eventName]=prefixMap[styleProp];return eventName}canUseDOM&&(style=document.createElement("div").style,"AnimationEvent"in window||(delete vendorPrefixes.animationend.animation,delete vendorPrefixes.animationiteration.animation,delete vendorPrefixes.animationstart.animation),"TransitionEvent"in window||delete vendorPrefixes.transitionend.transition);var TOP_ABORT="abort",TOP_ANIMATION_END=getVendorPrefixedEventName("animationend"),TOP_ANIMATION_ITERATION=getVendorPrefixedEventName("animationiteration"),TOP_ANIMATION_START=getVendorPrefixedEventName("animationstart"),TOP_BLUR="blur",TOP_CAN_PLAY="canplay",TOP_CAN_PLAY_THROUGH="canplaythrough",TOP_CANCEL="cancel",TOP_CHANGE="change",TOP_CLICK="click",TOP_CLOSE="close",TOP_COMPOSITION_END="compositionend",TOP_COMPOSITION_START="compositionstart",TOP_COMPOSITION_UPDATE="compositionupdate",TOP_CONTEXT_MENU="contextmenu",TOP_COPY="copy",TOP_CUT="cut",TOP_DOUBLE_CLICK="dblclick",TOP_AUX_CLICK="auxclick",TOP_DRAG="drag",TOP_DRAG_END="dragend",TOP_DRAG_ENTER="dragenter",TOP_DRAG_EXIT="dragexit",TOP_DRAG_LEAVE="dragleave",TOP_DRAG_OVER="dragover",TOP_DRAG_START="dragstart",TOP_DROP="drop",TOP_DURATION_CHANGE="durationchange",TOP_EMPTIED="emptied",TOP_ENCRYPTED="encrypted",TOP_ENDED="ended",TOP_ERROR="error",TOP_FOCUS="focus",TOP_GOT_POINTER_CAPTURE="gotpointercapture",TOP_INPUT="input",TOP_INVALID="invalid",TOP_KEY_DOWN="keydown",TOP_KEY_PRESS="keypress",TOP_KEY_UP="keyup",TOP_LOAD="load",TOP_LOAD_START="loadstart",TOP_LOADED_DATA="loadeddata",TOP_LOADED_METADATA="loadedmetadata",TOP_LOST_POINTER_CAPTURE="lostpointercapture",TOP_MOUSE_DOWN="mousedown",TOP_MOUSE_MOVE="mousemove",TOP_MOUSE_OUT="mouseout",TOP_MOUSE_OVER="mouseover",TOP_MOUSE_UP="mouseup",TOP_PASTE="paste",TOP_PAUSE="pause",TOP_PLAY="play",TOP_PLAYING="playing",TOP_POINTER_CANCEL="pointercancel",TOP_POINTER_DOWN="pointerdown",TOP_POINTER_MOVE="pointermove",TOP_POINTER_OUT="pointerout",TOP_POINTER_OVER="pointerover",TOP_POINTER_UP="pointerup",TOP_PROGRESS="progress",TOP_RATE_CHANGE="ratechange",TOP_RESET="reset",TOP_SCROLL="scroll",TOP_SEEKED="seeked",TOP_SEEKING="seeking",TOP_SELECTION_CHANGE="selectionchange",TOP_STALLED="stalled",TOP_SUBMIT="submit",TOP_SUSPEND="suspend",TOP_TEXT_INPUT="textInput",TOP_TIME_UPDATE="timeupdate",TOP_TOGGLE="toggle",TOP_TOUCH_CANCEL="touchcancel",TOP_TOUCH_END="touchend",TOP_TOUCH_MOVE="touchmove",TOP_TOUCH_START="touchstart",TOP_TRANSITION_END=getVendorPrefixedEventName("transitionend"),TOP_VOLUME_CHANGE="volumechange",TOP_WAITING="waiting",TOP_WHEEL="wheel",mediaEventTypes=["abort","canplay","canplaythrough","durationchange","emptied","encrypted","ended","error","loadeddata","loadedmetadata","loadstart","pause","play","playing","progress","ratechange","seeked","seeking","stalled","suspend","timeupdate","volumechange","waiting"];function getRawEventName(topLevelType){return topLevelType}var PossiblyWeakMap,elementListenerMap=new("function"==typeof WeakMap?WeakMap:Map);function getListenerMapForElement(element){var listenerMap=elementListenerMap.get(element);return void 0===listenerMap&&(listenerMap=new Map,elementListenerMap.set(element,listenerMap)),listenerMap}function get(key){return key._reactInternalFiber}function has(key){return void 0!==key._reactInternalFiber}function set(key,value){key._reactInternalFiber=value}var NoEffect=0,PerformedWork=1,Placement=2,Update=4,PlacementAndUpdate=6,Deletion=8,ContentReset=16,Callback=32,DidCapture=64,Ref=128,Snapshot=256,Passive=512,Hydrating=1024,HydratingAndUpdate=1028,LifecycleEffectMask=932,HostEffectMask=2047,Incomplete=2048,ShouldCapture=4096,ReactCurrentOwner=ReactSharedInternals.ReactCurrentOwner;function getNearestMountedFiber(fiber){var node=fiber,nearestMounted=fiber;if(fiber.alternate)for(;node.return;)node=node.return;else{var nextNode=node;do{0!=(1026&(node=nextNode).effectTag)&&(nearestMounted=node.return),nextNode=node.return}while(nextNode)}return 3===node.tag?nearestMounted:null}function getSuspenseInstanceFromFiber(fiber){if(13===fiber.tag){var suspenseState=fiber.memoizedState;if(null===suspenseState){var current=fiber.alternate;null!==current&&(suspenseState=current.memoizedState)}if(null!==suspenseState)return suspenseState.dehydrated}return null}function getContainerFromFiber(fiber){return 3===fiber.tag?fiber.stateNode.containerInfo:null}function isFiberMounted(fiber){return getNearestMountedFiber(fiber)===fiber}function isMounted(component){var owner=ReactCurrentOwner.current;if(null!==owner&&1===owner.tag){var ownerFiber=owner,instance=ownerFiber.stateNode;instance._warnedAboutRefsInRender||error("%s is accessing isMounted inside its render() function. render() should be a pure function of props and state. It should never access something that requires stale data from the previous render, such as refs. Move this logic to componentDidMount and componentDidUpdate instead.",getComponentName(ownerFiber.type)||"A component"),instance._warnedAboutRefsInRender=!0}var fiber=get(component);return!!fiber&&getNearestMountedFiber(fiber)===fiber}function assertIsMounted(fiber){if(getNearestMountedFiber(fiber)!==fiber)throw Error("Unable to find node on an unmounted component.")}function findCurrentFiberUsingSlowPath(fiber){var alternate=fiber.alternate;if(!alternate){var nearestMounted=getNearestMountedFiber(fiber);if(null===nearestMounted)throw Error("Unable to find node on an unmounted component.");return nearestMounted!==fiber?null:fiber}for(var a=fiber,b=alternate;;){var parentA=a.return;if(null===parentA)break;var parentB=parentA.alternate;if(null===parentB){var nextParent=parentA.return;if(null!==nextParent){a=b=nextParent;continue}break}if(parentA.child===parentB.child){for(var child=parentA.child;child;){if(child===a)return assertIsMounted(parentA),fiber;if(child===b)return assertIsMounted(parentA),alternate;child=child.sibling}throw Error("Unable to find node on an unmounted component.")}if(a.return!==b.return)a=parentA,b=parentB;else{for(var didFindChild=!1,_child=parentA.child;_child;){if(_child===a){didFindChild=!0,a=parentA,b=parentB;break}if(_child===b){didFindChild=!0,b=parentA,a=parentB;break}_child=_child.sibling}if(!didFindChild){for(_child=parentB.child;_child;){if(_child===a){didFindChild=!0,a=parentB,b=parentA;break}if(_child===b){didFindChild=!0,b=parentB,a=parentA;break}_child=_child.sibling}if(!didFindChild)throw Error("Child was not found in either parent set. This indicates a bug in React related to the return pointer. Please file an issue.")}}if(a.alternate!==b)throw Error("Return fibers should always be each others' alternates. This error is likely caused by a bug in React. Please file an issue.")}if(3!==a.tag)throw Error("Unable to find node on an unmounted component.");return a.stateNode.current===a?fiber:alternate}function findCurrentHostFiber(parent){var currentParent=findCurrentFiberUsingSlowPath(parent);if(!currentParent)return null;for(var node=currentParent;;){if(5===node.tag||6===node.tag)return node;if(node.child)node.child.return=node,node=node.child;else{if(node===currentParent)return null;for(;!node.sibling;){if(!node.return||node.return===currentParent)return null;node=node.return}node.sibling.return=node.return,node=node.sibling}}return null}function findCurrentHostFiberWithNoPortals(parent){var currentParent=findCurrentFiberUsingSlowPath(parent);if(!currentParent)return null;for(var node=currentParent;;){if(5===node.tag||6===node.tag)return node;if(node.child&&4!==node.tag)node.child.return=node,node=node.child;else{if(node===currentParent)return null;for(;!node.sibling;){if(!node.return||node.return===currentParent)return null;node=node.return}node.sibling.return=node.return,node=node.sibling}}return null}function accumulateInto(current,next){if(null==next)throw Error("accumulateInto(...): Accumulated items must not be null or undefined.");return null==current?next:Array.isArray(current)?Array.isArray(next)?(current.push.apply(current,next),current):(current.push(next),current):Array.isArray(next)?[current].concat(next):[current,next]}function forEachAccumulated(arr,cb,scope){Array.isArray(arr)?arr.forEach(cb,scope):arr&&cb.call(scope,arr)}var eventQueue=null,executeDispatchesAndRelease=function(event){event&&(executeDispatchesInOrder(event),event.isPersistent()||event.constructor.release(event))},executeDispatchesAndReleaseTopLevel=function(e){return executeDispatchesAndRelease(e)};function runEventsInBatch(events){null!==events&&(eventQueue=accumulateInto(eventQueue,events));var processingEventQueue=eventQueue;if(eventQueue=null,processingEventQueue){if(forEachAccumulated(processingEventQueue,executeDispatchesAndReleaseTopLevel),eventQueue)throw Error("processEventQueue(): Additional events were enqueued while processing an event queue. Support for this has not yet been implemented.");rethrowCaughtError()}}function getEventTarget(nativeEvent){var target=nativeEvent.target||nativeEvent.srcElement||window;return target.correspondingUseElement&&(target=target.correspondingUseElement),3===target.nodeType?target.parentNode:target}
/**
 * Checks if an event is supported in the current execution environment.
 *
 * NOTE: This will not work correctly for non-generic events such as `change`,
 * `reset`, `load`, `error`, and `select`.
 *
 * Borrows from Modernizr.
 *
 * @param {string} eventNameSuffix Event name, e.g. "click".
 * @return {boolean} True if the event is supported.
 * @internal
 * @license Modernizr 3.0.0pre (Custom Build) | MIT
 */function isEventSupported(eventNameSuffix){if(!canUseDOM)return!1;var eventName="on"+eventNameSuffix,isSupported=eventName in document;if(!isSupported){var element=document.createElement("div");element.setAttribute(eventName,"return;"),isSupported="function"==typeof element[eventName]}return isSupported}var CALLBACK_BOOKKEEPING_POOL_SIZE=10,callbackBookkeepingPool=[],attemptUserBlockingHydration,attemptContinuousHydration,attemptHydrationAtCurrentPriority;function releaseTopLevelCallbackBookKeeping(instance){instance.topLevelType=null,instance.nativeEvent=null,instance.targetInst=null,instance.ancestors.length=0,callbackBookkeepingPool.length<10&&callbackBookkeepingPool.push(instance)}function getTopLevelCallbackBookKeeping(topLevelType,nativeEvent,targetInst,eventSystemFlags){if(callbackBookkeepingPool.length){var instance=callbackBookkeepingPool.pop();return instance.topLevelType=topLevelType,instance.eventSystemFlags=eventSystemFlags,instance.nativeEvent=nativeEvent,instance.targetInst=targetInst,instance}return{topLevelType:topLevelType,eventSystemFlags:eventSystemFlags,nativeEvent:nativeEvent,targetInst:targetInst,ancestors:[]}}function findRootContainerNode(inst){if(3===inst.tag)return inst.stateNode.containerInfo;for(;inst.return;)inst=inst.return;return 3!==inst.tag?null:inst.stateNode.containerInfo}function extractPluginEvents(topLevelType,targetInst,nativeEvent,nativeEventTarget,eventSystemFlags){for(var events=null,i=0;i<plugins.length;i++){var possiblePlugin=plugins[i];if(possiblePlugin){var extractedEvents=possiblePlugin.extractEvents(topLevelType,targetInst,nativeEvent,nativeEventTarget,eventSystemFlags);extractedEvents&&(events=accumulateInto(events,extractedEvents))}}return events}function runExtractedPluginEventsInBatch(topLevelType,targetInst,nativeEvent,nativeEventTarget,eventSystemFlags){var events;runEventsInBatch(extractPluginEvents(topLevelType,targetInst,nativeEvent,nativeEventTarget,eventSystemFlags))}function handleTopLevel(bookKeeping){var targetInst=bookKeeping.targetInst,ancestor=targetInst;do{if(!ancestor){var ancestors;bookKeeping.ancestors.push(ancestor);break}var root=findRootContainerNode(ancestor);if(!root)break;var tag=ancestor.tag;5!==tag&&6!==tag||bookKeeping.ancestors.push(ancestor),ancestor=getClosestInstanceFromNode(root)}while(ancestor);for(var i=0;i<bookKeeping.ancestors.length;i++){targetInst=bookKeeping.ancestors[i];var eventTarget=getEventTarget(bookKeeping.nativeEvent),topLevelType=bookKeeping.topLevelType,nativeEvent=bookKeeping.nativeEvent,eventSystemFlags=bookKeeping.eventSystemFlags;0===i&&(eventSystemFlags|=64),runExtractedPluginEventsInBatch(topLevelType,targetInst,nativeEvent,eventTarget,eventSystemFlags)}}function dispatchEventForLegacyPluginEventSystem(topLevelType,eventSystemFlags,nativeEvent,targetInst){var bookKeeping=getTopLevelCallbackBookKeeping(topLevelType,nativeEvent,targetInst,eventSystemFlags);try{batchedEventUpdates(handleTopLevel,bookKeeping)}finally{releaseTopLevelCallbackBookKeeping(bookKeeping)}}function legacyListenToEvent(registrationName,mountAt){for(var listenerMap=getListenerMapForElement(mountAt),dependencies=registrationNameDependencies[registrationName],i=0;i<dependencies.length;i++){var dependency;legacyListenToTopLevelEvent(dependencies[i],mountAt,listenerMap)}}function legacyListenToTopLevelEvent(topLevelType,mountAt,listenerMap){if(!listenerMap.has(topLevelType)){switch(topLevelType){case"scroll":trapCapturedEvent("scroll",mountAt);break;case"focus":case"blur":trapCapturedEvent("focus",mountAt),trapCapturedEvent("blur",mountAt),listenerMap.set("blur",null),listenerMap.set("focus",null);break;case"cancel":case"close":isEventSupported(topLevelType)&&trapCapturedEvent(topLevelType,mountAt);break;case"invalid":case"submit":case"reset":break;default:var isMediaEvent;-1!==mediaEventTypes.indexOf(topLevelType)||trapBubbledEvent(topLevelType,mountAt)}listenerMap.set(topLevelType,null)}}function isListeningToAllDependencies(registrationName,mountAt){for(var listenerMap=getListenerMapForElement(mountAt),dependencies=registrationNameDependencies[registrationName],i=0;i<dependencies.length;i++){var dependency=dependencies[i];if(!listenerMap.has(dependency))return!1}return!0}function setAttemptUserBlockingHydration(fn){attemptUserBlockingHydration=fn}function setAttemptContinuousHydration(fn){attemptContinuousHydration=fn}function setAttemptHydrationAtCurrentPriority(fn){attemptHydrationAtCurrentPriority=fn}var hasScheduledReplayAttempt=!1,queuedDiscreteEvents=[],queuedFocus=null,queuedDrag=null,queuedMouse=null,queuedPointers=new Map,queuedPointerCaptures=new Map,queuedExplicitHydrationTargets=[];function hasQueuedDiscreteEvents(){return queuedDiscreteEvents.length>0}var discreteReplayableEvents=["mousedown","mouseup","touchcancel","touchend","touchstart","auxclick","dblclick","pointercancel","pointerdown","pointerup","dragend","dragstart","drop","compositionend","compositionstart","keydown","keypress","keyup","input","textInput","close","cancel","copy","cut","paste","click","change","contextmenu","reset","submit"],continuousReplayableEvents=["focus","blur","dragenter","dragleave","mouseover","mouseout","pointerover","pointerout","gotpointercapture","lostpointercapture"];function isReplayableDiscreteEvent(eventType){return discreteReplayableEvents.indexOf(eventType)>-1}function trapReplayableEventForDocument(topLevelType,document,listenerMap){legacyListenToTopLevelEvent(topLevelType,document,listenerMap)}function eagerlyTrapReplayableEvents(container,document){var listenerMapForDoc=getListenerMapForElement(document);discreteReplayableEvents.forEach((function(topLevelType){trapReplayableEventForDocument(topLevelType,document,listenerMapForDoc)})),continuousReplayableEvents.forEach((function(topLevelType){trapReplayableEventForDocument(topLevelType,document,listenerMapForDoc)}))}function createQueuedReplayableEvent(blockedOn,topLevelType,eventSystemFlags,container,nativeEvent){return{blockedOn:blockedOn,topLevelType:topLevelType,eventSystemFlags:32|eventSystemFlags,nativeEvent:nativeEvent,container:container}}function queueDiscreteEvent(blockedOn,topLevelType,eventSystemFlags,container,nativeEvent){var queuedEvent=createQueuedReplayableEvent(blockedOn,topLevelType,eventSystemFlags,container,nativeEvent);queuedDiscreteEvents.push(queuedEvent)}function clearIfContinuousEvent(topLevelType,nativeEvent){switch(topLevelType){case"focus":case"blur":queuedFocus=null;break;case"dragenter":case"dragleave":queuedDrag=null;break;case"mouseover":case"mouseout":queuedMouse=null;break;case"pointerover":case"pointerout":var pointerId=nativeEvent.pointerId;queuedPointers.delete(pointerId);break;case"gotpointercapture":case"lostpointercapture":var _pointerId=nativeEvent.pointerId;queuedPointerCaptures.delete(_pointerId)}}function accumulateOrCreateContinuousQueuedReplayableEvent(existingQueuedEvent,blockedOn,topLevelType,eventSystemFlags,container,nativeEvent){if(null===existingQueuedEvent||existingQueuedEvent.nativeEvent!==nativeEvent){var queuedEvent=createQueuedReplayableEvent(blockedOn,topLevelType,eventSystemFlags,container,nativeEvent);if(null!==blockedOn){var _fiber2=getInstanceFromNode$1(blockedOn);null!==_fiber2&&attemptContinuousHydration(_fiber2)}return queuedEvent}return existingQueuedEvent.eventSystemFlags|=eventSystemFlags,existingQueuedEvent}function queueIfContinuousEvent(blockedOn,topLevelType,eventSystemFlags,container,nativeEvent){switch(topLevelType){case"focus":var focusEvent;return queuedFocus=accumulateOrCreateContinuousQueuedReplayableEvent(queuedFocus,blockedOn,topLevelType,eventSystemFlags,container,nativeEvent),!0;case"dragenter":var dragEvent;return queuedDrag=accumulateOrCreateContinuousQueuedReplayableEvent(queuedDrag,blockedOn,topLevelType,eventSystemFlags,container,nativeEvent),!0;case"mouseover":var mouseEvent;return queuedMouse=accumulateOrCreateContinuousQueuedReplayableEvent(queuedMouse,blockedOn,topLevelType,eventSystemFlags,container,nativeEvent),!0;case"pointerover":var pointerEvent=nativeEvent,pointerId=pointerEvent.pointerId;return queuedPointers.set(pointerId,accumulateOrCreateContinuousQueuedReplayableEvent(queuedPointers.get(pointerId)||null,blockedOn,topLevelType,eventSystemFlags,container,pointerEvent)),!0;case"gotpointercapture":var _pointerEvent=nativeEvent,_pointerId2=_pointerEvent.pointerId;return queuedPointerCaptures.set(_pointerId2,accumulateOrCreateContinuousQueuedReplayableEvent(queuedPointerCaptures.get(_pointerId2)||null,blockedOn,topLevelType,eventSystemFlags,container,_pointerEvent)),!0}return!1}function attemptExplicitHydrationTarget(queuedTarget){var targetInst=getClosestInstanceFromNode(queuedTarget.target);if(null!==targetInst){var nearestMounted=getNearestMountedFiber(targetInst);if(null!==nearestMounted){var tag=nearestMounted.tag;if(13===tag){var instance=getSuspenseInstanceFromFiber(nearestMounted);if(null!==instance)return queuedTarget.blockedOn=instance,void Scheduler.unstable_runWithPriority(queuedTarget.priority,(function(){attemptHydrationAtCurrentPriority(nearestMounted)}))}else if(3===tag){var root;if(nearestMounted.stateNode.hydrate)return void(queuedTarget.blockedOn=getContainerFromFiber(nearestMounted))}}}queuedTarget.blockedOn=null}function attemptReplayContinuousQueuedEvent(queuedEvent){if(null!==queuedEvent.blockedOn)return!1;var nextBlockedOn=attemptToDispatchEvent(queuedEvent.topLevelType,queuedEvent.eventSystemFlags,queuedEvent.container,queuedEvent.nativeEvent);if(null!==nextBlockedOn){var _fiber3=getInstanceFromNode$1(nextBlockedOn);return null!==_fiber3&&attemptContinuousHydration(_fiber3),queuedEvent.blockedOn=nextBlockedOn,!1}return!0}function attemptReplayContinuousQueuedEventInMap(queuedEvent,key,map){attemptReplayContinuousQueuedEvent(queuedEvent)&&map.delete(key)}function replayUnblockedEvents(){for(hasScheduledReplayAttempt=!1;queuedDiscreteEvents.length>0;){var nextDiscreteEvent=queuedDiscreteEvents[0];if(null!==nextDiscreteEvent.blockedOn){var _fiber4=getInstanceFromNode$1(nextDiscreteEvent.blockedOn);null!==_fiber4&&attemptUserBlockingHydration(_fiber4);break}var nextBlockedOn=attemptToDispatchEvent(nextDiscreteEvent.topLevelType,nextDiscreteEvent.eventSystemFlags,nextDiscreteEvent.container,nextDiscreteEvent.nativeEvent);null!==nextBlockedOn?nextDiscreteEvent.blockedOn=nextBlockedOn:queuedDiscreteEvents.shift()}null!==queuedFocus&&attemptReplayContinuousQueuedEvent(queuedFocus)&&(queuedFocus=null),null!==queuedDrag&&attemptReplayContinuousQueuedEvent(queuedDrag)&&(queuedDrag=null),null!==queuedMouse&&attemptReplayContinuousQueuedEvent(queuedMouse)&&(queuedMouse=null),queuedPointers.forEach(attemptReplayContinuousQueuedEventInMap),queuedPointerCaptures.forEach(attemptReplayContinuousQueuedEventInMap)}function scheduleCallbackIfUnblocked(queuedEvent,unblocked){queuedEvent.blockedOn===unblocked&&(queuedEvent.blockedOn=null,hasScheduledReplayAttempt||(hasScheduledReplayAttempt=!0,Scheduler.unstable_scheduleCallback(Scheduler.unstable_NormalPriority,replayUnblockedEvents)))}function retryIfBlockedOn(unblocked){if(queuedDiscreteEvents.length>0){scheduleCallbackIfUnblocked(queuedDiscreteEvents[0],unblocked);for(var i=1;i<queuedDiscreteEvents.length;i++){var queuedEvent=queuedDiscreteEvents[i];queuedEvent.blockedOn===unblocked&&(queuedEvent.blockedOn=null)}}null!==queuedFocus&&scheduleCallbackIfUnblocked(queuedFocus,unblocked),null!==queuedDrag&&scheduleCallbackIfUnblocked(queuedDrag,unblocked),null!==queuedMouse&&scheduleCallbackIfUnblocked(queuedMouse,unblocked);var unblock=function(queuedEvent){return scheduleCallbackIfUnblocked(queuedEvent,unblocked)};queuedPointers.forEach(unblock),queuedPointerCaptures.forEach(unblock);for(var _i=0;_i<queuedExplicitHydrationTargets.length;_i++){var queuedTarget=queuedExplicitHydrationTargets[_i];queuedTarget.blockedOn===unblocked&&(queuedTarget.blockedOn=null)}for(;queuedExplicitHydrationTargets.length>0;){var nextExplicitTarget=queuedExplicitHydrationTargets[0];if(null!==nextExplicitTarget.blockedOn)break;attemptExplicitHydrationTarget(nextExplicitTarget),null===nextExplicitTarget.blockedOn&&queuedExplicitHydrationTargets.shift()}}function addEventBubbleListener(element,eventType,listener){element.addEventListener(eventType,listener,!1)}function addEventCaptureListener(element,eventType,listener){element.addEventListener(eventType,listener,!0)}var simpleEventPluginEventTypes={},topLevelEventsToDispatchConfig=new Map,eventPriorities=new Map,discreteEventPairsForSimpleEventPlugin,otherDiscreteEvents=["change","selectionchange","textInput","compositionstart","compositionend","compositionupdate"],userBlockingPairsForSimpleEventPlugin=["drag","drag","dragenter","dragEnter","dragexit","dragExit","dragleave","dragLeave","dragover","dragOver","mousemove","mouseMove","mouseout","mouseOut","mouseover","mouseOver","pointermove","pointerMove","pointerout","pointerOut","pointerover","pointerOver","scroll","scroll","toggle","toggle","touchmove","touchMove","wheel","wheel"],continuousPairsForSimpleEventPlugin=["abort","abort",TOP_ANIMATION_END,"animationEnd",TOP_ANIMATION_ITERATION,"animationIteration",TOP_ANIMATION_START,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata","loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",TOP_TRANSITION_END,"transitionEnd","waiting","waiting"];function processSimpleEventPluginPairsByPriority(eventTypes,priority){for(var i=0;i<eventTypes.length;i+=2){var topEvent=eventTypes[i],event=eventTypes[i+1],capitalizedEvent,onEvent="on"+(event[0].toUpperCase()+event.slice(1)),config={phasedRegistrationNames:{bubbled:onEvent,captured:onEvent+"Capture"},dependencies:[topEvent],eventPriority:priority};eventPriorities.set(topEvent,priority),topLevelEventsToDispatchConfig.set(topEvent,config),simpleEventPluginEventTypes[event]=config}}function processTopEventPairsByPriority(eventTypes,priority){for(var i=0;i<eventTypes.length;i++)eventPriorities.set(eventTypes[i],priority)}function getEventPriorityForPluginSystem(topLevelType){var priority=eventPriorities.get(topLevelType);return void 0===priority?2:priority}processSimpleEventPluginPairsByPriority(["blur","blur","cancel","cancel","click","click","close","close","contextmenu","contextMenu","copy","copy","cut","cut","auxclick","auxClick","dblclick","doubleClick","dragend","dragEnd","dragstart","dragStart","drop","drop","focus","focus","input","input","invalid","invalid","keydown","keyDown","keypress","keyPress","keyup","keyUp","mousedown","mouseDown","mouseup","mouseUp","paste","paste","pause","pause","play","play","pointercancel","pointerCancel","pointerdown","pointerDown","pointerup","pointerUp","ratechange","rateChange","reset","reset","seeked","seeked","submit","submit","touchcancel","touchCancel","touchend","touchEnd","touchstart","touchStart","volumechange","volumeChange"],0),processSimpleEventPluginPairsByPriority(userBlockingPairsForSimpleEventPlugin,1),processSimpleEventPluginPairsByPriority(continuousPairsForSimpleEventPlugin,2),processTopEventPairsByPriority(otherDiscreteEvents,0);var UserBlockingPriority=Scheduler.unstable_UserBlockingPriority,runWithPriority=Scheduler.unstable_runWithPriority,_enabled=!0;function setEnabled(enabled){_enabled=!!enabled}function isEnabled(){return _enabled}function trapBubbledEvent(topLevelType,element){trapEventForPluginEventSystem(element,topLevelType,!1)}function trapCapturedEvent(topLevelType,element){trapEventForPluginEventSystem(element,topLevelType,!0)}function trapEventForPluginEventSystem(container,topLevelType,capture){var listener;switch(getEventPriorityForPluginSystem(topLevelType)){case 0:listener=dispatchDiscreteEvent.bind(null,topLevelType,1,container);break;case 1:listener=dispatchUserBlockingUpdate.bind(null,topLevelType,1,container);break;case 2:default:listener=dispatchEvent.bind(null,topLevelType,1,container)}var rawEventName=topLevelType;capture?addEventCaptureListener(container,rawEventName,listener):addEventBubbleListener(container,rawEventName,listener)}function dispatchDiscreteEvent(topLevelType,eventSystemFlags,container,nativeEvent){flushDiscreteUpdatesIfNeeded(nativeEvent.timeStamp),discreteUpdates(dispatchEvent,topLevelType,eventSystemFlags,container,nativeEvent)}function dispatchUserBlockingUpdate(topLevelType,eventSystemFlags,container,nativeEvent){runWithPriority(UserBlockingPriority,dispatchEvent.bind(null,topLevelType,eventSystemFlags,container,nativeEvent))}function dispatchEvent(topLevelType,eventSystemFlags,container,nativeEvent){if(_enabled)if(hasQueuedDiscreteEvents()&&isReplayableDiscreteEvent(topLevelType))queueDiscreteEvent(null,topLevelType,eventSystemFlags,container,nativeEvent);else{var blockedOn=attemptToDispatchEvent(topLevelType,eventSystemFlags,container,nativeEvent);null!==blockedOn?isReplayableDiscreteEvent(topLevelType)?queueDiscreteEvent(blockedOn,topLevelType,eventSystemFlags,container,nativeEvent):queueIfContinuousEvent(blockedOn,topLevelType,eventSystemFlags,container,nativeEvent)||(clearIfContinuousEvent(topLevelType,nativeEvent),dispatchEventForLegacyPluginEventSystem(topLevelType,eventSystemFlags,nativeEvent,null)):clearIfContinuousEvent(topLevelType,nativeEvent)}}function attemptToDispatchEvent(topLevelType,eventSystemFlags,container,nativeEvent){var nativeEventTarget,targetInst=getClosestInstanceFromNode(getEventTarget(nativeEvent));if(null!==targetInst){var nearestMounted=getNearestMountedFiber(targetInst);if(null===nearestMounted)targetInst=null;else{var tag=nearestMounted.tag;if(13===tag){var instance=getSuspenseInstanceFromFiber(nearestMounted);if(null!==instance)return instance;targetInst=null}else if(3===tag){var root;if(nearestMounted.stateNode.hydrate)return getContainerFromFiber(nearestMounted);targetInst=null}else nearestMounted!==targetInst&&(targetInst=null)}}return dispatchEventForLegacyPluginEventSystem(topLevelType,eventSystemFlags,nativeEvent,targetInst),null}var shorthandToLonghand={animation:["animationDelay","animationDirection","animationDuration","animationFillMode","animationIterationCount","animationName","animationPlayState","animationTimingFunction"],background:["backgroundAttachment","backgroundClip","backgroundColor","backgroundImage","backgroundOrigin","backgroundPositionX","backgroundPositionY","backgroundRepeat","backgroundSize"],backgroundPosition:["backgroundPositionX","backgroundPositionY"],border:["borderBottomColor","borderBottomStyle","borderBottomWidth","borderImageOutset","borderImageRepeat","borderImageSlice","borderImageSource","borderImageWidth","borderLeftColor","borderLeftStyle","borderLeftWidth","borderRightColor","borderRightStyle","borderRightWidth","borderTopColor","borderTopStyle","borderTopWidth"],borderBlockEnd:["borderBlockEndColor","borderBlockEndStyle","borderBlockEndWidth"],borderBlockStart:["borderBlockStartColor","borderBlockStartStyle","borderBlockStartWidth"],borderBottom:["borderBottomColor","borderBottomStyle","borderBottomWidth"],borderColor:["borderBottomColor","borderLeftColor","borderRightColor","borderTopColor"],borderImage:["borderImageOutset","borderImageRepeat","borderImageSlice","borderImageSource","borderImageWidth"],borderInlineEnd:["borderInlineEndColor","borderInlineEndStyle","borderInlineEndWidth"],borderInlineStart:["borderInlineStartColor","borderInlineStartStyle","borderInlineStartWidth"],borderLeft:["borderLeftColor","borderLeftStyle","borderLeftWidth"],borderRadius:["borderBottomLeftRadius","borderBottomRightRadius","borderTopLeftRadius","borderTopRightRadius"],borderRight:["borderRightColor","borderRightStyle","borderRightWidth"],borderStyle:["borderBottomStyle","borderLeftStyle","borderRightStyle","borderTopStyle"],borderTop:["borderTopColor","borderTopStyle","borderTopWidth"],borderWidth:["borderBottomWidth","borderLeftWidth","borderRightWidth","borderTopWidth"],columnRule:["columnRuleColor","columnRuleStyle","columnRuleWidth"],columns:["columnCount","columnWidth"],flex:["flexBasis","flexGrow","flexShrink"],flexFlow:["flexDirection","flexWrap"],font:["fontFamily","fontFeatureSettings","fontKerning","fontLanguageOverride","fontSize","fontSizeAdjust","fontStretch","fontStyle","fontVariant","fontVariantAlternates","fontVariantCaps","fontVariantEastAsian","fontVariantLigatures","fontVariantNumeric","fontVariantPosition","fontWeight","lineHeight"],fontVariant:["fontVariantAlternates","fontVariantCaps","fontVariantEastAsian","fontVariantLigatures","fontVariantNumeric","fontVariantPosition"],gap:["columnGap","rowGap"],grid:["gridAutoColumns","gridAutoFlow","gridAutoRows","gridTemplateAreas","gridTemplateColumns","gridTemplateRows"],gridArea:["gridColumnEnd","gridColumnStart","gridRowEnd","gridRowStart"],gridColumn:["gridColumnEnd","gridColumnStart"],gridColumnGap:["columnGap"],gridGap:["columnGap","rowGap"],gridRow:["gridRowEnd","gridRowStart"],gridRowGap:["rowGap"],gridTemplate:["gridTemplateAreas","gridTemplateColumns","gridTemplateRows"],listStyle:["listStyleImage","listStylePosition","listStyleType"],margin:["marginBottom","marginLeft","marginRight","marginTop"],marker:["markerEnd","markerMid","markerStart"],mask:["maskClip","maskComposite","maskImage","maskMode","maskOrigin","maskPositionX","maskPositionY","maskRepeat","maskSize"],maskPosition:["maskPositionX","maskPositionY"],outline:["outlineColor","outlineStyle","outlineWidth"],overflow:["overflowX","overflowY"],padding:["paddingBottom","paddingLeft","paddingRight","paddingTop"],placeContent:["alignContent","justifyContent"],placeItems:["alignItems","justifyItems"],placeSelf:["alignSelf","justifySelf"],textDecoration:["textDecorationColor","textDecorationLine","textDecorationStyle"],textEmphasis:["textEmphasisColor","textEmphasisStyle"],transition:["transitionDelay","transitionDuration","transitionProperty","transitionTimingFunction"],wordWrap:["overflowWrap"]},isUnitlessNumber={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0};function prefixKey(prefix,key){return prefix+key.charAt(0).toUpperCase()+key.substring(1)}var prefixes=["Webkit","ms","Moz","O"];function dangerousStyleValue(name,value,isCustomProperty){var isEmpty;return null==value||"boolean"==typeof value||""===value?"":isCustomProperty||"number"!=typeof value||0===value||isUnitlessNumber.hasOwnProperty(name)&&isUnitlessNumber[name]?(""+value).trim():value+"px"}Object.keys(isUnitlessNumber).forEach((function(prop){prefixes.forEach((function(prefix){isUnitlessNumber[prefixKey(prefix,prop)]=isUnitlessNumber[prop]}))}));var uppercasePattern=/([A-Z])/g,msPattern=/^ms-/;function hyphenateStyleName(name){return name.replace(uppercasePattern,"-$1").toLowerCase().replace(msPattern,"-ms-")}var warnValidStyle=function(){},badVendoredStyleNamePattern=/^(?:webkit|moz|o)[A-Z]/,msPattern$1=/^-ms-/,hyphenPattern=/-(.)/g,badStyleValueWithSemicolonPattern=/;\s*$/,warnedStyleNames={},warnedStyleValues={},warnedForNaNValue=!1,warnedForInfinityValue=!1,camelize=function(string){return string.replace(hyphenPattern,(function(_,character){return character.toUpperCase()}))},warnHyphenatedStyleName=function(name){warnedStyleNames.hasOwnProperty(name)&&warnedStyleNames[name]||(warnedStyleNames[name]=!0,error("Unsupported style property %s. Did you mean %s?",name,camelize(name.replace(msPattern$1,"ms-"))))},warnBadVendoredStyleName=function(name){warnedStyleNames.hasOwnProperty(name)&&warnedStyleNames[name]||(warnedStyleNames[name]=!0,error("Unsupported vendor-prefixed style property %s. Did you mean %s?",name,name.charAt(0).toUpperCase()+name.slice(1)))},warnStyleValueWithSemicolon=function(name,value){warnedStyleValues.hasOwnProperty(value)&&warnedStyleValues[value]||(warnedStyleValues[value]=!0,error('Style property values shouldn\'t contain a semicolon. Try "%s: %s" instead.',name,value.replace(badStyleValueWithSemicolonPattern,"")))},warnStyleValueIsNaN=function(name,value){warnedForNaNValue||(warnedForNaNValue=!0,error("`NaN` is an invalid value for the `%s` css style property.",name))},warnStyleValueIsInfinity=function(name,value){warnedForInfinityValue||(warnedForInfinityValue=!0,error("`Infinity` is an invalid value for the `%s` css style property.",name))},warnValidStyle$1=warnValidStyle=function(name,value){name.indexOf("-")>-1?warnHyphenatedStyleName(name):badVendoredStyleNamePattern.test(name)?warnBadVendoredStyleName(name):badStyleValueWithSemicolonPattern.test(value)&&warnStyleValueWithSemicolon(name,value),"number"==typeof value&&(isNaN(value)?warnStyleValueIsNaN(name,value):isFinite(value)||warnStyleValueIsInfinity(name,value))};function createDangerousStringForStyles(styles){var serialized="",delimiter="";for(var styleName in styles)if(styles.hasOwnProperty(styleName)){var styleValue=styles[styleName];if(null!=styleValue){var isCustomProperty=0===styleName.indexOf("--");serialized+=delimiter+(isCustomProperty?styleName:hyphenateStyleName(styleName))+":",serialized+=dangerousStyleValue(styleName,styleValue,isCustomProperty),delimiter=";"}}return serialized||null}function setValueForStyles(node,styles){var style=node.style;for(var styleName in styles)if(styles.hasOwnProperty(styleName)){var isCustomProperty=0===styleName.indexOf("--");isCustomProperty||warnValidStyle$1(styleName,styles[styleName]);var styleValue=dangerousStyleValue(styleName,styles[styleName],isCustomProperty);"float"===styleName&&(styleName="cssFloat"),isCustomProperty?style.setProperty(styleName,styleValue):style[styleName]=styleValue}}function isValueEmpty(value){return null==value||"boolean"==typeof value||""===value}function expandShorthandMap(styles){var expanded={};for(var key in styles)for(var longhands=shorthandToLonghand[key]||[key],i=0;i<longhands.length;i++)expanded[longhands[i]]=key;return expanded}function validateShorthandPropertyCollisionInDev(styleUpdates,nextStyles){if(nextStyles){var expandedUpdates=expandShorthandMap(styleUpdates),expandedStyles=expandShorthandMap(nextStyles),warnedAbout={};for(var key in expandedUpdates){var originalKey=expandedUpdates[key],correctOriginalKey=expandedStyles[key];if(correctOriginalKey&&originalKey!==correctOriginalKey){var warningKey=originalKey+","+correctOriginalKey;if(warnedAbout[warningKey])continue;warnedAbout[warningKey]=!0,error("%s a style property during rerender (%s) when a conflicting property is set (%s) can lead to styling bugs. To avoid this, don't mix shorthand and non-shorthand properties for the same value; instead, replace the shorthand with separate values.",isValueEmpty(styleUpdates[originalKey])?"Removing":"Updating",originalKey,correctOriginalKey)}}}}var omittedCloseTags,voidElementTags=_assign({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0}),HTML="__html",ReactDebugCurrentFrame$3=null;function assertValidProps(tag,props){if(props){if(voidElementTags[tag]&&(null!=props.children||null!=props.dangerouslySetInnerHTML))throw Error(tag+" is a void element tag and must neither have `children` nor use `dangerouslySetInnerHTML`."+ReactDebugCurrentFrame$3.getStackAddendum());if(null!=props.dangerouslySetInnerHTML){if(null!=props.children)throw Error("Can only set one of `children` or `props.dangerouslySetInnerHTML`.");if(!("object"==typeof props.dangerouslySetInnerHTML&&HTML in props.dangerouslySetInnerHTML))throw Error("`props.dangerouslySetInnerHTML` must be in the form `{__html: ...}`. Please visit https://fb.me/react-invariant-dangerously-set-inner-html for more information.")}if(!props.suppressContentEditableWarning&&props.contentEditable&&null!=props.children&&error("A component is `contentEditable` and contains `children` managed by React. It is now your responsibility to guarantee that none of those nodes are unexpectedly modified or duplicated. This is probably not intentional."),null!=props.style&&"object"!=typeof props.style)throw Error("The `style` prop expects a mapping from style properties to values, not a string. For example, style={{marginRight: spacing + 'em'}} when using JSX."+ReactDebugCurrentFrame$3.getStackAddendum())}}function isCustomComponent(tagName,props){if(-1===tagName.indexOf("-"))return"string"==typeof props.is;switch(tagName){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}ReactDebugCurrentFrame$3=ReactSharedInternals.ReactDebugCurrentFrame;var possibleStandardNames={accept:"accept",acceptcharset:"acceptCharset","accept-charset":"acceptCharset",accesskey:"accessKey",action:"action",allowfullscreen:"allowFullScreen",alt:"alt",as:"as",async:"async",autocapitalize:"autoCapitalize",autocomplete:"autoComplete",autocorrect:"autoCorrect",autofocus:"autoFocus",autoplay:"autoPlay",autosave:"autoSave",capture:"capture",cellpadding:"cellPadding",cellspacing:"cellSpacing",challenge:"challenge",charset:"charSet",checked:"checked",children:"children",cite:"cite",class:"className",classid:"classID",classname:"className",cols:"cols",colspan:"colSpan",content:"content",contenteditable:"contentEditable",contextmenu:"contextMenu",controls:"controls",controlslist:"controlsList",coords:"coords",crossorigin:"crossOrigin",dangerouslysetinnerhtml:"dangerouslySetInnerHTML",data:"data",datetime:"dateTime",default:"default",defaultchecked:"defaultChecked",defaultvalue:"defaultValue",defer:"defer",dir:"dir",disabled:"disabled",disablepictureinpicture:"disablePictureInPicture",download:"download",draggable:"draggable",enctype:"encType",for:"htmlFor",form:"form",formmethod:"formMethod",formaction:"formAction",formenctype:"formEncType",formnovalidate:"formNoValidate",formtarget:"formTarget",frameborder:"frameBorder",headers:"headers",height:"height",hidden:"hidden",high:"high",href:"href",hreflang:"hrefLang",htmlfor:"htmlFor",httpequiv:"httpEquiv","http-equiv":"httpEquiv",icon:"icon",id:"id",innerhtml:"innerHTML",inputmode:"inputMode",integrity:"integrity",is:"is",itemid:"itemID",itemprop:"itemProp",itemref:"itemRef",itemscope:"itemScope",itemtype:"itemType",keyparams:"keyParams",keytype:"keyType",kind:"kind",label:"label",lang:"lang",list:"list",loop:"loop",low:"low",manifest:"manifest",marginwidth:"marginWidth",marginheight:"marginHeight",max:"max",maxlength:"maxLength",media:"media",mediagroup:"mediaGroup",method:"method",min:"min",minlength:"minLength",multiple:"multiple",muted:"muted",name:"name",nomodule:"noModule",nonce:"nonce",novalidate:"noValidate",open:"open",optimum:"optimum",pattern:"pattern",placeholder:"placeholder",playsinline:"playsInline",poster:"poster",preload:"preload",profile:"profile",radiogroup:"radioGroup",readonly:"readOnly",referrerpolicy:"referrerPolicy",rel:"rel",required:"required",reversed:"reversed",role:"role",rows:"rows",rowspan:"rowSpan",sandbox:"sandbox",scope:"scope",scoped:"scoped",scrolling:"scrolling",seamless:"seamless",selected:"selected",shape:"shape",size:"size",sizes:"sizes",span:"span",spellcheck:"spellCheck",src:"src",srcdoc:"srcDoc",srclang:"srcLang",srcset:"srcSet",start:"start",step:"step",style:"style",summary:"summary",tabindex:"tabIndex",target:"target",title:"title",type:"type",usemap:"useMap",value:"value",width:"width",wmode:"wmode",wrap:"wrap",about:"about",accentheight:"accentHeight","accent-height":"accentHeight",accumulate:"accumulate",additive:"additive",alignmentbaseline:"alignmentBaseline","alignment-baseline":"alignmentBaseline",allowreorder:"allowReorder",alphabetic:"alphabetic",amplitude:"amplitude",arabicform:"arabicForm","arabic-form":"arabicForm",ascent:"ascent",attributename:"attributeName",attributetype:"attributeType",autoreverse:"autoReverse",azimuth:"azimuth",basefrequency:"baseFrequency",baselineshift:"baselineShift","baseline-shift":"baselineShift",baseprofile:"baseProfile",bbox:"bbox",begin:"begin",bias:"bias",by:"by",calcmode:"calcMode",capheight:"capHeight","cap-height":"capHeight",clip:"clip",clippath:"clipPath","clip-path":"clipPath",clippathunits:"clipPathUnits",cliprule:"clipRule","clip-rule":"clipRule",color:"color",colorinterpolation:"colorInterpolation","color-interpolation":"colorInterpolation",colorinterpolationfilters:"colorInterpolationFilters","color-interpolation-filters":"colorInterpolationFilters",colorprofile:"colorProfile","color-profile":"colorProfile",colorrendering:"colorRendering","color-rendering":"colorRendering",contentscripttype:"contentScriptType",contentstyletype:"contentStyleType",cursor:"cursor",cx:"cx",cy:"cy",d:"d",datatype:"datatype",decelerate:"decelerate",descent:"descent",diffuseconstant:"diffuseConstant",direction:"direction",display:"display",divisor:"divisor",dominantbaseline:"dominantBaseline","dominant-baseline":"dominantBaseline",dur:"dur",dx:"dx",dy:"dy",edgemode:"edgeMode",elevation:"elevation",enablebackground:"enableBackground","enable-background":"enableBackground",end:"end",exponent:"exponent",externalresourcesrequired:"externalResourcesRequired",fill:"fill",fillopacity:"fillOpacity","fill-opacity":"fillOpacity",fillrule:"fillRule","fill-rule":"fillRule",filter:"filter",filterres:"filterRes",filterunits:"filterUnits",floodopacity:"floodOpacity","flood-opacity":"floodOpacity",floodcolor:"floodColor","flood-color":"floodColor",focusable:"focusable",fontfamily:"fontFamily","font-family":"fontFamily",fontsize:"fontSize","font-size":"fontSize",fontsizeadjust:"fontSizeAdjust","font-size-adjust":"fontSizeAdjust",fontstretch:"fontStretch","font-stretch":"fontStretch",fontstyle:"fontStyle","font-style":"fontStyle",fontvariant:"fontVariant","font-variant":"fontVariant",fontweight:"fontWeight","font-weight":"fontWeight",format:"format",from:"from",fx:"fx",fy:"fy",g1:"g1",g2:"g2",glyphname:"glyphName","glyph-name":"glyphName",glyphorientationhorizontal:"glyphOrientationHorizontal","glyph-orientation-horizontal":"glyphOrientationHorizontal",glyphorientationvertical:"glyphOrientationVertical","glyph-orientation-vertical":"glyphOrientationVertical",glyphref:"glyphRef",gradienttransform:"gradientTransform",gradientunits:"gradientUnits",hanging:"hanging",horizadvx:"horizAdvX","horiz-adv-x":"horizAdvX",horizoriginx:"horizOriginX","horiz-origin-x":"horizOriginX",ideographic:"ideographic",imagerendering:"imageRendering","image-rendering":"imageRendering",in2:"in2",in:"in",inlist:"inlist",intercept:"intercept",k1:"k1",k2:"k2",k3:"k3",k4:"k4",k:"k",kernelmatrix:"kernelMatrix",kernelunitlength:"kernelUnitLength",kerning:"kerning",keypoints:"keyPoints",keysplines:"keySplines",keytimes:"keyTimes",lengthadjust:"lengthAdjust",letterspacing:"letterSpacing","letter-spacing":"letterSpacing",lightingcolor:"lightingColor","lighting-color":"lightingColor",limitingconeangle:"limitingConeAngle",local:"local",markerend:"markerEnd","marker-end":"markerEnd",markerheight:"markerHeight",markermid:"markerMid","marker-mid":"markerMid",markerstart:"markerStart","marker-start":"markerStart",markerunits:"markerUnits",markerwidth:"markerWidth",mask:"mask",maskcontentunits:"maskContentUnits",maskunits:"maskUnits",mathematical:"mathematical",mode:"mode",numoctaves:"numOctaves",offset:"offset",opacity:"opacity",operator:"operator",order:"order",orient:"orient",orientation:"orientation",origin:"origin",overflow:"overflow",overlineposition:"overlinePosition","overline-position":"overlinePosition",overlinethickness:"overlineThickness","overline-thickness":"overlineThickness",paintorder:"paintOrder","paint-order":"paintOrder",panose1:"panose1","panose-1":"panose1",pathlength:"pathLength",patterncontentunits:"patternContentUnits",patterntransform:"patternTransform",patternunits:"patternUnits",pointerevents:"pointerEvents","pointer-events":"pointerEvents",points:"points",pointsatx:"pointsAtX",pointsaty:"pointsAtY",pointsatz:"pointsAtZ",prefix:"prefix",preservealpha:"preserveAlpha",preserveaspectratio:"preserveAspectRatio",primitiveunits:"primitiveUnits",property:"property",r:"r",radius:"radius",refx:"refX",refy:"refY",renderingintent:"renderingIntent","rendering-intent":"renderingIntent",repeatcount:"repeatCount",repeatdur:"repeatDur",requiredextensions:"requiredExtensions",requiredfeatures:"requiredFeatures",resource:"resource",restart:"restart",result:"result",results:"results",rotate:"rotate",rx:"rx",ry:"ry",scale:"scale",security:"security",seed:"seed",shaperendering:"shapeRendering","shape-rendering":"shapeRendering",slope:"slope",spacing:"spacing",specularconstant:"specularConstant",specularexponent:"specularExponent",speed:"speed",spreadmethod:"spreadMethod",startoffset:"startOffset",stddeviation:"stdDeviation",stemh:"stemh",stemv:"stemv",stitchtiles:"stitchTiles",stopcolor:"stopColor","stop-color":"stopColor",stopopacity:"stopOpacity","stop-opacity":"stopOpacity",strikethroughposition:"strikethroughPosition","strikethrough-position":"strikethroughPosition",strikethroughthickness:"strikethroughThickness","strikethrough-thickness":"strikethroughThickness",string:"string",stroke:"stroke",strokedasharray:"strokeDasharray","stroke-dasharray":"strokeDasharray",strokedashoffset:"strokeDashoffset","stroke-dashoffset":"strokeDashoffset",strokelinecap:"strokeLinecap","stroke-linecap":"strokeLinecap",strokelinejoin:"strokeLinejoin","stroke-linejoin":"strokeLinejoin",strokemiterlimit:"strokeMiterlimit","stroke-miterlimit":"strokeMiterlimit",strokewidth:"strokeWidth","stroke-width":"strokeWidth",strokeopacity:"strokeOpacity","stroke-opacity":"strokeOpacity",suppresscontenteditablewarning:"suppressContentEditableWarning",suppresshydrationwarning:"suppressHydrationWarning",surfacescale:"surfaceScale",systemlanguage:"systemLanguage",tablevalues:"tableValues",targetx:"targetX",targety:"targetY",textanchor:"textAnchor","text-anchor":"textAnchor",textdecoration:"textDecoration","text-decoration":"textDecoration",textlength:"textLength",textrendering:"textRendering","text-rendering":"textRendering",to:"to",transform:"transform",typeof:"typeof",u1:"u1",u2:"u2",underlineposition:"underlinePosition","underline-position":"underlinePosition",underlinethickness:"underlineThickness","underline-thickness":"underlineThickness",unicode:"unicode",unicodebidi:"unicodeBidi","unicode-bidi":"unicodeBidi",unicoderange:"unicodeRange","unicode-range":"unicodeRange",unitsperem:"unitsPerEm","units-per-em":"unitsPerEm",unselectable:"unselectable",valphabetic:"vAlphabetic","v-alphabetic":"vAlphabetic",values:"values",vectoreffect:"vectorEffect","vector-effect":"vectorEffect",version:"version",vertadvy:"vertAdvY","vert-adv-y":"vertAdvY",vertoriginx:"vertOriginX","vert-origin-x":"vertOriginX",vertoriginy:"vertOriginY","vert-origin-y":"vertOriginY",vhanging:"vHanging","v-hanging":"vHanging",videographic:"vIdeographic","v-ideographic":"vIdeographic",viewbox:"viewBox",viewtarget:"viewTarget",visibility:"visibility",vmathematical:"vMathematical","v-mathematical":"vMathematical",vocab:"vocab",widths:"widths",wordspacing:"wordSpacing","word-spacing":"wordSpacing",writingmode:"writingMode","writing-mode":"writingMode",x1:"x1",x2:"x2",x:"x",xchannelselector:"xChannelSelector",xheight:"xHeight","x-height":"xHeight",xlinkactuate:"xlinkActuate","xlink:actuate":"xlinkActuate",xlinkarcrole:"xlinkArcrole","xlink:arcrole":"xlinkArcrole",xlinkhref:"xlinkHref","xlink:href":"xlinkHref",xlinkrole:"xlinkRole","xlink:role":"xlinkRole",xlinkshow:"xlinkShow","xlink:show":"xlinkShow",xlinktitle:"xlinkTitle","xlink:title":"xlinkTitle",xlinktype:"xlinkType","xlink:type":"xlinkType",xmlbase:"xmlBase","xml:base":"xmlBase",xmllang:"xmlLang","xml:lang":"xmlLang",xmlns:"xmlns","xml:space":"xmlSpace",xmlnsxlink:"xmlnsXlink","xmlns:xlink":"xmlnsXlink",xmlspace:"xmlSpace",y1:"y1",y2:"y2",y:"y",ychannelselector:"yChannelSelector",z:"z",zoomandpan:"zoomAndPan"},ariaProperties={"aria-current":0,"aria-details":0,"aria-disabled":0,"aria-hidden":0,"aria-invalid":0,"aria-keyshortcuts":0,"aria-label":0,"aria-roledescription":0,"aria-autocomplete":0,"aria-checked":0,"aria-expanded":0,"aria-haspopup":0,"aria-level":0,"aria-modal":0,"aria-multiline":0,"aria-multiselectable":0,"aria-orientation":0,"aria-placeholder":0,"aria-pressed":0,"aria-readonly":0,"aria-required":0,"aria-selected":0,"aria-sort":0,"aria-valuemax":0,"aria-valuemin":0,"aria-valuenow":0,"aria-valuetext":0,"aria-atomic":0,"aria-busy":0,"aria-live":0,"aria-relevant":0,"aria-dropeffect":0,"aria-grabbed":0,"aria-activedescendant":0,"aria-colcount":0,"aria-colindex":0,"aria-colspan":0,"aria-controls":0,"aria-describedby":0,"aria-errormessage":0,"aria-flowto":0,"aria-labelledby":0,"aria-owns":0,"aria-posinset":0,"aria-rowcount":0,"aria-rowindex":0,"aria-rowspan":0,"aria-setsize":0},warnedProperties={},rARIA=new RegExp("^(aria)-["+ATTRIBUTE_NAME_CHAR+"]*$"),rARIACamel=new RegExp("^(aria)[A-Z]["+ATTRIBUTE_NAME_CHAR+"]*$"),hasOwnProperty$1=Object.prototype.hasOwnProperty;function validateProperty(tagName,name){if(hasOwnProperty$1.call(warnedProperties,name)&&warnedProperties[name])return!0;if(rARIACamel.test(name)){var ariaName="aria-"+name.slice(4).toLowerCase(),correctName=ariaProperties.hasOwnProperty(ariaName)?ariaName:null;if(null==correctName)return error("Invalid ARIA attribute `%s`. ARIA attributes follow the pattern aria-* and must be lowercase.",name),warnedProperties[name]=!0,!0;if(name!==correctName)return error("Invalid ARIA attribute `%s`. Did you mean `%s`?",name,correctName),warnedProperties[name]=!0,!0}if(rARIA.test(name)){var lowerCasedName=name.toLowerCase(),standardName=ariaProperties.hasOwnProperty(lowerCasedName)?lowerCasedName:null;if(null==standardName)return warnedProperties[name]=!0,!1;if(name!==standardName)return error("Unknown ARIA attribute `%s`. Did you mean `%s`?",name,standardName),warnedProperties[name]=!0,!0}return!0}function warnInvalidARIAProps(type,props){var invalidProps=[];for(var key in props){var isValid;validateProperty(type,key)||invalidProps.push(key)}var unknownPropString=invalidProps.map((function(prop){return"`"+prop+"`"})).join(", ");1===invalidProps.length?error("Invalid aria prop %s on <%s> tag. For details, see https://fb.me/invalid-aria-prop",unknownPropString,type):invalidProps.length>1&&error("Invalid aria props %s on <%s> tag. For details, see https://fb.me/invalid-aria-prop",unknownPropString,type)}function validateProperties(type,props){isCustomComponent(type,props)||warnInvalidARIAProps(type,props)}var didWarnValueNull=!1;function validateProperties$1(type,props){"input"!==type&&"textarea"!==type&&"select"!==type||null==props||null!==props.value||didWarnValueNull||(didWarnValueNull=!0,"select"===type&&props.multiple?error("`value` prop on `%s` should not be null. Consider using an empty array when `multiple` is set to `true` to clear the component or `undefined` for uncontrolled components.",type):error("`value` prop on `%s` should not be null. Consider using an empty string to clear the component or `undefined` for uncontrolled components.",type))}var validateProperty$1=function(){},warnedProperties$1={},_hasOwnProperty=Object.prototype.hasOwnProperty,EVENT_NAME_REGEX=/^on./,INVALID_EVENT_NAME_REGEX=/^on[^A-Z]/,rARIA$1=new RegExp("^(aria)-["+ATTRIBUTE_NAME_CHAR+"]*$"),rARIACamel$1=new RegExp("^(aria)[A-Z]["+ATTRIBUTE_NAME_CHAR+"]*$");validateProperty$1=function(tagName,name,value,canUseEventSystem){if(_hasOwnProperty.call(warnedProperties$1,name)&&warnedProperties$1[name])return!0;var lowerCasedName=name.toLowerCase();if("onfocusin"===lowerCasedName||"onfocusout"===lowerCasedName)return error("React uses onFocus and onBlur instead of onFocusIn and onFocusOut. All React events are normalized to bubble, so onFocusIn and onFocusOut are not needed/supported by React."),warnedProperties$1[name]=!0,!0;if(canUseEventSystem){if(registrationNameModules.hasOwnProperty(name))return!0;var registrationName=possibleRegistrationNames.hasOwnProperty(lowerCasedName)?possibleRegistrationNames[lowerCasedName]:null;if(null!=registrationName)return error("Invalid event handler property `%s`. Did you mean `%s`?",name,registrationName),warnedProperties$1[name]=!0,!0;if(EVENT_NAME_REGEX.test(name))return error("Unknown event handler property `%s`. It will be ignored.",name),warnedProperties$1[name]=!0,!0}else if(EVENT_NAME_REGEX.test(name))return INVALID_EVENT_NAME_REGEX.test(name)&&error("Invalid event handler property `%s`. React events use the camelCase naming convention, for example `onClick`.",name),warnedProperties$1[name]=!0,!0;if(rARIA$1.test(name)||rARIACamel$1.test(name))return!0;if("innerhtml"===lowerCasedName)return error("Directly setting property `innerHTML` is not permitted. For more information, lookup documentation on `dangerouslySetInnerHTML`."),warnedProperties$1[name]=!0,!0;if("aria"===lowerCasedName)return error("The `aria` attribute is reserved for future use in React. Pass individual `aria-` attributes instead."),warnedProperties$1[name]=!0,!0;if("is"===lowerCasedName&&null!=value&&"string"!=typeof value)return error("Received a `%s` for a string attribute `is`. If this is expected, cast the value to a string.",typeof value),warnedProperties$1[name]=!0,!0;if("number"==typeof value&&isNaN(value))return error("Received NaN for the `%s` attribute. If this is expected, cast the value to a string.",name),warnedProperties$1[name]=!0,!0;var propertyInfo=getPropertyInfo(name),isReserved=null!==propertyInfo&&0===propertyInfo.type;if(possibleStandardNames.hasOwnProperty(lowerCasedName)){var standardName=possibleStandardNames[lowerCasedName];if(standardName!==name)return error("Invalid DOM property `%s`. Did you mean `%s`?",name,standardName),warnedProperties$1[name]=!0,!0}else if(!isReserved&&name!==lowerCasedName)return error("React does not recognize the `%s` prop on a DOM element. If you intentionally want it to appear in the DOM as a custom attribute, spell it as lowercase `%s` instead. If you accidentally passed it from a parent component, remove it from the DOM element.",name,lowerCasedName),warnedProperties$1[name]=!0,!0;return"boolean"==typeof value&&shouldRemoveAttributeWithWarning(name,value,propertyInfo,!1)?(value?error('Received `%s` for a non-boolean attribute `%s`.\n\nIf you want to write it to the DOM, pass a string instead: %s="%s" or %s={value.toString()}.',value,name,name,value,name):error('Received `%s` for a non-boolean attribute `%s`.\n\nIf you want to write it to the DOM, pass a string instead: %s="%s" or %s={value.toString()}.\n\nIf you used to conditionally omit it with %s={condition && value}, pass %s={condition ? value : undefined} instead.',value,name,name,value,name,name,name),warnedProperties$1[name]=!0,!0):!!isReserved||(shouldRemoveAttributeWithWarning(name,value,propertyInfo,!1)?(warnedProperties$1[name]=!0,!1):"false"!==value&&"true"!==value||null===propertyInfo||3!==propertyInfo.type||(error("Received the string `%s` for the boolean attribute `%s`. %s Did you mean %s={%s}?",value,name,"false"===value?"The browser will interpret it as a truthy value.":'Although this works, it will not work as expected if you pass the string "false".',name,value),warnedProperties$1[name]=!0,!0))};var warnUnknownProperties=function(type,props,canUseEventSystem){var unknownProps=[];for(var key in props){var isValid;validateProperty$1(type,key,props[key],canUseEventSystem)||unknownProps.push(key)}var unknownPropString=unknownProps.map((function(prop){return"`"+prop+"`"})).join(", ");1===unknownProps.length?error("Invalid value for prop %s on <%s> tag. Either remove it from the element, or pass a string or number value to keep it in the DOM. For details, see https://fb.me/react-attribute-behavior",unknownPropString,type):unknownProps.length>1&&error("Invalid values for props %s on <%s> tag. Either remove them from the element, or pass a string or number value to keep them in the DOM. For details, see https://fb.me/react-attribute-behavior",unknownPropString,type)};function validateProperties$2(type,props,canUseEventSystem){isCustomComponent(type,props)||warnUnknownProperties(type,props,canUseEventSystem)}var didWarnInvalidHydration=!1,DANGEROUSLY_SET_INNER_HTML="dangerouslySetInnerHTML",SUPPRESS_CONTENT_EDITABLE_WARNING="suppressContentEditableWarning",SUPPRESS_HYDRATION_WARNING="suppressHydrationWarning",AUTOFOCUS="autoFocus",CHILDREN="children",STYLE="style",HTML$1="__html",HTML_NAMESPACE$1=Namespaces_html,warnedUnknownTags,suppressHydrationWarning,validatePropertiesInDevelopment,warnForTextDifference,warnForPropDifference,warnForExtraAttributes,warnForInvalidEventListener,canDiffStyleForHydrationWarning,normalizeMarkupForTextOrAttribute,normalizeHTML;warnedUnknownTags={time:!0,dialog:!0,webview:!0},validatePropertiesInDevelopment=function(type,props){validateProperties(type,props),validateProperties$1(type,props),validateProperties$2(type,props,!0)},canDiffStyleForHydrationWarning=canUseDOM&&!document.documentMode;var NORMALIZE_NEWLINES_REGEX=/\r\n?/g,NORMALIZE_NULL_AND_REPLACEMENT_REGEX=/\u0000|\uFFFD/g;function ensureListeningTo(rootContainerElement,registrationName){var isDocumentOrFragment,doc;legacyListenToEvent(registrationName,9===rootContainerElement.nodeType||11===rootContainerElement.nodeType?rootContainerElement:rootContainerElement.ownerDocument)}function getOwnerDocumentFromRootContainer(rootContainerElement){return 9===rootContainerElement.nodeType?rootContainerElement:rootContainerElement.ownerDocument}function noop(){}function trapClickOnNonInteractiveElement(node){node.onclick=noop}function setInitialDOMProperties(tag,domElement,rootContainerElement,nextProps,isCustomComponentTag){for(var propKey in nextProps)if(nextProps.hasOwnProperty(propKey)){var nextProp=nextProps[propKey];if(propKey===STYLE)nextProp&&Object.freeze(nextProp),setValueForStyles(domElement,nextProp);else if("dangerouslySetInnerHTML"===propKey){var nextHtml=nextProp?nextProp.__html:void 0;null!=nextHtml&&setInnerHTML(domElement,nextHtml)}else if(propKey===CHILDREN){var canSetTextContent;if("string"==typeof nextProp)("textarea"!==tag||""!==nextProp)&&setTextContent(domElement,nextProp);else"number"==typeof nextProp&&setTextContent(domElement,""+nextProp)}else"suppressContentEditableWarning"===propKey||"suppressHydrationWarning"===propKey||propKey===AUTOFOCUS||(registrationNameModules.hasOwnProperty(propKey)?null!=nextProp&&("function"!=typeof nextProp&&warnForInvalidEventListener(propKey,nextProp),ensureListeningTo(rootContainerElement,propKey)):null!=nextProp&&setValueForProperty(domElement,propKey,nextProp,isCustomComponentTag))}}function updateDOMProperties(domElement,updatePayload,wasCustomComponentTag,isCustomComponentTag){for(var i=0;i<updatePayload.length;i+=2){var propKey=updatePayload[i],propValue=updatePayload[i+1];propKey===STYLE?setValueForStyles(domElement,propValue):"dangerouslySetInnerHTML"===propKey?setInnerHTML(domElement,propValue):propKey===CHILDREN?setTextContent(domElement,propValue):setValueForProperty(domElement,propKey,propValue,isCustomComponentTag)}}function createElement(type,props,rootContainerElement,parentNamespace){var isCustomComponentTag,ownerDocument=getOwnerDocumentFromRootContainer(rootContainerElement),domElement,namespaceURI=parentNamespace;if(namespaceURI===HTML_NAMESPACE$1&&(namespaceURI=getIntrinsicNamespace(type)),namespaceURI===HTML_NAMESPACE$1){if((isCustomComponentTag=isCustomComponent(type,props))||type===type.toLowerCase()||error("<%s /> is using incorrect casing. Use PascalCase for React components, or lowercase for HTML elements.",type),"script"===type){var div=ownerDocument.createElement("div");div.innerHTML="<script><\/script>";var firstChild=div.firstChild;domElement=div.removeChild(firstChild)}else if("string"==typeof props.is)domElement=ownerDocument.createElement(type,{is:props.is});else if(domElement=ownerDocument.createElement(type),"select"===type){var node=domElement;props.multiple?node.multiple=!0:props.size&&(node.size=props.size)}}else domElement=ownerDocument.createElementNS(namespaceURI,type);return namespaceURI===HTML_NAMESPACE$1&&(isCustomComponentTag||"[object HTMLUnknownElement]"!==Object.prototype.toString.call(domElement)||Object.prototype.hasOwnProperty.call(warnedUnknownTags,type)||(warnedUnknownTags[type]=!0,error("The tag <%s> is unrecognized in this browser. If you meant to render a React component, start its name with an uppercase letter.",type))),domElement}function createTextNode(text,rootContainerElement){return getOwnerDocumentFromRootContainer(rootContainerElement).createTextNode(text)}function setInitialProperties(domElement,tag,rawProps,rootContainerElement){var isCustomComponentTag=isCustomComponent(tag,rawProps),props;switch(validatePropertiesInDevelopment(tag,rawProps),tag){case"iframe":case"object":case"embed":trapBubbledEvent("load",domElement),props=rawProps;break;case"video":case"audio":for(var i=0;i<mediaEventTypes.length;i++)trapBubbledEvent(mediaEventTypes[i],domElement);props=rawProps;break;case"source":trapBubbledEvent("error",domElement),props=rawProps;break;case"img":case"image":case"link":trapBubbledEvent("error",domElement),trapBubbledEvent("load",domElement),props=rawProps;break;case"form":trapBubbledEvent("reset",domElement),trapBubbledEvent("submit",domElement),props=rawProps;break;case"details":trapBubbledEvent("toggle",domElement),props=rawProps;break;case"input":initWrapperState(domElement,rawProps),props=getHostProps(domElement,rawProps),trapBubbledEvent("invalid",domElement),ensureListeningTo(rootContainerElement,"onChange");break;case"option":validateProps(domElement,rawProps),props=getHostProps$1(domElement,rawProps);break;case"select":initWrapperState$1(domElement,rawProps),props=getHostProps$2(domElement,rawProps),trapBubbledEvent("invalid",domElement),ensureListeningTo(rootContainerElement,"onChange");break;case"textarea":initWrapperState$2(domElement,rawProps),props=getHostProps$3(domElement,rawProps),trapBubbledEvent("invalid",domElement),ensureListeningTo(rootContainerElement,"onChange");break;default:props=rawProps}switch(assertValidProps(tag,props),setInitialDOMProperties(tag,domElement,rootContainerElement,props,isCustomComponentTag),tag){case"input":track(domElement),postMountWrapper(domElement,rawProps,!1);break;case"textarea":track(domElement),postMountWrapper$3(domElement);break;case"option":postMountWrapper$1(domElement,rawProps);break;case"select":postMountWrapper$2(domElement,rawProps);break;default:"function"==typeof props.onClick&&trapClickOnNonInteractiveElement(domElement)}}function diffProperties(domElement,tag,lastRawProps,nextRawProps,rootContainerElement){validatePropertiesInDevelopment(tag,nextRawProps);var updatePayload=null,lastProps,nextProps,propKey,styleName;switch(tag){case"input":lastProps=getHostProps(domElement,lastRawProps),nextProps=getHostProps(domElement,nextRawProps),updatePayload=[];break;case"option":lastProps=getHostProps$1(domElement,lastRawProps),nextProps=getHostProps$1(domElement,nextRawProps),updatePayload=[];break;case"select":lastProps=getHostProps$2(domElement,lastRawProps),nextProps=getHostProps$2(domElement,nextRawProps),updatePayload=[];break;case"textarea":lastProps=getHostProps$3(domElement,lastRawProps),nextProps=getHostProps$3(domElement,nextRawProps),updatePayload=[];break;default:nextProps=nextRawProps,"function"!=typeof(lastProps=lastRawProps).onClick&&"function"==typeof nextProps.onClick&&trapClickOnNonInteractiveElement(domElement)}assertValidProps(tag,nextProps);var styleUpdates=null;for(propKey in lastProps)if(!nextProps.hasOwnProperty(propKey)&&lastProps.hasOwnProperty(propKey)&&null!=lastProps[propKey])if(propKey===STYLE){var lastStyle=lastProps[propKey];for(styleName in lastStyle)lastStyle.hasOwnProperty(styleName)&&(styleUpdates||(styleUpdates={}),styleUpdates[styleName]="")}else"dangerouslySetInnerHTML"===propKey||propKey===CHILDREN||"suppressContentEditableWarning"===propKey||"suppressHydrationWarning"===propKey||propKey===AUTOFOCUS||(registrationNameModules.hasOwnProperty(propKey)?updatePayload||(updatePayload=[]):(updatePayload=updatePayload||[]).push(propKey,null));for(propKey in nextProps){var nextProp=nextProps[propKey],lastProp=null!=lastProps?lastProps[propKey]:void 0;if(nextProps.hasOwnProperty(propKey)&&nextProp!==lastProp&&(null!=nextProp||null!=lastProp))if(propKey===STYLE)if(nextProp&&Object.freeze(nextProp),lastProp){for(styleName in lastProp)!lastProp.hasOwnProperty(styleName)||nextProp&&nextProp.hasOwnProperty(styleName)||(styleUpdates||(styleUpdates={}),styleUpdates[styleName]="");for(styleName in nextProp)nextProp.hasOwnProperty(styleName)&&lastProp[styleName]!==nextProp[styleName]&&(styleUpdates||(styleUpdates={}),styleUpdates[styleName]=nextProp[styleName])}else styleUpdates||(updatePayload||(updatePayload=[]),updatePayload.push(propKey,styleUpdates)),styleUpdates=nextProp;else if("dangerouslySetInnerHTML"===propKey){var nextHtml=nextProp?nextProp.__html:void 0,lastHtml=lastProp?lastProp.__html:void 0;null!=nextHtml&&lastHtml!==nextHtml&&(updatePayload=updatePayload||[]).push(propKey,nextHtml)}else propKey===CHILDREN?lastProp===nextProp||"string"!=typeof nextProp&&"number"!=typeof nextProp||(updatePayload=updatePayload||[]).push(propKey,""+nextProp):"suppressContentEditableWarning"===propKey||"suppressHydrationWarning"===propKey||(registrationNameModules.hasOwnProperty(propKey)?(null!=nextProp&&("function"!=typeof nextProp&&warnForInvalidEventListener(propKey,nextProp),ensureListeningTo(rootContainerElement,propKey)),updatePayload||lastProp===nextProp||(updatePayload=[])):(updatePayload=updatePayload||[]).push(propKey,nextProp))}return styleUpdates&&(validateShorthandPropertyCollisionInDev(styleUpdates,nextProps.style),(updatePayload=updatePayload||[]).push(STYLE,styleUpdates)),updatePayload}function updateProperties(domElement,updatePayload,tag,lastRawProps,nextRawProps){var wasCustomComponentTag,isCustomComponentTag;switch("input"===tag&&"radio"===nextRawProps.type&&null!=nextRawProps.name&&updateChecked(domElement,nextRawProps),updateDOMProperties(domElement,updatePayload,isCustomComponent(tag,lastRawProps),isCustomComponent(tag,nextRawProps)),tag){case"input":updateWrapper(domElement,nextRawProps);break;case"textarea":updateWrapper$1(domElement,nextRawProps);break;case"select":postUpdateWrapper(domElement,nextRawProps)}}function getPossibleStandardName(propName){var lowerCasedName=propName.toLowerCase();return possibleStandardNames.hasOwnProperty(lowerCasedName)&&possibleStandardNames[lowerCasedName]||null}function diffHydratedProperties(domElement,tag,rawProps,parentNamespace,rootContainerElement){var isCustomComponentTag,extraAttributeNames;switch(suppressHydrationWarning=!0===rawProps.suppressHydrationWarning,isCustomComponentTag=isCustomComponent(tag,rawProps),validatePropertiesInDevelopment(tag,rawProps),tag){case"iframe":case"object":case"embed":trapBubbledEvent("load",domElement);break;case"video":case"audio":for(var i=0;i<mediaEventTypes.length;i++)trapBubbledEvent(mediaEventTypes[i],domElement);break;case"source":trapBubbledEvent("error",domElement);break;case"img":case"image":case"link":trapBubbledEvent("error",domElement),trapBubbledEvent("load",domElement);break;case"form":trapBubbledEvent("reset",domElement),trapBubbledEvent("submit",domElement);break;case"details":trapBubbledEvent("toggle",domElement);break;case"input":initWrapperState(domElement,rawProps),trapBubbledEvent("invalid",domElement),ensureListeningTo(rootContainerElement,"onChange");break;case"option":validateProps(domElement,rawProps);break;case"select":initWrapperState$1(domElement,rawProps),trapBubbledEvent("invalid",domElement),ensureListeningTo(rootContainerElement,"onChange");break;case"textarea":initWrapperState$2(domElement,rawProps),trapBubbledEvent("invalid",domElement),ensureListeningTo(rootContainerElement,"onChange")}assertValidProps(tag,rawProps),extraAttributeNames=new Set;for(var attributes=domElement.attributes,_i=0;_i<attributes.length;_i++){var name;switch(attributes[_i].name.toLowerCase()){case"data-reactroot":case"value":case"checked":case"selected":break;default:extraAttributeNames.add(attributes[_i].name)}}var updatePayload=null;for(var propKey in rawProps)if(rawProps.hasOwnProperty(propKey)){var nextProp=rawProps[propKey];if(propKey===CHILDREN)"string"==typeof nextProp?domElement.textContent!==nextProp&&(suppressHydrationWarning||warnForTextDifference(domElement.textContent,nextProp),updatePayload=[CHILDREN,nextProp]):"number"==typeof nextProp&&domElement.textContent!==""+nextProp&&(suppressHydrationWarning||warnForTextDifference(domElement.textContent,nextProp),updatePayload=[CHILDREN,""+nextProp]);else if(registrationNameModules.hasOwnProperty(propKey))null!=nextProp&&("function"!=typeof nextProp&&warnForInvalidEventListener(propKey,nextProp),ensureListeningTo(rootContainerElement,propKey));else if("boolean"==typeof isCustomComponentTag){var serverValue=void 0,propertyInfo=getPropertyInfo(propKey);if(suppressHydrationWarning);else if("suppressContentEditableWarning"===propKey||"suppressHydrationWarning"===propKey||"value"===propKey||"checked"===propKey||"selected"===propKey);else if("dangerouslySetInnerHTML"===propKey){var serverHTML=domElement.innerHTML,nextHtml=nextProp?nextProp.__html:void 0,expectedHTML=normalizeHTML(domElement,null!=nextHtml?nextHtml:"");expectedHTML!==serverHTML&&warnForPropDifference(propKey,serverHTML,expectedHTML)}else if(propKey===STYLE){if(extraAttributeNames.delete(propKey),canDiffStyleForHydrationWarning){var expectedStyle=createDangerousStringForStyles(nextProp);expectedStyle!==(serverValue=domElement.getAttribute("style"))&&warnForPropDifference(propKey,serverValue,expectedStyle)}}else if(isCustomComponentTag)extraAttributeNames.delete(propKey.toLowerCase()),nextProp!==(serverValue=getValueForAttribute(domElement,propKey,nextProp))&&warnForPropDifference(propKey,serverValue,nextProp);else if(!shouldIgnoreAttribute(propKey,propertyInfo,isCustomComponentTag)&&!shouldRemoveAttribute(propKey,nextProp,propertyInfo,isCustomComponentTag)){var isMismatchDueToBadCasing=!1;if(null!==propertyInfo)extraAttributeNames.delete(propertyInfo.attributeName),serverValue=getValueForProperty(domElement,propKey,nextProp,propertyInfo);else{var ownNamespace=parentNamespace;if(ownNamespace===HTML_NAMESPACE$1&&(ownNamespace=getIntrinsicNamespace(tag)),ownNamespace===HTML_NAMESPACE$1)extraAttributeNames.delete(propKey.toLowerCase());else{var standardName=getPossibleStandardName(propKey);null!==standardName&&standardName!==propKey&&(isMismatchDueToBadCasing=!0,extraAttributeNames.delete(standardName)),extraAttributeNames.delete(propKey)}serverValue=getValueForAttribute(domElement,propKey,nextProp)}nextProp===serverValue||isMismatchDueToBadCasing||warnForPropDifference(propKey,serverValue,nextProp)}}}switch(extraAttributeNames.size>0&&!suppressHydrationWarning&&warnForExtraAttributes(extraAttributeNames),tag){case"input":track(domElement),postMountWrapper(domElement,rawProps,!0);break;case"textarea":track(domElement),postMountWrapper$3(domElement);break;case"select":case"option":break;default:"function"==typeof rawProps.onClick&&trapClickOnNonInteractiveElement(domElement)}return updatePayload}function diffHydratedText(textNode,text){var isDifferent;return textNode.nodeValue!==text}function warnForUnmatchedText(textNode,text){warnForTextDifference(textNode.nodeValue,text)}function warnForDeletedHydratableElement(parentNode,child){didWarnInvalidHydration||(didWarnInvalidHydration=!0,error("Did not expect server HTML to contain a <%s> in <%s>.",child.nodeName.toLowerCase(),parentNode.nodeName.toLowerCase()))}function warnForDeletedHydratableText(parentNode,child){didWarnInvalidHydration||(didWarnInvalidHydration=!0,error('Did not expect server HTML to contain the text node "%s" in <%s>.',child.nodeValue,parentNode.nodeName.toLowerCase()))}function warnForInsertedHydratedElement(parentNode,tag,props){didWarnInvalidHydration||(didWarnInvalidHydration=!0,error("Expected server HTML to contain a matching <%s> in <%s>.",tag,parentNode.nodeName.toLowerCase()))}function warnForInsertedHydratedText(parentNode,text){""!==text&&(didWarnInvalidHydration||(didWarnInvalidHydration=!0,error('Expected server HTML to contain a matching text node for "%s" in <%s>.',text,parentNode.nodeName.toLowerCase())))}function restoreControlledState$3(domElement,tag,props){switch(tag){case"input":return void restoreControlledState(domElement,props);case"textarea":return void restoreControlledState$2(domElement,props);case"select":return void restoreControlledState$1(domElement,props)}}function getActiveElement(doc){if(void 0===(doc=doc||("undefined"!=typeof document?document:void 0)))return null;try{return doc.activeElement||doc.body}catch(e){return doc.body}}function getLeafNode(node){for(;node&&node.firstChild;)node=node.firstChild;return node}function getSiblingNode(node){for(;node;){if(node.nextSibling)return node.nextSibling;node=node.parentNode}}function getNodeForCharacterOffset(root,offset){for(var node=getLeafNode(root),nodeStart=0,nodeEnd=0;node;){if(3===node.nodeType){if(nodeEnd=nodeStart+node.textContent.length,nodeStart<=offset&&nodeEnd>=offset)return{node:node,offset:offset-nodeStart};nodeStart=nodeEnd}node=getLeafNode(getSiblingNode(node))}}function getOffsets(outerNode){var ownerDocument=outerNode.ownerDocument,win=ownerDocument&&ownerDocument.defaultView||window,selection=win.getSelection&&win.getSelection();if(!selection||0===selection.rangeCount)return null;var anchorNode=selection.anchorNode,anchorOffset=selection.anchorOffset,focusNode=selection.focusNode,focusOffset=selection.focusOffset;try{anchorNode.nodeType,focusNode.nodeType}catch(e){return null}return getModernOffsetsFromPoints(outerNode,anchorNode,anchorOffset,focusNode,focusOffset)}function getModernOffsetsFromPoints(outerNode,anchorNode,anchorOffset,focusNode,focusOffset){var length=0,start=-1,end=-1,indexWithinAnchor=0,indexWithinFocus=0,node=outerNode,parentNode=null;outer:for(;;){for(var next=null;node!==anchorNode||0!==anchorOffset&&3!==node.nodeType||(start=length+anchorOffset),node!==focusNode||0!==focusOffset&&3!==node.nodeType||(end=length+focusOffset),3===node.nodeType&&(length+=node.nodeValue.length),null!==(next=node.firstChild);)parentNode=node,node=next;for(;;){if(node===outerNode)break outer;if(parentNode===anchorNode&&++indexWithinAnchor===anchorOffset&&(start=length),parentNode===focusNode&&++indexWithinFocus===focusOffset&&(end=length),null!==(next=node.nextSibling))break;parentNode=(node=parentNode).parentNode}node=next}return-1===start||-1===end?null:{start:start,end:end}}function setOffsets(node,offsets){var doc=node.ownerDocument||document,win=doc&&doc.defaultView||window;if(win.getSelection){var selection=win.getSelection(),length=node.textContent.length,start=Math.min(offsets.start,length),end=void 0===offsets.end?start:Math.min(offsets.end,length);if(!selection.extend&&start>end){var temp=end;end=start,start=temp}var startMarker=getNodeForCharacterOffset(node,start),endMarker=getNodeForCharacterOffset(node,end);if(startMarker&&endMarker){if(1===selection.rangeCount&&selection.anchorNode===startMarker.node&&selection.anchorOffset===startMarker.offset&&selection.focusNode===endMarker.node&&selection.focusOffset===endMarker.offset)return;var range=doc.createRange();range.setStart(startMarker.node,startMarker.offset),selection.removeAllRanges(),start>end?(selection.addRange(range),selection.extend(endMarker.node,endMarker.offset)):(range.setEnd(endMarker.node,endMarker.offset),selection.addRange(range))}}}function isTextNode(node){return node&&3===node.nodeType}function containsNode(outerNode,innerNode){return!(!outerNode||!innerNode)&&(outerNode===innerNode||!isTextNode(outerNode)&&(isTextNode(innerNode)?containsNode(outerNode,innerNode.parentNode):"contains"in outerNode?outerNode.contains(innerNode):!!outerNode.compareDocumentPosition&&!!(16&outerNode.compareDocumentPosition(innerNode))))}function isInDocument(node){return node&&node.ownerDocument&&containsNode(node.ownerDocument.documentElement,node)}function isSameOriginFrame(iframe){try{return"string"==typeof iframe.contentWindow.location.href}catch(err){return!1}}function getActiveElementDeep(){for(var win=window,element=getActiveElement();element instanceof win.HTMLIFrameElement;){if(!isSameOriginFrame(element))return element;element=getActiveElement((win=element.contentWindow).document)}return element}function hasSelectionCapabilities(elem){var nodeName=elem&&elem.nodeName&&elem.nodeName.toLowerCase();return nodeName&&("input"===nodeName&&("text"===elem.type||"search"===elem.type||"tel"===elem.type||"url"===elem.type||"password"===elem.type)||"textarea"===nodeName||"true"===elem.contentEditable)}function getSelectionInformation(){var focusedElem=getActiveElementDeep();return{activeElementDetached:null,focusedElem:focusedElem,selectionRange:hasSelectionCapabilities(focusedElem)?getSelection(focusedElem):null}}function restoreSelection(priorSelectionInformation){var curFocusedElem=getActiveElementDeep(),priorFocusedElem=priorSelectionInformation.focusedElem,priorSelectionRange=priorSelectionInformation.selectionRange;if(curFocusedElem!==priorFocusedElem&&isInDocument(priorFocusedElem)){null!==priorSelectionRange&&hasSelectionCapabilities(priorFocusedElem)&&setSelection(priorFocusedElem,priorSelectionRange);for(var ancestors=[],ancestor=priorFocusedElem;ancestor=ancestor.parentNode;)1===ancestor.nodeType&&ancestors.push({element:ancestor,left:ancestor.scrollLeft,top:ancestor.scrollTop});"function"==typeof priorFocusedElem.focus&&priorFocusedElem.focus();for(var i=0;i<ancestors.length;i++){var info=ancestors[i];info.element.scrollLeft=info.left,info.element.scrollTop=info.top}}}function getSelection(input){var selection;return(selection="selectionStart"in input?{start:input.selectionStart,end:input.selectionEnd}:getOffsets(input))||{start:0,end:0}}function setSelection(input,offsets){var start=offsets.start,end=offsets.end;void 0===end&&(end=start),"selectionStart"in input?(input.selectionStart=start,input.selectionEnd=Math.min(end,input.value.length)):setOffsets(input,offsets)}normalizeMarkupForTextOrAttribute=function(markup){var markupString;return("string"==typeof markup?markup:""+markup).replace(NORMALIZE_NEWLINES_REGEX,"\n").replace(NORMALIZE_NULL_AND_REPLACEMENT_REGEX,"")},warnForTextDifference=function(serverText,clientText){if(!didWarnInvalidHydration){var normalizedClientText=normalizeMarkupForTextOrAttribute(clientText),normalizedServerText=normalizeMarkupForTextOrAttribute(serverText);normalizedServerText!==normalizedClientText&&(didWarnInvalidHydration=!0,error('Text content did not match. Server: "%s" Client: "%s"',normalizedServerText,normalizedClientText))}},warnForPropDifference=function(propName,serverValue,clientValue){if(!didWarnInvalidHydration){var normalizedClientValue=normalizeMarkupForTextOrAttribute(clientValue),normalizedServerValue=normalizeMarkupForTextOrAttribute(serverValue);normalizedServerValue!==normalizedClientValue&&(didWarnInvalidHydration=!0,error("Prop `%s` did not match. Server: %s Client: %s",propName,JSON.stringify(normalizedServerValue),JSON.stringify(normalizedClientValue)))}},warnForExtraAttributes=function(attributeNames){if(!didWarnInvalidHydration){didWarnInvalidHydration=!0;var names=[];attributeNames.forEach((function(name){names.push(name)})),error("Extra attributes from the server: %s",names)}},warnForInvalidEventListener=function(registrationName,listener){!1===listener?error("Expected `%s` listener to be a function, instead got `false`.\n\nIf you used to conditionally omit it with %s={condition && value}, pass %s={condition ? value : undefined} instead.",registrationName,registrationName,registrationName):error("Expected `%s` listener to be a function, instead got a value of `%s` type.",registrationName,typeof listener)},normalizeHTML=function(parent,html){var testElement=parent.namespaceURI===HTML_NAMESPACE$1?parent.ownerDocument.createElement(parent.tagName):parent.ownerDocument.createElementNS(parent.namespaceURI,parent.tagName);return testElement.innerHTML=html,testElement.innerHTML};var validateDOMNesting=function(){},updatedAncestorInfo=function(){},specialTags=["address","applet","area","article","aside","base","basefont","bgsound","blockquote","body","br","button","caption","center","col","colgroup","dd","details","dir","div","dl","dt","embed","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","iframe","img","input","isindex","li","link","listing","main","marquee","menu","menuitem","meta","nav","noembed","noframes","noscript","object","ol","p","param","plaintext","pre","script","section","select","source","style","summary","table","tbody","td","template","textarea","tfoot","th","thead","title","tr","track","ul","wbr","xmp"],inScopeTags=["applet","caption","html","table","td","th","marquee","object","template","foreignObject","desc","title"],buttonScopeTags=inScopeTags.concat(["button"]),impliedEndTags=["dd","dt","li","option","optgroup","p","rp","rt"],emptyAncestorInfo={current:null,formTag:null,aTagInScope:null,buttonTagInScope:null,nobrTagInScope:null,pTagInButtonScope:null,listItemTagAutoclosing:null,dlItemTagAutoclosing:null};updatedAncestorInfo=function(oldInfo,tag){var ancestorInfo=_assign({},oldInfo||emptyAncestorInfo),info={tag:tag};return-1!==inScopeTags.indexOf(tag)&&(ancestorInfo.aTagInScope=null,ancestorInfo.buttonTagInScope=null,ancestorInfo.nobrTagInScope=null),-1!==buttonScopeTags.indexOf(tag)&&(ancestorInfo.pTagInButtonScope=null),-1!==specialTags.indexOf(tag)&&"address"!==tag&&"div"!==tag&&"p"!==tag&&(ancestorInfo.listItemTagAutoclosing=null,ancestorInfo.dlItemTagAutoclosing=null),ancestorInfo.current=info,"form"===tag&&(ancestorInfo.formTag=info),"a"===tag&&(ancestorInfo.aTagInScope=info),"button"===tag&&(ancestorInfo.buttonTagInScope=info),"nobr"===tag&&(ancestorInfo.nobrTagInScope=info),"p"===tag&&(ancestorInfo.pTagInButtonScope=info),"li"===tag&&(ancestorInfo.listItemTagAutoclosing=info),"dd"!==tag&&"dt"!==tag||(ancestorInfo.dlItemTagAutoclosing=info),ancestorInfo};var isTagValidWithParent=function(tag,parentTag){switch(parentTag){case"select":return"option"===tag||"optgroup"===tag||"#text"===tag;case"optgroup":return"option"===tag||"#text"===tag;case"option":return"#text"===tag;case"tr":return"th"===tag||"td"===tag||"style"===tag||"script"===tag||"template"===tag;case"tbody":case"thead":case"tfoot":return"tr"===tag||"style"===tag||"script"===tag||"template"===tag;case"colgroup":return"col"===tag||"template"===tag;case"table":return"caption"===tag||"colgroup"===tag||"tbody"===tag||"tfoot"===tag||"thead"===tag||"style"===tag||"script"===tag||"template"===tag;case"head":return"base"===tag||"basefont"===tag||"bgsound"===tag||"link"===tag||"meta"===tag||"title"===tag||"noscript"===tag||"noframes"===tag||"style"===tag||"script"===tag||"template"===tag;case"html":return"head"===tag||"body"===tag||"frameset"===tag;case"frameset":return"frame"===tag;case"#document":return"html"===tag}switch(tag){case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":return"h1"!==parentTag&&"h2"!==parentTag&&"h3"!==parentTag&&"h4"!==parentTag&&"h5"!==parentTag&&"h6"!==parentTag;case"rp":case"rt":return-1===impliedEndTags.indexOf(parentTag);case"body":case"caption":case"col":case"colgroup":case"frameset":case"frame":case"head":case"html":case"tbody":case"td":case"tfoot":case"th":case"thead":case"tr":return null==parentTag}return!0},findInvalidAncestorForTag=function(tag,ancestorInfo){switch(tag){case"address":case"article":case"aside":case"blockquote":case"center":case"details":case"dialog":case"dir":case"div":case"dl":case"fieldset":case"figcaption":case"figure":case"footer":case"header":case"hgroup":case"main":case"menu":case"nav":case"ol":case"p":case"section":case"summary":case"ul":case"pre":case"listing":case"table":case"hr":case"xmp":case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":return ancestorInfo.pTagInButtonScope;case"form":return ancestorInfo.formTag||ancestorInfo.pTagInButtonScope;case"li":return ancestorInfo.listItemTagAutoclosing;case"dd":case"dt":return ancestorInfo.dlItemTagAutoclosing;case"button":return ancestorInfo.buttonTagInScope;case"a":return ancestorInfo.aTagInScope;case"nobr":return ancestorInfo.nobrTagInScope}return null},didWarn$1={},SUPPRESS_HYDRATION_WARNING$1;validateDOMNesting=function(childTag,childText,ancestorInfo){var parentInfo=(ancestorInfo=ancestorInfo||emptyAncestorInfo).current,parentTag=parentInfo&&parentInfo.tag;null!=childText&&(null!=childTag&&error("validateDOMNesting: when childText is passed, childTag should be null"),childTag="#text");var invalidParent=isTagValidWithParent(childTag,parentTag)?null:parentInfo,invalidAncestor=invalidParent?null:findInvalidAncestorForTag(childTag,ancestorInfo),invalidParentOrAncestor=invalidParent||invalidAncestor;if(invalidParentOrAncestor){var ancestorTag=invalidParentOrAncestor.tag,addendum,warnKey=!!invalidParent+"|"+childTag+"|"+ancestorTag+"|"+getCurrentFiberStackInDev();if(!didWarn$1[warnKey]){didWarn$1[warnKey]=!0;var tagDisplayName=childTag,whitespaceInfo="";if("#text"===childTag?/\S/.test(childText)?tagDisplayName="Text nodes":(tagDisplayName="Whitespace text nodes",whitespaceInfo=" Make sure you don't have any extra whitespace between tags on each line of your source code."):tagDisplayName="<"+childTag+">",invalidParent){var info="";"table"===ancestorTag&&"tr"===childTag&&(info+=" Add a <tbody>, <thead> or <tfoot> to your code to match the DOM tree generated by the browser."),error("validateDOMNesting(...): %s cannot appear as a child of <%s>.%s%s",tagDisplayName,ancestorTag,whitespaceInfo,info)}else error("validateDOMNesting(...): %s cannot appear as a descendant of <%s>.",tagDisplayName,ancestorTag)}}},SUPPRESS_HYDRATION_WARNING$1="suppressHydrationWarning";var SUSPENSE_START_DATA="$",SUSPENSE_END_DATA="/$",SUSPENSE_PENDING_START_DATA="$?",SUSPENSE_FALLBACK_START_DATA="$!",STYLE$1="style",eventsEnabled=null,selectionInformation=null;function shouldAutoFocusHostComponent(type,props){switch(type){case"button":case"input":case"select":case"textarea":return!!props.autoFocus}return!1}function getRootHostContext(rootContainerInstance){var type,namespace,nodeType=rootContainerInstance.nodeType;switch(nodeType){case 9:case 11:type=9===nodeType?"#document":"#fragment";var root=rootContainerInstance.documentElement;namespace=root?root.namespaceURI:getChildNamespace(null,"");break;default:var container=8===nodeType?rootContainerInstance.parentNode:rootContainerInstance,ownNamespace;namespace=getChildNamespace(container.namespaceURI||null,type=container.tagName)}var validatedTag=type.toLowerCase(),ancestorInfo;return{namespace:namespace,ancestorInfo:updatedAncestorInfo(null,validatedTag)}}function getChildHostContext(parentHostContext,type,rootContainerInstance){var parentHostContextDev=parentHostContext,namespace,ancestorInfo;return{namespace:getChildNamespace(parentHostContextDev.namespace,type),ancestorInfo:updatedAncestorInfo(parentHostContextDev.ancestorInfo,type)}}function getPublicInstance(instance){return instance}function prepareForCommit(containerInfo){eventsEnabled=isEnabled(),selectionInformation=getSelectionInformation(),setEnabled(!1)}function resetAfterCommit(containerInfo){restoreSelection(selectionInformation),setEnabled(eventsEnabled),eventsEnabled=null,selectionInformation=null}function createInstance(type,props,rootContainerInstance,hostContext,internalInstanceHandle){var parentNamespace,hostContextDev=hostContext;if(validateDOMNesting(type,null,hostContextDev.ancestorInfo),"string"==typeof props.children||"number"==typeof props.children){var string=""+props.children,ownAncestorInfo=updatedAncestorInfo(hostContextDev.ancestorInfo,type);validateDOMNesting(null,string,ownAncestorInfo)}var domElement=createElement(type,props,rootContainerInstance,parentNamespace=hostContextDev.namespace);return precacheFiberNode(internalInstanceHandle,domElement),updateFiberProps(domElement,props),domElement}function appendInitialChild(parentInstance,child){parentInstance.appendChild(child)}function finalizeInitialChildren(domElement,type,props,rootContainerInstance,hostContext){return setInitialProperties(domElement,type,props,rootContainerInstance),shouldAutoFocusHostComponent(type,props)}function prepareUpdate(domElement,type,oldProps,newProps,rootContainerInstance,hostContext){var hostContextDev=hostContext;if(typeof newProps.children!=typeof oldProps.children&&("string"==typeof newProps.children||"number"==typeof newProps.children)){var string=""+newProps.children,ownAncestorInfo=updatedAncestorInfo(hostContextDev.ancestorInfo,type);validateDOMNesting(null,string,ownAncestorInfo)}return diffProperties(domElement,type,oldProps,newProps,rootContainerInstance)}function shouldSetTextContent(type,props){return"textarea"===type||"option"===type||"noscript"===type||"string"==typeof props.children||"number"==typeof props.children||"object"==typeof props.dangerouslySetInnerHTML&&null!==props.dangerouslySetInnerHTML&&null!=props.dangerouslySetInnerHTML.__html}function shouldDeprioritizeSubtree(type,props){return!!props.hidden}function createTextInstance(text,rootContainerInstance,hostContext,internalInstanceHandle){var hostContextDev;validateDOMNesting(null,text,hostContext.ancestorInfo);var textNode=createTextNode(text,rootContainerInstance);return precacheFiberNode(internalInstanceHandle,textNode),textNode}var scheduleTimeout="function"==typeof setTimeout?setTimeout:void 0,cancelTimeout="function"==typeof clearTimeout?clearTimeout:void 0,noTimeout=-1;function commitMount(domElement,type,newProps,internalInstanceHandle){shouldAutoFocusHostComponent(type,newProps)&&domElement.focus()}function commitUpdate(domElement,updatePayload,type,oldProps,newProps,internalInstanceHandle){updateFiberProps(domElement,newProps),updateProperties(domElement,updatePayload,type,oldProps,newProps)}function resetTextContent(domElement){setTextContent(domElement,"")}function commitTextUpdate(textInstance,oldText,newText){textInstance.nodeValue=newText}function appendChild(parentInstance,child){parentInstance.appendChild(child)}function appendChildToContainer(container,child){var parentNode;8===container.nodeType?(parentNode=container.parentNode).insertBefore(child,container):(parentNode=container).appendChild(child);var reactRootContainer=container._reactRootContainer;null==reactRootContainer&&null===parentNode.onclick&&trapClickOnNonInteractiveElement(parentNode)}function insertBefore(parentInstance,child,beforeChild){parentInstance.insertBefore(child,beforeChild)}function insertInContainerBefore(container,child,beforeChild){8===container.nodeType?container.parentNode.insertBefore(child,beforeChild):container.insertBefore(child,beforeChild)}function removeChild(parentInstance,child){parentInstance.removeChild(child)}function removeChildFromContainer(container,child){8===container.nodeType?container.parentNode.removeChild(child):container.removeChild(child)}function hideInstance(instance){var style=(instance=instance).style;"function"==typeof style.setProperty?style.setProperty("display","none","important"):style.display="none"}function hideTextInstance(textInstance){textInstance.nodeValue=""}function unhideInstance(instance,props){instance=instance;var styleProp=props.style,display=null!=styleProp&&styleProp.hasOwnProperty("display")?styleProp.display:null;instance.style.display=dangerousStyleValue("display",display)}function unhideTextInstance(textInstance,text){textInstance.nodeValue=text}function canHydrateInstance(instance,type,props){return 1!==instance.nodeType||type.toLowerCase()!==instance.nodeName.toLowerCase()?null:instance}function canHydrateTextInstance(instance,text){return""===text||3!==instance.nodeType?null:instance}function isSuspenseInstancePending(instance){return"$?"===instance.data}function isSuspenseInstanceFallback(instance){return"$!"===instance.data}function getNextHydratable(node){for(;null!=node;node=node.nextSibling){var nodeType=node.nodeType;if(1===nodeType||3===nodeType)break}return node}function getNextHydratableSibling(instance){return getNextHydratable(instance.nextSibling)}function getFirstHydratableChild(parentInstance){return getNextHydratable(parentInstance.firstChild)}function hydrateInstance(instance,type,props,rootContainerInstance,hostContext,internalInstanceHandle){var parentNamespace,hostContextDev;return precacheFiberNode(internalInstanceHandle,instance),updateFiberProps(instance,props),diffHydratedProperties(instance,type,props,parentNamespace=hostContext.namespace,rootContainerInstance)}function hydrateTextInstance(textInstance,text,internalInstanceHandle){return precacheFiberNode(internalInstanceHandle,textInstance),diffHydratedText(textInstance,text)}function getNextHydratableInstanceAfterSuspenseInstance(suspenseInstance){for(var node=suspenseInstance.nextSibling,depth=0;node;){if(8===node.nodeType){var data=node.data;if("/$"===data){if(0===depth)return getNextHydratableSibling(node);depth--}else"$"!==data&&"$!"!==data&&"$?"!==data||depth++}node=node.nextSibling}return null}function getParentSuspenseInstance(targetInstance){for(var node=targetInstance.previousSibling,depth=0;node;){if(8===node.nodeType){var data=node.data;if("$"===data||"$!"===data||"$?"===data){if(0===depth)return node;depth--}else"/$"===data&&depth++}node=node.previousSibling}return null}function commitHydratedContainer(container){retryIfBlockedOn(container)}function commitHydratedSuspenseInstance(suspenseInstance){retryIfBlockedOn(suspenseInstance)}function didNotMatchHydratedContainerTextInstance(parentContainer,textInstance,text){warnForUnmatchedText(textInstance,text)}function didNotMatchHydratedTextInstance(parentType,parentProps,parentInstance,textInstance,text){!0!==parentProps.suppressHydrationWarning&&warnForUnmatchedText(textInstance,text)}function didNotHydrateContainerInstance(parentContainer,instance){1===instance.nodeType?warnForDeletedHydratableElement(parentContainer,instance):8===instance.nodeType||warnForDeletedHydratableText(parentContainer,instance)}function didNotHydrateInstance(parentType,parentProps,parentInstance,instance){!0!==parentProps.suppressHydrationWarning&&(1===instance.nodeType?warnForDeletedHydratableElement(parentInstance,instance):8===instance.nodeType||warnForDeletedHydratableText(parentInstance,instance))}function didNotFindHydratableContainerInstance(parentContainer,type,props){warnForInsertedHydratedElement(parentContainer,type)}function didNotFindHydratableContainerTextInstance(parentContainer,text){warnForInsertedHydratedText(parentContainer,text)}function didNotFindHydratableInstance(parentType,parentProps,parentInstance,type,props){!0!==parentProps.suppressHydrationWarning&&warnForInsertedHydratedElement(parentInstance,type)}function didNotFindHydratableTextInstance(parentType,parentProps,parentInstance,text){!0!==parentProps.suppressHydrationWarning&&warnForInsertedHydratedText(parentInstance,text)}function didNotFindHydratableSuspenseInstance(parentType,parentProps,parentInstance){parentProps.suppressHydrationWarning}var randomKey=Math.random().toString(36).slice(2),internalInstanceKey="__reactInternalInstance$"+randomKey,internalEventHandlersKey="__reactEventHandlers$"+randomKey,internalContainerInstanceKey="__reactContainere$"+randomKey;function precacheFiberNode(hostInst,node){node[internalInstanceKey]=hostInst}function markContainerAsRoot(hostRoot,node){node[internalContainerInstanceKey]=hostRoot}function unmarkContainerAsRoot(node){node[internalContainerInstanceKey]=null}function isContainerMarkedAsRoot(node){return!!node[internalContainerInstanceKey]}function getClosestInstanceFromNode(targetNode){var targetInst=targetNode[internalInstanceKey];if(targetInst)return targetInst;for(var parentNode=targetNode.parentNode;parentNode;){if(targetInst=parentNode[internalContainerInstanceKey]||parentNode[internalInstanceKey]){var alternate=targetInst.alternate;if(null!==targetInst.child||null!==alternate&&null!==alternate.child)for(var suspenseInstance=getParentSuspenseInstance(targetNode);null!==suspenseInstance;){var targetSuspenseInst=suspenseInstance[internalInstanceKey];if(targetSuspenseInst)return targetSuspenseInst;suspenseInstance=getParentSuspenseInstance(suspenseInstance)}return targetInst}parentNode=(targetNode=parentNode).parentNode}return null}function getInstanceFromNode$1(node){var inst=node[internalInstanceKey]||node[internalContainerInstanceKey];return inst&&(5===inst.tag||6===inst.tag||13===inst.tag||3===inst.tag)?inst:null}function getNodeFromInstance$1(inst){if(5===inst.tag||6===inst.tag)return inst.stateNode;throw Error("getNodeFromInstance: Invalid argument.")}function getFiberCurrentPropsFromNode$1(node){return node[internalEventHandlersKey]||null}function updateFiberProps(node,props){node[internalEventHandlersKey]=props}function getParent(inst){do{inst=inst.return}while(inst&&5!==inst.tag);return inst||null}function getLowestCommonAncestor(instA,instB){for(var depthA=0,tempA=instA;tempA;tempA=getParent(tempA))depthA++;for(var depthB=0,tempB=instB;tempB;tempB=getParent(tempB))depthB++;for(;depthA-depthB>0;)instA=getParent(instA),depthA--;for(;depthB-depthA>0;)instB=getParent(instB),depthB--;for(var depth=depthA;depth--;){if(instA===instB||instA===instB.alternate)return instA;instA=getParent(instA),instB=getParent(instB)}return null}function traverseTwoPhase(inst,fn,arg){for(var path=[],i;inst;)path.push(inst),inst=getParent(inst);for(i=path.length;i-- >0;)fn(path[i],"captured",arg);for(i=0;i<path.length;i++)fn(path[i],"bubbled",arg)}function traverseEnterLeave(from,to,fn,argFrom,argTo){for(var common=from&&to?getLowestCommonAncestor(from,to):null,pathFrom=[];from&&from!==common;){var alternate=from.alternate;if(null!==alternate&&alternate===common)break;pathFrom.push(from),from=getParent(from)}for(var pathTo=[];to&&to!==common;){var _alternate=to.alternate;if(null!==_alternate&&_alternate===common)break;pathTo.push(to),to=getParent(to)}for(var i=0;i<pathFrom.length;i++)fn(pathFrom[i],"bubbled",argFrom);for(var _i=pathTo.length;_i-- >0;)fn(pathTo[_i],"captured",argTo)}function isInteractive(tag){return"button"===tag||"input"===tag||"select"===tag||"textarea"===tag}function shouldPreventMouseEvent(name,type,props){switch(name){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":return!(!props.disabled||!isInteractive(type));default:return!1}}function getListener(inst,registrationName){var listener,stateNode=inst.stateNode;if(!stateNode)return null;var props=getFiberCurrentPropsFromNode(stateNode);if(!props)return null;if(listener=props[registrationName],shouldPreventMouseEvent(registrationName,inst.type,props))return null;if(listener&&"function"!=typeof listener)throw Error("Expected `"+registrationName+"` listener to be a function, instead got a value of `"+typeof listener+"` type.");return listener}function listenerAtPhase(inst,event,propagationPhase){var registrationName;return getListener(inst,event.dispatchConfig.phasedRegistrationNames[propagationPhase])}function accumulateDirectionalDispatches(inst,phase,event){inst||error("Dispatching inst must not be null");var listener=listenerAtPhase(inst,event,phase);listener&&(event._dispatchListeners=accumulateInto(event._dispatchListeners,listener),event._dispatchInstances=accumulateInto(event._dispatchInstances,inst))}function accumulateTwoPhaseDispatchesSingle(event){event&&event.dispatchConfig.phasedRegistrationNames&&traverseTwoPhase(event._targetInst,accumulateDirectionalDispatches,event)}function accumulateDispatches(inst,ignoredDirection,event){if(inst&&event&&event.dispatchConfig.registrationName){var registrationName,listener=getListener(inst,event.dispatchConfig.registrationName);listener&&(event._dispatchListeners=accumulateInto(event._dispatchListeners,listener),event._dispatchInstances=accumulateInto(event._dispatchInstances,inst))}}function accumulateDirectDispatchesSingle(event){event&&event.dispatchConfig.registrationName&&accumulateDispatches(event._targetInst,null,event)}function accumulateTwoPhaseDispatches(events){forEachAccumulated(events,accumulateTwoPhaseDispatchesSingle)}function accumulateEnterLeaveDispatches(leave,enter,from,to){traverseEnterLeave(from,to,accumulateDispatches,leave,enter)}function accumulateDirectDispatches(events){forEachAccumulated(events,accumulateDirectDispatchesSingle)}var root=null,startText=null,fallbackText=null;function initialize(nativeEventTarget){return root=nativeEventTarget,startText=getText(),!0}function reset(){root=null,startText=null,fallbackText=null}function getData(){if(fallbackText)return fallbackText;var start,startValue=startText,startLength=startValue.length,end,endValue=getText(),endLength=endValue.length;for(start=0;start<startLength&&startValue[start]===endValue[start];start++);var minEnd=startLength-start;for(end=1;end<=minEnd&&startValue[startLength-end]===endValue[endLength-end];end++);var sliceTail=end>1?1-end:void 0;return fallbackText=endValue.slice(start,sliceTail)}function getText(){return"value"in root?root.value:root.textContent}var EVENT_POOL_SIZE=10,EventInterface={type:null,target:null,currentTarget:function(){return null},eventPhase:null,bubbles:null,cancelable:null,timeStamp:function(event){return event.timeStamp||Date.now()},defaultPrevented:null,isTrusted:null};function functionThatReturnsTrue(){return!0}function functionThatReturnsFalse(){return!1}function SyntheticEvent(dispatchConfig,targetInst,nativeEvent,nativeEventTarget){delete this.nativeEvent,delete this.preventDefault,delete this.stopPropagation,delete this.isDefaultPrevented,delete this.isPropagationStopped,this.dispatchConfig=dispatchConfig,this._targetInst=targetInst,this.nativeEvent=nativeEvent;var Interface=this.constructor.Interface;for(var propName in Interface)if(Interface.hasOwnProperty(propName)){delete this[propName];var normalize=Interface[propName];normalize?this[propName]=normalize(nativeEvent):"target"===propName?this.target=nativeEventTarget:this[propName]=nativeEvent[propName]}var defaultPrevented=null!=nativeEvent.defaultPrevented?nativeEvent.defaultPrevented:!1===nativeEvent.returnValue;return this.isDefaultPrevented=defaultPrevented?functionThatReturnsTrue:functionThatReturnsFalse,this.isPropagationStopped=functionThatReturnsFalse,this}function getPooledWarningPropertyDefinition(propName,getVal){var isFunction="function"==typeof getVal;return{configurable:!0,set:set,get:get};function set(val){var action;return warn(isFunction?"setting the method":"setting the property","This is effectively a no-op"),val}function get(){var action,result;return warn(isFunction?"accessing the method":"accessing the property",isFunction?"This is a no-op function":"This is set to null"),getVal}function warn(action,result){error("This synthetic event is reused for performance reasons. If you're seeing this, you're %s `%s` on a released/nullified synthetic event. %s. If you must keep the original synthetic event around, use event.persist(). See https://fb.me/react-event-pooling for more information.",action,propName,result)}}function getPooledEvent(dispatchConfig,targetInst,nativeEvent,nativeInst){var EventConstructor=this;if(this.eventPool.length){var instance=this.eventPool.pop();return this.call(instance,dispatchConfig,targetInst,nativeEvent,nativeInst),instance}return new this(dispatchConfig,targetInst,nativeEvent,nativeInst)}function releasePooledEvent(event){var EventConstructor=this;if(!(event instanceof this))throw Error("Trying to release an event instance into a pool of a different type.");event.destructor(),this.eventPool.length<10&&this.eventPool.push(event)}function addEventPoolingTo(EventConstructor){EventConstructor.eventPool=[],EventConstructor.getPooled=getPooledEvent,EventConstructor.release=releasePooledEvent}_assign(SyntheticEvent.prototype,{preventDefault:function(){this.defaultPrevented=!0;var event=this.nativeEvent;event&&(event.preventDefault?event.preventDefault():"unknown"!=typeof event.returnValue&&(event.returnValue=!1),this.isDefaultPrevented=functionThatReturnsTrue)},stopPropagation:function(){var event=this.nativeEvent;event&&(event.stopPropagation?event.stopPropagation():"unknown"!=typeof event.cancelBubble&&(event.cancelBubble=!0),this.isPropagationStopped=functionThatReturnsTrue)},persist:function(){this.isPersistent=functionThatReturnsTrue},isPersistent:functionThatReturnsFalse,destructor:function(){var Interface=this.constructor.Interface;for(var propName in Interface)Object.defineProperty(this,propName,getPooledWarningPropertyDefinition(propName,Interface[propName]));this.dispatchConfig=null,this._targetInst=null,this.nativeEvent=null,this.isDefaultPrevented=functionThatReturnsFalse,this.isPropagationStopped=functionThatReturnsFalse,this._dispatchListeners=null,this._dispatchInstances=null,Object.defineProperty(this,"nativeEvent",getPooledWarningPropertyDefinition("nativeEvent",null)),Object.defineProperty(this,"isDefaultPrevented",getPooledWarningPropertyDefinition("isDefaultPrevented",functionThatReturnsFalse)),Object.defineProperty(this,"isPropagationStopped",getPooledWarningPropertyDefinition("isPropagationStopped",functionThatReturnsFalse)),Object.defineProperty(this,"preventDefault",getPooledWarningPropertyDefinition("preventDefault",(function(){}))),Object.defineProperty(this,"stopPropagation",getPooledWarningPropertyDefinition("stopPropagation",(function(){})))}}),SyntheticEvent.Interface=EventInterface,SyntheticEvent.extend=function(Interface){var Super=this,E=function(){};E.prototype=Super.prototype;var prototype=new E;function Class(){return Super.apply(this,arguments)}return _assign(prototype,Class.prototype),Class.prototype=prototype,Class.prototype.constructor=Class,Class.Interface=_assign({},Super.Interface,Interface),Class.extend=Super.extend,addEventPoolingTo(Class),Class},addEventPoolingTo(SyntheticEvent);var SyntheticCompositionEvent=SyntheticEvent.extend({data:null}),SyntheticInputEvent=SyntheticEvent.extend({data:null}),END_KEYCODES=[9,13,27,32],START_KEYCODE=229,canUseCompositionEvent=canUseDOM&&"CompositionEvent"in window,documentMode=null;canUseDOM&&"documentMode"in document&&(documentMode=document.documentMode);var canUseTextInputEvent=canUseDOM&&"TextEvent"in window&&!documentMode,useFallbackCompositionData=canUseDOM&&(!canUseCompositionEvent||documentMode&&documentMode>8&&documentMode<=11),SPACEBAR_CODE=32,SPACEBAR_CHAR=String.fromCharCode(32),eventTypes={beforeInput:{phasedRegistrationNames:{bubbled:"onBeforeInput",captured:"onBeforeInputCapture"},dependencies:["compositionend","keypress","textInput","paste"]},compositionEnd:{phasedRegistrationNames:{bubbled:"onCompositionEnd",captured:"onCompositionEndCapture"},dependencies:["blur","compositionend","keydown","keypress","keyup","mousedown"]},compositionStart:{phasedRegistrationNames:{bubbled:"onCompositionStart",captured:"onCompositionStartCapture"},dependencies:["blur","compositionstart","keydown","keypress","keyup","mousedown"]},compositionUpdate:{phasedRegistrationNames:{bubbled:"onCompositionUpdate",captured:"onCompositionUpdateCapture"},dependencies:["blur","compositionupdate","keydown","keypress","keyup","mousedown"]}},hasSpaceKeypress=!1;function isKeypressCommand(nativeEvent){return(nativeEvent.ctrlKey||nativeEvent.altKey||nativeEvent.metaKey)&&!(nativeEvent.ctrlKey&&nativeEvent.altKey)}function getCompositionEventType(topLevelType){switch(topLevelType){case"compositionstart":return eventTypes.compositionStart;case"compositionend":return eventTypes.compositionEnd;case"compositionupdate":return eventTypes.compositionUpdate}}function isFallbackCompositionStart(topLevelType,nativeEvent){return"keydown"===topLevelType&&229===nativeEvent.keyCode}function isFallbackCompositionEnd(topLevelType,nativeEvent){switch(topLevelType){case"keyup":return-1!==END_KEYCODES.indexOf(nativeEvent.keyCode);case"keydown":return 229!==nativeEvent.keyCode;case"keypress":case"mousedown":case"blur":return!0;default:return!1}}function getDataFromCustomEvent(nativeEvent){var detail=nativeEvent.detail;return"object"==typeof detail&&"data"in detail?detail.data:null}function isUsingKoreanIME(nativeEvent){return"ko"===nativeEvent.locale}var isComposing=!1;function extractCompositionEvent(topLevelType,targetInst,nativeEvent,nativeEventTarget){var eventType,fallbackData;if(canUseCompositionEvent?eventType=getCompositionEventType(topLevelType):isComposing?isFallbackCompositionEnd(topLevelType,nativeEvent)&&(eventType=eventTypes.compositionEnd):isFallbackCompositionStart(topLevelType,nativeEvent)&&(eventType=eventTypes.compositionStart),!eventType)return null;useFallbackCompositionData&&!isUsingKoreanIME(nativeEvent)&&(isComposing||eventType!==eventTypes.compositionStart?eventType===eventTypes.compositionEnd&&isComposing&&(fallbackData=getData()):isComposing=initialize(nativeEventTarget));var event=SyntheticCompositionEvent.getPooled(eventType,targetInst,nativeEvent,nativeEventTarget);if(fallbackData)event.data=fallbackData;else{var customData=getDataFromCustomEvent(nativeEvent);null!==customData&&(event.data=customData)}return accumulateTwoPhaseDispatches(event),event}function getNativeBeforeInputChars(topLevelType,nativeEvent){switch(topLevelType){case"compositionend":return getDataFromCustomEvent(nativeEvent);case"keypress":var which;return 32!==nativeEvent.which?null:(hasSpaceKeypress=!0,SPACEBAR_CHAR);case"textInput":var chars=nativeEvent.data;return chars===SPACEBAR_CHAR&&hasSpaceKeypress?null:chars;default:return null}}function getFallbackBeforeInputChars(topLevelType,nativeEvent){if(isComposing){if("compositionend"===topLevelType||!canUseCompositionEvent&&isFallbackCompositionEnd(topLevelType,nativeEvent)){var chars=getData();return reset(),isComposing=!1,chars}return null}switch(topLevelType){case"paste":return null;case"keypress":if(!isKeypressCommand(nativeEvent)){if(nativeEvent.char&&nativeEvent.char.length>1)return nativeEvent.char;if(nativeEvent.which)return String.fromCharCode(nativeEvent.which)}return null;case"compositionend":return useFallbackCompositionData&&!isUsingKoreanIME(nativeEvent)?null:nativeEvent.data;default:return null}}function extractBeforeInputEvent(topLevelType,targetInst,nativeEvent,nativeEventTarget){var chars;if(!(chars=canUseTextInputEvent?getNativeBeforeInputChars(topLevelType,nativeEvent):getFallbackBeforeInputChars(topLevelType,nativeEvent)))return null;var event=SyntheticInputEvent.getPooled(eventTypes.beforeInput,targetInst,nativeEvent,nativeEventTarget);return event.data=chars,accumulateTwoPhaseDispatches(event),event}var BeforeInputEventPlugin={eventTypes:eventTypes,extractEvents:function(topLevelType,targetInst,nativeEvent,nativeEventTarget,eventSystemFlags){var composition=extractCompositionEvent(topLevelType,targetInst,nativeEvent,nativeEventTarget),beforeInput=extractBeforeInputEvent(topLevelType,targetInst,nativeEvent,nativeEventTarget);return null===composition?beforeInput:null===beforeInput?composition:[composition,beforeInput]}},supportedInputTypes={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function isTextInputElement(elem){var nodeName=elem&&elem.nodeName&&elem.nodeName.toLowerCase();return"input"===nodeName?!!supportedInputTypes[elem.type]:"textarea"===nodeName}var eventTypes$1={change:{phasedRegistrationNames:{bubbled:"onChange",captured:"onChangeCapture"},dependencies:["blur","change","click","focus","input","keydown","keyup","selectionchange"]}};function createAndAccumulateChangeEvent(inst,nativeEvent,target){var event=SyntheticEvent.getPooled(eventTypes$1.change,inst,nativeEvent,target);return event.type="change",enqueueStateRestore(target),accumulateTwoPhaseDispatches(event),event}var activeElement=null,activeElementInst=null;function shouldUseChangeEvent(elem){var nodeName=elem.nodeName&&elem.nodeName.toLowerCase();return"select"===nodeName||"input"===nodeName&&"file"===elem.type}function manualDispatchChangeEvent(nativeEvent){var event;batchedUpdates(runEventInBatch,createAndAccumulateChangeEvent(activeElementInst,nativeEvent,getEventTarget(nativeEvent)))}function runEventInBatch(event){runEventsInBatch(event)}function getInstIfValueChanged(targetInst){var targetNode;if(updateValueIfChanged(getNodeFromInstance$1(targetInst)))return targetInst}function getTargetInstForChangeEvent(topLevelType,targetInst){if("change"===topLevelType)return targetInst}var isInputEventSupported=!1;function startWatchingForValueChange(target,targetInst){activeElementInst=targetInst,(activeElement=target).attachEvent("onpropertychange",handlePropertyChange)}function stopWatchingForValueChange(){activeElement&&(activeElement.detachEvent("onpropertychange",handlePropertyChange),activeElement=null,activeElementInst=null)}function handlePropertyChange(nativeEvent){"value"===nativeEvent.propertyName&&getInstIfValueChanged(activeElementInst)&&manualDispatchChangeEvent(nativeEvent)}function handleEventsForInputEventPolyfill(topLevelType,target,targetInst){"focus"===topLevelType?(stopWatchingForValueChange(),startWatchingForValueChange(target,targetInst)):"blur"===topLevelType&&stopWatchingForValueChange()}function getTargetInstForInputEventPolyfill(topLevelType,targetInst){if("selectionchange"===topLevelType||"keyup"===topLevelType||"keydown"===topLevelType)return getInstIfValueChanged(activeElementInst)}function shouldUseClickEvent(elem){var nodeName=elem.nodeName;return nodeName&&"input"===nodeName.toLowerCase()&&("checkbox"===elem.type||"radio"===elem.type)}function getTargetInstForClickEvent(topLevelType,targetInst){if("click"===topLevelType)return getInstIfValueChanged(targetInst)}function getTargetInstForInputOrChangeEvent(topLevelType,targetInst){if("input"===topLevelType||"change"===topLevelType)return getInstIfValueChanged(targetInst)}function handleControlledInputBlur(node){var state=node._wrapperState;state&&state.controlled&&"number"===node.type&&setDefaultValue(node,"number",node.value)}canUseDOM&&(isInputEventSupported=isEventSupported("input")&&(!document.documentMode||document.documentMode>9));var ChangeEventPlugin={eventTypes:eventTypes$1,_isInputEventSupported:isInputEventSupported,extractEvents:function(topLevelType,targetInst,nativeEvent,nativeEventTarget,eventSystemFlags){var targetNode=targetInst?getNodeFromInstance$1(targetInst):window,getTargetInstFunc,handleEventFunc;if(shouldUseChangeEvent(targetNode)?getTargetInstFunc=getTargetInstForChangeEvent:isTextInputElement(targetNode)?isInputEventSupported?getTargetInstFunc=getTargetInstForInputOrChangeEvent:(getTargetInstFunc=getTargetInstForInputEventPolyfill,handleEventFunc=handleEventsForInputEventPolyfill):shouldUseClickEvent(targetNode)&&(getTargetInstFunc=getTargetInstForClickEvent),getTargetInstFunc){var inst=getTargetInstFunc(topLevelType,targetInst),event;if(inst)return createAndAccumulateChangeEvent(inst,nativeEvent,nativeEventTarget)}handleEventFunc&&handleEventFunc(topLevelType,targetNode,targetInst),"blur"===topLevelType&&handleControlledInputBlur(targetNode)}},SyntheticUIEvent=SyntheticEvent.extend({view:null,detail:null}),modifierKeyToProp={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function modifierStateGetter(keyArg){var syntheticEvent=this,nativeEvent=this.nativeEvent;if(nativeEvent.getModifierState)return nativeEvent.getModifierState(keyArg);var keyProp=modifierKeyToProp[keyArg];return!!keyProp&&!!nativeEvent[keyProp]}function getEventModifierState(nativeEvent){return modifierStateGetter}var previousScreenX=0,previousScreenY=0,isMovementXSet=!1,isMovementYSet=!1,SyntheticMouseEvent=SyntheticUIEvent.extend({screenX:null,screenY:null,clientX:null,clientY:null,pageX:null,pageY:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,getModifierState:getEventModifierState,button:null,buttons:null,relatedTarget:function(event){return event.relatedTarget||(event.fromElement===event.srcElement?event.toElement:event.fromElement)},movementX:function(event){if("movementX"in event)return event.movementX;var screenX=previousScreenX;return previousScreenX=event.screenX,isMovementXSet?"mousemove"===event.type?event.screenX-screenX:0:(isMovementXSet=!0,0)},movementY:function(event){if("movementY"in event)return event.movementY;var screenY=previousScreenY;return previousScreenY=event.screenY,isMovementYSet?"mousemove"===event.type?event.screenY-screenY:0:(isMovementYSet=!0,0)}}),SyntheticPointerEvent=SyntheticMouseEvent.extend({pointerId:null,width:null,height:null,pressure:null,tangentialPressure:null,tiltX:null,tiltY:null,twist:null,pointerType:null,isPrimary:null}),eventTypes$2={mouseEnter:{registrationName:"onMouseEnter",dependencies:["mouseout","mouseover"]},mouseLeave:{registrationName:"onMouseLeave",dependencies:["mouseout","mouseover"]},pointerEnter:{registrationName:"onPointerEnter",dependencies:["pointerout","pointerover"]},pointerLeave:{registrationName:"onPointerLeave",dependencies:["pointerout","pointerover"]}},EnterLeaveEventPlugin={eventTypes:eventTypes$2,extractEvents:function(topLevelType,targetInst,nativeEvent,nativeEventTarget,eventSystemFlags){var isOverEvent="mouseover"===topLevelType||"pointerover"===topLevelType,isOutEvent="mouseout"===topLevelType||"pointerout"===topLevelType,win,from,to,eventInterface,leaveEventType,enterEventType,eventTypePrefix;if(isOverEvent&&0==(32&eventSystemFlags)&&(nativeEvent.relatedTarget||nativeEvent.fromElement))return null;if(!isOutEvent&&!isOverEvent)return null;if(nativeEventTarget.window===nativeEventTarget)win=nativeEventTarget;else{var doc=nativeEventTarget.ownerDocument;win=doc?doc.defaultView||doc.parentWindow:window}if(isOutEvent){from=targetInst;var related=nativeEvent.relatedTarget||nativeEvent.toElement,nearestMounted;if(null!==(to=related?getClosestInstanceFromNode(related):null))(to!==getNearestMountedFiber(to)||5!==to.tag&&6!==to.tag)&&(to=null)}else from=null,to=targetInst;if(from===to)return null;"mouseout"===topLevelType||"mouseover"===topLevelType?(eventInterface=SyntheticMouseEvent,leaveEventType=eventTypes$2.mouseLeave,enterEventType=eventTypes$2.mouseEnter,eventTypePrefix="mouse"):"pointerout"!==topLevelType&&"pointerover"!==topLevelType||(eventInterface=SyntheticPointerEvent,leaveEventType=eventTypes$2.pointerLeave,enterEventType=eventTypes$2.pointerEnter,eventTypePrefix="pointer");var fromNode=null==from?win:getNodeFromInstance$1(from),toNode=null==to?win:getNodeFromInstance$1(to),leave=eventInterface.getPooled(leaveEventType,from,nativeEvent,nativeEventTarget);leave.type=eventTypePrefix+"leave",leave.target=fromNode,leave.relatedTarget=toNode;var enter=eventInterface.getPooled(enterEventType,to,nativeEvent,nativeEventTarget);return enter.type=eventTypePrefix+"enter",enter.target=toNode,enter.relatedTarget=fromNode,accumulateEnterLeaveDispatches(leave,enter,from,to),0==(64&eventSystemFlags)?[leave]:[leave,enter]}};function is(x,y){return x===y&&(0!==x||1/x==1/y)||x!=x&&y!=y}var objectIs="function"==typeof Object.is?Object.is:is,hasOwnProperty$2=Object.prototype.hasOwnProperty;function shallowEqual(objA,objB){if(objectIs(objA,objB))return!0;if("object"!=typeof objA||null===objA||"object"!=typeof objB||null===objB)return!1;var keysA=Object.keys(objA),keysB=Object.keys(objB);if(keysA.length!==keysB.length)return!1;for(var i=0;i<keysA.length;i++)if(!hasOwnProperty$2.call(objB,keysA[i])||!objectIs(objA[keysA[i]],objB[keysA[i]]))return!1;return!0}var skipSelectionChangeEvent=canUseDOM&&"documentMode"in document&&document.documentMode<=11,eventTypes$3={select:{phasedRegistrationNames:{bubbled:"onSelect",captured:"onSelectCapture"},dependencies:["blur","contextmenu","dragend","focus","keydown","keyup","mousedown","mouseup","selectionchange"]}},activeElement$1=null,activeElementInst$1=null,lastSelection=null,mouseDown=!1;function getSelection$1(node){if("selectionStart"in node&&hasSelectionCapabilities(node))return{start:node.selectionStart,end:node.selectionEnd};var win,selection=(node.ownerDocument&&node.ownerDocument.defaultView||window).getSelection();return{anchorNode:selection.anchorNode,anchorOffset:selection.anchorOffset,focusNode:selection.focusNode,focusOffset:selection.focusOffset}}function getEventTargetDocument(eventTarget){return eventTarget.window===eventTarget?eventTarget.document:9===eventTarget.nodeType?eventTarget:eventTarget.ownerDocument}function constructSelectEvent(nativeEvent,nativeEventTarget){var doc=getEventTargetDocument(nativeEventTarget);if(mouseDown||null==activeElement$1||activeElement$1!==getActiveElement(doc))return null;var currentSelection=getSelection$1(activeElement$1);if(!lastSelection||!shallowEqual(lastSelection,currentSelection)){lastSelection=currentSelection;var syntheticEvent=SyntheticEvent.getPooled(eventTypes$3.select,activeElementInst$1,nativeEvent,nativeEventTarget);return syntheticEvent.type="select",syntheticEvent.target=activeElement$1,accumulateTwoPhaseDispatches(syntheticEvent),syntheticEvent}return null}var SelectEventPlugin={eventTypes:eventTypes$3,extractEvents:function(topLevelType,targetInst,nativeEvent,nativeEventTarget,eventSystemFlags,container){var containerOrDoc=container||getEventTargetDocument(nativeEventTarget);if(!containerOrDoc||!isListeningToAllDependencies("onSelect",containerOrDoc))return null;var targetNode=targetInst?getNodeFromInstance$1(targetInst):window;switch(topLevelType){case"focus":(isTextInputElement(targetNode)||"true"===targetNode.contentEditable)&&(activeElement$1=targetNode,activeElementInst$1=targetInst,lastSelection=null);break;case"blur":activeElement$1=null,activeElementInst$1=null,lastSelection=null;break;case"mousedown":mouseDown=!0;break;case"contextmenu":case"mouseup":case"dragend":return mouseDown=!1,constructSelectEvent(nativeEvent,nativeEventTarget);case"selectionchange":if(skipSelectionChangeEvent)break;case"keydown":case"keyup":return constructSelectEvent(nativeEvent,nativeEventTarget)}return null}},SyntheticAnimationEvent=SyntheticEvent.extend({animationName:null,elapsedTime:null,pseudoElement:null}),SyntheticClipboardEvent=SyntheticEvent.extend({clipboardData:function(event){return"clipboardData"in event?event.clipboardData:window.clipboardData}}),SyntheticFocusEvent=SyntheticUIEvent.extend({relatedTarget:null});function getEventCharCode(nativeEvent){var charCode,keyCode=nativeEvent.keyCode;return"charCode"in nativeEvent?0===(charCode=nativeEvent.charCode)&&13===keyCode&&(charCode=13):charCode=keyCode,10===charCode&&(charCode=13),charCode>=32||13===charCode?charCode:0}var normalizeKey={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},translateToKey={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"};function getEventKey(nativeEvent){if(nativeEvent.key){var key=normalizeKey[nativeEvent.key]||nativeEvent.key;if("Unidentified"!==key)return key}if("keypress"===nativeEvent.type){var charCode=getEventCharCode(nativeEvent);return 13===charCode?"Enter":String.fromCharCode(charCode)}return"keydown"===nativeEvent.type||"keyup"===nativeEvent.type?translateToKey[nativeEvent.keyCode]||"Unidentified":""}var SyntheticKeyboardEvent=SyntheticUIEvent.extend({key:getEventKey,location:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,repeat:null,locale:null,getModifierState:getEventModifierState,charCode:function(event){return"keypress"===event.type?getEventCharCode(event):0},keyCode:function(event){return"keydown"===event.type||"keyup"===event.type?event.keyCode:0},which:function(event){return"keypress"===event.type?getEventCharCode(event):"keydown"===event.type||"keyup"===event.type?event.keyCode:0}}),SyntheticDragEvent=SyntheticMouseEvent.extend({dataTransfer:null}),SyntheticTouchEvent=SyntheticUIEvent.extend({touches:null,targetTouches:null,changedTouches:null,altKey:null,metaKey:null,ctrlKey:null,shiftKey:null,getModifierState:getEventModifierState}),SyntheticTransitionEvent=SyntheticEvent.extend({propertyName:null,elapsedTime:null,pseudoElement:null}),SyntheticWheelEvent=SyntheticMouseEvent.extend({deltaX:function(event){return"deltaX"in event?event.deltaX:"wheelDeltaX"in event?-event.wheelDeltaX:0},deltaY:function(event){return"deltaY"in event?event.deltaY:"wheelDeltaY"in event?-event.wheelDeltaY:"wheelDelta"in event?-event.wheelDelta:0},deltaZ:null,deltaMode:null}),knownHTMLTopLevelTypes=["abort","cancel","canplay","canplaythrough","close","durationchange","emptied","encrypted","ended","error","input","invalid","load","loadeddata","loadedmetadata","loadstart","pause","play","playing","progress","ratechange","reset","seeked","seeking","stalled","submit","suspend","timeupdate","toggle","volumechange","waiting"],SimpleEventPlugin={eventTypes:simpleEventPluginEventTypes,extractEvents:function(topLevelType,targetInst,nativeEvent,nativeEventTarget,eventSystemFlags){var dispatchConfig=topLevelEventsToDispatchConfig.get(topLevelType),EventConstructor;if(!dispatchConfig)return null;switch(topLevelType){case"keypress":if(0===getEventCharCode(nativeEvent))return null;case"keydown":case"keyup":EventConstructor=SyntheticKeyboardEvent;break;case"blur":case"focus":EventConstructor=SyntheticFocusEvent;break;case"click":if(2===nativeEvent.button)return null;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":EventConstructor=SyntheticMouseEvent;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":EventConstructor=SyntheticDragEvent;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":EventConstructor=SyntheticTouchEvent;break;case TOP_ANIMATION_END:case TOP_ANIMATION_ITERATION:case TOP_ANIMATION_START:EventConstructor=SyntheticAnimationEvent;break;case TOP_TRANSITION_END:EventConstructor=SyntheticTransitionEvent;break;case"scroll":EventConstructor=SyntheticUIEvent;break;case"wheel":EventConstructor=SyntheticWheelEvent;break;case"copy":case"cut":case"paste":EventConstructor=SyntheticClipboardEvent;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":EventConstructor=SyntheticPointerEvent;break;default:-1===knownHTMLTopLevelTypes.indexOf(topLevelType)&&error("SimpleEventPlugin: Unhandled event type, `%s`. This warning is likely caused by a bug in React. Please file an issue.",topLevelType),EventConstructor=SyntheticEvent}var event=EventConstructor.getPooled(dispatchConfig,targetInst,nativeEvent,nativeEventTarget);return accumulateTwoPhaseDispatches(event),event}},DOMEventPluginOrder;injectEventPluginOrder(["ResponderEventPlugin","SimpleEventPlugin","EnterLeaveEventPlugin","ChangeEventPlugin","SelectEventPlugin","BeforeInputEventPlugin"]),setComponentTree(getFiberCurrentPropsFromNode$1,getInstanceFromNode$1,getNodeFromInstance$1),injectEventPluginsByName({SimpleEventPlugin:SimpleEventPlugin,EnterLeaveEventPlugin:EnterLeaveEventPlugin,ChangeEventPlugin:ChangeEventPlugin,SelectEventPlugin:SelectEventPlugin,BeforeInputEventPlugin:BeforeInputEventPlugin});var reactEmoji="",warningEmoji="",supportsUserTiming="undefined"!=typeof performance&&"function"==typeof performance.mark&&"function"==typeof performance.clearMarks&&"function"==typeof performance.measure&&"function"==typeof performance.clearMeasures,currentFiber=null,currentPhase=null,currentPhaseFiber=null,isCommitting=!1,hasScheduledUpdateInCurrentCommit=!1,hasScheduledUpdateInCurrentPhase=!1,commitCountInCurrentWorkLoop=0,effectCountInCurrentCommit=0,labelsInCurrentCommit=new Set,formatMarkName=function(markName){return" "+markName},formatLabel=function(label,warning){var prefix,suffix;return""+(warning?" ":" ")+label+(warning?" Warning: "+warning:"")},beginMark=function(markName){performance.mark(formatMarkName(markName))},clearMark=function(markName){performance.clearMarks(formatMarkName(markName))},endMark=function(label,markName,warning){var formattedMarkName=formatMarkName(markName),formattedLabel=formatLabel(label,warning);try{performance.measure(formattedLabel,formattedMarkName)}catch(err){}performance.clearMarks(formattedMarkName),performance.clearMeasures(formattedLabel)},getFiberMarkName=function(label,debugID){return label+" (#"+debugID+")"},getFiberLabel=function(componentName,isMounted,phase){return null===phase?componentName+" ["+(isMounted?"update":"mount")+"]":componentName+"."+phase},beginFiberMark=function(fiber,phase){var componentName=getComponentName(fiber.type)||"Unknown",debugID=fiber._debugID,isMounted=null!==fiber.alternate,label=getFiberLabel(componentName,isMounted,phase);if(isCommitting&&labelsInCurrentCommit.has(label))return!1;labelsInCurrentCommit.add(label);var markName=getFiberMarkName(label,debugID);return beginMark(markName),!0},clearFiberMark=function(fiber,phase){var componentName=getComponentName(fiber.type)||"Unknown",debugID=fiber._debugID,isMounted=null!==fiber.alternate,label=getFiberLabel(componentName,isMounted,phase),markName=getFiberMarkName(label,debugID);clearMark(markName)},endFiberMark=function(fiber,phase,warning){var componentName=getComponentName(fiber.type)||"Unknown",debugID=fiber._debugID,isMounted=null!==fiber.alternate,label=getFiberLabel(componentName,isMounted,phase),markName=getFiberMarkName(label,debugID);endMark(label,markName,warning)},shouldIgnoreFiber=function(fiber){switch(fiber.tag){case 3:case 5:case 6:case 4:case 7:case 10:case 9:case 8:return!0;default:return!1}},clearPendingPhaseMeasurement=function(){null!==currentPhase&&null!==currentPhaseFiber&&clearFiberMark(currentPhaseFiber,currentPhase),currentPhaseFiber=null,currentPhase=null,hasScheduledUpdateInCurrentPhase=!1},pauseTimers=function(){for(var fiber=currentFiber;fiber;)fiber._debugIsCurrentlyTiming&&endFiberMark(fiber,null,null),fiber=fiber.return},resumeTimersRecursively=function(fiber){null!==fiber.return&&resumeTimersRecursively(fiber.return),fiber._debugIsCurrentlyTiming&&beginFiberMark(fiber,null)},resumeTimers=function(){null!==currentFiber&&resumeTimersRecursively(currentFiber)};function recordEffect(){effectCountInCurrentCommit++}function recordScheduleUpdate(){isCommitting&&(hasScheduledUpdateInCurrentCommit=!0),null!==currentPhase&&"componentWillMount"!==currentPhase&&"componentWillReceiveProps"!==currentPhase&&(hasScheduledUpdateInCurrentPhase=!0)}function startWorkTimer(fiber){supportsUserTiming&&!shouldIgnoreFiber(fiber)&&(currentFiber=fiber,beginFiberMark(fiber,null)&&(fiber._debugIsCurrentlyTiming=!0))}function cancelWorkTimer(fiber){supportsUserTiming&&!shouldIgnoreFiber(fiber)&&(fiber._debugIsCurrentlyTiming=!1,clearFiberMark(fiber,null))}function stopWorkTimer(fiber){supportsUserTiming&&!shouldIgnoreFiber(fiber)&&(currentFiber=fiber.return,fiber._debugIsCurrentlyTiming&&(fiber._debugIsCurrentlyTiming=!1,endFiberMark(fiber,null,null)))}function stopFailedWorkTimer(fiber){if(supportsUserTiming&&!shouldIgnoreFiber(fiber)&&(currentFiber=fiber.return,fiber._debugIsCurrentlyTiming)){fiber._debugIsCurrentlyTiming=!1;var warning=13===fiber.tag?"Rendering was suspended":"An error was thrown inside this error boundary";endFiberMark(fiber,null,warning)}}function startPhaseTimer(fiber,phase){supportsUserTiming&&(clearPendingPhaseMeasurement(),beginFiberMark(fiber,phase)&&(currentPhaseFiber=fiber,currentPhase=phase))}function stopPhaseTimer(){var warning;supportsUserTiming&&(null!==currentPhase&&null!==currentPhaseFiber&&endFiberMark(currentPhaseFiber,currentPhase,hasScheduledUpdateInCurrentPhase?"Scheduled a cascading update":null),currentPhase=null,currentPhaseFiber=null)}function startWorkLoopTimer(nextUnitOfWork){currentFiber=nextUnitOfWork,supportsUserTiming&&(commitCountInCurrentWorkLoop=0,beginMark("(React Tree Reconciliation)"),resumeTimers())}function stopWorkLoopTimer(interruptedBy,didCompleteRoot){if(supportsUserTiming){var warning=null,componentName;null!==interruptedBy?warning=3===interruptedBy.tag?"A top-level update interrupted the previous render":"An update to "+(getComponentName(interruptedBy.type)||"Unknown")+" interrupted the previous render":commitCountInCurrentWorkLoop>1&&(warning="There were cascading updates"),commitCountInCurrentWorkLoop=0;var label=didCompleteRoot?"(React Tree Reconciliation: Completed Root)":"(React Tree Reconciliation: Yielded)";pauseTimers(),endMark(label,"(React Tree Reconciliation)",warning)}}function startCommitTimer(){supportsUserTiming&&(isCommitting=!0,hasScheduledUpdateInCurrentCommit=!1,labelsInCurrentCommit.clear(),beginMark("(Committing Changes)"))}function stopCommitTimer(){if(supportsUserTiming){var warning=null;hasScheduledUpdateInCurrentCommit?warning="Lifecycle hook scheduled a cascading update":commitCountInCurrentWorkLoop>0&&(warning="Caused by a cascading update in earlier commit"),hasScheduledUpdateInCurrentCommit=!1,commitCountInCurrentWorkLoop++,isCommitting=!1,labelsInCurrentCommit.clear(),endMark("(Committing Changes)","(Committing Changes)",warning)}}function startCommitSnapshotEffectsTimer(){supportsUserTiming&&(effectCountInCurrentCommit=0,beginMark("(Committing Snapshot Effects)"))}function stopCommitSnapshotEffectsTimer(){if(supportsUserTiming){var count=effectCountInCurrentCommit;effectCountInCurrentCommit=0,endMark("(Committing Snapshot Effects: "+count+" Total)","(Committing Snapshot Effects)",null)}}function startCommitHostEffectsTimer(){supportsUserTiming&&(effectCountInCurrentCommit=0,beginMark("(Committing Host Effects)"))}function stopCommitHostEffectsTimer(){if(supportsUserTiming){var count=effectCountInCurrentCommit;effectCountInCurrentCommit=0,endMark("(Committing Host Effects: "+count+" Total)","(Committing Host Effects)",null)}}function startCommitLifeCyclesTimer(){supportsUserTiming&&(effectCountInCurrentCommit=0,beginMark("(Calling Lifecycle Methods)"))}function stopCommitLifeCyclesTimer(){if(supportsUserTiming){var count=effectCountInCurrentCommit;effectCountInCurrentCommit=0,endMark("(Calling Lifecycle Methods: "+count+" Total)","(Calling Lifecycle Methods)",null)}}var valueStack=[],fiberStack;fiberStack=[];var index=-1,warnedAboutMissingGetChildContext;function createCursor(defaultValue){return{current:defaultValue}}function pop(cursor,fiber){index<0?error("Unexpected pop."):(fiber!==fiberStack[index]&&error("Unexpected Fiber popped."),cursor.current=valueStack[index],valueStack[index]=null,fiberStack[index]=null,index--)}function push(cursor,value,fiber){index++,valueStack[index]=cursor.current,fiberStack[index]=fiber,cursor.current=value}warnedAboutMissingGetChildContext={};var emptyContextObject={};Object.freeze(emptyContextObject);var contextStackCursor=createCursor(emptyContextObject),didPerformWorkStackCursor=createCursor(!1),previousContext=emptyContextObject;function getUnmaskedContext(workInProgress,Component,didPushOwnContextIfProvider){return didPushOwnContextIfProvider&&isContextProvider(Component)?previousContext:contextStackCursor.current}function cacheContext(workInProgress,unmaskedContext,maskedContext){var instance=workInProgress.stateNode;instance.__reactInternalMemoizedUnmaskedChildContext=unmaskedContext,instance.__reactInternalMemoizedMaskedChildContext=maskedContext}function getMaskedContext(workInProgress,unmaskedContext){var type=workInProgress.type,contextTypes=type.contextTypes;if(!contextTypes)return emptyContextObject;var instance=workInProgress.stateNode;if(instance&&instance.__reactInternalMemoizedUnmaskedChildContext===unmaskedContext)return instance.__reactInternalMemoizedMaskedChildContext;var context={};for(var key in contextTypes)context[key]=unmaskedContext[key];var name=getComponentName(type)||"Unknown";return checkPropTypes(contextTypes,context,"context",name,getCurrentFiberStackInDev),instance&&cacheContext(workInProgress,unmaskedContext,context),context}function hasContextChanged(){return didPerformWorkStackCursor.current}function isContextProvider(type){var childContextTypes=type.childContextTypes;return null!=childContextTypes}function popContext(fiber){pop(didPerformWorkStackCursor,fiber),pop(contextStackCursor,fiber)}function popTopLevelContextObject(fiber){pop(didPerformWorkStackCursor,fiber),pop(contextStackCursor,fiber)}function pushTopLevelContextObject(fiber,context,didChange){if(contextStackCursor.current!==emptyContextObject)throw Error("Unexpected context found on stack. This error is likely caused by a bug in React. Please file an issue.");push(contextStackCursor,context,fiber),push(didPerformWorkStackCursor,didChange,fiber)}function processChildContext(fiber,type,parentContext){var instance=fiber.stateNode,childContextTypes=type.childContextTypes,childContext;if("function"!=typeof instance.getChildContext){var componentName=getComponentName(type)||"Unknown";return warnedAboutMissingGetChildContext[componentName]||(warnedAboutMissingGetChildContext[componentName]=!0,error("%s.childContextTypes is specified but there is no getChildContext() method on the instance. You can either define getChildContext() on %s or remove childContextTypes from it.",componentName,componentName)),parentContext}for(var contextKey in startPhaseTimer(fiber,"getChildContext"),childContext=instance.getChildContext(),stopPhaseTimer(),childContext)if(!(contextKey in childContextTypes))throw Error((getComponentName(type)||"Unknown")+'.getChildContext(): key "'+contextKey+'" is not defined in childContextTypes.');var name=getComponentName(type)||"Unknown";return checkPropTypes(childContextTypes,childContext,"child context",name,getCurrentFiberStackInDev),_assign({},parentContext,{},childContext)}function pushContextProvider(workInProgress){var instance=workInProgress.stateNode,memoizedMergedChildContext=instance&&instance.__reactInternalMemoizedMergedChildContext||emptyContextObject;return previousContext=contextStackCursor.current,push(contextStackCursor,memoizedMergedChildContext,workInProgress),push(didPerformWorkStackCursor,didPerformWorkStackCursor.current,workInProgress),!0}function invalidateContextProvider(workInProgress,type,didChange){var instance=workInProgress.stateNode;if(!instance)throw Error("Expected to have an instance by this point. This error is likely caused by a bug in React. Please file an issue.");if(didChange){var mergedContext=processChildContext(workInProgress,type,previousContext);instance.__reactInternalMemoizedMergedChildContext=mergedContext,pop(didPerformWorkStackCursor,workInProgress),pop(contextStackCursor,workInProgress),push(contextStackCursor,mergedContext,workInProgress),push(didPerformWorkStackCursor,didChange,workInProgress)}else pop(didPerformWorkStackCursor,workInProgress),push(didPerformWorkStackCursor,didChange,workInProgress)}function findCurrentUnmaskedContext(fiber){if(!isFiberMounted(fiber)||1!==fiber.tag)throw Error("Expected subtree parent to be a mounted class component. This error is likely caused by a bug in React. Please file an issue.");var node=fiber;do{switch(node.tag){case 3:return node.stateNode.context;case 1:var Component;if(isContextProvider(node.type))return node.stateNode.__reactInternalMemoizedMergedChildContext}node=node.return}while(null!==node);throw Error("Found unexpected detached subtree parent. This error is likely caused by a bug in React. Please file an issue.")}var LegacyRoot=0,BlockingRoot=1,ConcurrentRoot=2,Scheduler_runWithPriority=Scheduler.unstable_runWithPriority,Scheduler_scheduleCallback=Scheduler.unstable_scheduleCallback,Scheduler_cancelCallback=Scheduler.unstable_cancelCallback,Scheduler_shouldYield=Scheduler.unstable_shouldYield,Scheduler_requestPaint=Scheduler.unstable_requestPaint,Scheduler_now=Scheduler.unstable_now,Scheduler_getCurrentPriorityLevel=Scheduler.unstable_getCurrentPriorityLevel,Scheduler_ImmediatePriority=Scheduler.unstable_ImmediatePriority,Scheduler_UserBlockingPriority=Scheduler.unstable_UserBlockingPriority,Scheduler_NormalPriority=Scheduler.unstable_NormalPriority,Scheduler_LowPriority=Scheduler.unstable_LowPriority,Scheduler_IdlePriority=Scheduler.unstable_IdlePriority;if(null==tracing.__interactionsRef||null==tracing.__interactionsRef.current)throw Error("It is not supported to run the profiling version of a renderer (for example, `react-dom/profiling`) without also replacing the `scheduler/tracing` module with `scheduler/tracing-profiling`. Your bundler might have a setting for aliasing both modules. Learn more at http://fb.me/react-profiling");var fakeCallbackNode={},ImmediatePriority=99,UserBlockingPriority$1=98,NormalPriority=97,LowPriority=96,IdlePriority=95,NoPriority=90,shouldYield=Scheduler_shouldYield,requestPaint=void 0!==Scheduler_requestPaint?Scheduler_requestPaint:function(){},syncQueue=null,immediateQueueCallbackNode=null,isFlushingSyncQueue=!1,initialTimeMs=Scheduler_now(),now=initialTimeMs<1e4?Scheduler_now:function(){return Scheduler_now()-initialTimeMs};function getCurrentPriorityLevel(){switch(Scheduler_getCurrentPriorityLevel()){case Scheduler_ImmediatePriority:return 99;case Scheduler_UserBlockingPriority:return 98;case Scheduler_NormalPriority:return 97;case Scheduler_LowPriority:return 96;case Scheduler_IdlePriority:return 95;default:throw Error("Unknown priority level.")}}function reactPriorityToSchedulerPriority(reactPriorityLevel){switch(reactPriorityLevel){case 99:return Scheduler_ImmediatePriority;case 98:return Scheduler_UserBlockingPriority;case 97:return Scheduler_NormalPriority;case 96:return Scheduler_LowPriority;case 95:return Scheduler_IdlePriority;default:throw Error("Unknown priority level.")}}function runWithPriority$1(reactPriorityLevel,fn){var priorityLevel=reactPriorityToSchedulerPriority(reactPriorityLevel);return Scheduler_runWithPriority(priorityLevel,fn)}function scheduleCallback(reactPriorityLevel,callback,options){var priorityLevel=reactPriorityToSchedulerPriority(reactPriorityLevel);return Scheduler_scheduleCallback(priorityLevel,callback,options)}function scheduleSyncCallback(callback){return null===syncQueue?(syncQueue=[callback],immediateQueueCallbackNode=Scheduler_scheduleCallback(Scheduler_ImmediatePriority,flushSyncCallbackQueueImpl)):syncQueue.push(callback),fakeCallbackNode}function cancelCallback(callbackNode){callbackNode!==fakeCallbackNode&&Scheduler_cancelCallback(callbackNode)}function flushSyncCallbackQueue(){if(null!==immediateQueueCallbackNode){var node=immediateQueueCallbackNode;immediateQueueCallbackNode=null,Scheduler_cancelCallback(node)}flushSyncCallbackQueueImpl()}function flushSyncCallbackQueueImpl(){if(!isFlushingSyncQueue&&null!==syncQueue){isFlushingSyncQueue=!0;var i=0;try{var _isSync=!0,queue=syncQueue;runWithPriority$1(99,(function(){for(;i<queue.length;i++){var callback=queue[i];do{callback=callback(!0)}while(null!==callback)}})),syncQueue=null}catch(error){throw null!==syncQueue&&(syncQueue=syncQueue.slice(i+1)),Scheduler_scheduleCallback(Scheduler_ImmediatePriority,flushSyncCallbackQueue),error}finally{isFlushingSyncQueue=!1}}}var NoMode=0,StrictMode=1,BlockingMode=2,ConcurrentMode=4,ProfileMode=8,MAX_SIGNED_31_BIT_INT=1073741823,NoWork=0,Never=1,Idle=2,ContinuousHydration=3,Sync=1073741823,Batched=Sync-1,UNIT_SIZE=10,MAGIC_NUMBER_OFFSET=Batched-1;function msToExpirationTime(ms){return 1073741821-(ms/10|0)}function expirationTimeToMs(expirationTime){return 10*(1073741821-expirationTime)}function ceiling(num,precision){return(1+(num/precision|0))*precision}function computeExpirationBucket(currentTime,expirationInMs,bucketSizeMs){return 1073741821-ceiling(1073741821-currentTime+expirationInMs/10,bucketSizeMs/10)}var LOW_PRIORITY_EXPIRATION=5e3,LOW_PRIORITY_BATCH_SIZE=250;function computeAsyncExpiration(currentTime){return computeExpirationBucket(currentTime,5e3,250)}function computeSuspenseExpiration(currentTime,timeoutMs){return computeExpirationBucket(currentTime,timeoutMs,250)}var HIGH_PRIORITY_EXPIRATION=500,HIGH_PRIORITY_BATCH_SIZE=100;function computeInteractiveExpiration(currentTime){return computeExpirationBucket(currentTime,500,100)}function inferPriorityFromExpirationTime(currentTime,expirationTime){if(expirationTime===Sync)return 99;if(1===expirationTime||2===expirationTime)return 95;var msUntil=expirationTimeToMs(expirationTime)-expirationTimeToMs(currentTime);return msUntil<=0?99:msUntil<=600?98:msUntil<=5250?97:95}var ReactStrictModeWarnings={recordUnsafeLifecycleWarnings:function(fiber,instance){},flushPendingUnsafeLifecycleWarnings:function(){},recordLegacyContextWarning:function(fiber,instance){},flushLegacyContextWarning:function(){},discardPendingWarnings:function(){}},findStrictRoot=function(fiber){for(var maybeStrictRoot=null,node=fiber;null!==node;)1&node.mode&&(maybeStrictRoot=node),node=node.return;return maybeStrictRoot},setToSortedString=function(set){var array=[];return set.forEach((function(value){array.push(value)})),array.sort().join(", ")},pendingComponentWillMountWarnings=[],pendingUNSAFE_ComponentWillMountWarnings=[],pendingComponentWillReceivePropsWarnings=[],pendingUNSAFE_ComponentWillReceivePropsWarnings=[],pendingComponentWillUpdateWarnings=[],pendingUNSAFE_ComponentWillUpdateWarnings=[],didWarnAboutUnsafeLifecycles=new Set;ReactStrictModeWarnings.recordUnsafeLifecycleWarnings=function(fiber,instance){didWarnAboutUnsafeLifecycles.has(fiber.type)||("function"==typeof instance.componentWillMount&&!0!==instance.componentWillMount.__suppressDeprecationWarning&&pendingComponentWillMountWarnings.push(fiber),1&fiber.mode&&"function"==typeof instance.UNSAFE_componentWillMount&&pendingUNSAFE_ComponentWillMountWarnings.push(fiber),"function"==typeof instance.componentWillReceiveProps&&!0!==instance.componentWillReceiveProps.__suppressDeprecationWarning&&pendingComponentWillReceivePropsWarnings.push(fiber),1&fiber.mode&&"function"==typeof instance.UNSAFE_componentWillReceiveProps&&pendingUNSAFE_ComponentWillReceivePropsWarnings.push(fiber),"function"==typeof instance.componentWillUpdate&&!0!==instance.componentWillUpdate.__suppressDeprecationWarning&&pendingComponentWillUpdateWarnings.push(fiber),1&fiber.mode&&"function"==typeof instance.UNSAFE_componentWillUpdate&&pendingUNSAFE_ComponentWillUpdateWarnings.push(fiber))},ReactStrictModeWarnings.flushPendingUnsafeLifecycleWarnings=function(){var componentWillMountUniqueNames=new Set;pendingComponentWillMountWarnings.length>0&&(pendingComponentWillMountWarnings.forEach((function(fiber){componentWillMountUniqueNames.add(getComponentName(fiber.type)||"Component"),didWarnAboutUnsafeLifecycles.add(fiber.type)})),pendingComponentWillMountWarnings=[]);var UNSAFE_componentWillMountUniqueNames=new Set;pendingUNSAFE_ComponentWillMountWarnings.length>0&&(pendingUNSAFE_ComponentWillMountWarnings.forEach((function(fiber){UNSAFE_componentWillMountUniqueNames.add(getComponentName(fiber.type)||"Component"),didWarnAboutUnsafeLifecycles.add(fiber.type)})),pendingUNSAFE_ComponentWillMountWarnings=[]);var componentWillReceivePropsUniqueNames=new Set;pendingComponentWillReceivePropsWarnings.length>0&&(pendingComponentWillReceivePropsWarnings.forEach((function(fiber){componentWillReceivePropsUniqueNames.add(getComponentName(fiber.type)||"Component"),didWarnAboutUnsafeLifecycles.add(fiber.type)})),pendingComponentWillReceivePropsWarnings=[]);var UNSAFE_componentWillReceivePropsUniqueNames=new Set;pendingUNSAFE_ComponentWillReceivePropsWarnings.length>0&&(pendingUNSAFE_ComponentWillReceivePropsWarnings.forEach((function(fiber){UNSAFE_componentWillReceivePropsUniqueNames.add(getComponentName(fiber.type)||"Component"),didWarnAboutUnsafeLifecycles.add(fiber.type)})),pendingUNSAFE_ComponentWillReceivePropsWarnings=[]);var componentWillUpdateUniqueNames=new Set;pendingComponentWillUpdateWarnings.length>0&&(pendingComponentWillUpdateWarnings.forEach((function(fiber){componentWillUpdateUniqueNames.add(getComponentName(fiber.type)||"Component"),didWarnAboutUnsafeLifecycles.add(fiber.type)})),pendingComponentWillUpdateWarnings=[]);var UNSAFE_componentWillUpdateUniqueNames=new Set,sortedNames,_sortedNames,_sortedNames2,_sortedNames3,_sortedNames4,_sortedNames5;(pendingUNSAFE_ComponentWillUpdateWarnings.length>0&&(pendingUNSAFE_ComponentWillUpdateWarnings.forEach((function(fiber){UNSAFE_componentWillUpdateUniqueNames.add(getComponentName(fiber.type)||"Component"),didWarnAboutUnsafeLifecycles.add(fiber.type)})),pendingUNSAFE_ComponentWillUpdateWarnings=[]),UNSAFE_componentWillMountUniqueNames.size>0)&&error("Using UNSAFE_componentWillMount in strict mode is not recommended and may indicate bugs in your code. See https://fb.me/react-unsafe-component-lifecycles for details.\n\n* Move code with side effects to componentDidMount, and set initial state in the constructor.\n\nPlease update the following components: %s",setToSortedString(UNSAFE_componentWillMountUniqueNames));UNSAFE_componentWillReceivePropsUniqueNames.size>0&&error("Using UNSAFE_componentWillReceiveProps in strict mode is not recommended and may indicate bugs in your code. See https://fb.me/react-unsafe-component-lifecycles for details.\n\n* Move data fetching code or side effects to componentDidUpdate.\n* If you're updating state whenever props change, refactor your code to use memoization techniques or move it to static getDerivedStateFromProps. Learn more at: https://fb.me/react-derived-state\n\nPlease update the following components: %s",setToSortedString(UNSAFE_componentWillReceivePropsUniqueNames));UNSAFE_componentWillUpdateUniqueNames.size>0&&error("Using UNSAFE_componentWillUpdate in strict mode is not recommended and may indicate bugs in your code. See https://fb.me/react-unsafe-component-lifecycles for details.\n\n* Move data fetching code or side effects to componentDidUpdate.\n\nPlease update the following components: %s",setToSortedString(UNSAFE_componentWillUpdateUniqueNames));componentWillMountUniqueNames.size>0&&warn("componentWillMount has been renamed, and is not recommended for use. See https://fb.me/react-unsafe-component-lifecycles for details.\n\n* Move code with side effects to componentDidMount, and set initial state in the constructor.\n* Rename componentWillMount to UNSAFE_componentWillMount to suppress this warning in non-strict mode. In React 17.x, only the UNSAFE_ name will work. To rename all deprecated lifecycles to their new names, you can run `npx react-codemod rename-unsafe-lifecycles` in your project source folder.\n\nPlease update the following components: %s",setToSortedString(componentWillMountUniqueNames));componentWillReceivePropsUniqueNames.size>0&&warn("componentWillReceiveProps has been renamed, and is not recommended for use. See https://fb.me/react-unsafe-component-lifecycles for details.\n\n* Move data fetching code or side effects to componentDidUpdate.\n* If you're updating state whenever props change, refactor your code to use memoization techniques or move it to static getDerivedStateFromProps. Learn more at: https://fb.me/react-derived-state\n* Rename componentWillReceiveProps to UNSAFE_componentWillReceiveProps to suppress this warning in non-strict mode. In React 17.x, only the UNSAFE_ name will work. To rename all deprecated lifecycles to their new names, you can run `npx react-codemod rename-unsafe-lifecycles` in your project source folder.\n\nPlease update the following components: %s",setToSortedString(componentWillReceivePropsUniqueNames));componentWillUpdateUniqueNames.size>0&&warn("componentWillUpdate has been renamed, and is not recommended for use. See https://fb.me/react-unsafe-component-lifecycles for details.\n\n* Move data fetching code or side effects to componentDidUpdate.\n* Rename componentWillUpdate to UNSAFE_componentWillUpdate to suppress this warning in non-strict mode. In React 17.x, only the UNSAFE_ name will work. To rename all deprecated lifecycles to their new names, you can run `npx react-codemod rename-unsafe-lifecycles` in your project source folder.\n\nPlease update the following components: %s",setToSortedString(componentWillUpdateUniqueNames))};var pendingLegacyContextWarning=new Map,didWarnAboutLegacyContext=new Set;ReactStrictModeWarnings.recordLegacyContextWarning=function(fiber,instance){var strictRoot=findStrictRoot(fiber);if(null!==strictRoot){if(!didWarnAboutLegacyContext.has(fiber.type)){var warningsForRoot=pendingLegacyContextWarning.get(strictRoot);(null!=fiber.type.contextTypes||null!=fiber.type.childContextTypes||null!==instance&&"function"==typeof instance.getChildContext)&&(void 0===warningsForRoot&&(warningsForRoot=[],pendingLegacyContextWarning.set(strictRoot,warningsForRoot)),warningsForRoot.push(fiber))}}else error("Expected to find a StrictMode component in a strict mode tree. This error is likely caused by a bug in React. Please file an issue.")},ReactStrictModeWarnings.flushLegacyContextWarning=function(){pendingLegacyContextWarning.forEach((function(fiberArray,strictRoot){if(0!==fiberArray.length){var firstFiber=fiberArray[0],uniqueNames=new Set,sortedNames,firstComponentStack;fiberArray.forEach((function(fiber){uniqueNames.add(getComponentName(fiber.type)||"Component"),didWarnAboutLegacyContext.add(fiber.type)})),error("Legacy context API has been detected within a strict-mode tree.\n\nThe old API will be supported in all 16.x releases, but applications using it should migrate to the new version.\n\nPlease update the following components: %s\n\nLearn more about this warning here: https://fb.me/react-legacy-context%s",setToSortedString(uniqueNames),getStackByFiberInDevAndProd(firstFiber))}}))},ReactStrictModeWarnings.discardPendingWarnings=function(){pendingComponentWillMountWarnings=[],pendingUNSAFE_ComponentWillMountWarnings=[],pendingComponentWillReceivePropsWarnings=[],pendingUNSAFE_ComponentWillReceivePropsWarnings=[],pendingComponentWillUpdateWarnings=[],pendingUNSAFE_ComponentWillUpdateWarnings=[],pendingLegacyContextWarning=new Map};var resolveFamily=null,failedBoundaries=null,setRefreshHandler=function(handler){resolveFamily=handler};function resolveFunctionForHotReloading(type){if(null===resolveFamily)return type;var family=resolveFamily(type);return void 0===family?type:family.current}function resolveClassForHotReloading(type){return resolveFunctionForHotReloading(type)}function resolveForwardRefForHotReloading(type){if(null===resolveFamily)return type;var family=resolveFamily(type);if(void 0===family){if(null!=type&&"function"==typeof type.render){var currentRender=resolveFunctionForHotReloading(type.render);if(type.render!==currentRender){var syntheticType={$$typeof:REACT_FORWARD_REF_TYPE,render:currentRender};return void 0!==type.displayName&&(syntheticType.displayName=type.displayName),syntheticType}}return type}return family.current}function isCompatibleFamilyForHotReloading(fiber,element){if(null===resolveFamily)return!1;var prevType=fiber.elementType,nextType=element.type,needsCompareFamilies=!1,$$typeofNextType="object"==typeof nextType&&null!==nextType?nextType.$$typeof:null;switch(fiber.tag){case 1:"function"==typeof nextType&&(needsCompareFamilies=!0);break;case 0:"function"==typeof nextType?needsCompareFamilies=!0:$$typeofNextType===REACT_LAZY_TYPE&&(needsCompareFamilies=!0);break;case 11:$$typeofNextType===REACT_FORWARD_REF_TYPE?needsCompareFamilies=!0:$$typeofNextType===REACT_LAZY_TYPE&&(needsCompareFamilies=!0);break;case 14:case 15:$$typeofNextType===REACT_MEMO_TYPE?needsCompareFamilies=!0:$$typeofNextType===REACT_LAZY_TYPE&&(needsCompareFamilies=!0);break;default:return!1}if(needsCompareFamilies){var prevFamily=resolveFamily(prevType);if(void 0!==prevFamily&&prevFamily===resolveFamily(nextType))return!0}return!1}function markFailedErrorBoundaryForHotReloading(fiber){null!==resolveFamily&&"function"==typeof WeakSet&&(null===failedBoundaries&&(failedBoundaries=new WeakSet),failedBoundaries.add(fiber))}var scheduleRefresh=function(root,update){if(null!==resolveFamily){var staleFamilies=update.staleFamilies,updatedFamilies=update.updatedFamilies;flushPassiveEffects(),flushSync((function(){scheduleFibersWithFamiliesRecursively(root.current,updatedFamilies,staleFamilies)}))}},scheduleRoot=function(root,element){root.context===emptyContextObject&&(flushPassiveEffects(),syncUpdates((function(){updateContainer(element,root,null,null)})))};function scheduleFibersWithFamiliesRecursively(fiber,updatedFamilies,staleFamilies){var alternate=fiber.alternate,child=fiber.child,sibling=fiber.sibling,tag=fiber.tag,type=fiber.type,candidateType=null;switch(tag){case 0:case 15:case 1:candidateType=type;break;case 11:candidateType=type.render}if(null===resolveFamily)throw new Error("Expected resolveFamily to be set during hot reload.");var needsRender=!1,needsRemount=!1;if(null!==candidateType){var family=resolveFamily(candidateType);void 0!==family&&(staleFamilies.has(family)?needsRemount=!0:updatedFamilies.has(family)&&(1===tag?needsRemount=!0:needsRender=!0))}null!==failedBoundaries&&(failedBoundaries.has(fiber)||null!==alternate&&failedBoundaries.has(alternate))&&(needsRemount=!0),needsRemount&&(fiber._debugNeedsRemount=!0),(needsRemount||needsRender)&&scheduleWork(fiber,Sync),null===child||needsRemount||scheduleFibersWithFamiliesRecursively(child,updatedFamilies,staleFamilies),null!==sibling&&scheduleFibersWithFamiliesRecursively(sibling,updatedFamilies,staleFamilies)}var findHostInstancesForRefresh=function(root,families){var hostInstances=new Set,types=new Set(families.map((function(family){return family.current})));return findHostInstancesForMatchingFibersRecursively(root.current,types,hostInstances),hostInstances};function findHostInstancesForMatchingFibersRecursively(fiber,types,hostInstances){var child=fiber.child,sibling=fiber.sibling,tag=fiber.tag,type=fiber.type,candidateType=null;switch(tag){case 0:case 15:case 1:candidateType=type;break;case 11:candidateType=type.render}var didMatch=!1;null!==candidateType&&types.has(candidateType)&&(didMatch=!0),didMatch?findHostInstancesForFiberShallowly(fiber,hostInstances):null!==child&&findHostInstancesForMatchingFibersRecursively(child,types,hostInstances),null!==sibling&&findHostInstancesForMatchingFibersRecursively(sibling,types,hostInstances)}function findHostInstancesForFiberShallowly(fiber,hostInstances){var foundHostInstances;if(!findChildHostInstancesForFiberShallowly(fiber,hostInstances))for(var node=fiber;;){switch(node.tag){case 5:return void hostInstances.add(node.stateNode);case 4:case 3:return void hostInstances.add(node.stateNode.containerInfo)}if(null===node.return)throw new Error("Expected to reach root first.");node=node.return}}function findChildHostInstancesForFiberShallowly(fiber,hostInstances){for(var node=fiber,foundHostInstances=!1;;){if(5===node.tag)foundHostInstances=!0,hostInstances.add(node.stateNode);else if(null!==node.child){node.child.return=node,node=node.child;continue}if(node===fiber)return foundHostInstances;for(;null===node.sibling;){if(null===node.return||node.return===fiber)return foundHostInstances;node=node.return}node.sibling.return=node.return,node=node.sibling}return!1}function resolveDefaultProps(Component,baseProps){if(Component&&Component.defaultProps){var props=_assign({},baseProps),defaultProps=Component.defaultProps;for(var propName in defaultProps)void 0===props[propName]&&(props[propName]=defaultProps[propName]);return props}return baseProps}function readLazyComponentType(lazyComponent){if(initializeLazyComponentType(lazyComponent),1!==lazyComponent._status)throw lazyComponent._result;return lazyComponent._result}var valueCursor=createCursor(null),rendererSigil;rendererSigil={};var currentlyRenderingFiber=null,lastContextDependency=null,lastContextWithAllBitsObserved=null,isDisallowedContextReadInDEV=!1;function resetContextDependencies(){currentlyRenderingFiber=null,lastContextDependency=null,lastContextWithAllBitsObserved=null,isDisallowedContextReadInDEV=!1}function enterDisallowedContextReadInDEV(){isDisallowedContextReadInDEV=!0}function exitDisallowedContextReadInDEV(){isDisallowedContextReadInDEV=!1}function pushProvider(providerFiber,nextValue){var context=providerFiber.type._context;push(valueCursor,context._currentValue,providerFiber),context._currentValue=nextValue,void 0!==context._currentRenderer&&null!==context._currentRenderer&&context._currentRenderer!==rendererSigil&&error("Detected multiple renderers concurrently rendering the same context provider. This is currently unsupported."),context._currentRenderer=rendererSigil}function popProvider(providerFiber){var currentValue=valueCursor.current,context;pop(valueCursor,providerFiber),providerFiber.type._context._currentValue=currentValue}function calculateChangedBits(context,newValue,oldValue){if(objectIs(oldValue,newValue))return 0;var changedBits="function"==typeof context._calculateChangedBits?context._calculateChangedBits(oldValue,newValue):1073741823;return(1073741823&changedBits)!==changedBits&&error("calculateChangedBits: Expected the return value to be a 31-bit integer. Instead received: %s",changedBits),0|changedBits}function scheduleWorkOnParentPath(parent,renderExpirationTime){for(var node=parent;null!==node;){var alternate=node.alternate;if(node.childExpirationTime<renderExpirationTime)node.childExpirationTime=renderExpirationTime,null!==alternate&&alternate.childExpirationTime<renderExpirationTime&&(alternate.childExpirationTime=renderExpirationTime);else{if(!(null!==alternate&&alternate.childExpirationTime<renderExpirationTime))break;alternate.childExpirationTime=renderExpirationTime}node=node.return}}function propagateContextChange(workInProgress,context,changedBits,renderExpirationTime){var fiber=workInProgress.child;for(null!==fiber&&(fiber.return=workInProgress);null!==fiber;){var nextFiber=void 0,list=fiber.dependencies;if(null!==list){nextFiber=fiber.child;for(var dependency=list.firstContext;null!==dependency;){if(dependency.context===context&&0!=(dependency.observedBits&changedBits)){if(1===fiber.tag){var update=createUpdate(renderExpirationTime,null);update.tag=ForceUpdate,enqueueUpdate(fiber,update)}fiber.expirationTime<renderExpirationTime&&(fiber.expirationTime=renderExpirationTime);var alternate=fiber.alternate;null!==alternate&&alternate.expirationTime<renderExpirationTime&&(alternate.expirationTime=renderExpirationTime),scheduleWorkOnParentPath(fiber.return,renderExpirationTime),list.expirationTime<renderExpirationTime&&(list.expirationTime=renderExpirationTime);break}dependency=dependency.next}}else nextFiber=10===fiber.tag&&fiber.type===workInProgress.type?null:fiber.child;if(null!==nextFiber)nextFiber.return=fiber;else for(nextFiber=fiber;null!==nextFiber;){if(nextFiber===workInProgress){nextFiber=null;break}var sibling=nextFiber.sibling;if(null!==sibling){sibling.return=nextFiber.return,nextFiber=sibling;break}nextFiber=nextFiber.return}fiber=nextFiber}}function prepareToReadContext(workInProgress,renderExpirationTime){currentlyRenderingFiber=workInProgress,lastContextDependency=null,lastContextWithAllBitsObserved=null;var dependencies=workInProgress.dependencies,firstContext;null!==dependencies&&(null!==dependencies.firstContext&&(dependencies.expirationTime>=renderExpirationTime&&markWorkInProgressReceivedUpdate(),dependencies.firstContext=null))}function readContext(context,observedBits){if(isDisallowedContextReadInDEV&&error("Context can only be read while React is rendering. In classes, you can read it in the render method or getDerivedStateFromProps. In function components, you can read it directly in the function body, but not inside Hooks like useReducer() or useMemo()."),lastContextWithAllBitsObserved===context);else if(!1===observedBits||0===observedBits);else{var resolvedObservedBits;"number"!=typeof observedBits||1073741823===observedBits?(lastContextWithAllBitsObserved=context,resolvedObservedBits=1073741823):resolvedObservedBits=observedBits;var contextItem={context:context,observedBits:resolvedObservedBits,next:null};if(null===lastContextDependency){if(null===currentlyRenderingFiber)throw Error("Context can only be read while React is rendering. In classes, you can read it in the render method or getDerivedStateFromProps. In function components, you can read it directly in the function body, but not inside Hooks like useReducer() or useMemo().");lastContextDependency=contextItem,currentlyRenderingFiber.dependencies={expirationTime:0,firstContext:contextItem,responders:null}}else lastContextDependency=lastContextDependency.next=contextItem}return context._currentValue}var UpdateState=0,ReplaceState=1,ForceUpdate=2,CaptureUpdate=3,hasForceUpdate=!1,didWarnUpdateInsideUpdate,currentlyProcessingQueue;function initializeUpdateQueue(fiber){var queue={baseState:fiber.memoizedState,baseQueue:null,shared:{pending:null},effects:null};fiber.updateQueue=queue}function cloneUpdateQueue(current,workInProgress){var queue=workInProgress.updateQueue,currentQueue=current.updateQueue;if(queue===currentQueue){var clone={baseState:currentQueue.baseState,baseQueue:currentQueue.baseQueue,shared:currentQueue.shared,effects:currentQueue.effects};workInProgress.updateQueue=clone}}function createUpdate(expirationTime,suspenseConfig){var update={expirationTime:expirationTime,suspenseConfig:suspenseConfig,tag:0,payload:null,callback:null,next:null};return update.next=update,update.priority=getCurrentPriorityLevel(),update}function enqueueUpdate(fiber,update){var updateQueue=fiber.updateQueue;if(null!==updateQueue){var sharedQueue=updateQueue.shared,pending=sharedQueue.pending;null===pending?update.next=update:(update.next=pending.next,pending.next=update),sharedQueue.pending=update,currentlyProcessingQueue!==sharedQueue||didWarnUpdateInsideUpdate||(error("An update (setState, replaceState, or forceUpdate) was scheduled from inside an update function. Update functions should be pure, with zero side-effects. Consider using componentDidUpdate or a callback."),didWarnUpdateInsideUpdate=!0)}}function enqueueCapturedUpdate(workInProgress,update){var current=workInProgress.alternate;null!==current&&cloneUpdateQueue(current,workInProgress);var queue=workInProgress.updateQueue,last=queue.baseQueue;null===last?(queue.baseQueue=update.next=update,update.next=update):(update.next=last.next,last.next=update)}function getStateFromUpdate(workInProgress,queue,update,prevState,nextProps,instance){switch(update.tag){case 1:var payload=update.payload;if("function"==typeof payload){enterDisallowedContextReadInDEV(),1&workInProgress.mode&&payload.call(instance,prevState,nextProps);var nextState=payload.call(instance,prevState,nextProps);return exitDisallowedContextReadInDEV(),nextState}return payload;case 3:workInProgress.effectTag=-4097&workInProgress.effectTag|64;case 0:var _payload=update.payload,partialState;return"function"==typeof _payload?(enterDisallowedContextReadInDEV(),1&workInProgress.mode&&_payload.call(instance,prevState,nextProps),partialState=_payload.call(instance,prevState,nextProps),exitDisallowedContextReadInDEV()):partialState=_payload,null==partialState?prevState:_assign({},prevState,partialState);case ForceUpdate:return hasForceUpdate=!0,prevState}return prevState}function processUpdateQueue(workInProgress,props,instance,renderExpirationTime){var queue=workInProgress.updateQueue;hasForceUpdate=!1,currentlyProcessingQueue=queue.shared;var baseQueue=queue.baseQueue,pendingQueue=queue.shared.pending;if(null!==pendingQueue){if(null!==baseQueue){var baseFirst=baseQueue.next,pendingFirst=pendingQueue.next;baseQueue.next=pendingFirst,pendingQueue.next=baseFirst}baseQueue=pendingQueue,queue.shared.pending=null;var current=workInProgress.alternate;if(null!==current){var currentQueue=current.updateQueue;null!==currentQueue&&(currentQueue.baseQueue=pendingQueue)}}if(null!==baseQueue){var first=baseQueue.next,newState=queue.baseState,newExpirationTime=0,newBaseState=null,newBaseQueueFirst=null,newBaseQueueLast=null;if(null!==first)for(var update=first;;){var updateExpirationTime=update.expirationTime;if(updateExpirationTime<renderExpirationTime){var clone={expirationTime:update.expirationTime,suspenseConfig:update.suspenseConfig,tag:update.tag,payload:update.payload,callback:update.callback,next:null};null===newBaseQueueLast?(newBaseQueueFirst=newBaseQueueLast=clone,newBaseState=newState):newBaseQueueLast=newBaseQueueLast.next=clone,updateExpirationTime>newExpirationTime&&(newExpirationTime=updateExpirationTime)}else{if(null!==newBaseQueueLast){var _clone={expirationTime:Sync,suspenseConfig:update.suspenseConfig,tag:update.tag,payload:update.payload,callback:update.callback,next:null};newBaseQueueLast=newBaseQueueLast.next=_clone}var callback;if(markRenderEventTimeAndConfig(updateExpirationTime,update.suspenseConfig),newState=getStateFromUpdate(workInProgress,queue,update,newState,props,instance),null!==update.callback){workInProgress.effectTag|=32;var effects=queue.effects;null===effects?queue.effects=[update]:effects.push(update)}}if(null===(update=update.next)||update===first){if(null===(pendingQueue=queue.shared.pending))break;update=baseQueue.next=pendingQueue.next,pendingQueue.next=first,queue.baseQueue=baseQueue=pendingQueue,queue.shared.pending=null}}null===newBaseQueueLast?newBaseState=newState:newBaseQueueLast.next=newBaseQueueFirst,queue.baseState=newBaseState,queue.baseQueue=newBaseQueueLast,markUnprocessedUpdateTime(newExpirationTime),workInProgress.expirationTime=newExpirationTime,workInProgress.memoizedState=newState}currentlyProcessingQueue=null}function callCallback(callback,context){if("function"!=typeof callback)throw Error("Invalid argument passed as callback. Expected a function. Instead received: "+callback);callback.call(context)}function resetHasForceUpdateBeforeProcessing(){hasForceUpdate=!1}function checkHasForceUpdateAfterProcessing(){return hasForceUpdate}function commitUpdateQueue(finishedWork,finishedQueue,instance){var effects=finishedQueue.effects;if(finishedQueue.effects=null,null!==effects)for(var i=0;i<effects.length;i++){var effect=effects[i],callback=effect.callback;null!==callback&&(effect.callback=null,callCallback(callback,instance))}}didWarnUpdateInsideUpdate=!1,currentlyProcessingQueue=null;var ReactCurrentBatchConfig=ReactSharedInternals.ReactCurrentBatchConfig;function requestCurrentSuspenseConfig(){return ReactCurrentBatchConfig.suspense}var fakeInternalInstance={},isArray=Array.isArray,emptyRefsObject=(new React.Component).refs,didWarnAboutStateAssignmentForComponent,didWarnAboutUninitializedState,didWarnAboutGetSnapshotBeforeUpdateWithoutDidUpdate,didWarnAboutLegacyLifecyclesAndDerivedState,didWarnAboutUndefinedDerivedState,warnOnUndefinedDerivedState,warnOnInvalidCallback,didWarnAboutDirectlyAssigningPropsToState,didWarnAboutContextTypeAndContextTypes,didWarnAboutInvalidateContextType;didWarnAboutStateAssignmentForComponent=new Set,didWarnAboutUninitializedState=new Set,didWarnAboutGetSnapshotBeforeUpdateWithoutDidUpdate=new Set,didWarnAboutLegacyLifecyclesAndDerivedState=new Set,didWarnAboutDirectlyAssigningPropsToState=new Set,didWarnAboutUndefinedDerivedState=new Set,didWarnAboutContextTypeAndContextTypes=new Set,didWarnAboutInvalidateContextType=new Set;var didWarnOnInvalidCallback=new Set;function applyDerivedStateFromProps(workInProgress,ctor,getDerivedStateFromProps,nextProps){var prevState=workInProgress.memoizedState;1&workInProgress.mode&&getDerivedStateFromProps(nextProps,prevState);var partialState=getDerivedStateFromProps(nextProps,prevState);warnOnUndefinedDerivedState(ctor,partialState);var memoizedState=null==partialState?prevState:_assign({},prevState,partialState),updateQueue;(workInProgress.memoizedState=memoizedState,0===workInProgress.expirationTime)&&(workInProgress.updateQueue.baseState=memoizedState)}warnOnInvalidCallback=function(callback,callerName){if(null!==callback&&"function"!=typeof callback){var key=callerName+"_"+callback;didWarnOnInvalidCallback.has(key)||(didWarnOnInvalidCallback.add(key),error("%s(...): Expected the last optional `callback` argument to be a function. Instead received: %s.",callerName,callback))}},warnOnUndefinedDerivedState=function(type,partialState){if(void 0===partialState){var componentName=getComponentName(type)||"Component";didWarnAboutUndefinedDerivedState.has(componentName)||(didWarnAboutUndefinedDerivedState.add(componentName),error("%s.getDerivedStateFromProps(): A valid state object (or null) must be returned. You have returned undefined.",componentName))}},Object.defineProperty(fakeInternalInstance,"_processChildContext",{enumerable:!1,value:function(){throw Error("_processChildContext is not available in React 16+. This likely means you have multiple copies of React and are attempting to nest a React 15 tree inside a React 16 tree using unstable_renderSubtreeIntoContainer, which isn't supported. Try to make sure you have only one copy of React (and ideally, switch to ReactDOM.createPortal).")}}),Object.freeze(fakeInternalInstance);var classComponentUpdater={isMounted:isMounted,enqueueSetState:function(inst,payload,callback){var fiber=get(inst),currentTime=requestCurrentTimeForUpdate(),suspenseConfig=requestCurrentSuspenseConfig(),expirationTime=computeExpirationForFiber(currentTime,fiber,suspenseConfig),update=createUpdate(expirationTime,suspenseConfig);update.payload=payload,null!=callback&&(warnOnInvalidCallback(callback,"setState"),update.callback=callback),enqueueUpdate(fiber,update),scheduleWork(fiber,expirationTime)},enqueueReplaceState:function(inst,payload,callback){var fiber=get(inst),currentTime=requestCurrentTimeForUpdate(),suspenseConfig=requestCurrentSuspenseConfig(),expirationTime=computeExpirationForFiber(currentTime,fiber,suspenseConfig),update=createUpdate(expirationTime,suspenseConfig);update.tag=1,update.payload=payload,null!=callback&&(warnOnInvalidCallback(callback,"replaceState"),update.callback=callback),enqueueUpdate(fiber,update),scheduleWork(fiber,expirationTime)},enqueueForceUpdate:function(inst,callback){var fiber=get(inst),currentTime=requestCurrentTimeForUpdate(),suspenseConfig=requestCurrentSuspenseConfig(),expirationTime=computeExpirationForFiber(currentTime,fiber,suspenseConfig),update=createUpdate(expirationTime,suspenseConfig);update.tag=ForceUpdate,null!=callback&&(warnOnInvalidCallback(callback,"forceUpdate"),update.callback=callback),enqueueUpdate(fiber,update),scheduleWork(fiber,expirationTime)}},didWarnAboutMaps,didWarnAboutGenerators,didWarnAboutStringRefs,ownerHasKeyUseWarning,ownerHasFunctionTypeWarning;function checkShouldComponentUpdate(workInProgress,ctor,oldProps,newProps,oldState,newState,nextContext){var instance=workInProgress.stateNode;if("function"==typeof instance.shouldComponentUpdate){1&workInProgress.mode&&instance.shouldComponentUpdate(newProps,newState,nextContext),startPhaseTimer(workInProgress,"shouldComponentUpdate");var shouldUpdate=instance.shouldComponentUpdate(newProps,newState,nextContext);return stopPhaseTimer(),void 0===shouldUpdate&&error("%s.shouldComponentUpdate(): Returned undefined instead of a boolean value. Make sure to return true or false.",getComponentName(ctor)||"Component"),shouldUpdate}return!ctor.prototype||!ctor.prototype.isPureReactComponent||(!shallowEqual(oldProps,newProps)||!shallowEqual(oldState,newState))}function checkClassInstance(workInProgress,ctor,newProps){var instance=workInProgress.stateNode,name=getComponentName(ctor)||"Component",renderPresent;instance.render||(ctor.prototype&&"function"==typeof ctor.prototype.render?error("%s(...): No `render` method found on the returned component instance: did you accidentally return an object from the constructor?",name):error("%s(...): No `render` method found on the returned component instance: you may have forgotten to define `render`.",name)),!instance.getInitialState||instance.getInitialState.isReactClassApproved||instance.state||error("getInitialState was defined on %s, a plain JavaScript class. This is only supported for classes created using React.createClass. Did you mean to define a state property instead?",name),instance.getDefaultProps&&!instance.getDefaultProps.isReactClassApproved&&error("getDefaultProps was defined on %s, a plain JavaScript class. This is only supported for classes created using React.createClass. Use a static property to define defaultProps instead.",name),instance.propTypes&&error("propTypes was defined as an instance property on %s. Use a static property to define propTypes instead.",name),instance.contextType&&error("contextType was defined as an instance property on %s. Use a static property to define contextType instead.",name),instance.contextTypes&&error("contextTypes was defined as an instance property on %s. Use a static property to define contextTypes instead.",name),ctor.contextType&&ctor.contextTypes&&!didWarnAboutContextTypeAndContextTypes.has(ctor)&&(didWarnAboutContextTypeAndContextTypes.add(ctor),error("%s declares both contextTypes and contextType static properties. The legacy contextTypes property will be ignored.",name)),"function"==typeof instance.componentShouldUpdate&&error("%s has a method called componentShouldUpdate(). Did you mean shouldComponentUpdate()? The name is phrased as a question because the function is expected to return a value.",name),ctor.prototype&&ctor.prototype.isPureReactComponent&&void 0!==instance.shouldComponentUpdate&&error("%s has a method called shouldComponentUpdate(). shouldComponentUpdate should not be used when extending React.PureComponent. Please extend React.Component if shouldComponentUpdate is used.",getComponentName(ctor)||"A pure component"),"function"==typeof instance.componentDidUnmount&&error("%s has a method called componentDidUnmount(). But there is no such lifecycle method. Did you mean componentWillUnmount()?",name),"function"==typeof instance.componentDidReceiveProps&&error("%s has a method called componentDidReceiveProps(). But there is no such lifecycle method. If you meant to update the state in response to changing props, use componentWillReceiveProps(). If you meant to fetch data or run side-effects or mutations after React has updated the UI, use componentDidUpdate().",name),"function"==typeof instance.componentWillRecieveProps&&error("%s has a method called componentWillRecieveProps(). Did you mean componentWillReceiveProps()?",name),"function"==typeof instance.UNSAFE_componentWillRecieveProps&&error("%s has a method called UNSAFE_componentWillRecieveProps(). Did you mean UNSAFE_componentWillReceiveProps()?",name);var hasMutatedProps=instance.props!==newProps;void 0!==instance.props&&hasMutatedProps&&error("%s(...): When calling super() in `%s`, make sure to pass up the same props that your component's constructor was passed.",name,name),instance.defaultProps&&error("Setting defaultProps as an instance property on %s is not supported and will be ignored. Instead, define defaultProps as a static property on %s.",name,name),"function"!=typeof instance.getSnapshotBeforeUpdate||"function"==typeof instance.componentDidUpdate||didWarnAboutGetSnapshotBeforeUpdateWithoutDidUpdate.has(ctor)||(didWarnAboutGetSnapshotBeforeUpdateWithoutDidUpdate.add(ctor),error("%s: getSnapshotBeforeUpdate() should be used with componentDidUpdate(). This component defines getSnapshotBeforeUpdate() only.",getComponentName(ctor))),"function"==typeof instance.getDerivedStateFromProps&&error("%s: getDerivedStateFromProps() is defined as an instance method and will be ignored. Instead, declare it as a static method.",name),"function"==typeof instance.getDerivedStateFromError&&error("%s: getDerivedStateFromError() is defined as an instance method and will be ignored. Instead, declare it as a static method.",name),"function"==typeof ctor.getSnapshotBeforeUpdate&&error("%s: getSnapshotBeforeUpdate() is defined as a static method and will be ignored. Instead, declare it as an instance method.",name);var _state=instance.state;_state&&("object"!=typeof _state||isArray(_state))&&error("%s.state: must be set to an object or null",name),"function"==typeof instance.getChildContext&&"object"!=typeof ctor.childContextTypes&&error("%s.getChildContext(): childContextTypes must be defined in order to use getChildContext().",name)}function adoptClassInstance(workInProgress,instance){instance.updater=classComponentUpdater,workInProgress.stateNode=instance,set(instance,workInProgress),instance._reactInternalInstance=fakeInternalInstance}function constructClassInstance(workInProgress,ctor,props){var isLegacyContextConsumer=!1,unmaskedContext=emptyContextObject,context=emptyContextObject,contextType=ctor.contextType,isValid;if("contextType"in ctor&&(!(null===contextType||void 0!==contextType&&contextType.$$typeof===REACT_CONTEXT_TYPE&&void 0===contextType._context)&&!didWarnAboutInvalidateContextType.has(ctor))){didWarnAboutInvalidateContextType.add(ctor);var addendum="";addendum=void 0===contextType?" However, it is set to undefined. This can be caused by a typo or by mixing up named and default imports. This can also happen due to a circular dependency, so try moving the createContext() call to a separate file.":"object"!=typeof contextType?" However, it is set to a "+typeof contextType+".":contextType.$$typeof===REACT_PROVIDER_TYPE?" Did you accidentally pass the Context.Provider instead?":void 0!==contextType._context?" Did you accidentally pass the Context.Consumer instead?":" However, it is set to an object with keys {"+Object.keys(contextType).join(", ")+"}.",error("%s defines an invalid contextType. contextType should point to the Context object returned by React.createContext().%s",getComponentName(ctor)||"Component",addendum)}if("object"==typeof contextType&&null!==contextType)context=readContext(contextType);else{unmaskedContext=getUnmaskedContext(workInProgress,ctor,!0);var contextTypes=ctor.contextTypes;context=(isLegacyContextConsumer=null!=contextTypes)?getMaskedContext(workInProgress,unmaskedContext):emptyContextObject}1&workInProgress.mode&&new ctor(props,context);var instance=new ctor(props,context),state=workInProgress.memoizedState=null!==instance.state&&void 0!==instance.state?instance.state:null;if(adoptClassInstance(workInProgress,instance),"function"==typeof ctor.getDerivedStateFromProps&&null===state){var componentName=getComponentName(ctor)||"Component";didWarnAboutUninitializedState.has(componentName)||(didWarnAboutUninitializedState.add(componentName),error("`%s` uses `getDerivedStateFromProps` but its initial state is %s. This is not recommended. Instead, define the initial state by assigning an object to `this.state` in the constructor of `%s`. This ensures that `getDerivedStateFromProps` arguments have a consistent shape.",componentName,null===instance.state?"null":"undefined",componentName))}if("function"==typeof ctor.getDerivedStateFromProps||"function"==typeof instance.getSnapshotBeforeUpdate){var foundWillMountName=null,foundWillReceivePropsName=null,foundWillUpdateName=null;if("function"==typeof instance.componentWillMount&&!0!==instance.componentWillMount.__suppressDeprecationWarning?foundWillMountName="componentWillMount":"function"==typeof instance.UNSAFE_componentWillMount&&(foundWillMountName="UNSAFE_componentWillMount"),"function"==typeof instance.componentWillReceiveProps&&!0!==instance.componentWillReceiveProps.__suppressDeprecationWarning?foundWillReceivePropsName="componentWillReceiveProps":"function"==typeof instance.UNSAFE_componentWillReceiveProps&&(foundWillReceivePropsName="UNSAFE_componentWillReceiveProps"),"function"==typeof instance.componentWillUpdate&&!0!==instance.componentWillUpdate.__suppressDeprecationWarning?foundWillUpdateName="componentWillUpdate":"function"==typeof instance.UNSAFE_componentWillUpdate&&(foundWillUpdateName="UNSAFE_componentWillUpdate"),null!==foundWillMountName||null!==foundWillReceivePropsName||null!==foundWillUpdateName){var _componentName=getComponentName(ctor)||"Component",newApiName="function"==typeof ctor.getDerivedStateFromProps?"getDerivedStateFromProps()":"getSnapshotBeforeUpdate()";didWarnAboutLegacyLifecyclesAndDerivedState.has(_componentName)||(didWarnAboutLegacyLifecyclesAndDerivedState.add(_componentName),error("Unsafe legacy lifecycles will not be called for components using new component APIs.\n\n%s uses %s but also contains the following legacy lifecycles:%s%s%s\n\nThe above lifecycles should be removed. Learn more about this warning here:\nhttps://fb.me/react-unsafe-component-lifecycles",_componentName,newApiName,null!==foundWillMountName?"\n  "+foundWillMountName:"",null!==foundWillReceivePropsName?"\n  "+foundWillReceivePropsName:"",null!==foundWillUpdateName?"\n  "+foundWillUpdateName:""))}}return isLegacyContextConsumer&&cacheContext(workInProgress,unmaskedContext,context),instance}function callComponentWillMount(workInProgress,instance){startPhaseTimer(workInProgress,"componentWillMount");var oldState=instance.state;"function"==typeof instance.componentWillMount&&instance.componentWillMount(),"function"==typeof instance.UNSAFE_componentWillMount&&instance.UNSAFE_componentWillMount(),stopPhaseTimer(),oldState!==instance.state&&(error("%s.componentWillMount(): Assigning directly to this.state is deprecated (except inside a component's constructor). Use setState instead.",getComponentName(workInProgress.type)||"Component"),classComponentUpdater.enqueueReplaceState(instance,instance.state,null))}function callComponentWillReceiveProps(workInProgress,instance,newProps,nextContext){var oldState=instance.state;if(startPhaseTimer(workInProgress,"componentWillReceiveProps"),"function"==typeof instance.componentWillReceiveProps&&instance.componentWillReceiveProps(newProps,nextContext),"function"==typeof instance.UNSAFE_componentWillReceiveProps&&instance.UNSAFE_componentWillReceiveProps(newProps,nextContext),stopPhaseTimer(),instance.state!==oldState){var componentName=getComponentName(workInProgress.type)||"Component";didWarnAboutStateAssignmentForComponent.has(componentName)||(didWarnAboutStateAssignmentForComponent.add(componentName),error("%s.componentWillReceiveProps(): Assigning directly to this.state is deprecated (except inside a component's constructor). Use setState instead.",componentName)),classComponentUpdater.enqueueReplaceState(instance,instance.state,null)}}function mountClassInstance(workInProgress,ctor,newProps,renderExpirationTime){checkClassInstance(workInProgress,ctor,newProps);var instance=workInProgress.stateNode;instance.props=newProps,instance.state=workInProgress.memoizedState,instance.refs=emptyRefsObject,initializeUpdateQueue(workInProgress);var contextType=ctor.contextType;if("object"==typeof contextType&&null!==contextType)instance.context=readContext(contextType);else{var unmaskedContext=getUnmaskedContext(workInProgress,ctor,!0);instance.context=getMaskedContext(workInProgress,unmaskedContext)}if(instance.state===newProps){var componentName=getComponentName(ctor)||"Component";didWarnAboutDirectlyAssigningPropsToState.has(componentName)||(didWarnAboutDirectlyAssigningPropsToState.add(componentName),error("%s: It is not recommended to assign props directly to state because updates to props won't be reflected in state. In most cases, it is better to use props directly.",componentName))}1&workInProgress.mode&&ReactStrictModeWarnings.recordLegacyContextWarning(workInProgress,instance),ReactStrictModeWarnings.recordUnsafeLifecycleWarnings(workInProgress,instance),processUpdateQueue(workInProgress,newProps,instance,renderExpirationTime),instance.state=workInProgress.memoizedState;var getDerivedStateFromProps=ctor.getDerivedStateFromProps;"function"==typeof getDerivedStateFromProps&&(applyDerivedStateFromProps(workInProgress,ctor,getDerivedStateFromProps,newProps),instance.state=workInProgress.memoizedState),"function"==typeof ctor.getDerivedStateFromProps||"function"==typeof instance.getSnapshotBeforeUpdate||"function"!=typeof instance.UNSAFE_componentWillMount&&"function"!=typeof instance.componentWillMount||(callComponentWillMount(workInProgress,instance),processUpdateQueue(workInProgress,newProps,instance,renderExpirationTime),instance.state=workInProgress.memoizedState),"function"==typeof instance.componentDidMount&&(workInProgress.effectTag|=4)}function resumeMountClassInstance(workInProgress,ctor,newProps,renderExpirationTime){var instance=workInProgress.stateNode,oldProps=workInProgress.memoizedProps;instance.props=oldProps;var oldContext=instance.context,contextType=ctor.contextType,nextContext=emptyContextObject,nextLegacyUnmaskedContext;"object"==typeof contextType&&null!==contextType?nextContext=readContext(contextType):nextContext=getMaskedContext(workInProgress,getUnmaskedContext(workInProgress,ctor,!0));var getDerivedStateFromProps=ctor.getDerivedStateFromProps,hasNewLifecycles="function"==typeof getDerivedStateFromProps||"function"==typeof instance.getSnapshotBeforeUpdate;hasNewLifecycles||"function"!=typeof instance.UNSAFE_componentWillReceiveProps&&"function"!=typeof instance.componentWillReceiveProps||oldProps===newProps&&oldContext===nextContext||callComponentWillReceiveProps(workInProgress,instance,newProps,nextContext),resetHasForceUpdateBeforeProcessing();var oldState=workInProgress.memoizedState,newState=instance.state=oldState;if(processUpdateQueue(workInProgress,newProps,instance,renderExpirationTime),newState=workInProgress.memoizedState,oldProps===newProps&&oldState===newState&&!hasContextChanged()&&!checkHasForceUpdateAfterProcessing())return"function"==typeof instance.componentDidMount&&(workInProgress.effectTag|=4),!1;"function"==typeof getDerivedStateFromProps&&(applyDerivedStateFromProps(workInProgress,ctor,getDerivedStateFromProps,newProps),newState=workInProgress.memoizedState);var shouldUpdate=checkHasForceUpdateAfterProcessing()||checkShouldComponentUpdate(workInProgress,ctor,oldProps,newProps,oldState,newState,nextContext);return shouldUpdate?(hasNewLifecycles||"function"!=typeof instance.UNSAFE_componentWillMount&&"function"!=typeof instance.componentWillMount||(startPhaseTimer(workInProgress,"componentWillMount"),"function"==typeof instance.componentWillMount&&instance.componentWillMount(),"function"==typeof instance.UNSAFE_componentWillMount&&instance.UNSAFE_componentWillMount(),stopPhaseTimer()),"function"==typeof instance.componentDidMount&&(workInProgress.effectTag|=4)):("function"==typeof instance.componentDidMount&&(workInProgress.effectTag|=4),workInProgress.memoizedProps=newProps,workInProgress.memoizedState=newState),instance.props=newProps,instance.state=newState,instance.context=nextContext,shouldUpdate}function updateClassInstance(current,workInProgress,ctor,newProps,renderExpirationTime){var instance=workInProgress.stateNode;cloneUpdateQueue(current,workInProgress);var oldProps=workInProgress.memoizedProps;instance.props=workInProgress.type===workInProgress.elementType?oldProps:resolveDefaultProps(workInProgress.type,oldProps);var oldContext=instance.context,contextType=ctor.contextType,nextContext=emptyContextObject,nextUnmaskedContext;"object"==typeof contextType&&null!==contextType?nextContext=readContext(contextType):nextContext=getMaskedContext(workInProgress,getUnmaskedContext(workInProgress,ctor,!0));var getDerivedStateFromProps=ctor.getDerivedStateFromProps,hasNewLifecycles="function"==typeof getDerivedStateFromProps||"function"==typeof instance.getSnapshotBeforeUpdate;hasNewLifecycles||"function"!=typeof instance.UNSAFE_componentWillReceiveProps&&"function"!=typeof instance.componentWillReceiveProps||oldProps===newProps&&oldContext===nextContext||callComponentWillReceiveProps(workInProgress,instance,newProps,nextContext),resetHasForceUpdateBeforeProcessing();var oldState=workInProgress.memoizedState,newState=instance.state=oldState;if(processUpdateQueue(workInProgress,newProps,instance,renderExpirationTime),newState=workInProgress.memoizedState,oldProps===newProps&&oldState===newState&&!hasContextChanged()&&!checkHasForceUpdateAfterProcessing())return"function"==typeof instance.componentDidUpdate&&(oldProps===current.memoizedProps&&oldState===current.memoizedState||(workInProgress.effectTag|=4)),"function"==typeof instance.getSnapshotBeforeUpdate&&(oldProps===current.memoizedProps&&oldState===current.memoizedState||(workInProgress.effectTag|=256)),!1;"function"==typeof getDerivedStateFromProps&&(applyDerivedStateFromProps(workInProgress,ctor,getDerivedStateFromProps,newProps),newState=workInProgress.memoizedState);var shouldUpdate=checkHasForceUpdateAfterProcessing()||checkShouldComponentUpdate(workInProgress,ctor,oldProps,newProps,oldState,newState,nextContext);return shouldUpdate?(hasNewLifecycles||"function"!=typeof instance.UNSAFE_componentWillUpdate&&"function"!=typeof instance.componentWillUpdate||(startPhaseTimer(workInProgress,"componentWillUpdate"),"function"==typeof instance.componentWillUpdate&&instance.componentWillUpdate(newProps,newState,nextContext),"function"==typeof instance.UNSAFE_componentWillUpdate&&instance.UNSAFE_componentWillUpdate(newProps,newState,nextContext),stopPhaseTimer()),"function"==typeof instance.componentDidUpdate&&(workInProgress.effectTag|=4),"function"==typeof instance.getSnapshotBeforeUpdate&&(workInProgress.effectTag|=256)):("function"==typeof instance.componentDidUpdate&&(oldProps===current.memoizedProps&&oldState===current.memoizedState||(workInProgress.effectTag|=4)),"function"==typeof instance.getSnapshotBeforeUpdate&&(oldProps===current.memoizedProps&&oldState===current.memoizedState||(workInProgress.effectTag|=256)),workInProgress.memoizedProps=newProps,workInProgress.memoizedState=newState),instance.props=newProps,instance.state=newState,instance.context=nextContext,shouldUpdate}var warnForMissingKey=function(child){};didWarnAboutMaps=!1,didWarnAboutGenerators=!1,didWarnAboutStringRefs={},ownerHasKeyUseWarning={},ownerHasFunctionTypeWarning={},warnForMissingKey=function(child){if(null!==child&&"object"==typeof child&&child._store&&!child._store.validated&&null==child.key){if("object"!=typeof child._store)throw Error("React Component in warnForMissingKey should have a _store. This error is likely caused by a bug in React. Please file an issue.");child._store.validated=!0;var currentComponentErrorInfo='Each child in a list should have a unique "key" prop. See https://fb.me/react-warning-keys for more information.'+getCurrentFiberStackInDev();ownerHasKeyUseWarning[currentComponentErrorInfo]||(ownerHasKeyUseWarning[currentComponentErrorInfo]=!0,error('Each child in a list should have a unique "key" prop. See https://fb.me/react-warning-keys for more information.'))}};var isArray$1=Array.isArray;function coerceRef(returnFiber,current,element){var mixedRef=element.ref;if(null!==mixedRef&&"function"!=typeof mixedRef&&"object"!=typeof mixedRef){if(1&returnFiber.mode&&(!element._owner||!element._self||element._owner.stateNode===element._self)){var componentName=getComponentName(returnFiber.type)||"Component";didWarnAboutStringRefs[componentName]||(error('A string ref, "%s", has been found within a strict mode tree. String refs are a source of potential bugs and should be avoided. We recommend using useRef() or createRef() instead. Learn more about using refs safely here: https://fb.me/react-strict-mode-string-ref%s',mixedRef,getStackByFiberInDevAndProd(returnFiber)),didWarnAboutStringRefs[componentName]=!0)}if(element._owner){var owner=element._owner,inst;if(owner){var ownerFiber=owner;if(1!==ownerFiber.tag)throw Error("Function components cannot have string refs. We recommend using useRef() instead. Learn more about using refs safely here: https://fb.me/react-strict-mode-string-ref");inst=ownerFiber.stateNode}if(!inst)throw Error("Missing owner for string ref "+mixedRef+". This error is likely caused by a bug in React. Please file an issue.");var stringRef=""+mixedRef;if(null!==current&&null!==current.ref&&"function"==typeof current.ref&&current.ref._stringRef===stringRef)return current.ref;var ref=function(value){var refs=inst.refs;refs===emptyRefsObject&&(refs=inst.refs={}),null===value?delete refs[stringRef]:refs[stringRef]=value};return ref._stringRef=stringRef,ref}if("string"!=typeof mixedRef)throw Error("Expected ref to be a function, a string, an object returned by React.createRef(), or null.");if(!element._owner)throw Error("Element ref was specified as a string ("+mixedRef+") but no owner was set. This could happen for one of the following reasons:\n1. You may be adding a ref to a function component\n2. You may be adding a ref to a component that was not created inside a component's render method\n3. You have multiple copies of React loaded\nSee https://fb.me/react-refs-must-have-owner for more information.")}return mixedRef}function throwOnInvalidObjectType(returnFiber,newChild){if("textarea"!==returnFiber.type){var addendum="";throw addendum=" If you meant to render a collection of children, use an array instead."+getCurrentFiberStackInDev(),Error("Objects are not valid as a React child (found: "+("[object Object]"===Object.prototype.toString.call(newChild)?"object with keys {"+Object.keys(newChild).join(", ")+"}":newChild)+")."+addendum)}}function warnOnFunctionType(){var currentComponentErrorInfo="Functions are not valid as a React child. This may happen if you return a Component instead of <Component /> from render. Or maybe you meant to call this function rather than return it."+getCurrentFiberStackInDev();ownerHasFunctionTypeWarning[currentComponentErrorInfo]||(ownerHasFunctionTypeWarning[currentComponentErrorInfo]=!0,error("Functions are not valid as a React child. This may happen if you return a Component instead of <Component /> from render. Or maybe you meant to call this function rather than return it."))}function ChildReconciler(shouldTrackSideEffects){function deleteChild(returnFiber,childToDelete){if(shouldTrackSideEffects){var last=returnFiber.lastEffect;null!==last?(last.nextEffect=childToDelete,returnFiber.lastEffect=childToDelete):returnFiber.firstEffect=returnFiber.lastEffect=childToDelete,childToDelete.nextEffect=null,childToDelete.effectTag=8}}function deleteRemainingChildren(returnFiber,currentFirstChild){if(!shouldTrackSideEffects)return null;for(var childToDelete=currentFirstChild;null!==childToDelete;)deleteChild(returnFiber,childToDelete),childToDelete=childToDelete.sibling;return null}function mapRemainingChildren(returnFiber,currentFirstChild){for(var existingChildren=new Map,existingChild=currentFirstChild;null!==existingChild;)null!==existingChild.key?existingChildren.set(existingChild.key,existingChild):existingChildren.set(existingChild.index,existingChild),existingChild=existingChild.sibling;return existingChildren}function useFiber(fiber,pendingProps){var clone=createWorkInProgress(fiber,pendingProps);return clone.index=0,clone.sibling=null,clone}function placeChild(newFiber,lastPlacedIndex,newIndex){if(newFiber.index=newIndex,!shouldTrackSideEffects)return lastPlacedIndex;var current=newFiber.alternate;if(null!==current){var oldIndex=current.index;return oldIndex<lastPlacedIndex?(newFiber.effectTag=2,lastPlacedIndex):oldIndex}return newFiber.effectTag=2,lastPlacedIndex}function placeSingleChild(newFiber){return shouldTrackSideEffects&&null===newFiber.alternate&&(newFiber.effectTag=2),newFiber}function updateTextNode(returnFiber,current,textContent,expirationTime){if(null===current||6!==current.tag){var created=createFiberFromText(textContent,returnFiber.mode,expirationTime);return created.return=returnFiber,created}var existing=useFiber(current,textContent);return existing.return=returnFiber,existing}function updateElement(returnFiber,current,element,expirationTime){if(null!==current&&(current.elementType===element.type||isCompatibleFamilyForHotReloading(current,element))){var existing=useFiber(current,element.props);return existing.ref=coerceRef(returnFiber,current,element),existing.return=returnFiber,existing._debugSource=element._source,existing._debugOwner=element._owner,existing}var created=createFiberFromElement(element,returnFiber.mode,expirationTime);return created.ref=coerceRef(returnFiber,current,element),created.return=returnFiber,created}function updatePortal(returnFiber,current,portal,expirationTime){if(null===current||4!==current.tag||current.stateNode.containerInfo!==portal.containerInfo||current.stateNode.implementation!==portal.implementation){var created=createFiberFromPortal(portal,returnFiber.mode,expirationTime);return created.return=returnFiber,created}var existing=useFiber(current,portal.children||[]);return existing.return=returnFiber,existing}function updateFragment(returnFiber,current,fragment,expirationTime,key){if(null===current||7!==current.tag){var created=createFiberFromFragment(fragment,returnFiber.mode,expirationTime,key);return created.return=returnFiber,created}var existing=useFiber(current,fragment);return existing.return=returnFiber,existing}function createChild(returnFiber,newChild,expirationTime){if("string"==typeof newChild||"number"==typeof newChild){var created=createFiberFromText(""+newChild,returnFiber.mode,expirationTime);return created.return=returnFiber,created}if("object"==typeof newChild&&null!==newChild){switch(newChild.$$typeof){case REACT_ELEMENT_TYPE:var _created=createFiberFromElement(newChild,returnFiber.mode,expirationTime);return _created.ref=coerceRef(returnFiber,null,newChild),_created.return=returnFiber,_created;case REACT_PORTAL_TYPE:var _created2=createFiberFromPortal(newChild,returnFiber.mode,expirationTime);return _created2.return=returnFiber,_created2}if(isArray$1(newChild)||getIteratorFn(newChild)){var _created3=createFiberFromFragment(newChild,returnFiber.mode,expirationTime,null);return _created3.return=returnFiber,_created3}throwOnInvalidObjectType(returnFiber,newChild)}return"function"==typeof newChild&&warnOnFunctionType(),null}function updateSlot(returnFiber,oldFiber,newChild,expirationTime){var key=null!==oldFiber?oldFiber.key:null;if("string"==typeof newChild||"number"==typeof newChild)return null!==key?null:updateTextNode(returnFiber,oldFiber,""+newChild,expirationTime);if("object"==typeof newChild&&null!==newChild){switch(newChild.$$typeof){case REACT_ELEMENT_TYPE:return newChild.key===key?newChild.type===REACT_FRAGMENT_TYPE?updateFragment(returnFiber,oldFiber,newChild.props.children,expirationTime,key):updateElement(returnFiber,oldFiber,newChild,expirationTime):null;case REACT_PORTAL_TYPE:return newChild.key===key?updatePortal(returnFiber,oldFiber,newChild,expirationTime):null}if(isArray$1(newChild)||getIteratorFn(newChild))return null!==key?null:updateFragment(returnFiber,oldFiber,newChild,expirationTime,null);throwOnInvalidObjectType(returnFiber,newChild)}return"function"==typeof newChild&&warnOnFunctionType(),null}function updateFromMap(existingChildren,returnFiber,newIdx,newChild,expirationTime){var matchedFiber;if("string"==typeof newChild||"number"==typeof newChild)return updateTextNode(returnFiber,existingChildren.get(newIdx)||null,""+newChild,expirationTime);if("object"==typeof newChild&&null!==newChild){switch(newChild.$$typeof){case REACT_ELEMENT_TYPE:var _matchedFiber=existingChildren.get(null===newChild.key?newIdx:newChild.key)||null;return newChild.type===REACT_FRAGMENT_TYPE?updateFragment(returnFiber,_matchedFiber,newChild.props.children,expirationTime,newChild.key):updateElement(returnFiber,_matchedFiber,newChild,expirationTime);case REACT_PORTAL_TYPE:var _matchedFiber2;return updatePortal(returnFiber,existingChildren.get(null===newChild.key?newIdx:newChild.key)||null,newChild,expirationTime)}var _matchedFiber3;if(isArray$1(newChild)||getIteratorFn(newChild))return updateFragment(returnFiber,existingChildren.get(newIdx)||null,newChild,expirationTime,null);throwOnInvalidObjectType(returnFiber,newChild)}return"function"==typeof newChild&&warnOnFunctionType(),null}function warnOnInvalidKey(child,knownKeys){if("object"!=typeof child||null===child)return knownKeys;switch(child.$$typeof){case REACT_ELEMENT_TYPE:case REACT_PORTAL_TYPE:warnForMissingKey(child);var key=child.key;if("string"!=typeof key)break;if(null===knownKeys){(knownKeys=new Set).add(key);break}if(!knownKeys.has(key)){knownKeys.add(key);break}error("Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted  the behavior is unsupported and could change in a future version.",key)}return knownKeys}function reconcileChildrenArray(returnFiber,currentFirstChild,newChildren,expirationTime){for(var knownKeys=null,i=0;i<newChildren.length;i++){var child;knownKeys=warnOnInvalidKey(newChildren[i],knownKeys)}for(var resultingFirstChild=null,previousNewFiber=null,oldFiber=currentFirstChild,lastPlacedIndex=0,newIdx=0,nextOldFiber=null;null!==oldFiber&&newIdx<newChildren.length;newIdx++){oldFiber.index>newIdx?(nextOldFiber=oldFiber,oldFiber=null):nextOldFiber=oldFiber.sibling;var newFiber=updateSlot(returnFiber,oldFiber,newChildren[newIdx],expirationTime);if(null===newFiber){null===oldFiber&&(oldFiber=nextOldFiber);break}shouldTrackSideEffects&&oldFiber&&null===newFiber.alternate&&deleteChild(returnFiber,oldFiber),lastPlacedIndex=placeChild(newFiber,lastPlacedIndex,newIdx),null===previousNewFiber?resultingFirstChild=newFiber:previousNewFiber.sibling=newFiber,previousNewFiber=newFiber,oldFiber=nextOldFiber}if(newIdx===newChildren.length)return deleteRemainingChildren(returnFiber,oldFiber),resultingFirstChild;if(null===oldFiber){for(;newIdx<newChildren.length;newIdx++){var _newFiber=createChild(returnFiber,newChildren[newIdx],expirationTime);null!==_newFiber&&(lastPlacedIndex=placeChild(_newFiber,lastPlacedIndex,newIdx),null===previousNewFiber?resultingFirstChild=_newFiber:previousNewFiber.sibling=_newFiber,previousNewFiber=_newFiber)}return resultingFirstChild}for(var existingChildren=mapRemainingChildren(returnFiber,oldFiber);newIdx<newChildren.length;newIdx++){var _newFiber2=updateFromMap(existingChildren,returnFiber,newIdx,newChildren[newIdx],expirationTime);null!==_newFiber2&&(shouldTrackSideEffects&&null!==_newFiber2.alternate&&existingChildren.delete(null===_newFiber2.key?newIdx:_newFiber2.key),lastPlacedIndex=placeChild(_newFiber2,lastPlacedIndex,newIdx),null===previousNewFiber?resultingFirstChild=_newFiber2:previousNewFiber.sibling=_newFiber2,previousNewFiber=_newFiber2)}return shouldTrackSideEffects&&existingChildren.forEach((function(child){return deleteChild(returnFiber,child)})),resultingFirstChild}function reconcileChildrenIterator(returnFiber,currentFirstChild,newChildrenIterable,expirationTime){var iteratorFn=getIteratorFn(newChildrenIterable);if("function"!=typeof iteratorFn)throw Error("An object is not an iterable. This error is likely caused by a bug in React. Please file an issue.");"function"==typeof Symbol&&"Generator"===newChildrenIterable[Symbol.toStringTag]&&(didWarnAboutGenerators||error("Using Generators as children is unsupported and will likely yield unexpected results because enumerating a generator mutates it. You may convert it to an array with `Array.from()` or the `[...spread]` operator before rendering. Keep in mind you might need to polyfill these features for older browsers."),didWarnAboutGenerators=!0),newChildrenIterable.entries===iteratorFn&&(didWarnAboutMaps||error("Using Maps as children is unsupported and will likely yield unexpected results. Convert it to a sequence/iterable of keyed ReactElements instead."),didWarnAboutMaps=!0);var _newChildren=iteratorFn.call(newChildrenIterable);if(_newChildren)for(var knownKeys=null,_step=_newChildren.next();!_step.done;_step=_newChildren.next()){var child;knownKeys=warnOnInvalidKey(_step.value,knownKeys)}var newChildren=iteratorFn.call(newChildrenIterable);if(null==newChildren)throw Error("An iterable object provided no iterator.");for(var resultingFirstChild=null,previousNewFiber=null,oldFiber=currentFirstChild,lastPlacedIndex=0,newIdx=0,nextOldFiber=null,step=newChildren.next();null!==oldFiber&&!step.done;newIdx++,step=newChildren.next()){oldFiber.index>newIdx?(nextOldFiber=oldFiber,oldFiber=null):nextOldFiber=oldFiber.sibling;var newFiber=updateSlot(returnFiber,oldFiber,step.value,expirationTime);if(null===newFiber){null===oldFiber&&(oldFiber=nextOldFiber);break}shouldTrackSideEffects&&oldFiber&&null===newFiber.alternate&&deleteChild(returnFiber,oldFiber),lastPlacedIndex=placeChild(newFiber,lastPlacedIndex,newIdx),null===previousNewFiber?resultingFirstChild=newFiber:previousNewFiber.sibling=newFiber,previousNewFiber=newFiber,oldFiber=nextOldFiber}if(step.done)return deleteRemainingChildren(returnFiber,oldFiber),resultingFirstChild;if(null===oldFiber){for(;!step.done;newIdx++,step=newChildren.next()){var _newFiber3=createChild(returnFiber,step.value,expirationTime);null!==_newFiber3&&(lastPlacedIndex=placeChild(_newFiber3,lastPlacedIndex,newIdx),null===previousNewFiber?resultingFirstChild=_newFiber3:previousNewFiber.sibling=_newFiber3,previousNewFiber=_newFiber3)}return resultingFirstChild}for(var existingChildren=mapRemainingChildren(returnFiber,oldFiber);!step.done;newIdx++,step=newChildren.next()){var _newFiber4=updateFromMap(existingChildren,returnFiber,newIdx,step.value,expirationTime);null!==_newFiber4&&(shouldTrackSideEffects&&null!==_newFiber4.alternate&&existingChildren.delete(null===_newFiber4.key?newIdx:_newFiber4.key),lastPlacedIndex=placeChild(_newFiber4,lastPlacedIndex,newIdx),null===previousNewFiber?resultingFirstChild=_newFiber4:previousNewFiber.sibling=_newFiber4,previousNewFiber=_newFiber4)}return shouldTrackSideEffects&&existingChildren.forEach((function(child){return deleteChild(returnFiber,child)})),resultingFirstChild}function reconcileSingleTextNode(returnFiber,currentFirstChild,textContent,expirationTime){if(null!==currentFirstChild&&6===currentFirstChild.tag){deleteRemainingChildren(returnFiber,currentFirstChild.sibling);var existing=useFiber(currentFirstChild,textContent);return existing.return=returnFiber,existing}deleteRemainingChildren(returnFiber,currentFirstChild);var created=createFiberFromText(textContent,returnFiber.mode,expirationTime);return created.return=returnFiber,created}function reconcileSingleElement(returnFiber,currentFirstChild,element,expirationTime){for(var key=element.key,child=currentFirstChild;null!==child;){if(child.key===key){switch(child.tag){case 7:if(element.type===REACT_FRAGMENT_TYPE){deleteRemainingChildren(returnFiber,child.sibling);var existing=useFiber(child,element.props.children);return existing.return=returnFiber,existing._debugSource=element._source,existing._debugOwner=element._owner,existing}break;case 22:default:if(child.elementType===element.type||isCompatibleFamilyForHotReloading(child,element)){deleteRemainingChildren(returnFiber,child.sibling);var _existing3=useFiber(child,element.props);return _existing3.ref=coerceRef(returnFiber,child,element),_existing3.return=returnFiber,_existing3._debugSource=element._source,_existing3._debugOwner=element._owner,_existing3}}deleteRemainingChildren(returnFiber,child);break}deleteChild(returnFiber,child),child=child.sibling}if(element.type===REACT_FRAGMENT_TYPE){var created=createFiberFromFragment(element.props.children,returnFiber.mode,expirationTime,element.key);return created.return=returnFiber,created}var _created4=createFiberFromElement(element,returnFiber.mode,expirationTime);return _created4.ref=coerceRef(returnFiber,currentFirstChild,element),_created4.return=returnFiber,_created4}function reconcileSinglePortal(returnFiber,currentFirstChild,portal,expirationTime){for(var key=portal.key,child=currentFirstChild;null!==child;){if(child.key===key){if(4===child.tag&&child.stateNode.containerInfo===portal.containerInfo&&child.stateNode.implementation===portal.implementation){deleteRemainingChildren(returnFiber,child.sibling);var existing=useFiber(child,portal.children||[]);return existing.return=returnFiber,existing}deleteRemainingChildren(returnFiber,child);break}deleteChild(returnFiber,child),child=child.sibling}var created=createFiberFromPortal(portal,returnFiber.mode,expirationTime);return created.return=returnFiber,created}function reconcileChildFibers(returnFiber,currentFirstChild,newChild,expirationTime){var isUnkeyedTopLevelFragment="object"==typeof newChild&&null!==newChild&&newChild.type===REACT_FRAGMENT_TYPE&&null===newChild.key;isUnkeyedTopLevelFragment&&(newChild=newChild.props.children);var isObject="object"==typeof newChild&&null!==newChild;if(isObject)switch(newChild.$$typeof){case REACT_ELEMENT_TYPE:return placeSingleChild(reconcileSingleElement(returnFiber,currentFirstChild,newChild,expirationTime));case REACT_PORTAL_TYPE:return placeSingleChild(reconcileSinglePortal(returnFiber,currentFirstChild,newChild,expirationTime))}if("string"==typeof newChild||"number"==typeof newChild)return placeSingleChild(reconcileSingleTextNode(returnFiber,currentFirstChild,""+newChild,expirationTime));if(isArray$1(newChild))return reconcileChildrenArray(returnFiber,currentFirstChild,newChild,expirationTime);if(getIteratorFn(newChild))return reconcileChildrenIterator(returnFiber,currentFirstChild,newChild,expirationTime);if(isObject&&throwOnInvalidObjectType(returnFiber,newChild),"function"==typeof newChild&&warnOnFunctionType(),void 0===newChild&&!isUnkeyedTopLevelFragment)switch(returnFiber.tag){case 1:var instance;if(returnFiber.stateNode.render._isMockFunction)break;case 0:var Component=returnFiber.type;throw Error((Component.displayName||Component.name||"Component")+"(...): Nothing was returned from render. This usually means a return statement is missing. Or, to render nothing, return null.")}return deleteRemainingChildren(returnFiber,currentFirstChild)}return reconcileChildFibers}var reconcileChildFibers=ChildReconciler(!0),mountChildFibers=ChildReconciler(!1);function cloneChildFibers(current,workInProgress){if(null!==current&&workInProgress.child!==current.child)throw Error("Resuming work not yet implemented.");if(null!==workInProgress.child){var currentChild=workInProgress.child,newChild=createWorkInProgress(currentChild,currentChild.pendingProps);for(workInProgress.child=newChild,newChild.return=workInProgress;null!==currentChild.sibling;)currentChild=currentChild.sibling,(newChild=newChild.sibling=createWorkInProgress(currentChild,currentChild.pendingProps)).return=workInProgress;newChild.sibling=null}}function resetChildFibers(workInProgress,renderExpirationTime){for(var child=workInProgress.child;null!==child;)resetWorkInProgress(child,renderExpirationTime),child=child.sibling}var NO_CONTEXT={},contextStackCursor$1=createCursor(NO_CONTEXT),contextFiberStackCursor=createCursor(NO_CONTEXT),rootInstanceStackCursor=createCursor(NO_CONTEXT);function requiredContext(c){if(c===NO_CONTEXT)throw Error("Expected host context to exist. This error is likely caused by a bug in React. Please file an issue.");return c}function getRootHostContainer(){var rootInstance;return requiredContext(rootInstanceStackCursor.current)}function pushHostContainer(fiber,nextRootInstance){push(rootInstanceStackCursor,nextRootInstance,fiber),push(contextFiberStackCursor,fiber,fiber),push(contextStackCursor$1,NO_CONTEXT,fiber);var nextRootContext=getRootHostContext(nextRootInstance);pop(contextStackCursor$1,fiber),push(contextStackCursor$1,nextRootContext,fiber)}function popHostContainer(fiber){pop(contextStackCursor$1,fiber),pop(contextFiberStackCursor,fiber),pop(rootInstanceStackCursor,fiber)}function getHostContext(){var context;return requiredContext(contextStackCursor$1.current)}function pushHostContext(fiber){var rootInstance=requiredContext(rootInstanceStackCursor.current),context=requiredContext(contextStackCursor$1.current),nextContext=getChildHostContext(context,fiber.type);context!==nextContext&&(push(contextFiberStackCursor,fiber,fiber),push(contextStackCursor$1,nextContext,fiber))}function popHostContext(fiber){contextFiberStackCursor.current===fiber&&(pop(contextStackCursor$1,fiber),pop(contextFiberStackCursor,fiber))}var DefaultSuspenseContext=0,SubtreeSuspenseContextMask=1,InvisibleParentSuspenseContext=1,ForceSuspenseFallback=2,suspenseStackCursor=createCursor(0);function hasSuspenseContext(parentContext,flag){return 0!=(parentContext&flag)}function setDefaultShallowSuspenseContext(parentContext){return 1&parentContext}function setShallowSuspenseContext(parentContext,shallowContext){return 1&parentContext|shallowContext}function addSubtreeSuspenseContext(parentContext,subtreeContext){return parentContext|subtreeContext}function pushSuspenseContext(fiber,newContext){push(suspenseStackCursor,newContext,fiber)}function popSuspenseContext(fiber){pop(suspenseStackCursor,fiber)}function shouldCaptureSuspense(workInProgress,hasInvisibleParent){var nextState=workInProgress.memoizedState;if(null!==nextState)return null!==nextState.dehydrated;var props=workInProgress.memoizedProps;return void 0!==props.fallback&&(!0!==props.unstable_avoidThisFallback||!hasInvisibleParent)}function findFirstSuspended(row){for(var node=row;null!==node;){if(13===node.tag){var state=node.memoizedState;if(null!==state){var dehydrated=state.dehydrated;if(null===dehydrated||isSuspenseInstancePending(dehydrated)||isSuspenseInstanceFallback(dehydrated))return node}}else if(19===node.tag&&void 0!==node.memoizedProps.revealOrder){var didSuspend;if(0!=(64&node.effectTag))return node}else if(null!==node.child){node.child.return=node,node=node.child;continue}if(node===row)return null;for(;null===node.sibling;){if(null===node.return||node.return===row)return null;node=node.return}node.sibling.return=node.return,node=node.sibling}return null}function createDeprecatedResponderListener(responder,props){var eventResponderListener={responder:responder,props:props};return Object.freeze(eventResponderListener),eventResponderListener}var HasEffect=1,Layout=2,Passive$1=4,ReactCurrentDispatcher=ReactSharedInternals.ReactCurrentDispatcher,ReactCurrentBatchConfig$1=ReactSharedInternals.ReactCurrentBatchConfig,didWarnAboutMismatchedHooksForComponent;didWarnAboutMismatchedHooksForComponent=new Set;var renderExpirationTime=0,currentlyRenderingFiber$1=null,currentHook=null,workInProgressHook=null,didScheduleRenderPhaseUpdate=!1,RE_RENDER_LIMIT=25,currentHookNameInDev=null,hookTypesDev=null,hookTypesUpdateIndexDev=-1,ignorePreviousDependencies=!1;function mountHookTypesDev(){var hookName=currentHookNameInDev;null===hookTypesDev?hookTypesDev=[hookName]:hookTypesDev.push(hookName)}function updateHookTypesDev(){var hookName=currentHookNameInDev;null!==hookTypesDev&&(hookTypesUpdateIndexDev++,hookTypesDev[hookTypesUpdateIndexDev]!==hookName&&warnOnHookMismatchInDev(hookName))}function checkDepsAreArrayDev(deps){null==deps||Array.isArray(deps)||error("%s received a final argument that is not an array (instead, received `%s`). When specified, the final argument must be an array.",currentHookNameInDev,typeof deps)}function warnOnHookMismatchInDev(currentHookName){var componentName=getComponentName(currentlyRenderingFiber$1.type);if(!didWarnAboutMismatchedHooksForComponent.has(componentName)&&(didWarnAboutMismatchedHooksForComponent.add(componentName),null!==hookTypesDev)){for(var table="",secondColumnStart=30,i=0;i<=hookTypesUpdateIndexDev;i++){for(var oldHookName=hookTypesDev[i],newHookName=i===hookTypesUpdateIndexDev?currentHookName:oldHookName,row=i+1+". "+oldHookName;row.length<30;)row+=" ";table+=row+=newHookName+"\n"}error("React has detected a change in the order of Hooks called by %s. This will lead to bugs and errors if not fixed. For more information, read the Rules of Hooks: https://fb.me/rules-of-hooks\n\n   Previous render            Next render\n   ------------------------------------------------------\n%s   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n",componentName,table)}}function throwInvalidHookError(){throw Error("Invalid hook call. Hooks can only be called inside of the body of a function component. This could happen for one of the following reasons:\n1. You might have mismatching versions of React and the renderer (such as React DOM)\n2. You might be breaking the Rules of Hooks\n3. You might have more than one copy of React in the same app\nSee https://fb.me/react-invalid-hook-call for tips about how to debug and fix this problem.")}function areHookInputsEqual(nextDeps,prevDeps){if(ignorePreviousDependencies)return!1;if(null===prevDeps)return error("%s received a final argument during this render, but not during the previous render. Even though the final argument is optional, its type cannot change between renders.",currentHookNameInDev),!1;nextDeps.length!==prevDeps.length&&error("The final argument passed to %s changed size between renders. The order and size of this array must remain constant.\n\nPrevious: %s\nIncoming: %s",currentHookNameInDev,"["+prevDeps.join(", ")+"]","["+nextDeps.join(", ")+"]");for(var i=0;i<prevDeps.length&&i<nextDeps.length;i++)if(!objectIs(nextDeps[i],prevDeps[i]))return!1;return!0}function renderWithHooks(current,workInProgress,Component,props,secondArg,nextRenderExpirationTime){renderExpirationTime=nextRenderExpirationTime,currentlyRenderingFiber$1=workInProgress,hookTypesDev=null!==current?current._debugHookTypes:null,hookTypesUpdateIndexDev=-1,ignorePreviousDependencies=null!==current&&current.type!==workInProgress.type,workInProgress.memoizedState=null,workInProgress.updateQueue=null,workInProgress.expirationTime=0,null!==current&&null!==current.memoizedState?ReactCurrentDispatcher.current=HooksDispatcherOnUpdateInDEV:ReactCurrentDispatcher.current=null!==hookTypesDev?HooksDispatcherOnMountWithHookTypesInDEV:HooksDispatcherOnMountInDEV;var children=Component(props,secondArg);if(workInProgress.expirationTime===renderExpirationTime){var numberOfReRenders=0;do{if(workInProgress.expirationTime=0,!(numberOfReRenders<25))throw Error("Too many re-renders. React limits the number of renders to prevent an infinite loop.");numberOfReRenders+=1,ignorePreviousDependencies=!1,currentHook=null,workInProgressHook=null,workInProgress.updateQueue=null,hookTypesUpdateIndexDev=-1,ReactCurrentDispatcher.current=HooksDispatcherOnRerenderInDEV,children=Component(props,secondArg)}while(workInProgress.expirationTime===renderExpirationTime)}ReactCurrentDispatcher.current=ContextOnlyDispatcher,workInProgress._debugHookTypes=hookTypesDev;var didRenderTooFewHooks=null!==currentHook&&null!==currentHook.next;if(renderExpirationTime=0,currentlyRenderingFiber$1=null,currentHook=null,workInProgressHook=null,currentHookNameInDev=null,hookTypesDev=null,hookTypesUpdateIndexDev=-1,didScheduleRenderPhaseUpdate=!1,didRenderTooFewHooks)throw Error("Rendered fewer hooks than expected. This may be caused by an accidental early return statement.");return children}function bailoutHooks(current,workInProgress,expirationTime){workInProgress.updateQueue=current.updateQueue,workInProgress.effectTag&=-517,current.expirationTime<=expirationTime&&(current.expirationTime=0)}function resetHooksAfterThrow(){if(ReactCurrentDispatcher.current=ContextOnlyDispatcher,didScheduleRenderPhaseUpdate)for(var hook=currentlyRenderingFiber$1.memoizedState;null!==hook;){var queue=hook.queue;null!==queue&&(queue.pending=null),hook=hook.next}renderExpirationTime=0,currentlyRenderingFiber$1=null,currentHook=null,workInProgressHook=null,hookTypesDev=null,hookTypesUpdateIndexDev=-1,currentHookNameInDev=null,didScheduleRenderPhaseUpdate=!1}function mountWorkInProgressHook(){var hook={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===workInProgressHook?currentlyRenderingFiber$1.memoizedState=workInProgressHook=hook:workInProgressHook=workInProgressHook.next=hook,workInProgressHook}function updateWorkInProgressHook(){var nextCurrentHook,nextWorkInProgressHook;if(null===currentHook){var current=currentlyRenderingFiber$1.alternate;nextCurrentHook=null!==current?current.memoizedState:null}else nextCurrentHook=currentHook.next;if(null!==(nextWorkInProgressHook=null===workInProgressHook?currentlyRenderingFiber$1.memoizedState:workInProgressHook.next))nextWorkInProgressHook=(workInProgressHook=nextWorkInProgressHook).next,currentHook=nextCurrentHook;else{if(null===nextCurrentHook)throw Error("Rendered more hooks than during the previous render.");var newHook={memoizedState:(currentHook=nextCurrentHook).memoizedState,baseState:currentHook.baseState,baseQueue:currentHook.baseQueue,queue:currentHook.queue,next:null};null===workInProgressHook?currentlyRenderingFiber$1.memoizedState=workInProgressHook=newHook:workInProgressHook=workInProgressHook.next=newHook}return workInProgressHook}function createFunctionComponentUpdateQueue(){return{lastEffect:null}}function basicStateReducer(state,action){return"function"==typeof action?action(state):action}function mountReducer(reducer,initialArg,init){var hook=mountWorkInProgressHook(),initialState;initialState=void 0!==init?init(initialArg):initialArg,hook.memoizedState=hook.baseState=initialState;var queue=hook.queue={pending:null,dispatch:null,lastRenderedReducer:reducer,lastRenderedState:initialState},dispatch=queue.dispatch=dispatchAction.bind(null,currentlyRenderingFiber$1,queue);return[hook.memoizedState,dispatch]}function updateReducer(reducer,initialArg,init){var hook=updateWorkInProgressHook(),queue=hook.queue;if(null===queue)throw Error("Should have a queue. This is likely a bug in React. Please file an issue.");queue.lastRenderedReducer=reducer;var current=currentHook,baseQueue=current.baseQueue,pendingQueue=queue.pending;if(null!==pendingQueue){if(null!==baseQueue){var baseFirst=baseQueue.next,pendingFirst=pendingQueue.next;baseQueue.next=pendingFirst,pendingQueue.next=baseFirst}current.baseQueue=baseQueue=pendingQueue,queue.pending=null}if(null!==baseQueue){var first=baseQueue.next,newState=current.baseState,newBaseState=null,newBaseQueueFirst=null,newBaseQueueLast=null,update=first;do{var updateExpirationTime=update.expirationTime;if(updateExpirationTime<renderExpirationTime){var clone={expirationTime:update.expirationTime,suspenseConfig:update.suspenseConfig,action:update.action,eagerReducer:update.eagerReducer,eagerState:update.eagerState,next:null};null===newBaseQueueLast?(newBaseQueueFirst=newBaseQueueLast=clone,newBaseState=newState):newBaseQueueLast=newBaseQueueLast.next=clone,updateExpirationTime>currentlyRenderingFiber$1.expirationTime&&(currentlyRenderingFiber$1.expirationTime=updateExpirationTime,markUnprocessedUpdateTime(updateExpirationTime))}else{if(null!==newBaseQueueLast){var _clone={expirationTime:Sync,suspenseConfig:update.suspenseConfig,action:update.action,eagerReducer:update.eagerReducer,eagerState:update.eagerState,next:null};newBaseQueueLast=newBaseQueueLast.next=_clone}var action;if(markRenderEventTimeAndConfig(updateExpirationTime,update.suspenseConfig),update.eagerReducer===reducer)newState=update.eagerState;else newState=reducer(newState,update.action)}update=update.next}while(null!==update&&update!==first);null===newBaseQueueLast?newBaseState=newState:newBaseQueueLast.next=newBaseQueueFirst,objectIs(newState,hook.memoizedState)||markWorkInProgressReceivedUpdate(),hook.memoizedState=newState,hook.baseState=newBaseState,hook.baseQueue=newBaseQueueLast,queue.lastRenderedState=newState}var dispatch=queue.dispatch;return[hook.memoizedState,dispatch]}function rerenderReducer(reducer,initialArg,init){var hook=updateWorkInProgressHook(),queue=hook.queue;if(null===queue)throw Error("Should have a queue. This is likely a bug in React. Please file an issue.");queue.lastRenderedReducer=reducer;var dispatch=queue.dispatch,lastRenderPhaseUpdate=queue.pending,newState=hook.memoizedState;if(null!==lastRenderPhaseUpdate){queue.pending=null;var firstRenderPhaseUpdate=lastRenderPhaseUpdate.next,update=firstRenderPhaseUpdate;do{var action;newState=reducer(newState,update.action),update=update.next}while(update!==firstRenderPhaseUpdate);objectIs(newState,hook.memoizedState)||markWorkInProgressReceivedUpdate(),hook.memoizedState=newState,null===hook.baseQueue&&(hook.baseState=newState),queue.lastRenderedState=newState}return[newState,dispatch]}function mountState(initialState){var hook=mountWorkInProgressHook();"function"==typeof initialState&&(initialState=initialState()),hook.memoizedState=hook.baseState=initialState;var queue=hook.queue={pending:null,dispatch:null,lastRenderedReducer:basicStateReducer,lastRenderedState:initialState},dispatch=queue.dispatch=dispatchAction.bind(null,currentlyRenderingFiber$1,queue);return[hook.memoizedState,dispatch]}function updateState(initialState){return updateReducer(basicStateReducer)}function rerenderState(initialState){return rerenderReducer(basicStateReducer)}function pushEffect(tag,create,destroy,deps){var effect={tag:tag,create:create,destroy:destroy,deps:deps,next:null},componentUpdateQueue=currentlyRenderingFiber$1.updateQueue;if(null===componentUpdateQueue)componentUpdateQueue={lastEffect:null},currentlyRenderingFiber$1.updateQueue=componentUpdateQueue,componentUpdateQueue.lastEffect=effect.next=effect;else{var lastEffect=componentUpdateQueue.lastEffect;if(null===lastEffect)componentUpdateQueue.lastEffect=effect.next=effect;else{var firstEffect=lastEffect.next;lastEffect.next=effect,effect.next=firstEffect,componentUpdateQueue.lastEffect=effect}}return effect}function mountRef(initialValue){var hook=mountWorkInProgressHook(),ref={current:initialValue};return Object.seal(ref),hook.memoizedState=ref,ref}function updateRef(initialValue){var hook;return updateWorkInProgressHook().memoizedState}function mountEffectImpl(fiberEffectTag,hookEffectTag,create,deps){var hook=mountWorkInProgressHook(),nextDeps=void 0===deps?null:deps;currentlyRenderingFiber$1.effectTag|=fiberEffectTag,hook.memoizedState=pushEffect(1|hookEffectTag,create,void 0,nextDeps)}function updateEffectImpl(fiberEffectTag,hookEffectTag,create,deps){var hook=updateWorkInProgressHook(),nextDeps=void 0===deps?null:deps,destroy=void 0;if(null!==currentHook){var prevEffect=currentHook.memoizedState,prevDeps;if(destroy=prevEffect.destroy,null!==nextDeps)if(areHookInputsEqual(nextDeps,prevEffect.deps))return void pushEffect(hookEffectTag,create,destroy,nextDeps)}currentlyRenderingFiber$1.effectTag|=fiberEffectTag,hook.memoizedState=pushEffect(1|hookEffectTag,create,destroy,nextDeps)}function mountEffect(create,deps){return"undefined"!=typeof jest&&warnIfNotCurrentlyActingEffectsInDEV(currentlyRenderingFiber$1),mountEffectImpl(516,4,create,deps)}function updateEffect(create,deps){return"undefined"!=typeof jest&&warnIfNotCurrentlyActingEffectsInDEV(currentlyRenderingFiber$1),updateEffectImpl(516,4,create,deps)}function mountLayoutEffect(create,deps){return mountEffectImpl(4,2,create,deps)}function updateLayoutEffect(create,deps){return updateEffectImpl(4,2,create,deps)}function imperativeHandleEffect(create,ref){if("function"==typeof ref){var refCallback=ref,_inst=create();return refCallback(_inst),function(){refCallback(null)}}if(null!=ref){var refObject=ref;refObject.hasOwnProperty("current")||error("Expected useImperativeHandle() first argument to either be a ref callback or React.createRef() object. Instead received: %s.","an object with keys {"+Object.keys(refObject).join(", ")+"}");var _inst2=create();return refObject.current=_inst2,function(){refObject.current=null}}}function mountImperativeHandle(ref,create,deps){"function"!=typeof create&&error("Expected useImperativeHandle() second argument to be a function that creates a handle. Instead received: %s.",null!==create?typeof create:"null");var effectDeps=null!=deps?deps.concat([ref]):null;return mountEffectImpl(4,2,imperativeHandleEffect.bind(null,create,ref),effectDeps)}function updateImperativeHandle(ref,create,deps){"function"!=typeof create&&error("Expected useImperativeHandle() second argument to be a function that creates a handle. Instead received: %s.",null!==create?typeof create:"null");var effectDeps=null!=deps?deps.concat([ref]):null;return updateEffectImpl(4,2,imperativeHandleEffect.bind(null,create,ref),effectDeps)}function mountDebugValue(value,formatterFn){}var updateDebugValue=mountDebugValue;function mountCallback(callback,deps){var hook,nextDeps=void 0===deps?null:deps;return mountWorkInProgressHook().memoizedState=[callback,nextDeps],callback}function updateCallback(callback,deps){var hook=updateWorkInProgressHook(),nextDeps=void 0===deps?null:deps,prevState=hook.memoizedState,prevDeps;if(null!==prevState&&(null!==nextDeps&&areHookInputsEqual(nextDeps,prevState[1])))return prevState[0];return hook.memoizedState=[callback,nextDeps],callback}function mountMemo(nextCreate,deps){var hook=mountWorkInProgressHook(),nextDeps=void 0===deps?null:deps,nextValue=nextCreate();return hook.memoizedState=[nextValue,nextDeps],nextValue}function updateMemo(nextCreate,deps){var hook=updateWorkInProgressHook(),nextDeps=void 0===deps?null:deps,prevState=hook.memoizedState,prevDeps;if(null!==prevState&&(null!==nextDeps&&areHookInputsEqual(nextDeps,prevState[1])))return prevState[0];var nextValue=nextCreate();return hook.memoizedState=[nextValue,nextDeps],nextValue}function mountDeferredValue(value,config){var _mountState=mountState(value),prevValue=_mountState[0],setValue=_mountState[1];return mountEffect((function(){var previousConfig=ReactCurrentBatchConfig$1.suspense;ReactCurrentBatchConfig$1.suspense=void 0===config?null:config;try{setValue(value)}finally{ReactCurrentBatchConfig$1.suspense=previousConfig}}),[value,config]),prevValue}function updateDeferredValue(value,config){var _updateState=updateState(),prevValue=_updateState[0],setValue=_updateState[1];return updateEffect((function(){var previousConfig=ReactCurrentBatchConfig$1.suspense;ReactCurrentBatchConfig$1.suspense=void 0===config?null:config;try{setValue(value)}finally{ReactCurrentBatchConfig$1.suspense=previousConfig}}),[value,config]),prevValue}function rerenderDeferredValue(value,config){var _rerenderState=rerenderState(),prevValue=_rerenderState[0],setValue=_rerenderState[1];return updateEffect((function(){var previousConfig=ReactCurrentBatchConfig$1.suspense;ReactCurrentBatchConfig$1.suspense=void 0===config?null:config;try{setValue(value)}finally{ReactCurrentBatchConfig$1.suspense=previousConfig}}),[value,config]),prevValue}function startTransition(setPending,config,callback){var priorityLevel=getCurrentPriorityLevel();runWithPriority$1(priorityLevel<98?98:priorityLevel,(function(){setPending(!0)})),runWithPriority$1(priorityLevel>97?97:priorityLevel,(function(){var previousConfig=ReactCurrentBatchConfig$1.suspense;ReactCurrentBatchConfig$1.suspense=void 0===config?null:config;try{setPending(!1),callback()}finally{ReactCurrentBatchConfig$1.suspense=previousConfig}}))}function mountTransition(config){var _mountState2=mountState(!1),isPending=_mountState2[0],setPending=_mountState2[1],start;return[mountCallback(startTransition.bind(null,setPending,config),[setPending,config]),isPending]}function updateTransition(config){var _updateState2=updateState(),isPending=_updateState2[0],setPending=_updateState2[1],start;return[updateCallback(startTransition.bind(null,setPending,config),[setPending,config]),isPending]}function rerenderTransition(config){var _rerenderState2=rerenderState(),isPending=_rerenderState2[0],setPending=_rerenderState2[1],start;return[updateCallback(startTransition.bind(null,setPending,config),[setPending,config]),isPending]}function dispatchAction(fiber,queue,action){"function"==typeof arguments[3]&&error("State updates from the useState() and useReducer() Hooks don't support the second callback argument. To execute a side effect after rendering, declare it in the component body with useEffect().");var currentTime=requestCurrentTimeForUpdate(),suspenseConfig=requestCurrentSuspenseConfig(),expirationTime=computeExpirationForFiber(currentTime,fiber,suspenseConfig),update={expirationTime:expirationTime,suspenseConfig:suspenseConfig,action:action,eagerReducer:null,eagerState:null,next:null};update.priority=getCurrentPriorityLevel();var pending=queue.pending;null===pending?update.next=update:(update.next=pending.next,pending.next=update),queue.pending=update;var alternate=fiber.alternate;if(fiber===currentlyRenderingFiber$1||null!==alternate&&alternate===currentlyRenderingFiber$1)didScheduleRenderPhaseUpdate=!0,update.expirationTime=renderExpirationTime,currentlyRenderingFiber$1.expirationTime=renderExpirationTime;else{if(0===fiber.expirationTime&&(null===alternate||0===alternate.expirationTime)){var lastRenderedReducer=queue.lastRenderedReducer;if(null!==lastRenderedReducer){var prevDispatcher;prevDispatcher=ReactCurrentDispatcher.current,ReactCurrentDispatcher.current=InvalidNestedHooksDispatcherOnUpdateInDEV;try{var currentState=queue.lastRenderedState,eagerState=lastRenderedReducer(currentState,action);if(update.eagerReducer=lastRenderedReducer,update.eagerState=eagerState,objectIs(eagerState,currentState))return}catch(error){}finally{ReactCurrentDispatcher.current=prevDispatcher}}}"undefined"!=typeof jest&&(warnIfNotScopedWithMatchingAct(fiber),warnIfNotCurrentlyActingUpdatesInDev(fiber)),scheduleWork(fiber,expirationTime)}}var ContextOnlyDispatcher={readContext:readContext,useCallback:throwInvalidHookError,useContext:throwInvalidHookError,useEffect:throwInvalidHookError,useImperativeHandle:throwInvalidHookError,useLayoutEffect:throwInvalidHookError,useMemo:throwInvalidHookError,useReducer:throwInvalidHookError,useRef:throwInvalidHookError,useState:throwInvalidHookError,useDebugValue:throwInvalidHookError,useResponder:throwInvalidHookError,useDeferredValue:throwInvalidHookError,useTransition:throwInvalidHookError},HooksDispatcherOnMountInDEV=null,HooksDispatcherOnMountWithHookTypesInDEV=null,HooksDispatcherOnUpdateInDEV=null,HooksDispatcherOnRerenderInDEV=null,InvalidNestedHooksDispatcherOnMountInDEV=null,InvalidNestedHooksDispatcherOnUpdateInDEV=null,InvalidNestedHooksDispatcherOnRerenderInDEV=null,warnInvalidContextAccess=function(){error("Context can only be read while React is rendering. In classes, you can read it in the render method or getDerivedStateFromProps. In function components, you can read it directly in the function body, but not inside Hooks like useReducer() or useMemo().")},warnInvalidHookAccess=function(){error("Do not call Hooks inside useEffect(...), useMemo(...), or other built-in Hooks. You can only call Hooks at the top level of your React function. For more information, see https://fb.me/rules-of-hooks")};HooksDispatcherOnMountInDEV={readContext:function(context,observedBits){return readContext(context,observedBits)},useCallback:function(callback,deps){return currentHookNameInDev="useCallback",mountHookTypesDev(),checkDepsAreArrayDev(deps),mountCallback(callback,deps)},useContext:function(context,observedBits){return currentHookNameInDev="useContext",mountHookTypesDev(),readContext(context,observedBits)},useEffect:function(create,deps){return currentHookNameInDev="useEffect",mountHookTypesDev(),checkDepsAreArrayDev(deps),mountEffect(create,deps)},useImperativeHandle:function(ref,create,deps){return currentHookNameInDev="useImperativeHandle",mountHookTypesDev(),checkDepsAreArrayDev(deps),mountImperativeHandle(ref,create,deps)},useLayoutEffect:function(create,deps){return currentHookNameInDev="useLayoutEffect",mountHookTypesDev(),checkDepsAreArrayDev(deps),mountLayoutEffect(create,deps)},useMemo:function(create,deps){currentHookNameInDev="useMemo",mountHookTypesDev(),checkDepsAreArrayDev(deps);var prevDispatcher=ReactCurrentDispatcher.current;ReactCurrentDispatcher.current=InvalidNestedHooksDispatcherOnMountInDEV;try{return mountMemo(create,deps)}finally{ReactCurrentDispatcher.current=prevDispatcher}},useReducer:function(reducer,initialArg,init){currentHookNameInDev="useReducer",mountHookTypesDev();var prevDispatcher=ReactCurrentDispatcher.current;ReactCurrentDispatcher.current=InvalidNestedHooksDispatcherOnMountInDEV;try{return mountReducer(reducer,initialArg,init)}finally{ReactCurrentDispatcher.current=prevDispatcher}},useRef:function(initialValue){return currentHookNameInDev="useRef",mountHookTypesDev(),mountRef(initialValue)},useState:function(initialState){currentHookNameInDev="useState",mountHookTypesDev();var prevDispatcher=ReactCurrentDispatcher.current;ReactCurrentDispatcher.current=InvalidNestedHooksDispatcherOnMountInDEV;try{return mountState(initialState)}finally{ReactCurrentDispatcher.current=prevDispatcher}},useDebugValue:function(value,formatterFn){currentHookNameInDev="useDebugValue",mountHookTypesDev()},useResponder:function(responder,props){return currentHookNameInDev="useResponder",mountHookTypesDev(),createDeprecatedResponderListener(responder,props)},useDeferredValue:function(value,config){return currentHookNameInDev="useDeferredValue",mountHookTypesDev(),mountDeferredValue(value,config)},useTransition:function(config){return currentHookNameInDev="useTransition",mountHookTypesDev(),mountTransition(config)}},HooksDispatcherOnMountWithHookTypesInDEV={readContext:function(context,observedBits){return readContext(context,observedBits)},useCallback:function(callback,deps){return currentHookNameInDev="useCallback",updateHookTypesDev(),mountCallback(callback,deps)},useContext:function(context,observedBits){return currentHookNameInDev="useContext",updateHookTypesDev(),readContext(context,observedBits)},useEffect:function(create,deps){return currentHookNameInDev="useEffect",updateHookTypesDev(),mountEffect(create,deps)},useImperativeHandle:function(ref,create,deps){return currentHookNameInDev="useImperativeHandle",updateHookTypesDev(),mountImperativeHandle(ref,create,deps)},useLayoutEffect:function(create,deps){return currentHookNameInDev="useLayoutEffect",updateHookTypesDev(),mountLayoutEffect(create,deps)},useMemo:function(create,deps){currentHookNameInDev="useMemo",updateHookTypesDev();var prevDispatcher=ReactCurrentDispatcher.current;ReactCurrentDispatcher.current=InvalidNestedHooksDispatcherOnMountInDEV;try{return mountMemo(create,deps)}finally{ReactCurrentDispatcher.current=prevDispatcher}},useReducer:function(reducer,initialArg,init){currentHookNameInDev="useReducer",updateHookTypesDev();var prevDispatcher=ReactCurrentDispatcher.current;ReactCurrentDispatcher.current=InvalidNestedHooksDispatcherOnMountInDEV;try{return mountReducer(reducer,initialArg,init)}finally{ReactCurrentDispatcher.current=prevDispatcher}},useRef:function(initialValue){return currentHookNameInDev="useRef",updateHookTypesDev(),mountRef(initialValue)},useState:function(initialState){currentHookNameInDev="useState",updateHookTypesDev();var prevDispatcher=ReactCurrentDispatcher.current;ReactCurrentDispatcher.current=InvalidNestedHooksDispatcherOnMountInDEV;try{return mountState(initialState)}finally{ReactCurrentDispatcher.current=prevDispatcher}},useDebugValue:function(value,formatterFn){currentHookNameInDev="useDebugValue",updateHookTypesDev()},useResponder:function(responder,props){return currentHookNameInDev="useResponder",updateHookTypesDev(),createDeprecatedResponderListener(responder,props)},useDeferredValue:function(value,config){return currentHookNameInDev="useDeferredValue",updateHookTypesDev(),mountDeferredValue(value,config)},useTransition:function(config){return currentHookNameInDev="useTransition",updateHookTypesDev(),mountTransition(config)}},HooksDispatcherOnUpdateInDEV={readContext:function(context,observedBits){return readContext(context,observedBits)},useCallback:function(callback,deps){return currentHookNameInDev="useCallback",updateHookTypesDev(),updateCallback(callback,deps)},useContext:function(context,observedBits){return currentHookNameInDev="useContext",updateHookTypesDev(),readContext(context,observedBits)},useEffect:function(create,deps){return currentHookNameInDev="useEffect",updateHookTypesDev(),updateEffect(create,deps)},useImperativeHandle:function(ref,create,deps){return currentHookNameInDev="useImperativeHandle",updateHookTypesDev(),updateImperativeHandle(ref,create,deps)},useLayoutEffect:function(create,deps){return currentHookNameInDev="useLayoutEffect",updateHookTypesDev(),updateLayoutEffect(create,deps)},useMemo:function(create,deps){currentHookNameInDev="useMemo",updateHookTypesDev();var prevDispatcher=ReactCurrentDispatcher.current;ReactCurrentDispatcher.current=InvalidNestedHooksDispatcherOnUpdateInDEV;try{return updateMemo(create,deps)}finally{ReactCurrentDispatcher.current=prevDispatcher}},useReducer:function(reducer,initialArg,init){currentHookNameInDev="useReducer",updateHookTypesDev();var prevDispatcher=ReactCurrentDispatcher.current;ReactCurrentDispatcher.current=InvalidNestedHooksDispatcherOnUpdateInDEV;try{return updateReducer(reducer,initialArg,init)}finally{ReactCurrentDispatcher.current=prevDispatcher}},useRef:function(initialValue){return currentHookNameInDev="useRef",updateHookTypesDev(),updateRef()},useState:function(initialState){currentHookNameInDev="useState",updateHookTypesDev();var prevDispatcher=ReactCurrentDispatcher.current;ReactCurrentDispatcher.current=InvalidNestedHooksDispatcherOnUpdateInDEV;try{return updateState(initialState)}finally{ReactCurrentDispatcher.current=prevDispatcher}},useDebugValue:function(value,formatterFn){return currentHookNameInDev="useDebugValue",updateHookTypesDev(),updateDebugValue()},useResponder:function(responder,props){return currentHookNameInDev="useResponder",updateHookTypesDev(),createDeprecatedResponderListener(responder,props)},useDeferredValue:function(value,config){return currentHookNameInDev="useDeferredValue",updateHookTypesDev(),updateDeferredValue(value,config)},useTransition:function(config){return currentHookNameInDev="useTransition",updateHookTypesDev(),updateTransition(config)}},HooksDispatcherOnRerenderInDEV={readContext:function(context,observedBits){return readContext(context,observedBits)},useCallback:function(callback,deps){return currentHookNameInDev="useCallback",updateHookTypesDev(),updateCallback(callback,deps)},useContext:function(context,observedBits){return currentHookNameInDev="useContext",updateHookTypesDev(),readContext(context,observedBits)},useEffect:function(create,deps){return currentHookNameInDev="useEffect",updateHookTypesDev(),updateEffect(create,deps)},useImperativeHandle:function(ref,create,deps){return currentHookNameInDev="useImperativeHandle",updateHookTypesDev(),updateImperativeHandle(ref,create,deps)},useLayoutEffect:function(create,deps){return currentHookNameInDev="useLayoutEffect",updateHookTypesDev(),updateLayoutEffect(create,deps)},useMemo:function(create,deps){currentHookNameInDev="useMemo",updateHookTypesDev();var prevDispatcher=ReactCurrentDispatcher.current;ReactCurrentDispatcher.current=InvalidNestedHooksDispatcherOnRerenderInDEV;try{return updateMemo(create,deps)}finally{ReactCurrentDispatcher.current=prevDispatcher}},useReducer:function(reducer,initialArg,init){currentHookNameInDev="useReducer",updateHookTypesDev();var prevDispatcher=ReactCurrentDispatcher.current;ReactCurrentDispatcher.current=InvalidNestedHooksDispatcherOnRerenderInDEV;try{return rerenderReducer(reducer,initialArg,init)}finally{ReactCurrentDispatcher.current=prevDispatcher}},useRef:function(initialValue){return currentHookNameInDev="useRef",updateHookTypesDev(),updateRef()},useState:function(initialState){currentHookNameInDev="useState",updateHookTypesDev();var prevDispatcher=ReactCurrentDispatcher.current;ReactCurrentDispatcher.current=InvalidNestedHooksDispatcherOnRerenderInDEV;try{return rerenderState(initialState)}finally{ReactCurrentDispatcher.current=prevDispatcher}},useDebugValue:function(value,formatterFn){return currentHookNameInDev="useDebugValue",updateHookTypesDev(),updateDebugValue()},useResponder:function(responder,props){return currentHookNameInDev="useResponder",updateHookTypesDev(),createDeprecatedResponderListener(responder,props)},useDeferredValue:function(value,config){return currentHookNameInDev="useDeferredValue",updateHookTypesDev(),rerenderDeferredValue(value,config)},useTransition:function(config){return currentHookNameInDev="useTransition",updateHookTypesDev(),rerenderTransition(config)}},InvalidNestedHooksDispatcherOnMountInDEV={readContext:function(context,observedBits){return warnInvalidContextAccess(),readContext(context,observedBits)},useCallback:function(callback,deps){return currentHookNameInDev="useCallback",warnInvalidHookAccess(),mountHookTypesDev(),mountCallback(callback,deps)},useContext:function(context,observedBits){return currentHookNameInDev="useContext",warnInvalidHookAccess(),mountHookTypesDev(),readContext(context,observedBits)},useEffect:function(create,deps){return currentHookNameInDev="useEffect",warnInvalidHookAccess(),mountHookTypesDev(),mountEffect(create,deps)},useImperativeHandle:function(ref,create,deps){return currentHookNameInDev="useImperativeHandle",warnInvalidHookAccess(),mountHookTypesDev(),mountImperativeHandle(ref,create,deps)},useLayoutEffect:function(create,deps){return currentHookNameInDev="useLayoutEffect",warnInvalidHookAccess(),mountHookTypesDev(),mountLayoutEffect(create,deps)},useMemo:function(create,deps){currentHookNameInDev="useMemo",warnInvalidHookAccess(),mountHookTypesDev();var prevDispatcher=ReactCurrentDispatcher.current;ReactCurrentDispatcher.current=InvalidNestedHooksDispatcherOnMountInDEV;try{return mountMemo(create,deps)}finally{ReactCurrentDispatcher.current=prevDispatcher}},useReducer:function(reducer,initialArg,init){currentHookNameInDev="useReducer",warnInvalidHookAccess(),mountHookTypesDev();var prevDispatcher=ReactCurrentDispatcher.current;ReactCurrentDispatcher.current=InvalidNestedHooksDispatcherOnMountInDEV;try{return mountReducer(reducer,initialArg,init)}finally{ReactCurrentDispatcher.current=prevDispatcher}},useRef:function(initialValue){return currentHookNameInDev="useRef",warnInvalidHookAccess(),mountHookTypesDev(),mountRef(initialValue)},useState:function(initialState){currentHookNameInDev="useState",warnInvalidHookAccess(),mountHookTypesDev();var prevDispatcher=ReactCurrentDispatcher.current;ReactCurrentDispatcher.current=InvalidNestedHooksDispatcherOnMountInDEV;try{return mountState(initialState)}finally{ReactCurrentDispatcher.current=prevDispatcher}},useDebugValue:function(value,formatterFn){currentHookNameInDev="useDebugValue",warnInvalidHookAccess(),mountHookTypesDev()},useResponder:function(responder,props){return currentHookNameInDev="useResponder",warnInvalidHookAccess(),mountHookTypesDev(),createDeprecatedResponderListener(responder,props)},useDeferredValue:function(value,config){return currentHookNameInDev="useDeferredValue",warnInvalidHookAccess(),mountHookTypesDev(),mountDeferredValue(value,config)},useTransition:function(config){return currentHookNameInDev="useTransition",warnInvalidHookAccess(),mountHookTypesDev(),mountTransition(config)}},InvalidNestedHooksDispatcherOnUpdateInDEV={readContext:function(context,observedBits){return warnInvalidContextAccess(),readContext(context,observedBits)},useCallback:function(callback,deps){return currentHookNameInDev="useCallback",warnInvalidHookAccess(),updateHookTypesDev(),updateCallback(callback,deps)},useContext:function(context,observedBits){return currentHookNameInDev="useContext",warnInvalidHookAccess(),updateHookTypesDev(),readContext(context,observedBits)},useEffect:function(create,deps){return currentHookNameInDev="useEffect",warnInvalidHookAccess(),updateHookTypesDev(),updateEffect(create,deps)},useImperativeHandle:function(ref,create,deps){return currentHookNameInDev="useImperativeHandle",warnInvalidHookAccess(),updateHookTypesDev(),updateImperativeHandle(ref,create,deps)},useLayoutEffect:function(create,deps){return currentHookNameInDev="useLayoutEffect",warnInvalidHookAccess(),updateHookTypesDev(),updateLayoutEffect(create,deps)},useMemo:function(create,deps){currentHookNameInDev="useMemo",warnInvalidHookAccess(),updateHookTypesDev();var prevDispatcher=ReactCurrentDispatcher.current;ReactCurrentDispatcher.current=InvalidNestedHooksDispatcherOnUpdateInDEV;try{return updateMemo(create,deps)}finally{ReactCurrentDispatcher.current=prevDispatcher}},useReducer:function(reducer,initialArg,init){currentHookNameInDev="useReducer",warnInvalidHookAccess(),updateHookTypesDev();var prevDispatcher=ReactCurrentDispatcher.current;ReactCurrentDispatcher.current=InvalidNestedHooksDispatcherOnUpdateInDEV;try{return updateReducer(reducer,initialArg,init)}finally{ReactCurrentDispatcher.current=prevDispatcher}},useRef:function(initialValue){return currentHookNameInDev="useRef",warnInvalidHookAccess(),updateHookTypesDev(),updateRef()},useState:function(initialState){currentHookNameInDev="useState",warnInvalidHookAccess(),updateHookTypesDev();var prevDispatcher=ReactCurrentDispatcher.current;ReactCurrentDispatcher.current=InvalidNestedHooksDispatcherOnUpdateInDEV;try{return updateState(initialState)}finally{ReactCurrentDispatcher.current=prevDispatcher}},useDebugValue:function(value,formatterFn){return currentHookNameInDev="useDebugValue",warnInvalidHookAccess(),updateHookTypesDev(),updateDebugValue()},useResponder:function(responder,props){return currentHookNameInDev="useResponder",warnInvalidHookAccess(),updateHookTypesDev(),createDeprecatedResponderListener(responder,props)},useDeferredValue:function(value,config){return currentHookNameInDev="useDeferredValue",warnInvalidHookAccess(),updateHookTypesDev(),updateDeferredValue(value,config)},useTransition:function(config){return currentHookNameInDev="useTransition",warnInvalidHookAccess(),updateHookTypesDev(),updateTransition(config)}},InvalidNestedHooksDispatcherOnRerenderInDEV={readContext:function(context,observedBits){return warnInvalidContextAccess(),readContext(context,observedBits)},useCallback:function(callback,deps){return currentHookNameInDev="useCallback",warnInvalidHookAccess(),updateHookTypesDev(),updateCallback(callback,deps)},useContext:function(context,observedBits){return currentHookNameInDev="useContext",warnInvalidHookAccess(),updateHookTypesDev(),readContext(context,observedBits)},useEffect:function(create,deps){return currentHookNameInDev="useEffect",warnInvalidHookAccess(),updateHookTypesDev(),updateEffect(create,deps)},useImperativeHandle:function(ref,create,deps){return currentHookNameInDev="useImperativeHandle",warnInvalidHookAccess(),updateHookTypesDev(),updateImperativeHandle(ref,create,deps)},useLayoutEffect:function(create,deps){return currentHookNameInDev="useLayoutEffect",warnInvalidHookAccess(),updateHookTypesDev(),updateLayoutEffect(create,deps)},useMemo:function(create,deps){currentHookNameInDev="useMemo",warnInvalidHookAccess(),updateHookTypesDev();var prevDispatcher=ReactCurrentDispatcher.current;ReactCurrentDispatcher.current=InvalidNestedHooksDispatcherOnUpdateInDEV;try{return updateMemo(create,deps)}finally{ReactCurrentDispatcher.current=prevDispatcher}},useReducer:function(reducer,initialArg,init){currentHookNameInDev="useReducer",warnInvalidHookAccess(),updateHookTypesDev();var prevDispatcher=ReactCurrentDispatcher.current;ReactCurrentDispatcher.current=InvalidNestedHooksDispatcherOnUpdateInDEV;try{return rerenderReducer(reducer,initialArg,init)}finally{ReactCurrentDispatcher.current=prevDispatcher}},useRef:function(initialValue){return currentHookNameInDev="useRef",warnInvalidHookAccess(),updateHookTypesDev(),updateRef()},useState:function(initialState){currentHookNameInDev="useState",warnInvalidHookAccess(),updateHookTypesDev();var prevDispatcher=ReactCurrentDispatcher.current;ReactCurrentDispatcher.current=InvalidNestedHooksDispatcherOnUpdateInDEV;try{return rerenderState(initialState)}finally{ReactCurrentDispatcher.current=prevDispatcher}},useDebugValue:function(value,formatterFn){return currentHookNameInDev="useDebugValue",warnInvalidHookAccess(),updateHookTypesDev(),updateDebugValue()},useResponder:function(responder,props){return currentHookNameInDev="useResponder",warnInvalidHookAccess(),updateHookTypesDev(),createDeprecatedResponderListener(responder,props)},useDeferredValue:function(value,config){return currentHookNameInDev="useDeferredValue",warnInvalidHookAccess(),updateHookTypesDev(),rerenderDeferredValue(value,config)},useTransition:function(config){return currentHookNameInDev="useTransition",warnInvalidHookAccess(),updateHookTypesDev(),rerenderTransition(config)}};var now$1=Scheduler.unstable_now,commitTime=0,profilerStartTime=-1;function getCommitTime(){return commitTime}function recordCommitTime(){commitTime=now$1()}function startProfilerTimer(fiber){profilerStartTime=now$1(),fiber.actualStartTime<0&&(fiber.actualStartTime=now$1())}function stopProfilerTimerIfRunning(fiber){profilerStartTime=-1}function stopProfilerTimerIfRunningAndRecordDelta(fiber,overrideBaseTime){if(profilerStartTime>=0){var elapsedTime=now$1()-profilerStartTime;fiber.actualDuration+=elapsedTime,overrideBaseTime&&(fiber.selfBaseDuration=elapsedTime),profilerStartTime=-1}}var hydrationParentFiber=null,nextHydratableInstance=null,isHydrating=!1;function enterHydrationState(fiber){var parentInstance=fiber.stateNode.containerInfo;return nextHydratableInstance=getFirstHydratableChild(parentInstance),hydrationParentFiber=fiber,isHydrating=!0,!0}function deleteHydratableInstance(returnFiber,instance){switch(returnFiber.tag){case 3:didNotHydrateContainerInstance(returnFiber.stateNode.containerInfo,instance);break;case 5:didNotHydrateInstance(returnFiber.type,returnFiber.memoizedProps,returnFiber.stateNode,instance)}var childToDelete=createFiberFromHostInstanceForDeletion();childToDelete.stateNode=instance,childToDelete.return=returnFiber,childToDelete.effectTag=8,null!==returnFiber.lastEffect?(returnFiber.lastEffect.nextEffect=childToDelete,returnFiber.lastEffect=childToDelete):returnFiber.firstEffect=returnFiber.lastEffect=childToDelete}function insertNonHydratedInstance(returnFiber,fiber){switch(fiber.effectTag=-1025&fiber.effectTag|2,returnFiber.tag){case 3:var parentContainer=returnFiber.stateNode.containerInfo;switch(fiber.tag){case 5:var type=fiber.type,props=fiber.pendingProps;didNotFindHydratableContainerInstance(parentContainer,type);break;case 6:var text;didNotFindHydratableContainerTextInstance(parentContainer,fiber.pendingProps)}break;case 5:var parentType=returnFiber.type,parentProps=returnFiber.memoizedProps,parentInstance=returnFiber.stateNode;switch(fiber.tag){case 5:var _type=fiber.type,_props=fiber.pendingProps;didNotFindHydratableInstance(parentType,parentProps,parentInstance,_type);break;case 6:var _text;didNotFindHydratableTextInstance(parentType,parentProps,parentInstance,fiber.pendingProps);break;case 13:didNotFindHydratableSuspenseInstance(parentType,parentProps)}break;default:return}}function tryHydrate(fiber,nextInstance){switch(fiber.tag){case 5:var type=fiber.type,props=fiber.pendingProps,instance=canHydrateInstance(nextInstance,type);return null!==instance&&(fiber.stateNode=instance,!0);case 6:var text,textInstance=canHydrateTextInstance(nextInstance,fiber.pendingProps);return null!==textInstance&&(fiber.stateNode=textInstance,!0);case 13:default:return!1}}function tryToClaimNextHydratableInstance(fiber){if(isHydrating){var nextInstance=nextHydratableInstance;if(!nextInstance)return insertNonHydratedInstance(hydrationParentFiber,fiber),isHydrating=!1,void(hydrationParentFiber=fiber);var firstAttemptedInstance=nextInstance;if(!tryHydrate(fiber,nextInstance)){if(!(nextInstance=getNextHydratableSibling(firstAttemptedInstance))||!tryHydrate(fiber,nextInstance))return insertNonHydratedInstance(hydrationParentFiber,fiber),isHydrating=!1,void(hydrationParentFiber=fiber);deleteHydratableInstance(hydrationParentFiber,firstAttemptedInstance)}hydrationParentFiber=fiber,nextHydratableInstance=getFirstHydratableChild(nextInstance)}}function prepareToHydrateHostInstance(fiber,rootContainerInstance,hostContext){var instance,updatePayload=hydrateInstance(fiber.stateNode,fiber.type,fiber.memoizedProps,rootContainerInstance,hostContext,fiber);return fiber.updateQueue=updatePayload,null!==updatePayload}function prepareToHydrateHostTextInstance(fiber){var textInstance=fiber.stateNode,textContent=fiber.memoizedProps,shouldUpdate=hydrateTextInstance(textInstance,textContent,fiber);if(shouldUpdate){var returnFiber=hydrationParentFiber;if(null!==returnFiber)switch(returnFiber.tag){case 3:var parentContainer;didNotMatchHydratedContainerTextInstance(returnFiber.stateNode.containerInfo,textInstance,textContent);break;case 5:var parentType,parentProps,parentInstance;didNotMatchHydratedTextInstance(returnFiber.type,returnFiber.memoizedProps,returnFiber.stateNode,textInstance,textContent)}}return shouldUpdate}function skipPastDehydratedSuspenseInstance(fiber){var suspenseState=fiber.memoizedState,suspenseInstance=null!==suspenseState?suspenseState.dehydrated:null;if(!suspenseInstance)throw Error("Expected to have a hydrated suspense instance. This error is likely caused by a bug in React. Please file an issue.");return getNextHydratableInstanceAfterSuspenseInstance(suspenseInstance)}function popToNextHostParent(fiber){for(var parent=fiber.return;null!==parent&&5!==parent.tag&&3!==parent.tag&&13!==parent.tag;)parent=parent.return;hydrationParentFiber=parent}function popHydrationState(fiber){if(fiber!==hydrationParentFiber)return!1;if(!isHydrating)return popToNextHostParent(fiber),isHydrating=!0,!1;var type=fiber.type;if(5!==fiber.tag||"head"!==type&&"body"!==type&&!shouldSetTextContent(type,fiber.memoizedProps))for(var nextInstance=nextHydratableInstance;nextInstance;)deleteHydratableInstance(fiber,nextInstance),nextInstance=getNextHydratableSibling(nextInstance);return popToNextHostParent(fiber),nextHydratableInstance=13===fiber.tag?skipPastDehydratedSuspenseInstance(fiber):hydrationParentFiber?getNextHydratableSibling(fiber.stateNode):null,!0}function resetHydrationState(){hydrationParentFiber=null,nextHydratableInstance=null,isHydrating=!1}var ReactCurrentOwner$1=ReactSharedInternals.ReactCurrentOwner,didReceiveUpdate=!1,didWarnAboutBadClass,didWarnAboutModulePatternComponent,didWarnAboutContextTypeOnFunctionComponent,didWarnAboutGetDerivedStateOnFunctionComponent,didWarnAboutFunctionRefs,didWarnAboutReassigningProps,didWarnAboutRevealOrder,didWarnAboutTailOptions;function reconcileChildren(current,workInProgress,nextChildren,renderExpirationTime){workInProgress.child=null===current?mountChildFibers(workInProgress,null,nextChildren,renderExpirationTime):reconcileChildFibers(workInProgress,current.child,nextChildren,renderExpirationTime)}function forceUnmountCurrentAndReconcile(current,workInProgress,nextChildren,renderExpirationTime){workInProgress.child=reconcileChildFibers(workInProgress,current.child,null,renderExpirationTime),workInProgress.child=reconcileChildFibers(workInProgress,null,nextChildren,renderExpirationTime)}function updateForwardRef(current,workInProgress,Component,nextProps,renderExpirationTime){if(workInProgress.type!==workInProgress.elementType){var innerPropTypes=Component.propTypes;innerPropTypes&&checkPropTypes(innerPropTypes,nextProps,"prop",getComponentName(Component),getCurrentFiberStackInDev)}var render=Component.render,ref=workInProgress.ref,nextChildren;return prepareToReadContext(workInProgress,renderExpirationTime),ReactCurrentOwner$1.current=workInProgress,setIsRendering(!0),nextChildren=renderWithHooks(current,workInProgress,render,nextProps,ref,renderExpirationTime),1&workInProgress.mode&&null!==workInProgress.memoizedState&&(nextChildren=renderWithHooks(current,workInProgress,render,nextProps,ref,renderExpirationTime)),setIsRendering(!1),null===current||didReceiveUpdate?(workInProgress.effectTag|=1,reconcileChildren(current,workInProgress,nextChildren,renderExpirationTime),workInProgress.child):(bailoutHooks(current,workInProgress,renderExpirationTime),bailoutOnAlreadyFinishedWork(current,workInProgress,renderExpirationTime))}function updateMemoComponent(current,workInProgress,Component,nextProps,updateExpirationTime,renderExpirationTime){if(null===current){var type=Component.type;if(isSimpleFunctionComponent(type)&&null===Component.compare&&void 0===Component.defaultProps){var resolvedType=type;return resolvedType=resolveFunctionForHotReloading(type),workInProgress.tag=15,workInProgress.type=resolvedType,validateFunctionComponentInDev(workInProgress,type),updateSimpleMemoComponent(current,workInProgress,resolvedType,nextProps,updateExpirationTime,renderExpirationTime)}var innerPropTypes=type.propTypes;innerPropTypes&&checkPropTypes(innerPropTypes,nextProps,"prop",getComponentName(type),getCurrentFiberStackInDev);var child=createFiberFromTypeAndProps(Component.type,null,nextProps,null,workInProgress.mode,renderExpirationTime);return child.ref=workInProgress.ref,child.return=workInProgress,workInProgress.child=child,child}var _type=Component.type,_innerPropTypes=_type.propTypes;_innerPropTypes&&checkPropTypes(_innerPropTypes,nextProps,"prop",getComponentName(_type),getCurrentFiberStackInDev);var currentChild=current.child;if(updateExpirationTime<renderExpirationTime){var prevProps=currentChild.memoizedProps,compare=Component.compare;if((compare=null!==compare?compare:shallowEqual)(prevProps,nextProps)&&current.ref===workInProgress.ref)return bailoutOnAlreadyFinishedWork(current,workInProgress,renderExpirationTime)}workInProgress.effectTag|=1;var newChild=createWorkInProgress(currentChild,nextProps);return newChild.ref=workInProgress.ref,newChild.return=workInProgress,workInProgress.child=newChild,newChild}function updateSimpleMemoComponent(current,workInProgress,Component,nextProps,updateExpirationTime,renderExpirationTime){if(workInProgress.type!==workInProgress.elementType){var outerMemoType=workInProgress.elementType;outerMemoType.$$typeof===REACT_LAZY_TYPE&&(outerMemoType=refineResolvedLazyComponent(outerMemoType));var outerPropTypes=outerMemoType&&outerMemoType.propTypes;outerPropTypes&&checkPropTypes(outerPropTypes,nextProps,"prop",getComponentName(outerMemoType),getCurrentFiberStackInDev)}var prevProps;if(null!==current&&(shallowEqual(current.memoizedProps,nextProps)&&current.ref===workInProgress.ref&&workInProgress.type===current.type&&(didReceiveUpdate=!1,updateExpirationTime<renderExpirationTime)))return workInProgress.expirationTime=current.expirationTime,bailoutOnAlreadyFinishedWork(current,workInProgress,renderExpirationTime);return updateFunctionComponent(current,workInProgress,Component,nextProps,renderExpirationTime)}function updateFragment(current,workInProgress,renderExpirationTime){var nextChildren;return reconcileChildren(current,workInProgress,workInProgress.pendingProps,renderExpirationTime),workInProgress.child}function updateMode(current,workInProgress,renderExpirationTime){var nextChildren;return reconcileChildren(current,workInProgress,workInProgress.pendingProps.children,renderExpirationTime),workInProgress.child}function updateProfiler(current,workInProgress,renderExpirationTime){var nextProps,nextChildren;return workInProgress.effectTag|=4,reconcileChildren(current,workInProgress,workInProgress.pendingProps.children,renderExpirationTime),workInProgress.child}function markRef(current,workInProgress){var ref=workInProgress.ref;(null===current&&null!==ref||null!==current&&current.ref!==ref)&&(workInProgress.effectTag|=128)}function updateFunctionComponent(current,workInProgress,Component,nextProps,renderExpirationTime){if(workInProgress.type!==workInProgress.elementType){var innerPropTypes=Component.propTypes;innerPropTypes&&checkPropTypes(innerPropTypes,nextProps,"prop",getComponentName(Component),getCurrentFiberStackInDev)}var context,unmaskedContext,nextChildren;return context=getMaskedContext(workInProgress,getUnmaskedContext(workInProgress,Component,!0)),prepareToReadContext(workInProgress,renderExpirationTime),ReactCurrentOwner$1.current=workInProgress,setIsRendering(!0),nextChildren=renderWithHooks(current,workInProgress,Component,nextProps,context,renderExpirationTime),1&workInProgress.mode&&null!==workInProgress.memoizedState&&(nextChildren=renderWithHooks(current,workInProgress,Component,nextProps,context,renderExpirationTime)),setIsRendering(!1),null===current||didReceiveUpdate?(workInProgress.effectTag|=1,reconcileChildren(current,workInProgress,nextChildren,renderExpirationTime),workInProgress.child):(bailoutHooks(current,workInProgress,renderExpirationTime),bailoutOnAlreadyFinishedWork(current,workInProgress,renderExpirationTime))}function updateClassComponent(current,workInProgress,Component,nextProps,renderExpirationTime){if(workInProgress.type!==workInProgress.elementType){var innerPropTypes=Component.propTypes;innerPropTypes&&checkPropTypes(innerPropTypes,nextProps,"prop",getComponentName(Component),getCurrentFiberStackInDev)}var hasContext,instance,shouldUpdate;isContextProvider(Component)?(hasContext=!0,pushContextProvider(workInProgress)):hasContext=!1,prepareToReadContext(workInProgress,renderExpirationTime),null===workInProgress.stateNode?(null!==current&&(current.alternate=null,workInProgress.alternate=null,workInProgress.effectTag|=2),constructClassInstance(workInProgress,Component,nextProps),mountClassInstance(workInProgress,Component,nextProps,renderExpirationTime),shouldUpdate=!0):shouldUpdate=null===current?resumeMountClassInstance(workInProgress,Component,nextProps,renderExpirationTime):updateClassInstance(current,workInProgress,Component,nextProps,renderExpirationTime);var nextUnitOfWork=finishClassComponent(current,workInProgress,Component,shouldUpdate,hasContext,renderExpirationTime),inst;return workInProgress.stateNode.props!==nextProps&&(didWarnAboutReassigningProps||error("It looks like %s is reassigning its own `this.props` while rendering. This is not supported and can lead to confusing bugs.",getComponentName(workInProgress.type)||"a component"),didWarnAboutReassigningProps=!0),nextUnitOfWork}function finishClassComponent(current,workInProgress,Component,shouldUpdate,hasContext,renderExpirationTime){markRef(current,workInProgress);var didCaptureError=0!=(64&workInProgress.effectTag);if(!shouldUpdate&&!didCaptureError)return hasContext&&invalidateContextProvider(workInProgress,Component,!1),bailoutOnAlreadyFinishedWork(current,workInProgress,renderExpirationTime);var instance=workInProgress.stateNode,nextChildren;return ReactCurrentOwner$1.current=workInProgress,didCaptureError&&"function"!=typeof Component.getDerivedStateFromError?(nextChildren=null,stopProfilerTimerIfRunning()):(setIsRendering(!0),nextChildren=instance.render(),1&workInProgress.mode&&instance.render(),setIsRendering(!1)),workInProgress.effectTag|=1,null!==current&&didCaptureError?forceUnmountCurrentAndReconcile(current,workInProgress,nextChildren,renderExpirationTime):reconcileChildren(current,workInProgress,nextChildren,renderExpirationTime),workInProgress.memoizedState=instance.state,hasContext&&invalidateContextProvider(workInProgress,Component,!0),workInProgress.child}function pushHostRootContext(workInProgress){var root=workInProgress.stateNode;root.pendingContext?pushTopLevelContextObject(workInProgress,root.pendingContext,root.pendingContext!==root.context):root.context&&pushTopLevelContextObject(workInProgress,root.context,!1),pushHostContainer(workInProgress,root.containerInfo)}function updateHostRoot(current,workInProgress,renderExpirationTime){pushHostRootContext(workInProgress);var updateQueue=workInProgress.updateQueue;if(null===current||null===updateQueue)throw Error("If the root does not have an updateQueue, we should have already bailed out. This error is likely caused by a bug in React. Please file an issue.");var nextProps=workInProgress.pendingProps,prevState=workInProgress.memoizedState,prevChildren=null!==prevState?prevState.element:null;cloneUpdateQueue(current,workInProgress),processUpdateQueue(workInProgress,nextProps,null,renderExpirationTime);var nextState,nextChildren=workInProgress.memoizedState.element,root;if(nextChildren===prevChildren)return resetHydrationState(),bailoutOnAlreadyFinishedWork(current,workInProgress,renderExpirationTime);if(workInProgress.stateNode.hydrate&&enterHydrationState(workInProgress)){var child=mountChildFibers(workInProgress,null,nextChildren,renderExpirationTime);workInProgress.child=child;for(var node=child;node;)node.effectTag=-3&node.effectTag|1024,node=node.sibling}else reconcileChildren(current,workInProgress,nextChildren,renderExpirationTime),resetHydrationState();return workInProgress.child}function updateHostComponent(current,workInProgress,renderExpirationTime){pushHostContext(workInProgress),null===current&&tryToClaimNextHydratableInstance(workInProgress);var type=workInProgress.type,nextProps=workInProgress.pendingProps,prevProps=null!==current?current.memoizedProps:null,nextChildren=nextProps.children,isDirectTextChild;return shouldSetTextContent(type,nextProps)?nextChildren=null:null!==prevProps&&shouldSetTextContent(type,prevProps)&&(workInProgress.effectTag|=16),markRef(current,workInProgress),4&workInProgress.mode&&1!==renderExpirationTime&&shouldDeprioritizeSubtree(type,nextProps)?(markSpawnedWork(1),workInProgress.expirationTime=workInProgress.childExpirationTime=1,null):(reconcileChildren(current,workInProgress,nextChildren,renderExpirationTime),workInProgress.child)}function updateHostText(current,workInProgress){return null===current&&tryToClaimNextHydratableInstance(workInProgress),null}function mountLazyComponent(_current,workInProgress,elementType,updateExpirationTime,renderExpirationTime){null!==_current&&(_current.alternate=null,workInProgress.alternate=null,workInProgress.effectTag|=2);var props=workInProgress.pendingProps;cancelWorkTimer(workInProgress);var Component=readLazyComponentType(elementType);workInProgress.type=Component;var resolvedTag=workInProgress.tag=resolveLazyComponentTag(Component);startWorkTimer(workInProgress);var resolvedProps=resolveDefaultProps(Component,props),child;switch(resolvedTag){case 0:return validateFunctionComponentInDev(workInProgress,Component),workInProgress.type=Component=resolveFunctionForHotReloading(Component),child=updateFunctionComponent(null,workInProgress,Component,resolvedProps,renderExpirationTime);case 1:return workInProgress.type=Component=resolveClassForHotReloading(Component),child=updateClassComponent(null,workInProgress,Component,resolvedProps,renderExpirationTime);case 11:return workInProgress.type=Component=resolveForwardRefForHotReloading(Component),child=updateForwardRef(null,workInProgress,Component,resolvedProps,renderExpirationTime);case 14:if(workInProgress.type!==workInProgress.elementType){var outerPropTypes=Component.propTypes;outerPropTypes&&checkPropTypes(outerPropTypes,resolvedProps,"prop",getComponentName(Component),getCurrentFiberStackInDev)}return child=updateMemoComponent(null,workInProgress,Component,resolveDefaultProps(Component.type,resolvedProps),updateExpirationTime,renderExpirationTime)}var hint="";throw null!==Component&&"object"==typeof Component&&Component.$$typeof===REACT_LAZY_TYPE&&(hint=" Did you wrap a component in React.lazy() more than once?"),Error("Element type is invalid. Received a promise that resolves to: "+Component+". Lazy element type must resolve to a class or function."+hint)}function mountIncompleteClassComponent(_current,workInProgress,Component,nextProps,renderExpirationTime){var hasContext;return null!==_current&&(_current.alternate=null,workInProgress.alternate=null,workInProgress.effectTag|=2),workInProgress.tag=1,isContextProvider(Component)?(hasContext=!0,pushContextProvider(workInProgress)):hasContext=!1,prepareToReadContext(workInProgress,renderExpirationTime),constructClassInstance(workInProgress,Component,nextProps),mountClassInstance(workInProgress,Component,nextProps,renderExpirationTime),finishClassComponent(null,workInProgress,Component,!0,hasContext,renderExpirationTime)}function mountIndeterminateComponent(_current,workInProgress,Component,renderExpirationTime){null!==_current&&(_current.alternate=null,workInProgress.alternate=null,workInProgress.effectTag|=2);var props=workInProgress.pendingProps,context,unmaskedContext,value;if(context=getMaskedContext(workInProgress,getUnmaskedContext(workInProgress,Component,!1)),prepareToReadContext(workInProgress,renderExpirationTime),Component.prototype&&"function"==typeof Component.prototype.render){var componentName=getComponentName(Component)||"Unknown";didWarnAboutBadClass[componentName]||(error("The <%s /> component appears to have a render method, but doesn't extend React.Component. This is likely to cause errors. Change %s to extend React.Component instead.",componentName,componentName),didWarnAboutBadClass[componentName]=!0)}if(1&workInProgress.mode&&ReactStrictModeWarnings.recordLegacyContextWarning(workInProgress,null),setIsRendering(!0),ReactCurrentOwner$1.current=workInProgress,value=renderWithHooks(null,workInProgress,Component,props,context,renderExpirationTime),setIsRendering(!1),workInProgress.effectTag|=1,"object"==typeof value&&null!==value&&"function"==typeof value.render&&void 0===value.$$typeof){var _componentName=getComponentName(Component)||"Unknown";didWarnAboutModulePatternComponent[_componentName]||(error("The <%s /> component appears to be a function component that returns a class instance. Change %s to a class that extends React.Component instead. If you can't use a class try assigning the prototype on the function as a workaround. `%s.prototype = React.Component.prototype`. Don't use an arrow function since it cannot be called with `new` by React.",_componentName,_componentName,_componentName),didWarnAboutModulePatternComponent[_componentName]=!0),workInProgress.tag=1,workInProgress.memoizedState=null,workInProgress.updateQueue=null;var hasContext=!1;isContextProvider(Component)?(hasContext=!0,pushContextProvider(workInProgress)):hasContext=!1,workInProgress.memoizedState=null!==value.state&&void 0!==value.state?value.state:null,initializeUpdateQueue(workInProgress);var getDerivedStateFromProps=Component.getDerivedStateFromProps;return"function"==typeof getDerivedStateFromProps&&applyDerivedStateFromProps(workInProgress,Component,getDerivedStateFromProps,props),adoptClassInstance(workInProgress,value),mountClassInstance(workInProgress,Component,props,renderExpirationTime),finishClassComponent(null,workInProgress,Component,!0,hasContext,renderExpirationTime)}return workInProgress.tag=0,1&workInProgress.mode&&null!==workInProgress.memoizedState&&(value=renderWithHooks(null,workInProgress,Component,props,context,renderExpirationTime)),reconcileChildren(null,workInProgress,value,renderExpirationTime),validateFunctionComponentInDev(workInProgress,Component),workInProgress.child}function validateFunctionComponentInDev(workInProgress,Component){if(Component&&Component.childContextTypes&&error("%s(...): childContextTypes cannot be defined on a function component.",Component.displayName||Component.name||"Component"),null!==workInProgress.ref){var info="",ownerName=getCurrentFiberOwnerNameInDevOrNull();ownerName&&(info+="\n\nCheck the render method of `"+ownerName+"`.");var warningKey=ownerName||workInProgress._debugID||"",debugSource=workInProgress._debugSource;debugSource&&(warningKey=debugSource.fileName+":"+debugSource.lineNumber),didWarnAboutFunctionRefs[warningKey]||(didWarnAboutFunctionRefs[warningKey]=!0,error("Function components cannot be given refs. Attempts to access this ref will fail. Did you mean to use React.forwardRef()?%s",info))}if("function"==typeof Component.getDerivedStateFromProps){var _componentName2=getComponentName(Component)||"Unknown";didWarnAboutGetDerivedStateOnFunctionComponent[_componentName2]||(error("%s: Function components do not support getDerivedStateFromProps.",_componentName2),didWarnAboutGetDerivedStateOnFunctionComponent[_componentName2]=!0)}if("object"==typeof Component.contextType&&null!==Component.contextType){var _componentName3=getComponentName(Component)||"Unknown";didWarnAboutContextTypeOnFunctionComponent[_componentName3]||(error("%s: Function components do not support contextType.",_componentName3),didWarnAboutContextTypeOnFunctionComponent[_componentName3]=!0)}}didWarnAboutBadClass={},didWarnAboutModulePatternComponent={},didWarnAboutContextTypeOnFunctionComponent={},didWarnAboutGetDerivedStateOnFunctionComponent={},didWarnAboutFunctionRefs={},didWarnAboutReassigningProps=!1,didWarnAboutRevealOrder={},didWarnAboutTailOptions={};var SUSPENDED_MARKER={dehydrated:null,retryTime:0};function shouldRemainOnFallback(suspenseContext,current,workInProgress){return hasSuspenseContext(suspenseContext,2)&&(null===current||null!==current.memoizedState)}function updateSuspenseComponent(current,workInProgress,renderExpirationTime){var mode=workInProgress.mode,nextProps=workInProgress.pendingProps;shouldSuspend(workInProgress)&&(workInProgress.effectTag|=64);var suspenseContext=suspenseStackCursor.current,nextDidTimeout=!1,didSuspend,prevState;if(0!=(64&workInProgress.effectTag)||shouldRemainOnFallback(suspenseContext,current)?(nextDidTimeout=!0,workInProgress.effectTag&=-65):null!==current&&null===current.memoizedState||void 0!==nextProps.fallback&&!0!==nextProps.unstable_avoidThisFallback&&(suspenseContext=addSubtreeSuspenseContext(suspenseContext,1)),pushSuspenseContext(workInProgress,suspenseContext=setDefaultShallowSuspenseContext(suspenseContext)),null===current){if(void 0!==nextProps.fallback&&tryToClaimNextHydratableInstance(workInProgress),nextDidTimeout){var nextFallbackChildren=nextProps.fallback,primaryChildFragment=createFiberFromFragment(null,mode,0,null);if(primaryChildFragment.return=workInProgress,0==(2&workInProgress.mode)){var progressedState,progressedPrimaryChild=null!==workInProgress.memoizedState?workInProgress.child.child:workInProgress.child;primaryChildFragment.child=progressedPrimaryChild;for(var progressedChild=progressedPrimaryChild;null!==progressedChild;)progressedChild.return=primaryChildFragment,progressedChild=progressedChild.sibling}var fallbackChildFragment=createFiberFromFragment(nextFallbackChildren,mode,renderExpirationTime,null);return fallbackChildFragment.return=workInProgress,primaryChildFragment.sibling=fallbackChildFragment,workInProgress.memoizedState=SUSPENDED_MARKER,workInProgress.child=primaryChildFragment,fallbackChildFragment}var nextPrimaryChildren=nextProps.children;return workInProgress.memoizedState=null,workInProgress.child=mountChildFibers(workInProgress,null,nextPrimaryChildren,renderExpirationTime)}if(null!==current.memoizedState){var currentPrimaryChildFragment=current.child,currentFallbackChildFragment=currentPrimaryChildFragment.sibling;if(nextDidTimeout){var _nextFallbackChildren2=nextProps.fallback,_primaryChildFragment2=createWorkInProgress(currentPrimaryChildFragment,currentPrimaryChildFragment.pendingProps);if(_primaryChildFragment2.return=workInProgress,0==(2&workInProgress.mode)){var _progressedState,_progressedPrimaryChild=null!==workInProgress.memoizedState?workInProgress.child.child:workInProgress.child;if(_progressedPrimaryChild!==currentPrimaryChildFragment.child){_primaryChildFragment2.child=_progressedPrimaryChild;for(var _progressedChild2=_progressedPrimaryChild;null!==_progressedChild2;)_progressedChild2.return=_primaryChildFragment2,_progressedChild2=_progressedChild2.sibling}}if(8&workInProgress.mode){for(var _treeBaseDuration=0,_hiddenChild=_primaryChildFragment2.child;null!==_hiddenChild;)_treeBaseDuration+=_hiddenChild.treeBaseDuration,_hiddenChild=_hiddenChild.sibling;_primaryChildFragment2.treeBaseDuration=_treeBaseDuration}var _fallbackChildFragment2=createWorkInProgress(currentFallbackChildFragment,_nextFallbackChildren2);return _fallbackChildFragment2.return=workInProgress,_primaryChildFragment2.sibling=_fallbackChildFragment2,_primaryChildFragment2.childExpirationTime=0,workInProgress.memoizedState=SUSPENDED_MARKER,workInProgress.child=_primaryChildFragment2,_fallbackChildFragment2}var _nextPrimaryChildren=nextProps.children,currentPrimaryChild=currentPrimaryChildFragment.child,primaryChild=reconcileChildFibers(workInProgress,currentPrimaryChild,_nextPrimaryChildren,renderExpirationTime);return workInProgress.memoizedState=null,workInProgress.child=primaryChild}var _currentPrimaryChild=current.child;if(nextDidTimeout){var _nextFallbackChildren3=nextProps.fallback,_primaryChildFragment3=createFiberFromFragment(null,mode,0,null);if(_primaryChildFragment3.return=workInProgress,_primaryChildFragment3.child=_currentPrimaryChild,null!==_currentPrimaryChild&&(_currentPrimaryChild.return=_primaryChildFragment3),0==(2&workInProgress.mode)){var _progressedState2,_progressedPrimaryChild2=null!==workInProgress.memoizedState?workInProgress.child.child:workInProgress.child;_primaryChildFragment3.child=_progressedPrimaryChild2;for(var _progressedChild3=_progressedPrimaryChild2;null!==_progressedChild3;)_progressedChild3.return=_primaryChildFragment3,_progressedChild3=_progressedChild3.sibling}if(8&workInProgress.mode){for(var _treeBaseDuration2=0,_hiddenChild2=_primaryChildFragment3.child;null!==_hiddenChild2;)_treeBaseDuration2+=_hiddenChild2.treeBaseDuration,_hiddenChild2=_hiddenChild2.sibling;_primaryChildFragment3.treeBaseDuration=_treeBaseDuration2}var _fallbackChildFragment3=createFiberFromFragment(_nextFallbackChildren3,mode,renderExpirationTime,null);return _fallbackChildFragment3.return=workInProgress,_primaryChildFragment3.sibling=_fallbackChildFragment3,_fallbackChildFragment3.effectTag|=2,_primaryChildFragment3.childExpirationTime=0,workInProgress.memoizedState=SUSPENDED_MARKER,workInProgress.child=_primaryChildFragment3,_fallbackChildFragment3}workInProgress.memoizedState=null;var _nextPrimaryChildren2=nextProps.children;return workInProgress.child=reconcileChildFibers(workInProgress,_currentPrimaryChild,_nextPrimaryChildren2,renderExpirationTime)}function scheduleWorkOnFiber(fiber,renderExpirationTime){fiber.expirationTime<renderExpirationTime&&(fiber.expirationTime=renderExpirationTime);var alternate=fiber.alternate;null!==alternate&&alternate.expirationTime<renderExpirationTime&&(alternate.expirationTime=renderExpirationTime),scheduleWorkOnParentPath(fiber.return,renderExpirationTime)}function propagateSuspenseContextChange(workInProgress,firstChild,renderExpirationTime){for(var node=firstChild;null!==node;){var state;if(13===node.tag)null!==node.memoizedState&&scheduleWorkOnFiber(node,renderExpirationTime);else if(19===node.tag)scheduleWorkOnFiber(node,renderExpirationTime);else if(null!==node.child){node.child.return=node,node=node.child;continue}if(node===workInProgress)return;for(;null===node.sibling;){if(null===node.return||node.return===workInProgress)return;node=node.return}node.sibling.return=node.return,node=node.sibling}}function findLastContentRow(firstChild){for(var row=firstChild,lastContentRow=null;null!==row;){var currentRow=row.alternate;null!==currentRow&&null===findFirstSuspended(currentRow)&&(lastContentRow=row),row=row.sibling}return lastContentRow}function validateRevealOrder(revealOrder){if(void 0!==revealOrder&&"forwards"!==revealOrder&&"backwards"!==revealOrder&&"together"!==revealOrder&&!didWarnAboutRevealOrder[revealOrder])if(didWarnAboutRevealOrder[revealOrder]=!0,"string"==typeof revealOrder)switch(revealOrder.toLowerCase()){case"together":case"forwards":case"backwards":error('"%s" is not a valid value for revealOrder on <SuspenseList />. Use lowercase "%s" instead.',revealOrder,revealOrder.toLowerCase());break;case"forward":case"backward":error('"%s" is not a valid value for revealOrder on <SuspenseList />. React uses the -s suffix in the spelling. Use "%ss" instead.',revealOrder,revealOrder.toLowerCase());break;default:error('"%s" is not a supported revealOrder on <SuspenseList />. Did you mean "together", "forwards" or "backwards"?',revealOrder)}else error('%s is not a supported value for revealOrder on <SuspenseList />. Did you mean "together", "forwards" or "backwards"?',revealOrder)}function validateTailOptions(tailMode,revealOrder){void 0===tailMode||didWarnAboutTailOptions[tailMode]||("collapsed"!==tailMode&&"hidden"!==tailMode?(didWarnAboutTailOptions[tailMode]=!0,error('"%s" is not a supported value for tail on <SuspenseList />. Did you mean "collapsed" or "hidden"?',tailMode)):"forwards"!==revealOrder&&"backwards"!==revealOrder&&(didWarnAboutTailOptions[tailMode]=!0,error('<SuspenseList tail="%s" /> is only valid if revealOrder is "forwards" or "backwards". Did you mean to specify revealOrder="forwards"?',tailMode)))}function validateSuspenseListNestedChild(childSlot,index){var isArray=Array.isArray(childSlot),isIterable=!isArray&&"function"==typeof getIteratorFn(childSlot);if(isArray||isIterable){var type=isArray?"array":"iterable";return error("A nested %s was passed to row #%s in <SuspenseList />. Wrap it in an additional SuspenseList to configure its revealOrder: <SuspenseList revealOrder=...> ... <SuspenseList revealOrder=...>{%s}</SuspenseList> ... </SuspenseList>",type,index,type),!1}return!0}function validateSuspenseListChildren(children,revealOrder){if(("forwards"===revealOrder||"backwards"===revealOrder)&&null!=children&&!1!==children)if(Array.isArray(children)){for(var i=0;i<children.length;i++)if(!validateSuspenseListNestedChild(children[i],i))return}else{var iteratorFn=getIteratorFn(children);if("function"==typeof iteratorFn){var childrenIterator=iteratorFn.call(children);if(childrenIterator)for(var step=childrenIterator.next(),_i=0;!step.done;step=childrenIterator.next()){if(!validateSuspenseListNestedChild(step.value,_i))return;_i++}}else error('A single row was passed to a <SuspenseList revealOrder="%s" />. This is not useful since it needs multiple rows. Did you mean to pass multiple children or an array?',revealOrder)}}function initSuspenseListRenderState(workInProgress,isBackwards,tail,lastContentRow,tailMode,lastEffectBeforeRendering){var renderState=workInProgress.memoizedState;null===renderState?workInProgress.memoizedState={isBackwards:isBackwards,rendering:null,renderingStartTime:0,last:lastContentRow,tail:tail,tailExpiration:0,tailMode:tailMode,lastEffect:lastEffectBeforeRendering}:(renderState.isBackwards=isBackwards,renderState.rendering=null,renderState.renderingStartTime=0,renderState.last=lastContentRow,renderState.tail=tail,renderState.tailExpiration=0,renderState.tailMode=tailMode,renderState.lastEffect=lastEffectBeforeRendering)}function updateSuspenseListComponent(current,workInProgress,renderExpirationTime){var nextProps=workInProgress.pendingProps,revealOrder=nextProps.revealOrder,tailMode=nextProps.tail,newChildren=nextProps.children;validateRevealOrder(revealOrder),validateTailOptions(tailMode,revealOrder),validateSuspenseListChildren(newChildren,revealOrder),reconcileChildren(current,workInProgress,newChildren,renderExpirationTime);var suspenseContext=suspenseStackCursor.current,shouldForceFallback,didSuspendBefore;hasSuspenseContext(suspenseContext,2)?(suspenseContext=setShallowSuspenseContext(suspenseContext,2),workInProgress.effectTag|=64):(null!==current&&0!=(64&current.effectTag)&&propagateSuspenseContextChange(workInProgress,workInProgress.child,renderExpirationTime),suspenseContext=setDefaultShallowSuspenseContext(suspenseContext));if(pushSuspenseContext(workInProgress,suspenseContext),0==(2&workInProgress.mode))workInProgress.memoizedState=null;else switch(revealOrder){case"forwards":var lastContentRow=findLastContentRow(workInProgress.child),tail;null===lastContentRow?(tail=workInProgress.child,workInProgress.child=null):(tail=lastContentRow.sibling,lastContentRow.sibling=null),initSuspenseListRenderState(workInProgress,!1,tail,lastContentRow,tailMode,workInProgress.lastEffect);break;case"backwards":var _tail=null,row=workInProgress.child;for(workInProgress.child=null;null!==row;){var currentRow=row.alternate;if(null!==currentRow&&null===findFirstSuspended(currentRow)){workInProgress.child=row;break}var nextRow=row.sibling;row.sibling=_tail,_tail=row,row=nextRow}initSuspenseListRenderState(workInProgress,!0,_tail,null,tailMode,workInProgress.lastEffect);break;case"together":initSuspenseListRenderState(workInProgress,!1,null,null,void 0,workInProgress.lastEffect);break;default:workInProgress.memoizedState=null}return workInProgress.child}function updatePortalComponent(current,workInProgress,renderExpirationTime){pushHostContainer(workInProgress,workInProgress.stateNode.containerInfo);var nextChildren=workInProgress.pendingProps;return null===current?workInProgress.child=reconcileChildFibers(workInProgress,null,nextChildren,renderExpirationTime):reconcileChildren(current,workInProgress,nextChildren,renderExpirationTime),workInProgress.child}function updateContextProvider(current,workInProgress,renderExpirationTime){var providerType,context=workInProgress.type._context,newProps=workInProgress.pendingProps,oldProps=workInProgress.memoizedProps,newValue=newProps.value,providerPropTypes=workInProgress.type.propTypes,newChildren;if(providerPropTypes&&checkPropTypes(providerPropTypes,newProps,"prop","Context.Provider",getCurrentFiberStackInDev),pushProvider(workInProgress,newValue),null!==oldProps){var oldValue,changedBits=calculateChangedBits(context,newValue,oldProps.value);if(0===changedBits){if(oldProps.children===newProps.children&&!hasContextChanged())return bailoutOnAlreadyFinishedWork(current,workInProgress,renderExpirationTime)}else propagateContextChange(workInProgress,context,changedBits,renderExpirationTime)}return reconcileChildren(current,workInProgress,newProps.children,renderExpirationTime),workInProgress.child}var hasWarnedAboutUsingContextAsConsumer=!1,appendAllChildren,updateHostContainer,updateHostComponent$1,updateHostText$1;function updateContextConsumer(current,workInProgress,renderExpirationTime){var context=workInProgress.type;void 0===context._context?context!==context.Consumer&&(hasWarnedAboutUsingContextAsConsumer||(hasWarnedAboutUsingContextAsConsumer=!0,error("Rendering <Context> directly is not supported and will be removed in a future major release. Did you mean to render <Context.Consumer> instead?"))):context=context._context;var newProps=workInProgress.pendingProps,render=newProps.children;"function"!=typeof render&&error("A context consumer was rendered with multiple children, or a child that isn't a function. A context consumer expects a single child that is a function. If you did pass a function, make sure there is no trailing or leading whitespace around it."),prepareToReadContext(workInProgress,renderExpirationTime);var newValue=readContext(context,newProps.unstable_observedBits),newChildren;return ReactCurrentOwner$1.current=workInProgress,setIsRendering(!0),newChildren=render(newValue),setIsRendering(!1),workInProgress.effectTag|=1,reconcileChildren(current,workInProgress,newChildren,renderExpirationTime),workInProgress.child}function markWorkInProgressReceivedUpdate(){didReceiveUpdate=!0}function bailoutOnAlreadyFinishedWork(current,workInProgress,renderExpirationTime){cancelWorkTimer(workInProgress),null!==current&&(workInProgress.dependencies=current.dependencies),stopProfilerTimerIfRunning();var updateExpirationTime=workInProgress.expirationTime,childExpirationTime;return 0!==updateExpirationTime&&markUnprocessedUpdateTime(updateExpirationTime),workInProgress.childExpirationTime<renderExpirationTime?null:(cloneChildFibers(current,workInProgress),workInProgress.child)}function remountFiber(current,oldWorkInProgress,newWorkInProgress){var returnFiber=oldWorkInProgress.return;if(null===returnFiber)throw new Error("Cannot swap the root fiber.");if(current.alternate=null,oldWorkInProgress.alternate=null,newWorkInProgress.index=oldWorkInProgress.index,newWorkInProgress.sibling=oldWorkInProgress.sibling,newWorkInProgress.return=oldWorkInProgress.return,newWorkInProgress.ref=oldWorkInProgress.ref,oldWorkInProgress===returnFiber.child)returnFiber.child=newWorkInProgress;else{var prevSibling=returnFiber.child;if(null===prevSibling)throw new Error("Expected parent to have a child.");for(;prevSibling.sibling!==oldWorkInProgress;)if(null===(prevSibling=prevSibling.sibling))throw new Error("Expected to find the previous sibling.");prevSibling.sibling=newWorkInProgress}var last=returnFiber.lastEffect;return null!==last?(last.nextEffect=current,returnFiber.lastEffect=current):returnFiber.firstEffect=returnFiber.lastEffect=current,current.nextEffect=null,current.effectTag=8,newWorkInProgress.effectTag|=2,newWorkInProgress}function beginWork(current,workInProgress,renderExpirationTime){var updateExpirationTime=workInProgress.expirationTime;if(workInProgress._debugNeedsRemount&&null!==current)return remountFiber(current,workInProgress,createFiberFromTypeAndProps(workInProgress.type,workInProgress.key,workInProgress.pendingProps,workInProgress._debugOwner||null,workInProgress.mode,workInProgress.expirationTime));if(null!==current){var oldProps=current.memoizedProps,newProps=workInProgress.pendingProps;if(oldProps!==newProps||hasContextChanged()||workInProgress.type!==current.type)didReceiveUpdate=!0;else{if(updateExpirationTime<renderExpirationTime){switch(didReceiveUpdate=!1,workInProgress.tag){case 3:pushHostRootContext(workInProgress),resetHydrationState();break;case 5:if(pushHostContext(workInProgress),4&workInProgress.mode&&1!==renderExpirationTime&&shouldDeprioritizeSubtree(workInProgress.type,newProps))return markSpawnedWork(1),workInProgress.expirationTime=workInProgress.childExpirationTime=1,null;break;case 1:var Component;isContextProvider(workInProgress.type)&&pushContextProvider(workInProgress);break;case 4:pushHostContainer(workInProgress,workInProgress.stateNode.containerInfo);break;case 10:var newValue;pushProvider(workInProgress,workInProgress.memoizedProps.value);break;case 12:var hasChildWork;workInProgress.childExpirationTime>=renderExpirationTime&&(workInProgress.effectTag|=4);break;case 13:var state;if(null!==workInProgress.memoizedState){var primaryChildFragment,primaryChildExpirationTime=workInProgress.child.childExpirationTime;if(0!==primaryChildExpirationTime&&primaryChildExpirationTime>=renderExpirationTime)return updateSuspenseComponent(current,workInProgress,renderExpirationTime);pushSuspenseContext(workInProgress,setDefaultShallowSuspenseContext(suspenseStackCursor.current));var child=bailoutOnAlreadyFinishedWork(current,workInProgress,renderExpirationTime);return null!==child?child.sibling:null}pushSuspenseContext(workInProgress,setDefaultShallowSuspenseContext(suspenseStackCursor.current));break;case 19:var didSuspendBefore=0!=(64&current.effectTag),_hasChildWork=workInProgress.childExpirationTime>=renderExpirationTime;if(didSuspendBefore){if(_hasChildWork)return updateSuspenseListComponent(current,workInProgress,renderExpirationTime);workInProgress.effectTag|=64}var renderState=workInProgress.memoizedState;if(null!==renderState&&(renderState.rendering=null,renderState.tail=null),pushSuspenseContext(workInProgress,suspenseStackCursor.current),_hasChildWork)break;return null}return bailoutOnAlreadyFinishedWork(current,workInProgress,renderExpirationTime)}didReceiveUpdate=!1}}else didReceiveUpdate=!1;switch(workInProgress.expirationTime=0,workInProgress.tag){case 2:return mountIndeterminateComponent(current,workInProgress,workInProgress.type,renderExpirationTime);case 16:var elementType;return mountLazyComponent(current,workInProgress,workInProgress.elementType,updateExpirationTime,renderExpirationTime);case 0:var _Component=workInProgress.type,unresolvedProps=workInProgress.pendingProps,resolvedProps;return updateFunctionComponent(current,workInProgress,_Component,workInProgress.elementType===_Component?unresolvedProps:resolveDefaultProps(_Component,unresolvedProps),renderExpirationTime);case 1:var _Component2=workInProgress.type,_unresolvedProps=workInProgress.pendingProps,_resolvedProps;return updateClassComponent(current,workInProgress,_Component2,workInProgress.elementType===_Component2?_unresolvedProps:resolveDefaultProps(_Component2,_unresolvedProps),renderExpirationTime);case 3:return updateHostRoot(current,workInProgress,renderExpirationTime);case 5:return updateHostComponent(current,workInProgress,renderExpirationTime);case 6:return updateHostText(current,workInProgress);case 13:return updateSuspenseComponent(current,workInProgress,renderExpirationTime);case 4:return updatePortalComponent(current,workInProgress,renderExpirationTime);case 11:var type=workInProgress.type,_unresolvedProps2=workInProgress.pendingProps,_resolvedProps2;return updateForwardRef(current,workInProgress,type,workInProgress.elementType===type?_unresolvedProps2:resolveDefaultProps(type,_unresolvedProps2),renderExpirationTime);case 7:return updateFragment(current,workInProgress,renderExpirationTime);case 8:return updateMode(current,workInProgress,renderExpirationTime);case 12:return updateProfiler(current,workInProgress,renderExpirationTime);case 10:return updateContextProvider(current,workInProgress,renderExpirationTime);case 9:return updateContextConsumer(current,workInProgress,renderExpirationTime);case 14:var _type2=workInProgress.type,_unresolvedProps3,_resolvedProps3=resolveDefaultProps(_type2,workInProgress.pendingProps);if(workInProgress.type!==workInProgress.elementType){var outerPropTypes=_type2.propTypes;outerPropTypes&&checkPropTypes(outerPropTypes,_resolvedProps3,"prop",getComponentName(_type2),getCurrentFiberStackInDev)}return updateMemoComponent(current,workInProgress,_type2,_resolvedProps3=resolveDefaultProps(_type2.type,_resolvedProps3),updateExpirationTime,renderExpirationTime);case 15:return updateSimpleMemoComponent(current,workInProgress,workInProgress.type,workInProgress.pendingProps,updateExpirationTime,renderExpirationTime);case 17:var _Component3=workInProgress.type,_unresolvedProps4=workInProgress.pendingProps,_resolvedProps4;return mountIncompleteClassComponent(current,workInProgress,_Component3,workInProgress.elementType===_Component3?_unresolvedProps4:resolveDefaultProps(_Component3,_unresolvedProps4),renderExpirationTime);case 19:return updateSuspenseListComponent(current,workInProgress,renderExpirationTime)}throw Error("Unknown unit of work tag ("+workInProgress.tag+"). This error is likely caused by a bug in React. Please file an issue.")}function markUpdate(workInProgress){workInProgress.effectTag|=4}function markRef$1(workInProgress){workInProgress.effectTag|=128}function cutOffTailIfNeeded(renderState,hasRenderedATailFallback){switch(renderState.tailMode){case"hidden":for(var tailNode=renderState.tail,lastTailNode=null;null!==tailNode;)null!==tailNode.alternate&&(lastTailNode=tailNode),tailNode=tailNode.sibling;null===lastTailNode?renderState.tail=null:lastTailNode.sibling=null;break;case"collapsed":for(var _tailNode=renderState.tail,_lastTailNode=null;null!==_tailNode;)null!==_tailNode.alternate&&(_lastTailNode=_tailNode),_tailNode=_tailNode.sibling;null===_lastTailNode?hasRenderedATailFallback||null===renderState.tail?renderState.tail=null:renderState.tail.sibling=null:_lastTailNode.sibling=null}}function completeWork(current,workInProgress,renderExpirationTime){var newProps=workInProgress.pendingProps;switch(workInProgress.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:var Component;return isContextProvider(workInProgress.type)&&popContext(workInProgress),null;case 3:popHostContainer(workInProgress),popTopLevelContextObject(workInProgress);var fiberRoot=workInProgress.stateNode,wasHydrated;if(fiberRoot.pendingContext&&(fiberRoot.context=fiberRoot.pendingContext,fiberRoot.pendingContext=null),null===current||null===current.child)popHydrationState(workInProgress)&&markUpdate(workInProgress);return null;case 5:popHostContext(workInProgress);var rootContainerInstance=getRootHostContainer(),type=workInProgress.type;if(null!==current&&null!=workInProgress.stateNode)updateHostComponent$1(current,workInProgress,type,newProps,rootContainerInstance),current.ref!==workInProgress.ref&&markRef$1(workInProgress);else{if(!newProps){if(null===workInProgress.stateNode)throw Error("We must have new props for new mounts. This error is likely caused by a bug in React. Please file an issue.");return null}var currentHostContext=getHostContext(),_wasHydrated;if(popHydrationState(workInProgress))prepareToHydrateHostInstance(workInProgress,rootContainerInstance,currentHostContext)&&markUpdate(workInProgress);else{var instance=createInstance(type,newProps,rootContainerInstance,currentHostContext,workInProgress);appendAllChildren(instance,workInProgress,!1,!1),workInProgress.stateNode=instance,finalizeInitialChildren(instance,type,newProps,rootContainerInstance)&&markUpdate(workInProgress)}null!==workInProgress.ref&&markRef$1(workInProgress)}return null;case 6:var newText=newProps;if(current&&null!=workInProgress.stateNode){var oldText=current.memoizedProps;updateHostText$1(current,workInProgress,oldText,newText)}else{if("string"!=typeof newText&&null===workInProgress.stateNode)throw Error("We must have new props for new mounts. This error is likely caused by a bug in React. Please file an issue.");var _rootContainerInstance=getRootHostContainer(),_currentHostContext=getHostContext(),_wasHydrated2;popHydrationState(workInProgress)?prepareToHydrateHostTextInstance(workInProgress)&&markUpdate(workInProgress):workInProgress.stateNode=createTextInstance(newText,_rootContainerInstance,_currentHostContext,workInProgress)}return null;case 13:popSuspenseContext(workInProgress);var nextState=workInProgress.memoizedState;if(0!=(64&workInProgress.effectTag))return workInProgress.expirationTime=renderExpirationTime,workInProgress;var nextDidTimeout=null!==nextState,prevDidTimeout=!1,hasInvisibleChildContext;if(null===current)void 0!==workInProgress.memoizedProps.fallback&&popHydrationState(workInProgress);else{var prevState=current.memoizedState;if(prevDidTimeout=null!==prevState,!nextDidTimeout&&null!==prevState){var currentFallbackChild=current.child.sibling;if(null!==currentFallbackChild){var first=workInProgress.firstEffect;null!==first?(workInProgress.firstEffect=currentFallbackChild,currentFallbackChild.nextEffect=first):(workInProgress.firstEffect=workInProgress.lastEffect=currentFallbackChild,currentFallbackChild.nextEffect=null),currentFallbackChild.effectTag=8}}}if(nextDidTimeout&&!prevDidTimeout)if(0!=(2&workInProgress.mode))null===current&&!0!==workInProgress.memoizedProps.unstable_avoidThisFallback||hasSuspenseContext(suspenseStackCursor.current,1)?renderDidSuspend():renderDidSuspendDelayIfPossible();return(nextDidTimeout||prevDidTimeout)&&(workInProgress.effectTag|=4),null;case 4:return popHostContainer(workInProgress),null;case 10:return popProvider(workInProgress),null;case 17:var _Component;return isContextProvider(workInProgress.type)&&popContext(workInProgress),null;case 19:popSuspenseContext(workInProgress);var renderState=workInProgress.memoizedState;if(null===renderState)return null;var didSuspendAlready=0!=(64&workInProgress.effectTag),renderedTail=renderState.rendering;if(null===renderedTail){var cannotBeSuspended;if(didSuspendAlready)cutOffTailIfNeeded(renderState,!1);else if(!(renderHasNotSuspendedYet()&&(null===current||0==(64&current.effectTag))))for(var row=workInProgress.child;null!==row;){var suspended=findFirstSuspended(row);if(null!==suspended){didSuspendAlready=!0,workInProgress.effectTag|=64,cutOffTailIfNeeded(renderState,!1);var newThennables=suspended.updateQueue;return null!==newThennables&&(workInProgress.updateQueue=newThennables,workInProgress.effectTag|=4),null===renderState.lastEffect&&(workInProgress.firstEffect=null),workInProgress.lastEffect=renderState.lastEffect,resetChildFibers(workInProgress,renderExpirationTime),pushSuspenseContext(workInProgress,setShallowSuspenseContext(suspenseStackCursor.current,2)),workInProgress.child}row=row.sibling}}else{if(!didSuspendAlready){var _suspended=findFirstSuspended(renderedTail);if(null!==_suspended){workInProgress.effectTag|=64,didSuspendAlready=!0;var _newThennables=_suspended.updateQueue;if(null!==_newThennables&&(workInProgress.updateQueue=_newThennables,workInProgress.effectTag|=4),cutOffTailIfNeeded(renderState,!0),null===renderState.tail&&"hidden"===renderState.tailMode&&!renderedTail.alternate){var lastEffect=workInProgress.lastEffect=renderState.lastEffect;return null!==lastEffect&&(lastEffect.nextEffect=null),null}}else if(2*now()-renderState.renderingStartTime>renderState.tailExpiration&&renderExpirationTime>1){workInProgress.effectTag|=64,didSuspendAlready=!0,cutOffTailIfNeeded(renderState,!1);var nextPriority=renderExpirationTime-1;workInProgress.expirationTime=workInProgress.childExpirationTime=nextPriority,markSpawnedWork(nextPriority)}}if(renderState.isBackwards)renderedTail.sibling=workInProgress.child,workInProgress.child=renderedTail;else{var previousSibling=renderState.last;null!==previousSibling?previousSibling.sibling=renderedTail:workInProgress.child=renderedTail,renderState.last=renderedTail}}if(null!==renderState.tail){if(0===renderState.tailExpiration){var TAIL_EXPIRATION_TIMEOUT_MS=500;renderState.tailExpiration=now()+500}var next=renderState.tail;renderState.rendering=next,renderState.tail=next.sibling,renderState.lastEffect=workInProgress.lastEffect,renderState.renderingStartTime=now(),next.sibling=null;var suspenseContext=suspenseStackCursor.current;return pushSuspenseContext(workInProgress,suspenseContext=didSuspendAlready?setShallowSuspenseContext(suspenseContext,2):setDefaultShallowSuspenseContext(suspenseContext)),next}return null}throw Error("Unknown unit of work tag ("+workInProgress.tag+"). This error is likely caused by a bug in React. Please file an issue.")}function unwindWork(workInProgress,renderExpirationTime){switch(workInProgress.tag){case 1:var Component;isContextProvider(workInProgress.type)&&popContext(workInProgress);var effectTag=workInProgress.effectTag;return 4096&effectTag?(workInProgress.effectTag=-4097&effectTag|64,workInProgress):null;case 3:popHostContainer(workInProgress),popTopLevelContextObject(workInProgress);var _effectTag=workInProgress.effectTag;if(0!=(64&_effectTag))throw Error("The root failed to unmount after an error. This is likely a bug in React. Please file an issue.");return workInProgress.effectTag=-4097&_effectTag|64,workInProgress;case 5:return popHostContext(workInProgress),null;case 13:popSuspenseContext(workInProgress);var _effectTag2=workInProgress.effectTag;return 4096&_effectTag2?(workInProgress.effectTag=-4097&_effectTag2|64,workInProgress):null;case 19:return popSuspenseContext(workInProgress),null;case 4:return popHostContainer(workInProgress),null;case 10:return popProvider(workInProgress),null;default:return null}}function unwindInterruptedWork(interruptedWork){switch(interruptedWork.tag){case 1:var childContextTypes=interruptedWork.type.childContextTypes;null!=childContextTypes&&popContext(interruptedWork);break;case 3:popHostContainer(interruptedWork),popTopLevelContextObject(interruptedWork);break;case 5:popHostContext(interruptedWork);break;case 4:popHostContainer(interruptedWork);break;case 13:case 19:popSuspenseContext(interruptedWork);break;case 10:popProvider(interruptedWork)}}function createCapturedValue(value,source){return{value:value,source:source,stack:getStackByFiberInDevAndProd(source)}}function logCapturedError(capturedError){var error=capturedError.error,componentName=capturedError.componentName,componentStack=capturedError.componentStack,errorBoundaryName=capturedError.errorBoundaryName,errorBoundaryFound=capturedError.errorBoundaryFound,willRetry=capturedError.willRetry,componentNameMessage,errorBoundaryMessage;if(null!=error&&error._suppressLogging){if(errorBoundaryFound&&willRetry)return;console.error(error)}var combinedMessage=""+(componentName?"The above error occurred in the <"+componentName+"> component:":"The above error occurred in one of your React components:")+componentStack+"\n\n"+(errorBoundaryMessage=errorBoundaryFound&&errorBoundaryName?willRetry?"React will try to recreate this component tree from scratch using the error boundary you provided, "+errorBoundaryName+".":"This error was initially handled by the error boundary "+errorBoundaryName+".\nRecreating the tree from scratch failed so React will unmount the tree.":"Consider adding an error boundary to your tree to customize error handling behavior.\nVisit https://fb.me/react-error-boundaries to learn more about error boundaries.");console.error(combinedMessage)}appendAllChildren=function(parent,workInProgress,needsVisibilityToggle,isHidden){for(var node=workInProgress.child;null!==node;){if(5===node.tag||6===node.tag)appendInitialChild(parent,node.stateNode);else if(4===node.tag);else if(null!==node.child){node.child.return=node,node=node.child;continue}if(node===workInProgress)return;for(;null===node.sibling;){if(null===node.return||node.return===workInProgress)return;node=node.return}node.sibling.return=node.return,node=node.sibling}},updateHostContainer=function(workInProgress){},updateHostComponent$1=function(current,workInProgress,type,newProps,rootContainerInstance){var oldProps=current.memoizedProps;if(oldProps!==newProps){var instance,currentHostContext,updatePayload=prepareUpdate(workInProgress.stateNode,type,oldProps,newProps,rootContainerInstance,getHostContext());workInProgress.updateQueue=updatePayload,updatePayload&&markUpdate(workInProgress)}},updateHostText$1=function(current,workInProgress,oldText,newText){oldText!==newText&&markUpdate(workInProgress)};var didWarnAboutUndefinedSnapshotBeforeUpdate=null;didWarnAboutUndefinedSnapshotBeforeUpdate=new Set;var PossiblyWeakSet="function"==typeof WeakSet?WeakSet:Set;function logError(boundary,errorInfo){var source=errorInfo.source,stack=errorInfo.stack;null===stack&&null!==source&&(stack=getStackByFiberInDevAndProd(source));var capturedError={componentName:null!==source?getComponentName(source.type):null,componentStack:null!==stack?stack:"",error:errorInfo.value,errorBoundary:null,errorBoundaryName:null,errorBoundaryFound:!1,willRetry:!1};null!==boundary&&1===boundary.tag&&(capturedError.errorBoundary=boundary.stateNode,capturedError.errorBoundaryName=getComponentName(boundary.type),capturedError.errorBoundaryFound=!0,capturedError.willRetry=!0);try{logCapturedError(capturedError)}catch(e){setTimeout((function(){throw e}))}}var callComponentWillUnmountWithTimer=function(current,instance){startPhaseTimer(current,"componentWillUnmount"),instance.props=current.memoizedProps,instance.state=current.memoizedState,instance.componentWillUnmount(),stopPhaseTimer()};function safelyCallComponentWillUnmount(current,instance){var unmountError;(invokeGuardedCallback(null,callComponentWillUnmountWithTimer,null,current,instance),hasCaughtError())&&captureCommitPhaseError(current,clearCaughtError())}function safelyDetachRef(current){var ref=current.ref,refError;null!==ref&&("function"==typeof ref?(invokeGuardedCallback(null,ref,null,null),hasCaughtError()&&captureCommitPhaseError(current,clearCaughtError())):ref.current=null)}function safelyCallDestroy(current,destroy){var error;(invokeGuardedCallback(null,destroy,null),hasCaughtError())&&captureCommitPhaseError(current,clearCaughtError())}function commitBeforeMutationLifeCycles(current,finishedWork){switch(finishedWork.tag){case 0:case 11:case 15:case 22:return;case 1:if(256&finishedWork.effectTag&&null!==current){var prevProps=current.memoizedProps,prevState=current.memoizedState;startPhaseTimer(finishedWork,"getSnapshotBeforeUpdate");var instance=finishedWork.stateNode;finishedWork.type!==finishedWork.elementType||didWarnAboutReassigningProps||(instance.props!==finishedWork.memoizedProps&&error("Expected %s props to match memoized props before getSnapshotBeforeUpdate. This might either be because of a bug in React, or because a component reassigns its own `this.props`. Please file an issue.",getComponentName(finishedWork.type)||"instance"),instance.state!==finishedWork.memoizedState&&error("Expected %s state to match memoized state before getSnapshotBeforeUpdate. This might either be because of a bug in React, or because a component reassigns its own `this.props`. Please file an issue.",getComponentName(finishedWork.type)||"instance"));var snapshot=instance.getSnapshotBeforeUpdate(finishedWork.elementType===finishedWork.type?prevProps:resolveDefaultProps(finishedWork.type,prevProps),prevState),didWarnSet=didWarnAboutUndefinedSnapshotBeforeUpdate;void 0!==snapshot||didWarnSet.has(finishedWork.type)||(didWarnSet.add(finishedWork.type),error("%s.getSnapshotBeforeUpdate(): A snapshot value (or null) must be returned. You have returned undefined.",getComponentName(finishedWork.type))),instance.__reactInternalSnapshotBeforeUpdate=snapshot,stopPhaseTimer()}return;case 3:case 5:case 6:case 4:case 17:return}throw Error("This unit of work tag should not have side-effects. This error is likely caused by a bug in React. Please file an issue.")}function commitHookEffectListUnmount(tag,finishedWork){var updateQueue=finishedWork.updateQueue,lastEffect=null!==updateQueue?updateQueue.lastEffect:null;if(null!==lastEffect){var firstEffect=lastEffect.next,effect=firstEffect;do{if((effect.tag&tag)===tag){var destroy=effect.destroy;effect.destroy=void 0,void 0!==destroy&&destroy()}effect=effect.next}while(effect!==firstEffect)}}function commitHookEffectListMount(tag,finishedWork){var updateQueue=finishedWork.updateQueue,lastEffect=null!==updateQueue?updateQueue.lastEffect:null;if(null!==lastEffect){var firstEffect=lastEffect.next,effect=firstEffect;do{if((effect.tag&tag)===tag){var create=effect.create;effect.destroy=create();var destroy=effect.destroy;if(void 0!==destroy&&"function"!=typeof destroy){var addendum=void 0;error("An effect function must not return anything besides a function, which is used for clean-up.%s%s",addendum=null===destroy?" You returned null. If your effect does not require clean up, return undefined (or nothing).":"function"==typeof destroy.then?"\n\nIt looks like you wrote useEffect(async () => ...) or returned a Promise. Instead, write the async function inside your effect and call it immediately:\n\nuseEffect(() => {\n  async function fetchData() {\n    // You can await here\n    const response = await MyAPI.getData(someId);\n    // ...\n  }\n  fetchData();\n}, [someId]); // Or [] if effect doesn't need props or state\n\nLearn more about data fetching with Hooks: https://fb.me/react-hooks-data-fetching":" You returned: "+destroy,getStackByFiberInDevAndProd(finishedWork))}}effect=effect.next}while(effect!==firstEffect)}}function commitPassiveHookEffects(finishedWork){if(0!=(512&finishedWork.effectTag))switch(finishedWork.tag){case 0:case 11:case 15:case 22:commitHookEffectListUnmount(5,finishedWork),commitHookEffectListMount(5,finishedWork)}}function commitLifeCycles(finishedRoot,current,finishedWork,committedExpirationTime){switch(finishedWork.tag){case 0:case 11:case 15:case 22:return void commitHookEffectListMount(3,finishedWork);case 1:var instance=finishedWork.stateNode;if(4&finishedWork.effectTag)if(null===current)startPhaseTimer(finishedWork,"componentDidMount"),finishedWork.type!==finishedWork.elementType||didWarnAboutReassigningProps||(instance.props!==finishedWork.memoizedProps&&error("Expected %s props to match memoized props before componentDidMount. This might either be because of a bug in React, or because a component reassigns its own `this.props`. Please file an issue.",getComponentName(finishedWork.type)||"instance"),instance.state!==finishedWork.memoizedState&&error("Expected %s state to match memoized state before componentDidMount. This might either be because of a bug in React, or because a component reassigns its own `this.props`. Please file an issue.",getComponentName(finishedWork.type)||"instance")),instance.componentDidMount(),stopPhaseTimer();else{var prevProps=finishedWork.elementType===finishedWork.type?current.memoizedProps:resolveDefaultProps(finishedWork.type,current.memoizedProps),prevState=current.memoizedState;startPhaseTimer(finishedWork,"componentDidUpdate"),finishedWork.type!==finishedWork.elementType||didWarnAboutReassigningProps||(instance.props!==finishedWork.memoizedProps&&error("Expected %s props to match memoized props before componentDidUpdate. This might either be because of a bug in React, or because a component reassigns its own `this.props`. Please file an issue.",getComponentName(finishedWork.type)||"instance"),instance.state!==finishedWork.memoizedState&&error("Expected %s state to match memoized state before componentDidUpdate. This might either be because of a bug in React, or because a component reassigns its own `this.props`. Please file an issue.",getComponentName(finishedWork.type)||"instance")),instance.componentDidUpdate(prevProps,prevState,instance.__reactInternalSnapshotBeforeUpdate),stopPhaseTimer()}var updateQueue=finishedWork.updateQueue;return void(null!==updateQueue&&(finishedWork.type!==finishedWork.elementType||didWarnAboutReassigningProps||(instance.props!==finishedWork.memoizedProps&&error("Expected %s props to match memoized props before processing the update queue. This might either be because of a bug in React, or because a component reassigns its own `this.props`. Please file an issue.",getComponentName(finishedWork.type)||"instance"),instance.state!==finishedWork.memoizedState&&error("Expected %s state to match memoized state before processing the update queue. This might either be because of a bug in React, or because a component reassigns its own `this.props`. Please file an issue.",getComponentName(finishedWork.type)||"instance")),commitUpdateQueue(finishedWork,updateQueue,instance)));case 3:var _updateQueue=finishedWork.updateQueue;if(null!==_updateQueue){var _instance=null;if(null!==finishedWork.child)switch(finishedWork.child.tag){case 5:case 1:_instance=finishedWork.child.stateNode}commitUpdateQueue(finishedWork,_updateQueue,_instance)}return;case 5:var _instance2=finishedWork.stateNode,type,props;if(null===current&&4&finishedWork.effectTag)commitMount(_instance2,finishedWork.type,finishedWork.memoizedProps);return;case 6:case 4:return;case 12:var onRender=finishedWork.memoizedProps.onRender;return void("function"==typeof onRender&&onRender(finishedWork.memoizedProps.id,null===current?"mount":"update",finishedWork.actualDuration,finishedWork.treeBaseDuration,finishedWork.actualStartTime,getCommitTime(),finishedRoot.memoizedInteractions));case 13:return void commitSuspenseHydrationCallbacks(finishedRoot,finishedWork);case 19:case 17:case 20:case 21:return}throw Error("This unit of work tag should not have side-effects. This error is likely caused by a bug in React. Please file an issue.")}function hideOrUnhideAllChildren(finishedWork,isHidden){for(var node=finishedWork;;){if(5===node.tag){var instance=node.stateNode;isHidden?hideInstance(instance):unhideInstance(node.stateNode,node.memoizedProps)}else if(6===node.tag){var _instance3=node.stateNode;isHidden?hideTextInstance(_instance3):unhideTextInstance(_instance3,node.memoizedProps)}else{if(13===node.tag&&null!==node.memoizedState&&null===node.memoizedState.dehydrated){var fallbackChildFragment=node.child.sibling;fallbackChildFragment.return=node,node=fallbackChildFragment;continue}if(null!==node.child){node.child.return=node,node=node.child;continue}}if(node===finishedWork)return;for(;null===node.sibling;){if(null===node.return||node.return===finishedWork)return;node=node.return}node.sibling.return=node.return,node=node.sibling}}function commitAttachRef(finishedWork){var ref=finishedWork.ref;if(null!==ref){var instance=finishedWork.stateNode,instanceToUse;switch(finishedWork.tag){case 5:instanceToUse=instance;break;default:instanceToUse=instance}"function"==typeof ref?ref(instanceToUse):(ref.hasOwnProperty("current")||error("Unexpected ref object provided for %s. Use either a ref-setter function or React.createRef().%s",getComponentName(finishedWork.type),getStackByFiberInDevAndProd(finishedWork)),ref.current=instanceToUse)}}function commitDetachRef(current){var currentRef=current.ref;null!==currentRef&&("function"==typeof currentRef?currentRef(null):currentRef.current=null)}function commitUnmount(finishedRoot,current,renderPriorityLevel){switch(onCommitUnmount(current),current.tag){case 0:case 11:case 14:case 15:case 22:var updateQueue=current.updateQueue;if(null!==updateQueue){var lastEffect=updateQueue.lastEffect;if(null!==lastEffect){var firstEffect=lastEffect.next,priorityLevel;runWithPriority$1(renderPriorityLevel>97?97:renderPriorityLevel,(function(){var effect=firstEffect;do{var _destroy=effect.destroy;void 0!==_destroy&&safelyCallDestroy(current,_destroy),effect=effect.next}while(effect!==firstEffect)}))}}return;case 1:safelyDetachRef(current);var instance=current.stateNode;return void("function"==typeof instance.componentWillUnmount&&safelyCallComponentWillUnmount(current,instance));case 5:return void safelyDetachRef(current);case 4:return void unmountHostComponents(finishedRoot,current,renderPriorityLevel);case 20:case 18:case 21:return}}function commitNestedUnmounts(finishedRoot,root,renderPriorityLevel){for(var node=root;;)if(commitUnmount(finishedRoot,node,renderPriorityLevel),null===node.child||4===node.tag){if(node===root)return;for(;null===node.sibling;){if(null===node.return||node.return===root)return;node=node.return}node.sibling.return=node.return,node=node.sibling}else node.child.return=node,node=node.child}function detachFiber(current){var alternate=current.alternate;current.return=null,current.child=null,current.memoizedState=null,current.updateQueue=null,current.dependencies=null,current.alternate=null,current.firstEffect=null,current.lastEffect=null,current.pendingProps=null,current.memoizedProps=null,current.stateNode=null,null!==alternate&&detachFiber(alternate)}function getHostParentFiber(fiber){for(var parent=fiber.return;null!==parent;){if(isHostParent(parent))return parent;parent=parent.return}throw Error("Expected to find a host parent. This error is likely caused by a bug in React. Please file an issue.")}function isHostParent(fiber){return 5===fiber.tag||3===fiber.tag||4===fiber.tag}function getHostSibling(fiber){var node=fiber;siblings:for(;;){for(;null===node.sibling;){if(null===node.return||isHostParent(node.return))return null;node=node.return}for(node.sibling.return=node.return,node=node.sibling;5!==node.tag&&6!==node.tag&&18!==node.tag;){if(2&node.effectTag)continue siblings;if(null===node.child||4===node.tag)continue siblings;node.child.return=node,node=node.child}if(!(2&node.effectTag))return node.stateNode}}function commitPlacement(finishedWork){var parentFiber=getHostParentFiber(finishedWork),parent,isContainer,parentStateNode=parentFiber.stateNode;switch(parentFiber.tag){case 5:parent=parentStateNode,isContainer=!1;break;case 3:case 4:parent=parentStateNode.containerInfo,isContainer=!0;break;case 20:default:throw Error("Invalid host parent fiber. This error is likely caused by a bug in React. Please file an issue.")}16&parentFiber.effectTag&&(resetTextContent(parent),parentFiber.effectTag&=-17);var before=getHostSibling(finishedWork);isContainer?insertOrAppendPlacementNodeIntoContainer(finishedWork,before,parent):insertOrAppendPlacementNode(finishedWork,before,parent)}function insertOrAppendPlacementNodeIntoContainer(node,before,parent){var tag=node.tag,isHost=5===tag||6===tag;if(isHost){var stateNode=isHost?node.stateNode:node.stateNode.instance;before?insertInContainerBefore(parent,stateNode,before):appendChildToContainer(parent,stateNode)}else if(4===tag);else{var child=node.child;if(null!==child){insertOrAppendPlacementNodeIntoContainer(child,before,parent);for(var sibling=child.sibling;null!==sibling;)insertOrAppendPlacementNodeIntoContainer(sibling,before,parent),sibling=sibling.sibling}}}function insertOrAppendPlacementNode(node,before,parent){var tag=node.tag,isHost=5===tag||6===tag;if(isHost){var stateNode=isHost?node.stateNode:node.stateNode.instance;before?insertBefore(parent,stateNode,before):appendChild(parent,stateNode)}else if(4===tag);else{var child=node.child;if(null!==child){insertOrAppendPlacementNode(child,before,parent);for(var sibling=child.sibling;null!==sibling;)insertOrAppendPlacementNode(sibling,before,parent),sibling=sibling.sibling}}}function unmountHostComponents(finishedRoot,current,renderPriorityLevel){for(var node=current,currentParentIsValid=!1,currentParent,currentParentIsContainer;;){if(!currentParentIsValid){var parent=node.return;findParent:for(;;){if(null===parent)throw Error("Expected to find a host parent. This error is likely caused by a bug in React. Please file an issue.");var parentStateNode=parent.stateNode;switch(parent.tag){case 5:currentParent=parentStateNode,currentParentIsContainer=!1;break findParent;case 3:case 4:currentParent=parentStateNode.containerInfo,currentParentIsContainer=!0;break findParent}parent=parent.return}currentParentIsValid=!0}if(5===node.tag||6===node.tag)commitNestedUnmounts(finishedRoot,node,renderPriorityLevel),currentParentIsContainer?removeChildFromContainer(currentParent,node.stateNode):removeChild(currentParent,node.stateNode);else if(4===node.tag){if(null!==node.child){currentParent=node.stateNode.containerInfo,currentParentIsContainer=!0,node.child.return=node,node=node.child;continue}}else if(commitUnmount(finishedRoot,node,renderPriorityLevel),null!==node.child){node.child.return=node,node=node.child;continue}if(node===current)return;for(;null===node.sibling;){if(null===node.return||node.return===current)return;4===(node=node.return).tag&&(currentParentIsValid=!1)}node.sibling.return=node.return,node=node.sibling}}function commitDeletion(finishedRoot,current,renderPriorityLevel){unmountHostComponents(finishedRoot,current,renderPriorityLevel),detachFiber(current)}function commitWork(current,finishedWork){switch(finishedWork.tag){case 0:case 11:case 14:case 15:case 22:return void commitHookEffectListUnmount(3,finishedWork);case 1:return;case 5:var instance=finishedWork.stateNode;if(null!=instance){var newProps=finishedWork.memoizedProps,oldProps=null!==current?current.memoizedProps:newProps,type=finishedWork.type,updatePayload=finishedWork.updateQueue;finishedWork.updateQueue=null,null!==updatePayload&&commitUpdate(instance,updatePayload,type,oldProps,newProps)}return;case 6:if(null===finishedWork.stateNode)throw Error("This should have a text node initialized. This error is likely caused by a bug in React. Please file an issue.");var textInstance=finishedWork.stateNode,newText=finishedWork.memoizedProps,oldText;return void commitTextUpdate(textInstance,null!==current?current.memoizedProps:newText,newText);case 3:var _root=finishedWork.stateNode;return void(_root.hydrate&&(_root.hydrate=!1,commitHydratedContainer(_root.containerInfo)));case 12:return;case 13:return commitSuspenseComponent(finishedWork),void attachSuspenseRetryListeners(finishedWork);case 19:return void attachSuspenseRetryListeners(finishedWork);case 17:return}throw Error("This unit of work tag should not have side-effects. This error is likely caused by a bug in React. Please file an issue.")}function commitSuspenseComponent(finishedWork){var newState,newDidTimeout,primaryChildParent=finishedWork;null===finishedWork.memoizedState?newDidTimeout=!1:(newDidTimeout=!0,primaryChildParent=finishedWork.child,markCommitTimeOfFallback()),null!==primaryChildParent&&hideOrUnhideAllChildren(primaryChildParent,newDidTimeout)}function commitSuspenseHydrationCallbacks(finishedRoot,finishedWork){var newState;if(null===finishedWork.memoizedState){var current=finishedWork.alternate;if(null!==current){var prevState=current.memoizedState;if(null!==prevState){var suspenseInstance=prevState.dehydrated;null!==suspenseInstance&&commitHydratedSuspenseInstance(suspenseInstance)}}}}function attachSuspenseRetryListeners(finishedWork){var thenables=finishedWork.updateQueue;if(null!==thenables){finishedWork.updateQueue=null;var retryCache=finishedWork.stateNode;null===retryCache&&(retryCache=finishedWork.stateNode=new PossiblyWeakSet),thenables.forEach((function(thenable){var retry=resolveRetryThenable.bind(null,finishedWork,thenable);retryCache.has(thenable)||(!0!==thenable.__reactDoNotTraceInteractions&&(retry=tracing.unstable_wrap(retry)),retryCache.add(thenable),thenable.then(retry,retry))}))}}function commitResetTextContent(current){resetTextContent(current.stateNode)}var PossiblyWeakMap$1="function"==typeof WeakMap?WeakMap:Map;function createRootErrorUpdate(fiber,errorInfo,expirationTime){var update=createUpdate(expirationTime,null);update.tag=3,update.payload={element:null};var error=errorInfo.value;return update.callback=function(){onUncaughtError(error),logError(fiber,errorInfo)},update}function createClassErrorUpdate(fiber,errorInfo,expirationTime){var update=createUpdate(expirationTime,null);update.tag=3;var getDerivedStateFromError=fiber.type.getDerivedStateFromError;if("function"==typeof getDerivedStateFromError){var error$1=errorInfo.value;update.payload=function(){return logError(fiber,errorInfo),getDerivedStateFromError(error$1)}}var inst=fiber.stateNode;return null!==inst&&"function"==typeof inst.componentDidCatch?update.callback=function callback(){markFailedErrorBoundaryForHotReloading(fiber),"function"!=typeof getDerivedStateFromError&&(markLegacyErrorBoundaryAsFailed(this),logError(fiber,errorInfo));var error$1=errorInfo.value,stack=errorInfo.stack;this.componentDidCatch(error$1,{componentStack:null!==stack?stack:""}),"function"!=typeof getDerivedStateFromError&&fiber.expirationTime!==Sync&&error("%s: Error boundaries should implement getDerivedStateFromError(). In that method, return a state update to display an error message or fallback UI.",getComponentName(fiber.type)||"Unknown")}:update.callback=function(){markFailedErrorBoundaryForHotReloading(fiber)},update}function attachPingListener(root,renderExpirationTime,thenable){var pingCache=root.pingCache,threadIDs;if(null===pingCache?(pingCache=root.pingCache=new PossiblyWeakMap$1,threadIDs=new Set,pingCache.set(thenable,threadIDs)):void 0===(threadIDs=pingCache.get(thenable))&&(threadIDs=new Set,pingCache.set(thenable,threadIDs)),!threadIDs.has(renderExpirationTime)){threadIDs.add(renderExpirationTime);var ping=pingSuspendedRoot.bind(null,root,thenable,renderExpirationTime);thenable.then(ping,ping)}}function throwException(root,returnFiber,sourceFiber,value,renderExpirationTime){if(sourceFiber.effectTag|=2048,sourceFiber.firstEffect=sourceFiber.lastEffect=null,null!==value&&"object"==typeof value&&"function"==typeof value.then){var thenable=value;if(0==(2&sourceFiber.mode)){var currentSource=sourceFiber.alternate;currentSource?(sourceFiber.updateQueue=currentSource.updateQueue,sourceFiber.memoizedState=currentSource.memoizedState,sourceFiber.expirationTime=currentSource.expirationTime):(sourceFiber.updateQueue=null,sourceFiber.memoizedState=null)}var hasInvisibleParentBoundary=hasSuspenseContext(suspenseStackCursor.current,1),_workInProgress=returnFiber;do{if(13===_workInProgress.tag&&shouldCaptureSuspense(_workInProgress,hasInvisibleParentBoundary)){var thenables=_workInProgress.updateQueue;if(null===thenables){var updateQueue=new Set;updateQueue.add(thenable),_workInProgress.updateQueue=updateQueue}else thenables.add(thenable);if(0==(2&_workInProgress.mode)){var currentSourceFiber;if(_workInProgress.effectTag|=64,sourceFiber.effectTag&=-2981,1===sourceFiber.tag)if(null===sourceFiber.alternate)sourceFiber.tag=17;else{var update=createUpdate(Sync,null);update.tag=ForceUpdate,enqueueUpdate(sourceFiber,update)}return void(sourceFiber.expirationTime=Sync)}return attachPingListener(root,renderExpirationTime,thenable),_workInProgress.effectTag|=4096,void(_workInProgress.expirationTime=renderExpirationTime)}_workInProgress=_workInProgress.return}while(null!==_workInProgress);value=new Error((getComponentName(sourceFiber.type)||"A React component")+" suspended while rendering, but no fallback UI was specified.\n\nAdd a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display."+getStackByFiberInDevAndProd(sourceFiber))}renderDidError(),value=createCapturedValue(value,sourceFiber);var workInProgress=returnFiber;do{switch(workInProgress.tag){case 3:var _errorInfo=value,_update;return workInProgress.effectTag|=4096,workInProgress.expirationTime=renderExpirationTime,void enqueueCapturedUpdate(workInProgress,createRootErrorUpdate(workInProgress,_errorInfo,renderExpirationTime));case 1:var errorInfo=value,ctor=workInProgress.type,instance=workInProgress.stateNode,_update2;if(0==(64&workInProgress.effectTag)&&("function"==typeof ctor.getDerivedStateFromError||null!==instance&&"function"==typeof instance.componentDidCatch&&!isAlreadyFailedLegacyErrorBoundary(instance)))return workInProgress.effectTag|=4096,workInProgress.expirationTime=renderExpirationTime,void enqueueCapturedUpdate(workInProgress,createClassErrorUpdate(workInProgress,errorInfo,renderExpirationTime))}workInProgress=workInProgress.return}while(null!==workInProgress)}var ceil=Math.ceil,ReactCurrentDispatcher$1=ReactSharedInternals.ReactCurrentDispatcher,ReactCurrentOwner$2=ReactSharedInternals.ReactCurrentOwner,IsSomeRendererActing=ReactSharedInternals.IsSomeRendererActing,NoContext=0,BatchedContext=1,EventContext=2,DiscreteEventContext=4,LegacyUnbatchedContext=8,RenderContext=16,CommitContext=32,RootIncomplete=0,RootFatalErrored=1,RootErrored=2,RootSuspended=3,RootSuspendedWithDelay=4,RootCompleted=5,executionContext=0,workInProgressRoot=null,workInProgress=null,renderExpirationTime$1=0,workInProgressRootExitStatus=0,workInProgressRootFatalError=null,workInProgressRootLatestProcessedExpirationTime=Sync,workInProgressRootLatestSuspenseTimeout=Sync,workInProgressRootCanSuspendUsingConfig=null,workInProgressRootNextUnprocessedUpdateTime=0,workInProgressRootHasPendingPing=!1,globalMostRecentFallbackTime=0,FALLBACK_THROTTLE_MS=500,nextEffect=null,hasUncaughtError=!1,firstUncaughtError=null,legacyErrorBoundariesThatAlreadyFailed=null,rootDoesHavePassiveEffects=!1,rootWithPendingPassiveEffects=null,pendingPassiveEffectsRenderPriority=90,pendingPassiveEffectsExpirationTime=0,rootsWithPendingDiscreteUpdates=null,NESTED_UPDATE_LIMIT=50,nestedUpdateCount=0,rootWithNestedUpdates=null,NESTED_PASSIVE_UPDATE_LIMIT=50,nestedPassiveUpdateCount=0,interruptedBy=null,spawnedWorkDuringRender=null,currentEventTime=0;function requestCurrentTimeForUpdate(){return 0!=(48&executionContext)?msToExpirationTime(now()):0!==currentEventTime?currentEventTime:currentEventTime=msToExpirationTime(now())}function getCurrentTime(){return msToExpirationTime(now())}function computeExpirationForFiber(currentTime,fiber,suspenseConfig){var mode=fiber.mode;if(0==(2&mode))return Sync;var priorityLevel=getCurrentPriorityLevel(),expirationTime;if(0==(4&mode))return 99===priorityLevel?Sync:Batched;if(0!=(16&executionContext))return renderExpirationTime$1;if(null!==suspenseConfig)expirationTime=computeSuspenseExpiration(currentTime,0|suspenseConfig.timeoutMs||5e3);else switch(priorityLevel){case 99:expirationTime=Sync;break;case 98:expirationTime=computeInteractiveExpiration(currentTime);break;case 97:case 96:expirationTime=computeAsyncExpiration(currentTime);break;case 95:expirationTime=2;break;default:throw Error("Expected a valid priority level")}return null!==workInProgressRoot&&expirationTime===renderExpirationTime$1&&(expirationTime-=1),expirationTime}function scheduleUpdateOnFiber(fiber,expirationTime){checkForNestedUpdates(),warnAboutRenderPhaseUpdatesInDEV(fiber);var root=markUpdateTimeFromFiberToRoot(fiber,expirationTime);if(null!==root){checkForInterruption(fiber,expirationTime),recordScheduleUpdate();var priorityLevel=getCurrentPriorityLevel();if(expirationTime===Sync?0!=(8&executionContext)&&0==(48&executionContext)?(schedulePendingInteractions(root,expirationTime),performSyncWorkOnRoot(root)):(ensureRootIsScheduled(root),schedulePendingInteractions(root,expirationTime),0===executionContext&&flushSyncCallbackQueue()):(ensureRootIsScheduled(root),schedulePendingInteractions(root,expirationTime)),0!=(4&executionContext)&&(98===priorityLevel||99===priorityLevel))if(null===rootsWithPendingDiscreteUpdates)rootsWithPendingDiscreteUpdates=new Map([[root,expirationTime]]);else{var lastDiscreteTime=rootsWithPendingDiscreteUpdates.get(root);(void 0===lastDiscreteTime||lastDiscreteTime>expirationTime)&&rootsWithPendingDiscreteUpdates.set(root,expirationTime)}}else warnAboutUpdateOnUnmountedFiberInDEV(fiber)}var scheduleWork=scheduleUpdateOnFiber;function markUpdateTimeFromFiberToRoot(fiber,expirationTime){fiber.expirationTime<expirationTime&&(fiber.expirationTime=expirationTime);var alternate=fiber.alternate;null!==alternate&&alternate.expirationTime<expirationTime&&(alternate.expirationTime=expirationTime);var node=fiber.return,root=null;if(null===node&&3===fiber.tag)root=fiber.stateNode;else for(;null!==node;){if(alternate=node.alternate,node.childExpirationTime<expirationTime?(node.childExpirationTime=expirationTime,null!==alternate&&alternate.childExpirationTime<expirationTime&&(alternate.childExpirationTime=expirationTime)):null!==alternate&&alternate.childExpirationTime<expirationTime&&(alternate.childExpirationTime=expirationTime),null===node.return&&3===node.tag){root=node.stateNode;break}node=node.return}return null!==root&&(workInProgressRoot===root&&(markUnprocessedUpdateTime(expirationTime),4===workInProgressRootExitStatus&&markRootSuspendedAtTime(root,renderExpirationTime$1)),markRootUpdatedAtTime(root,expirationTime)),root}function getNextRootExpirationTimeToWorkOn(root){var lastExpiredTime=root.lastExpiredTime;if(0!==lastExpiredTime)return lastExpiredTime;var firstPendingTime=root.firstPendingTime;if(!isRootSuspendedAtTime(root,firstPendingTime))return firstPendingTime;var lastPingedTime=root.lastPingedTime,nextKnownPendingLevel=root.nextKnownPendingLevel,nextLevel=lastPingedTime>nextKnownPendingLevel?lastPingedTime:nextKnownPendingLevel;return nextLevel<=2&&firstPendingTime!==nextLevel?0:nextLevel}function ensureRootIsScheduled(root){var lastExpiredTime;if(0!==root.lastExpiredTime)return root.callbackExpirationTime=Sync,root.callbackPriority=99,void(root.callbackNode=scheduleSyncCallback(performSyncWorkOnRoot.bind(null,root)));var expirationTime=getNextRootExpirationTimeToWorkOn(root),existingCallbackNode=root.callbackNode;if(0!==expirationTime){var currentTime,priorityLevel=inferPriorityFromExpirationTime(requestCurrentTimeForUpdate(),expirationTime),callbackNode;if(null!==existingCallbackNode){var existingCallbackPriority=root.callbackPriority,existingCallbackExpirationTime;if(root.callbackExpirationTime===expirationTime&&existingCallbackPriority>=priorityLevel)return;cancelCallback(existingCallbackNode)}root.callbackExpirationTime=expirationTime,root.callbackPriority=priorityLevel,callbackNode=expirationTime===Sync?scheduleSyncCallback(performSyncWorkOnRoot.bind(null,root)):scheduleCallback(priorityLevel,performConcurrentWorkOnRoot.bind(null,root),{timeout:expirationTimeToMs(expirationTime)-now()}),root.callbackNode=callbackNode}else null!==existingCallbackNode&&(root.callbackNode=null,root.callbackExpirationTime=0,root.callbackPriority=90)}function performConcurrentWorkOnRoot(root,didTimeout){var currentTime;if(currentEventTime=0,didTimeout)return markRootExpiredAtTime(root,requestCurrentTimeForUpdate()),ensureRootIsScheduled(root),null;var expirationTime=getNextRootExpirationTimeToWorkOn(root);if(0!==expirationTime){var originalCallbackNode=root.callbackNode;if(0!=(48&executionContext))throw Error("Should not already be working.");if(flushPassiveEffects(),root===workInProgressRoot&&expirationTime===renderExpirationTime$1||(prepareFreshStack(root,expirationTime),startWorkOnPendingInteractions(root,expirationTime)),null!==workInProgress){var prevExecutionContext=executionContext;executionContext|=16;var prevDispatcher=pushDispatcher(),prevInteractions=pushInteractions(root);for(startWorkLoopTimer(workInProgress);;)try{workLoopConcurrent();break}catch(thrownValue){handleError(root,thrownValue)}if(resetContextDependencies(),executionContext=prevExecutionContext,popDispatcher(prevDispatcher),popInteractions(prevInteractions),1===workInProgressRootExitStatus){var fatalError=workInProgressRootFatalError;throw stopInterruptedWorkLoopTimer(),prepareFreshStack(root,expirationTime),markRootSuspendedAtTime(root,expirationTime),ensureRootIsScheduled(root),fatalError}if(null!==workInProgress)stopInterruptedWorkLoopTimer();else{stopFinishedWorkLoopTimer();var finishedWork=root.finishedWork=root.current.alternate;root.finishedExpirationTime=expirationTime,finishConcurrentRender(root,finishedWork,workInProgressRootExitStatus,expirationTime)}if(ensureRootIsScheduled(root),root.callbackNode===originalCallbackNode)return performConcurrentWorkOnRoot.bind(null,root)}}return null}function finishConcurrentRender(root,finishedWork,exitStatus,expirationTime){switch(workInProgressRoot=null,exitStatus){case 0:case 1:throw Error("Root did not complete. This is a bug in React.");case 2:markRootExpiredAtTime(root,expirationTime>2?2:expirationTime);break;case 3:markRootSuspendedAtTime(root,expirationTime);var lastSuspendedTime=root.lastSuspendedTime,hasNotProcessedNewUpdates;if(expirationTime===lastSuspendedTime&&(root.nextKnownPendingLevel=getRemainingExpirationTime(finishedWork)),workInProgressRootLatestProcessedExpirationTime===Sync&&!IsThisRendererActing.current){var msUntilTimeout=globalMostRecentFallbackTime+500-now();if(msUntilTimeout>10){if(workInProgressRootHasPendingPing){var lastPingedTime=root.lastPingedTime;if(0===lastPingedTime||lastPingedTime>=expirationTime){root.lastPingedTime=expirationTime,prepareFreshStack(root,expirationTime);break}}var nextTime=getNextRootExpirationTimeToWorkOn(root);if(0!==nextTime&&nextTime!==expirationTime)break;if(0!==lastSuspendedTime&&lastSuspendedTime!==expirationTime){root.lastPingedTime=lastSuspendedTime;break}root.timeoutHandle=scheduleTimeout(commitRoot.bind(null,root),msUntilTimeout);break}}commitRoot(root);break;case 4:markRootSuspendedAtTime(root,expirationTime);var _lastSuspendedTime=root.lastSuspendedTime;if(expirationTime===_lastSuspendedTime&&(root.nextKnownPendingLevel=getRemainingExpirationTime(finishedWork)),!IsThisRendererActing.current){if(workInProgressRootHasPendingPing){var _lastPingedTime=root.lastPingedTime;if(0===_lastPingedTime||_lastPingedTime>=expirationTime){root.lastPingedTime=expirationTime,prepareFreshStack(root,expirationTime);break}}var _nextTime=getNextRootExpirationTimeToWorkOn(root),_msUntilTimeout;if(0!==_nextTime&&_nextTime!==expirationTime)break;if(0!==_lastSuspendedTime&&_lastSuspendedTime!==expirationTime){root.lastPingedTime=_lastSuspendedTime;break}if(workInProgressRootLatestSuspenseTimeout!==Sync)_msUntilTimeout=expirationTimeToMs(workInProgressRootLatestSuspenseTimeout)-now();else if(workInProgressRootLatestProcessedExpirationTime===Sync)_msUntilTimeout=0;else{var eventTimeMs=inferTimeFromExpirationTime(workInProgressRootLatestProcessedExpirationTime),currentTimeMs=now(),timeUntilExpirationMs=expirationTimeToMs(expirationTime)-currentTimeMs,timeElapsed=currentTimeMs-eventTimeMs;timeElapsed<0&&(timeElapsed=0),timeUntilExpirationMs<(_msUntilTimeout=jnd(timeElapsed)-timeElapsed)&&(_msUntilTimeout=timeUntilExpirationMs)}if(_msUntilTimeout>10){root.timeoutHandle=scheduleTimeout(commitRoot.bind(null,root),_msUntilTimeout);break}}commitRoot(root);break;case 5:if(!IsThisRendererActing.current&&workInProgressRootLatestProcessedExpirationTime!==Sync&&null!==workInProgressRootCanSuspendUsingConfig){var _msUntilTimeout2=computeMsUntilSuspenseLoadingDelay(workInProgressRootLatestProcessedExpirationTime,expirationTime,workInProgressRootCanSuspendUsingConfig);if(_msUntilTimeout2>10){markRootSuspendedAtTime(root,expirationTime),root.timeoutHandle=scheduleTimeout(commitRoot.bind(null,root),_msUntilTimeout2);break}}commitRoot(root);break;default:throw Error("Unknown root exit status.")}}function performSyncWorkOnRoot(root){var lastExpiredTime=root.lastExpiredTime,expirationTime=0!==lastExpiredTime?lastExpiredTime:Sync;if(0!=(48&executionContext))throw Error("Should not already be working.");if(flushPassiveEffects(),root===workInProgressRoot&&expirationTime===renderExpirationTime$1||(prepareFreshStack(root,expirationTime),startWorkOnPendingInteractions(root,expirationTime)),null!==workInProgress){var prevExecutionContext=executionContext;executionContext|=16;var prevDispatcher=pushDispatcher(),prevInteractions=pushInteractions(root);for(startWorkLoopTimer(workInProgress);;)try{workLoopSync();break}catch(thrownValue){handleError(root,thrownValue)}if(resetContextDependencies(),executionContext=prevExecutionContext,popDispatcher(prevDispatcher),popInteractions(prevInteractions),1===workInProgressRootExitStatus){var fatalError=workInProgressRootFatalError;throw stopInterruptedWorkLoopTimer(),prepareFreshStack(root,expirationTime),markRootSuspendedAtTime(root,expirationTime),ensureRootIsScheduled(root),fatalError}if(null!==workInProgress)throw Error("Cannot commit an incomplete root. This error is likely caused by a bug in React. Please file an issue.");stopFinishedWorkLoopTimer(),root.finishedWork=root.current.alternate,root.finishedExpirationTime=expirationTime,finishSyncRender(root),ensureRootIsScheduled(root)}return null}function finishSyncRender(root){workInProgressRoot=null,commitRoot(root)}function flushDiscreteUpdates(){0==(49&executionContext)?(flushPendingDiscreteUpdates(),flushPassiveEffects()):0!=(16&executionContext)&&error("unstable_flushDiscreteUpdates: Cannot flush updates when React is already rendering.")}function syncUpdates(fn,a,b,c){return runWithPriority$1(99,fn.bind(null,a,b,c))}function flushPendingDiscreteUpdates(){if(null!==rootsWithPendingDiscreteUpdates){var roots=rootsWithPendingDiscreteUpdates;rootsWithPendingDiscreteUpdates=null,roots.forEach((function(expirationTime,root){markRootExpiredAtTime(root,expirationTime),ensureRootIsScheduled(root)})),flushSyncCallbackQueue()}}function batchedUpdates$1(fn,a){var prevExecutionContext=executionContext;executionContext|=1;try{return fn(a)}finally{0===(executionContext=prevExecutionContext)&&flushSyncCallbackQueue()}}function batchedEventUpdates$1(fn,a){var prevExecutionContext=executionContext;executionContext|=2;try{return fn(a)}finally{0===(executionContext=prevExecutionContext)&&flushSyncCallbackQueue()}}function discreteUpdates$1(fn,a,b,c,d){var prevExecutionContext=executionContext;executionContext|=4;try{return runWithPriority$1(98,fn.bind(null,a,b,c,d))}finally{0===(executionContext=prevExecutionContext)&&flushSyncCallbackQueue()}}function unbatchedUpdates(fn,a){var prevExecutionContext=executionContext;executionContext&=-2,executionContext|=8;try{return fn(a)}finally{0===(executionContext=prevExecutionContext)&&flushSyncCallbackQueue()}}function flushSync(fn,a){if(0!=(48&executionContext))throw Error("flushSync was called from inside a lifecycle method. It cannot be called when React is already rendering.");var prevExecutionContext=executionContext;executionContext|=1;try{return runWithPriority$1(99,fn.bind(null,a))}finally{executionContext=prevExecutionContext,flushSyncCallbackQueue()}}function prepareFreshStack(root,expirationTime){root.finishedWork=null,root.finishedExpirationTime=0;var timeoutHandle=root.timeoutHandle;if(-1!==timeoutHandle&&(root.timeoutHandle=-1,cancelTimeout(timeoutHandle)),null!==workInProgress)for(var interruptedWork=workInProgress.return;null!==interruptedWork;)unwindInterruptedWork(interruptedWork),interruptedWork=interruptedWork.return;workInProgressRoot=root,workInProgress=createWorkInProgress(root.current,null),renderExpirationTime$1=expirationTime,workInProgressRootExitStatus=0,workInProgressRootFatalError=null,workInProgressRootLatestProcessedExpirationTime=Sync,workInProgressRootLatestSuspenseTimeout=Sync,workInProgressRootCanSuspendUsingConfig=null,workInProgressRootNextUnprocessedUpdateTime=0,workInProgressRootHasPendingPing=!1,spawnedWorkDuringRender=null,ReactStrictModeWarnings.discardPendingWarnings()}function handleError(root,thrownValue){for(;;){try{if(resetContextDependencies(),resetHooksAfterThrow(),resetCurrentFiber(),null===workInProgress||null===workInProgress.return)return workInProgressRootExitStatus=1,workInProgressRootFatalError=thrownValue,workInProgress=null,null;8&workInProgress.mode&&stopProfilerTimerIfRunningAndRecordDelta(workInProgress,!0),throwException(root,workInProgress.return,workInProgress,thrownValue,renderExpirationTime$1),workInProgress=completeUnitOfWork(workInProgress)}catch(yetAnotherThrownValue){thrownValue=yetAnotherThrownValue;continue}return}}function pushDispatcher(root){var prevDispatcher=ReactCurrentDispatcher$1.current;return ReactCurrentDispatcher$1.current=ContextOnlyDispatcher,null===prevDispatcher?ContextOnlyDispatcher:prevDispatcher}function popDispatcher(prevDispatcher){ReactCurrentDispatcher$1.current=prevDispatcher}function pushInteractions(root){var prevInteractions=tracing.__interactionsRef.current;return tracing.__interactionsRef.current=root.memoizedInteractions,prevInteractions}function popInteractions(prevInteractions){tracing.__interactionsRef.current=prevInteractions}function markCommitTimeOfFallback(){globalMostRecentFallbackTime=now()}function markRenderEventTimeAndConfig(expirationTime,suspenseConfig){expirationTime<workInProgressRootLatestProcessedExpirationTime&&expirationTime>2&&(workInProgressRootLatestProcessedExpirationTime=expirationTime),null!==suspenseConfig&&expirationTime<workInProgressRootLatestSuspenseTimeout&&expirationTime>2&&(workInProgressRootLatestSuspenseTimeout=expirationTime,workInProgressRootCanSuspendUsingConfig=suspenseConfig)}function markUnprocessedUpdateTime(expirationTime){expirationTime>workInProgressRootNextUnprocessedUpdateTime&&(workInProgressRootNextUnprocessedUpdateTime=expirationTime)}function renderDidSuspend(){0===workInProgressRootExitStatus&&(workInProgressRootExitStatus=3)}function renderDidSuspendDelayIfPossible(){0!==workInProgressRootExitStatus&&3!==workInProgressRootExitStatus||(workInProgressRootExitStatus=4),0!==workInProgressRootNextUnprocessedUpdateTime&&null!==workInProgressRoot&&(markRootSuspendedAtTime(workInProgressRoot,renderExpirationTime$1),markRootUpdatedAtTime(workInProgressRoot,workInProgressRootNextUnprocessedUpdateTime))}function renderDidError(){5!==workInProgressRootExitStatus&&(workInProgressRootExitStatus=2)}function renderHasNotSuspendedYet(){return 0===workInProgressRootExitStatus}function inferTimeFromExpirationTime(expirationTime){var earliestExpirationTimeMs;return expirationTimeToMs(expirationTime)-5e3}function inferTimeFromExpirationTimeWithSuspenseConfig(expirationTime,suspenseConfig){var earliestExpirationTimeMs;return expirationTimeToMs(expirationTime)-(0|suspenseConfig.timeoutMs||5e3)}function workLoopSync(){for(;null!==workInProgress;)workInProgress=performUnitOfWork(workInProgress)}function workLoopConcurrent(){for(;null!==workInProgress&&!shouldYield();)workInProgress=performUnitOfWork(workInProgress)}function performUnitOfWork(unitOfWork){var current=unitOfWork.alternate,next;return startWorkTimer(unitOfWork),setCurrentFiber(unitOfWork),0!=(8&unitOfWork.mode)?(startProfilerTimer(unitOfWork),next=beginWork$1(current,unitOfWork,renderExpirationTime$1),stopProfilerTimerIfRunningAndRecordDelta(unitOfWork,!0)):next=beginWork$1(current,unitOfWork,renderExpirationTime$1),resetCurrentFiber(),unitOfWork.memoizedProps=unitOfWork.pendingProps,null===next&&(next=completeUnitOfWork(unitOfWork)),ReactCurrentOwner$2.current=null,next}function completeUnitOfWork(unitOfWork){workInProgress=unitOfWork;do{var current=workInProgress.alternate,returnFiber=workInProgress.return;if(0==(2048&workInProgress.effectTag)){setCurrentFiber(workInProgress);var next=void 0,effectTag;if(0==(8&workInProgress.mode)?next=completeWork(current,workInProgress,renderExpirationTime$1):(startProfilerTimer(workInProgress),next=completeWork(current,workInProgress,renderExpirationTime$1),stopProfilerTimerIfRunningAndRecordDelta(workInProgress,!1)),stopWorkTimer(workInProgress),resetCurrentFiber(),resetChildExpirationTime(workInProgress),null!==next)return next;if(null!==returnFiber&&0==(2048&returnFiber.effectTag))null===returnFiber.firstEffect&&(returnFiber.firstEffect=workInProgress.firstEffect),null!==workInProgress.lastEffect&&(null!==returnFiber.lastEffect&&(returnFiber.lastEffect.nextEffect=workInProgress.firstEffect),returnFiber.lastEffect=workInProgress.lastEffect),workInProgress.effectTag>1&&(null!==returnFiber.lastEffect?returnFiber.lastEffect.nextEffect=workInProgress:returnFiber.firstEffect=workInProgress,returnFiber.lastEffect=workInProgress)}else{var _next=unwindWork(workInProgress);if(0!=(8&workInProgress.mode)){stopProfilerTimerIfRunningAndRecordDelta(workInProgress,!1);for(var actualDuration=workInProgress.actualDuration,child=workInProgress.child;null!==child;)actualDuration+=child.actualDuration,child=child.sibling;workInProgress.actualDuration=actualDuration}if(null!==_next)return stopFailedWorkTimer(workInProgress),_next.effectTag&=2047,_next;stopWorkTimer(workInProgress),null!==returnFiber&&(returnFiber.firstEffect=returnFiber.lastEffect=null,returnFiber.effectTag|=2048)}var siblingFiber=workInProgress.sibling;if(null!==siblingFiber)return siblingFiber;workInProgress=returnFiber}while(null!==workInProgress);return 0===workInProgressRootExitStatus&&(workInProgressRootExitStatus=5),null}function getRemainingExpirationTime(fiber){var updateExpirationTime=fiber.expirationTime,childExpirationTime=fiber.childExpirationTime;return updateExpirationTime>childExpirationTime?updateExpirationTime:childExpirationTime}function resetChildExpirationTime(completedWork){if(1===renderExpirationTime$1||1!==completedWork.childExpirationTime){var newChildExpirationTime=0;if(0!=(8&completedWork.mode)){for(var actualDuration=completedWork.actualDuration,treeBaseDuration=completedWork.selfBaseDuration,shouldBubbleActualDurations=null===completedWork.alternate||completedWork.child!==completedWork.alternate.child,child=completedWork.child;null!==child;){var childUpdateExpirationTime=child.expirationTime,childChildExpirationTime=child.childExpirationTime;childUpdateExpirationTime>newChildExpirationTime&&(newChildExpirationTime=childUpdateExpirationTime),childChildExpirationTime>newChildExpirationTime&&(newChildExpirationTime=childChildExpirationTime),shouldBubbleActualDurations&&(actualDuration+=child.actualDuration),treeBaseDuration+=child.treeBaseDuration,child=child.sibling}completedWork.actualDuration=actualDuration,completedWork.treeBaseDuration=treeBaseDuration}else for(var _child=completedWork.child;null!==_child;){var _childUpdateExpirationTime=_child.expirationTime,_childChildExpirationTime=_child.childExpirationTime;_childUpdateExpirationTime>newChildExpirationTime&&(newChildExpirationTime=_childUpdateExpirationTime),_childChildExpirationTime>newChildExpirationTime&&(newChildExpirationTime=_childChildExpirationTime),_child=_child.sibling}completedWork.childExpirationTime=newChildExpirationTime}}function commitRoot(root){var renderPriorityLevel=getCurrentPriorityLevel();return runWithPriority$1(99,commitRootImpl.bind(null,root,renderPriorityLevel)),null}function commitRootImpl(root,renderPriorityLevel){do{flushPassiveEffects()}while(null!==rootWithPendingPassiveEffects);if(flushRenderPhaseStrictModeWarningsInDEV(),0!=(48&executionContext))throw Error("Should not already be working.");var finishedWork=root.finishedWork,expirationTime=root.finishedExpirationTime,remainingExpirationTimeBeforeCommit,firstEffect;if(null===finishedWork)return null;if(root.finishedWork=null,root.finishedExpirationTime=0,finishedWork===root.current)throw Error("Cannot commit the same tree as before. This error is likely caused by a bug in React. Please file an issue.");if(root.callbackNode=null,root.callbackExpirationTime=0,root.callbackPriority=90,root.nextKnownPendingLevel=0,startCommitTimer(),markRootFinishedAtTime(root,expirationTime,getRemainingExpirationTime(finishedWork)),root===workInProgressRoot&&(workInProgressRoot=null,workInProgress=null,renderExpirationTime$1=0),finishedWork.effectTag>1?null!==finishedWork.lastEffect?(finishedWork.lastEffect.nextEffect=finishedWork,firstEffect=finishedWork.firstEffect):firstEffect=finishedWork:firstEffect=finishedWork.firstEffect,null!==firstEffect){var prevExecutionContext=executionContext;executionContext|=32;var prevInteractions=pushInteractions(root);ReactCurrentOwner$2.current=null,startCommitSnapshotEffectsTimer(),prepareForCommit(root.containerInfo),nextEffect=firstEffect;do{if(invokeGuardedCallback(null,commitBeforeMutationEffects,null),hasCaughtError()){if(null===nextEffect)throw Error("Should be working on an effect.");var error=clearCaughtError();captureCommitPhaseError(nextEffect,error),nextEffect=nextEffect.nextEffect}}while(null!==nextEffect);stopCommitSnapshotEffectsTimer(),recordCommitTime(),startCommitHostEffectsTimer(),nextEffect=firstEffect;do{if(invokeGuardedCallback(null,commitMutationEffects,null,root,renderPriorityLevel),hasCaughtError()){if(null===nextEffect)throw Error("Should be working on an effect.");var _error=clearCaughtError();captureCommitPhaseError(nextEffect,_error),nextEffect=nextEffect.nextEffect}}while(null!==nextEffect);stopCommitHostEffectsTimer(),resetAfterCommit(root.containerInfo),root.current=finishedWork,startCommitLifeCyclesTimer(),nextEffect=firstEffect;do{if(invokeGuardedCallback(null,commitLayoutEffects,null,root,expirationTime),hasCaughtError()){if(null===nextEffect)throw Error("Should be working on an effect.");var _error2=clearCaughtError();captureCommitPhaseError(nextEffect,_error2),nextEffect=nextEffect.nextEffect}}while(null!==nextEffect);stopCommitLifeCyclesTimer(),nextEffect=null,requestPaint(),popInteractions(prevInteractions),executionContext=prevExecutionContext}else root.current=finishedWork,startCommitSnapshotEffectsTimer(),stopCommitSnapshotEffectsTimer(),recordCommitTime(),startCommitHostEffectsTimer(),stopCommitHostEffectsTimer(),startCommitLifeCyclesTimer(),stopCommitLifeCyclesTimer();stopCommitTimer();var rootDidHavePassiveEffects=rootDoesHavePassiveEffects;if(rootDoesHavePassiveEffects)rootDoesHavePassiveEffects=!1,rootWithPendingPassiveEffects=root,pendingPassiveEffectsExpirationTime=expirationTime,pendingPassiveEffectsRenderPriority=renderPriorityLevel;else for(nextEffect=firstEffect;null!==nextEffect;){var nextNextEffect=nextEffect.nextEffect;nextEffect.nextEffect=null,nextEffect=nextNextEffect}var remainingExpirationTime=root.firstPendingTime;if(0!==remainingExpirationTime){if(null!==spawnedWorkDuringRender){var expirationTimes=spawnedWorkDuringRender;spawnedWorkDuringRender=null;for(var i=0;i<expirationTimes.length;i++)scheduleInteractions(root,expirationTimes[i],root.memoizedInteractions)}schedulePendingInteractions(root,remainingExpirationTime)}else legacyErrorBoundariesThatAlreadyFailed=null;if(rootDidHavePassiveEffects||finishPendingInteractions(root,expirationTime),remainingExpirationTime===Sync?root===rootWithNestedUpdates?nestedUpdateCount++:(nestedUpdateCount=0,rootWithNestedUpdates=root):nestedUpdateCount=0,onCommitRoot(finishedWork.stateNode,expirationTime),ensureRootIsScheduled(root),hasUncaughtError){hasUncaughtError=!1;var _error3=firstUncaughtError;throw firstUncaughtError=null,_error3}return 0!=(8&executionContext)?null:(flushSyncCallbackQueue(),null)}function commitBeforeMutationEffects(){for(;null!==nextEffect;){var effectTag=nextEffect.effectTag,current;if(0!=(256&effectTag))setCurrentFiber(nextEffect),recordEffect(),commitBeforeMutationLifeCycles(nextEffect.alternate,nextEffect),resetCurrentFiber();0!=(512&effectTag)&&(rootDoesHavePassiveEffects||(rootDoesHavePassiveEffects=!0,scheduleCallback(97,(function(){return flushPassiveEffects(),null})))),nextEffect=nextEffect.nextEffect}}function commitMutationEffects(root,renderPriorityLevel){for(;null!==nextEffect;){setCurrentFiber(nextEffect);var effectTag=nextEffect.effectTag,primaryEffectTag;if(16&effectTag&&commitResetTextContent(nextEffect),128&effectTag){var current=nextEffect.alternate;null!==current&&commitDetachRef(current)}switch(1038&effectTag){case 2:commitPlacement(nextEffect),nextEffect.effectTag&=-3;break;case 6:var _current;commitPlacement(nextEffect),nextEffect.effectTag&=-3,commitWork(nextEffect.alternate,nextEffect);break;case 1024:nextEffect.effectTag&=-1025;break;case 1028:var _current2;nextEffect.effectTag&=-1025,commitWork(nextEffect.alternate,nextEffect);break;case 4:var _current3;commitWork(nextEffect.alternate,nextEffect);break;case 8:commitDeletion(root,nextEffect,renderPriorityLevel)}recordEffect(),resetCurrentFiber(),nextEffect=nextEffect.nextEffect}}function commitLayoutEffects(root,committedExpirationTime){for(;null!==nextEffect;){setCurrentFiber(nextEffect);var effectTag=nextEffect.effectTag,current;if(36&effectTag)recordEffect(),commitLifeCycles(root,nextEffect.alternate,nextEffect);128&effectTag&&(recordEffect(),commitAttachRef(nextEffect)),resetCurrentFiber(),nextEffect=nextEffect.nextEffect}}function flushPassiveEffects(){if(90!==pendingPassiveEffectsRenderPriority){var priorityLevel=pendingPassiveEffectsRenderPriority>97?97:pendingPassiveEffectsRenderPriority;return pendingPassiveEffectsRenderPriority=90,runWithPriority$1(priorityLevel,flushPassiveEffectsImpl)}}function flushPassiveEffectsImpl(){if(null===rootWithPendingPassiveEffects)return!1;var root=rootWithPendingPassiveEffects,expirationTime=pendingPassiveEffectsExpirationTime;if(rootWithPendingPassiveEffects=null,pendingPassiveEffectsExpirationTime=0,0!=(48&executionContext))throw Error("Cannot flush passive effects while already rendering.");var prevExecutionContext=executionContext;executionContext|=32;for(var prevInteractions=pushInteractions(root),_effect2=root.current.firstEffect;null!==_effect2;){if(setCurrentFiber(_effect2),invokeGuardedCallback(null,commitPassiveHookEffects,null,_effect2),hasCaughtError()){if(null===_effect2)throw Error("Should be working on an effect.");var _error5;captureCommitPhaseError(_effect2,clearCaughtError())}resetCurrentFiber();var nextNextEffect=_effect2.nextEffect;_effect2.nextEffect=null,_effect2=nextNextEffect}return popInteractions(prevInteractions),finishPendingInteractions(root,expirationTime),executionContext=prevExecutionContext,flushSyncCallbackQueue(),nestedPassiveUpdateCount=null===rootWithPendingPassiveEffects?0:nestedPassiveUpdateCount+1,!0}function isAlreadyFailedLegacyErrorBoundary(instance){return null!==legacyErrorBoundariesThatAlreadyFailed&&legacyErrorBoundariesThatAlreadyFailed.has(instance)}function markLegacyErrorBoundaryAsFailed(instance){null===legacyErrorBoundariesThatAlreadyFailed?legacyErrorBoundariesThatAlreadyFailed=new Set([instance]):legacyErrorBoundariesThatAlreadyFailed.add(instance)}function prepareToThrowUncaughtError(error){hasUncaughtError||(hasUncaughtError=!0,firstUncaughtError=error)}var onUncaughtError=prepareToThrowUncaughtError;function captureCommitPhaseErrorOnRoot(rootFiber,sourceFiber,error){var errorInfo,update;enqueueUpdate(rootFiber,createRootErrorUpdate(rootFiber,createCapturedValue(error,sourceFiber),Sync));var root=markUpdateTimeFromFiberToRoot(rootFiber,Sync);null!==root&&(ensureRootIsScheduled(root),schedulePendingInteractions(root,Sync))}function captureCommitPhaseError(sourceFiber,error){if(3!==sourceFiber.tag)for(var fiber=sourceFiber.return;null!==fiber;){if(3===fiber.tag)return void captureCommitPhaseErrorOnRoot(fiber,sourceFiber,error);if(1===fiber.tag){var ctor=fiber.type,instance=fiber.stateNode;if("function"==typeof ctor.getDerivedStateFromError||"function"==typeof instance.componentDidCatch&&!isAlreadyFailedLegacyErrorBoundary(instance)){var errorInfo,update;enqueueUpdate(fiber,createClassErrorUpdate(fiber,createCapturedValue(error,sourceFiber),Sync));var root=markUpdateTimeFromFiberToRoot(fiber,Sync);return void(null!==root&&(ensureRootIsScheduled(root),schedulePendingInteractions(root,Sync)))}}fiber=fiber.return}else captureCommitPhaseErrorOnRoot(sourceFiber,sourceFiber,error)}function pingSuspendedRoot(root,thenable,suspendedTime){var pingCache=root.pingCache;if(null!==pingCache&&pingCache.delete(thenable),workInProgressRoot!==root||renderExpirationTime$1!==suspendedTime){if(isRootSuspendedAtTime(root,suspendedTime)){var lastPingedTime=root.lastPingedTime;0!==lastPingedTime&&lastPingedTime<suspendedTime||(root.lastPingedTime=suspendedTime,ensureRootIsScheduled(root),schedulePendingInteractions(root,suspendedTime))}}else 4===workInProgressRootExitStatus||3===workInProgressRootExitStatus&&workInProgressRootLatestProcessedExpirationTime===Sync&&now()-globalMostRecentFallbackTime<500?prepareFreshStack(root,renderExpirationTime$1):workInProgressRootHasPendingPing=!0}function retryTimedOutBoundary(boundaryFiber,retryTime){if(0===retryTime){var suspenseConfig=null,currentTime;retryTime=computeExpirationForFiber(requestCurrentTimeForUpdate(),boundaryFiber,null)}var root=markUpdateTimeFromFiberToRoot(boundaryFiber,retryTime);null!==root&&(ensureRootIsScheduled(root),schedulePendingInteractions(root,retryTime))}function resolveRetryThenable(boundaryFiber,thenable){var retryTime=0,retryCache;null!==(retryCache=boundaryFiber.stateNode)&&retryCache.delete(thenable),retryTimedOutBoundary(boundaryFiber,0)}function jnd(timeElapsed){return timeElapsed<120?120:timeElapsed<480?480:timeElapsed<1080?1080:timeElapsed<1920?1920:timeElapsed<3e3?3e3:timeElapsed<4320?4320:1960*ceil(timeElapsed/1960)}function computeMsUntilSuspenseLoadingDelay(mostRecentEventTime,committedExpirationTime,suspenseConfig){var busyMinDurationMs=0|suspenseConfig.busyMinDurationMs;if(busyMinDurationMs<=0)return 0;var busyDelayMs=0|suspenseConfig.busyDelayMs,currentTimeMs,eventTimeMs,timeElapsed=now()-inferTimeFromExpirationTimeWithSuspenseConfig(mostRecentEventTime,suspenseConfig),msUntilTimeout;return timeElapsed<=busyDelayMs?0:busyDelayMs+busyMinDurationMs-timeElapsed}function checkForNestedUpdates(){if(nestedUpdateCount>50)throw nestedUpdateCount=0,rootWithNestedUpdates=null,Error("Maximum update depth exceeded. This can happen when a component repeatedly calls setState inside componentWillUpdate or componentDidUpdate. React limits the number of nested updates to prevent infinite loops.");nestedPassiveUpdateCount>50&&(nestedPassiveUpdateCount=0,error("Maximum update depth exceeded. This can happen when a component calls setState inside useEffect, but useEffect either doesn't have a dependency array, or one of the dependencies changes on every render."))}function flushRenderPhaseStrictModeWarningsInDEV(){ReactStrictModeWarnings.flushLegacyContextWarning(),ReactStrictModeWarnings.flushPendingUnsafeLifecycleWarnings()}function stopFinishedWorkLoopTimer(){var didCompleteRoot=!0;stopWorkLoopTimer(interruptedBy,!0),interruptedBy=null}function stopInterruptedWorkLoopTimer(){var didCompleteRoot=!1;stopWorkLoopTimer(interruptedBy,!1),interruptedBy=null}function checkForInterruption(fiberThatReceivedUpdate,updateExpirationTime){null!==workInProgressRoot&&updateExpirationTime>renderExpirationTime$1&&(interruptedBy=fiberThatReceivedUpdate)}var didWarnStateUpdateForUnmountedComponent=null,beginWork$1;function warnAboutUpdateOnUnmountedFiberInDEV(fiber){var tag=fiber.tag;if(3===tag||1===tag||0===tag||11===tag||14===tag||15===tag||22===tag){var componentName=getComponentName(fiber.type)||"ReactComponent";if(null!==didWarnStateUpdateForUnmountedComponent){if(didWarnStateUpdateForUnmountedComponent.has(componentName))return;didWarnStateUpdateForUnmountedComponent.add(componentName)}else didWarnStateUpdateForUnmountedComponent=new Set([componentName]);error("Can't perform a React state update on an unmounted component. This is a no-op, but it indicates a memory leak in your application. To fix, cancel all subscriptions and asynchronous tasks in %s.%s",1===tag?"the componentWillUnmount method":"a useEffect cleanup function",getStackByFiberInDevAndProd(fiber))}}var dummyFiber=null;beginWork$1=function(current,unitOfWork,expirationTime){var originalWorkInProgressCopy=assignFiberPropertiesInDEV(null,unitOfWork);try{return beginWork(current,unitOfWork,expirationTime)}catch(originalError){if(null!==originalError&&"object"==typeof originalError&&"function"==typeof originalError.then)throw originalError;var replayError;if(resetContextDependencies(),resetHooksAfterThrow(),unwindInterruptedWork(unitOfWork),assignFiberPropertiesInDEV(unitOfWork,originalWorkInProgressCopy),8&unitOfWork.mode&&startProfilerTimer(unitOfWork),invokeGuardedCallback(null,beginWork,null,current,unitOfWork,expirationTime),hasCaughtError())throw clearCaughtError();throw originalError}};var didWarnAboutUpdateInRender=!1,didWarnAboutUpdateInRenderForAnotherComponent;function warnAboutRenderPhaseUpdatesInDEV(fiber){if(isRendering&&0!=(16&executionContext))switch(fiber.tag){case 0:case 11:case 15:var renderingComponentName=workInProgress&&getComponentName(workInProgress.type)||"Unknown",dedupeKey=renderingComponentName,setStateComponentName;if(!didWarnAboutUpdateInRenderForAnotherComponent.has(dedupeKey))didWarnAboutUpdateInRenderForAnotherComponent.add(dedupeKey),error("Cannot update a component (`%s`) while rendering a different component (`%s`). To locate the bad setState() call inside `%s`, follow the stack trace as described in https://fb.me/setstate-in-render",getComponentName(fiber.type)||"Unknown",renderingComponentName,renderingComponentName);break;case 1:didWarnAboutUpdateInRender||(error("Cannot update during an existing state transition (such as within `render`). Render methods should be a pure function of props and state."),didWarnAboutUpdateInRender=!0)}}didWarnAboutUpdateInRenderForAnotherComponent=new Set;var IsThisRendererActing={current:!1};function warnIfNotScopedWithMatchingAct(fiber){!0===IsSomeRendererActing.current&&!0!==IsThisRendererActing.current&&error("It looks like you're using the wrong act() around your test interactions.\nBe sure to use the matching version of act() corresponding to your renderer:\n\n// for react-dom:\nimport {act} from 'react-dom/test-utils';\n// ...\nact(() => ...);\n\n// for react-test-renderer:\nimport TestRenderer from 'react-test-renderer';\nconst {act} = TestRenderer;\n// ...\nact(() => ...);%s",getStackByFiberInDevAndProd(fiber))}function warnIfNotCurrentlyActingEffectsInDEV(fiber){0!=(1&fiber.mode)&&!1===IsSomeRendererActing.current&&!1===IsThisRendererActing.current&&error("An update to %s ran an effect, but was not wrapped in act(...).\n\nWhen testing, code that causes React state updates should be wrapped into act(...):\n\nact(() => {\n  /* fire events that update state */\n});\n/* assert on the output */\n\nThis ensures that you're testing the behavior the user would see in the browser. Learn more at https://fb.me/react-wrap-tests-with-act%s",getComponentName(fiber.type),getStackByFiberInDevAndProd(fiber))}function warnIfNotCurrentlyActingUpdatesInDEV(fiber){0===executionContext&&!1===IsSomeRendererActing.current&&!1===IsThisRendererActing.current&&error("An update to %s inside a test was not wrapped in act(...).\n\nWhen testing, code that causes React state updates should be wrapped into act(...):\n\nact(() => {\n  /* fire events that update state */\n});\n/* assert on the output */\n\nThis ensures that you're testing the behavior the user would see in the browser. Learn more at https://fb.me/react-wrap-tests-with-act%s",getComponentName(fiber.type),getStackByFiberInDevAndProd(fiber))}var warnIfNotCurrentlyActingUpdatesInDev=warnIfNotCurrentlyActingUpdatesInDEV,didWarnAboutUnmockedScheduler=!1;function warnIfUnmockedScheduler(fiber){!1===didWarnAboutUnmockedScheduler&&void 0===Scheduler.unstable_flushAllWithoutAsserting&&(2&fiber.mode||4&fiber.mode)&&(didWarnAboutUnmockedScheduler=!0,error("In Concurrent or Sync modes, the \"scheduler\" module needs to be mocked to guarantee consistent behaviour across tests and browsers. For example, with jest: \njest.mock('scheduler', () => require('scheduler/unstable_mock'));\n\nFor more info, visit https://fb.me/react-mock-scheduler"))}function computeThreadID(root,expirationTime){return 1e3*expirationTime+root.interactionThreadID}function markSpawnedWork(expirationTime){null===spawnedWorkDuringRender?spawnedWorkDuringRender=[expirationTime]:spawnedWorkDuringRender.push(expirationTime)}function scheduleInteractions(root,expirationTime,interactions){if(interactions.size>0){var pendingInteractionMap=root.pendingInteractionMap,pendingInteractions=pendingInteractionMap.get(expirationTime);null!=pendingInteractions?interactions.forEach((function(interaction){pendingInteractions.has(interaction)||interaction.__count++,pendingInteractions.add(interaction)})):(pendingInteractionMap.set(expirationTime,new Set(interactions)),interactions.forEach((function(interaction){interaction.__count++})));var subscriber=tracing.__subscriberRef.current;if(null!==subscriber){var threadID=computeThreadID(root,expirationTime);subscriber.onWorkScheduled(interactions,threadID)}}}function schedulePendingInteractions(root,expirationTime){scheduleInteractions(root,expirationTime,tracing.__interactionsRef.current)}function startWorkOnPendingInteractions(root,expirationTime){var interactions=new Set;if(root.pendingInteractionMap.forEach((function(scheduledInteractions,scheduledExpirationTime){scheduledExpirationTime>=expirationTime&&scheduledInteractions.forEach((function(interaction){return interactions.add(interaction)}))})),root.memoizedInteractions=interactions,interactions.size>0){var subscriber=tracing.__subscriberRef.current;if(null!==subscriber){var threadID=computeThreadID(root,expirationTime);try{subscriber.onWorkStarted(interactions,threadID)}catch(error){scheduleCallback(99,(function(){throw error}))}}}}function finishPendingInteractions(root,committedExpirationTime){var earliestRemainingTimeAfterCommit=root.firstPendingTime,subscriber;try{if(null!==(subscriber=tracing.__subscriberRef.current)&&root.memoizedInteractions.size>0){var threadID=computeThreadID(root,committedExpirationTime);subscriber.onWorkStopped(root.memoizedInteractions,threadID)}}catch(error){scheduleCallback(99,(function(){throw error}))}finally{var pendingInteractionMap=root.pendingInteractionMap;pendingInteractionMap.forEach((function(scheduledInteractions,scheduledExpirationTime){scheduledExpirationTime>earliestRemainingTimeAfterCommit&&(pendingInteractionMap.delete(scheduledExpirationTime),scheduledInteractions.forEach((function(interaction){if(interaction.__count--,null!==subscriber&&0===interaction.__count)try{subscriber.onInteractionScheduledWorkCompleted(interaction)}catch(error){scheduleCallback(99,(function(){throw error}))}})))}))}}var onScheduleFiberRoot=null,onCommitFiberRoot=null,onCommitFiberUnmount=null,hasLoggedError=!1,isDevToolsPresent="undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__,hasBadMapPolyfill;function injectInternals(internals){if("undefined"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__)return!1;var hook=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(hook.isDisabled)return!0;if(!hook.supportsFiber)return error("The installed version of React DevTools is too old and will not work with the current version of React. Please update React DevTools. https://fb.me/react-devtools"),!0;try{var rendererID=hook.inject(internals);"function"==typeof hook.onScheduleFiberRoot&&(onScheduleFiberRoot=function(root,children){try{hook.onScheduleFiberRoot(rendererID,root,children)}catch(err){hasLoggedError||(hasLoggedError=!0,error("React instrumentation encountered an error: %s",err))}}),onCommitFiberRoot=function(root,expirationTime){try{var didError=64==(64&root.current.effectTag),currentTime,priorityLevel=inferPriorityFromExpirationTime(getCurrentTime(),expirationTime);hook.onCommitFiberRoot(rendererID,root,priorityLevel,didError)}catch(err){hasLoggedError||(hasLoggedError=!0,error("React instrumentation encountered an error: %s",err))}},onCommitFiberUnmount=function(fiber){try{hook.onCommitFiberUnmount(rendererID,fiber)}catch(err){hasLoggedError||(hasLoggedError=!0,error("React instrumentation encountered an error: %s",err))}}}catch(err){error("React instrumentation encountered an error: %s.",err)}return!0}function onScheduleRoot(root,children){"function"==typeof onScheduleFiberRoot&&onScheduleFiberRoot(root,children)}function onCommitRoot(root,expirationTime){"function"==typeof onCommitFiberRoot&&onCommitFiberRoot(root,expirationTime)}function onCommitUnmount(fiber){"function"==typeof onCommitFiberUnmount&&onCommitFiberUnmount(fiber)}hasBadMapPolyfill=!1;try{var nonExtensibleObject=Object.preventExtensions({}),testMap=new Map([[nonExtensibleObject,null]]),testSet=new Set([nonExtensibleObject]);testMap.set(0,0),testSet.add(0)}catch(e){hasBadMapPolyfill=!0}var debugCounter=1;function FiberNode(tag,pendingProps,key,mode){this.tag=tag,this.key=key,this.elementType=null,this.type=null,this.stateNode=null,this.return=null,this.child=null,this.sibling=null,this.index=0,this.ref=null,this.pendingProps=pendingProps,this.memoizedProps=null,this.updateQueue=null,this.memoizedState=null,this.dependencies=null,this.mode=mode,this.effectTag=0,this.nextEffect=null,this.firstEffect=null,this.lastEffect=null,this.expirationTime=0,this.childExpirationTime=0,this.alternate=null,this.actualDuration=Number.NaN,this.actualStartTime=Number.NaN,this.selfBaseDuration=Number.NaN,this.treeBaseDuration=Number.NaN,this.actualDuration=0,this.actualStartTime=-1,this.selfBaseDuration=0,this.treeBaseDuration=0,this._debugID=debugCounter++,this._debugIsCurrentlyTiming=!1,this._debugSource=null,this._debugOwner=null,this._debugNeedsRemount=!1,this._debugHookTypes=null,hasBadMapPolyfill||"function"!=typeof Object.preventExtensions||Object.preventExtensions(this)}var createFiber=function(tag,pendingProps,key,mode){return new FiberNode(tag,pendingProps,key,mode)},didWarnAboutNestedUpdates,didWarnAboutFindNodeInStrictMode;function shouldConstruct(Component){var prototype=Component.prototype;return!(!prototype||!prototype.isReactComponent)}function isSimpleFunctionComponent(type){return"function"==typeof type&&!shouldConstruct(type)&&void 0===type.defaultProps}function resolveLazyComponentTag(Component){if("function"==typeof Component)return shouldConstruct(Component)?1:0;if(null!=Component){var $$typeof=Component.$$typeof;if($$typeof===REACT_FORWARD_REF_TYPE)return 11;if($$typeof===REACT_MEMO_TYPE)return 14}return 2}function createWorkInProgress(current,pendingProps){var workInProgress=current.alternate;null===workInProgress?((workInProgress=createFiber(current.tag,pendingProps,current.key,current.mode)).elementType=current.elementType,workInProgress.type=current.type,workInProgress.stateNode=current.stateNode,workInProgress._debugID=current._debugID,workInProgress._debugSource=current._debugSource,workInProgress._debugOwner=current._debugOwner,workInProgress._debugHookTypes=current._debugHookTypes,workInProgress.alternate=current,current.alternate=workInProgress):(workInProgress.pendingProps=pendingProps,workInProgress.effectTag=0,workInProgress.nextEffect=null,workInProgress.firstEffect=null,workInProgress.lastEffect=null,workInProgress.actualDuration=0,workInProgress.actualStartTime=-1),workInProgress.childExpirationTime=current.childExpirationTime,workInProgress.expirationTime=current.expirationTime,workInProgress.child=current.child,workInProgress.memoizedProps=current.memoizedProps,workInProgress.memoizedState=current.memoizedState,workInProgress.updateQueue=current.updateQueue;var currentDependencies=current.dependencies;switch(workInProgress.dependencies=null===currentDependencies?null:{expirationTime:currentDependencies.expirationTime,firstContext:currentDependencies.firstContext,responders:currentDependencies.responders},workInProgress.sibling=current.sibling,workInProgress.index=current.index,workInProgress.ref=current.ref,workInProgress.selfBaseDuration=current.selfBaseDuration,workInProgress.treeBaseDuration=current.treeBaseDuration,workInProgress._debugNeedsRemount=current._debugNeedsRemount,workInProgress.tag){case 2:case 0:case 15:workInProgress.type=resolveFunctionForHotReloading(current.type);break;case 1:workInProgress.type=resolveClassForHotReloading(current.type);break;case 11:workInProgress.type=resolveForwardRefForHotReloading(current.type)}return workInProgress}function resetWorkInProgress(workInProgress,renderExpirationTime){workInProgress.effectTag&=2,workInProgress.nextEffect=null,workInProgress.firstEffect=null,workInProgress.lastEffect=null;var current=workInProgress.alternate;if(null===current)workInProgress.childExpirationTime=0,workInProgress.expirationTime=renderExpirationTime,workInProgress.child=null,workInProgress.memoizedProps=null,workInProgress.memoizedState=null,workInProgress.updateQueue=null,workInProgress.dependencies=null,workInProgress.selfBaseDuration=0,workInProgress.treeBaseDuration=0;else{workInProgress.childExpirationTime=current.childExpirationTime,workInProgress.expirationTime=current.expirationTime,workInProgress.child=current.child,workInProgress.memoizedProps=current.memoizedProps,workInProgress.memoizedState=current.memoizedState,workInProgress.updateQueue=current.updateQueue;var currentDependencies=current.dependencies;workInProgress.dependencies=null===currentDependencies?null:{expirationTime:currentDependencies.expirationTime,firstContext:currentDependencies.firstContext,responders:currentDependencies.responders},workInProgress.selfBaseDuration=current.selfBaseDuration,workInProgress.treeBaseDuration=current.treeBaseDuration}return workInProgress}function createHostRootFiber(tag){var mode;return mode=2===tag?7:1===tag?3:0,isDevToolsPresent&&(mode|=8),createFiber(3,null,null,mode)}function createFiberFromTypeAndProps(type,key,pendingProps,owner,mode,expirationTime){var fiber,fiberTag=2,resolvedType=type;if("function"==typeof type)shouldConstruct(type)?(fiberTag=1,resolvedType=resolveClassForHotReloading(resolvedType)):resolvedType=resolveFunctionForHotReloading(resolvedType);else if("string"==typeof type)fiberTag=5;else getTag:switch(type){case REACT_FRAGMENT_TYPE:return createFiberFromFragment(pendingProps.children,mode,expirationTime,key);case REACT_CONCURRENT_MODE_TYPE:fiberTag=8,mode|=7;break;case REACT_STRICT_MODE_TYPE:fiberTag=8,mode|=1;break;case REACT_PROFILER_TYPE:return createFiberFromProfiler(pendingProps,mode,expirationTime,key);case REACT_SUSPENSE_TYPE:return createFiberFromSuspense(pendingProps,mode,expirationTime,key);case REACT_SUSPENSE_LIST_TYPE:return createFiberFromSuspenseList(pendingProps,mode,expirationTime,key);default:if("object"==typeof type&&null!==type)switch(type.$$typeof){case REACT_PROVIDER_TYPE:fiberTag=10;break getTag;case REACT_CONTEXT_TYPE:fiberTag=9;break getTag;case REACT_FORWARD_REF_TYPE:fiberTag=11,resolvedType=resolveForwardRefForHotReloading(resolvedType);break getTag;case REACT_MEMO_TYPE:fiberTag=14;break getTag;case REACT_LAZY_TYPE:fiberTag=16,resolvedType=null;break getTag;case REACT_BLOCK_TYPE:fiberTag=22;break getTag}var info="";(void 0===type||"object"==typeof type&&null!==type&&0===Object.keys(type).length)&&(info+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.");var ownerName=owner?getComponentName(owner.type):null;throw ownerName&&(info+="\n\nCheck the render method of `"+ownerName+"`."),Error("Element type is invalid: expected a string (for built-in components) or a class/function (for composite components) but got: "+(null==type?type:typeof type)+"."+info)}return(fiber=createFiber(fiberTag,pendingProps,key,mode)).elementType=type,fiber.type=resolvedType,fiber.expirationTime=expirationTime,fiber}function createFiberFromElement(element,mode,expirationTime){var owner=null;owner=element._owner;var type,key,pendingProps,fiber=createFiberFromTypeAndProps(element.type,element.key,element.props,owner,mode,expirationTime);return fiber._debugSource=element._source,fiber._debugOwner=element._owner,fiber}function createFiberFromFragment(elements,mode,expirationTime,key){var fiber=createFiber(7,elements,key,mode);return fiber.expirationTime=expirationTime,fiber}function createFiberFromProfiler(pendingProps,mode,expirationTime,key){"string"==typeof pendingProps.id&&"function"==typeof pendingProps.onRender||error('Profiler must specify an "id" string and "onRender" function as props');var fiber=createFiber(12,pendingProps,key,8|mode);return fiber.elementType=REACT_PROFILER_TYPE,fiber.type=REACT_PROFILER_TYPE,fiber.expirationTime=expirationTime,fiber}function createFiberFromSuspense(pendingProps,mode,expirationTime,key){var fiber=createFiber(13,pendingProps,key,mode);return fiber.type=REACT_SUSPENSE_TYPE,fiber.elementType=REACT_SUSPENSE_TYPE,fiber.expirationTime=expirationTime,fiber}function createFiberFromSuspenseList(pendingProps,mode,expirationTime,key){var fiber=createFiber(19,pendingProps,key,mode);return fiber.type=REACT_SUSPENSE_LIST_TYPE,fiber.elementType=REACT_SUSPENSE_LIST_TYPE,fiber.expirationTime=expirationTime,fiber}function createFiberFromText(content,mode,expirationTime){var fiber=createFiber(6,content,null,mode);return fiber.expirationTime=expirationTime,fiber}function createFiberFromHostInstanceForDeletion(){var fiber=createFiber(5,null,null,0);return fiber.elementType="DELETED",fiber.type="DELETED",fiber}function createFiberFromPortal(portal,mode,expirationTime){var pendingProps=null!==portal.children?portal.children:[],fiber=createFiber(4,pendingProps,portal.key,mode);return fiber.expirationTime=expirationTime,fiber.stateNode={containerInfo:portal.containerInfo,pendingChildren:null,implementation:portal.implementation},fiber}function assignFiberPropertiesInDEV(target,source){return null===target&&(target=createFiber(2,null,null,0)),target.tag=source.tag,target.key=source.key,target.elementType=source.elementType,target.type=source.type,target.stateNode=source.stateNode,target.return=source.return,target.child=source.child,target.sibling=source.sibling,target.index=source.index,target.ref=source.ref,target.pendingProps=source.pendingProps,target.memoizedProps=source.memoizedProps,target.updateQueue=source.updateQueue,target.memoizedState=source.memoizedState,target.dependencies=source.dependencies,target.mode=source.mode,target.effectTag=source.effectTag,target.nextEffect=source.nextEffect,target.firstEffect=source.firstEffect,target.lastEffect=source.lastEffect,target.expirationTime=source.expirationTime,target.childExpirationTime=source.childExpirationTime,target.alternate=source.alternate,target.actualDuration=source.actualDuration,target.actualStartTime=source.actualStartTime,target.selfBaseDuration=source.selfBaseDuration,target.treeBaseDuration=source.treeBaseDuration,target._debugID=source._debugID,target._debugSource=source._debugSource,target._debugOwner=source._debugOwner,target._debugIsCurrentlyTiming=source._debugIsCurrentlyTiming,target._debugNeedsRemount=source._debugNeedsRemount,target._debugHookTypes=source._debugHookTypes,target}function FiberRootNode(containerInfo,tag,hydrate){this.tag=tag,this.current=null,this.containerInfo=containerInfo,this.pendingChildren=null,this.pingCache=null,this.finishedExpirationTime=0,this.finishedWork=null,this.timeoutHandle=-1,this.context=null,this.pendingContext=null,this.hydrate=hydrate,this.callbackNode=null,this.callbackPriority=90,this.firstPendingTime=0,this.firstSuspendedTime=0,this.lastSuspendedTime=0,this.nextKnownPendingLevel=0,this.lastPingedTime=0,this.lastExpiredTime=0,this.interactionThreadID=tracing.unstable_getThreadID(),this.memoizedInteractions=new Set,this.pendingInteractionMap=new Map}function createFiberRoot(containerInfo,tag,hydrate,hydrationCallbacks){var root=new FiberRootNode(containerInfo,tag,hydrate),uninitializedFiber=createHostRootFiber(tag);return root.current=uninitializedFiber,uninitializedFiber.stateNode=root,initializeUpdateQueue(uninitializedFiber),root}function isRootSuspendedAtTime(root,expirationTime){var firstSuspendedTime=root.firstSuspendedTime,lastSuspendedTime=root.lastSuspendedTime;return 0!==firstSuspendedTime&&firstSuspendedTime>=expirationTime&&lastSuspendedTime<=expirationTime}function markRootSuspendedAtTime(root,expirationTime){var firstSuspendedTime=root.firstSuspendedTime,lastSuspendedTime=root.lastSuspendedTime;firstSuspendedTime<expirationTime&&(root.firstSuspendedTime=expirationTime),(lastSuspendedTime>expirationTime||0===firstSuspendedTime)&&(root.lastSuspendedTime=expirationTime),expirationTime<=root.lastPingedTime&&(root.lastPingedTime=0),expirationTime<=root.lastExpiredTime&&(root.lastExpiredTime=0)}function markRootUpdatedAtTime(root,expirationTime){var firstPendingTime;expirationTime>root.firstPendingTime&&(root.firstPendingTime=expirationTime);var firstSuspendedTime=root.firstSuspendedTime;0!==firstSuspendedTime&&(expirationTime>=firstSuspendedTime?root.firstSuspendedTime=root.lastSuspendedTime=root.nextKnownPendingLevel=0:expirationTime>=root.lastSuspendedTime&&(root.lastSuspendedTime=expirationTime+1),expirationTime>root.nextKnownPendingLevel&&(root.nextKnownPendingLevel=expirationTime))}function markRootFinishedAtTime(root,finishedExpirationTime,remainingExpirationTime){root.firstPendingTime=remainingExpirationTime,finishedExpirationTime<=root.lastSuspendedTime?root.firstSuspendedTime=root.lastSuspendedTime=root.nextKnownPendingLevel=0:finishedExpirationTime<=root.firstSuspendedTime&&(root.firstSuspendedTime=finishedExpirationTime-1),finishedExpirationTime<=root.lastPingedTime&&(root.lastPingedTime=0),finishedExpirationTime<=root.lastExpiredTime&&(root.lastExpiredTime=0)}function markRootExpiredAtTime(root,expirationTime){var lastExpiredTime=root.lastExpiredTime;(0===lastExpiredTime||lastExpiredTime>expirationTime)&&(root.lastExpiredTime=expirationTime)}function getContextForSubtree(parentComponent){if(!parentComponent)return emptyContextObject;var fiber=get(parentComponent),parentContext=findCurrentUnmaskedContext(fiber);if(1===fiber.tag){var Component=fiber.type;if(isContextProvider(Component))return processChildContext(fiber,Component,parentContext)}return parentContext}function findHostInstanceWithWarning(component,methodName){var fiber=get(component);if(void 0===fiber)throw"function"==typeof component.render?Error("Unable to find node on an unmounted component."):Error("Argument appears to not be a ReactComponent. Keys: "+Object.keys(component));var hostFiber=findCurrentHostFiber(fiber);if(null===hostFiber)return null;if(1&hostFiber.mode){var componentName=getComponentName(fiber.type)||"Component";didWarnAboutFindNodeInStrictMode[componentName]||(didWarnAboutFindNodeInStrictMode[componentName]=!0,1&fiber.mode?error("%s is deprecated in StrictMode. %s was passed an instance of %s which is inside StrictMode. Instead, add a ref directly to the element you want to reference. Learn more about using refs safely here: https://fb.me/react-strict-mode-find-node%s",methodName,methodName,componentName,getStackByFiberInDevAndProd(hostFiber)):error("%s is deprecated in StrictMode. %s was passed an instance of %s which renders StrictMode children. Instead, add a ref directly to the element you want to reference. Learn more about using refs safely here: https://fb.me/react-strict-mode-find-node%s",methodName,methodName,componentName,getStackByFiberInDevAndProd(hostFiber)))}return hostFiber.stateNode}function createContainer(containerInfo,tag,hydrate,hydrationCallbacks){return createFiberRoot(containerInfo,tag,hydrate)}function updateContainer(element,container,parentComponent,callback){onScheduleRoot(container,element);var current$1=container.current,currentTime=requestCurrentTimeForUpdate();"undefined"!=typeof jest&&(warnIfUnmockedScheduler(current$1),warnIfNotScopedWithMatchingAct(current$1));var suspenseConfig=requestCurrentSuspenseConfig(),expirationTime=computeExpirationForFiber(currentTime,current$1,suspenseConfig),context=getContextForSubtree(parentComponent);null===container.context?container.context=context:container.pendingContext=context,isRendering&&null!==current&&!didWarnAboutNestedUpdates&&(didWarnAboutNestedUpdates=!0,error("Render methods should be a pure function of props and state; triggering nested component updates from render is not allowed. If necessary, trigger nested updates in componentDidUpdate.\n\nCheck the render method of %s.",getComponentName(current.type)||"Unknown"));var update=createUpdate(expirationTime,suspenseConfig);return update.payload={element:element},null!==(callback=void 0===callback?null:callback)&&("function"!=typeof callback&&error("render(...): Expected the last optional `callback` argument to be a function. Instead received: %s.",callback),update.callback=callback),enqueueUpdate(current$1,update),scheduleWork(current$1,expirationTime),expirationTime}function getPublicRootInstance(container){var containerFiber=container.current;if(!containerFiber.child)return null;switch(containerFiber.child.tag){case 5:default:return containerFiber.child.stateNode}}function markRetryTimeImpl(fiber,retryTime){var suspenseState=fiber.memoizedState;null!==suspenseState&&null!==suspenseState.dehydrated&&suspenseState.retryTime<retryTime&&(suspenseState.retryTime=retryTime)}function markRetryTimeIfNotHydrated(fiber,retryTime){markRetryTimeImpl(fiber,retryTime);var alternate=fiber.alternate;alternate&&markRetryTimeImpl(alternate,retryTime)}function attemptUserBlockingHydration$1(fiber){if(13===fiber.tag){var expTime=computeInteractiveExpiration(requestCurrentTimeForUpdate());scheduleWork(fiber,expTime),markRetryTimeIfNotHydrated(fiber,expTime)}}function attemptContinuousHydration$1(fiber){13===fiber.tag&&(scheduleWork(fiber,3),markRetryTimeIfNotHydrated(fiber,3))}function attemptHydrationAtCurrentPriority$1(fiber){if(13===fiber.tag){var currentTime,expTime=computeExpirationForFiber(requestCurrentTimeForUpdate(),fiber,null);scheduleWork(fiber,expTime),markRetryTimeIfNotHydrated(fiber,expTime)}}function findHostInstanceWithNoPortals(fiber){var hostFiber=findCurrentHostFiberWithNoPortals(fiber);return null===hostFiber?null:20===hostFiber.tag?hostFiber.stateNode.instance:hostFiber.stateNode}didWarnAboutNestedUpdates=!1,didWarnAboutFindNodeInStrictMode={};var shouldSuspendImpl=function(fiber){return!1};function shouldSuspend(fiber){return shouldSuspendImpl(fiber)}var overrideHookState=null,overrideProps=null,scheduleUpdate=null,setSuspenseHandler=null,copyWithSetImpl=function(obj,path,idx,value){if(idx>=path.length)return value;var key=path[idx],updated=Array.isArray(obj)?obj.slice():_assign({},obj);return updated[key]=copyWithSetImpl(obj[key],path,idx+1,value),updated},copyWithSet=function(obj,path,value){return copyWithSetImpl(obj,path,0,value)};function injectIntoDevTools(devToolsConfig){var findFiberByHostInstance=devToolsConfig.findFiberByHostInstance,ReactCurrentDispatcher=ReactSharedInternals.ReactCurrentDispatcher;return injectInternals(_assign({},devToolsConfig,{overrideHookState:overrideHookState,overrideProps:overrideProps,setSuspenseHandler:setSuspenseHandler,scheduleUpdate:scheduleUpdate,currentDispatcherRef:ReactCurrentDispatcher,findHostInstanceByFiber:function(fiber){var hostFiber=findCurrentHostFiber(fiber);return null===hostFiber?null:hostFiber.stateNode},findFiberByHostInstance:function(instance){return findFiberByHostInstance?findFiberByHostInstance(instance):null},findHostInstancesForRefresh:findHostInstancesForRefresh,scheduleRefresh:scheduleRefresh,scheduleRoot:scheduleRoot,setRefreshHandler:setRefreshHandler,getCurrentFiber:function(){return current}}))}overrideHookState=function(fiber,id,path,value){for(var currentHook=fiber.memoizedState;null!==currentHook&&id>0;)currentHook=currentHook.next,id--;if(null!==currentHook){var newState=copyWithSet(currentHook.memoizedState,path,value);currentHook.memoizedState=newState,currentHook.baseState=newState,fiber.memoizedProps=_assign({},fiber.memoizedProps),scheduleWork(fiber,Sync)}},overrideProps=function(fiber,path,value){fiber.pendingProps=copyWithSet(fiber.memoizedProps,path,value),fiber.alternate&&(fiber.alternate.pendingProps=fiber.pendingProps),scheduleWork(fiber,Sync)},scheduleUpdate=function(fiber){scheduleWork(fiber,Sync)},setSuspenseHandler=function(newShouldSuspendImpl){shouldSuspendImpl=newShouldSuspendImpl};var IsSomeRendererActing$1=ReactSharedInternals.IsSomeRendererActing;function ReactDOMRoot(container,options){this._internalRoot=createRootImpl(container,2,options)}function ReactDOMBlockingRoot(container,tag,options){this._internalRoot=createRootImpl(container,tag,options)}function createRootImpl(container,tag,options){var hydrate=null!=options&&!0===options.hydrate,hydrationCallbacks=null!=options&&options.hydrationOptions||null,root=createContainer(container,tag,hydrate),doc;(markContainerAsRoot(root.current,container),hydrate&&0!==tag)&&eagerlyTrapReplayableEvents(container,9===container.nodeType?container:container.ownerDocument);return root}function createLegacyRoot(container,options){return new ReactDOMBlockingRoot(container,0,options)}function isValidContainer(node){return!(!node||1!==node.nodeType&&9!==node.nodeType&&11!==node.nodeType&&(8!==node.nodeType||" react-mount-point-unstable "!==node.nodeValue))}ReactDOMRoot.prototype.render=ReactDOMBlockingRoot.prototype.render=function(children){var root=this._internalRoot;"function"==typeof arguments[1]&&error("render(...): does not support the second callback argument. To execute a side effect after rendering, declare it in a component body with useEffect().");var container=root.containerInfo;if(8!==container.nodeType){var hostInstance=findHostInstanceWithNoPortals(root.current);hostInstance&&hostInstance.parentNode!==container&&error("render(...): It looks like the React-rendered content of the root container was removed without using React. This is not supported and will cause errors. Instead, call root.unmount() to empty a root's container.")}updateContainer(children,root,null,null)},ReactDOMRoot.prototype.unmount=ReactDOMBlockingRoot.prototype.unmount=function(){"function"==typeof arguments[0]&&error("unmount(...): does not support a callback argument. To execute a side effect after rendering, declare it in a component body with useEffect().");var root=this._internalRoot,container=root.containerInfo;updateContainer(null,root,null,(function(){unmarkContainerAsRoot(container)}))};var ReactCurrentOwner$3=ReactSharedInternals.ReactCurrentOwner,topLevelUpdateWarnings,warnedAboutHydrateAPI=!1;function getReactRootElementInContainer(container){return container?9===container.nodeType?container.documentElement:container.firstChild:null}function shouldHydrateDueToLegacyHeuristic(container){var rootElement=getReactRootElementInContainer(container);return!(!rootElement||1!==rootElement.nodeType||!rootElement.hasAttribute("data-reactroot"))}function legacyCreateRootFromDOMContainer(container,forceHydrate){var shouldHydrate=forceHydrate||shouldHydrateDueToLegacyHeuristic(container);if(!shouldHydrate)for(var warned=!1,rootSibling;rootSibling=container.lastChild;)!warned&&1===rootSibling.nodeType&&rootSibling.hasAttribute("data-reactroot")&&(warned=!0,error("render(): Target node has markup rendered by React, but there are unrelated nodes as well. This is most commonly caused by white-space inserted around server-rendered markup.")),container.removeChild(rootSibling);return!shouldHydrate||forceHydrate||warnedAboutHydrateAPI||(warnedAboutHydrateAPI=!0,warn("render(): Calling ReactDOM.render() to hydrate server-rendered markup will stop working in React v17. Replace the ReactDOM.render() call with ReactDOM.hydrate() if you want React to attach to the server HTML.")),createLegacyRoot(container,shouldHydrate?{hydrate:!0}:void 0)}function warnOnInvalidCallback$1(callback,callerName){null!==callback&&"function"!=typeof callback&&error("%s(...): Expected the last optional `callback` argument to be a function. Instead received: %s.",callerName,callback)}function legacyRenderSubtreeIntoContainer(parentComponent,children,container,forceHydrate,callback){topLevelUpdateWarnings(container),warnOnInvalidCallback$1(void 0===callback?null:callback,"render");var root=container._reactRootContainer,fiberRoot;if(root){if(fiberRoot=root._internalRoot,"function"==typeof callback){var _originalCallback=callback;callback=function(){var instance=getPublicRootInstance(fiberRoot);_originalCallback.call(instance)}}updateContainer(children,fiberRoot,parentComponent,callback)}else{if(root=container._reactRootContainer=legacyCreateRootFromDOMContainer(container,forceHydrate),fiberRoot=root._internalRoot,"function"==typeof callback){var originalCallback=callback;callback=function(){var instance=getPublicRootInstance(fiberRoot);originalCallback.call(instance)}}unbatchedUpdates((function(){updateContainer(children,fiberRoot,parentComponent,callback)}))}return getPublicRootInstance(fiberRoot)}function findDOMNode(componentOrElement){var owner=ReactCurrentOwner$3.current,warnedAboutRefsInRender;null!==owner&&null!==owner.stateNode&&(owner.stateNode._warnedAboutRefsInRender||error("%s is accessing findDOMNode inside its render(). render() should be a pure function of props and state. It should never access something that requires stale data from the previous render, such as refs. Move this logic to componentDidMount and componentDidUpdate instead.",getComponentName(owner.type)||"A component"),owner.stateNode._warnedAboutRefsInRender=!0);return null==componentOrElement?null:1===componentOrElement.nodeType?componentOrElement:findHostInstanceWithWarning(componentOrElement,"findDOMNode")}function hydrate(element,container,callback){if(!isValidContainer(container))throw Error("Target container is not a DOM element.");var isModernRoot;return isContainerMarkedAsRoot(container)&&void 0===container._reactRootContainer&&error("You are calling ReactDOM.hydrate() on a container that was previously passed to ReactDOM.createRoot(). This is not supported. Did you mean to call createRoot(container, {hydrate: true}).render(element)?"),legacyRenderSubtreeIntoContainer(null,element,container,!0,callback)}function render(element,container,callback){if(!isValidContainer(container))throw Error("Target container is not a DOM element.");var isModernRoot;return isContainerMarkedAsRoot(container)&&void 0===container._reactRootContainer&&error("You are calling ReactDOM.render() on a container that was previously passed to ReactDOM.createRoot(). This is not supported. Did you mean to call root.render(element)?"),legacyRenderSubtreeIntoContainer(null,element,container,!1,callback)}function unstable_renderSubtreeIntoContainer(parentComponent,element,containerNode,callback){if(!isValidContainer(containerNode))throw Error("Target container is not a DOM element.");if(null==parentComponent||!has(parentComponent))throw Error("parentComponent must be a valid React Component");return legacyRenderSubtreeIntoContainer(parentComponent,element,containerNode,!1,callback)}function unmountComponentAtNode(container){if(!isValidContainer(container))throw Error("unmountComponentAtNode(...): Target container is not a DOM element.");var isModernRoot;if(isContainerMarkedAsRoot(container)&&void 0===container._reactRootContainer&&error("You are calling ReactDOM.unmountComponentAtNode() on a container that was previously passed to ReactDOM.createRoot(). This is not supported. Did you mean to call root.unmount()?"),container._reactRootContainer){var rootEl=getReactRootElementInContainer(container),renderedByDifferentReact;return rootEl&&!getInstanceFromNode$1(rootEl)&&error("unmountComponentAtNode(): The node you're attempting to unmount was rendered by another copy of React."),unbatchedUpdates((function(){legacyRenderSubtreeIntoContainer(null,null,container,!1,(function(){container._reactRootContainer=null,unmarkContainerAsRoot(container)}))})),!0}var _rootEl=getReactRootElementInContainer(container),hasNonRootReactChild=!(!_rootEl||!getInstanceFromNode$1(_rootEl)),isContainerReactRoot=1===container.nodeType&&isValidContainer(container.parentNode)&&!!container.parentNode._reactRootContainer;return hasNonRootReactChild&&error("unmountComponentAtNode(): The node you're attempting to unmount was rendered by React and is not a top-level container. %s",isContainerReactRoot?"You may have accidentally passed in a React root node instead of its container.":"Instead, have the parent component update its state and rerender in order to remove this component."),!1}function createPortal(children,containerInfo,implementation){var key=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:REACT_PORTAL_TYPE,key:null==key?null:""+key,children:children,containerInfo:containerInfo,implementation:implementation}}topLevelUpdateWarnings=function(container){if(container._reactRootContainer&&8!==container.nodeType){var hostInstance=findHostInstanceWithNoPortals(container._reactRootContainer._internalRoot.current);hostInstance&&hostInstance.parentNode!==container&&error("render(...): It looks like the React-rendered content of this container was removed without using React. This is not supported and will cause errors. Instead, call ReactDOM.unmountComponentAtNode to empty a container.")}var isRootRenderedBySomeReact=!!container._reactRootContainer,rootEl=getReactRootElementInContainer(container),hasNonRootReactChild;!(!rootEl||!getInstanceFromNode$1(rootEl))&&!isRootRenderedBySomeReact&&error("render(...): Replacing React-rendered children with a new root component. If you intended to update the children of this node, you should instead have the existing children update their state and render the new components instead of calling ReactDOM.render."),1===container.nodeType&&container.tagName&&"BODY"===container.tagName.toUpperCase()&&error("render(): Rendering components directly into document.body is discouraged, since its children are often manipulated by third-party scripts and browser extensions. This may lead to subtle reconciliation issues. Try rendering into a container element created for your app.")};var ReactVersion="16.14.0";setAttemptUserBlockingHydration(attemptUserBlockingHydration$1),setAttemptContinuousHydration(attemptContinuousHydration$1),setAttemptHydrationAtCurrentPriority(attemptHydrationAtCurrentPriority$1);var didWarnAboutUnstableCreatePortal=!1;function createPortal$1(children,container){var key=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!isValidContainer(container))throw Error("Target container is not a DOM element.");return createPortal(children,container,null,key)}function renderSubtreeIntoContainer(parentComponent,element,containerNode,callback){return unstable_renderSubtreeIntoContainer(parentComponent,element,containerNode,callback)}function unstable_createPortal(children,container){var key=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return didWarnAboutUnstableCreatePortal||(didWarnAboutUnstableCreatePortal=!0,warn('The ReactDOM.unstable_createPortal() alias has been deprecated, and will be removed in React 17+. Update your code to use ReactDOM.createPortal() instead. It has the exact same API, but without the "unstable_" prefix.')),createPortal$1(children,container,key)}"function"==typeof Map&&null!=Map.prototype&&"function"==typeof Map.prototype.forEach&&"function"==typeof Set&&null!=Set.prototype&&"function"==typeof Set.prototype.clear&&"function"==typeof Set.prototype.forEach||error("React depends on Map and Set built-in types. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills"),setRestoreImplementation(restoreControlledState$3),setBatchingImplementation(batchedUpdates$1,discreteUpdates$1,flushDiscreteUpdates,batchedEventUpdates$1);var Internals={Events:[getInstanceFromNode$1,getNodeFromInstance$1,getFiberCurrentPropsFromNode$1,injectEventPluginsByName,eventNameDispatchConfigs,accumulateTwoPhaseDispatches,accumulateDirectDispatches,enqueueStateRestore,restoreStateIfNeeded,dispatchEvent,runEventsInBatch,flushPassiveEffects,IsThisRendererActing]},foundDevTools;if(!injectIntoDevTools({findFiberByHostInstance:getClosestInstanceFromNode,bundleType:1,version:"16.14.0",rendererPackageName:"react-dom"})&&canUseDOM&&window.top===window.self&&(navigator.userAgent.indexOf("Chrome")>-1&&-1===navigator.userAgent.indexOf("Edge")||navigator.userAgent.indexOf("Firefox")>-1)){var protocol=window.location.protocol;/^(https?|file):$/.test(protocol)&&console.info("%cDownload the React DevTools for a better development experience: https://fb.me/react-devtools"+("file:"===protocol?"\nYou might need to use a local HTTP server (instead of file://): https://fb.me/react-devtools-faq":""),"font-weight:bold")}exports.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Internals,exports.createPortal=createPortal$1,exports.findDOMNode=findDOMNode,exports.flushSync=flushSync,exports.hydrate=hydrate,exports.render=render,exports.unmountComponentAtNode=unmountComponentAtNode,exports.unstable_batchedUpdates=batchedUpdates$1,exports.unstable_createPortal=unstable_createPortal,exports.unstable_renderSubtreeIntoContainer=renderSubtreeIntoContainer,exports.version="16.14.0"})()},{"object-assign":419,"prop-types/checkPropTypes":423,react:483,scheduler:506,"scheduler/tracing":507}],439:[function(require,module,exports){
/** @license React v16.14.0
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
"use strict";var aa=require("react"),n=require("object-assign"),r=require("scheduler");function u(a){for(var b="https://reactjs.org/docs/error-decoder.html?invariant="+a,c=1;c<arguments.length;c++)b+="&args[]="+encodeURIComponent(arguments[c]);return"Minified React error #"+a+"; visit "+b+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}if(!aa)throw Error(u(227));function ba(a,b,c,d,e,f,g,h,k){var l=Array.prototype.slice.call(arguments,3);try{b.apply(c,l)}catch(m){this.onError(m)}}var da=!1,ea=null,fa=!1,ha=null,ia={onError:function(a){da=!0,ea=a}};function ja(a,b,c,d,e,f,g,h,k){da=!1,ea=null,ba.apply(ia,arguments)}function ka(a,b,c,d,e,f,g,h,k){if(ja.apply(this,arguments),da){if(!da)throw Error(u(198));var l=ea;da=!1,ea=null,fa||(fa=!0,ha=l)}}var la=null,ma=null,na=null;function oa(a,b,c){var d=a.type||"unknown-event";a.currentTarget=na(c),ka(d,b,void 0,a),a.currentTarget=null}var pa=null,qa={};function ra(){if(pa)for(var a in qa){var b=qa[a],c=pa.indexOf(a);if(!(-1<c))throw Error(u(96,a));if(!sa[c]){if(!b.extractEvents)throw Error(u(97,a));for(var d in sa[c]=b,c=b.eventTypes){var e=void 0,f=c[d],g=b,h=d;if(ta.hasOwnProperty(h))throw Error(u(99,h));ta[h]=f;var k=f.phasedRegistrationNames;if(k){for(e in k)k.hasOwnProperty(e)&&ua(k[e],g,h);e=!0}else f.registrationName?(ua(f.registrationName,g,h),e=!0):e=!1;if(!e)throw Error(u(98,d,a))}}}}function ua(a,b,c){if(va[a])throw Error(u(100,a));va[a]=b,wa[a]=b.eventTypes[c].dependencies}var sa=[],ta={},va={},wa={};function xa(a){var b=!1,c;for(c in a)if(a.hasOwnProperty(c)){var d=a[c];if(!qa.hasOwnProperty(c)||qa[c]!==d){if(qa[c])throw Error(u(102,c));qa[c]=d,b=!0}}b&&ra()}var ya=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement),za=null,Aa=null,Ba=null;function Ca(a){if(a=ma(a)){if("function"!=typeof za)throw Error(u(280));var b=a.stateNode;b&&(b=la(b),za(a.stateNode,a.type,b))}}function Da(a){Aa?Ba?Ba.push(a):Ba=[a]:Aa=a}function Ea(){if(Aa){var a=Aa,b=Ba;if(Ba=Aa=null,Ca(a),b)for(a=0;a<b.length;a++)Ca(b[a])}}function Fa(a,b){return a(b)}function Ga(a,b,c,d,e){return a(b,c,d,e)}function Ha(){}var Ia=Fa,Ja=!1,Ka=!1;function La(){null===Aa&&null===Ba||(Ha(),Ea())}function Ma(a,b,c){if(Ka)return a(b,c);Ka=!0;try{return Ia(a,b,c)}finally{Ka=!1,La()}}var Na=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Oa=Object.prototype.hasOwnProperty,Pa={},Qa={};function Ra(a){return!!Oa.call(Qa,a)||!Oa.call(Pa,a)&&(Na.test(a)?Qa[a]=!0:(Pa[a]=!0,!1))}function Sa(a,b,c,d){if(null!==c&&0===c.type)return!1;switch(typeof b){case"function":case"symbol":return!0;case"boolean":return!d&&(null!==c?!c.acceptsBooleans:"data-"!==(a=a.toLowerCase().slice(0,5))&&"aria-"!==a);default:return!1}}function Ta(a,b,c,d){if(null==b||Sa(a,b,c,d))return!0;if(d)return!1;if(null!==c)switch(c.type){case 3:return!b;case 4:return!1===b;case 5:return isNaN(b);case 6:return isNaN(b)||1>b}return!1}function v(a,b,c,d,e,f){this.acceptsBooleans=2===b||3===b||4===b,this.attributeName=d,this.attributeNamespace=e,this.mustUseProperty=c,this.propertyName=a,this.type=b,this.sanitizeURL=f}var C={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(a){C[a]=new v(a,0,!1,a,null,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(a){var b=a[0];C[b]=new v(b,1,!1,a[1],null,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(a){C[a]=new v(a,2,!1,a.toLowerCase(),null,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(a){C[a]=new v(a,2,!1,a,null,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(a){C[a]=new v(a,3,!1,a.toLowerCase(),null,!1)})),["checked","multiple","muted","selected"].forEach((function(a){C[a]=new v(a,3,!0,a,null,!1)})),["capture","download"].forEach((function(a){C[a]=new v(a,4,!1,a,null,!1)})),["cols","rows","size","span"].forEach((function(a){C[a]=new v(a,6,!1,a,null,!1)})),["rowSpan","start"].forEach((function(a){C[a]=new v(a,5,!1,a.toLowerCase(),null,!1)}));var Ua=/[\-:]([a-z])/g;function Va(a){return a[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(a){var b=a.replace(Ua,Va);C[b]=new v(b,1,!1,a,null,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(a){var b=a.replace(Ua,Va);C[b]=new v(b,1,!1,a,"http://www.w3.org/1999/xlink",!1)})),["xml:base","xml:lang","xml:space"].forEach((function(a){var b=a.replace(Ua,Va);C[b]=new v(b,1,!1,a,"http://www.w3.org/XML/1998/namespace",!1)})),["tabIndex","crossOrigin"].forEach((function(a){C[a]=new v(a,1,!1,a.toLowerCase(),null,!1)})),C.xlinkHref=new v("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0),["src","href","action","formAction"].forEach((function(a){C[a]=new v(a,1,!1,a.toLowerCase(),null,!0)}));var Wa=aa.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function Xa(a,b,c,d){var e=C.hasOwnProperty(b)?C[b]:null,f;(null!==e?0===e.type:!d&&(2<b.length&&("o"===b[0]||"O"===b[0])&&("n"===b[1]||"N"===b[1])))||(Ta(b,c,e,d)&&(c=null),d||null===e?Ra(b)&&(null===c?a.removeAttribute(b):a.setAttribute(b,""+c)):e.mustUseProperty?a[e.propertyName]=null===c?3!==e.type&&"":c:(b=e.attributeName,d=e.attributeNamespace,null===c?a.removeAttribute(b):(c=3===(e=e.type)||4===e&&!0===c?"":""+c,d?a.setAttributeNS(d,b,c):a.setAttribute(b,c))))}Wa.hasOwnProperty("ReactCurrentDispatcher")||(Wa.ReactCurrentDispatcher={current:null}),Wa.hasOwnProperty("ReactCurrentBatchConfig")||(Wa.ReactCurrentBatchConfig={suspense:null});var Ya=/^(.*)[\\\/]/,E="function"==typeof Symbol&&Symbol.for,Za=E?Symbol.for("react.element"):60103,$a=E?Symbol.for("react.portal"):60106,ab=E?Symbol.for("react.fragment"):60107,bb=E?Symbol.for("react.strict_mode"):60108,cb=E?Symbol.for("react.profiler"):60114,db=E?Symbol.for("react.provider"):60109,eb=E?Symbol.for("react.context"):60110,fb=E?Symbol.for("react.concurrent_mode"):60111,gb=E?Symbol.for("react.forward_ref"):60112,hb=E?Symbol.for("react.suspense"):60113,ib=E?Symbol.for("react.suspense_list"):60120,jb=E?Symbol.for("react.memo"):60115,kb=E?Symbol.for("react.lazy"):60116,lb=E?Symbol.for("react.block"):60121,mb="function"==typeof Symbol&&Symbol.iterator;function nb(a){return null===a||"object"!=typeof a?null:"function"==typeof(a=mb&&a[mb]||a["@@iterator"])?a:null}function ob(a){if(-1===a._status){a._status=0;var b=a._ctor;b=b(),a._result=b,b.then((function(b){0===a._status&&(b=b.default,a._status=1,a._result=b)}),(function(b){0===a._status&&(a._status=2,a._result=b)}))}}function pb(a){if(null==a)return null;if("function"==typeof a)return a.displayName||a.name||null;if("string"==typeof a)return a;switch(a){case ab:return"Fragment";case $a:return"Portal";case cb:return"Profiler";case bb:return"StrictMode";case hb:return"Suspense";case ib:return"SuspenseList"}if("object"==typeof a)switch(a.$$typeof){case eb:return"Context.Consumer";case db:return"Context.Provider";case gb:var b=a.render;return b=b.displayName||b.name||"",a.displayName||(""!==b?"ForwardRef("+b+")":"ForwardRef");case jb:return pb(a.type);case lb:return pb(a.render);case kb:if(a=1===a._status?a._result:null)return pb(a)}return null}function qb(a){var b="";do{a:switch(a.tag){case 3:case 4:case 6:case 7:case 10:case 9:var c="";break a;default:var d=a._debugOwner,e=a._debugSource,f=pb(a.type);c=null,d&&(c=pb(d.type)),d=f,f="",e?f=" (at "+e.fileName.replace(Ya,"")+":"+e.lineNumber+")":c&&(f=" (created by "+c+")"),c="\n    in "+(d||"Unknown")+f}b+=c,a=a.return}while(a);return b}function rb(a){switch(typeof a){case"boolean":case"number":case"object":case"string":case"undefined":return a;default:return""}}function sb(a){var b=a.type;return(a=a.nodeName)&&"input"===a.toLowerCase()&&("checkbox"===b||"radio"===b)}function tb(a){var b=sb(a)?"checked":"value",c=Object.getOwnPropertyDescriptor(a.constructor.prototype,b),d=""+a[b];if(!a.hasOwnProperty(b)&&void 0!==c&&"function"==typeof c.get&&"function"==typeof c.set){var e=c.get,f=c.set;return Object.defineProperty(a,b,{configurable:!0,get:function(){return e.call(this)},set:function(a){d=""+a,f.call(this,a)}}),Object.defineProperty(a,b,{enumerable:c.enumerable}),{getValue:function(){return d},setValue:function(a){d=""+a},stopTracking:function(){a._valueTracker=null,delete a[b]}}}}function xb(a){a._valueTracker||(a._valueTracker=tb(a))}function yb(a){if(!a)return!1;var b=a._valueTracker;if(!b)return!0;var c=b.getValue(),d="";return a&&(d=sb(a)?a.checked?"true":"false":a.value),(a=d)!==c&&(b.setValue(a),!0)}function zb(a,b){var c=b.checked;return n({},b,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=c?c:a._wrapperState.initialChecked})}function Ab(a,b){var c=null==b.defaultValue?"":b.defaultValue,d=null!=b.checked?b.checked:b.defaultChecked;c=rb(null!=b.value?b.value:c),a._wrapperState={initialChecked:d,initialValue:c,controlled:"checkbox"===b.type||"radio"===b.type?null!=b.checked:null!=b.value}}function Bb(a,b){null!=(b=b.checked)&&Xa(a,"checked",b,!1)}function Cb(a,b){Bb(a,b);var c=rb(b.value),d=b.type;if(null!=c)"number"===d?(0===c&&""===a.value||a.value!=c)&&(a.value=""+c):a.value!==""+c&&(a.value=""+c);else if("submit"===d||"reset"===d)return void a.removeAttribute("value");b.hasOwnProperty("value")?Db(a,b.type,c):b.hasOwnProperty("defaultValue")&&Db(a,b.type,rb(b.defaultValue)),null==b.checked&&null!=b.defaultChecked&&(a.defaultChecked=!!b.defaultChecked)}function Eb(a,b,c){if(b.hasOwnProperty("value")||b.hasOwnProperty("defaultValue")){var d=b.type;if(!("submit"!==d&&"reset"!==d||void 0!==b.value&&null!==b.value))return;b=""+a._wrapperState.initialValue,c||b===a.value||(a.value=b),a.defaultValue=b}""!==(c=a.name)&&(a.name=""),a.defaultChecked=!!a._wrapperState.initialChecked,""!==c&&(a.name=c)}function Db(a,b,c){"number"===b&&a.ownerDocument.activeElement===a||(null==c?a.defaultValue=""+a._wrapperState.initialValue:a.defaultValue!==""+c&&(a.defaultValue=""+c))}function Fb(a){var b="";return aa.Children.forEach(a,(function(a){null!=a&&(b+=a)})),b}function Gb(a,b){return a=n({children:void 0},b),(b=Fb(b.children))&&(a.children=b),a}function Hb(a,b,c,d){if(a=a.options,b){b={};for(var e=0;e<c.length;e++)b["$"+c[e]]=!0;for(c=0;c<a.length;c++)e=b.hasOwnProperty("$"+a[c].value),a[c].selected!==e&&(a[c].selected=e),e&&d&&(a[c].defaultSelected=!0)}else{for(c=""+rb(c),b=null,e=0;e<a.length;e++){if(a[e].value===c)return a[e].selected=!0,void(d&&(a[e].defaultSelected=!0));null!==b||a[e].disabled||(b=a[e])}null!==b&&(b.selected=!0)}}function Ib(a,b){if(null!=b.dangerouslySetInnerHTML)throw Error(u(91));return n({},b,{value:void 0,defaultValue:void 0,children:""+a._wrapperState.initialValue})}function Jb(a,b){var c=b.value;if(null==c){if(c=b.children,b=b.defaultValue,null!=c){if(null!=b)throw Error(u(92));if(Array.isArray(c)){if(!(1>=c.length))throw Error(u(93));c=c[0]}b=c}null==b&&(b=""),c=b}a._wrapperState={initialValue:rb(c)}}function Kb(a,b){var c=rb(b.value),d=rb(b.defaultValue);null!=c&&((c=""+c)!==a.value&&(a.value=c),null==b.defaultValue&&a.defaultValue!==c&&(a.defaultValue=c)),null!=d&&(a.defaultValue=""+d)}function Lb(a){var b=a.textContent;b===a._wrapperState.initialValue&&""!==b&&null!==b&&(a.value=b)}var Mb_html="http://www.w3.org/1999/xhtml",Mb_mathml="http://www.w3.org/1998/Math/MathML",Mb_svg="http://www.w3.org/2000/svg";function Nb(a){switch(a){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Ob(a,b){return null==a||"http://www.w3.org/1999/xhtml"===a?Nb(b):"http://www.w3.org/2000/svg"===a&&"foreignObject"===b?"http://www.w3.org/1999/xhtml":a}var Pb,Qb=function(a){return"undefined"!=typeof MSApp&&MSApp.execUnsafeLocalFunction?function(b,c,d,e){MSApp.execUnsafeLocalFunction((function(){return a(b,c,d,e)}))}:a}((function(a,b){if(a.namespaceURI!==Mb_svg||"innerHTML"in a)a.innerHTML=b;else{for((Pb=Pb||document.createElement("div")).innerHTML="<svg>"+b.valueOf().toString()+"</svg>",b=Pb.firstChild;a.firstChild;)a.removeChild(a.firstChild);for(;b.firstChild;)a.appendChild(b.firstChild)}}));function Rb(a,b){if(b){var c=a.firstChild;if(c&&c===a.lastChild&&3===c.nodeType)return void(c.nodeValue=b)}a.textContent=b}function Sb(a,b){var c={};return c[a.toLowerCase()]=b.toLowerCase(),c["Webkit"+a]="webkit"+b,c["Moz"+a]="moz"+b,c}var Tb={animationend:Sb("Animation","AnimationEnd"),animationiteration:Sb("Animation","AnimationIteration"),animationstart:Sb("Animation","AnimationStart"),transitionend:Sb("Transition","TransitionEnd")},Ub={},Vb={};function Wb(a){if(Ub[a])return Ub[a];if(!Tb[a])return a;var b=Tb[a],c;for(c in b)if(b.hasOwnProperty(c)&&c in Vb)return Ub[a]=b[c];return a}ya&&(Vb=document.createElement("div").style,"AnimationEvent"in window||(delete Tb.animationend.animation,delete Tb.animationiteration.animation,delete Tb.animationstart.animation),"TransitionEvent"in window||delete Tb.transitionend.transition);var Xb=Wb("animationend"),Yb=Wb("animationiteration"),Zb=Wb("animationstart"),$b=Wb("transitionend"),ac="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),bc=new("function"==typeof WeakMap?WeakMap:Map);function cc(a){var b=bc.get(a);return void 0===b&&(b=new Map,bc.set(a,b)),b}function dc(a){var b=a,c=a;if(a.alternate)for(;b.return;)b=b.return;else{a=b;do{0!=(1026&(b=a).effectTag)&&(c=b.return),a=b.return}while(a)}return 3===b.tag?c:null}function ec(a){if(13===a.tag){var b=a.memoizedState;if(null===b&&(null!==(a=a.alternate)&&(b=a.memoizedState)),null!==b)return b.dehydrated}return null}function fc(a){if(dc(a)!==a)throw Error(u(188))}function gc(a){var b=a.alternate;if(!b){if(null===(b=dc(a)))throw Error(u(188));return b!==a?null:a}for(var c=a,d=b;;){var e=c.return;if(null===e)break;var f=e.alternate;if(null===f){if(null!==(d=e.return)){c=d;continue}break}if(e.child===f.child){for(f=e.child;f;){if(f===c)return fc(e),a;if(f===d)return fc(e),b;f=f.sibling}throw Error(u(188))}if(c.return!==d.return)c=e,d=f;else{for(var g=!1,h=e.child;h;){if(h===c){g=!0,c=e,d=f;break}if(h===d){g=!0,d=e,c=f;break}h=h.sibling}if(!g){for(h=f.child;h;){if(h===c){g=!0,c=f,d=e;break}if(h===d){g=!0,d=f,c=e;break}h=h.sibling}if(!g)throw Error(u(189))}}if(c.alternate!==d)throw Error(u(190))}if(3!==c.tag)throw Error(u(188));return c.stateNode.current===c?a:b}function hc(a){if(!(a=gc(a)))return null;for(var b=a;;){if(5===b.tag||6===b.tag)return b;if(b.child)b.child.return=b,b=b.child;else{if(b===a)break;for(;!b.sibling;){if(!b.return||b.return===a)return null;b=b.return}b.sibling.return=b.return,b=b.sibling}}return null}function ic(a,b){if(null==b)throw Error(u(30));return null==a?b:Array.isArray(a)?Array.isArray(b)?(a.push.apply(a,b),a):(a.push(b),a):Array.isArray(b)?[a].concat(b):[a,b]}function jc(a,b,c){Array.isArray(a)?a.forEach(b,c):a&&b.call(c,a)}var kc=null;function lc(a){if(a){var b=a._dispatchListeners,c=a._dispatchInstances;if(Array.isArray(b))for(var d=0;d<b.length&&!a.isPropagationStopped();d++)oa(a,b[d],c[d]);else b&&oa(a,b,c);a._dispatchListeners=null,a._dispatchInstances=null,a.isPersistent()||a.constructor.release(a)}}function mc(a){if(null!==a&&(kc=ic(kc,a)),a=kc,kc=null,a){if(jc(a,lc),kc)throw Error(u(95));if(fa)throw a=ha,fa=!1,ha=null,a}}function nc(a){return(a=a.target||a.srcElement||window).correspondingUseElement&&(a=a.correspondingUseElement),3===a.nodeType?a.parentNode:a}function oc(a){if(!ya)return!1;var b=(a="on"+a)in document;return b||((b=document.createElement("div")).setAttribute(a,"return;"),b="function"==typeof b[a]),b}var pc=[];function qc(a){a.topLevelType=null,a.nativeEvent=null,a.targetInst=null,a.ancestors.length=0,10>pc.length&&pc.push(a)}function rc(a,b,c,d){if(pc.length){var e=pc.pop();return e.topLevelType=a,e.eventSystemFlags=d,e.nativeEvent=b,e.targetInst=c,e}return{topLevelType:a,eventSystemFlags:d,nativeEvent:b,targetInst:c,ancestors:[]}}function sc(a){var b=a.targetInst,c=b;do{if(!c){a.ancestors.push(c);break}var d=c;if(3===d.tag)d=d.stateNode.containerInfo;else{for(;d.return;)d=d.return;d=3!==d.tag?null:d.stateNode.containerInfo}if(!d)break;5!==(b=c.tag)&&6!==b||a.ancestors.push(c),c=tc(d)}while(c);for(c=0;c<a.ancestors.length;c++){b=a.ancestors[c];var e=nc(a.nativeEvent);d=a.topLevelType;var f=a.nativeEvent,g=a.eventSystemFlags;0===c&&(g|=64);for(var h=null,k=0;k<sa.length;k++){var l=sa[k];l&&(l=l.extractEvents(d,b,f,e,g))&&(h=ic(h,l))}mc(h)}}function uc(a,b,c){if(!c.has(a)){switch(a){case"scroll":vc(b,"scroll",!0);break;case"focus":case"blur":vc(b,"focus",!0),vc(b,"blur",!0),c.set("blur",null),c.set("focus",null);break;case"cancel":case"close":oc(a)&&vc(b,a,!0);break;case"invalid":case"submit":case"reset":break;default:-1===ac.indexOf(a)&&F(a,b)}c.set(a,null)}}var wc,xc,yc,zc=!1,Ac=[],Bc=null,Cc=null,Dc=null,Ec=new Map,Fc=new Map,Gc=[],Hc="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput close cancel copy cut paste click change contextmenu reset submit".split(" "),Ic="focus blur dragenter dragleave mouseover mouseout pointerover pointerout gotpointercapture lostpointercapture".split(" ");function Jc(a,b){var c=cc(b);Hc.forEach((function(a){uc(a,b,c)})),Ic.forEach((function(a){uc(a,b,c)}))}function Kc(a,b,c,d,e){return{blockedOn:a,topLevelType:b,eventSystemFlags:32|c,nativeEvent:e,container:d}}function Lc(a,b){switch(a){case"focus":case"blur":Bc=null;break;case"dragenter":case"dragleave":Cc=null;break;case"mouseover":case"mouseout":Dc=null;break;case"pointerover":case"pointerout":Ec.delete(b.pointerId);break;case"gotpointercapture":case"lostpointercapture":Fc.delete(b.pointerId)}}function Mc(a,b,c,d,e,f){return null===a||a.nativeEvent!==f?(a=Kc(b,c,d,e,f),null!==b&&(null!==(b=Nc(b))&&xc(b)),a):(a.eventSystemFlags|=d,a)}function Oc(a,b,c,d,e){switch(b){case"focus":return Bc=Mc(Bc,a,b,c,d,e),!0;case"dragenter":return Cc=Mc(Cc,a,b,c,d,e),!0;case"mouseover":return Dc=Mc(Dc,a,b,c,d,e),!0;case"pointerover":var f=e.pointerId;return Ec.set(f,Mc(Ec.get(f)||null,a,b,c,d,e)),!0;case"gotpointercapture":return f=e.pointerId,Fc.set(f,Mc(Fc.get(f)||null,a,b,c,d,e)),!0}return!1}function Pc(a){var b=tc(a.target);if(null!==b){var c=dc(b);if(null!==c)if(13===(b=c.tag)){if(null!==(b=ec(c)))return a.blockedOn=b,void r.unstable_runWithPriority(a.priority,(function(){yc(c)}))}else if(3===b&&c.stateNode.hydrate)return void(a.blockedOn=3===c.tag?c.stateNode.containerInfo:null)}a.blockedOn=null}function Qc(a){if(null!==a.blockedOn)return!1;var b=Rc(a.topLevelType,a.eventSystemFlags,a.container,a.nativeEvent);if(null!==b){var c=Nc(b);return null!==c&&xc(c),a.blockedOn=b,!1}return!0}function Sc(a,b,c){Qc(a)&&c.delete(b)}function Tc(){for(zc=!1;0<Ac.length;){var a=Ac[0];if(null!==a.blockedOn){null!==(a=Nc(a.blockedOn))&&wc(a);break}var b=Rc(a.topLevelType,a.eventSystemFlags,a.container,a.nativeEvent);null!==b?a.blockedOn=b:Ac.shift()}null!==Bc&&Qc(Bc)&&(Bc=null),null!==Cc&&Qc(Cc)&&(Cc=null),null!==Dc&&Qc(Dc)&&(Dc=null),Ec.forEach(Sc),Fc.forEach(Sc)}function Uc(a,b){a.blockedOn===b&&(a.blockedOn=null,zc||(zc=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,Tc)))}function Vc(a){function b(b){return Uc(b,a)}if(0<Ac.length){Uc(Ac[0],a);for(var c=1;c<Ac.length;c++){var d=Ac[c];d.blockedOn===a&&(d.blockedOn=null)}}for(null!==Bc&&Uc(Bc,a),null!==Cc&&Uc(Cc,a),null!==Dc&&Uc(Dc,a),Ec.forEach(b),Fc.forEach(b),c=0;c<Gc.length;c++)(d=Gc[c]).blockedOn===a&&(d.blockedOn=null);for(;0<Gc.length&&null===(c=Gc[0]).blockedOn;)Pc(c),null===c.blockedOn&&Gc.shift()}var Wc={},Yc=new Map,Zc=new Map,$c=["abort","abort",Xb,"animationEnd",Yb,"animationIteration",Zb,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata","loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",$b,"transitionEnd","waiting","waiting"];function ad(a,b){for(var c=0;c<a.length;c+=2){var d=a[c],e=a[c+1],f="on"+(e[0].toUpperCase()+e.slice(1));f={phasedRegistrationNames:{bubbled:f,captured:f+"Capture"},dependencies:[d],eventPriority:b},Zc.set(d,b),Yc.set(d,f),Wc[e]=f}}ad("blur blur cancel cancel click click close close contextmenu contextMenu copy copy cut cut auxclick auxClick dblclick doubleClick dragend dragEnd dragstart dragStart drop drop focus focus input input invalid invalid keydown keyDown keypress keyPress keyup keyUp mousedown mouseDown mouseup mouseUp paste paste pause pause play play pointercancel pointerCancel pointerdown pointerDown pointerup pointerUp ratechange rateChange reset reset seeked seeked submit submit touchcancel touchCancel touchend touchEnd touchstart touchStart volumechange volumeChange".split(" "),0),ad("drag drag dragenter dragEnter dragexit dragExit dragleave dragLeave dragover dragOver mousemove mouseMove mouseout mouseOut mouseover mouseOver pointermove pointerMove pointerout pointerOut pointerover pointerOver scroll scroll toggle toggle touchmove touchMove wheel wheel".split(" "),1),ad($c,2);for(var bd="change selectionchange textInput compositionstart compositionend compositionupdate".split(" "),cd=0;cd<bd.length;cd++)Zc.set(bd[cd],0);var dd=r.unstable_UserBlockingPriority,ed=r.unstable_runWithPriority,fd=!0;function F(a,b){vc(b,a,!1)}function vc(a,b,c){var d=Zc.get(b);switch(void 0===d?2:d){case 0:d=gd.bind(null,b,1,a);break;case 1:d=hd.bind(null,b,1,a);break;default:d=id.bind(null,b,1,a)}c?a.addEventListener(b,d,!0):a.addEventListener(b,d,!1)}function gd(a,b,c,d){Ja||Ha();var e=id,f=Ja;Ja=!0;try{Ga(e,a,b,c,d)}finally{(Ja=f)||La()}}function hd(a,b,c,d){ed(dd,id.bind(null,a,b,c,d))}function id(a,b,c,d){if(fd)if(0<Ac.length&&-1<Hc.indexOf(a))a=Kc(null,a,b,c,d),Ac.push(a);else{var e=Rc(a,b,c,d);if(null===e)Lc(a,d);else if(-1<Hc.indexOf(a))a=Kc(e,a,b,c,d),Ac.push(a);else if(!Oc(e,a,b,c,d)){Lc(a,d),a=rc(a,d,null,b);try{Ma(sc,a)}finally{qc(a)}}}}function Rc(a,b,c,d){if(null!==(c=tc(c=nc(d)))){var e=dc(c);if(null===e)c=null;else{var f=e.tag;if(13===f){if(null!==(c=ec(e)))return c;c=null}else if(3===f){if(e.stateNode.hydrate)return 3===e.tag?e.stateNode.containerInfo:null;c=null}else e!==c&&(c=null)}}a=rc(a,d,c,b);try{Ma(sc,a)}finally{qc(a)}return null}var jd={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},kd=["Webkit","ms","Moz","O"];function ld(a,b,c){return null==b||"boolean"==typeof b||""===b?"":c||"number"!=typeof b||0===b||jd.hasOwnProperty(a)&&jd[a]?(""+b).trim():b+"px"}function md(a,b){for(var c in a=a.style,b)if(b.hasOwnProperty(c)){var d=0===c.indexOf("--"),e=ld(c,b[c],d);"float"===c&&(c="cssFloat"),d?a.setProperty(c,e):a[c]=e}}Object.keys(jd).forEach((function(a){kd.forEach((function(b){b=b+a.charAt(0).toUpperCase()+a.substring(1),jd[b]=jd[a]}))}));var nd=n({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function od(a,b){if(b){if(nd[a]&&(null!=b.children||null!=b.dangerouslySetInnerHTML))throw Error(u(137,a,""));if(null!=b.dangerouslySetInnerHTML){if(null!=b.children)throw Error(u(60));if(!("object"==typeof b.dangerouslySetInnerHTML&&"__html"in b.dangerouslySetInnerHTML))throw Error(u(61))}if(null!=b.style&&"object"!=typeof b.style)throw Error(u(62,""))}}function pd(a,b){if(-1===a.indexOf("-"))return"string"==typeof b.is;switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var qd=Mb_html;function rd(a,b){var c=cc(a=9===a.nodeType||11===a.nodeType?a:a.ownerDocument);b=wa[b];for(var d=0;d<b.length;d++)uc(b[d],a,c)}function sd(){}function td(a){if(void 0===(a=a||("undefined"!=typeof document?document:void 0)))return null;try{return a.activeElement||a.body}catch(b){return a.body}}function ud(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function vd(a,b){var c=ud(a),d;for(a=0;c;){if(3===c.nodeType){if(d=a+c.textContent.length,a<=b&&d>=b)return{node:c,offset:b-a};a=d}a:{for(;c;){if(c.nextSibling){c=c.nextSibling;break a}c=c.parentNode}c=void 0}c=ud(c)}}function wd(a,b){return!(!a||!b)&&(a===b||(!a||3!==a.nodeType)&&(b&&3===b.nodeType?wd(a,b.parentNode):"contains"in a?a.contains(b):!!a.compareDocumentPosition&&!!(16&a.compareDocumentPosition(b))))}function xd(){for(var a=window,b=td();b instanceof a.HTMLIFrameElement;){try{var c="string"==typeof b.contentWindow.location.href}catch(d){c=!1}if(!c)break;b=td((a=b.contentWindow).document)}return b}function yd(a){var b=a&&a.nodeName&&a.nodeName.toLowerCase();return b&&("input"===b&&("text"===a.type||"search"===a.type||"tel"===a.type||"url"===a.type||"password"===a.type)||"textarea"===b||"true"===a.contentEditable)}var zd="$",Ad="/$",Bd="$?",Cd="$!",Dd=null,Ed=null;function Fd(a,b){switch(a){case"button":case"input":case"select":case"textarea":return!!b.autoFocus}return!1}function Gd(a,b){return"textarea"===a||"option"===a||"noscript"===a||"string"==typeof b.children||"number"==typeof b.children||"object"==typeof b.dangerouslySetInnerHTML&&null!==b.dangerouslySetInnerHTML&&null!=b.dangerouslySetInnerHTML.__html}var Hd="function"==typeof setTimeout?setTimeout:void 0,Id="function"==typeof clearTimeout?clearTimeout:void 0;function Jd(a){for(;null!=a;a=a.nextSibling){var b=a.nodeType;if(1===b||3===b)break}return a}function Kd(a){a=a.previousSibling;for(var b=0;a;){if(8===a.nodeType){var c=a.data;if(c===zd||c===Cd||c===Bd){if(0===b)return a;b--}else c===Ad&&b++}a=a.previousSibling}return null}var Ld=Math.random().toString(36).slice(2),Md="__reactInternalInstance$"+Ld,Nd="__reactEventHandlers$"+Ld,Od="__reactContainere$"+Ld;function tc(a){var b=a[Md];if(b)return b;for(var c=a.parentNode;c;){if(b=c[Od]||c[Md]){if(c=b.alternate,null!==b.child||null!==c&&null!==c.child)for(a=Kd(a);null!==a;){if(c=a[Md])return c;a=Kd(a)}return b}c=(a=c).parentNode}return null}function Nc(a){return!(a=a[Md]||a[Od])||5!==a.tag&&6!==a.tag&&13!==a.tag&&3!==a.tag?null:a}function Pd(a){if(5===a.tag||6===a.tag)return a.stateNode;throw Error(u(33))}function Qd(a){return a[Nd]||null}function Rd(a){do{a=a.return}while(a&&5!==a.tag);return a||null}function Sd(a,b){var c=a.stateNode;if(!c)return null;var d=la(c);if(!d)return null;c=d[b];a:switch(b){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(d=!d.disabled)||(d=!("button"===(a=a.type)||"input"===a||"select"===a||"textarea"===a)),a=!d;break a;default:a=!1}if(a)return null;if(c&&"function"!=typeof c)throw Error(u(231,b,typeof c));return c}function Td(a,b,c){(b=Sd(a,c.dispatchConfig.phasedRegistrationNames[b]))&&(c._dispatchListeners=ic(c._dispatchListeners,b),c._dispatchInstances=ic(c._dispatchInstances,a))}function Ud(a){if(a&&a.dispatchConfig.phasedRegistrationNames){for(var b=a._targetInst,c=[];b;)c.push(b),b=Rd(b);for(b=c.length;0<b--;)Td(c[b],"captured",a);for(b=0;b<c.length;b++)Td(c[b],"bubbled",a)}}function Vd(a,b,c){a&&c&&c.dispatchConfig.registrationName&&(b=Sd(a,c.dispatchConfig.registrationName))&&(c._dispatchListeners=ic(c._dispatchListeners,b),c._dispatchInstances=ic(c._dispatchInstances,a))}function Wd(a){a&&a.dispatchConfig.registrationName&&Vd(a._targetInst,null,a)}function Xd(a){jc(a,Ud)}var Yd=null,Zd=null,$d=null;function ae(){if($d)return $d;var a,b=Zd,c=b.length,d,e="value"in Yd?Yd.value:Yd.textContent,f=e.length;for(a=0;a<c&&b[a]===e[a];a++);var g=c-a;for(d=1;d<=g&&b[c-d]===e[f-d];d++);return $d=e.slice(a,1<d?1-d:void 0)}function be(){return!0}function ce(){return!1}function G(a,b,c,d){for(var e in this.dispatchConfig=a,this._targetInst=b,this.nativeEvent=c,a=this.constructor.Interface)a.hasOwnProperty(e)&&((b=a[e])?this[e]=b(c):"target"===e?this.target=d:this[e]=c[e]);return this.isDefaultPrevented=(null!=c.defaultPrevented?c.defaultPrevented:!1===c.returnValue)?be:ce,this.isPropagationStopped=ce,this}function ee(a,b,c,d){if(this.eventPool.length){var e=this.eventPool.pop();return this.call(e,a,b,c,d),e}return new this(a,b,c,d)}function fe(a){if(!(a instanceof this))throw Error(u(279));a.destructor(),10>this.eventPool.length&&this.eventPool.push(a)}function de(a){a.eventPool=[],a.getPooled=ee,a.release=fe}n(G.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():"unknown"!=typeof a.returnValue&&(a.returnValue=!1),this.isDefaultPrevented=be)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():"unknown"!=typeof a.cancelBubble&&(a.cancelBubble=!0),this.isPropagationStopped=be)},persist:function(){this.isPersistent=be},isPersistent:ce,destructor:function(){var a=this.constructor.Interface,b;for(b in a)this[b]=null;this.nativeEvent=this._targetInst=this.dispatchConfig=null,this.isPropagationStopped=this.isDefaultPrevented=ce,this._dispatchInstances=this._dispatchListeners=null}}),G.Interface={type:null,target:null,currentTarget:function(){return null},eventPhase:null,bubbles:null,cancelable:null,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:null,isTrusted:null},G.extend=function(a){function b(){}function c(){return d.apply(this,arguments)}var d=this;b.prototype=d.prototype;var e=new b;return n(e,c.prototype),c.prototype=e,c.prototype.constructor=c,c.Interface=n({},d.Interface,a),c.extend=d.extend,de(c),c},de(G);var ge=G.extend({data:null}),he=G.extend({data:null}),ie=[9,13,27,32],je=ya&&"CompositionEvent"in window,ke=null;ya&&"documentMode"in document&&(ke=document.documentMode);var le=ya&&"TextEvent"in window&&!ke,me=ya&&(!je||ke&&8<ke&&11>=ke),ne=String.fromCharCode(32),oe={beforeInput:{phasedRegistrationNames:{bubbled:"onBeforeInput",captured:"onBeforeInputCapture"},dependencies:["compositionend","keypress","textInput","paste"]},compositionEnd:{phasedRegistrationNames:{bubbled:"onCompositionEnd",captured:"onCompositionEndCapture"},dependencies:"blur compositionend keydown keypress keyup mousedown".split(" ")},compositionStart:{phasedRegistrationNames:{bubbled:"onCompositionStart",captured:"onCompositionStartCapture"},dependencies:"blur compositionstart keydown keypress keyup mousedown".split(" ")},compositionUpdate:{phasedRegistrationNames:{bubbled:"onCompositionUpdate",captured:"onCompositionUpdateCapture"},dependencies:"blur compositionupdate keydown keypress keyup mousedown".split(" ")}},pe=!1;function qe(a,b){switch(a){case"keyup":return-1!==ie.indexOf(b.keyCode);case"keydown":return 229!==b.keyCode;case"keypress":case"mousedown":case"blur":return!0;default:return!1}}function re(a){return"object"==typeof(a=a.detail)&&"data"in a?a.data:null}var se=!1;function te(a,b){switch(a){case"compositionend":return re(b);case"keypress":return 32!==b.which?null:(pe=!0,ne);case"textInput":return(a=b.data)===ne&&pe?null:a;default:return null}}function ue(a,b){if(se)return"compositionend"===a||!je&&qe(a,b)?(a=ae(),$d=Zd=Yd=null,se=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(b.ctrlKey||b.altKey||b.metaKey)||b.ctrlKey&&b.altKey){if(b.char&&1<b.char.length)return b.char;if(b.which)return String.fromCharCode(b.which)}return null;case"compositionend":return me&&"ko"!==b.locale?null:b.data;default:return null}}var ve={eventTypes:oe,extractEvents:function(a,b,c,d){var e;if(je)b:{switch(a){case"compositionstart":var f=oe.compositionStart;break b;case"compositionend":f=oe.compositionEnd;break b;case"compositionupdate":f=oe.compositionUpdate;break b}f=void 0}else se?qe(a,c)&&(f=oe.compositionEnd):"keydown"===a&&229===c.keyCode&&(f=oe.compositionStart);return f?(me&&"ko"!==c.locale&&(se||f!==oe.compositionStart?f===oe.compositionEnd&&se&&(e=ae()):(Zd="value"in(Yd=d)?Yd.value:Yd.textContent,se=!0)),f=ge.getPooled(f,b,c,d),e?f.data=e:null!==(e=re(c))&&(f.data=e),Xd(f),e=f):e=null,(a=le?te(a,c):ue(a,c))?((b=he.getPooled(oe.beforeInput,b,c,d)).data=a,Xd(b)):b=null,null===e?b:null===b?e:[e,b]}},we={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function xe(a){var b=a&&a.nodeName&&a.nodeName.toLowerCase();return"input"===b?!!we[a.type]:"textarea"===b}var ye={change:{phasedRegistrationNames:{bubbled:"onChange",captured:"onChangeCapture"},dependencies:"blur change click focus input keydown keyup selectionchange".split(" ")}};function ze(a,b,c){return(a=G.getPooled(ye.change,a,b,c)).type="change",Da(c),Xd(a),a}var Ae=null,Be=null;function Ce(a){mc(a)}function De(a){var b;if(yb(Pd(a)))return a}function Ee(a,b){if("change"===a)return b}var Fe=!1;function Ge(){Ae&&(Ae.detachEvent("onpropertychange",He),Be=Ae=null)}function He(a){if("value"===a.propertyName&&De(Be))if(a=ze(Be,a,nc(a)),Ja)mc(a);else{Ja=!0;try{Fa(Ce,a)}finally{Ja=!1,La()}}}function Ie(a,b,c){"focus"===a?(Ge(),Be=c,(Ae=b).attachEvent("onpropertychange",He)):"blur"===a&&Ge()}function Je(a){if("selectionchange"===a||"keyup"===a||"keydown"===a)return De(Be)}function Ke(a,b){if("click"===a)return De(b)}function Le(a,b){if("input"===a||"change"===a)return De(b)}ya&&(Fe=oc("input")&&(!document.documentMode||9<document.documentMode));var Me={eventTypes:ye,_isInputEventSupported:Fe,extractEvents:function(a,b,c,d){var e=b?Pd(b):window,f=e.nodeName&&e.nodeName.toLowerCase();if("select"===f||"input"===f&&"file"===e.type)var g=Ee;else if(xe(e))if(Fe)g=Le;else{g=Je;var h=Ie}else(f=e.nodeName)&&"input"===f.toLowerCase()&&("checkbox"===e.type||"radio"===e.type)&&(g=Ke);if(g&&(g=g(a,b)))return ze(g,c,d);h&&h(a,e,b),"blur"===a&&(a=e._wrapperState)&&a.controlled&&"number"===e.type&&Db(e,"number",e.value)}},Ne=G.extend({view:null,detail:null}),Oe={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Pe(a){var b=this.nativeEvent;return b.getModifierState?b.getModifierState(a):!!(a=Oe[a])&&!!b[a]}function Qe(){return Pe}var Re=0,Se=0,Te=!1,Ue=!1,Ve=Ne.extend({screenX:null,screenY:null,clientX:null,clientY:null,pageX:null,pageY:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,getModifierState:Qe,button:null,buttons:null,relatedTarget:function(a){return a.relatedTarget||(a.fromElement===a.srcElement?a.toElement:a.fromElement)},movementX:function(a){if("movementX"in a)return a.movementX;var b=Re;return Re=a.screenX,Te?"mousemove"===a.type?a.screenX-b:0:(Te=!0,0)},movementY:function(a){if("movementY"in a)return a.movementY;var b=Se;return Se=a.screenY,Ue?"mousemove"===a.type?a.screenY-b:0:(Ue=!0,0)}}),We=Ve.extend({pointerId:null,width:null,height:null,pressure:null,tangentialPressure:null,tiltX:null,tiltY:null,twist:null,pointerType:null,isPrimary:null}),Xe={mouseEnter:{registrationName:"onMouseEnter",dependencies:["mouseout","mouseover"]},mouseLeave:{registrationName:"onMouseLeave",dependencies:["mouseout","mouseover"]},pointerEnter:{registrationName:"onPointerEnter",dependencies:["pointerout","pointerover"]},pointerLeave:{registrationName:"onPointerLeave",dependencies:["pointerout","pointerover"]}},Ye={eventTypes:Xe,extractEvents:function(a,b,c,d,e){var f="mouseover"===a||"pointerover"===a,g="mouseout"===a||"pointerout"===a,h;if(f&&0==(32&e)&&(c.relatedTarget||c.fromElement)||!g&&!f)return null;(f=d.window===d?d:(f=d.ownerDocument)?f.defaultView||f.parentWindow:window,g)?(g=b,null!==(b=(b=c.relatedTarget||c.toElement)?tc(b):null)&&(b!==dc(b)||5!==b.tag&&6!==b.tag)&&(b=null)):g=null;if(g===b)return null;if("mouseout"===a||"mouseover"===a)var k=Ve,l=Xe.mouseLeave,m=Xe.mouseEnter,p="mouse";else"pointerout"!==a&&"pointerover"!==a||(k=We,l=Xe.pointerLeave,m=Xe.pointerEnter,p="pointer");if(a=null==g?f:Pd(g),f=null==b?f:Pd(b),(l=k.getPooled(l,g,c,d)).type=p+"leave",l.target=a,l.relatedTarget=f,(c=k.getPooled(m,b,c,d)).type=p+"enter",c.target=f,c.relatedTarget=a,p=b,(d=g)&&p)a:{for(m=p,g=0,a=k=d;a;a=Rd(a))g++;for(a=0,b=m;b;b=Rd(b))a++;for(;0<g-a;)k=Rd(k),g--;for(;0<a-g;)m=Rd(m),a--;for(;g--;){if(k===m||k===m.alternate)break a;k=Rd(k),m=Rd(m)}k=null}else k=null;for(m=k,k=[];d&&d!==m&&(null===(g=d.alternate)||g!==m);)k.push(d),d=Rd(d);for(d=[];p&&p!==m&&(null===(g=p.alternate)||g!==m);)d.push(p),p=Rd(p);for(p=0;p<k.length;p++)Vd(k[p],"bubbled",l);for(p=d.length;0<p--;)Vd(d[p],"captured",c);return 0==(64&e)?[l]:[l,c]}};function Ze(a,b){return a===b&&(0!==a||1/a==1/b)||a!=a&&b!=b}var $e="function"==typeof Object.is?Object.is:Ze,af=Object.prototype.hasOwnProperty;function bf(a,b){if($e(a,b))return!0;if("object"!=typeof a||null===a||"object"!=typeof b||null===b)return!1;var c=Object.keys(a),d=Object.keys(b);if(c.length!==d.length)return!1;for(d=0;d<c.length;d++)if(!af.call(b,c[d])||!$e(a[c[d]],b[c[d]]))return!1;return!0}var cf=ya&&"documentMode"in document&&11>=document.documentMode,df={select:{phasedRegistrationNames:{bubbled:"onSelect",captured:"onSelectCapture"},dependencies:"blur contextmenu dragend focus keydown keyup mousedown mouseup selectionchange".split(" ")}},ef=null,ff=null,gf=null,hf=!1;function jf(a,b){var c=b.window===b?b.document:9===b.nodeType?b:b.ownerDocument;return hf||null==ef||ef!==td(c)?null:("selectionStart"in(c=ef)&&yd(c)?c={start:c.selectionStart,end:c.selectionEnd}:c={anchorNode:(c=(c.ownerDocument&&c.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:c.anchorOffset,focusNode:c.focusNode,focusOffset:c.focusOffset},gf&&bf(gf,c)?null:(gf=c,(a=G.getPooled(df.select,ff,a,b)).type="select",a.target=ef,Xd(a),a))}var kf={eventTypes:df,extractEvents:function(a,b,c,d,e,f){if(!(f=!(e=f||(d.window===d?d.document:9===d.nodeType?d:d.ownerDocument)))){a:{e=cc(e),f=wa.onSelect;for(var g=0;g<f.length;g++)if(!e.has(f[g])){e=!1;break a}e=!0}f=!e}if(f)return null;switch(e=b?Pd(b):window,a){case"focus":(xe(e)||"true"===e.contentEditable)&&(ef=e,ff=b,gf=null);break;case"blur":gf=ff=ef=null;break;case"mousedown":hf=!0;break;case"contextmenu":case"mouseup":case"dragend":return hf=!1,jf(c,d);case"selectionchange":if(cf)break;case"keydown":case"keyup":return jf(c,d)}return null}},lf=G.extend({animationName:null,elapsedTime:null,pseudoElement:null}),mf=G.extend({clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),nf=Ne.extend({relatedTarget:null});function of(a){var b=a.keyCode;return"charCode"in a?0===(a=a.charCode)&&13===b&&(a=13):a=b,10===a&&(a=13),32<=a||13===a?a:0}var pf={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},qf={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},rf=Ne.extend({key:function(a){if(a.key){var b=pf[a.key]||a.key;if("Unidentified"!==b)return b}return"keypress"===a.type?13===(a=of(a))?"Enter":String.fromCharCode(a):"keydown"===a.type||"keyup"===a.type?qf[a.keyCode]||"Unidentified":""},location:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,repeat:null,locale:null,getModifierState:Qe,charCode:function(a){return"keypress"===a.type?of(a):0},keyCode:function(a){return"keydown"===a.type||"keyup"===a.type?a.keyCode:0},which:function(a){return"keypress"===a.type?of(a):"keydown"===a.type||"keyup"===a.type?a.keyCode:0}}),sf=Ve.extend({dataTransfer:null}),tf=Ne.extend({touches:null,targetTouches:null,changedTouches:null,altKey:null,metaKey:null,ctrlKey:null,shiftKey:null,getModifierState:Qe}),uf=G.extend({propertyName:null,elapsedTime:null,pseudoElement:null}),vf=Ve.extend({deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:null,deltaMode:null}),wf={eventTypes:Wc,extractEvents:function(a,b,c,d){var e=Yc.get(a);if(!e)return null;switch(a){case"keypress":if(0===of(c))return null;case"keydown":case"keyup":a=rf;break;case"blur":case"focus":a=nf;break;case"click":if(2===c.button)return null;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":a=Ve;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":a=sf;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":a=tf;break;case Xb:case Yb:case Zb:a=lf;break;case $b:a=uf;break;case"scroll":a=Ne;break;case"wheel":a=vf;break;case"copy":case"cut":case"paste":a=mf;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":a=We;break;default:a=G}return Xd(b=a.getPooled(e,b,c,d)),b}},xf;if(pa)throw Error(u(101));pa=Array.prototype.slice.call("ResponderEventPlugin SimpleEventPlugin EnterLeaveEventPlugin ChangeEventPlugin SelectEventPlugin BeforeInputEventPlugin".split(" ")),ra(),la=Qd,ma=Nc,na=Pd,xa({SimpleEventPlugin:wf,EnterLeaveEventPlugin:Ye,ChangeEventPlugin:Me,SelectEventPlugin:kf,BeforeInputEventPlugin:ve});var yf=[],zf=-1;function H(a){0>zf||(a.current=yf[zf],yf[zf]=null,zf--)}function I(a,b){zf++,yf[zf]=a.current,a.current=b}var Af={},J={current:Af},K={current:!1},Bf=Af;function Cf(a,b){var c=a.type.contextTypes;if(!c)return Af;var d=a.stateNode;if(d&&d.__reactInternalMemoizedUnmaskedChildContext===b)return d.__reactInternalMemoizedMaskedChildContext;var e={},f;for(f in c)e[f]=b[f];return d&&((a=a.stateNode).__reactInternalMemoizedUnmaskedChildContext=b,a.__reactInternalMemoizedMaskedChildContext=e),e}function L(a){return null!=(a=a.childContextTypes)}function Df(){H(K),H(J)}function Ef(a,b,c){if(J.current!==Af)throw Error(u(168));I(J,b),I(K,c)}function Ff(a,b,c){var d=a.stateNode;if(a=b.childContextTypes,"function"!=typeof d.getChildContext)return c;for(var e in d=d.getChildContext())if(!(e in a))throw Error(u(108,pb(b)||"Unknown",e));return n({},c,{},d)}function Gf(a){return a=(a=a.stateNode)&&a.__reactInternalMemoizedMergedChildContext||Af,Bf=J.current,I(J,a),I(K,K.current),!0}function Hf(a,b,c){var d=a.stateNode;if(!d)throw Error(u(169));c?(a=Ff(a,b,Bf),d.__reactInternalMemoizedMergedChildContext=a,H(K),H(J),I(J,a)):H(K),I(K,c)}var If=r.unstable_runWithPriority,Jf=r.unstable_scheduleCallback,Kf=r.unstable_cancelCallback,Lf=r.unstable_requestPaint,Mf=r.unstable_now,Nf=r.unstable_getCurrentPriorityLevel,Of=r.unstable_ImmediatePriority,Pf=r.unstable_UserBlockingPriority,Qf=r.unstable_NormalPriority,Rf=r.unstable_LowPriority,Sf=r.unstable_IdlePriority,Tf={},Uf=r.unstable_shouldYield,Vf=void 0!==Lf?Lf:function(){},Wf=null,Xf=null,Yf=!1,Zf=Mf(),$f=1e4>Zf?Mf:function(){return Mf()-Zf};function ag(){switch(Nf()){case Of:return 99;case Pf:return 98;case Qf:return 97;case Rf:return 96;case Sf:return 95;default:throw Error(u(332))}}function bg(a){switch(a){case 99:return Of;case 98:return Pf;case 97:return Qf;case 96:return Rf;case 95:return Sf;default:throw Error(u(332))}}function cg(a,b){return a=bg(a),If(a,b)}function dg(a,b,c){return a=bg(a),Jf(a,b,c)}function eg(a){return null===Wf?(Wf=[a],Xf=Jf(Of,fg)):Wf.push(a),Tf}function gg(){if(null!==Xf){var a=Xf;Xf=null,Kf(a)}fg()}function fg(){if(!Yf&&null!==Wf){Yf=!0;var a=0;try{var b=Wf;cg(99,(function(){for(;a<b.length;a++){var c=b[a];do{c=c(!0)}while(null!==c)}})),Wf=null}catch(c){throw null!==Wf&&(Wf=Wf.slice(a+1)),Jf(Of,gg),c}finally{Yf=!1}}}function hg(a,b,c){return 1073741821-(1+((1073741821-a+b/10)/(c/=10)|0))*c}function ig(a,b){if(a&&a.defaultProps)for(var c in b=n({},b),a=a.defaultProps)void 0===b[c]&&(b[c]=a[c]);return b}var jg={current:null},kg=null,lg=null,mg=null;function ng(){mg=lg=kg=null}function og(a){var b=jg.current;H(jg),a.type._context._currentValue=b}function pg(a,b){for(;null!==a;){var c=a.alternate;if(a.childExpirationTime<b)a.childExpirationTime=b,null!==c&&c.childExpirationTime<b&&(c.childExpirationTime=b);else{if(!(null!==c&&c.childExpirationTime<b))break;c.childExpirationTime=b}a=a.return}}function qg(a,b){kg=a,mg=lg=null,null!==(a=a.dependencies)&&null!==a.firstContext&&(a.expirationTime>=b&&(rg=!0),a.firstContext=null)}function sg(a,b){if(mg!==a&&!1!==b&&0!==b)if("number"==typeof b&&1073741823!==b||(mg=a,b=1073741823),b={context:a,observedBits:b,next:null},null===lg){if(null===kg)throw Error(u(308));lg=b,kg.dependencies={expirationTime:0,firstContext:b,responders:null}}else lg=lg.next=b;return a._currentValue}var tg=!1;function ug(a){a.updateQueue={baseState:a.memoizedState,baseQueue:null,shared:{pending:null},effects:null}}function vg(a,b){a=a.updateQueue,b.updateQueue===a&&(b.updateQueue={baseState:a.baseState,baseQueue:a.baseQueue,shared:a.shared,effects:a.effects})}function wg(a,b){return(a={expirationTime:a,suspenseConfig:b,tag:0,payload:null,callback:null,next:null}).next=a}function xg(a,b){if(null!==(a=a.updateQueue)){var c=(a=a.shared).pending;null===c?b.next=b:(b.next=c.next,c.next=b),a.pending=b}}function yg(a,b){var c=a.alternate;null!==c&&vg(c,a),null===(c=(a=a.updateQueue).baseQueue)?(a.baseQueue=b.next=b,b.next=b):(b.next=c.next,c.next=b)}function zg(a,b,c,d){var e=a.updateQueue;tg=!1;var f=e.baseQueue,g=e.shared.pending;if(null!==g){if(null!==f){var h=f.next;f.next=g.next,g.next=h}f=g,e.shared.pending=null,null!==(h=a.alternate)&&(null!==(h=h.updateQueue)&&(h.baseQueue=g))}if(null!==f){h=f.next;var k=e.baseState,l=0,m=null,p=null,x=null;if(null!==h)for(var z=h;;){if((g=z.expirationTime)<d){var ca={expirationTime:z.expirationTime,suspenseConfig:z.suspenseConfig,tag:z.tag,payload:z.payload,callback:z.callback,next:null};null===x?(p=x=ca,m=k):x=x.next=ca,g>l&&(l=g)}else{null!==x&&(x=x.next={expirationTime:1073741823,suspenseConfig:z.suspenseConfig,tag:z.tag,payload:z.payload,callback:z.callback,next:null}),Ag(g,z.suspenseConfig);a:{var D=a,t=z;switch(g=b,ca=c,t.tag){case 1:if("function"==typeof(D=t.payload)){k=D.call(ca,k,g);break a}k=D;break a;case 3:D.effectTag=-4097&D.effectTag|64;case 0:if(null==(g="function"==typeof(D=t.payload)?D.call(ca,k,g):D))break a;k=n({},k,g);break a;case 2:tg=!0}}null!==z.callback&&(a.effectTag|=32,null===(g=e.effects)?e.effects=[z]:g.push(z))}if(null===(z=z.next)||z===h){if(null===(g=e.shared.pending))break;z=f.next=g.next,g.next=h,e.baseQueue=f=g,e.shared.pending=null}}null===x?m=k:x.next=p,e.baseState=m,e.baseQueue=x,Bg(l),a.expirationTime=l,a.memoizedState=k}}function Cg(a,b,c){if(a=b.effects,b.effects=null,null!==a)for(b=0;b<a.length;b++){var d=a[b],e=d.callback;if(null!==e){if(d.callback=null,d=e,e=c,"function"!=typeof d)throw Error(u(191,d));d.call(e)}}}var Dg=Wa.ReactCurrentBatchConfig,Eg=(new aa.Component).refs;function Fg(a,b,c,d){c=null==(c=c(d,b=a.memoizedState))?b:n({},b,c),a.memoizedState=c,0===a.expirationTime&&(a.updateQueue.baseState=c)}var Jg={isMounted:function(a){return!!(a=a._reactInternalFiber)&&dc(a)===a},enqueueSetState:function(a,b,c){a=a._reactInternalFiber;var d=Gg(),e=Dg.suspense;(e=wg(d=Hg(d,a,e),e)).payload=b,null!=c&&(e.callback=c),xg(a,e),Ig(a,d)},enqueueReplaceState:function(a,b,c){a=a._reactInternalFiber;var d=Gg(),e=Dg.suspense;(e=wg(d=Hg(d,a,e),e)).tag=1,e.payload=b,null!=c&&(e.callback=c),xg(a,e),Ig(a,d)},enqueueForceUpdate:function(a,b){a=a._reactInternalFiber;var c=Gg(),d=Dg.suspense;(d=wg(c=Hg(c,a,d),d)).tag=2,null!=b&&(d.callback=b),xg(a,d),Ig(a,c)}};function Kg(a,b,c,d,e,f,g){return"function"==typeof(a=a.stateNode).shouldComponentUpdate?a.shouldComponentUpdate(d,f,g):!b.prototype||!b.prototype.isPureReactComponent||(!bf(c,d)||!bf(e,f))}function Lg(a,b,c){var d=!1,e=Af,f=b.contextType;return"object"==typeof f&&null!==f?f=sg(f):(e=L(b)?Bf:J.current,f=(d=null!=(d=b.contextTypes))?Cf(a,e):Af),b=new b(c,f),a.memoizedState=null!==b.state&&void 0!==b.state?b.state:null,b.updater=Jg,a.stateNode=b,b._reactInternalFiber=a,d&&((a=a.stateNode).__reactInternalMemoizedUnmaskedChildContext=e,a.__reactInternalMemoizedMaskedChildContext=f),b}function Mg(a,b,c,d){a=b.state,"function"==typeof b.componentWillReceiveProps&&b.componentWillReceiveProps(c,d),"function"==typeof b.UNSAFE_componentWillReceiveProps&&b.UNSAFE_componentWillReceiveProps(c,d),b.state!==a&&Jg.enqueueReplaceState(b,b.state,null)}function Ng(a,b,c,d){var e=a.stateNode;e.props=c,e.state=a.memoizedState,e.refs=Eg,ug(a);var f=b.contextType;"object"==typeof f&&null!==f?e.context=sg(f):(f=L(b)?Bf:J.current,e.context=Cf(a,f)),zg(a,c,e,d),e.state=a.memoizedState,"function"==typeof(f=b.getDerivedStateFromProps)&&(Fg(a,b,f,c),e.state=a.memoizedState),"function"==typeof b.getDerivedStateFromProps||"function"==typeof e.getSnapshotBeforeUpdate||"function"!=typeof e.UNSAFE_componentWillMount&&"function"!=typeof e.componentWillMount||(b=e.state,"function"==typeof e.componentWillMount&&e.componentWillMount(),"function"==typeof e.UNSAFE_componentWillMount&&e.UNSAFE_componentWillMount(),b!==e.state&&Jg.enqueueReplaceState(e,e.state,null),zg(a,c,e,d),e.state=a.memoizedState),"function"==typeof e.componentDidMount&&(a.effectTag|=4)}var Og=Array.isArray;function Pg(a,b,c){if(null!==(a=c.ref)&&"function"!=typeof a&&"object"!=typeof a){if(c._owner){if(c=c._owner){if(1!==c.tag)throw Error(u(309));var d=c.stateNode}if(!d)throw Error(u(147,a));var e=""+a;return null!==b&&null!==b.ref&&"function"==typeof b.ref&&b.ref._stringRef===e?b.ref:((b=function(a){var b=d.refs;b===Eg&&(b=d.refs={}),null===a?delete b[e]:b[e]=a})._stringRef=e,b)}if("string"!=typeof a)throw Error(u(284));if(!c._owner)throw Error(u(290,a))}return a}function Qg(a,b){if("textarea"!==a.type)throw Error(u(31,"[object Object]"===Object.prototype.toString.call(b)?"object with keys {"+Object.keys(b).join(", ")+"}":b,""))}function Rg(a){function b(b,c){if(a){var d=b.lastEffect;null!==d?(d.nextEffect=c,b.lastEffect=c):b.firstEffect=b.lastEffect=c,c.nextEffect=null,c.effectTag=8}}function c(c,d){if(!a)return null;for(;null!==d;)b(c,d),d=d.sibling;return null}function d(a,b){for(a=new Map;null!==b;)null!==b.key?a.set(b.key,b):a.set(b.index,b),b=b.sibling;return a}function e(a,b){return(a=Sg(a,b)).index=0,a.sibling=null,a}function f(b,c,d){return b.index=d,a?null!==(d=b.alternate)?(d=d.index)<c?(b.effectTag=2,c):d:(b.effectTag=2,c):c}function g(b){return a&&null===b.alternate&&(b.effectTag=2),b}function h(a,b,c,d){return null===b||6!==b.tag?((b=Tg(c,a.mode,d)).return=a,b):((b=e(b,c)).return=a,b)}function k(a,b,c,d){return null!==b&&b.elementType===c.type?((d=e(b,c.props)).ref=Pg(a,b,c),d.return=a,d):((d=Ug(c.type,c.key,c.props,null,a.mode,d)).ref=Pg(a,b,c),d.return=a,d)}function l(a,b,c,d){return null===b||4!==b.tag||b.stateNode.containerInfo!==c.containerInfo||b.stateNode.implementation!==c.implementation?((b=Vg(c,a.mode,d)).return=a,b):((b=e(b,c.children||[])).return=a,b)}function m(a,b,c,d,f){return null===b||7!==b.tag?((b=Wg(c,a.mode,d,f)).return=a,b):((b=e(b,c)).return=a,b)}function p(a,b,c){if("string"==typeof b||"number"==typeof b)return(b=Tg(""+b,a.mode,c)).return=a,b;if("object"==typeof b&&null!==b){switch(b.$$typeof){case Za:return(c=Ug(b.type,b.key,b.props,null,a.mode,c)).ref=Pg(a,null,b),c.return=a,c;case $a:return(b=Vg(b,a.mode,c)).return=a,b}if(Og(b)||nb(b))return(b=Wg(b,a.mode,c,null)).return=a,b;Qg(a,b)}return null}function x(a,b,c,d){var e=null!==b?b.key:null;if("string"==typeof c||"number"==typeof c)return null!==e?null:h(a,b,""+c,d);if("object"==typeof c&&null!==c){switch(c.$$typeof){case Za:return c.key===e?c.type===ab?m(a,b,c.props.children,d,e):k(a,b,c,d):null;case $a:return c.key===e?l(a,b,c,d):null}if(Og(c)||nb(c))return null!==e?null:m(a,b,c,d,null);Qg(a,c)}return null}function z(a,b,c,d,e){if("string"==typeof d||"number"==typeof d)return h(b,a=a.get(c)||null,""+d,e);if("object"==typeof d&&null!==d){switch(d.$$typeof){case Za:return a=a.get(null===d.key?c:d.key)||null,d.type===ab?m(b,a,d.props.children,e,d.key):k(b,a,d,e);case $a:return l(b,a=a.get(null===d.key?c:d.key)||null,d,e)}if(Og(d)||nb(d))return m(b,a=a.get(c)||null,d,e,null);Qg(b,d)}return null}function ca(e,g,h,k){for(var l=null,t=null,m=g,y=g=0,A=null;null!==m&&y<h.length;y++){m.index>y?(A=m,m=null):A=m.sibling;var q=x(e,m,h[y],k);if(null===q){null===m&&(m=A);break}a&&m&&null===q.alternate&&b(e,m),g=f(q,g,y),null===t?l=q:t.sibling=q,t=q,m=A}if(y===h.length)return c(e,m),l;if(null===m){for(;y<h.length;y++)null!==(m=p(e,h[y],k))&&(g=f(m,g,y),null===t?l=m:t.sibling=m,t=m);return l}for(m=d(e,m);y<h.length;y++)null!==(A=z(m,e,y,h[y],k))&&(a&&null!==A.alternate&&m.delete(null===A.key?y:A.key),g=f(A,g,y),null===t?l=A:t.sibling=A,t=A);return a&&m.forEach((function(a){return b(e,a)})),l}function D(e,g,h,l){var k=nb(h);if("function"!=typeof k)throw Error(u(150));if(null==(h=k.call(h)))throw Error(u(151));for(var m=k=null,t=g,y=g=0,A=null,q=h.next();null!==t&&!q.done;y++,q=h.next()){t.index>y?(A=t,t=null):A=t.sibling;var D=x(e,t,q.value,l);if(null===D){null===t&&(t=A);break}a&&t&&null===D.alternate&&b(e,t),g=f(D,g,y),null===m?k=D:m.sibling=D,m=D,t=A}if(q.done)return c(e,t),k;if(null===t){for(;!q.done;y++,q=h.next())null!==(q=p(e,q.value,l))&&(g=f(q,g,y),null===m?k=q:m.sibling=q,m=q);return k}for(t=d(e,t);!q.done;y++,q=h.next())null!==(q=z(t,e,y,q.value,l))&&(a&&null!==q.alternate&&t.delete(null===q.key?y:q.key),g=f(q,g,y),null===m?k=q:m.sibling=q,m=q);return a&&t.forEach((function(a){return b(e,a)})),k}return function(a,d,f,h){var k="object"==typeof f&&null!==f&&f.type===ab&&null===f.key;k&&(f=f.props.children);var l="object"==typeof f&&null!==f;if(l)switch(f.$$typeof){case Za:a:{for(l=f.key,k=d;null!==k;){if(k.key===l){switch(k.tag){case 7:if(f.type===ab){c(a,k.sibling),(d=e(k,f.props.children)).return=a,a=d;break a}break;default:if(k.elementType===f.type){c(a,k.sibling),(d=e(k,f.props)).ref=Pg(a,k,f),d.return=a,a=d;break a}}c(a,k);break}b(a,k),k=k.sibling}f.type===ab?((d=Wg(f.props.children,a.mode,h,f.key)).return=a,a=d):((h=Ug(f.type,f.key,f.props,null,a.mode,h)).ref=Pg(a,d,f),h.return=a,a=h)}return g(a);case $a:a:{for(k=f.key;null!==d;){if(d.key===k){if(4===d.tag&&d.stateNode.containerInfo===f.containerInfo&&d.stateNode.implementation===f.implementation){c(a,d.sibling),(d=e(d,f.children||[])).return=a,a=d;break a}c(a,d);break}b(a,d),d=d.sibling}(d=Vg(f,a.mode,h)).return=a,a=d}return g(a)}if("string"==typeof f||"number"==typeof f)return f=""+f,null!==d&&6===d.tag?(c(a,d.sibling),(d=e(d,f)).return=a,a=d):(c(a,d),(d=Tg(f,a.mode,h)).return=a,a=d),g(a);if(Og(f))return ca(a,d,f,h);if(nb(f))return D(a,d,f,h);if(l&&Qg(a,f),void 0===f&&!k)switch(a.tag){case 1:case 0:throw a=a.type,Error(u(152,a.displayName||a.name||"Component"))}return c(a,d)}}var Xg=Rg(!0),Yg=Rg(!1),Zg={},$g={current:Zg},ah={current:Zg},bh={current:Zg};function ch(a){if(a===Zg)throw Error(u(174));return a}function dh(a,b){switch(I(bh,b),I(ah,a),I($g,Zg),a=b.nodeType){case 9:case 11:b=(b=b.documentElement)?b.namespaceURI:Ob(null,"");break;default:b=Ob(b=(a=8===a?b.parentNode:b).namespaceURI||null,a=a.tagName)}H($g),I($g,b)}function eh(){H($g),H(ah),H(bh)}function fh(a){ch(bh.current);var b=ch($g.current),c=Ob(b,a.type);b!==c&&(I(ah,a),I($g,c))}function gh(a){ah.current===a&&(H($g),H(ah))}var M={current:0};function hh(a){for(var b=a;null!==b;){if(13===b.tag){var c=b.memoizedState;if(null!==c&&(null===(c=c.dehydrated)||c.data===Bd||c.data===Cd))return b}else if(19===b.tag&&void 0!==b.memoizedProps.revealOrder){if(0!=(64&b.effectTag))return b}else if(null!==b.child){b.child.return=b,b=b.child;continue}if(b===a)break;for(;null===b.sibling;){if(null===b.return||b.return===a)return null;b=b.return}b.sibling.return=b.return,b=b.sibling}return null}function ih(a,b){return{responder:a,props:b}}var jh=Wa.ReactCurrentDispatcher,kh=Wa.ReactCurrentBatchConfig,lh=0,N=null,O=null,P=null,mh=!1;function Q(){throw Error(u(321))}function nh(a,b){if(null===b)return!1;for(var c=0;c<b.length&&c<a.length;c++)if(!$e(a[c],b[c]))return!1;return!0}function oh(a,b,c,d,e,f){if(lh=f,N=b,b.memoizedState=null,b.updateQueue=null,b.expirationTime=0,jh.current=null===a||null===a.memoizedState?ph:qh,a=c(d,e),b.expirationTime===lh){f=0;do{if(b.expirationTime=0,!(25>f))throw Error(u(301));f+=1,P=O=null,b.updateQueue=null,jh.current=rh,a=c(d,e)}while(b.expirationTime===lh)}if(jh.current=sh,b=null!==O&&null!==O.next,lh=0,P=O=N=null,mh=!1,b)throw Error(u(300));return a}function th(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===P?N.memoizedState=P=a:P=P.next=a,P}function uh(){if(null===O){var a=N.alternate;a=null!==a?a.memoizedState:null}else a=O.next;var b=null===P?N.memoizedState:P.next;if(null!==b)P=b,O=a;else{if(null===a)throw Error(u(310));a={memoizedState:(O=a).memoizedState,baseState:O.baseState,baseQueue:O.baseQueue,queue:O.queue,next:null},null===P?N.memoizedState=P=a:P=P.next=a}return P}function vh(a,b){return"function"==typeof b?b(a):b}function wh(a){var b=uh(),c=b.queue;if(null===c)throw Error(u(311));c.lastRenderedReducer=a;var d=O,e=d.baseQueue,f=c.pending;if(null!==f){if(null!==e){var g=e.next;e.next=f.next,f.next=g}d.baseQueue=e=f,c.pending=null}if(null!==e){e=e.next,d=d.baseState;var h=g=f=null,k=e;do{var l=k.expirationTime;if(l<lh){var m={expirationTime:k.expirationTime,suspenseConfig:k.suspenseConfig,action:k.action,eagerReducer:k.eagerReducer,eagerState:k.eagerState,next:null};null===h?(g=h=m,f=d):h=h.next=m,l>N.expirationTime&&(N.expirationTime=l,Bg(l))}else null!==h&&(h=h.next={expirationTime:1073741823,suspenseConfig:k.suspenseConfig,action:k.action,eagerReducer:k.eagerReducer,eagerState:k.eagerState,next:null}),Ag(l,k.suspenseConfig),d=k.eagerReducer===a?k.eagerState:a(d,k.action);k=k.next}while(null!==k&&k!==e);null===h?f=d:h.next=g,$e(d,b.memoizedState)||(rg=!0),b.memoizedState=d,b.baseState=f,b.baseQueue=h,c.lastRenderedState=d}return[b.memoizedState,c.dispatch]}function xh(a){var b=uh(),c=b.queue;if(null===c)throw Error(u(311));c.lastRenderedReducer=a;var d=c.dispatch,e=c.pending,f=b.memoizedState;if(null!==e){c.pending=null;var g=e=e.next;do{f=a(f,g.action),g=g.next}while(g!==e);$e(f,b.memoizedState)||(rg=!0),b.memoizedState=f,null===b.baseQueue&&(b.baseState=f),c.lastRenderedState=f}return[f,d]}function yh(a){var b=th();return"function"==typeof a&&(a=a()),b.memoizedState=b.baseState=a,a=(a=b.queue={pending:null,dispatch:null,lastRenderedReducer:vh,lastRenderedState:a}).dispatch=zh.bind(null,N,a),[b.memoizedState,a]}function Ah(a,b,c,d){return a={tag:a,create:b,destroy:c,deps:d,next:null},null===(b=N.updateQueue)?(b={lastEffect:null},N.updateQueue=b,b.lastEffect=a.next=a):null===(c=b.lastEffect)?b.lastEffect=a.next=a:(d=c.next,c.next=a,a.next=d,b.lastEffect=a),a}function Bh(){return uh().memoizedState}function Ch(a,b,c,d){var e=th();N.effectTag|=a,e.memoizedState=Ah(1|b,c,void 0,void 0===d?null:d)}function Dh(a,b,c,d){var e=uh();d=void 0===d?null:d;var f=void 0;if(null!==O){var g=O.memoizedState;if(f=g.destroy,null!==d&&nh(d,g.deps))return void Ah(b,c,f,d)}N.effectTag|=a,e.memoizedState=Ah(1|b,c,f,d)}function Eh(a,b){return Ch(516,4,a,b)}function Fh(a,b){return Dh(516,4,a,b)}function Gh(a,b){return Dh(4,2,a,b)}function Hh(a,b){return"function"==typeof b?(a=a(),b(a),function(){b(null)}):null!=b?(a=a(),b.current=a,function(){b.current=null}):void 0}function Ih(a,b,c){return c=null!=c?c.concat([a]):null,Dh(4,2,Hh.bind(null,b,a),c)}function Jh(){}function Kh(a,b){return th().memoizedState=[a,void 0===b?null:b],a}function Lh(a,b){var c=uh();b=void 0===b?null:b;var d=c.memoizedState;return null!==d&&null!==b&&nh(b,d[1])?d[0]:(c.memoizedState=[a,b],a)}function Mh(a,b){var c=uh();b=void 0===b?null:b;var d=c.memoizedState;return null!==d&&null!==b&&nh(b,d[1])?d[0]:(a=a(),c.memoizedState=[a,b],a)}function Nh(a,b,c){var d=ag();cg(98>d?98:d,(function(){a(!0)})),cg(97<d?97:d,(function(){var d=kh.suspense;kh.suspense=void 0===b?null:b;try{a(!1),c()}finally{kh.suspense=d}}))}function zh(a,b,c){var d=Gg(),e=Dg.suspense;e={expirationTime:d=Hg(d,a,e),suspenseConfig:e,action:c,eagerReducer:null,eagerState:null,next:null};var f=b.pending;if(null===f?e.next=e:(e.next=f.next,f.next=e),b.pending=e,f=a.alternate,a===N||null!==f&&f===N)mh=!0,e.expirationTime=lh,N.expirationTime=lh;else{if(0===a.expirationTime&&(null===f||0===f.expirationTime)&&null!==(f=b.lastRenderedReducer))try{var g=b.lastRenderedState,h=f(g,c);if(e.eagerReducer=f,e.eagerState=h,$e(h,g))return}catch(k){}Ig(a,d)}}var sh={readContext:sg,useCallback:Q,useContext:Q,useEffect:Q,useImperativeHandle:Q,useLayoutEffect:Q,useMemo:Q,useReducer:Q,useRef:Q,useState:Q,useDebugValue:Q,useResponder:Q,useDeferredValue:Q,useTransition:Q},ph={readContext:sg,useCallback:Kh,useContext:sg,useEffect:Eh,useImperativeHandle:function(a,b,c){return c=null!=c?c.concat([a]):null,Ch(4,2,Hh.bind(null,b,a),c)},useLayoutEffect:function(a,b){return Ch(4,2,a,b)},useMemo:function(a,b){var c=th();return b=void 0===b?null:b,a=a(),c.memoizedState=[a,b],a},useReducer:function(a,b,c){var d=th();return b=void 0!==c?c(b):b,d.memoizedState=d.baseState=b,a=(a=d.queue={pending:null,dispatch:null,lastRenderedReducer:a,lastRenderedState:b}).dispatch=zh.bind(null,N,a),[d.memoizedState,a]},useRef:function(a){var b;return a={current:a},th().memoizedState=a},useState:yh,useDebugValue:Jh,useResponder:ih,useDeferredValue:function(a,b){var c=yh(a),d=c[0],e=c[1];return Eh((function(){var c=kh.suspense;kh.suspense=void 0===b?null:b;try{e(a)}finally{kh.suspense=c}}),[a,b]),d},useTransition:function(a){var b=yh(!1),c=b[0];return b=b[1],[Kh(Nh.bind(null,b,a),[b,a]),c]}},qh={readContext:sg,useCallback:Lh,useContext:sg,useEffect:Fh,useImperativeHandle:Ih,useLayoutEffect:Gh,useMemo:Mh,useReducer:wh,useRef:Bh,useState:function(){return wh(vh)},useDebugValue:Jh,useResponder:ih,useDeferredValue:function(a,b){var c=wh(vh),d=c[0],e=c[1];return Fh((function(){var c=kh.suspense;kh.suspense=void 0===b?null:b;try{e(a)}finally{kh.suspense=c}}),[a,b]),d},useTransition:function(a){var b=wh(vh),c=b[0];return b=b[1],[Lh(Nh.bind(null,b,a),[b,a]),c]}},rh={readContext:sg,useCallback:Lh,useContext:sg,useEffect:Fh,useImperativeHandle:Ih,useLayoutEffect:Gh,useMemo:Mh,useReducer:xh,useRef:Bh,useState:function(){return xh(vh)},useDebugValue:Jh,useResponder:ih,useDeferredValue:function(a,b){var c=xh(vh),d=c[0],e=c[1];return Fh((function(){var c=kh.suspense;kh.suspense=void 0===b?null:b;try{e(a)}finally{kh.suspense=c}}),[a,b]),d},useTransition:function(a){var b=xh(vh),c=b[0];return b=b[1],[Lh(Nh.bind(null,b,a),[b,a]),c]}},Oh=null,Ph=null,Qh=!1;function Rh(a,b){var c=Sh(5,null,null,0);c.elementType="DELETED",c.type="DELETED",c.stateNode=b,c.return=a,c.effectTag=8,null!==a.lastEffect?(a.lastEffect.nextEffect=c,a.lastEffect=c):a.firstEffect=a.lastEffect=c}function Th(a,b){switch(a.tag){case 5:var c=a.type;return null!==(b=1!==b.nodeType||c.toLowerCase()!==b.nodeName.toLowerCase()?null:b)&&(a.stateNode=b,!0);case 6:return null!==(b=""===a.pendingProps||3!==b.nodeType?null:b)&&(a.stateNode=b,!0);case 13:default:return!1}}function Uh(a){if(Qh){var b=Ph;if(b){var c=b;if(!Th(a,b)){if(!(b=Jd(c.nextSibling))||!Th(a,b))return a.effectTag=-1025&a.effectTag|2,Qh=!1,void(Oh=a);Rh(Oh,c)}Oh=a,Ph=Jd(b.firstChild)}else a.effectTag=-1025&a.effectTag|2,Qh=!1,Oh=a}}function Vh(a){for(a=a.return;null!==a&&5!==a.tag&&3!==a.tag&&13!==a.tag;)a=a.return;Oh=a}function Wh(a){if(a!==Oh)return!1;if(!Qh)return Vh(a),Qh=!0,!1;var b=a.type;if(5!==a.tag||"head"!==b&&"body"!==b&&!Gd(b,a.memoizedProps))for(b=Ph;b;)Rh(a,b),b=Jd(b.nextSibling);if(Vh(a),13===a.tag){if(!(a=null!==(a=a.memoizedState)?a.dehydrated:null))throw Error(u(317));a:{for(a=a.nextSibling,b=0;a;){if(8===a.nodeType){var c=a.data;if(c===Ad){if(0===b){Ph=Jd(a.nextSibling);break a}b--}else c!==zd&&c!==Cd&&c!==Bd||b++}a=a.nextSibling}Ph=null}}else Ph=Oh?Jd(a.stateNode.nextSibling):null;return!0}function Xh(){Ph=Oh=null,Qh=!1}var Yh=Wa.ReactCurrentOwner,rg=!1;function R(a,b,c,d){b.child=null===a?Yg(b,null,c,d):Xg(b,a.child,c,d)}function Zh(a,b,c,d,e){c=c.render;var f=b.ref;return qg(b,e),d=oh(a,b,c,d,f,e),null===a||rg?(b.effectTag|=1,R(a,b,d,e),b.child):(b.updateQueue=a.updateQueue,b.effectTag&=-517,a.expirationTime<=e&&(a.expirationTime=0),$h(a,b,e))}function ai(a,b,c,d,e,f){if(null===a){var g=c.type;return"function"!=typeof g||bi(g)||void 0!==g.defaultProps||null!==c.compare||void 0!==c.defaultProps?((a=Ug(c.type,null,d,null,b.mode,f)).ref=b.ref,a.return=b,b.child=a):(b.tag=15,b.type=g,ci(a,b,g,d,e,f))}return g=a.child,e<f&&(e=g.memoizedProps,(c=null!==(c=c.compare)?c:bf)(e,d)&&a.ref===b.ref)?$h(a,b,f):(b.effectTag|=1,(a=Sg(g,d)).ref=b.ref,a.return=b,b.child=a)}function ci(a,b,c,d,e,f){return null!==a&&bf(a.memoizedProps,d)&&a.ref===b.ref&&(rg=!1,e<f)?(b.expirationTime=a.expirationTime,$h(a,b,f)):di(a,b,c,d,f)}function ei(a,b){var c=b.ref;(null===a&&null!==c||null!==a&&a.ref!==c)&&(b.effectTag|=128)}function di(a,b,c,d,e){var f=L(c)?Bf:J.current;return f=Cf(b,f),qg(b,e),c=oh(a,b,c,d,f,e),null===a||rg?(b.effectTag|=1,R(a,b,c,e),b.child):(b.updateQueue=a.updateQueue,b.effectTag&=-517,a.expirationTime<=e&&(a.expirationTime=0),$h(a,b,e))}function fi(a,b,c,d,e){if(L(c)){var f=!0;Gf(b)}else f=!1;if(qg(b,e),null===b.stateNode)null!==a&&(a.alternate=null,b.alternate=null,b.effectTag|=2),Lg(b,c,d),Ng(b,c,d,e),d=!0;else if(null===a){var g=b.stateNode,h=b.memoizedProps;g.props=h;var k=g.context,l=c.contextType;"object"==typeof l&&null!==l?l=sg(l):l=Cf(b,l=L(c)?Bf:J.current);var m=c.getDerivedStateFromProps,p="function"==typeof m||"function"==typeof g.getSnapshotBeforeUpdate;p||"function"!=typeof g.UNSAFE_componentWillReceiveProps&&"function"!=typeof g.componentWillReceiveProps||(h!==d||k!==l)&&Mg(b,g,d,l),tg=!1;var x=b.memoizedState;g.state=x,zg(b,d,g,e),k=b.memoizedState,h!==d||x!==k||K.current||tg?("function"==typeof m&&(Fg(b,c,m,d),k=b.memoizedState),(h=tg||Kg(b,c,h,d,x,k,l))?(p||"function"!=typeof g.UNSAFE_componentWillMount&&"function"!=typeof g.componentWillMount||("function"==typeof g.componentWillMount&&g.componentWillMount(),"function"==typeof g.UNSAFE_componentWillMount&&g.UNSAFE_componentWillMount()),"function"==typeof g.componentDidMount&&(b.effectTag|=4)):("function"==typeof g.componentDidMount&&(b.effectTag|=4),b.memoizedProps=d,b.memoizedState=k),g.props=d,g.state=k,g.context=l,d=h):("function"==typeof g.componentDidMount&&(b.effectTag|=4),d=!1)}else g=b.stateNode,vg(a,b),h=b.memoizedProps,g.props=b.type===b.elementType?h:ig(b.type,h),k=g.context,"object"==typeof(l=c.contextType)&&null!==l?l=sg(l):l=Cf(b,l=L(c)?Bf:J.current),(p="function"==typeof(m=c.getDerivedStateFromProps)||"function"==typeof g.getSnapshotBeforeUpdate)||"function"!=typeof g.UNSAFE_componentWillReceiveProps&&"function"!=typeof g.componentWillReceiveProps||(h!==d||k!==l)&&Mg(b,g,d,l),tg=!1,k=b.memoizedState,g.state=k,zg(b,d,g,e),x=b.memoizedState,h!==d||k!==x||K.current||tg?("function"==typeof m&&(Fg(b,c,m,d),x=b.memoizedState),(m=tg||Kg(b,c,h,d,k,x,l))?(p||"function"!=typeof g.UNSAFE_componentWillUpdate&&"function"!=typeof g.componentWillUpdate||("function"==typeof g.componentWillUpdate&&g.componentWillUpdate(d,x,l),"function"==typeof g.UNSAFE_componentWillUpdate&&g.UNSAFE_componentWillUpdate(d,x,l)),"function"==typeof g.componentDidUpdate&&(b.effectTag|=4),"function"==typeof g.getSnapshotBeforeUpdate&&(b.effectTag|=256)):("function"!=typeof g.componentDidUpdate||h===a.memoizedProps&&k===a.memoizedState||(b.effectTag|=4),"function"!=typeof g.getSnapshotBeforeUpdate||h===a.memoizedProps&&k===a.memoizedState||(b.effectTag|=256),b.memoizedProps=d,b.memoizedState=x),g.props=d,g.state=x,g.context=l,d=m):("function"!=typeof g.componentDidUpdate||h===a.memoizedProps&&k===a.memoizedState||(b.effectTag|=4),"function"!=typeof g.getSnapshotBeforeUpdate||h===a.memoizedProps&&k===a.memoizedState||(b.effectTag|=256),d=!1);return gi(a,b,c,d,f,e)}function gi(a,b,c,d,e,f){ei(a,b);var g=0!=(64&b.effectTag);if(!d&&!g)return e&&Hf(b,c,!1),$h(a,b,f);d=b.stateNode,Yh.current=b;var h=g&&"function"!=typeof c.getDerivedStateFromError?null:d.render();return b.effectTag|=1,null!==a&&g?(b.child=Xg(b,a.child,null,f),b.child=Xg(b,null,h,f)):R(a,b,h,f),b.memoizedState=d.state,e&&Hf(b,c,!0),b.child}function hi(a){var b=a.stateNode;b.pendingContext?Ef(a,b.pendingContext,b.pendingContext!==b.context):b.context&&Ef(a,b.context,!1),dh(a,b.containerInfo)}var ii={dehydrated:null,retryTime:0},ni,oi,pi,qi;function ji(a,b,c){var d=b.mode,e=b.pendingProps,f=M.current,g=!1,h;if((h=0!=(64&b.effectTag))||(h=0!=(2&f)&&(null===a||null!==a.memoizedState)),h?(g=!0,b.effectTag&=-65):null!==a&&null===a.memoizedState||void 0===e.fallback||!0===e.unstable_avoidThisFallback||(f|=1),I(M,1&f),null===a){if(void 0!==e.fallback&&Uh(b),g){if(g=e.fallback,(e=Wg(null,d,0,null)).return=b,0==(2&b.mode))for(a=null!==b.memoizedState?b.child.child:b.child,e.child=a;null!==a;)a.return=e,a=a.sibling;return(c=Wg(g,d,c,null)).return=b,e.sibling=c,b.memoizedState=ii,b.child=e,c}return d=e.children,b.memoizedState=null,b.child=Yg(b,null,d,c)}if(null!==a.memoizedState){if(d=(a=a.child).sibling,g){if(e=e.fallback,(c=Sg(a,a.pendingProps)).return=b,0==(2&b.mode)&&(g=null!==b.memoizedState?b.child.child:b.child)!==a.child)for(c.child=g;null!==g;)g.return=c,g=g.sibling;return(d=Sg(d,e)).return=b,c.sibling=d,c.childExpirationTime=0,b.memoizedState=ii,b.child=c,d}return c=Xg(b,a.child,e.children,c),b.memoizedState=null,b.child=c}if(a=a.child,g){if(g=e.fallback,(e=Wg(null,d,0,null)).return=b,e.child=a,null!==a&&(a.return=e),0==(2&b.mode))for(a=null!==b.memoizedState?b.child.child:b.child,e.child=a;null!==a;)a.return=e,a=a.sibling;return(c=Wg(g,d,c,null)).return=b,e.sibling=c,c.effectTag|=2,e.childExpirationTime=0,b.memoizedState=ii,b.child=e,c}return b.memoizedState=null,b.child=Xg(b,a,e.children,c)}function ki(a,b){a.expirationTime<b&&(a.expirationTime=b);var c=a.alternate;null!==c&&c.expirationTime<b&&(c.expirationTime=b),pg(a.return,b)}function li(a,b,c,d,e,f){var g=a.memoizedState;null===g?a.memoizedState={isBackwards:b,rendering:null,renderingStartTime:0,last:d,tail:c,tailExpiration:0,tailMode:e,lastEffect:f}:(g.isBackwards=b,g.rendering=null,g.renderingStartTime=0,g.last=d,g.tail=c,g.tailExpiration=0,g.tailMode=e,g.lastEffect=f)}function mi(a,b,c){var d=b.pendingProps,e=d.revealOrder,f=d.tail;if(R(a,b,d.children,c),0!=(2&(d=M.current)))d=1&d|2,b.effectTag|=64;else{if(null!==a&&0!=(64&a.effectTag))a:for(a=b.child;null!==a;){if(13===a.tag)null!==a.memoizedState&&ki(a,c);else if(19===a.tag)ki(a,c);else if(null!==a.child){a.child.return=a,a=a.child;continue}if(a===b)break a;for(;null===a.sibling;){if(null===a.return||a.return===b)break a;a=a.return}a.sibling.return=a.return,a=a.sibling}d&=1}if(I(M,d),0==(2&b.mode))b.memoizedState=null;else switch(e){case"forwards":for(c=b.child,e=null;null!==c;)null!==(a=c.alternate)&&null===hh(a)&&(e=c),c=c.sibling;null===(c=e)?(e=b.child,b.child=null):(e=c.sibling,c.sibling=null),li(b,!1,e,c,f,b.lastEffect);break;case"backwards":for(c=null,e=b.child,b.child=null;null!==e;){if(null!==(a=e.alternate)&&null===hh(a)){b.child=e;break}a=e.sibling,e.sibling=c,c=e,e=a}li(b,!0,c,null,f,b.lastEffect);break;case"together":li(b,!1,null,null,void 0,b.lastEffect);break;default:b.memoizedState=null}return b.child}function $h(a,b,c){null!==a&&(b.dependencies=a.dependencies);var d=b.expirationTime;if(0!==d&&Bg(d),b.childExpirationTime<c)return null;if(null!==a&&b.child!==a.child)throw Error(u(153));if(null!==b.child){for(c=Sg(a=b.child,a.pendingProps),b.child=c,c.return=b;null!==a.sibling;)a=a.sibling,(c=c.sibling=Sg(a,a.pendingProps)).return=b;c.sibling=null}return b.child}function ri(a,b){switch(a.tailMode){case"hidden":b=a.tail;for(var c=null;null!==b;)null!==b.alternate&&(c=b),b=b.sibling;null===c?a.tail=null:c.sibling=null;break;case"collapsed":c=a.tail;for(var d=null;null!==c;)null!==c.alternate&&(d=c),c=c.sibling;null===d?b||null===a.tail?a.tail=null:a.tail.sibling=null:d.sibling=null}}function si(a,b,c){var d=b.pendingProps;switch(b.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:return L(b.type)&&Df(),null;case 3:return eh(),H(K),H(J),(c=b.stateNode).pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),null!==a&&null!==a.child||!Wh(b)||(b.effectTag|=4),null;case 5:gh(b),c=ch(bh.current);var e=b.type;if(null!==a&&null!=b.stateNode)pi(a,b,e,d,c),a.ref!==b.ref&&(b.effectTag|=128);else{if(!d){if(null===b.stateNode)throw Error(u(166));return null}if(a=ch($g.current),Wh(b)){d=b.stateNode,e=b.type;var f=b.memoizedProps;switch(d[Md]=b,d[Nd]=f,e){case"iframe":case"object":case"embed":F("load",d);break;case"video":case"audio":for(a=0;a<ac.length;a++)F(ac[a],d);break;case"source":F("error",d);break;case"img":case"image":case"link":F("error",d),F("load",d);break;case"form":F("reset",d),F("submit",d);break;case"details":F("toggle",d);break;case"input":Ab(d,f),F("invalid",d),rd(c,"onChange");break;case"select":d._wrapperState={wasMultiple:!!f.multiple},F("invalid",d),rd(c,"onChange");break;case"textarea":Jb(d,f),F("invalid",d),rd(c,"onChange")}for(var g in od(e,f),a=null,f)if(f.hasOwnProperty(g)){var h=f[g];"children"===g?"string"==typeof h?d.textContent!==h&&(a=["children",h]):"number"==typeof h&&d.textContent!==""+h&&(a=["children",""+h]):va.hasOwnProperty(g)&&null!=h&&rd(c,g)}switch(e){case"input":xb(d),Eb(d,f,!0);break;case"textarea":xb(d),Lb(d);break;case"select":case"option":break;default:"function"==typeof f.onClick&&(d.onclick=sd)}c=a,b.updateQueue=c,null!==c&&(b.effectTag|=4)}else{switch(g=9===c.nodeType?c:c.ownerDocument,a===qd&&(a=Nb(e)),a===qd?"script"===e?((a=g.createElement("div")).innerHTML="<script><\/script>",a=a.removeChild(a.firstChild)):"string"==typeof d.is?a=g.createElement(e,{is:d.is}):(a=g.createElement(e),"select"===e&&(g=a,d.multiple?g.multiple=!0:d.size&&(g.size=d.size))):a=g.createElementNS(a,e),a[Md]=b,a[Nd]=d,ni(a,b,!1,!1),b.stateNode=a,g=pd(e,d),e){case"iframe":case"object":case"embed":F("load",a),h=d;break;case"video":case"audio":for(h=0;h<ac.length;h++)F(ac[h],a);h=d;break;case"source":F("error",a),h=d;break;case"img":case"image":case"link":F("error",a),F("load",a),h=d;break;case"form":F("reset",a),F("submit",a),h=d;break;case"details":F("toggle",a),h=d;break;case"input":Ab(a,d),h=zb(a,d),F("invalid",a),rd(c,"onChange");break;case"option":h=Gb(a,d);break;case"select":a._wrapperState={wasMultiple:!!d.multiple},h=n({},d,{value:void 0}),F("invalid",a),rd(c,"onChange");break;case"textarea":Jb(a,d),h=Ib(a,d),F("invalid",a),rd(c,"onChange");break;default:h=d}od(e,h);var k=h;for(f in k)if(k.hasOwnProperty(f)){var l=k[f];"style"===f?md(a,l):"dangerouslySetInnerHTML"===f?null!=(l=l?l.__html:void 0)&&Qb(a,l):"children"===f?"string"==typeof l?("textarea"!==e||""!==l)&&Rb(a,l):"number"==typeof l&&Rb(a,""+l):"suppressContentEditableWarning"!==f&&"suppressHydrationWarning"!==f&&"autoFocus"!==f&&(va.hasOwnProperty(f)?null!=l&&rd(c,f):null!=l&&Xa(a,f,l,g))}switch(e){case"input":xb(a),Eb(a,d,!1);break;case"textarea":xb(a),Lb(a);break;case"option":null!=d.value&&a.setAttribute("value",""+rb(d.value));break;case"select":a.multiple=!!d.multiple,null!=(c=d.value)?Hb(a,!!d.multiple,c,!1):null!=d.defaultValue&&Hb(a,!!d.multiple,d.defaultValue,!0);break;default:"function"==typeof h.onClick&&(a.onclick=sd)}Fd(e,d)&&(b.effectTag|=4)}null!==b.ref&&(b.effectTag|=128)}return null;case 6:if(a&&null!=b.stateNode)qi(a,b,a.memoizedProps,d);else{if("string"!=typeof d&&null===b.stateNode)throw Error(u(166));c=ch(bh.current),ch($g.current),Wh(b)?(c=b.stateNode,d=b.memoizedProps,c[Md]=b,c.nodeValue!==d&&(b.effectTag|=4)):((c=(9===c.nodeType?c:c.ownerDocument).createTextNode(d))[Md]=b,b.stateNode=c)}return null;case 13:return H(M),d=b.memoizedState,0!=(64&b.effectTag)?(b.expirationTime=c,b):(c=null!==d,d=!1,null===a?void 0!==b.memoizedProps.fallback&&Wh(b):(d=null!==(e=a.memoizedState),c||null===e||null!==(e=a.child.sibling)&&(null!==(f=b.firstEffect)?(b.firstEffect=e,e.nextEffect=f):(b.firstEffect=b.lastEffect=e,e.nextEffect=null),e.effectTag=8)),c&&!d&&0!=(2&b.mode)&&(null===a&&!0!==b.memoizedProps.unstable_avoidThisFallback||0!=(1&M.current)?S===ti&&(S=ui):(S!==ti&&S!==ui||(S=vi),0!==wi&&null!==T&&(xi(T,U),yi(T,wi)))),(c||d)&&(b.effectTag|=4),null);case 4:return eh(),null;case 10:return og(b),null;case 17:return L(b.type)&&Df(),null;case 19:if(H(M),null===(d=b.memoizedState))return null;if(e=0!=(64&b.effectTag),null===(f=d.rendering)){if(e)ri(d,!1);else if(S!==ti||null!==a&&0!=(64&a.effectTag))for(f=b.child;null!==f;){if(null!==(a=hh(f))){for(b.effectTag|=64,ri(d,!1),null!==(e=a.updateQueue)&&(b.updateQueue=e,b.effectTag|=4),null===d.lastEffect&&(b.firstEffect=null),b.lastEffect=d.lastEffect,d=b.child;null!==d;)f=c,(e=d).effectTag&=2,e.nextEffect=null,e.firstEffect=null,e.lastEffect=null,null===(a=e.alternate)?(e.childExpirationTime=0,e.expirationTime=f,e.child=null,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null):(e.childExpirationTime=a.childExpirationTime,e.expirationTime=a.expirationTime,e.child=a.child,e.memoizedProps=a.memoizedProps,e.memoizedState=a.memoizedState,e.updateQueue=a.updateQueue,f=a.dependencies,e.dependencies=null===f?null:{expirationTime:f.expirationTime,firstContext:f.firstContext,responders:f.responders}),d=d.sibling;return I(M,1&M.current|2),b.child}f=f.sibling}}else{if(!e)if(null!==(a=hh(f))){if(b.effectTag|=64,e=!0,null!==(c=a.updateQueue)&&(b.updateQueue=c,b.effectTag|=4),ri(d,!0),null===d.tail&&"hidden"===d.tailMode&&!f.alternate)return null!==(b=b.lastEffect=d.lastEffect)&&(b.nextEffect=null),null}else 2*$f()-d.renderingStartTime>d.tailExpiration&&1<c&&(b.effectTag|=64,e=!0,ri(d,!1),b.expirationTime=b.childExpirationTime=c-1);d.isBackwards?(f.sibling=b.child,b.child=f):(null!==(c=d.last)?c.sibling=f:b.child=f,d.last=f)}return null!==d.tail?(0===d.tailExpiration&&(d.tailExpiration=$f()+500),c=d.tail,d.rendering=c,d.tail=c.sibling,d.lastEffect=b.lastEffect,d.renderingStartTime=$f(),c.sibling=null,b=M.current,I(M,e?1&b|2:1&b),c):null}throw Error(u(156,b.tag))}function zi(a){switch(a.tag){case 1:L(a.type)&&Df();var b=a.effectTag;return 4096&b?(a.effectTag=-4097&b|64,a):null;case 3:if(eh(),H(K),H(J),0!=(64&(b=a.effectTag)))throw Error(u(285));return a.effectTag=-4097&b|64,a;case 5:return gh(a),null;case 13:return H(M),4096&(b=a.effectTag)?(a.effectTag=-4097&b|64,a):null;case 19:return H(M),null;case 4:return eh(),null;case 10:return og(a),null;default:return null}}function Ai(a,b){return{value:a,source:b,stack:qb(b)}}ni=function(a,b){for(var c=b.child;null!==c;){if(5===c.tag||6===c.tag)a.appendChild(c.stateNode);else if(4!==c.tag&&null!==c.child){c.child.return=c,c=c.child;continue}if(c===b)break;for(;null===c.sibling;){if(null===c.return||c.return===b)return;c=c.return}c.sibling.return=c.return,c=c.sibling}},oi=function(){},pi=function(a,b,c,d,e){var f=a.memoizedProps;if(f!==d){var g=b.stateNode,h,k;switch(ch($g.current),a=null,c){case"input":f=zb(g,f),d=zb(g,d),a=[];break;case"option":f=Gb(g,f),d=Gb(g,d),a=[];break;case"select":f=n({},f,{value:void 0}),d=n({},d,{value:void 0}),a=[];break;case"textarea":f=Ib(g,f),d=Ib(g,d),a=[];break;default:"function"!=typeof f.onClick&&"function"==typeof d.onClick&&(g.onclick=sd)}for(h in od(c,d),c=null,f)if(!d.hasOwnProperty(h)&&f.hasOwnProperty(h)&&null!=f[h])if("style"===h)for(k in g=f[h])g.hasOwnProperty(k)&&(c||(c={}),c[k]="");else"dangerouslySetInnerHTML"!==h&&"children"!==h&&"suppressContentEditableWarning"!==h&&"suppressHydrationWarning"!==h&&"autoFocus"!==h&&(va.hasOwnProperty(h)?a||(a=[]):(a=a||[]).push(h,null));for(h in d){var l=d[h];if(g=null!=f?f[h]:void 0,d.hasOwnProperty(h)&&l!==g&&(null!=l||null!=g))if("style"===h)if(g){for(k in g)!g.hasOwnProperty(k)||l&&l.hasOwnProperty(k)||(c||(c={}),c[k]="");for(k in l)l.hasOwnProperty(k)&&g[k]!==l[k]&&(c||(c={}),c[k]=l[k])}else c||(a||(a=[]),a.push(h,c)),c=l;else"dangerouslySetInnerHTML"===h?(l=l?l.__html:void 0,g=g?g.__html:void 0,null!=l&&g!==l&&(a=a||[]).push(h,l)):"children"===h?g===l||"string"!=typeof l&&"number"!=typeof l||(a=a||[]).push(h,""+l):"suppressContentEditableWarning"!==h&&"suppressHydrationWarning"!==h&&(va.hasOwnProperty(h)?(null!=l&&rd(e,h),a||g===l||(a=[])):(a=a||[]).push(h,l))}c&&(a=a||[]).push("style",c),e=a,(b.updateQueue=e)&&(b.effectTag|=4)}},qi=function(a,b,c,d){c!==d&&(b.effectTag|=4)};var Bi="function"==typeof WeakSet?WeakSet:Set;function Ci(a,b){var c=b.source,d=b.stack;null===d&&null!==c&&(d=qb(c)),null!==c&&pb(c.type),b=b.value,null!==a&&1===a.tag&&pb(a.type);try{console.error(b)}catch(e){setTimeout((function(){throw e}))}}function Di(a,b){try{b.props=a.memoizedProps,b.state=a.memoizedState,b.componentWillUnmount()}catch(c){Ei(a,c)}}function Fi(a){var b=a.ref;if(null!==b)if("function"==typeof b)try{b(null)}catch(c){Ei(a,c)}else b.current=null}function Gi(a,b){switch(b.tag){case 0:case 11:case 15:case 22:return;case 1:if(256&b.effectTag&&null!==a){var c=a.memoizedProps,d=a.memoizedState;b=(a=b.stateNode).getSnapshotBeforeUpdate(b.elementType===b.type?c:ig(b.type,c),d),a.__reactInternalSnapshotBeforeUpdate=b}return;case 3:case 5:case 6:case 4:case 17:return}throw Error(u(163))}function Hi(a,b){if(null!==(b=null!==(b=b.updateQueue)?b.lastEffect:null)){var c=b=b.next;do{if((c.tag&a)===a){var d=c.destroy;c.destroy=void 0,void 0!==d&&d()}c=c.next}while(c!==b)}}function Ii(a,b){if(null!==(b=null!==(b=b.updateQueue)?b.lastEffect:null)){var c=b=b.next;do{if((c.tag&a)===a){var d=c.create;c.destroy=d()}c=c.next}while(c!==b)}}function Ji(a,b,c){switch(c.tag){case 0:case 11:case 15:case 22:return void Ii(3,c);case 1:if(a=c.stateNode,4&c.effectTag)if(null===b)a.componentDidMount();else{var d=c.elementType===c.type?b.memoizedProps:ig(c.type,b.memoizedProps);a.componentDidUpdate(d,b.memoizedState,a.__reactInternalSnapshotBeforeUpdate)}return void(null!==(b=c.updateQueue)&&Cg(c,b,a));case 3:if(null!==(b=c.updateQueue)){if(a=null,null!==c.child)switch(c.child.tag){case 5:a=c.child.stateNode;break;case 1:a=c.child.stateNode}Cg(c,b,a)}return;case 5:return a=c.stateNode,void(null===b&&4&c.effectTag&&Fd(c.type,c.memoizedProps)&&a.focus());case 6:case 4:case 12:return;case 13:return void(null===c.memoizedState&&(c=c.alternate,null!==c&&(c=c.memoizedState,null!==c&&(c=c.dehydrated,null!==c&&Vc(c)))));case 19:case 17:case 20:case 21:return}throw Error(u(163))}function Ki(a,b,c){switch("function"==typeof Li&&Li(b),b.tag){case 0:case 11:case 14:case 15:case 22:if(null!==(a=b.updateQueue)&&null!==(a=a.lastEffect)){var d=a.next;cg(97<c?97:c,(function(){var a=d;do{var c=a.destroy;if(void 0!==c){var g=b;try{c()}catch(h){Ei(g,h)}}a=a.next}while(a!==d)}))}break;case 1:Fi(b),"function"==typeof(c=b.stateNode).componentWillUnmount&&Di(b,c);break;case 5:Fi(b);break;case 4:Mi(a,b,c)}}function Ni(a){var b=a.alternate;a.return=null,a.child=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.alternate=null,a.firstEffect=null,a.lastEffect=null,a.pendingProps=null,a.memoizedProps=null,a.stateNode=null,null!==b&&Ni(b)}function Oi(a){return 5===a.tag||3===a.tag||4===a.tag}function Pi(a){a:{for(var b=a.return;null!==b;){if(Oi(b)){var c=b;break a}b=b.return}throw Error(u(160))}switch(b=c.stateNode,c.tag){case 5:var d=!1;break;case 3:case 4:b=b.containerInfo,d=!0;break;default:throw Error(u(161))}16&c.effectTag&&(Rb(b,""),c.effectTag&=-17);a:b:for(c=a;;){for(;null===c.sibling;){if(null===c.return||Oi(c.return)){c=null;break a}c=c.return}for(c.sibling.return=c.return,c=c.sibling;5!==c.tag&&6!==c.tag&&18!==c.tag;){if(2&c.effectTag)continue b;if(null===c.child||4===c.tag)continue b;c.child.return=c,c=c.child}if(!(2&c.effectTag)){c=c.stateNode;break a}}d?Qi(a,c,b):Ri(a,c,b)}function Qi(a,b,c){var d=a.tag,e=5===d||6===d;if(e)a=e?a.stateNode:a.stateNode.instance,b?8===c.nodeType?c.parentNode.insertBefore(a,b):c.insertBefore(a,b):(8===c.nodeType?(b=c.parentNode).insertBefore(a,c):(b=c).appendChild(a),null!=(c=c._reactRootContainer)||null!==b.onclick||(b.onclick=sd));else if(4!==d&&null!==(a=a.child))for(Qi(a,b,c),a=a.sibling;null!==a;)Qi(a,b,c),a=a.sibling}function Ri(a,b,c){var d=a.tag,e=5===d||6===d;if(e)a=e?a.stateNode:a.stateNode.instance,b?c.insertBefore(a,b):c.appendChild(a);else if(4!==d&&null!==(a=a.child))for(Ri(a,b,c),a=a.sibling;null!==a;)Ri(a,b,c),a=a.sibling}function Mi(a,b,c){for(var d=b,e=!1,f,g;;){if(!e){e=d.return;a:for(;;){if(null===e)throw Error(u(160));switch(f=e.stateNode,e.tag){case 5:g=!1;break a;case 3:case 4:f=f.containerInfo,g=!0;break a}e=e.return}e=!0}if(5===d.tag||6===d.tag){a:for(var h=a,k=d,l=c,m=k;;)if(Ki(h,m,l),null!==m.child&&4!==m.tag)m.child.return=m,m=m.child;else{if(m===k)break a;for(;null===m.sibling;){if(null===m.return||m.return===k)break a;m=m.return}m.sibling.return=m.return,m=m.sibling}g?(h=f,k=d.stateNode,8===h.nodeType?h.parentNode.removeChild(k):h.removeChild(k)):f.removeChild(d.stateNode)}else if(4===d.tag){if(null!==d.child){f=d.stateNode.containerInfo,g=!0,d.child.return=d,d=d.child;continue}}else if(Ki(a,d,c),null!==d.child){d.child.return=d,d=d.child;continue}if(d===b)break;for(;null===d.sibling;){if(null===d.return||d.return===b)return;4===(d=d.return).tag&&(e=!1)}d.sibling.return=d.return,d=d.sibling}}function Si(a,b){switch(b.tag){case 0:case 11:case 14:case 15:case 22:return void Hi(3,b);case 1:return;case 5:var c=b.stateNode;if(null!=c){var d=b.memoizedProps,e=null!==a?a.memoizedProps:d;a=b.type;var f=b.updateQueue;if(b.updateQueue=null,null!==f){for(c[Nd]=d,"input"===a&&"radio"===d.type&&null!=d.name&&Bb(c,d),pd(a,e),b=pd(a,d),e=0;e<f.length;e+=2){var g=f[e],h=f[e+1];"style"===g?md(c,h):"dangerouslySetInnerHTML"===g?Qb(c,h):"children"===g?Rb(c,h):Xa(c,g,h,b)}switch(a){case"input":Cb(c,d);break;case"textarea":Kb(c,d);break;case"select":b=c._wrapperState.wasMultiple,c._wrapperState.wasMultiple=!!d.multiple,null!=(a=d.value)?Hb(c,!!d.multiple,a,!1):b!==!!d.multiple&&(null!=d.defaultValue?Hb(c,!!d.multiple,d.defaultValue,!0):Hb(c,!!d.multiple,d.multiple?[]:"",!1))}}}return;case 6:if(null===b.stateNode)throw Error(u(162));return void(b.stateNode.nodeValue=b.memoizedProps);case 3:return void((b=b.stateNode).hydrate&&(b.hydrate=!1,Vc(b.containerInfo)));case 12:return;case 13:if(c=b,null===b.memoizedState?d=!1:(d=!0,c=b.child,Ti=$f()),null!==c)a:for(a=c;;){if(5===a.tag)f=a.stateNode,d?"function"==typeof(f=f.style).setProperty?f.setProperty("display","none","important"):f.display="none":(f=a.stateNode,e=null!=(e=a.memoizedProps.style)&&e.hasOwnProperty("display")?e.display:null,f.style.display=ld("display",e));else if(6===a.tag)a.stateNode.nodeValue=d?"":a.memoizedProps;else{if(13===a.tag&&null!==a.memoizedState&&null===a.memoizedState.dehydrated){(f=a.child.sibling).return=a,a=f;continue}if(null!==a.child){a.child.return=a,a=a.child;continue}}if(a===c)break;for(;null===a.sibling;){if(null===a.return||a.return===c)break a;a=a.return}a.sibling.return=a.return,a=a.sibling}return void Ui(b);case 19:return void Ui(b);case 17:return}throw Error(u(163))}function Ui(a){var b=a.updateQueue;if(null!==b){a.updateQueue=null;var c=a.stateNode;null===c&&(c=a.stateNode=new Bi),b.forEach((function(b){var d=Vi.bind(null,a,b);c.has(b)||(c.add(b),b.then(d,d))}))}}var Wi="function"==typeof WeakMap?WeakMap:Map;function Xi(a,b,c){(c=wg(c,null)).tag=3,c.payload={element:null};var d=b.value;return c.callback=function(){Yi||(Yi=!0,Zi=d),Ci(a,b)},c}function $i(a,b,c){(c=wg(c,null)).tag=3;var d=a.type.getDerivedStateFromError;if("function"==typeof d){var e=b.value;c.payload=function(){return Ci(a,b),d(e)}}var f=a.stateNode;return null!==f&&"function"==typeof f.componentDidCatch&&(c.callback=function(){"function"!=typeof d&&(null===aj?aj=new Set([this]):aj.add(this),Ci(a,b));var c=b.stack;this.componentDidCatch(b.value,{componentStack:null!==c?c:""})}),c}var bj=Math.ceil,cj=Wa.ReactCurrentDispatcher,dj=Wa.ReactCurrentOwner,V=0,ej=8,fj=16,gj=32,ti=0,hj=1,ij=2,ui=3,vi=4,jj=5,W=0,T=null,X=null,U=0,S=ti,kj=null,lj=1073741823,mj=1073741823,nj=null,wi=0,oj=!1,Ti=0,pj=500,Y=null,Yi=!1,Zi=null,aj=null,qj=!1,rj=null,sj=90,tj=null,uj=0,vj=null,wj=0,Rj;function Gg(){return 0!=(48&W)?1073741821-($f()/10|0):0!==wj?wj:wj=1073741821-($f()/10|0)}function Hg(a,b,c){if(0==(2&(b=b.mode)))return 1073741823;var d=ag();if(0==(4&b))return 99===d?1073741823:1073741822;if(0!=(16&W))return U;if(null!==c)a=hg(a,0|c.timeoutMs||5e3,250);else switch(d){case 99:a=1073741823;break;case 98:a=hg(a,150,100);break;case 97:case 96:a=hg(a,5e3,250);break;case 95:a=2;break;default:throw Error(u(326))}return null!==T&&a===U&&--a,a}function Ig(a,b){if(50<uj)throw uj=0,vj=null,Error(u(185));if(null!==(a=xj(a,b))){var c=ag();1073741823===b?0!=(8&W)&&0==(48&W)?yj(a):(Z(a),0===W&&gg()):Z(a),0==(4&W)||98!==c&&99!==c||(null===tj?tj=new Map([[a,b]]):(void 0===(c=tj.get(a))||c>b)&&tj.set(a,b))}}function xj(a,b){a.expirationTime<b&&(a.expirationTime=b);var c=a.alternate;null!==c&&c.expirationTime<b&&(c.expirationTime=b);var d=a.return,e=null;if(null===d&&3===a.tag)e=a.stateNode;else for(;null!==d;){if(c=d.alternate,d.childExpirationTime<b&&(d.childExpirationTime=b),null!==c&&c.childExpirationTime<b&&(c.childExpirationTime=b),null===d.return&&3===d.tag){e=d.stateNode;break}d=d.return}return null!==e&&(T===e&&(Bg(b),S===vi&&xi(e,U)),yi(e,b)),e}function zj(a){var b=a.lastExpiredTime;if(0!==b)return b;if(!Aj(a,b=a.firstPendingTime))return b;var c=a.lastPingedTime;return 2>=(a=c>(a=a.nextKnownPendingLevel)?c:a)&&b!==a?0:a}function Z(a){if(0!==a.lastExpiredTime)a.callbackExpirationTime=1073741823,a.callbackPriority=99,a.callbackNode=eg(yj.bind(null,a));else{var b=zj(a),c=a.callbackNode;if(0===b)null!==c&&(a.callbackNode=null,a.callbackExpirationTime=0,a.callbackPriority=90);else{var d=Gg();if(1073741823===b?d=99:1===b||2===b?d=95:d=0>=(d=10*(1073741821-b)-10*(1073741821-d))?99:250>=d?98:5250>=d?97:95,null!==c){var e=a.callbackPriority;if(a.callbackExpirationTime===b&&e>=d)return;c!==Tf&&Kf(c)}a.callbackExpirationTime=b,a.callbackPriority=d,b=1073741823===b?eg(yj.bind(null,a)):dg(d,Bj.bind(null,a),{timeout:10*(1073741821-b)-$f()}),a.callbackNode=b}}}function Bj(a,b){if(wj=0,b)return Cj(a,b=Gg()),Z(a),null;var c=zj(a);if(0!==c){if(b=a.callbackNode,0!=(48&W))throw Error(u(327));if(Dj(),a===T&&c===U||Ej(a,c),null!==X){var d=W;W|=16;for(var e=Fj();;)try{Gj();break}catch(h){Hj(a,h)}if(ng(),W=d,cj.current=e,1===S)throw b=kj,Ej(a,c),xi(a,c),Z(a),b;if(null===X)switch(e=a.finishedWork=a.current.alternate,a.finishedExpirationTime=c,d=S,T=null,d){case ti:case 1:throw Error(u(345));case 2:Cj(a,2<c?2:c);break;case ui:if(xi(a,c),c===(d=a.lastSuspendedTime)&&(a.nextKnownPendingLevel=Ij(e)),1073741823===lj&&10<(e=Ti+pj-$f())){if(oj){var f=a.lastPingedTime;if(0===f||f>=c){a.lastPingedTime=c,Ej(a,c);break}}if(0!==(f=zj(a))&&f!==c)break;if(0!==d&&d!==c){a.lastPingedTime=d;break}a.timeoutHandle=Hd(Jj.bind(null,a),e);break}Jj(a);break;case vi:if(xi(a,c),c===(d=a.lastSuspendedTime)&&(a.nextKnownPendingLevel=Ij(e)),oj&&(0===(e=a.lastPingedTime)||e>=c)){a.lastPingedTime=c,Ej(a,c);break}if(0!==(e=zj(a))&&e!==c)break;if(0!==d&&d!==c){a.lastPingedTime=d;break}if(1073741823!==mj?d=10*(1073741821-mj)-$f():1073741823===lj?d=0:(d=10*(1073741821-lj)-5e3,0>(d=(e=$f())-d)&&(d=0),(c=10*(1073741821-c)-e)<(d=(120>d?120:480>d?480:1080>d?1080:1920>d?1920:3e3>d?3e3:4320>d?4320:1960*bj(d/1960))-d)&&(d=c)),10<d){a.timeoutHandle=Hd(Jj.bind(null,a),d);break}Jj(a);break;case 5:if(1073741823!==lj&&null!==nj){f=lj;var g=nj;if(0>=(d=0|g.busyMinDurationMs)?d=0:(e=0|g.busyDelayMs,d=(f=$f()-(10*(1073741821-f)-(0|g.timeoutMs||5e3)))<=e?0:e+d-f),10<d){xi(a,c),a.timeoutHandle=Hd(Jj.bind(null,a),d);break}}Jj(a);break;default:throw Error(u(329))}if(Z(a),a.callbackNode===b)return Bj.bind(null,a)}}return null}function yj(a){var b=a.lastExpiredTime;if(b=0!==b?b:1073741823,0!=(48&W))throw Error(u(327));if(Dj(),a===T&&b===U||Ej(a,b),null!==X){var c=W;W|=16;for(var d=Fj();;)try{Kj();break}catch(e){Hj(a,e)}if(ng(),W=c,cj.current=d,1===S)throw c=kj,Ej(a,b),xi(a,b),Z(a),c;if(null!==X)throw Error(u(261));a.finishedWork=a.current.alternate,a.finishedExpirationTime=b,T=null,Jj(a),Z(a)}return null}function Lj(){if(null!==tj){var a=tj;tj=null,a.forEach((function(a,c){Cj(c,a),Z(c)})),gg()}}function Mj(a,b){var c=W;W|=1;try{return a(b)}finally{0===(W=c)&&gg()}}function Nj(a,b){var c=W;W&=-2,W|=8;try{return a(b)}finally{0===(W=c)&&gg()}}function Ej(a,b){a.finishedWork=null,a.finishedExpirationTime=0;var c=a.timeoutHandle;if(-1!==c&&(a.timeoutHandle=-1,Id(c)),null!==X)for(c=X.return;null!==c;){var d=c;switch(d.tag){case 1:null!=(d=d.type.childContextTypes)&&Df();break;case 3:eh(),H(K),H(J);break;case 5:gh(d);break;case 4:eh();break;case 13:case 19:H(M);break;case 10:og(d)}c=c.return}T=a,X=Sg(a.current,null),U=b,S=ti,kj=null,mj=lj=1073741823,nj=null,wi=0,oj=!1}function Hj(a,b){for(;;){try{if(ng(),jh.current=sh,mh)for(var c=N.memoizedState;null!==c;){var d=c.queue;null!==d&&(d.pending=null),c=c.next}if(lh=0,P=O=N=null,mh=!1,null===X||null===X.return)return S=1,kj=b,X=null;a:{var e=a,f=X.return,g=X,h=b;if(b=U,g.effectTag|=2048,g.firstEffect=g.lastEffect=null,null!==h&&"object"==typeof h&&"function"==typeof h.then){var k=h;if(0==(2&g.mode)){var l=g.alternate;l?(g.updateQueue=l.updateQueue,g.memoizedState=l.memoizedState,g.expirationTime=l.expirationTime):(g.updateQueue=null,g.memoizedState=null)}var m=0!=(1&M.current),p=f;do{var x;if(x=13===p.tag){var z=p.memoizedState;if(null!==z)x=null!==z.dehydrated;else{var ca=p.memoizedProps;x=void 0!==ca.fallback&&(!0!==ca.unstable_avoidThisFallback||!m)}}if(x){var D=p.updateQueue;if(null===D){var t=new Set;t.add(k),p.updateQueue=t}else D.add(k);if(0==(2&p.mode)){if(p.effectTag|=64,g.effectTag&=-2981,1===g.tag)if(null===g.alternate)g.tag=17;else{var y=wg(1073741823,null);y.tag=2,xg(g,y)}g.expirationTime=1073741823;break a}h=void 0,g=b;var A=e.pingCache;if(null===A?(A=e.pingCache=new Wi,h=new Set,A.set(k,h)):void 0===(h=A.get(k))&&(h=new Set,A.set(k,h)),!h.has(g)){h.add(g);var q=Oj.bind(null,e,k,g);k.then(q,q)}p.effectTag|=4096,p.expirationTime=b;break a}p=p.return}while(null!==p);h=Error((pb(g.type)||"A React component")+" suspended while rendering, but no fallback UI was specified.\n\nAdd a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display."+qb(g))}5!==S&&(S=2),h=Ai(h,g),p=f;do{switch(p.tag){case 3:var B;k=h,p.effectTag|=4096,p.expirationTime=b,yg(p,Xi(p,k,b));break a;case 1:k=h;var w=p.type,ub=p.stateNode;if(0==(64&p.effectTag)&&("function"==typeof w.getDerivedStateFromError||null!==ub&&"function"==typeof ub.componentDidCatch&&(null===aj||!aj.has(ub)))){var vb;p.effectTag|=4096,p.expirationTime=b,yg(p,$i(p,k,b));break a}}p=p.return}while(null!==p)}X=Pj(X)}catch(Xc){b=Xc;continue}break}}function Fj(){var a=cj.current;return cj.current=sh,null===a?sh:a}function Ag(a,b){a<lj&&2<a&&(lj=a),null!==b&&a<mj&&2<a&&(mj=a,nj=b)}function Bg(a){a>wi&&(wi=a)}function Kj(){for(;null!==X;)X=Qj(X)}function Gj(){for(;null!==X&&!Uf();)X=Qj(X)}function Qj(a){var b=Rj(a.alternate,a,U);return a.memoizedProps=a.pendingProps,null===b&&(b=Pj(a)),dj.current=null,b}function Pj(a){X=a;do{var b=X.alternate;if(a=X.return,0==(2048&X.effectTag)){if(b=si(b,X,U),1===U||1!==X.childExpirationTime){for(var c=0,d=X.child;null!==d;){var e=d.expirationTime,f=d.childExpirationTime;e>c&&(c=e),f>c&&(c=f),d=d.sibling}X.childExpirationTime=c}if(null!==b)return b;null!==a&&0==(2048&a.effectTag)&&(null===a.firstEffect&&(a.firstEffect=X.firstEffect),null!==X.lastEffect&&(null!==a.lastEffect&&(a.lastEffect.nextEffect=X.firstEffect),a.lastEffect=X.lastEffect),1<X.effectTag&&(null!==a.lastEffect?a.lastEffect.nextEffect=X:a.firstEffect=X,a.lastEffect=X))}else{if(null!==(b=zi(X)))return b.effectTag&=2047,b;null!==a&&(a.firstEffect=a.lastEffect=null,a.effectTag|=2048)}if(null!==(b=X.sibling))return b;X=a}while(null!==X);return S===ti&&(S=5),null}function Ij(a){var b=a.expirationTime;return b>(a=a.childExpirationTime)?b:a}function Jj(a){var b=ag();return cg(99,Sj.bind(null,a,b)),null}function Sj(a,b){do{Dj()}while(null!==rj);if(0!=(48&W))throw Error(u(327));var c=a.finishedWork,d=a.finishedExpirationTime;if(null===c)return null;if(a.finishedWork=null,a.finishedExpirationTime=0,c===a.current)throw Error(u(177));a.callbackNode=null,a.callbackExpirationTime=0,a.callbackPriority=90,a.nextKnownPendingLevel=0;var e=Ij(c);if(a.firstPendingTime=e,d<=a.lastSuspendedTime?a.firstSuspendedTime=a.lastSuspendedTime=a.nextKnownPendingLevel=0:d<=a.firstSuspendedTime&&(a.firstSuspendedTime=d-1),d<=a.lastPingedTime&&(a.lastPingedTime=0),d<=a.lastExpiredTime&&(a.lastExpiredTime=0),a===T&&(X=T=null,U=0),1<c.effectTag?null!==c.lastEffect?(c.lastEffect.nextEffect=c,e=c.firstEffect):e=c:e=c.firstEffect,null!==e){var f=W;W|=32,dj.current=null,Dd=fd;var g=xd();if(yd(g)){if("selectionStart"in g)var h={start:g.selectionStart,end:g.selectionEnd};else a:{var k=(h=(h=g.ownerDocument)&&h.defaultView||window).getSelection&&h.getSelection();if(k&&0!==k.rangeCount){h=k.anchorNode;var l=k.anchorOffset,m=k.focusNode;k=k.focusOffset;try{h.nodeType,m.nodeType}catch(wb){h=null;break a}var p=0,x=-1,z=-1,ca=0,D=0,t=g,y=null;b:for(;;){for(var A;t!==h||0!==l&&3!==t.nodeType||(x=p+l),t!==m||0!==k&&3!==t.nodeType||(z=p+k),3===t.nodeType&&(p+=t.nodeValue.length),null!==(A=t.firstChild);)y=t,t=A;for(;;){if(t===g)break b;if(y===h&&++ca===l&&(x=p),y===m&&++D===k&&(z=p),null!==(A=t.nextSibling))break;y=(t=y).parentNode}t=A}h=-1===x||-1===z?null:{start:x,end:z}}else h=null}h=h||{start:0,end:0}}else h=null;Ed={activeElementDetached:null,focusedElem:g,selectionRange:h},fd=!1,Y=e;do{try{Tj()}catch(wb){if(null===Y)throw Error(u(330));Ei(Y,wb),Y=Y.nextEffect}}while(null!==Y);Y=e;do{try{for(g=a,h=b;null!==Y;){var q=Y.effectTag;if(16&q&&Rb(Y.stateNode,""),128&q){var B=Y.alternate;if(null!==B){var w=B.ref;null!==w&&("function"==typeof w?w(null):w.current=null)}}switch(1038&q){case 2:Pi(Y),Y.effectTag&=-3;break;case 6:Pi(Y),Y.effectTag&=-3,Si(Y.alternate,Y);break;case 1024:Y.effectTag&=-1025;break;case 1028:Y.effectTag&=-1025,Si(Y.alternate,Y);break;case 4:Si(Y.alternate,Y);break;case 8:Mi(g,l=Y,h),Ni(l)}Y=Y.nextEffect}}catch(wb){if(null===Y)throw Error(u(330));Ei(Y,wb),Y=Y.nextEffect}}while(null!==Y);if(w=Ed,B=xd(),q=w.focusedElem,h=w.selectionRange,B!==q&&q&&q.ownerDocument&&wd(q.ownerDocument.documentElement,q)){null!==h&&yd(q)&&(B=h.start,void 0===(w=h.end)&&(w=B),"selectionStart"in q?(q.selectionStart=B,q.selectionEnd=Math.min(w,q.value.length)):(w=(B=q.ownerDocument||document)&&B.defaultView||window).getSelection&&(w=w.getSelection(),l=q.textContent.length,g=Math.min(h.start,l),h=void 0===h.end?g:Math.min(h.end,l),!w.extend&&g>h&&(l=h,h=g,g=l),l=vd(q,g),m=vd(q,h),l&&m&&(1!==w.rangeCount||w.anchorNode!==l.node||w.anchorOffset!==l.offset||w.focusNode!==m.node||w.focusOffset!==m.offset)&&((B=B.createRange()).setStart(l.node,l.offset),w.removeAllRanges(),g>h?(w.addRange(B),w.extend(m.node,m.offset)):(B.setEnd(m.node,m.offset),w.addRange(B))))),B=[];for(w=q;w=w.parentNode;)1===w.nodeType&&B.push({element:w,left:w.scrollLeft,top:w.scrollTop});for("function"==typeof q.focus&&q.focus(),q=0;q<B.length;q++)(w=B[q]).element.scrollLeft=w.left,w.element.scrollTop=w.top}fd=!!Dd,Ed=Dd=null,a.current=c,Y=e;do{try{for(q=a;null!==Y;){var ub=Y.effectTag;if(36&ub&&Ji(q,Y.alternate,Y),128&ub){B=void 0;var vb=Y.ref;if(null!==vb){var Xc=Y.stateNode;switch(Y.tag){case 5:B=Xc;break;default:B=Xc}"function"==typeof vb?vb(B):vb.current=B}}Y=Y.nextEffect}}catch(wb){if(null===Y)throw Error(u(330));Ei(Y,wb),Y=Y.nextEffect}}while(null!==Y);Y=null,Vf(),W=f}else a.current=c;if(qj)qj=!1,rj=a,sj=b;else for(Y=e;null!==Y;)b=Y.nextEffect,Y.nextEffect=null,Y=b;if(0===(b=a.firstPendingTime)&&(aj=null),1073741823===b?a===vj?uj++:(uj=0,vj=a):uj=0,"function"==typeof Uj&&Uj(c.stateNode,d),Z(a),Yi)throw Yi=!1,a=Zi,Zi=null,a;return 0!=(8&W)?null:(gg(),null)}function Tj(){for(;null!==Y;){var a=Y.effectTag;0!=(256&a)&&Gi(Y.alternate,Y),0==(512&a)||qj||(qj=!0,dg(97,(function(){return Dj(),null}))),Y=Y.nextEffect}}function Dj(){if(90!==sj){var a=97<sj?97:sj;return sj=90,cg(a,Vj)}}function Vj(){if(null===rj)return!1;var a=rj;if(rj=null,0!=(48&W))throw Error(u(331));var b=W;for(W|=32,a=a.current.firstEffect;null!==a;){try{var c=a;if(0!=(512&c.effectTag))switch(c.tag){case 0:case 11:case 15:case 22:Hi(5,c),Ii(5,c)}}catch(d){if(null===a)throw Error(u(330));Ei(a,d)}c=a.nextEffect,a.nextEffect=null,a=c}return W=b,gg(),!0}function Wj(a,b,c){xg(a,b=Xi(a,b=Ai(c,b),1073741823)),null!==(a=xj(a,1073741823))&&Z(a)}function Ei(a,b){if(3===a.tag)Wj(a,a,b);else for(var c=a.return;null!==c;){if(3===c.tag){Wj(c,a,b);break}if(1===c.tag){var d=c.stateNode;if("function"==typeof c.type.getDerivedStateFromError||"function"==typeof d.componentDidCatch&&(null===aj||!aj.has(d))){xg(c,a=$i(c,a=Ai(b,a),1073741823)),null!==(c=xj(c,1073741823))&&Z(c);break}}c=c.return}}function Oj(a,b,c){var d=a.pingCache;null!==d&&d.delete(b),T===a&&U===c?S===vi||S===ui&&1073741823===lj&&$f()-Ti<pj?Ej(a,U):oj=!0:Aj(a,c)&&(0!==(b=a.lastPingedTime)&&b<c||(a.lastPingedTime=c,Z(a)))}function Vi(a,b){var c=a.stateNode;null!==c&&c.delete(b),0===(b=0)&&(b=Hg(b=Gg(),a,null)),null!==(a=xj(a,b))&&Z(a)}Rj=function(a,b,c){var d=b.expirationTime;if(null!==a){var e=b.pendingProps;if(a.memoizedProps!==e||K.current)rg=!0;else{if(d<c){switch(rg=!1,b.tag){case 3:hi(b),Xh();break;case 5:if(fh(b),4&b.mode&&1!==c&&e.hidden)return b.expirationTime=b.childExpirationTime=1,null;break;case 1:L(b.type)&&Gf(b);break;case 4:dh(b,b.stateNode.containerInfo);break;case 10:d=b.memoizedProps.value,e=b.type._context,I(jg,e._currentValue),e._currentValue=d;break;case 13:if(null!==b.memoizedState)return 0!==(d=b.child.childExpirationTime)&&d>=c?ji(a,b,c):(I(M,1&M.current),null!==(b=$h(a,b,c))?b.sibling:null);I(M,1&M.current);break;case 19:if(d=b.childExpirationTime>=c,0!=(64&a.effectTag)){if(d)return mi(a,b,c);b.effectTag|=64}if(null!==(e=b.memoizedState)&&(e.rendering=null,e.tail=null),I(M,M.current),!d)return null}return $h(a,b,c)}rg=!1}}else rg=!1;switch(b.expirationTime=0,b.tag){case 2:if(d=b.type,null!==a&&(a.alternate=null,b.alternate=null,b.effectTag|=2),a=b.pendingProps,e=Cf(b,J.current),qg(b,c),e=oh(null,b,d,a,e,c),b.effectTag|=1,"object"==typeof e&&null!==e&&"function"==typeof e.render&&void 0===e.$$typeof){if(b.tag=1,b.memoizedState=null,b.updateQueue=null,L(d)){var f=!0;Gf(b)}else f=!1;b.memoizedState=null!==e.state&&void 0!==e.state?e.state:null,ug(b);var g=d.getDerivedStateFromProps;"function"==typeof g&&Fg(b,d,g,a),e.updater=Jg,b.stateNode=e,e._reactInternalFiber=b,Ng(b,d,a,c),b=gi(null,b,d,!0,f,c)}else b.tag=0,R(null,b,e,c),b=b.child;return b;case 16:a:{if(e=b.elementType,null!==a&&(a.alternate=null,b.alternate=null,b.effectTag|=2),a=b.pendingProps,ob(e),1!==e._status)throw e._result;switch(e=e._result,b.type=e,f=b.tag=Xj(e),a=ig(e,a),f){case 0:b=di(null,b,e,a,c);break a;case 1:b=fi(null,b,e,a,c);break a;case 11:b=Zh(null,b,e,a,c);break a;case 14:b=ai(null,b,e,ig(e.type,a),d,c);break a}throw Error(u(306,e,""))}return b;case 0:return d=b.type,e=b.pendingProps,di(a,b,d,e=b.elementType===d?e:ig(d,e),c);case 1:return d=b.type,e=b.pendingProps,fi(a,b,d,e=b.elementType===d?e:ig(d,e),c);case 3:if(hi(b),d=b.updateQueue,null===a||null===d)throw Error(u(282));if(d=b.pendingProps,e=null!==(e=b.memoizedState)?e.element:null,vg(a,b),zg(b,d,null,c),(d=b.memoizedState.element)===e)Xh(),b=$h(a,b,c);else{if((e=b.stateNode.hydrate)&&(Ph=Jd(b.stateNode.containerInfo.firstChild),Oh=b,e=Qh=!0),e)for(c=Yg(b,null,d,c),b.child=c;c;)c.effectTag=-3&c.effectTag|1024,c=c.sibling;else R(a,b,d,c),Xh();b=b.child}return b;case 5:return fh(b),null===a&&Uh(b),d=b.type,e=b.pendingProps,f=null!==a?a.memoizedProps:null,g=e.children,Gd(d,e)?g=null:null!==f&&Gd(d,f)&&(b.effectTag|=16),ei(a,b),4&b.mode&&1!==c&&e.hidden?(b.expirationTime=b.childExpirationTime=1,b=null):(R(a,b,g,c),b=b.child),b;case 6:return null===a&&Uh(b),null;case 13:return ji(a,b,c);case 4:return dh(b,b.stateNode.containerInfo),d=b.pendingProps,null===a?b.child=Xg(b,null,d,c):R(a,b,d,c),b.child;case 11:return d=b.type,e=b.pendingProps,Zh(a,b,d,e=b.elementType===d?e:ig(d,e),c);case 7:return R(a,b,b.pendingProps,c),b.child;case 8:case 12:return R(a,b,b.pendingProps.children,c),b.child;case 10:a:{d=b.type._context,e=b.pendingProps,g=b.memoizedProps,f=e.value;var h=b.type._context;if(I(jg,h._currentValue),h._currentValue=f,null!==g)if(h=g.value,0===(f=$e(h,f)?0:0|("function"==typeof d._calculateChangedBits?d._calculateChangedBits(h,f):1073741823))){if(g.children===e.children&&!K.current){b=$h(a,b,c);break a}}else for(null!==(h=b.child)&&(h.return=b);null!==h;){var k=h.dependencies;if(null!==k){g=h.child;for(var l=k.firstContext;null!==l;){if(l.context===d&&0!=(l.observedBits&f)){1===h.tag&&((l=wg(c,null)).tag=2,xg(h,l)),h.expirationTime<c&&(h.expirationTime=c),null!==(l=h.alternate)&&l.expirationTime<c&&(l.expirationTime=c),pg(h.return,c),k.expirationTime<c&&(k.expirationTime=c);break}l=l.next}}else g=10===h.tag&&h.type===b.type?null:h.child;if(null!==g)g.return=h;else for(g=h;null!==g;){if(g===b){g=null;break}if(null!==(h=g.sibling)){h.return=g.return,g=h;break}g=g.return}h=g}R(a,b,e.children,c),b=b.child}return b;case 9:return e=b.type,d=(f=b.pendingProps).children,qg(b,c),d=d(e=sg(e,f.unstable_observedBits)),b.effectTag|=1,R(a,b,d,c),b.child;case 14:return f=ig(e=b.type,b.pendingProps),ai(a,b,e,f=ig(e.type,f),d,c);case 15:return ci(a,b,b.type,b.pendingProps,d,c);case 17:return d=b.type,e=b.pendingProps,e=b.elementType===d?e:ig(d,e),null!==a&&(a.alternate=null,b.alternate=null,b.effectTag|=2),b.tag=1,L(d)?(a=!0,Gf(b)):a=!1,qg(b,c),Lg(b,d,e),Ng(b,d,e,c),gi(null,b,d,!0,a,c);case 19:return mi(a,b,c)}throw Error(u(156,b.tag))};var Uj=null,Li=null;function Yj(a){if("undefined"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__)return!1;var b=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(b.isDisabled||!b.supportsFiber)return!0;try{var c=b.inject(a);Uj=function(a){try{b.onCommitFiberRoot(c,a,void 0,64==(64&a.current.effectTag))}catch(e){}},Li=function(a){try{b.onCommitFiberUnmount(c,a)}catch(e){}}}catch(d){}return!0}function Zj(a,b,c,d){this.tag=a,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=b,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=d,this.effectTag=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childExpirationTime=this.expirationTime=0,this.alternate=null}function Sh(a,b,c,d){return new Zj(a,b,c,d)}function bi(a){return!(!(a=a.prototype)||!a.isReactComponent)}function Xj(a){if("function"==typeof a)return bi(a)?1:0;if(null!=a){if((a=a.$$typeof)===gb)return 11;if(a===jb)return 14}return 2}function Sg(a,b){var c=a.alternate;return null===c?((c=Sh(a.tag,b,a.key,a.mode)).elementType=a.elementType,c.type=a.type,c.stateNode=a.stateNode,c.alternate=a,a.alternate=c):(c.pendingProps=b,c.effectTag=0,c.nextEffect=null,c.firstEffect=null,c.lastEffect=null),c.childExpirationTime=a.childExpirationTime,c.expirationTime=a.expirationTime,c.child=a.child,c.memoizedProps=a.memoizedProps,c.memoizedState=a.memoizedState,c.updateQueue=a.updateQueue,b=a.dependencies,c.dependencies=null===b?null:{expirationTime:b.expirationTime,firstContext:b.firstContext,responders:b.responders},c.sibling=a.sibling,c.index=a.index,c.ref=a.ref,c}function Ug(a,b,c,d,e,f){var g=2;if(d=a,"function"==typeof a)bi(a)&&(g=1);else if("string"==typeof a)g=5;else a:switch(a){case ab:return Wg(c.children,e,f,b);case fb:g=8,e|=7;break;case bb:g=8,e|=1;break;case cb:return(a=Sh(12,c,b,8|e)).elementType=cb,a.type=cb,a.expirationTime=f,a;case hb:return(a=Sh(13,c,b,e)).type=hb,a.elementType=hb,a.expirationTime=f,a;case ib:return(a=Sh(19,c,b,e)).elementType=ib,a.expirationTime=f,a;default:if("object"==typeof a&&null!==a)switch(a.$$typeof){case db:g=10;break a;case eb:g=9;break a;case gb:g=11;break a;case jb:g=14;break a;case kb:g=16,d=null;break a;case lb:g=22;break a}throw Error(u(130,null==a?a:typeof a,""))}return(b=Sh(g,c,b,e)).elementType=a,b.type=d,b.expirationTime=f,b}function Wg(a,b,c,d){return(a=Sh(7,a,d,b)).expirationTime=c,a}function Tg(a,b,c){return(a=Sh(6,a,null,b)).expirationTime=c,a}function Vg(a,b,c){return(b=Sh(4,null!==a.children?a.children:[],a.key,b)).expirationTime=c,b.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},b}function ak(a,b,c){this.tag=b,this.current=null,this.containerInfo=a,this.pingCache=this.pendingChildren=null,this.finishedExpirationTime=0,this.finishedWork=null,this.timeoutHandle=-1,this.pendingContext=this.context=null,this.hydrate=c,this.callbackNode=null,this.callbackPriority=90,this.lastExpiredTime=this.lastPingedTime=this.nextKnownPendingLevel=this.lastSuspendedTime=this.firstSuspendedTime=this.firstPendingTime=0}function Aj(a,b){var c=a.firstSuspendedTime;return a=a.lastSuspendedTime,0!==c&&c>=b&&a<=b}function xi(a,b){var c=a.firstSuspendedTime,d=a.lastSuspendedTime;c<b&&(a.firstSuspendedTime=b),(d>b||0===c)&&(a.lastSuspendedTime=b),b<=a.lastPingedTime&&(a.lastPingedTime=0),b<=a.lastExpiredTime&&(a.lastExpiredTime=0)}function yi(a,b){b>a.firstPendingTime&&(a.firstPendingTime=b);var c=a.firstSuspendedTime;0!==c&&(b>=c?a.firstSuspendedTime=a.lastSuspendedTime=a.nextKnownPendingLevel=0:b>=a.lastSuspendedTime&&(a.lastSuspendedTime=b+1),b>a.nextKnownPendingLevel&&(a.nextKnownPendingLevel=b))}function Cj(a,b){var c=a.lastExpiredTime;(0===c||c>b)&&(a.lastExpiredTime=b)}function bk(a,b,c,d){var e=b.current,f=Gg(),g=Dg.suspense;f=Hg(f,e,g);a:if(c){b:{if(dc(c=c._reactInternalFiber)!==c||1!==c.tag)throw Error(u(170));var h=c;do{switch(h.tag){case 3:h=h.stateNode.context;break b;case 1:if(L(h.type)){h=h.stateNode.__reactInternalMemoizedMergedChildContext;break b}}h=h.return}while(null!==h);throw Error(u(171))}if(1===c.tag){var k=c.type;if(L(k)){c=Ff(c,k,h);break a}}c=h}else c=Af;return null===b.context?b.context=c:b.pendingContext=c,(b=wg(f,g)).payload={element:a},null!==(d=void 0===d?null:d)&&(b.callback=d),xg(e,b),Ig(e,f),f}function ck(a){if(!(a=a.current).child)return null;switch(a.child.tag){case 5:default:return a.child.stateNode}}function dk(a,b){null!==(a=a.memoizedState)&&null!==a.dehydrated&&a.retryTime<b&&(a.retryTime=b)}function ek(a,b){dk(a,b),(a=a.alternate)&&dk(a,b)}function fk(a,b,c){var d=new ak(a,b,c=null!=c&&!0===c.hydrate),e=Sh(3,null,null,2===b?7:1===b?3:0);d.current=e,e.stateNode=d,ug(e),a[Od]=d.current,c&&0!==b&&Jc(a,9===a.nodeType?a:a.ownerDocument),this._internalRoot=d}function gk(a){return!(!a||1!==a.nodeType&&9!==a.nodeType&&11!==a.nodeType&&(8!==a.nodeType||" react-mount-point-unstable "!==a.nodeValue))}function hk(a,b){if(b||(b=!(!(b=a?9===a.nodeType?a.documentElement:a.firstChild:null)||1!==b.nodeType||!b.hasAttribute("data-reactroot"))),!b)for(var c;c=a.lastChild;)a.removeChild(c);return new fk(a,0,b?{hydrate:!0}:void 0)}function ik(a,b,c,d,e){var f=c._reactRootContainer;if(f){var g=f._internalRoot;if("function"==typeof e){var h=e;e=function(){var a=ck(g);h.call(a)}}bk(b,g,a,e)}else{if(f=c._reactRootContainer=hk(c,d),g=f._internalRoot,"function"==typeof e){var k=e;e=function(){var a=ck(g);k.call(a)}}Nj((function(){bk(b,g,a,e)}))}return ck(g)}function jk(a,b,c){var d=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:$a,key:null==d?null:""+d,children:a,containerInfo:b,implementation:c}}function kk(a,b){var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!gk(b))throw Error(u(200));return jk(a,b,null,c)}fk.prototype.render=function(a){bk(a,this._internalRoot,null,null)},fk.prototype.unmount=function(){var a=this._internalRoot,b=a.containerInfo;bk(null,a,null,(function(){b[Od]=null}))},wc=function(a){if(13===a.tag){var b=hg(Gg(),150,100);Ig(a,b),ek(a,b)}},xc=function(a){13===a.tag&&(Ig(a,3),ek(a,3))},yc=function(a){if(13===a.tag){var b=Gg();Ig(a,b=Hg(b,a,null)),ek(a,b)}},za=function(a,b,c){switch(b){case"input":if(Cb(a,c),b=c.name,"radio"===c.type&&null!=b){for(c=a;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll("input[name="+JSON.stringify(""+b)+'][type="radio"]'),b=0;b<c.length;b++){var d=c[b];if(d!==a&&d.form===a.form){var e=Qd(d);if(!e)throw Error(u(90));yb(d),Cb(d,e)}}}break;case"textarea":Kb(a,c);break;case"select":null!=(b=c.value)&&Hb(a,!!c.multiple,b,!1)}},Fa=Mj,Ga=function(a,b,c,d,e){var f=W;W|=4;try{return cg(98,a.bind(null,b,c,d,e))}finally{0===(W=f)&&gg()}},Ha=function(){0==(49&W)&&(Lj(),Dj())},Ia=function(a,b){var c=W;W|=2;try{return a(b)}finally{0===(W=c)&&gg()}};var lk={Events:[Nc,Pd,Qd,xa,ta,Xd,function(a){jc(a,Wd)},Da,Ea,id,mc,Dj,{current:!1}]},a,b;b=(a={findFiberByHostInstance:tc,bundleType:0,version:"16.14.0",rendererPackageName:"react-dom"}).findFiberByHostInstance,Yj(n({},a,{overrideHookState:null,overrideProps:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Wa.ReactCurrentDispatcher,findHostInstanceByFiber:function(a){return null===(a=hc(a))?null:a.stateNode},findFiberByHostInstance:function(a){return b?b(a):null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null})),exports.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=lk,exports.createPortal=kk,exports.findDOMNode=function(a){if(null==a)return null;if(1===a.nodeType)return a;var b=a._reactInternalFiber;if(void 0===b){if("function"==typeof a.render)throw Error(u(188));throw Error(u(268,Object.keys(a)))}return a=null===(a=hc(b))?null:a.stateNode},exports.flushSync=function(a,b){if(0!=(48&W))throw Error(u(187));var c=W;W|=1;try{return cg(99,a.bind(null,b))}finally{W=c,gg()}},exports.hydrate=function(a,b,c){if(!gk(b))throw Error(u(200));return ik(null,a,b,!0,c)},exports.render=function(a,b,c){if(!gk(b))throw Error(u(200));return ik(null,a,b,!1,c)},exports.unmountComponentAtNode=function(a){if(!gk(a))throw Error(u(40));return!!a._reactRootContainer&&(Nj((function(){ik(null,null,a,!1,(function(){a._reactRootContainer=null,a[Od]=null}))})),!0)},exports.unstable_batchedUpdates=Mj,exports.unstable_createPortal=function(a,b){return kk(a,b,2<arguments.length&&void 0!==arguments[2]?arguments[2]:null)},exports.unstable_renderSubtreeIntoContainer=function(a,b,c,d){if(!gk(c))throw Error(u(200));if(null==a||void 0===a._reactInternalFiber)throw Error(u(38));return ik(a,b,c,!1,d)},exports.version="16.14.0"},{"object-assign":419,react:483,scheduler:506}],440:[function(require,module,exports){"use strict";function checkDCE(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)throw new Error("^_^")}module.exports=require("./cjs/react-dom.development.js")},{"./cjs/react-dom.development.js":438,"./cjs/react-dom.production.min.js":439}],441:[function(require,module,exports){!function(global,factory){"object"==typeof exports&&void 0!==module?module.exports=factory(require("react-dom"),require("react")):"function"==typeof define&&define.amd?define(["react-dom","react"],factory):global.ReactDraggable=factory(global.ReactDOM,global.React)}(this,(function(ReactDOM,React){"use strict";function createCommonjsModule(fn,module){return fn(module={exports:{}},module.exports),module.exports}function makeEmptyFunction(arg){return function(){return arg}}ReactDOM=ReactDOM&&ReactDOM.hasOwnProperty("default")?ReactDOM.default:ReactDOM,React=React&&React.hasOwnProperty("default")?React.default:React;var emptyFunction=function emptyFunction(){};emptyFunction.thatReturns=makeEmptyFunction,emptyFunction.thatReturnsFalse=makeEmptyFunction(!1),emptyFunction.thatReturnsTrue=makeEmptyFunction(!0),emptyFunction.thatReturnsNull=makeEmptyFunction(null),emptyFunction.thatReturnsThis=function(){return this},emptyFunction.thatReturnsArgument=function(arg){return arg};var emptyFunction_1=emptyFunction,validateFormat=function validateFormat(format){};function invariant(condition,format,a,b,c,d,e,f){if(validateFormat(format),!condition){var error;if(void 0===format)error=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var args=[a,b,c,d,e,f],argIndex=0;(error=new Error(format.replace(/%s/g,(function(){return args[argIndex++]})))).name="Invariant Violation"}throw error.framesToPop=1,error}}validateFormat=function validateFormat(format){if(void 0===format)throw new Error("invariant requires an error message argument")};var invariant_1=invariant,warning=emptyFunction_1,printWarning=function printWarning(format){for(var _len=arguments.length,args=Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)args[_key-1]=arguments[_key];var argIndex=0,message="Warning: "+format.replace(/%s/g,(function(){return args[argIndex++]}));"undefined"!=typeof console&&console.error(message);try{throw new Error(message)}catch(x){}},warning_1=warning=function warning(condition,format){if(void 0===format)throw new Error("`warning(condition, format, ...args)` requires a warning message argument");if(0!==format.indexOf("Failed Composite propType: ")&&!condition){for(var _len2=arguments.length,args=Array(_len2>2?_len2-2:0),_key2=2;_key2<_len2;_key2++)args[_key2-2]=arguments[_key2];printWarning.apply(void 0,[format].concat(args))}},getOwnPropertySymbols=Object.getOwnPropertySymbols,hasOwnProperty=Object.prototype.hasOwnProperty,propIsEnumerable=Object.prototype.propertyIsEnumerable;function toObject(val){if(null==val)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(val)}function shouldUseNative(){try{if(!Object.assign)return!1;var test1=new String("abc"),order2;if(test1[5]="de","5"===Object.getOwnPropertyNames(test1)[0])return!1;for(var test2={},i=0;i<10;i++)test2["_"+String.fromCharCode(i)]=i;if("0123456789"!==Object.getOwnPropertyNames(test2).map((function(n){return test2[n]})).join(""))return!1;var test3={};return"abcdefghijklmnopqrst".split("").forEach((function(letter){test3[letter]=letter})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},test3)).join("")}catch(err){return!1}}var objectAssign=shouldUseNative()?Object.assign:function(target,source){for(var from,to=toObject(target),symbols,s=1;s<arguments.length;s++){for(var key in from=Object(arguments[s]))hasOwnProperty.call(from,key)&&(to[key]=from[key]);if(getOwnPropertySymbols){symbols=getOwnPropertySymbols(from);for(var i=0;i<symbols.length;i++)propIsEnumerable.call(from,symbols[i])&&(to[symbols[i]]=from[symbols[i]])}}return to},ReactPropTypesSecret,ReactPropTypesSecret_1="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",invariant$1=invariant_1,warning$1=warning_1,ReactPropTypesSecret$1=ReactPropTypesSecret_1,loggedTypeFailures={};function checkPropTypes(typeSpecs,values,location,componentName,getStack){for(var typeSpecName in typeSpecs)if(typeSpecs.hasOwnProperty(typeSpecName)){var error;try{invariant$1("function"==typeof typeSpecs[typeSpecName],"%s: %s type `%s` is invalid; it must be a function, usually from the `prop-types` package, but received `%s`.",componentName||"React class",location,typeSpecName,typeof typeSpecs[typeSpecName]),error=typeSpecs[typeSpecName](values,typeSpecName,componentName,location,null,ReactPropTypesSecret$1)}catch(ex){error=ex}if(warning$1(!error||error instanceof Error,"%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",componentName||"React class",location,typeSpecName,typeof error),error instanceof Error&&!(error.message in loggedTypeFailures)){loggedTypeFailures[error.message]=!0;var stack=getStack?getStack():"";warning$1(!1,"Failed %s type: %s%s",location,error.message,null!=stack?stack:"")}}}var checkPropTypes_1=checkPropTypes,factoryWithTypeCheckers=function(isValidElement,throwOnDirectAccess){var ITERATOR_SYMBOL="function"==typeof Symbol&&Symbol.iterator,FAUX_ITERATOR_SYMBOL="@@iterator";function getIteratorFn(maybeIterable){var iteratorFn=maybeIterable&&(ITERATOR_SYMBOL&&maybeIterable[ITERATOR_SYMBOL]||maybeIterable["@@iterator"]);if("function"==typeof iteratorFn)return iteratorFn}var ANONYMOUS="<<anonymous>>",ReactPropTypes={array:createPrimitiveTypeChecker("array"),bool:createPrimitiveTypeChecker("boolean"),func:createPrimitiveTypeChecker("function"),number:createPrimitiveTypeChecker("number"),object:createPrimitiveTypeChecker("object"),string:createPrimitiveTypeChecker("string"),symbol:createPrimitiveTypeChecker("symbol"),any:createAnyTypeChecker(),arrayOf:createArrayOfTypeChecker,element:createElementTypeChecker(),instanceOf:createInstanceTypeChecker,node:createNodeChecker(),objectOf:createObjectOfTypeChecker,oneOf:createEnumTypeChecker,oneOfType:createUnionTypeChecker,shape:createShapeTypeChecker,exact:createStrictShapeTypeChecker};function is(x,y){return x===y?0!==x||1/x==1/y:x!=x&&y!=y}function PropTypeError(message){this.message=message,this.stack=""}function createChainableTypeChecker(validate){var manualPropTypeCallCache={},manualPropTypeWarningCount=0;function checkType(isRequired,props,propName,componentName,location,propFullName,secret){if(componentName=componentName||ANONYMOUS,propFullName=propFullName||propName,secret!==ReactPropTypesSecret_1)if(throwOnDirectAccess)invariant_1(!1,"Calling PropTypes validators directly is not supported by the `prop-types` package. Use `PropTypes.checkPropTypes()` to call them. Read more at http://fb.me/use-check-prop-types");else if("undefined"!=typeof console){var cacheKey=componentName+":"+propName;!manualPropTypeCallCache[cacheKey]&&manualPropTypeWarningCount<3&&(warning_1(!1,"You are manually calling a React.PropTypes validation function for the `%s` prop on `%s`. This is deprecated and will throw in the standalone `prop-types` package. You may be seeing this warning due to a third-party PropTypes library. See https://fb.me/react-warning-dont-call-proptypes for details.",propFullName,componentName),manualPropTypeCallCache[cacheKey]=!0,manualPropTypeWarningCount++)}return null==props[propName]?isRequired?null===props[propName]?new PropTypeError("The "+location+" `"+propFullName+"` is marked as required in `"+componentName+"`, but its value is `null`."):new PropTypeError("The "+location+" `"+propFullName+"` is marked as required in `"+componentName+"`, but its value is `undefined`."):null:validate(props,propName,componentName,location,propFullName)}var chainedCheckType=checkType.bind(null,!1);return chainedCheckType.isRequired=checkType.bind(null,!0),chainedCheckType}function createPrimitiveTypeChecker(expectedType){function validate(props,propName,componentName,location,propFullName,secret){var propValue=props[propName],propType,preciseType;return getPropType(propValue)!==expectedType?new PropTypeError("Invalid "+location+" `"+propFullName+"` of type `"+getPreciseType(propValue)+"` supplied to `"+componentName+"`, expected `"+expectedType+"`."):null}return createChainableTypeChecker(validate)}function createAnyTypeChecker(){return createChainableTypeChecker(emptyFunction_1.thatReturnsNull)}function createArrayOfTypeChecker(typeChecker){function validate(props,propName,componentName,location,propFullName){if("function"!=typeof typeChecker)return new PropTypeError("Property `"+propFullName+"` of component `"+componentName+"` has invalid PropType notation inside arrayOf.");var propValue=props[propName],propType;if(!Array.isArray(propValue))return new PropTypeError("Invalid "+location+" `"+propFullName+"` of type `"+getPropType(propValue)+"` supplied to `"+componentName+"`, expected an array.");for(var i=0;i<propValue.length;i++){var error=typeChecker(propValue,i,componentName,location,propFullName+"["+i+"]",ReactPropTypesSecret_1);if(error instanceof Error)return error}return null}return createChainableTypeChecker(validate)}function createElementTypeChecker(){function validate(props,propName,componentName,location,propFullName){var propValue=props[propName],propType;return isValidElement(propValue)?null:new PropTypeError("Invalid "+location+" `"+propFullName+"` of type `"+getPropType(propValue)+"` supplied to `"+componentName+"`, expected a single ReactElement.")}return createChainableTypeChecker(validate)}function createInstanceTypeChecker(expectedClass){function validate(props,propName,componentName,location,propFullName){if(!(props[propName]instanceof expectedClass)){var expectedClassName=expectedClass.name||ANONYMOUS,actualClassName;return new PropTypeError("Invalid "+location+" `"+propFullName+"` of type `"+getClassName(props[propName])+"` supplied to `"+componentName+"`, expected instance of `"+expectedClassName+"`.")}return null}return createChainableTypeChecker(validate)}function createEnumTypeChecker(expectedValues){if(!Array.isArray(expectedValues))return warning_1(!1,"Invalid argument supplied to oneOf, expected an instance of array."),emptyFunction_1.thatReturnsNull;function validate(props,propName,componentName,location,propFullName){for(var propValue=props[propName],i=0;i<expectedValues.length;i++)if(is(propValue,expectedValues[i]))return null;var valuesString;return new PropTypeError("Invalid "+location+" `"+propFullName+"` of value `"+propValue+"` supplied to `"+componentName+"`, expected one of "+JSON.stringify(expectedValues)+".")}return createChainableTypeChecker(validate)}function createObjectOfTypeChecker(typeChecker){function validate(props,propName,componentName,location,propFullName){if("function"!=typeof typeChecker)return new PropTypeError("Property `"+propFullName+"` of component `"+componentName+"` has invalid PropType notation inside objectOf.");var propValue=props[propName],propType=getPropType(propValue);if("object"!==propType)return new PropTypeError("Invalid "+location+" `"+propFullName+"` of type `"+propType+"` supplied to `"+componentName+"`, expected an object.");for(var key in propValue)if(propValue.hasOwnProperty(key)){var error=typeChecker(propValue,key,componentName,location,propFullName+"."+key,ReactPropTypesSecret_1);if(error instanceof Error)return error}return null}return createChainableTypeChecker(validate)}function createUnionTypeChecker(arrayOfTypeCheckers){if(!Array.isArray(arrayOfTypeCheckers))return warning_1(!1,"Invalid argument supplied to oneOfType, expected an instance of array."),emptyFunction_1.thatReturnsNull;for(var i=0;i<arrayOfTypeCheckers.length;i++){var checker=arrayOfTypeCheckers[i];if("function"!=typeof checker)return warning_1(!1,"Invalid argument supplied to oneOfType. Expected an array of check functions, but received %s at index %s.",getPostfixForTypeWarning(checker),i),emptyFunction_1.thatReturnsNull}function validate(props,propName,componentName,location,propFullName){for(var i=0;i<arrayOfTypeCheckers.length;i++){var checker;if(null==(0,arrayOfTypeCheckers[i])(props,propName,componentName,location,propFullName,ReactPropTypesSecret_1))return null}return new PropTypeError("Invalid "+location+" `"+propFullName+"` supplied to `"+componentName+"`.")}return createChainableTypeChecker(validate)}function createNodeChecker(){function validate(props,propName,componentName,location,propFullName){return isNode(props[propName])?null:new PropTypeError("Invalid "+location+" `"+propFullName+"` supplied to `"+componentName+"`, expected a ReactNode.")}return createChainableTypeChecker(validate)}function createShapeTypeChecker(shapeTypes){function validate(props,propName,componentName,location,propFullName){var propValue=props[propName],propType=getPropType(propValue);if("object"!==propType)return new PropTypeError("Invalid "+location+" `"+propFullName+"` of type `"+propType+"` supplied to `"+componentName+"`, expected `object`.");for(var key in shapeTypes){var checker=shapeTypes[key];if(checker){var error=checker(propValue,key,componentName,location,propFullName+"."+key,ReactPropTypesSecret_1);if(error)return error}}return null}return createChainableTypeChecker(validate)}function createStrictShapeTypeChecker(shapeTypes){function validate(props,propName,componentName,location,propFullName){var propValue=props[propName],propType=getPropType(propValue);if("object"!==propType)return new PropTypeError("Invalid "+location+" `"+propFullName+"` of type `"+propType+"` supplied to `"+componentName+"`, expected `object`.");var allKeys=objectAssign({},props[propName],shapeTypes);for(var key in allKeys){var checker=shapeTypes[key];if(!checker)return new PropTypeError("Invalid "+location+" `"+propFullName+"` key `"+key+"` supplied to `"+componentName+"`.\nBad object: "+JSON.stringify(props[propName],null,"  ")+"\nValid keys: "+JSON.stringify(Object.keys(shapeTypes),null,"  "));var error=checker(propValue,key,componentName,location,propFullName+"."+key,ReactPropTypesSecret_1);if(error)return error}return null}return createChainableTypeChecker(validate)}function isNode(propValue){switch(typeof propValue){case"number":case"string":case"undefined":return!0;case"boolean":return!propValue;case"object":if(Array.isArray(propValue))return propValue.every(isNode);if(null===propValue||isValidElement(propValue))return!0;var iteratorFn=getIteratorFn(propValue);if(!iteratorFn)return!1;var iterator=iteratorFn.call(propValue),step;if(iteratorFn!==propValue.entries){for(;!(step=iterator.next()).done;)if(!isNode(step.value))return!1}else for(;!(step=iterator.next()).done;){var entry=step.value;if(entry&&!isNode(entry[1]))return!1}return!0;default:return!1}}function isSymbol(propType,propValue){return"symbol"===propType||("Symbol"===propValue["@@toStringTag"]||"function"==typeof Symbol&&propValue instanceof Symbol)}function getPropType(propValue){var propType=typeof propValue;return Array.isArray(propValue)?"array":propValue instanceof RegExp?"object":isSymbol(propType,propValue)?"symbol":propType}function getPreciseType(propValue){if(null==propValue)return""+propValue;var propType=getPropType(propValue);if("object"===propType){if(propValue instanceof Date)return"date";if(propValue instanceof RegExp)return"regexp"}return propType}function getPostfixForTypeWarning(value){var type=getPreciseType(value);switch(type){case"array":case"object":return"an "+type;case"boolean":case"date":case"regexp":return"a "+type;default:return type}}function getClassName(propValue){return propValue.constructor&&propValue.constructor.name?propValue.constructor.name:ANONYMOUS}return PropTypeError.prototype=Error.prototype,ReactPropTypes.checkPropTypes=checkPropTypes_1,ReactPropTypes.PropTypes=ReactPropTypes,ReactPropTypes},propTypes=createCommonjsModule((function(module){var REACT_ELEMENT_TYPE="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103,isValidElement=function(object){return"object"==typeof object&&null!==object&&object.$$typeof===REACT_ELEMENT_TYPE},throwOnDirectAccess=!0;module.exports=factoryWithTypeCheckers(isValidElement,!0)})),classnames=createCommonjsModule((function(module){
/*!
	  Copyright (c) 2016 Jed Watson.
	  Licensed under the MIT License (MIT), see
	  http://jedwatson.github.io/classnames
	*/
!function(){var hasOwn={}.hasOwnProperty;function classNames(){for(var classes=[],i=0;i<arguments.length;i++){var arg=arguments[i];if(arg){var argType=typeof arg;if("string"===argType||"number"===argType)classes.push(arg);else if(Array.isArray(arg))classes.push(classNames.apply(null,arg));else if("object"===argType)for(var key in arg)hasOwn.call(arg,key)&&arg[key]&&classes.push(key)}}return classes.join(" ")}module.exports?module.exports=classNames:window.classNames=classNames}()}));function findInArray(array,callback){for(var i=0,length=array.length;i<length;i++)if(callback.apply(callback,[array[i],i,array]))return array[i]}function isFunction(func){return"function"==typeof func||"[object Function]"===Object.prototype.toString.call(func)}function isNum(num){return"number"==typeof num&&!isNaN(num)}function int(a){return parseInt(a,10)}function dontSetMe(props,propName,componentName){if(props[propName])return new Error("Invalid prop "+propName+" passed to "+componentName+" - do not set this, set it on the child.")}var prefixes=["Moz","Webkit","O","ms"];function getPrefix(){var prop=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"transform";if("undefined"==typeof window||void 0===window.document)return"";var style=window.document.documentElement.style;if(prop in style)return"";for(var i=0;i<prefixes.length;i++)if(browserPrefixToKey(prop,prefixes[i])in style)return prefixes[i];return""}function browserPrefixToKey(prop,prefix){return prefix?""+prefix+kebabToTitleCase(prop):prop}function kebabToTitleCase(str){for(var out="",shouldCapitalize=!0,i=0;i<str.length;i++)shouldCapitalize?(out+=str[i].toUpperCase(),shouldCapitalize=!1):"-"===str[i]?shouldCapitalize=!0:out+=str[i];return out}var browserPrefix=getPrefix(),classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),defineProperty=function(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj},_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)},possibleConstructorReturn=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call},slicedToArray=function(){function sliceIterator(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{!_n&&_i.return&&_i.return()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr))return arr;if(Symbol.iterator in Object(arr))return sliceIterator(arr,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),matchesSelectorFunc="";function matchesSelector(el,selector){return matchesSelectorFunc||(matchesSelectorFunc=findInArray(["matches","webkitMatchesSelector","mozMatchesSelector","msMatchesSelector","oMatchesSelector"],(function(method){return isFunction(el[method])}))),!!isFunction(el[matchesSelectorFunc])&&el[matchesSelectorFunc](selector)}function matchesSelectorAndParentsTo(el,selector,baseNode){var node=el;do{if(matchesSelector(node,selector))return!0;if(node===baseNode)return!1;node=node.parentNode}while(node);return!1}function addEvent(el,event,handler){el&&(el.attachEvent?el.attachEvent("on"+event,handler):el.addEventListener?el.addEventListener(event,handler,!0):el["on"+event]=handler)}function removeEvent(el,event,handler){el&&(el.detachEvent?el.detachEvent("on"+event,handler):el.removeEventListener?el.removeEventListener(event,handler,!0):el["on"+event]=null)}function outerHeight(node){var height=node.clientHeight,computedStyle=node.ownerDocument.defaultView.getComputedStyle(node);return height+=int(computedStyle.borderTopWidth),height+=int(computedStyle.borderBottomWidth)}function outerWidth(node){var width=node.clientWidth,computedStyle=node.ownerDocument.defaultView.getComputedStyle(node);return width+=int(computedStyle.borderLeftWidth),width+=int(computedStyle.borderRightWidth)}function innerHeight(node){var height=node.clientHeight,computedStyle=node.ownerDocument.defaultView.getComputedStyle(node);return height-=int(computedStyle.paddingTop),height-=int(computedStyle.paddingBottom)}function innerWidth(node){var width=node.clientWidth,computedStyle=node.ownerDocument.defaultView.getComputedStyle(node);return width-=int(computedStyle.paddingLeft),width-=int(computedStyle.paddingRight)}function offsetXYFromParent(evt,offsetParent){var isBody,offsetParentRect=offsetParent===offsetParent.ownerDocument.body?{left:0,top:0}:offsetParent.getBoundingClientRect(),x,y;return{x:evt.clientX+offsetParent.scrollLeft-offsetParentRect.left,y:evt.clientY+offsetParent.scrollTop-offsetParentRect.top}}function createCSSTransform(controlPos,positionOffset){var translation=getTranslation(controlPos,positionOffset,"px");return defineProperty({},browserPrefixToKey("transform",browserPrefix),translation)}function createSVGTransform(controlPos,positionOffset){var translation;return getTranslation(controlPos,positionOffset,"")}function getTranslation(_ref2,positionOffset,unitSuffix){var x,y,translation="translate("+_ref2.x+unitSuffix+","+_ref2.y+unitSuffix+")",defaultX,defaultY;positionOffset&&(translation="translate("+(""+("string"==typeof positionOffset.x?positionOffset.x:positionOffset.x+unitSuffix))+", "+(""+("string"==typeof positionOffset.y?positionOffset.y:positionOffset.y+unitSuffix))+")"+translation);return translation}function getTouch(e,identifier){return e.targetTouches&&findInArray(e.targetTouches,(function(t){return identifier===t.identifier}))||e.changedTouches&&findInArray(e.changedTouches,(function(t){return identifier===t.identifier}))}function getTouchIdentifier(e){return e.targetTouches&&e.targetTouches[0]?e.targetTouches[0].identifier:e.changedTouches&&e.changedTouches[0]?e.changedTouches[0].identifier:void 0}function addUserSelectStyles(doc){if(doc){var styleEl=doc.getElementById("react-draggable-style-el");styleEl||((styleEl=doc.createElement("style")).type="text/css",styleEl.id="react-draggable-style-el",styleEl.innerHTML=".react-draggable-transparent-selection *::-moz-selection {all: inherit;}\n",styleEl.innerHTML+=".react-draggable-transparent-selection *::selection {all: inherit;}\n",doc.getElementsByTagName("head")[0].appendChild(styleEl)),doc.body&&addClassName(doc.body,"react-draggable-transparent-selection")}}function removeUserSelectStyles(doc){try{doc&&doc.body&&removeClassName(doc.body,"react-draggable-transparent-selection"),doc.selection?doc.selection.empty():window.getSelection().removeAllRanges()}catch(e){}}function styleHacks(){var childStyle=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _extends({touchAction:"none"},childStyle)}function addClassName(el,className){el.classList?el.classList.add(className):el.className.match(new RegExp("(?:^|\\s)"+className+"(?!\\S)"))||(el.className+=" "+className)}function removeClassName(el,className){el.classList?el.classList.remove(className):el.className=el.className.replace(new RegExp("(?:^|\\s)"+className+"(?!\\S)","g"),"")}function getBoundPosition(draggable,x,y){if(!draggable.props.bounds)return[x,y];var bounds=draggable.props.bounds;bounds="string"==typeof bounds?bounds:cloneBounds(bounds);var node=findDOMNode(draggable);if("string"==typeof bounds){var ownerDocument=node.ownerDocument,ownerWindow=ownerDocument.defaultView,boundNode=void 0;if(!((boundNode="parent"===bounds?node.parentNode:ownerDocument.querySelector(bounds))instanceof ownerWindow.HTMLElement))throw new Error('Bounds selector "'+bounds+'" could not find an element.');var nodeStyle=ownerWindow.getComputedStyle(node),boundNodeStyle=ownerWindow.getComputedStyle(boundNode);bounds={left:-node.offsetLeft+int(boundNodeStyle.paddingLeft)+int(nodeStyle.marginLeft),top:-node.offsetTop+int(boundNodeStyle.paddingTop)+int(nodeStyle.marginTop),right:innerWidth(boundNode)-outerWidth(node)-node.offsetLeft+int(boundNodeStyle.paddingRight)-int(nodeStyle.marginRight),bottom:innerHeight(boundNode)-outerHeight(node)-node.offsetTop+int(boundNodeStyle.paddingBottom)-int(nodeStyle.marginBottom)}}return isNum(bounds.right)&&(x=Math.min(x,bounds.right)),isNum(bounds.bottom)&&(y=Math.min(y,bounds.bottom)),isNum(bounds.left)&&(x=Math.max(x,bounds.left)),isNum(bounds.top)&&(y=Math.max(y,bounds.top)),[x,y]}function snapToGrid(grid,pendingX,pendingY){var x,y;return[Math.round(pendingX/grid[0])*grid[0],Math.round(pendingY/grid[1])*grid[1]]}function canDragX(draggable){return"both"===draggable.props.axis||"x"===draggable.props.axis}function canDragY(draggable){return"both"===draggable.props.axis||"y"===draggable.props.axis}function getControlPosition(e,touchIdentifier,draggableCore){var touchObj="number"==typeof touchIdentifier?getTouch(e,touchIdentifier):null;if("number"==typeof touchIdentifier&&!touchObj)return null;var node=findDOMNode(draggableCore),offsetParent;return offsetXYFromParent(touchObj||e,draggableCore.props.offsetParent||node.offsetParent||node.ownerDocument.body)}function createCoreData(draggable,x,y){var state=draggable.state,isStart=!isNum(state.lastX),node=findDOMNode(draggable);return isStart?{node:node,deltaX:0,deltaY:0,lastX:x,lastY:y,x:x,y:y}:{node:node,deltaX:x-state.lastX,deltaY:y-state.lastY,lastX:state.lastX,lastY:state.lastY,x:x,y:y}}function createDraggableData(draggable,coreData){var scale=draggable.props.scale;return{node:coreData.node,x:draggable.state.x+coreData.deltaX/scale,y:draggable.state.y+coreData.deltaY/scale,deltaX:coreData.deltaX/scale,deltaY:coreData.deltaY/scale,lastX:draggable.state.x,lastY:draggable.state.y}}function cloneBounds(bounds){return{left:bounds.left,top:bounds.top,right:bounds.right,bottom:bounds.bottom}}function findDOMNode(draggable){var node=ReactDOM.findDOMNode(draggable);if(!node)throw new Error("<DraggableCore>: Unmounted during event!");return node}function log(){}var eventsFor_touch={start:"touchstart",move:"touchmove",stop:"touchend"},eventsFor_mouse={start:"mousedown",move:"mousemove",stop:"mouseup"},dragEventFor=eventsFor_mouse,DraggableCore=function(_React$Component){function DraggableCore(){var _ref,_temp,_this,_ret;classCallCheck(this,DraggableCore);for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];return _temp=_this=possibleConstructorReturn(this,(_ref=DraggableCore.__proto__||Object.getPrototypeOf(DraggableCore)).call.apply(_ref,[this].concat(args))),_this.state={dragging:!1,lastX:NaN,lastY:NaN,touchIdentifier:null},_this.handleDragStart=function(e){if(_this.props.onMouseDown(e),!_this.props.allowAnyClick&&"number"==typeof e.button&&0!==e.button)return!1;var thisNode=ReactDOM.findDOMNode(_this);if(!thisNode||!thisNode.ownerDocument||!thisNode.ownerDocument.body)throw new Error("<DraggableCore> not mounted on DragStart!");var ownerDocument=thisNode.ownerDocument;if(!(_this.props.disabled||!(e.target instanceof ownerDocument.defaultView.Node)||_this.props.handle&&!matchesSelectorAndParentsTo(e.target,_this.props.handle,thisNode)||_this.props.cancel&&matchesSelectorAndParentsTo(e.target,_this.props.cancel,thisNode))){var touchIdentifier=getTouchIdentifier(e);_this.setState({touchIdentifier:touchIdentifier});var position=getControlPosition(e,touchIdentifier,_this);if(null!=position){var x=position.x,y=position.y,coreEvent=createCoreData(_this,x,y),shouldUpdate;_this.props.onStart,!1!==_this.props.onStart(e,coreEvent)&&(_this.props.enableUserSelectHack&&addUserSelectStyles(ownerDocument),_this.setState({dragging:!0,lastX:x,lastY:y}),addEvent(ownerDocument,dragEventFor.move,_this.handleDrag),addEvent(ownerDocument,dragEventFor.stop,_this.handleDragStop))}}},_this.handleDrag=function(e){"touchmove"===e.type&&e.preventDefault();var position=getControlPosition(e,_this.state.touchIdentifier,_this);if(null!=position){var x=position.x,y=position.y;if(Array.isArray(_this.props.grid)){var _deltaX=x-_this.state.lastX,_deltaY=y-_this.state.lastY,_snapToGrid=snapToGrid(_this.props.grid,_deltaX,_deltaY),_snapToGrid2=slicedToArray(_snapToGrid,2);if(_deltaX=_snapToGrid2[0],_deltaY=_snapToGrid2[1],!_deltaX&&!_deltaY)return;x=_this.state.lastX+_deltaX,y=_this.state.lastY+_deltaY}var coreEvent=createCoreData(_this,x,y),shouldUpdate;if(!1!==_this.props.onDrag(e,coreEvent))_this.setState({lastX:x,lastY:y});else try{_this.handleDragStop(new MouseEvent("mouseup"))}catch(err){var event=document.createEvent("MouseEvents");event.initMouseEvent("mouseup",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),_this.handleDragStop(event)}}},_this.handleDragStop=function(e){if(_this.state.dragging){var position=getControlPosition(e,_this.state.touchIdentifier,_this);if(null!=position){var x=position.x,y=position.y,coreEvent=createCoreData(_this,x,y),thisNode=ReactDOM.findDOMNode(_this);thisNode&&_this.props.enableUserSelectHack&&removeUserSelectStyles(thisNode.ownerDocument),_this.setState({dragging:!1,lastX:NaN,lastY:NaN}),_this.props.onStop(e,coreEvent),thisNode&&(removeEvent(thisNode.ownerDocument,dragEventFor.move,_this.handleDrag),removeEvent(thisNode.ownerDocument,dragEventFor.stop,_this.handleDragStop))}}},_this.onMouseDown=function(e){return dragEventFor=eventsFor_mouse,_this.handleDragStart(e)},_this.onMouseUp=function(e){return dragEventFor=eventsFor_mouse,_this.handleDragStop(e)},_this.onTouchStart=function(e){return dragEventFor=eventsFor_touch,_this.handleDragStart(e)},_this.onTouchEnd=function(e){return dragEventFor=eventsFor_touch,_this.handleDragStop(e)},possibleConstructorReturn(_this,_ret=_temp)}return inherits(DraggableCore,_React$Component),createClass(DraggableCore,[{key:"componentWillUnmount",value:function componentWillUnmount(){var thisNode=ReactDOM.findDOMNode(this);if(thisNode){var ownerDocument=thisNode.ownerDocument;removeEvent(ownerDocument,eventsFor_mouse.move,this.handleDrag),removeEvent(ownerDocument,eventsFor_touch.move,this.handleDrag),removeEvent(ownerDocument,eventsFor_mouse.stop,this.handleDragStop),removeEvent(ownerDocument,eventsFor_touch.stop,this.handleDragStop),this.props.enableUserSelectHack&&removeUserSelectStyles(ownerDocument)}}},{key:"render",value:function render(){return React.cloneElement(React.Children.only(this.props.children),{style:styleHacks(this.props.children.props.style),onMouseDown:this.onMouseDown,onTouchStart:this.onTouchStart,onMouseUp:this.onMouseUp,onTouchEnd:this.onTouchEnd})}}]),DraggableCore}(React.Component);DraggableCore.displayName="DraggableCore",DraggableCore.propTypes={allowAnyClick:propTypes.bool,disabled:propTypes.bool,enableUserSelectHack:propTypes.bool,offsetParent:function offsetParent(props,propName){if(props[propName]&&1!==props[propName].nodeType)throw new Error("Draggable's offsetParent must be a DOM Node.")},grid:propTypes.arrayOf(propTypes.number),scale:propTypes.number,handle:propTypes.string,cancel:propTypes.string,onStart:propTypes.func,onDrag:propTypes.func,onStop:propTypes.func,onMouseDown:propTypes.func,className:dontSetMe,style:dontSetMe,transform:dontSetMe},DraggableCore.defaultProps={allowAnyClick:!1,cancel:null,disabled:!1,enableUserSelectHack:!0,offsetParent:null,handle:null,grid:null,transform:null,onStart:function onStart(){},onDrag:function onDrag(){},onStop:function onStop(){},onMouseDown:function onMouseDown(){}};var Draggable=function(_React$Component){function Draggable(props){classCallCheck(this,Draggable);var _this=possibleConstructorReturn(this,(Draggable.__proto__||Object.getPrototypeOf(Draggable)).call(this,props));return _this.onDragStart=function(e,coreData){var shouldStart;if(!1===_this.props.onStart(e,createDraggableData(_this,coreData)))return!1;_this.setState({dragging:!0,dragged:!0})},_this.onDrag=function(e,coreData){if(!_this.state.dragging)return!1;var uiData=createDraggableData(_this,coreData),newState={x:uiData.x,y:uiData.y},shouldUpdate;if(_this.props.bounds){var _x=newState.x,_y=newState.y;newState.x+=_this.state.slackX,newState.y+=_this.state.slackY;var _getBoundPosition=getBoundPosition(_this,newState.x,newState.y),_getBoundPosition2=slicedToArray(_getBoundPosition,2),newStateX=_getBoundPosition2[0],newStateY=_getBoundPosition2[1];newState.x=newStateX,newState.y=newStateY,newState.slackX=_this.state.slackX+(_x-newState.x),newState.slackY=_this.state.slackY+(_y-newState.y),uiData.x=newState.x,uiData.y=newState.y,uiData.deltaX=newState.x-_this.state.x,uiData.deltaY=newState.y-_this.state.y}if(!1===_this.props.onDrag(e,uiData))return!1;_this.setState(newState)},_this.onDragStop=function(e,coreData){if(!_this.state.dragging)return!1;var shouldStop;if(!1===_this.props.onStop(e,createDraggableData(_this,coreData)))return!1;var newState={dragging:!1,slackX:0,slackY:0},controlled;if(Boolean(_this.props.position)){var _this$props$position=_this.props.position,_x2=_this$props$position.x,_y2=_this$props$position.y;newState.x=_x2,newState.y=_y2}_this.setState(newState)},_this.state={dragging:!1,dragged:!1,x:props.position?props.position.x:props.defaultPosition.x,y:props.position?props.position.y:props.defaultPosition.y,slackX:0,slackY:0,isElementSVG:!1},!props.position||props.onDrag||props.onStop||console.warn("A `position` was applied to this <Draggable>, without drag handlers. This will make this component effectively undraggable. Please attach `onDrag` or `onStop` handlers so you can adjust the `position` of this element."),_this}return inherits(Draggable,_React$Component),createClass(Draggable,[{key:"componentDidMount",value:function componentDidMount(){void 0!==window.SVGElement&&ReactDOM.findDOMNode(this)instanceof window.SVGElement&&this.setState({isElementSVG:!0})}},{key:"componentWillReceiveProps",value:function componentWillReceiveProps(nextProps){!nextProps.position||this.props.position&&nextProps.position.x===this.props.position.x&&nextProps.position.y===this.props.position.y||this.setState({x:nextProps.position.x,y:nextProps.position.y})}},{key:"componentWillUnmount",value:function componentWillUnmount(){this.setState({dragging:!1})}},{key:"render",value:function render(){var _classNames,style={},svgTransform=null,controlled,draggable=!Boolean(this.props.position)||this.state.dragging,position=this.props.position||this.props.defaultPosition,transformOpts={x:canDragX(this)&&draggable?this.state.x:position.x,y:canDragY(this)&&draggable?this.state.y:position.y};this.state.isElementSVG?svgTransform=createSVGTransform(transformOpts,this.props.positionOffset):style=createCSSTransform(transformOpts,this.props.positionOffset);var _props=this.props,defaultClassName=_props.defaultClassName,defaultClassNameDragging=_props.defaultClassNameDragging,defaultClassNameDragged=_props.defaultClassNameDragged,children=React.Children.only(this.props.children),className=classnames(children.props.className||"",defaultClassName,(defineProperty(_classNames={},defaultClassNameDragging,this.state.dragging),defineProperty(_classNames,defaultClassNameDragged,this.state.dragged),_classNames));return React.createElement(DraggableCore,_extends({},this.props,{onStart:this.onDragStart,onDrag:this.onDrag,onStop:this.onDragStop}),React.cloneElement(children,{className:className,style:_extends({},children.props.style,style),transform:svgTransform}))}}]),Draggable}(React.Component);return Draggable.displayName="Draggable",Draggable.propTypes=_extends({},DraggableCore.propTypes,{axis:propTypes.oneOf(["both","x","y","none"]),bounds:propTypes.oneOfType([propTypes.shape({left:propTypes.number,right:propTypes.number,top:propTypes.number,bottom:propTypes.number}),propTypes.string,propTypes.oneOf([!1])]),defaultClassName:propTypes.string,defaultClassNameDragging:propTypes.string,defaultClassNameDragged:propTypes.string,defaultPosition:propTypes.shape({x:propTypes.number,y:propTypes.number}),positionOffset:propTypes.shape({x:propTypes.oneOfType([propTypes.number,propTypes.string]),y:propTypes.oneOfType([propTypes.number,propTypes.string])}),position:propTypes.shape({x:propTypes.number,y:propTypes.number}),className:dontSetMe,style:dontSetMe,transform:dontSetMe}),Draggable.defaultProps=_extends({},DraggableCore.defaultProps,{axis:"both",bounds:!1,defaultClassName:"react-draggable",defaultClassNameDragging:"react-draggable-dragging",defaultClassNameDragged:"react-draggable-dragged",defaultPosition:{x:0,y:0},position:null,scale:1}),Draggable.default=Draggable,Draggable.DraggableCore=DraggableCore,Draggable}))},{react:483,"react-dom":440}],442:[function(require,module,exports){(function(process){(function(){
/** @license React v16.13.1
 * react-is.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
"use strict";"production"!==process.env.NODE_ENV&&function(){var hasSymbol="function"==typeof Symbol&&Symbol.for,REACT_ELEMENT_TYPE=hasSymbol?Symbol.for("react.element"):60103,REACT_PORTAL_TYPE=hasSymbol?Symbol.for("react.portal"):60106,REACT_FRAGMENT_TYPE=hasSymbol?Symbol.for("react.fragment"):60107,REACT_STRICT_MODE_TYPE=hasSymbol?Symbol.for("react.strict_mode"):60108,REACT_PROFILER_TYPE=hasSymbol?Symbol.for("react.profiler"):60114,REACT_PROVIDER_TYPE=hasSymbol?Symbol.for("react.provider"):60109,REACT_CONTEXT_TYPE=hasSymbol?Symbol.for("react.context"):60110,REACT_ASYNC_MODE_TYPE=hasSymbol?Symbol.for("react.async_mode"):60111,REACT_CONCURRENT_MODE_TYPE=hasSymbol?Symbol.for("react.concurrent_mode"):60111,REACT_FORWARD_REF_TYPE=hasSymbol?Symbol.for("react.forward_ref"):60112,REACT_SUSPENSE_TYPE=hasSymbol?Symbol.for("react.suspense"):60113,REACT_SUSPENSE_LIST_TYPE=hasSymbol?Symbol.for("react.suspense_list"):60120,REACT_MEMO_TYPE=hasSymbol?Symbol.for("react.memo"):60115,REACT_LAZY_TYPE=hasSymbol?Symbol.for("react.lazy"):60116,REACT_BLOCK_TYPE=hasSymbol?Symbol.for("react.block"):60121,REACT_FUNDAMENTAL_TYPE=hasSymbol?Symbol.for("react.fundamental"):60117,REACT_RESPONDER_TYPE=hasSymbol?Symbol.for("react.responder"):60118,REACT_SCOPE_TYPE=hasSymbol?Symbol.for("react.scope"):60119;function isValidElementType(type){return"string"==typeof type||"function"==typeof type||type===REACT_FRAGMENT_TYPE||type===REACT_CONCURRENT_MODE_TYPE||type===REACT_PROFILER_TYPE||type===REACT_STRICT_MODE_TYPE||type===REACT_SUSPENSE_TYPE||type===REACT_SUSPENSE_LIST_TYPE||"object"==typeof type&&null!==type&&(type.$$typeof===REACT_LAZY_TYPE||type.$$typeof===REACT_MEMO_TYPE||type.$$typeof===REACT_PROVIDER_TYPE||type.$$typeof===REACT_CONTEXT_TYPE||type.$$typeof===REACT_FORWARD_REF_TYPE||type.$$typeof===REACT_FUNDAMENTAL_TYPE||type.$$typeof===REACT_RESPONDER_TYPE||type.$$typeof===REACT_SCOPE_TYPE||type.$$typeof===REACT_BLOCK_TYPE)}function typeOf(object){if("object"==typeof object&&null!==object){var $$typeof=object.$$typeof;switch($$typeof){case REACT_ELEMENT_TYPE:var type=object.type;switch(type){case REACT_ASYNC_MODE_TYPE:case REACT_CONCURRENT_MODE_TYPE:case REACT_FRAGMENT_TYPE:case REACT_PROFILER_TYPE:case REACT_STRICT_MODE_TYPE:case REACT_SUSPENSE_TYPE:return type;default:var $$typeofType=type&&type.$$typeof;switch($$typeofType){case REACT_CONTEXT_TYPE:case REACT_FORWARD_REF_TYPE:case REACT_LAZY_TYPE:case REACT_MEMO_TYPE:case REACT_PROVIDER_TYPE:return $$typeofType;default:return $$typeof}}case REACT_PORTAL_TYPE:return $$typeof}}}var AsyncMode=REACT_ASYNC_MODE_TYPE,ConcurrentMode=REACT_CONCURRENT_MODE_TYPE,ContextConsumer=REACT_CONTEXT_TYPE,ContextProvider=REACT_PROVIDER_TYPE,Element=REACT_ELEMENT_TYPE,ForwardRef=REACT_FORWARD_REF_TYPE,Fragment=REACT_FRAGMENT_TYPE,Lazy=REACT_LAZY_TYPE,Memo=REACT_MEMO_TYPE,Portal=REACT_PORTAL_TYPE,Profiler=REACT_PROFILER_TYPE,StrictMode=REACT_STRICT_MODE_TYPE,Suspense=REACT_SUSPENSE_TYPE,hasWarnedAboutDeprecatedIsAsyncMode=!1;function isAsyncMode(object){return hasWarnedAboutDeprecatedIsAsyncMode||(hasWarnedAboutDeprecatedIsAsyncMode=!0,console.warn("The ReactIs.isAsyncMode() alias has been deprecated, and will be removed in React 17+. Update your code to use ReactIs.isConcurrentMode() instead. It has the exact same API.")),isConcurrentMode(object)||typeOf(object)===REACT_ASYNC_MODE_TYPE}function isConcurrentMode(object){return typeOf(object)===REACT_CONCURRENT_MODE_TYPE}function isContextConsumer(object){return typeOf(object)===REACT_CONTEXT_TYPE}function isContextProvider(object){return typeOf(object)===REACT_PROVIDER_TYPE}function isElement(object){return"object"==typeof object&&null!==object&&object.$$typeof===REACT_ELEMENT_TYPE}function isForwardRef(object){return typeOf(object)===REACT_FORWARD_REF_TYPE}function isFragment(object){return typeOf(object)===REACT_FRAGMENT_TYPE}function isLazy(object){return typeOf(object)===REACT_LAZY_TYPE}function isMemo(object){return typeOf(object)===REACT_MEMO_TYPE}function isPortal(object){return typeOf(object)===REACT_PORTAL_TYPE}function isProfiler(object){return typeOf(object)===REACT_PROFILER_TYPE}function isStrictMode(object){return typeOf(object)===REACT_STRICT_MODE_TYPE}function isSuspense(object){return typeOf(object)===REACT_SUSPENSE_TYPE}exports.AsyncMode=AsyncMode,exports.ConcurrentMode=ConcurrentMode,exports.ContextConsumer=ContextConsumer,exports.ContextProvider=ContextProvider,exports.Element=Element,exports.ForwardRef=ForwardRef,exports.Fragment=Fragment,exports.Lazy=Lazy,exports.Memo=Memo,exports.Portal=Portal,exports.Profiler=Profiler,exports.StrictMode=StrictMode,exports.Suspense=Suspense,exports.isAsyncMode=isAsyncMode,exports.isConcurrentMode=isConcurrentMode,exports.isContextConsumer=isContextConsumer,exports.isContextProvider=isContextProvider,exports.isElement=isElement,exports.isForwardRef=isForwardRef,exports.isFragment=isFragment,exports.isLazy=isLazy,exports.isMemo=isMemo,exports.isPortal=isPortal,exports.isProfiler=isProfiler,exports.isStrictMode=isStrictMode,exports.isSuspense=isSuspense,exports.isValidElementType=isValidElementType,exports.typeOf=typeOf}()}).call(this)}).call(this,require("_process"))},{_process:422}],443:[function(require,module,exports){
/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
"use strict";var b="function"==typeof Symbol&&Symbol.for,c=b?Symbol.for("react.element"):60103,d=b?Symbol.for("react.portal"):60106,e=b?Symbol.for("react.fragment"):60107,f=b?Symbol.for("react.strict_mode"):60108,g=b?Symbol.for("react.profiler"):60114,h=b?Symbol.for("react.provider"):60109,k=b?Symbol.for("react.context"):60110,l=b?Symbol.for("react.async_mode"):60111,m=b?Symbol.for("react.concurrent_mode"):60111,n=b?Symbol.for("react.forward_ref"):60112,p=b?Symbol.for("react.suspense"):60113,q=b?Symbol.for("react.suspense_list"):60120,r=b?Symbol.for("react.memo"):60115,t=b?Symbol.for("react.lazy"):60116,v=b?Symbol.for("react.block"):60121,w=b?Symbol.for("react.fundamental"):60117,x=b?Symbol.for("react.responder"):60118,y=b?Symbol.for("react.scope"):60119;function z(a){if("object"==typeof a&&null!==a){var u=a.$$typeof;switch(u){case c:switch(a=a.type){case l:case m:case e:case g:case f:case p:return a;default:switch(a=a&&a.$$typeof){case k:case n:case t:case r:case h:return a;default:return u}}case d:return u}}}function A(a){return z(a)===m}exports.AsyncMode=l,exports.ConcurrentMode=m,exports.ContextConsumer=k,exports.ContextProvider=h,exports.Element=c,exports.ForwardRef=n,exports.Fragment=e,exports.Lazy=t,exports.Memo=r,exports.Portal=d,exports.Profiler=g,exports.StrictMode=f,exports.Suspense=p,exports.isAsyncMode=function(a){return A(a)||z(a)===l},exports.isConcurrentMode=A,exports.isContextConsumer=function(a){return z(a)===k},exports.isContextProvider=function(a){return z(a)===h},exports.isElement=function(a){return"object"==typeof a&&null!==a&&a.$$typeof===c},exports.isForwardRef=function(a){return z(a)===n},exports.isFragment=function(a){return z(a)===e},exports.isLazy=function(a){return z(a)===t},exports.isMemo=function(a){return z(a)===r},exports.isPortal=function(a){return z(a)===d},exports.isProfiler=function(a){return z(a)===g},exports.isStrictMode=function(a){return z(a)===f},exports.isSuspense=function(a){return z(a)===p},exports.isValidElementType=function(a){return"string"==typeof a||"function"==typeof a||a===e||a===m||a===g||a===f||a===p||a===q||"object"==typeof a&&null!==a&&(a.$$typeof===t||a.$$typeof===r||a.$$typeof===h||a.$$typeof===k||a.$$typeof===n||a.$$typeof===w||a.$$typeof===x||a.$$typeof===y||a.$$typeof===v)},exports.typeOf=z},{}],444:[function(require,module,exports){(function(process){(function(){"use strict";"production"===process.env.NODE_ENV?module.exports=require("./cjs/react-is.production.min.js"):module.exports=require("./cjs/react-is.development.js")}).call(this)}).call(this,require("_process"))},{"./cjs/react-is.development.js":442,"./cjs/react-is.production.min.js":443,_process:422}],445:[function(require,module,exports){"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");exports.__esModule=!0,exports.default=exports.ReactReduxContext=void 0;var _react,ReactReduxContext=_interopRequireDefault(require("react")).default.createContext(null);exports.ReactReduxContext=ReactReduxContext,ReactReduxContext.displayName="ReactRedux";var _default=ReactReduxContext;exports.default=_default},{"@babel/runtime/helpers/interopRequireDefault":45,react:483}],446:[function(require,module,exports){"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard");exports.__esModule=!0,exports.default=void 0;var _react=_interopRequireWildcard(require("react")),_propTypes=_interopRequireDefault(require("prop-types")),_Context=require("./Context"),_Subscription=_interopRequireDefault(require("../utils/Subscription")),_useIsomorphicLayoutEffect=require("../utils/useIsomorphicLayoutEffect");function Provider(_ref){var store=_ref.store,context=_ref.context,children=_ref.children,contextValue=(0,_react.useMemo)((function(){var subscription=new _Subscription.default(store);return subscription.onStateChange=subscription.notifyNestedSubs,{store:store,subscription:subscription}}),[store]),previousState=(0,_react.useMemo)((function(){return store.getState()}),[store]);(0,_useIsomorphicLayoutEffect.useIsomorphicLayoutEffect)((function(){var subscription=contextValue.subscription;return subscription.trySubscribe(),previousState!==store.getState()&&subscription.notifyNestedSubs(),function(){subscription.tryUnsubscribe(),subscription.onStateChange=null}}),[contextValue,previousState]);var Context=context||_Context.ReactReduxContext;return(_react.default.createElement(Context.Provider,{value:contextValue},children))}Provider.propTypes={store:_propTypes.default.shape({subscribe:_propTypes.default.func.isRequired,dispatch:_propTypes.default.func.isRequired,getState:_propTypes.default.func.isRequired}),context:_propTypes.default.object,children:_propTypes.default.any};var _default=Provider;exports.default=_default},{"../utils/Subscription":460,"../utils/useIsomorphicLayoutEffect":466,"./Context":445,"@babel/runtime/helpers/interopRequireDefault":45,"@babel/runtime/helpers/interopRequireWildcard":46,"prop-types":426,react:483}],447:[function(require,module,exports){"use strict";var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard"),_interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");exports.__esModule=!0,exports.default=connectAdvanced;var _extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends")),_objectWithoutPropertiesLoose2=_interopRequireDefault(require("@babel/runtime/helpers/objectWithoutPropertiesLoose")),_hoistNonReactStatics=_interopRequireDefault(require("hoist-non-react-statics")),_react=_interopRequireWildcard(require("react")),_reactIs=require("react-is"),_Subscription=_interopRequireDefault(require("../utils/Subscription")),_useIsomorphicLayoutEffect=require("../utils/useIsomorphicLayoutEffect"),_Context=require("./Context"),EMPTY_ARRAY=[],NO_SUBSCRIPTION_ARRAY=[null,null],stringifyComponent=function stringifyComponent(Comp){try{return JSON.stringify(Comp)}catch(err){return String(Comp)}};function storeStateUpdatesReducer(state,action){var updateCount=state[1];return[action.payload,updateCount+1]}function useIsomorphicLayoutEffectWithArgs(effectFunc,effectArgs,dependencies){(0,_useIsomorphicLayoutEffect.useIsomorphicLayoutEffect)((function(){return effectFunc.apply(void 0,effectArgs)}),dependencies)}function captureWrapperProps(lastWrapperProps,lastChildProps,renderIsScheduled,wrapperProps,actualChildProps,childPropsFromStoreUpdate,notifyNestedSubs){lastWrapperProps.current=wrapperProps,lastChildProps.current=actualChildProps,renderIsScheduled.current=!1,childPropsFromStoreUpdate.current&&(childPropsFromStoreUpdate.current=null,notifyNestedSubs())}function subscribeUpdates(shouldHandleStateChanges,store,subscription,childPropsSelector,lastWrapperProps,lastChildProps,renderIsScheduled,childPropsFromStoreUpdate,notifyNestedSubs,forceComponentUpdateDispatch){if(shouldHandleStateChanges){var didUnsubscribe=!1,lastThrownError=null,checkForUpdates=function checkForUpdates(){if(!didUnsubscribe){var latestStoreState=store.getState(),newChildProps,error;try{newChildProps=childPropsSelector(latestStoreState,lastWrapperProps.current)}catch(e){error=e,lastThrownError=e}error||(lastThrownError=null),newChildProps===lastChildProps.current?renderIsScheduled.current||notifyNestedSubs():(lastChildProps.current=newChildProps,childPropsFromStoreUpdate.current=newChildProps,renderIsScheduled.current=!0,forceComponentUpdateDispatch({type:"STORE_UPDATED",payload:{error:error}}))}},unsubscribeWrapper;return subscription.onStateChange=checkForUpdates,subscription.trySubscribe(),checkForUpdates(),function unsubscribeWrapper(){if(didUnsubscribe=!0,subscription.tryUnsubscribe(),subscription.onStateChange=null,lastThrownError)throw lastThrownError}}}var initStateUpdates=function initStateUpdates(){return[null,0]};function connectAdvanced(selectorFactory,_ref){void 0===_ref&&(_ref={});var _ref2=_ref,_ref2$getDisplayName=_ref2.getDisplayName,getDisplayName=void 0===_ref2$getDisplayName?function(name){return"ConnectAdvanced("+name+")"}:_ref2$getDisplayName,_ref2$methodName=_ref2.methodName,methodName=void 0===_ref2$methodName?"connectAdvanced":_ref2$methodName,_ref2$renderCountProp=_ref2.renderCountProp,renderCountProp=void 0===_ref2$renderCountProp?void 0:_ref2$renderCountProp,_ref2$shouldHandleSta=_ref2.shouldHandleStateChanges,shouldHandleStateChanges=void 0===_ref2$shouldHandleSta||_ref2$shouldHandleSta,_ref2$storeKey=_ref2.storeKey,storeKey=void 0===_ref2$storeKey?"store":_ref2$storeKey,_ref2$withRef=_ref2.withRef,withRef=void 0!==_ref2$withRef&&_ref2$withRef,_ref2$forwardRef=_ref2.forwardRef,forwardRef=void 0!==_ref2$forwardRef&&_ref2$forwardRef,_ref2$context=_ref2.context,context=void 0===_ref2$context?_Context.ReactReduxContext:_ref2$context,connectOptions=(0,_objectWithoutPropertiesLoose2.default)(_ref2,["getDisplayName","methodName","renderCountProp","shouldHandleStateChanges","storeKey","withRef","forwardRef","context"]),customStoreWarningMessage;if(void 0!==renderCountProp)throw new Error("renderCountProp is removed. render counting is built into the latest React Dev Tools profiling extension");if(withRef)throw new Error("withRef is removed. To access the wrapped instance, use a ref on the connected component");if("store"!==storeKey)throw new Error("storeKey has been removed and does not do anything. "+"To use a custom Redux store for specific components, create a custom React context with React.createContext(), and pass the context object to React Redux's Provider and specific components like: <Provider context={MyContext}><ConnectedComponent context={MyContext} /></Provider>. You may also pass a {context : MyContext} option to connect");var Context=context;return function wrapWithConnect(WrappedComponent){if(!(0,_reactIs.isValidElementType)(WrappedComponent))throw new Error("You must pass a component to the function returned by "+methodName+". Instead received "+stringifyComponent(WrappedComponent));var wrappedComponentName=WrappedComponent.displayName||WrappedComponent.name||"Component",displayName=getDisplayName(wrappedComponentName),selectorFactoryOptions=(0,_extends2.default)({},connectOptions,{getDisplayName:getDisplayName,methodName:methodName,renderCountProp:renderCountProp,shouldHandleStateChanges:shouldHandleStateChanges,storeKey:storeKey,displayName:displayName,wrappedComponentName:wrappedComponentName,WrappedComponent:WrappedComponent}),pure=connectOptions.pure;function createChildSelector(store){return selectorFactory(store.dispatch,selectorFactoryOptions)}var usePureOnlyMemo=pure?_react.useMemo:function(callback){return callback()};function ConnectFunction(props){var _useMemo=(0,_react.useMemo)((function(){var reactReduxForwardedRef=props.reactReduxForwardedRef,wrapperProps=(0,_objectWithoutPropertiesLoose2.default)(props,["reactReduxForwardedRef"]);return[props.context,reactReduxForwardedRef,wrapperProps]}),[props]),propsContext=_useMemo[0],reactReduxForwardedRef=_useMemo[1],wrapperProps=_useMemo[2],ContextToUse=(0,_react.useMemo)((function(){return propsContext&&propsContext.Consumer&&(0,_reactIs.isContextConsumer)(_react.default.createElement(propsContext.Consumer,null))?propsContext:Context}),[propsContext,Context]),contextValue=(0,_react.useContext)(ContextToUse),didStoreComeFromProps=Boolean(props.store)&&Boolean(props.store.getState)&&Boolean(props.store.dispatch),didStoreComeFromContext=Boolean(contextValue)&&Boolean(contextValue.store);if(!didStoreComeFromProps&&!didStoreComeFromContext)throw new Error('Could not find "store" in the context of "'+displayName+'". Either wrap the root component in a <Provider>, or pass a custom React context provider to <Provider> and the corresponding React context consumer to '+displayName+" in connect options.");var store=didStoreComeFromProps?props.store:contextValue.store,childPropsSelector=(0,_react.useMemo)((function(){return createChildSelector(store)}),[store]),_useMemo2=(0,_react.useMemo)((function(){if(!shouldHandleStateChanges)return NO_SUBSCRIPTION_ARRAY;var subscription=new _Subscription.default(store,didStoreComeFromProps?null:contextValue.subscription),notifyNestedSubs=subscription.notifyNestedSubs.bind(subscription);return[subscription,notifyNestedSubs]}),[store,didStoreComeFromProps,contextValue]),subscription=_useMemo2[0],notifyNestedSubs=_useMemo2[1],overriddenContextValue=(0,_react.useMemo)((function(){return didStoreComeFromProps?contextValue:(0,_extends2.default)({},contextValue,{subscription:subscription})}),[didStoreComeFromProps,contextValue,subscription]),_useReducer=(0,_react.useReducer)(storeStateUpdatesReducer,EMPTY_ARRAY,initStateUpdates),_useReducer$,previousStateUpdateResult=_useReducer[0][0],forceComponentUpdateDispatch=_useReducer[1];if(previousStateUpdateResult&&previousStateUpdateResult.error)throw previousStateUpdateResult.error;var lastChildProps=(0,_react.useRef)(),lastWrapperProps=(0,_react.useRef)(wrapperProps),childPropsFromStoreUpdate=(0,_react.useRef)(),renderIsScheduled=(0,_react.useRef)(!1),actualChildProps=usePureOnlyMemo((function(){return childPropsFromStoreUpdate.current&&wrapperProps===lastWrapperProps.current?childPropsFromStoreUpdate.current:childPropsSelector(store.getState(),wrapperProps)}),[store,previousStateUpdateResult,wrapperProps]);useIsomorphicLayoutEffectWithArgs(captureWrapperProps,[lastWrapperProps,lastChildProps,renderIsScheduled,wrapperProps,actualChildProps,childPropsFromStoreUpdate,notifyNestedSubs]),useIsomorphicLayoutEffectWithArgs(subscribeUpdates,[shouldHandleStateChanges,store,subscription,childPropsSelector,lastWrapperProps,lastChildProps,renderIsScheduled,childPropsFromStoreUpdate,notifyNestedSubs,forceComponentUpdateDispatch],[store,subscription,childPropsSelector]);var renderedWrappedComponent=(0,_react.useMemo)((function(){return _react.default.createElement(WrappedComponent,(0,_extends2.default)({},actualChildProps,{ref:reactReduxForwardedRef}))}),[reactReduxForwardedRef,WrappedComponent,actualChildProps]),renderedChild;return(0,_react.useMemo)((function(){return shouldHandleStateChanges?_react.default.createElement(ContextToUse.Provider,{value:overriddenContextValue},renderedWrappedComponent):renderedWrappedComponent}),[ContextToUse,renderedWrappedComponent,overriddenContextValue])}var Connect=pure?_react.default.memo(ConnectFunction):ConnectFunction;if(Connect.WrappedComponent=WrappedComponent,Connect.displayName=ConnectFunction.displayName=displayName,forwardRef){var forwarded=_react.default.forwardRef((function forwardConnectRef(props,ref){return _react.default.createElement(Connect,(0,_extends2.default)({},props,{reactReduxForwardedRef:ref}))}));return forwarded.displayName=displayName,forwarded.WrappedComponent=WrappedComponent,(0,_hoistNonReactStatics.default)(forwarded,WrappedComponent)}return(0,_hoistNonReactStatics.default)(Connect,WrappedComponent)}}},{"../utils/Subscription":460,"../utils/useIsomorphicLayoutEffect":466,"./Context":445,"@babel/runtime/helpers/extends":42,"@babel/runtime/helpers/interopRequireDefault":45,"@babel/runtime/helpers/interopRequireWildcard":46,"@babel/runtime/helpers/objectWithoutPropertiesLoose":50,"hoist-non-react-statics":383,react:483,"react-is":444}],448:[function(require,module,exports){"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");exports.__esModule=!0,exports.createConnect=createConnect,exports.default=void 0;var _extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends")),_objectWithoutPropertiesLoose2=_interopRequireDefault(require("@babel/runtime/helpers/objectWithoutPropertiesLoose")),_connectAdvanced=_interopRequireDefault(require("../components/connectAdvanced")),_shallowEqual=_interopRequireDefault(require("../utils/shallowEqual")),_mapDispatchToProps=_interopRequireDefault(require("./mapDispatchToProps")),_mapStateToProps=_interopRequireDefault(require("./mapStateToProps")),_mergeProps=_interopRequireDefault(require("./mergeProps")),_selectorFactory=_interopRequireDefault(require("./selectorFactory"));function match(arg,factories,name){for(var i=factories.length-1;i>=0;i--){var result=factories[i](arg);if(result)return result}return function(dispatch,options){throw new Error("Invalid value of type "+typeof arg+" for "+name+" argument when connecting component "+options.wrappedComponentName+".")}}function strictEqual(a,b){return a===b}function createConnect(_temp){var _ref=void 0===_temp?{}:_temp,_ref$connectHOC=_ref.connectHOC,connectHOC=void 0===_ref$connectHOC?_connectAdvanced.default:_ref$connectHOC,_ref$mapStateToPropsF=_ref.mapStateToPropsFactories,mapStateToPropsFactories=void 0===_ref$mapStateToPropsF?_mapStateToProps.default:_ref$mapStateToPropsF,_ref$mapDispatchToPro=_ref.mapDispatchToPropsFactories,mapDispatchToPropsFactories=void 0===_ref$mapDispatchToPro?_mapDispatchToProps.default:_ref$mapDispatchToPro,_ref$mergePropsFactor=_ref.mergePropsFactories,mergePropsFactories=void 0===_ref$mergePropsFactor?_mergeProps.default:_ref$mergePropsFactor,_ref$selectorFactory=_ref.selectorFactory,selectorFactory=void 0===_ref$selectorFactory?_selectorFactory.default:_ref$selectorFactory;return function connect(mapStateToProps,mapDispatchToProps,mergeProps,_ref2){void 0===_ref2&&(_ref2={});var _ref3=_ref2,_ref3$pure=_ref3.pure,pure=void 0===_ref3$pure||_ref3$pure,_ref3$areStatesEqual=_ref3.areStatesEqual,areStatesEqual=void 0===_ref3$areStatesEqual?strictEqual:_ref3$areStatesEqual,_ref3$areOwnPropsEqua=_ref3.areOwnPropsEqual,areOwnPropsEqual=void 0===_ref3$areOwnPropsEqua?_shallowEqual.default:_ref3$areOwnPropsEqua,_ref3$areStatePropsEq=_ref3.areStatePropsEqual,areStatePropsEqual=void 0===_ref3$areStatePropsEq?_shallowEqual.default:_ref3$areStatePropsEq,_ref3$areMergedPropsE=_ref3.areMergedPropsEqual,areMergedPropsEqual=void 0===_ref3$areMergedPropsE?_shallowEqual.default:_ref3$areMergedPropsE,extraOptions=(0,_objectWithoutPropertiesLoose2.default)(_ref3,["pure","areStatesEqual","areOwnPropsEqual","areStatePropsEqual","areMergedPropsEqual"]),initMapStateToProps=match(mapStateToProps,mapStateToPropsFactories,"mapStateToProps"),initMapDispatchToProps=match(mapDispatchToProps,mapDispatchToPropsFactories,"mapDispatchToProps"),initMergeProps=match(mergeProps,mergePropsFactories,"mergeProps");return connectHOC(selectorFactory,(0,_extends2.default)({methodName:"connect",getDisplayName:function getDisplayName(name){return"Connect("+name+")"},shouldHandleStateChanges:Boolean(mapStateToProps),initMapStateToProps:initMapStateToProps,initMapDispatchToProps:initMapDispatchToProps,initMergeProps:initMergeProps,pure:pure,areStatesEqual:areStatesEqual,areOwnPropsEqual:areOwnPropsEqual,areStatePropsEqual:areStatePropsEqual,areMergedPropsEqual:areMergedPropsEqual},extraOptions))}}var _default=createConnect();exports.default=_default},{"../components/connectAdvanced":447,"../utils/shallowEqual":465,"./mapDispatchToProps":449,"./mapStateToProps":450,"./mergeProps":451,"./selectorFactory":452,"@babel/runtime/helpers/extends":42,"@babel/runtime/helpers/interopRequireDefault":45,"@babel/runtime/helpers/objectWithoutPropertiesLoose":50}],449:[function(require,module,exports){"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");exports.__esModule=!0,exports.whenMapDispatchToPropsIsFunction=whenMapDispatchToPropsIsFunction,exports.whenMapDispatchToPropsIsMissing=whenMapDispatchToPropsIsMissing,exports.whenMapDispatchToPropsIsObject=whenMapDispatchToPropsIsObject,exports.default=void 0;var _bindActionCreators=_interopRequireDefault(require("../utils/bindActionCreators")),_wrapMapToProps=require("./wrapMapToProps");function whenMapDispatchToPropsIsFunction(mapDispatchToProps){return"function"==typeof mapDispatchToProps?(0,_wrapMapToProps.wrapMapToPropsFunc)(mapDispatchToProps,"mapDispatchToProps"):void 0}function whenMapDispatchToPropsIsMissing(mapDispatchToProps){return mapDispatchToProps?void 0:(0,_wrapMapToProps.wrapMapToPropsConstant)((function(dispatch){return{dispatch:dispatch}}))}function whenMapDispatchToPropsIsObject(mapDispatchToProps){return mapDispatchToProps&&"object"==typeof mapDispatchToProps?(0,_wrapMapToProps.wrapMapToPropsConstant)((function(dispatch){return(0,_bindActionCreators.default)(mapDispatchToProps,dispatch)})):void 0}var _default=[whenMapDispatchToPropsIsFunction,whenMapDispatchToPropsIsMissing,whenMapDispatchToPropsIsObject];exports.default=_default},{"../utils/bindActionCreators":462,"./wrapMapToProps":454,"@babel/runtime/helpers/interopRequireDefault":45}],450:[function(require,module,exports){"use strict";exports.__esModule=!0,exports.whenMapStateToPropsIsFunction=whenMapStateToPropsIsFunction,exports.whenMapStateToPropsIsMissing=whenMapStateToPropsIsMissing,exports.default=void 0;var _wrapMapToProps=require("./wrapMapToProps");function whenMapStateToPropsIsFunction(mapStateToProps){return"function"==typeof mapStateToProps?(0,_wrapMapToProps.wrapMapToPropsFunc)(mapStateToProps,"mapStateToProps"):void 0}function whenMapStateToPropsIsMissing(mapStateToProps){return mapStateToProps?void 0:(0,_wrapMapToProps.wrapMapToPropsConstant)((function(){return{}}))}var _default=[whenMapStateToPropsIsFunction,whenMapStateToPropsIsMissing];exports.default=_default},{"./wrapMapToProps":454}],451:[function(require,module,exports){"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");exports.__esModule=!0,exports.defaultMergeProps=defaultMergeProps,exports.wrapMergePropsFunc=wrapMergePropsFunc,exports.whenMergePropsIsFunction=whenMergePropsIsFunction,exports.whenMergePropsIsOmitted=whenMergePropsIsOmitted,exports.default=void 0;var _extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends")),_verifyPlainObject=_interopRequireDefault(require("../utils/verifyPlainObject"));function defaultMergeProps(stateProps,dispatchProps,ownProps){return(0,_extends2.default)({},ownProps,stateProps,dispatchProps)}function wrapMergePropsFunc(mergeProps){return function initMergePropsProxy(dispatch,_ref){var displayName=_ref.displayName,pure=_ref.pure,areMergedPropsEqual=_ref.areMergedPropsEqual,hasRunOnce=!1,mergedProps;return function mergePropsProxy(stateProps,dispatchProps,ownProps){var nextMergedProps=mergeProps(stateProps,dispatchProps,ownProps);return hasRunOnce?pure&&areMergedPropsEqual(nextMergedProps,mergedProps)||(mergedProps=nextMergedProps):(hasRunOnce=!0,mergedProps=nextMergedProps,(0,_verifyPlainObject.default)(mergedProps,displayName,"mergeProps")),mergedProps}}}function whenMergePropsIsFunction(mergeProps){return"function"==typeof mergeProps?wrapMergePropsFunc(mergeProps):void 0}function whenMergePropsIsOmitted(mergeProps){return mergeProps?void 0:function(){return defaultMergeProps}}var _default=[whenMergePropsIsFunction,whenMergePropsIsOmitted];exports.default=_default},{"../utils/verifyPlainObject":467,"@babel/runtime/helpers/extends":42,"@babel/runtime/helpers/interopRequireDefault":45}],452:[function(require,module,exports){"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");exports.__esModule=!0,exports.impureFinalPropsSelectorFactory=impureFinalPropsSelectorFactory,exports.pureFinalPropsSelectorFactory=pureFinalPropsSelectorFactory,exports.default=finalPropsSelectorFactory;var _objectWithoutPropertiesLoose2=_interopRequireDefault(require("@babel/runtime/helpers/objectWithoutPropertiesLoose")),_verifySubselectors=_interopRequireDefault(require("./verifySubselectors"));function impureFinalPropsSelectorFactory(mapStateToProps,mapDispatchToProps,mergeProps,dispatch){return function impureFinalPropsSelector(state,ownProps){return mergeProps(mapStateToProps(state,ownProps),mapDispatchToProps(dispatch,ownProps),ownProps)}}function pureFinalPropsSelectorFactory(mapStateToProps,mapDispatchToProps,mergeProps,dispatch,_ref){var areStatesEqual=_ref.areStatesEqual,areOwnPropsEqual=_ref.areOwnPropsEqual,areStatePropsEqual=_ref.areStatePropsEqual,hasRunAtLeastOnce=!1,state,ownProps,stateProps,dispatchProps,mergedProps;function handleFirstCall(firstState,firstOwnProps){return stateProps=mapStateToProps(state=firstState,ownProps=firstOwnProps),dispatchProps=mapDispatchToProps(dispatch,ownProps),mergedProps=mergeProps(stateProps,dispatchProps,ownProps),hasRunAtLeastOnce=!0,mergedProps}function handleNewPropsAndNewState(){return stateProps=mapStateToProps(state,ownProps),mapDispatchToProps.dependsOnOwnProps&&(dispatchProps=mapDispatchToProps(dispatch,ownProps)),mergedProps=mergeProps(stateProps,dispatchProps,ownProps)}function handleNewProps(){return mapStateToProps.dependsOnOwnProps&&(stateProps=mapStateToProps(state,ownProps)),mapDispatchToProps.dependsOnOwnProps&&(dispatchProps=mapDispatchToProps(dispatch,ownProps)),mergedProps=mergeProps(stateProps,dispatchProps,ownProps)}function handleNewState(){var nextStateProps=mapStateToProps(state,ownProps),statePropsChanged=!areStatePropsEqual(nextStateProps,stateProps);return stateProps=nextStateProps,statePropsChanged&&(mergedProps=mergeProps(stateProps,dispatchProps,ownProps)),mergedProps}function handleSubsequentCalls(nextState,nextOwnProps){var propsChanged=!areOwnPropsEqual(nextOwnProps,ownProps),stateChanged=!areStatesEqual(nextState,state);return state=nextState,ownProps=nextOwnProps,propsChanged&&stateChanged?handleNewPropsAndNewState():propsChanged?handleNewProps():stateChanged?handleNewState():mergedProps}return function pureFinalPropsSelector(nextState,nextOwnProps){return hasRunAtLeastOnce?handleSubsequentCalls(nextState,nextOwnProps):handleFirstCall(nextState,nextOwnProps)}}function finalPropsSelectorFactory(dispatch,_ref2){var initMapStateToProps=_ref2.initMapStateToProps,initMapDispatchToProps=_ref2.initMapDispatchToProps,initMergeProps=_ref2.initMergeProps,options=(0,_objectWithoutPropertiesLoose2.default)(_ref2,["initMapStateToProps","initMapDispatchToProps","initMergeProps"]),mapStateToProps=initMapStateToProps(dispatch,options),mapDispatchToProps=initMapDispatchToProps(dispatch,options),mergeProps=initMergeProps(dispatch,options),selectorFactory;return(0,_verifySubselectors.default)(mapStateToProps,mapDispatchToProps,mergeProps,options.displayName),(options.pure?pureFinalPropsSelectorFactory:impureFinalPropsSelectorFactory)(mapStateToProps,mapDispatchToProps,mergeProps,dispatch,options)}},{"./verifySubselectors":453,"@babel/runtime/helpers/interopRequireDefault":45,"@babel/runtime/helpers/objectWithoutPropertiesLoose":50}],453:[function(require,module,exports){"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");exports.__esModule=!0,exports.default=verifySubselectors;var _warning=_interopRequireDefault(require("../utils/warning"));function verify(selector,methodName,displayName){if(!selector)throw new Error("Unexpected value for "+methodName+" in "+displayName+".");"mapStateToProps"!==methodName&&"mapDispatchToProps"!==methodName||Object.prototype.hasOwnProperty.call(selector,"dependsOnOwnProps")||(0,_warning.default)("The selector for "+methodName+" of "+displayName+" did not specify a value for dependsOnOwnProps.")}function verifySubselectors(mapStateToProps,mapDispatchToProps,mergeProps,displayName){verify(mapStateToProps,"mapStateToProps",displayName),verify(mapDispatchToProps,"mapDispatchToProps",displayName),verify(mergeProps,"mergeProps",displayName)}},{"../utils/warning":468,"@babel/runtime/helpers/interopRequireDefault":45}],454:[function(require,module,exports){"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");exports.__esModule=!0,exports.wrapMapToPropsConstant=wrapMapToPropsConstant,exports.getDependsOnOwnProps=getDependsOnOwnProps,exports.wrapMapToPropsFunc=wrapMapToPropsFunc;var _verifyPlainObject=_interopRequireDefault(require("../utils/verifyPlainObject"));function wrapMapToPropsConstant(getConstant){return function initConstantSelector(dispatch,options){var constant=getConstant(dispatch,options);function constantSelector(){return constant}return constantSelector.dependsOnOwnProps=!1,constantSelector}}function getDependsOnOwnProps(mapToProps){return null!==mapToProps.dependsOnOwnProps&&void 0!==mapToProps.dependsOnOwnProps?Boolean(mapToProps.dependsOnOwnProps):1!==mapToProps.length}function wrapMapToPropsFunc(mapToProps,methodName){return function initProxySelector(dispatch,_ref){var displayName=_ref.displayName,proxy=function mapToPropsProxy(stateOrDispatch,ownProps){return proxy.dependsOnOwnProps?proxy.mapToProps(stateOrDispatch,ownProps):proxy.mapToProps(stateOrDispatch)};return proxy.dependsOnOwnProps=!0,proxy.mapToProps=function detectFactoryAndVerify(stateOrDispatch,ownProps){proxy.mapToProps=mapToProps,proxy.dependsOnOwnProps=getDependsOnOwnProps(mapToProps);var props=proxy(stateOrDispatch,ownProps);return"function"==typeof props&&(proxy.mapToProps=props,proxy.dependsOnOwnProps=getDependsOnOwnProps(props),props=proxy(stateOrDispatch,ownProps)),(0,_verifyPlainObject.default)(props,displayName,methodName),props},proxy}}},{"../utils/verifyPlainObject":467,"@babel/runtime/helpers/interopRequireDefault":45}],455:[function(require,module,exports){"use strict";exports.__esModule=!0,exports.createDispatchHook=createDispatchHook,exports.useDispatch=void 0;var _Context=require("../components/Context"),_useStore=require("./useStore");function createDispatchHook(context){void 0===context&&(context=_Context.ReactReduxContext);var useStore=context===_Context.ReactReduxContext?_useStore.useStore:(0,_useStore.createStoreHook)(context);return function useDispatch(){var store;return useStore().dispatch}}var useDispatch=createDispatchHook();exports.useDispatch=useDispatch},{"../components/Context":445,"./useStore":458}],456:[function(require,module,exports){"use strict";exports.__esModule=!0,exports.useReduxContext=useReduxContext;var _react=require("react"),_Context=require("../components/Context");function useReduxContext(){var contextValue=(0,_react.useContext)(_Context.ReactReduxContext);if(!contextValue)throw new Error("could not find react-redux context value; please ensure the component is wrapped in a <Provider>");return contextValue}},{"../components/Context":445,react:483}],457:[function(require,module,exports){"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");exports.__esModule=!0,exports.createSelectorHook=createSelectorHook,exports.useSelector=void 0;var _react=require("react"),_useReduxContext2=require("./useReduxContext"),_Subscription=_interopRequireDefault(require("../utils/Subscription")),_useIsomorphicLayoutEffect=require("../utils/useIsomorphicLayoutEffect"),_Context=require("../components/Context"),refEquality=function refEquality(a,b){return a===b};function useSelectorWithStoreAndSubscription(selector,equalityFn,store,contextSub){var _useReducer,forceRender=(0,_react.useReducer)((function(s){return s+1}),0)[1],subscription=(0,_react.useMemo)((function(){return new _Subscription.default(store,contextSub)}),[store,contextSub]),latestSubscriptionCallbackError=(0,_react.useRef)(),latestSelector=(0,_react.useRef)(),latestStoreState=(0,_react.useRef)(),latestSelectedState=(0,_react.useRef)(),storeState=store.getState(),selectedState;try{if(selector!==latestSelector.current||storeState!==latestStoreState.current||latestSubscriptionCallbackError.current){var newSelectedState=selector(storeState);selectedState=void 0!==latestSelectedState.current&&equalityFn(newSelectedState,latestSelectedState.current)?latestSelectedState.current:newSelectedState}else selectedState=latestSelectedState.current}catch(err){throw latestSubscriptionCallbackError.current&&(err.message+="\nThe error may be correlated with this previous error:\n"+latestSubscriptionCallbackError.current.stack+"\n\n"),err}return(0,_useIsomorphicLayoutEffect.useIsomorphicLayoutEffect)((function(){latestSelector.current=selector,latestStoreState.current=storeState,latestSelectedState.current=selectedState,latestSubscriptionCallbackError.current=void 0})),(0,_useIsomorphicLayoutEffect.useIsomorphicLayoutEffect)((function(){function checkForUpdates(){try{var newStoreState=store.getState(),_newSelectedState=latestSelector.current(newStoreState);if(equalityFn(_newSelectedState,latestSelectedState.current))return;latestSelectedState.current=_newSelectedState,latestStoreState.current=newStoreState}catch(err){latestSubscriptionCallbackError.current=err}forceRender()}return subscription.onStateChange=checkForUpdates,subscription.trySubscribe(),checkForUpdates(),function(){return subscription.tryUnsubscribe()}}),[store,subscription]),selectedState}function createSelectorHook(context){void 0===context&&(context=_Context.ReactReduxContext);var useReduxContext=context===_Context.ReactReduxContext?_useReduxContext2.useReduxContext:function(){return(0,_react.useContext)(context)};return function useSelector(selector,equalityFn){if(void 0===equalityFn&&(equalityFn=refEquality),!selector)throw new Error("You must pass a selector to useSelector");if("function"!=typeof selector)throw new Error("You must pass a function as a selector to useSelector");if("function"!=typeof equalityFn)throw new Error("You must pass a function as an equality function to useSelector");var _useReduxContext=useReduxContext(),store,contextSub,selectedState=useSelectorWithStoreAndSubscription(selector,equalityFn,_useReduxContext.store,_useReduxContext.subscription);return(0,_react.useDebugValue)(selectedState),selectedState}}var useSelector=createSelectorHook();exports.useSelector=useSelector},{"../components/Context":445,"../utils/Subscription":460,"../utils/useIsomorphicLayoutEffect":466,"./useReduxContext":456,"@babel/runtime/helpers/interopRequireDefault":45,react:483}],458:[function(require,module,exports){"use strict";exports.__esModule=!0,exports.createStoreHook=createStoreHook,exports.useStore=void 0;var _react=require("react"),_Context=require("../components/Context"),_useReduxContext2=require("./useReduxContext");function createStoreHook(context){void 0===context&&(context=_Context.ReactReduxContext);var useReduxContext=context===_Context.ReactReduxContext?_useReduxContext2.useReduxContext:function(){return(0,_react.useContext)(context)};return function useStore(){var _useReduxContext,store;return useReduxContext().store}}var useStore=createStoreHook();exports.useStore=useStore},{"../components/Context":445,"./useReduxContext":456,react:483}],459:[function(require,module,exports){"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");exports.__esModule=!0;var _Provider=_interopRequireDefault(require("./components/Provider"));exports.Provider=_Provider.default;var _connectAdvanced=_interopRequireDefault(require("./components/connectAdvanced"));exports.connectAdvanced=_connectAdvanced.default;var _Context=require("./components/Context");exports.ReactReduxContext=_Context.ReactReduxContext;var _connect=_interopRequireDefault(require("./connect/connect"));exports.connect=_connect.default;var _useDispatch=require("./hooks/useDispatch");exports.useDispatch=_useDispatch.useDispatch,exports.createDispatchHook=_useDispatch.createDispatchHook;var _useSelector=require("./hooks/useSelector");exports.useSelector=_useSelector.useSelector,exports.createSelectorHook=_useSelector.createSelectorHook;var _useStore=require("./hooks/useStore");exports.useStore=_useStore.useStore,exports.createStoreHook=_useStore.createStoreHook;var _batch=require("./utils/batch"),_reactBatchedUpdates=require("./utils/reactBatchedUpdates");exports.batch=_reactBatchedUpdates.unstable_batchedUpdates;var _shallowEqual=_interopRequireDefault(require("./utils/shallowEqual"));exports.shallowEqual=_shallowEqual.default,(0,_batch.setBatch)(_reactBatchedUpdates.unstable_batchedUpdates)},{"./components/Context":445,"./components/Provider":446,"./components/connectAdvanced":447,"./connect/connect":448,"./hooks/useDispatch":455,"./hooks/useSelector":457,"./hooks/useStore":458,"./utils/batch":461,"./utils/reactBatchedUpdates":464,"./utils/shallowEqual":465,"@babel/runtime/helpers/interopRequireDefault":45}],460:[function(require,module,exports){"use strict";exports.__esModule=!0,exports.default=void 0;var _batch=require("./batch"),nullListeners={notify:function notify(){}};function createListenerCollection(){var batch=(0,_batch.getBatch)(),first=null,last=null;return{clear:function clear(){first=null,last=null},notify:function notify(){batch((function(){for(var listener=first;listener;)listener.callback(),listener=listener.next}))},get:function get(){for(var listeners=[],listener=first;listener;)listeners.push(listener),listener=listener.next;return listeners},subscribe:function subscribe(callback){var isSubscribed=!0,listener=last={callback:callback,next:null,prev:last};return listener.prev?listener.prev.next=listener:first=listener,function unsubscribe(){isSubscribed&&null!==first&&(isSubscribed=!1,listener.next?listener.next.prev=listener.prev:last=listener.prev,listener.prev?listener.prev.next=listener.next:first=listener.next)}}}}var Subscription=function(){function Subscription(store,parentSub){this.store=store,this.parentSub=parentSub,this.unsubscribe=null,this.listeners=nullListeners,this.handleChangeWrapper=this.handleChangeWrapper.bind(this)}var _proto=Subscription.prototype;return _proto.addNestedSub=function addNestedSub(listener){return this.trySubscribe(),this.listeners.subscribe(listener)},_proto.notifyNestedSubs=function notifyNestedSubs(){this.listeners.notify()},_proto.handleChangeWrapper=function handleChangeWrapper(){this.onStateChange&&this.onStateChange()},_proto.isSubscribed=function isSubscribed(){return Boolean(this.unsubscribe)},_proto.trySubscribe=function trySubscribe(){this.unsubscribe||(this.unsubscribe=this.parentSub?this.parentSub.addNestedSub(this.handleChangeWrapper):this.store.subscribe(this.handleChangeWrapper),this.listeners=createListenerCollection())},_proto.tryUnsubscribe=function tryUnsubscribe(){this.unsubscribe&&(this.unsubscribe(),this.unsubscribe=null,this.listeners.clear(),this.listeners=nullListeners)},Subscription}();exports.default=Subscription},{"./batch":461}],461:[function(require,module,exports){"use strict";function defaultNoopBatch(callback){callback()}exports.__esModule=!0,exports.getBatch=exports.setBatch=void 0;var batch=defaultNoopBatch,setBatch=function setBatch(newBatch){return batch=newBatch};exports.setBatch=setBatch;var getBatch=function getBatch(){return batch};exports.getBatch=getBatch},{}],462:[function(require,module,exports){"use strict";function bindActionCreators(actionCreators,dispatch){var boundActionCreators={},_loop=function _loop(key){var actionCreator=actionCreators[key];"function"==typeof actionCreator&&(boundActionCreators[key]=function(){return dispatch(actionCreator.apply(void 0,arguments))})};for(var key in actionCreators)_loop(key);return boundActionCreators}exports.__esModule=!0,exports.default=bindActionCreators},{}],463:[function(require,module,exports){"use strict";function isPlainObject(obj){if("object"!=typeof obj||null===obj)return!1;var proto=Object.getPrototypeOf(obj);if(null===proto)return!0;for(var baseProto=proto;null!==Object.getPrototypeOf(baseProto);)baseProto=Object.getPrototypeOf(baseProto);return proto===baseProto}exports.__esModule=!0,exports.default=isPlainObject},{}],464:[function(require,module,exports){"use strict";exports.__esModule=!0,exports.unstable_batchedUpdates=void 0;var _reactDom=require("react-dom");exports.unstable_batchedUpdates=_reactDom.unstable_batchedUpdates},{"react-dom":440}],465:[function(require,module,exports){"use strict";function is(x,y){return x===y?0!==x||0!==y||1/x==1/y:x!=x&&y!=y}function shallowEqual(objA,objB){if(is(objA,objB))return!0;if("object"!=typeof objA||null===objA||"object"!=typeof objB||null===objB)return!1;var keysA=Object.keys(objA),keysB=Object.keys(objB);if(keysA.length!==keysB.length)return!1;for(var i=0;i<keysA.length;i++)if(!Object.prototype.hasOwnProperty.call(objB,keysA[i])||!is(objA[keysA[i]],objB[keysA[i]]))return!1;return!0}exports.__esModule=!0,exports.default=shallowEqual},{}],466:[function(require,module,exports){"use strict";exports.__esModule=!0,exports.useIsomorphicLayoutEffect=void 0;var _react=require("react"),useIsomorphicLayoutEffect="undefined"!=typeof window&&void 0!==window.document&&void 0!==window.document.createElement?_react.useLayoutEffect:_react.useEffect;exports.useIsomorphicLayoutEffect=useIsomorphicLayoutEffect},{react:483}],467:[function(require,module,exports){"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");exports.__esModule=!0,exports.default=verifyPlainObject;var _isPlainObject=_interopRequireDefault(require("./isPlainObject")),_warning=_interopRequireDefault(require("./warning"));function verifyPlainObject(value,displayName,methodName){(0,_isPlainObject.default)(value)||(0,_warning.default)(methodName+"() in "+displayName+" must return a plain object. Instead received "+value+".")}},{"./isPlainObject":463,"./warning":468,"@babel/runtime/helpers/interopRequireDefault":45}],468:[function(require,module,exports){"use strict";function warning(message){"undefined"!=typeof console&&"function"==typeof console.error&&console.error(message);try{throw new Error(message)}catch(e){}}exports.__esModule=!0,exports.default=warning},{}],469:[function(require,module,exports){!function webpackUniversalModuleDefinition(root,factory){"object"==typeof exports&&"object"==typeof module?module.exports=factory(require("react")):"function"==typeof define&&define.amd?define(["react"],factory):"object"==typeof exports?exports.Spinner=factory(require("react")):root.Spinner=factory(root.React)}(this,(function(__WEBPACK_EXTERNAL_MODULE_1__){return function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={exports:{},id:moduleId,loaded:!1};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.loaded=!0,module.exports}return __webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.p="./build",__webpack_require__(0)}([function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_get=function get(_x,_x2,_x3){for(var _again=!0;_again;){var object=_x,property=_x2,receiver=_x3;_again=!1,null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0!==desc){if("value"in desc)return desc.value;var getter=desc.get;if(void 0===getter)return;return getter.call(receiver)}var parent=Object.getPrototypeOf(object);if(null===parent)return;_x=parent,_x2=property,_x3=receiver,_again=!0,desc=parent=void 0}};function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var _react,_react2=_interopRequireDefault(__webpack_require__(1)),Spinner=function(_React$Component){function Spinner(props){_classCallCheck(this,Spinner),_get(Object.getPrototypeOf(Spinner.prototype),"constructor",this).call(this,props)}return _inherits(Spinner,_React$Component),_createClass(Spinner,[{key:"render",value:function render(){for(var bars=[],props=this.props,i=0;i<12;i++){var barStyle={};barStyle.WebkitAnimationDelay=barStyle.animationDelay=(i-12)/10+"s",barStyle.WebkitTransform=barStyle.transform="rotate("+30*i+"deg) translate(146%)",bars.push(_react2.default.createElement("div",{style:barStyle,className:"react-spinner_bar",key:i}))}return _react2.default.createElement("div",_extends({},props,{className:(props.className||"")+" react-spinner"}),bars)}}]),Spinner}(_react2.default.Component);exports.default=Spinner,module.exports=exports.default},function(module,exports){module.exports=__WEBPACK_EXTERNAL_MODULE_1__}])}))},{react:483}],470:[function(require,module,exports){(function(process){(function(){"use strict";function ___$insertStyle(css){if(css&&"undefined"!=typeof window){var style=document.createElement("style");return style.setAttribute("type","text/css"),style.innerHTML=css,document.head.appendChild(style),css}}function _interopDefault(ex){return ex&&"object"==typeof ex&&"default"in ex?ex.default:ex}var React=_interopDefault(require("react"));function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _extends(){return(_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target}).apply(this,arguments)}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread2(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass)}function _getPrototypeOf(o){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function _setPrototypeOf(o,p){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o})(o,p)}function _assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}function _possibleConstructorReturn(self,call){return!call||"object"!=typeof call&&"function"!=typeof call?_assertThisInitialized(self):call}function createCommonjsModule(fn,module){return fn(module={exports:{}},module.exports),module.exports}function makeEmptyFunction(arg){return function(){return arg}}var emptyFunction=function emptyFunction(){};emptyFunction.thatReturns=makeEmptyFunction,emptyFunction.thatReturnsFalse=makeEmptyFunction(!1),emptyFunction.thatReturnsTrue=makeEmptyFunction(!0),emptyFunction.thatReturnsNull=makeEmptyFunction(null),emptyFunction.thatReturnsThis=function(){return this},emptyFunction.thatReturnsArgument=function(arg){return arg};var emptyFunction_1=emptyFunction,validateFormat=function validateFormat(format){};function invariant(condition,format,a,b,c,d,e,f){if(validateFormat(format),!condition){var error;if(void 0===format)error=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var args=[a,b,c,d,e,f],argIndex=0;(error=new Error(format.replace(/%s/g,(function(){return args[argIndex++]})))).name="Invariant Violation"}throw error.framesToPop=1,error}}"production"!==process.env.NODE_ENV&&(validateFormat=function validateFormat(format){if(void 0===format)throw new Error("invariant requires an error message argument")});var invariant_1=invariant,warning=emptyFunction_1;if("production"!==process.env.NODE_ENV){var printWarning=function printWarning(format){for(var _len=arguments.length,args=Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)args[_key-1]=arguments[_key];var argIndex=0,message="Warning: "+format.replace(/%s/g,(function(){return args[argIndex++]}));"undefined"!=typeof console&&console.error(message);try{throw new Error(message)}catch(x){}};warning=function warning(condition,format){if(void 0===format)throw new Error("`warning(condition, format, ...args)` requires a warning message argument");if(0!==format.indexOf("Failed Composite propType: ")&&!condition){for(var _len2=arguments.length,args=Array(_len2>2?_len2-2:0),_key2=2;_key2<_len2;_key2++)args[_key2-2]=arguments[_key2];printWarning.apply(void 0,[format].concat(args))}}}var warning_1=warning,getOwnPropertySymbols=Object.getOwnPropertySymbols,hasOwnProperty=Object.prototype.hasOwnProperty,propIsEnumerable=Object.prototype.propertyIsEnumerable;
/*
object-assign
(c) Sindre Sorhus
@license MIT
*/function toObject(val){if(null==val)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(val)}function shouldUseNative(){try{if(!Object.assign)return!1;var test1=new String("abc"),order2;if(test1[5]="de","5"===Object.getOwnPropertyNames(test1)[0])return!1;for(var test2={},i=0;i<10;i++)test2["_"+String.fromCharCode(i)]=i;if("0123456789"!==Object.getOwnPropertyNames(test2).map((function(n){return test2[n]})).join(""))return!1;var test3={};return"abcdefghijklmnopqrst".split("").forEach((function(letter){test3[letter]=letter})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},test3)).join("")}catch(err){return!1}}var objectAssign=shouldUseNative()?Object.assign:function(target,source){for(var from,to=toObject(target),symbols,s=1;s<arguments.length;s++){for(var key in from=Object(arguments[s]))hasOwnProperty.call(from,key)&&(to[key]=from[key]);if(getOwnPropertySymbols){symbols=getOwnPropertySymbols(from);for(var i=0;i<symbols.length;i++)propIsEnumerable.call(from,symbols[i])&&(to[symbols[i]]=from[symbols[i]])}}return to},ReactPropTypesSecret,ReactPropTypesSecret_1="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";if("production"!==process.env.NODE_ENV)var invariant$1=invariant_1,warning$1=warning_1,ReactPropTypesSecret$1=ReactPropTypesSecret_1,loggedTypeFailures={};function checkPropTypes(typeSpecs,values,location,componentName,getStack){if("production"!==process.env.NODE_ENV)for(var typeSpecName in typeSpecs)if(typeSpecs.hasOwnProperty(typeSpecName)){var error;try{invariant$1("function"==typeof typeSpecs[typeSpecName],"%s: %s type `%s` is invalid; it must be a function, usually from the `prop-types` package, but received `%s`.",componentName||"React class",location,typeSpecName,typeof typeSpecs[typeSpecName]),error=typeSpecs[typeSpecName](values,typeSpecName,componentName,location,null,ReactPropTypesSecret$1)}catch(ex){error=ex}if(warning$1(!error||error instanceof Error,"%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",componentName||"React class",location,typeSpecName,typeof error),error instanceof Error&&!(error.message in loggedTypeFailures)){loggedTypeFailures[error.message]=!0;var stack=getStack?getStack():"";warning$1(!1,"Failed %s type: %s%s",location,error.message,null!=stack?stack:"")}}}var checkPropTypes_1=checkPropTypes,factoryWithTypeCheckers=function(isValidElement,throwOnDirectAccess){var ITERATOR_SYMBOL="function"==typeof Symbol&&Symbol.iterator,FAUX_ITERATOR_SYMBOL="@@iterator";function getIteratorFn(maybeIterable){var iteratorFn=maybeIterable&&(ITERATOR_SYMBOL&&maybeIterable[ITERATOR_SYMBOL]||maybeIterable["@@iterator"]);if("function"==typeof iteratorFn)return iteratorFn}var ANONYMOUS="<<anonymous>>",ReactPropTypes={array:createPrimitiveTypeChecker("array"),bool:createPrimitiveTypeChecker("boolean"),func:createPrimitiveTypeChecker("function"),number:createPrimitiveTypeChecker("number"),object:createPrimitiveTypeChecker("object"),string:createPrimitiveTypeChecker("string"),symbol:createPrimitiveTypeChecker("symbol"),any:createAnyTypeChecker(),arrayOf:createArrayOfTypeChecker,element:createElementTypeChecker(),instanceOf:createInstanceTypeChecker,node:createNodeChecker(),objectOf:createObjectOfTypeChecker,oneOf:createEnumTypeChecker,oneOfType:createUnionTypeChecker,shape:createShapeTypeChecker,exact:createStrictShapeTypeChecker};function is(x,y){return x===y?0!==x||1/x==1/y:x!=x&&y!=y}function PropTypeError(message){this.message=message,this.stack=""}function createChainableTypeChecker(validate){if("production"!==process.env.NODE_ENV)var manualPropTypeCallCache={},manualPropTypeWarningCount=0;function checkType(isRequired,props,propName,componentName,location,propFullName,secret){if(componentName=componentName||ANONYMOUS,propFullName=propFullName||propName,secret!==ReactPropTypesSecret_1)if(throwOnDirectAccess)invariant_1(!1,"Calling PropTypes validators directly is not supported by the `prop-types` package. Use `PropTypes.checkPropTypes()` to call them. Read more at http://fb.me/use-check-prop-types");else if("production"!==process.env.NODE_ENV&&"undefined"!=typeof console){var cacheKey=componentName+":"+propName;!manualPropTypeCallCache[cacheKey]&&manualPropTypeWarningCount<3&&(warning_1(!1,"You are manually calling a React.PropTypes validation function for the `%s` prop on `%s`. This is deprecated and will throw in the standalone `prop-types` package. You may be seeing this warning due to a third-party PropTypes library. See https://fb.me/react-warning-dont-call-proptypes for details.",propFullName,componentName),manualPropTypeCallCache[cacheKey]=!0,manualPropTypeWarningCount++)}return null==props[propName]?isRequired?null===props[propName]?new PropTypeError("The "+location+" `"+propFullName+"` is marked as required in `"+componentName+"`, but its value is `null`."):new PropTypeError("The "+location+" `"+propFullName+"` is marked as required in `"+componentName+"`, but its value is `undefined`."):null:validate(props,propName,componentName,location,propFullName)}var chainedCheckType=checkType.bind(null,!1);return chainedCheckType.isRequired=checkType.bind(null,!0),chainedCheckType}function createPrimitiveTypeChecker(expectedType){function validate(props,propName,componentName,location,propFullName,secret){var propValue=props[propName],propType,preciseType;return getPropType(propValue)!==expectedType?new PropTypeError("Invalid "+location+" `"+propFullName+"` of type `"+getPreciseType(propValue)+"` supplied to `"+componentName+"`, expected `"+expectedType+"`."):null}return createChainableTypeChecker(validate)}function createAnyTypeChecker(){return createChainableTypeChecker(emptyFunction_1.thatReturnsNull)}function createArrayOfTypeChecker(typeChecker){function validate(props,propName,componentName,location,propFullName){if("function"!=typeof typeChecker)return new PropTypeError("Property `"+propFullName+"` of component `"+componentName+"` has invalid PropType notation inside arrayOf.");var propValue=props[propName],propType;if(!Array.isArray(propValue))return new PropTypeError("Invalid "+location+" `"+propFullName+"` of type `"+getPropType(propValue)+"` supplied to `"+componentName+"`, expected an array.");for(var i=0;i<propValue.length;i++){var error=typeChecker(propValue,i,componentName,location,propFullName+"["+i+"]",ReactPropTypesSecret_1);if(error instanceof Error)return error}return null}return createChainableTypeChecker(validate)}function createElementTypeChecker(){function validate(props,propName,componentName,location,propFullName){var propValue=props[propName],propType;return isValidElement(propValue)?null:new PropTypeError("Invalid "+location+" `"+propFullName+"` of type `"+getPropType(propValue)+"` supplied to `"+componentName+"`, expected a single ReactElement.")}return createChainableTypeChecker(validate)}function createInstanceTypeChecker(expectedClass){function validate(props,propName,componentName,location,propFullName){if(!(props[propName]instanceof expectedClass)){var expectedClassName=expectedClass.name||ANONYMOUS,actualClassName;return new PropTypeError("Invalid "+location+" `"+propFullName+"` of type `"+getClassName(props[propName])+"` supplied to `"+componentName+"`, expected instance of `"+expectedClassName+"`.")}return null}return createChainableTypeChecker(validate)}function createEnumTypeChecker(expectedValues){if(!Array.isArray(expectedValues))return"production"!==process.env.NODE_ENV&&warning_1(!1,"Invalid argument supplied to oneOf, expected an instance of array."),emptyFunction_1.thatReturnsNull;function validate(props,propName,componentName,location,propFullName){for(var propValue=props[propName],i=0;i<expectedValues.length;i++)if(is(propValue,expectedValues[i]))return null;var valuesString;return new PropTypeError("Invalid "+location+" `"+propFullName+"` of value `"+propValue+"` supplied to `"+componentName+"`, expected one of "+JSON.stringify(expectedValues)+".")}return createChainableTypeChecker(validate)}function createObjectOfTypeChecker(typeChecker){function validate(props,propName,componentName,location,propFullName){if("function"!=typeof typeChecker)return new PropTypeError("Property `"+propFullName+"` of component `"+componentName+"` has invalid PropType notation inside objectOf.");var propValue=props[propName],propType=getPropType(propValue);if("object"!==propType)return new PropTypeError("Invalid "+location+" `"+propFullName+"` of type `"+propType+"` supplied to `"+componentName+"`, expected an object.");for(var key in propValue)if(propValue.hasOwnProperty(key)){var error=typeChecker(propValue,key,componentName,location,propFullName+"."+key,ReactPropTypesSecret_1);if(error instanceof Error)return error}return null}return createChainableTypeChecker(validate)}function createUnionTypeChecker(arrayOfTypeCheckers){if(!Array.isArray(arrayOfTypeCheckers))return"production"!==process.env.NODE_ENV&&warning_1(!1,"Invalid argument supplied to oneOfType, expected an instance of array."),emptyFunction_1.thatReturnsNull;for(var i=0;i<arrayOfTypeCheckers.length;i++){var checker=arrayOfTypeCheckers[i];if("function"!=typeof checker)return warning_1(!1,"Invalid argument supplied to oneOfType. Expected an array of check functions, but received %s at index %s.",getPostfixForTypeWarning(checker),i),emptyFunction_1.thatReturnsNull}function validate(props,propName,componentName,location,propFullName){for(var i=0;i<arrayOfTypeCheckers.length;i++){var checker;if(null==(0,arrayOfTypeCheckers[i])(props,propName,componentName,location,propFullName,ReactPropTypesSecret_1))return null}return new PropTypeError("Invalid "+location+" `"+propFullName+"` supplied to `"+componentName+"`.")}return createChainableTypeChecker(validate)}function createNodeChecker(){function validate(props,propName,componentName,location,propFullName){return isNode(props[propName])?null:new PropTypeError("Invalid "+location+" `"+propFullName+"` supplied to `"+componentName+"`, expected a ReactNode.")}return createChainableTypeChecker(validate)}function createShapeTypeChecker(shapeTypes){function validate(props,propName,componentName,location,propFullName){var propValue=props[propName],propType=getPropType(propValue);if("object"!==propType)return new PropTypeError("Invalid "+location+" `"+propFullName+"` of type `"+propType+"` supplied to `"+componentName+"`, expected `object`.");for(var key in shapeTypes){var checker=shapeTypes[key];if(checker){var error=checker(propValue,key,componentName,location,propFullName+"."+key,ReactPropTypesSecret_1);if(error)return error}}return null}return createChainableTypeChecker(validate)}function createStrictShapeTypeChecker(shapeTypes){function validate(props,propName,componentName,location,propFullName){var propValue=props[propName],propType=getPropType(propValue);if("object"!==propType)return new PropTypeError("Invalid "+location+" `"+propFullName+"` of type `"+propType+"` supplied to `"+componentName+"`, expected `object`.");var allKeys=objectAssign({},props[propName],shapeTypes);for(var key in allKeys){var checker=shapeTypes[key];if(!checker)return new PropTypeError("Invalid "+location+" `"+propFullName+"` key `"+key+"` supplied to `"+componentName+"`.\nBad object: "+JSON.stringify(props[propName],null,"  ")+"\nValid keys: "+JSON.stringify(Object.keys(shapeTypes),null,"  "));var error=checker(propValue,key,componentName,location,propFullName+"."+key,ReactPropTypesSecret_1);if(error)return error}return null}return createChainableTypeChecker(validate)}function isNode(propValue){switch(typeof propValue){case"number":case"string":case"undefined":return!0;case"boolean":return!propValue;case"object":if(Array.isArray(propValue))return propValue.every(isNode);if(null===propValue||isValidElement(propValue))return!0;var iteratorFn=getIteratorFn(propValue);if(!iteratorFn)return!1;var iterator=iteratorFn.call(propValue),step;if(iteratorFn!==propValue.entries){for(;!(step=iterator.next()).done;)if(!isNode(step.value))return!1}else for(;!(step=iterator.next()).done;){var entry=step.value;if(entry&&!isNode(entry[1]))return!1}return!0;default:return!1}}function isSymbol(propType,propValue){return"symbol"===propType||("Symbol"===propValue["@@toStringTag"]||"function"==typeof Symbol&&propValue instanceof Symbol)}function getPropType(propValue){var propType=typeof propValue;return Array.isArray(propValue)?"array":propValue instanceof RegExp?"object":isSymbol(propType,propValue)?"symbol":propType}function getPreciseType(propValue){if(null==propValue)return""+propValue;var propType=getPropType(propValue);if("object"===propType){if(propValue instanceof Date)return"date";if(propValue instanceof RegExp)return"regexp"}return propType}function getPostfixForTypeWarning(value){var type=getPreciseType(value);switch(type){case"array":case"object":return"an "+type;case"boolean":case"date":case"regexp":return"a "+type;default:return type}}function getClassName(propValue){return propValue.constructor&&propValue.constructor.name?propValue.constructor.name:ANONYMOUS}return PropTypeError.prototype=Error.prototype,ReactPropTypes.checkPropTypes=checkPropTypes_1,ReactPropTypes.PropTypes=ReactPropTypes,ReactPropTypes},factoryWithThrowingShims=function(){function shim(props,propName,componentName,location,propFullName,secret){secret!==ReactPropTypesSecret_1&&invariant_1(!1,"Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types")}function getShim(){return shim}shim.isRequired=shim;var ReactPropTypes={array:shim,bool:shim,func:shim,number:shim,object:shim,string:shim,symbol:shim,any:shim,arrayOf:getShim,element:shim,instanceOf:getShim,node:shim,objectOf:getShim,oneOf:getShim,oneOfType:getShim,shape:getShim,exact:getShim};return ReactPropTypes.checkPropTypes=emptyFunction_1,ReactPropTypes.PropTypes=ReactPropTypes,ReactPropTypes},propTypes=createCommonjsModule((function(module){if("production"!==process.env.NODE_ENV){var REACT_ELEMENT_TYPE="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103,isValidElement=function(object){return"object"==typeof object&&null!==object&&object.$$typeof===REACT_ELEMENT_TYPE},throwOnDirectAccess=!0;module.exports=factoryWithTypeCheckers(isValidElement,!0)}else module.exports=factoryWithThrowingShims()})),CONSTANT_GLOBAL={HIDE:"__react_tooltip_hide_event",REBUILD:"__react_tooltip_rebuild_event",SHOW:"__react_tooltip_show_event"},dispatchGlobalEvent=function dispatchGlobalEvent(eventName,opts){var event;"function"==typeof window.CustomEvent?event=new window.CustomEvent(eventName,{detail:opts}):((event=document.createEvent("Event")).initEvent(eventName,!1,!0),event.detail=opts),window.dispatchEvent(event)};function staticMethods(target){target.hide=function(target){dispatchGlobalEvent(CONSTANT_GLOBAL.HIDE,{target:target})},target.rebuild=function(){dispatchGlobalEvent(CONSTANT_GLOBAL.REBUILD)},target.show=function(target){dispatchGlobalEvent(CONSTANT_GLOBAL.SHOW,{target:target})},target.prototype.globalRebuild=function(){this.mount&&(this.unbindListener(),this.bindListener())},target.prototype.globalShow=function(event){if(this.mount){var e={currentTarget:event.detail.target};this.showTooltip(e,!0)}},target.prototype.globalHide=function(event){if(this.mount){var hasTarget=!!(event&&event.detail&&event.detail.target);this.hideTooltip({currentTarget:hasTarget&&event.detail.target},hasTarget)}}}function windowListener(target){target.prototype.bindWindowEvents=function(resizeHide){window.removeEventListener(CONSTANT_GLOBAL.HIDE,this.globalHide),window.addEventListener(CONSTANT_GLOBAL.HIDE,this.globalHide,!1),window.removeEventListener(CONSTANT_GLOBAL.REBUILD,this.globalRebuild),window.addEventListener(CONSTANT_GLOBAL.REBUILD,this.globalRebuild,!1),window.removeEventListener(CONSTANT_GLOBAL.SHOW,this.globalShow),window.addEventListener(CONSTANT_GLOBAL.SHOW,this.globalShow,!1),resizeHide&&(window.removeEventListener("resize",this.onWindowResize),window.addEventListener("resize",this.onWindowResize,!1))},target.prototype.unbindWindowEvents=function(){window.removeEventListener(CONSTANT_GLOBAL.HIDE,this.globalHide),window.removeEventListener(CONSTANT_GLOBAL.REBUILD,this.globalRebuild),window.removeEventListener(CONSTANT_GLOBAL.SHOW,this.globalShow),window.removeEventListener("resize",this.onWindowResize)},target.prototype.onWindowResize=function(){this.mount&&this.hideTooltip()}}var checkStatus=function checkStatus(dataEventOff,e){var show=this.state.show,id=this.props.id,isCapture=this.isCapture(e.currentTarget),currentItem=e.currentTarget.getAttribute("currentItem");isCapture||e.stopPropagation(),show&&"true"===currentItem?dataEventOff||this.hideTooltip(e):(e.currentTarget.setAttribute("currentItem","true"),setUntargetItems(e.currentTarget,this.getTargetArray(id)),this.showTooltip(e))},setUntargetItems=function setUntargetItems(currentTarget,targetArray){for(var i=0;i<targetArray.length;i++)currentTarget!==targetArray[i]?targetArray[i].setAttribute("currentItem","false"):targetArray[i].setAttribute("currentItem","true")},customListeners={id:"9b69f92e-d3fe-498b-b1b4-c5e63a51b0cf",set:function set(target,event,listener){var map;this.id in target?target[this.id][event]=listener:Object.defineProperty(target,this.id,{configurable:!0,value:_defineProperty({},event,listener)})},get:function get(target,event){var map=target[this.id];if(void 0!==map)return map[event]}};function customEvent(target){target.prototype.isCustomEvent=function(ele){var event;return this.state.event||!!ele.getAttribute("data-event")},target.prototype.customBindListener=function(ele){var _this=this,_this$state=this.state,event=_this$state.event,eventOff=_this$state.eventOff,dataEvent=ele.getAttribute("data-event")||event,dataEventOff=ele.getAttribute("data-event-off")||eventOff;dataEvent.split(" ").forEach((function(event){ele.removeEventListener(event,customListeners.get(ele,event));var customListener=checkStatus.bind(_this,dataEventOff);customListeners.set(ele,event,customListener),ele.addEventListener(event,customListener,!1)})),dataEventOff&&dataEventOff.split(" ").forEach((function(event){ele.removeEventListener(event,_this.hideTooltip),ele.addEventListener(event,_this.hideTooltip,!1)}))},target.prototype.customUnbindListener=function(ele){var _this$state2=this.state,event=_this$state2.event,eventOff=_this$state2.eventOff,dataEvent=event||ele.getAttribute("data-event"),dataEventOff=eventOff||ele.getAttribute("data-event-off");ele.removeEventListener(dataEvent,customListeners.get(ele,event)),dataEventOff&&ele.removeEventListener(dataEventOff,this.hideTooltip)}}function isCapture(target){target.prototype.isCapture=function(currentTarget){return currentTarget&&"true"===currentTarget.getAttribute("data-iscapture")||this.props.isCapture||!1}}function getEffect(target){target.prototype.getEffect=function(currentTarget){var dataEffect;return currentTarget.getAttribute("data-effect")||this.props.effect||"float"}}var makeProxy=function makeProxy(e){var proxy={};for(var key in e)"function"==typeof e[key]?proxy[key]=e[key].bind(e):proxy[key]=e[key];return proxy},bodyListener=function bodyListener(callback,options,e){var _options$respectEffec=options.respectEffect,respectEffect=void 0!==_options$respectEffec&&_options$respectEffec,_options$customEvent=options.customEvent,customEvent=void 0!==_options$customEvent&&_options$customEvent,id=this.props.id,tip=e.target.getAttribute("data-tip")||null,forId=e.target.getAttribute("data-for")||null,target=e.target;if(!this.isCustomEvent(target)||customEvent){var isTargetBelongsToTooltip=null==id&&null==forId||forId===id;if(null!=tip&&(!respectEffect||"float"===this.getEffect(target))&&isTargetBelongsToTooltip){var proxy=makeProxy(e);proxy.currentTarget=target,callback(proxy)}}},findCustomEvents=function findCustomEvents(targetArray,dataAttribute){var events={};return targetArray.forEach((function(target){var event=target.getAttribute(dataAttribute);event&&event.split(" ").forEach((function(event){return events[event]=!0}))})),events},getBody=function getBody(){return document.getElementsByTagName("body")[0]};function bodyMode(target){target.prototype.isBodyMode=function(){return!!this.props.bodyMode},target.prototype.bindBodyListener=function(targetArray){var _this=this,_this$state=this.state,event=_this$state.event,eventOff=_this$state.eventOff,possibleCustomEvents=_this$state.possibleCustomEvents,possibleCustomEventsOff=_this$state.possibleCustomEventsOff,body=getBody(),customEvents=findCustomEvents(targetArray,"data-event"),customEventsOff=findCustomEvents(targetArray,"data-event-off");null!=event&&(customEvents[event]=!0),null!=eventOff&&(customEventsOff[eventOff]=!0),possibleCustomEvents.split(" ").forEach((function(event){return customEvents[event]=!0})),possibleCustomEventsOff.split(" ").forEach((function(event){return customEventsOff[event]=!0})),this.unbindBodyListener(body);var listeners=this.bodyModeListeners={};for(var _event in null==event&&(listeners.mouseover=bodyListener.bind(this,this.showTooltip,{}),listeners.mousemove=bodyListener.bind(this,this.updateTooltip,{respectEffect:!0}),listeners.mouseout=bodyListener.bind(this,this.hideTooltip,{})),customEvents)listeners[_event]=bodyListener.bind(this,(function(e){var targetEventOff=e.currentTarget.getAttribute("data-event-off")||eventOff;checkStatus.call(_this,targetEventOff,e)}),{customEvent:!0});for(var _event2 in customEventsOff)listeners[_event2]=bodyListener.bind(this,this.hideTooltip,{customEvent:!0});for(var _event3 in listeners)body.addEventListener(_event3,listeners[_event3])},target.prototype.unbindBodyListener=function(body){body=body||getBody();var listeners=this.bodyModeListeners;for(var event in listeners)body.removeEventListener(event,listeners[event])}}var getMutationObserverClass=function getMutationObserverClass(){return window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver};function trackRemoval(target){target.prototype.bindRemovalTracker=function(){var _this=this,MutationObserver=getMutationObserverClass();if(null!=MutationObserver){var observer=new MutationObserver((function(mutations){for(var m1=0;m1<mutations.length;m1++)for(var mutation=mutations[m1],m2=0;m2<mutation.removedNodes.length;m2++){var element;if(mutation.removedNodes[m2]===_this.state.currentTarget)return void _this.hideTooltip()}}));observer.observe(window.document,{childList:!0,subtree:!0}),this.removalTracker=observer}},target.prototype.unbindRemovalTracker=function(){this.removalTracker&&(this.removalTracker.disconnect(),this.removalTracker=null)}}function getPosition(e,target,node,place,desiredPlace,effect,offset){for(var _getDimensions=getDimensions(node),tipWidth=_getDimensions.width,tipHeight=_getDimensions.height,_getDimensions2=getDimensions(target),targetWidth=_getDimensions2.width,targetHeight=_getDimensions2.height,_getCurrentOffset=getCurrentOffset(e,target,effect),mouseX=_getCurrentOffset.mouseX,mouseY=_getCurrentOffset.mouseY,defaultOffset=getDefaultPosition(effect,targetWidth,targetHeight,tipWidth,tipHeight),_calculateOffset=calculateOffset(offset),extraOffset_X=_calculateOffset.extraOffset_X,extraOffset_Y=_calculateOffset.extraOffset_Y,windowWidth=window.innerWidth,windowHeight=window.innerHeight,_getParent=getParent(node),parentTop=_getParent.parentTop,parentLeft=_getParent.parentLeft,getTipOffsetLeft=function getTipOffsetLeft(place){var offset_X=defaultOffset[place].l;return mouseX+offset_X+extraOffset_X},getTipOffsetRight=function getTipOffsetRight(place){var offset_X=defaultOffset[place].r;return mouseX+offset_X+extraOffset_X},getTipOffsetTop=function getTipOffsetTop(place){var offset_Y=defaultOffset[place].t;return mouseY+offset_Y+extraOffset_Y},getTipOffsetBottom=function getTipOffsetBottom(place){var offset_Y=defaultOffset[place].b;return mouseY+offset_Y+extraOffset_Y},outsideLeft=function outsideLeft(p){return getTipOffsetLeft(p)<0},outsideRight=function outsideRight(p){return getTipOffsetRight(p)>windowWidth},outsideTop=function outsideTop(p){return getTipOffsetTop(p)<0},outsideBottom=function outsideBottom(p){return getTipOffsetBottom(p)>windowHeight},outside=function outside(p){return outsideLeft(p)||outsideRight(p)||outsideTop(p)||outsideBottom(p)},inside=function inside(p){return!outside(p)},placesList=["top","bottom","left","right"],insideList=[],i=0;i<4;i++){var p=placesList[i];inside(p)&&insideList.push(p)}var isNewState=!1,newPlace,shouldUpdatePlace=desiredPlace!==place;return inside(desiredPlace)&&shouldUpdatePlace?(isNewState=!0,newPlace=desiredPlace):insideList.length>0&&shouldUpdatePlace&&outside(desiredPlace)&&outside(place)&&(isNewState=!0,newPlace=insideList[0]),isNewState?{isNewState:!0,newState:{place:newPlace}}:{isNewState:!1,position:{left:parseInt(getTipOffsetLeft(place)-parentLeft,10),top:parseInt(getTipOffsetTop(place)-parentTop,10)}}}var getDimensions=function getDimensions(node){var _node$getBoundingClie=node.getBoundingClientRect(),height=_node$getBoundingClie.height,width=_node$getBoundingClie.width;return{height:parseInt(height,10),width:parseInt(width,10)}},getCurrentOffset=function getCurrentOffset(e,currentTarget,effect){var boundingClientRect=currentTarget.getBoundingClientRect(),targetTop=boundingClientRect.top,targetLeft=boundingClientRect.left,_getDimensions3=getDimensions(currentTarget),targetWidth=_getDimensions3.width,targetHeight=_getDimensions3.height;return"float"===effect?{mouseX:e.clientX,mouseY:e.clientY}:{mouseX:targetLeft+targetWidth/2,mouseY:targetTop+targetHeight/2}},getDefaultPosition=function getDefaultPosition(effect,targetWidth,targetHeight,tipWidth,tipHeight){var top,right,bottom,left,disToMouse=3,triangleHeight=2,cursorHeight=12;return"float"===effect?(top={l:-tipWidth/2,r:tipWidth/2,t:-(tipHeight+3+2),b:-3},bottom={l:-tipWidth/2,r:tipWidth/2,t:15,b:tipHeight+3+2+12},left={l:-(tipWidth+3+2),r:-3,t:-tipHeight/2,b:tipHeight/2},right={l:3,r:tipWidth+3+2,t:-tipHeight/2,b:tipHeight/2}):"solid"===effect&&(top={l:-tipWidth/2,r:tipWidth/2,t:-(targetHeight/2+tipHeight+2),b:-targetHeight/2},bottom={l:-tipWidth/2,r:tipWidth/2,t:targetHeight/2,b:targetHeight/2+tipHeight+2},left={l:-(tipWidth+targetWidth/2+2),r:-targetWidth/2,t:-tipHeight/2,b:tipHeight/2},right={l:targetWidth/2,r:tipWidth+targetWidth/2+2,t:-tipHeight/2,b:tipHeight/2}),{top:top,bottom:bottom,left:left,right:right}},calculateOffset=function calculateOffset(offset){var extraOffset_X=0,extraOffset_Y=0;for(var key in"[object String]"===Object.prototype.toString.apply(offset)&&(offset=JSON.parse(offset.toString().replace(/\'/g,'"'))),offset)"top"===key?extraOffset_Y-=parseInt(offset[key],10):"bottom"===key?extraOffset_Y+=parseInt(offset[key],10):"left"===key?extraOffset_X-=parseInt(offset[key],10):"right"===key&&(extraOffset_X+=parseInt(offset[key],10));return{extraOffset_X:extraOffset_X,extraOffset_Y:extraOffset_Y}},getParent=function getParent(currentTarget){for(var currentParent=currentTarget;currentParent&&"none"===window.getComputedStyle(currentParent).getPropertyValue("transform");)currentParent=currentParent.parentElement;var parentTop,parentLeft;return{parentTop:currentParent&&currentParent.getBoundingClientRect().top||0,parentLeft:currentParent&&currentParent.getBoundingClientRect().left||0}},_class,_class2,_temp;function getTipContent(tip,children,getContent,multiline){if(children)return children;if(null!=getContent)return getContent;if(null===getContent)return null;var regexp=/<br\s*\/?>/;return multiline&&"false"!==multiline&&regexp.test(tip)?tip.split(regexp).map((function(d,i){return React.createElement("span",{key:i,className:"multi-line"},d)})):tip}function parseAria(props){var ariaObj={};return Object.keys(props).filter((function(prop){return/(^aria-\w+$|^role$)/.test(prop)})).forEach((function(prop){ariaObj[prop]=props[prop]})),ariaObj}function nodeListToArray(nodeList){var length=nodeList.length;return nodeList.hasOwnProperty?Array.prototype.slice.call(nodeList):new Array(length).fill().map((function(index){return nodeList[index]}))}___$insertStyle('.__react_component_tooltip {\n  border-radius: 3px;\n  display: inline-block;\n  font-size: 13px;\n  left: -999em;\n  opacity: 0;\n  padding: 8px 21px;\n  position: fixed;\n  pointer-events: none;\n  transition: opacity 0.3s ease-out;\n  top: -999em;\n  visibility: hidden;\n  z-index: 999;\n}\n.__react_component_tooltip.allow_hover, .__react_component_tooltip.allow_click {\n  pointer-events: auto;\n}\n.__react_component_tooltip:before, .__react_component_tooltip:after {\n  content: "";\n  width: 0;\n  height: 0;\n  position: absolute;\n}\n.__react_component_tooltip.show {\n  opacity: 0.9;\n  margin-top: 0px;\n  margin-left: 0px;\n  visibility: visible;\n}\n.__react_component_tooltip.type-dark {\n  color: #fff;\n  background-color: #222;\n}\n.__react_component_tooltip.type-dark.place-top:after {\n  border-top-color: #222;\n  border-top-style: solid;\n  border-top-width: 6px;\n}\n.__react_component_tooltip.type-dark.place-bottom:after {\n  border-bottom-color: #222;\n  border-bottom-style: solid;\n  border-bottom-width: 6px;\n}\n.__react_component_tooltip.type-dark.place-left:after {\n  border-left-color: #222;\n  border-left-style: solid;\n  border-left-width: 6px;\n}\n.__react_component_tooltip.type-dark.place-right:after {\n  border-right-color: #222;\n  border-right-style: solid;\n  border-right-width: 6px;\n}\n.__react_component_tooltip.type-dark.border {\n  border: 1px solid #fff;\n}\n.__react_component_tooltip.type-dark.border.place-top:before {\n  border-top: 8px solid #fff;\n}\n.__react_component_tooltip.type-dark.border.place-bottom:before {\n  border-bottom: 8px solid #fff;\n}\n.__react_component_tooltip.type-dark.border.place-left:before {\n  border-left: 8px solid #fff;\n}\n.__react_component_tooltip.type-dark.border.place-right:before {\n  border-right: 8px solid #fff;\n}\n.__react_component_tooltip.type-success {\n  color: #fff;\n  background-color: #8DC572;\n}\n.__react_component_tooltip.type-success.place-top:after {\n  border-top-color: #8DC572;\n  border-top-style: solid;\n  border-top-width: 6px;\n}\n.__react_component_tooltip.type-success.place-bottom:after {\n  border-bottom-color: #8DC572;\n  border-bottom-style: solid;\n  border-bottom-width: 6px;\n}\n.__react_component_tooltip.type-success.place-left:after {\n  border-left-color: #8DC572;\n  border-left-style: solid;\n  border-left-width: 6px;\n}\n.__react_component_tooltip.type-success.place-right:after {\n  border-right-color: #8DC572;\n  border-right-style: solid;\n  border-right-width: 6px;\n}\n.__react_component_tooltip.type-success.border {\n  border: 1px solid #fff;\n}\n.__react_component_tooltip.type-success.border.place-top:before {\n  border-top: 8px solid #fff;\n}\n.__react_component_tooltip.type-success.border.place-bottom:before {\n  border-bottom: 8px solid #fff;\n}\n.__react_component_tooltip.type-success.border.place-left:before {\n  border-left: 8px solid #fff;\n}\n.__react_component_tooltip.type-success.border.place-right:before {\n  border-right: 8px solid #fff;\n}\n.__react_component_tooltip.type-warning {\n  color: #fff;\n  background-color: #F0AD4E;\n}\n.__react_component_tooltip.type-warning.place-top:after {\n  border-top-color: #F0AD4E;\n  border-top-style: solid;\n  border-top-width: 6px;\n}\n.__react_component_tooltip.type-warning.place-bottom:after {\n  border-bottom-color: #F0AD4E;\n  border-bottom-style: solid;\n  border-bottom-width: 6px;\n}\n.__react_component_tooltip.type-warning.place-left:after {\n  border-left-color: #F0AD4E;\n  border-left-style: solid;\n  border-left-width: 6px;\n}\n.__react_component_tooltip.type-warning.place-right:after {\n  border-right-color: #F0AD4E;\n  border-right-style: solid;\n  border-right-width: 6px;\n}\n.__react_component_tooltip.type-warning.border {\n  border: 1px solid #fff;\n}\n.__react_component_tooltip.type-warning.border.place-top:before {\n  border-top: 8px solid #fff;\n}\n.__react_component_tooltip.type-warning.border.place-bottom:before {\n  border-bottom: 8px solid #fff;\n}\n.__react_component_tooltip.type-warning.border.place-left:before {\n  border-left: 8px solid #fff;\n}\n.__react_component_tooltip.type-warning.border.place-right:before {\n  border-right: 8px solid #fff;\n}\n.__react_component_tooltip.type-error {\n  color: #fff;\n  background-color: #BE6464;\n}\n.__react_component_tooltip.type-error.place-top:after {\n  border-top-color: #BE6464;\n  border-top-style: solid;\n  border-top-width: 6px;\n}\n.__react_component_tooltip.type-error.place-bottom:after {\n  border-bottom-color: #BE6464;\n  border-bottom-style: solid;\n  border-bottom-width: 6px;\n}\n.__react_component_tooltip.type-error.place-left:after {\n  border-left-color: #BE6464;\n  border-left-style: solid;\n  border-left-width: 6px;\n}\n.__react_component_tooltip.type-error.place-right:after {\n  border-right-color: #BE6464;\n  border-right-style: solid;\n  border-right-width: 6px;\n}\n.__react_component_tooltip.type-error.border {\n  border: 1px solid #fff;\n}\n.__react_component_tooltip.type-error.border.place-top:before {\n  border-top: 8px solid #fff;\n}\n.__react_component_tooltip.type-error.border.place-bottom:before {\n  border-bottom: 8px solid #fff;\n}\n.__react_component_tooltip.type-error.border.place-left:before {\n  border-left: 8px solid #fff;\n}\n.__react_component_tooltip.type-error.border.place-right:before {\n  border-right: 8px solid #fff;\n}\n.__react_component_tooltip.type-info {\n  color: #fff;\n  background-color: #337AB7;\n}\n.__react_component_tooltip.type-info.place-top:after {\n  border-top-color: #337AB7;\n  border-top-style: solid;\n  border-top-width: 6px;\n}\n.__react_component_tooltip.type-info.place-bottom:after {\n  border-bottom-color: #337AB7;\n  border-bottom-style: solid;\n  border-bottom-width: 6px;\n}\n.__react_component_tooltip.type-info.place-left:after {\n  border-left-color: #337AB7;\n  border-left-style: solid;\n  border-left-width: 6px;\n}\n.__react_component_tooltip.type-info.place-right:after {\n  border-right-color: #337AB7;\n  border-right-style: solid;\n  border-right-width: 6px;\n}\n.__react_component_tooltip.type-info.border {\n  border: 1px solid #fff;\n}\n.__react_component_tooltip.type-info.border.place-top:before {\n  border-top: 8px solid #fff;\n}\n.__react_component_tooltip.type-info.border.place-bottom:before {\n  border-bottom: 8px solid #fff;\n}\n.__react_component_tooltip.type-info.border.place-left:before {\n  border-left: 8px solid #fff;\n}\n.__react_component_tooltip.type-info.border.place-right:before {\n  border-right: 8px solid #fff;\n}\n.__react_component_tooltip.type-light {\n  color: #222;\n  background-color: #fff;\n}\n.__react_component_tooltip.type-light.place-top:after {\n  border-top-color: #fff;\n  border-top-style: solid;\n  border-top-width: 6px;\n}\n.__react_component_tooltip.type-light.place-bottom:after {\n  border-bottom-color: #fff;\n  border-bottom-style: solid;\n  border-bottom-width: 6px;\n}\n.__react_component_tooltip.type-light.place-left:after {\n  border-left-color: #fff;\n  border-left-style: solid;\n  border-left-width: 6px;\n}\n.__react_component_tooltip.type-light.place-right:after {\n  border-right-color: #fff;\n  border-right-style: solid;\n  border-right-width: 6px;\n}\n.__react_component_tooltip.type-light.border {\n  border: 1px solid #222;\n}\n.__react_component_tooltip.type-light.border.place-top:before {\n  border-top: 8px solid #222;\n}\n.__react_component_tooltip.type-light.border.place-bottom:before {\n  border-bottom: 8px solid #222;\n}\n.__react_component_tooltip.type-light.border.place-left:before {\n  border-left: 8px solid #222;\n}\n.__react_component_tooltip.type-light.border.place-right:before {\n  border-right: 8px solid #222;\n}\n.__react_component_tooltip.place-top {\n  margin-top: -10px;\n}\n.__react_component_tooltip.place-top:before {\n  border-left: 10px solid transparent;\n  border-right: 10px solid transparent;\n  bottom: -8px;\n  left: 50%;\n  margin-left: -10px;\n}\n.__react_component_tooltip.place-top:after {\n  border-left: 8px solid transparent;\n  border-right: 8px solid transparent;\n  bottom: -6px;\n  left: 50%;\n  margin-left: -8px;\n}\n.__react_component_tooltip.place-bottom {\n  margin-top: 10px;\n}\n.__react_component_tooltip.place-bottom:before {\n  border-left: 10px solid transparent;\n  border-right: 10px solid transparent;\n  top: -8px;\n  left: 50%;\n  margin-left: -10px;\n}\n.__react_component_tooltip.place-bottom:after {\n  border-left: 8px solid transparent;\n  border-right: 8px solid transparent;\n  top: -6px;\n  left: 50%;\n  margin-left: -8px;\n}\n.__react_component_tooltip.place-left {\n  margin-left: -10px;\n}\n.__react_component_tooltip.place-left:before {\n  border-top: 6px solid transparent;\n  border-bottom: 6px solid transparent;\n  right: -8px;\n  top: 50%;\n  margin-top: -5px;\n}\n.__react_component_tooltip.place-left:after {\n  border-top: 5px solid transparent;\n  border-bottom: 5px solid transparent;\n  right: -6px;\n  top: 50%;\n  margin-top: -4px;\n}\n.__react_component_tooltip.place-right {\n  margin-left: 10px;\n}\n.__react_component_tooltip.place-right:before {\n  border-top: 6px solid transparent;\n  border-bottom: 6px solid transparent;\n  left: -8px;\n  top: 50%;\n  margin-top: -5px;\n}\n.__react_component_tooltip.place-right:after {\n  border-top: 5px solid transparent;\n  border-bottom: 5px solid transparent;\n  left: -6px;\n  top: 50%;\n  margin-top: -4px;\n}\n.__react_component_tooltip .multi-line {\n  display: block;\n  padding: 2px 0px;\n  text-align: center;\n}');var ReactTooltip=staticMethods(_class=windowListener(_class=customEvent(_class=isCapture(_class=getEffect(_class=bodyMode(_class=trackRemoval((_temp=_class2=function(_React$Component){function ReactTooltip(props){var _this;return _classCallCheck(this,ReactTooltip),(_this=_possibleConstructorReturn(this,_getPrototypeOf(ReactTooltip).call(this,props))).state={place:props.place||"top",desiredPlace:props.place||"top",type:"dark",effect:"float",show:!1,border:!1,offset:{},extraClass:"",html:!1,delayHide:0,delayShow:0,event:props.event||null,eventOff:props.eventOff||null,currentEvent:null,currentTarget:null,ariaProps:parseAria(props),isEmptyTip:!1,disable:!1,possibleCustomEvents:props.possibleCustomEvents||"",possibleCustomEventsOff:props.possibleCustomEventsOff||"",originTooltip:null,isMultiline:!1},_this.bind(["showTooltip","updateTooltip","hideTooltip","hideTooltipOnScroll","getTooltipContent","globalRebuild","globalShow","globalHide","onWindowResize","mouseOnToolTip"]),_this.mount=!0,_this.delayShowLoop=null,_this.delayHideLoop=null,_this.delayReshow=null,_this.intervalUpdateContent=null,_this}return _inherits(ReactTooltip,_React$Component),_createClass(ReactTooltip,[{key:"bind",value:function bind(methodArray){var _this2=this;methodArray.forEach((function(method){_this2[method]=_this2[method].bind(_this2)}))}},{key:"componentDidMount",value:function componentDidMount(){var _this$props=this.props,insecure=_this$props.insecure,resizeHide=_this$props.resizeHide;this.bindListener(),this.bindWindowEvents(resizeHide)}},{key:"componentWillUnmount",value:function componentWillUnmount(){this.mount=!1,this.clearTimer(),this.unbindListener(),this.removeScrollListener(),this.unbindWindowEvents()}},{key:"mouseOnToolTip",value:function mouseOnToolTip(){var show;return!(!this.state.show||!this.tooltipRef)&&(this.tooltipRef.matches||(this.tooltipRef.msMatchesSelector?this.tooltipRef.matches=this.tooltipRef.msMatchesSelector:this.tooltipRef.matches=this.tooltipRef.mozMatchesSelector),this.tooltipRef.matches(":hover"))}},{key:"getTargetArray",value:function getTargetArray(id){var targetArray;if(id){var escaped=id.replace(/\\/g,"\\\\").replace(/"/g,'\\"');targetArray=document.querySelectorAll('[data-tip][data-for="'.concat(escaped,'"]'))}else targetArray=document.querySelectorAll("[data-tip]:not([data-for])");return nodeListToArray(targetArray)}},{key:"bindListener",value:function bindListener(){var _this3=this,_this$props2=this.props,id=_this$props2.id,globalEventOff=_this$props2.globalEventOff,isCapture=_this$props2.isCapture,targetArray=this.getTargetArray(id);targetArray.forEach((function(target){null===target.getAttribute("currentItem")&&target.setAttribute("currentItem","false"),_this3.unbindBasicListener(target),_this3.isCustomEvent(target)&&_this3.customUnbindListener(target)})),this.isBodyMode()?this.bindBodyListener(targetArray):targetArray.forEach((function(target){var isCaptureMode=_this3.isCapture(target),effect=_this3.getEffect(target);_this3.isCustomEvent(target)?_this3.customBindListener(target):(target.addEventListener("mouseenter",_this3.showTooltip,isCaptureMode),"float"===effect&&target.addEventListener("mousemove",_this3.updateTooltip,isCaptureMode),target.addEventListener("mouseleave",_this3.hideTooltip,isCaptureMode))})),globalEventOff&&(window.removeEventListener(globalEventOff,this.hideTooltip),window.addEventListener(globalEventOff,this.hideTooltip,isCapture)),this.bindRemovalTracker()}},{key:"unbindListener",value:function unbindListener(){var _this4=this,_this$props3=this.props,id=_this$props3.id,globalEventOff=_this$props3.globalEventOff,targetArray;this.isBodyMode()?this.unbindBodyListener():this.getTargetArray(id).forEach((function(target){_this4.unbindBasicListener(target),_this4.isCustomEvent(target)&&_this4.customUnbindListener(target)}));globalEventOff&&window.removeEventListener(globalEventOff,this.hideTooltip),this.unbindRemovalTracker()}},{key:"unbindBasicListener",value:function unbindBasicListener(target){var isCaptureMode=this.isCapture(target);target.removeEventListener("mouseenter",this.showTooltip,isCaptureMode),target.removeEventListener("mousemove",this.updateTooltip,isCaptureMode),target.removeEventListener("mouseleave",this.hideTooltip,isCaptureMode)}},{key:"getTooltipContent",value:function getTooltipContent(){var _this$props4=this.props,getContent=_this$props4.getContent,children=_this$props4.children,content;return getContent&&(content=Array.isArray(getContent)?getContent[0]&&getContent[0](this.state.originTooltip):getContent(this.state.originTooltip)),getTipContent(this.state.originTooltip,children,content,this.state.isMultiline)}},{key:"isEmptyTip",value:function isEmptyTip(placeholder){return"string"==typeof placeholder&&""===placeholder||null===placeholder}},{key:"showTooltip",value:function showTooltip(e,isGlobalCall){var targetArray,isMyElement;if(isGlobalCall&&!this.getTargetArray(this.props.id).some((function(ele){return ele===e.currentTarget})))return;var _this$props5=this.props,multiline=_this$props5.multiline,getContent=_this$props5.getContent,originTooltip=e.currentTarget.getAttribute("data-tip"),isMultiline=e.currentTarget.getAttribute("data-multiline")||multiline||!1,switchToSolid=e instanceof window.FocusEvent||isGlobalCall,scrollHide=!0;e.currentTarget.getAttribute("data-scroll-hide")?scrollHide="true"===e.currentTarget.getAttribute("data-scroll-hide"):null!=this.props.scrollHide&&(scrollHide=this.props.scrollHide);var desiredPlace=e.currentTarget.getAttribute("data-place")||this.props.place||"top",effect=switchToSolid?"solid":this.getEffect(e.currentTarget),offset=e.currentTarget.getAttribute("data-offset")||this.props.offset||{},result=getPosition(e,e.currentTarget,this.tooltipRef,desiredPlace,desiredPlace,effect,offset);result.position&&this.props.overridePosition&&(result.position=this.props.overridePosition(result.position,e.currentTarget,this.tooltipRef,desiredPlace,desiredPlace,effect,offset));var place=result.isNewState?result.newState.place:desiredPlace;this.clearTimer();var target=e.currentTarget,reshowDelay=this.state.show?target.getAttribute("data-delay-update")||this.props.delayUpdate:0,self=this,updateState=function updateState(){self.setState({originTooltip:originTooltip,isMultiline:isMultiline,desiredPlace:desiredPlace,place:place,type:target.getAttribute("data-type")||self.props.type||"dark",effect:effect,offset:offset,html:target.getAttribute("data-html")?"true"===target.getAttribute("data-html"):self.props.html||!1,delayShow:target.getAttribute("data-delay-show")||self.props.delayShow||0,delayHide:target.getAttribute("data-delay-hide")||self.props.delayHide||0,delayUpdate:target.getAttribute("data-delay-update")||self.props.delayUpdate||0,border:target.getAttribute("data-border")?"true"===target.getAttribute("data-border"):self.props.border||!1,extraClass:target.getAttribute("data-class")||self.props.class||self.props.className||"",disable:target.getAttribute("data-tip-disable")?"true"===target.getAttribute("data-tip-disable"):self.props.disable||!1,currentTarget:target},(function(){scrollHide&&self.addScrollListener(self.state.currentTarget),self.updateTooltip(e),getContent&&Array.isArray(getContent)&&(self.intervalUpdateContent=setInterval((function(){if(self.mount){var _getContent=self.props.getContent,placeholder=getTipContent(originTooltip,"",_getContent[0](),isMultiline),isEmptyTip=self.isEmptyTip(placeholder);self.setState({isEmptyTip:isEmptyTip}),self.updatePosition()}}),getContent[1]))}))};reshowDelay?this.delayReshow=setTimeout(updateState,reshowDelay):updateState()}},{key:"updateTooltip",value:function updateTooltip(e){var _this5=this,_this$state=this.state,delayShow=_this$state.delayShow,disable=_this$state.disable,afterShow=this.props.afterShow,placeholder=this.getTooltipContent(),delayTime=parseInt(delayShow,10),eventTarget=e.currentTarget||e.target;if(!this.mouseOnToolTip()&&!this.isEmptyTip(placeholder)&&!disable){var updateState=function updateState(){if(Array.isArray(placeholder)&&placeholder.length>0||placeholder){var isInvisible=!_this5.state.show;_this5.setState({currentEvent:e,currentTarget:eventTarget,show:!0},(function(){_this5.updatePosition(),isInvisible&&afterShow&&afterShow(e)}))}};clearTimeout(this.delayShowLoop),delayShow?this.delayShowLoop=setTimeout(updateState,delayTime):updateState()}}},{key:"listenForTooltipExit",value:function listenForTooltipExit(){var show;this.state.show&&this.tooltipRef&&this.tooltipRef.addEventListener("mouseleave",this.hideTooltip)}},{key:"removeListenerForTooltipExit",value:function removeListenerForTooltipExit(){var show;this.state.show&&this.tooltipRef&&this.tooltipRef.removeEventListener("mouseleave",this.hideTooltip)}},{key:"hideTooltip",value:function hideTooltip(e,hasTarget){var _this6=this,options=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{isScroll:!1},disable=this.state.disable,isScroll=options.isScroll,delayHide=isScroll?0:this.state.delayHide,afterHide=this.props.afterHide,placeholder=this.getTooltipContent();if(this.mount&&!this.isEmptyTip(placeholder)&&!disable){if(hasTarget){var targetArray=this.getTargetArray(this.props.id),isMyElement=targetArray.some((function(ele){return ele===e.currentTarget}));if(!isMyElement||!this.state.show)return}var resetState=function resetState(){var isVisible=_this6.state.show;_this6.mouseOnToolTip()?_this6.listenForTooltipExit():(_this6.removeListenerForTooltipExit(),_this6.setState({show:!1},(function(){_this6.removeScrollListener(),isVisible&&afterHide&&afterHide(e)})))};this.clearTimer(),delayHide?this.delayHideLoop=setTimeout(resetState,parseInt(delayHide,10)):resetState()}}},{key:"hideTooltipOnScroll",value:function hideTooltipOnScroll(event,hasTarget){this.hideTooltip(event,hasTarget,{isScroll:!0})}},{key:"addScrollListener",value:function addScrollListener(currentTarget){var isCaptureMode=this.isCapture(currentTarget);window.addEventListener("scroll",this.hideTooltipOnScroll,isCaptureMode)}},{key:"removeScrollListener",value:function removeScrollListener(){window.removeEventListener("scroll",this.hideTooltipOnScroll)}},{key:"updatePosition",value:function updatePosition(){var _this7=this,_this$state2=this.state,currentEvent=_this$state2.currentEvent,currentTarget=_this$state2.currentTarget,place=_this$state2.place,desiredPlace=_this$state2.desiredPlace,effect=_this$state2.effect,offset=_this$state2.offset,node=this.tooltipRef,result=getPosition(currentEvent,currentTarget,node,place,desiredPlace,effect,offset);if(result.position&&this.props.overridePosition&&(result.position=this.props.overridePosition(result.position,currentEvent,currentTarget,node,place,desiredPlace,effect,offset)),result.isNewState)return this.setState(result.newState,(function(){_this7.updatePosition()}));node.style.left=result.position.left+"px",node.style.top=result.position.top+"px"}},{key:"clearTimer",value:function clearTimer(){clearTimeout(this.delayShowLoop),clearTimeout(this.delayHideLoop),clearTimeout(this.delayReshow),clearInterval(this.intervalUpdateContent)}},{key:"render",value:function render(){var _this8=this,_this$state3=this.state,extraClass=_this$state3.extraClass,html=_this$state3.html,ariaProps=_this$state3.ariaProps,disable=_this$state3.disable,placeholder=this.getTooltipContent(),isEmptyTip=this.isEmptyTip(placeholder),tooltipClass="__react_component_tooltip"+(!this.state.show||disable||isEmptyTip?"":" show")+(this.state.border?" border":"")+" place-".concat(this.state.place)+" type-".concat(this.state.type)+(this.props.delayUpdate?" allow_hover":"")+(this.props.clickable?" allow_click":""),Wrapper=this.props.wrapper;ReactTooltip.supportedWrappers.indexOf(Wrapper)<0&&(Wrapper=ReactTooltip.defaultProps.wrapper);var wrapperClassName=[tooltipClass,extraClass].filter(Boolean).join(" ");return html?React.createElement(Wrapper,_extends({className:wrapperClassName,id:this.props.id,ref:function ref(_ref){return _this8.tooltipRef=_ref}},ariaProps,{"data-id":"tooltip",dangerouslySetInnerHTML:{__html:placeholder}})):React.createElement(Wrapper,_extends({className:wrapperClassName,id:this.props.id},ariaProps,{ref:function ref(_ref2){return _this8.tooltipRef=_ref2},"data-id":"tooltip"}),placeholder)}}],[{key:"getDerivedStateFromProps",value:function getDerivedStateFromProps(nextProps,prevState){var ariaProps=prevState.ariaProps,newAriaProps=parseAria(nextProps),isChanged;return Object.keys(newAriaProps).some((function(props){return newAriaProps[props]!==ariaProps[props]}))?_objectSpread2({},prevState,{ariaProps:newAriaProps}):null}}]),ReactTooltip}(React.Component),_defineProperty(_class2,"propTypes",{children:propTypes.any,place:propTypes.string,type:propTypes.string,effect:propTypes.string,offset:propTypes.object,multiline:propTypes.bool,border:propTypes.bool,insecure:propTypes.bool,class:propTypes.string,className:propTypes.string,id:propTypes.string,html:propTypes.bool,delayHide:propTypes.number,delayUpdate:propTypes.number,delayShow:propTypes.number,event:propTypes.string,eventOff:propTypes.string,watchWindow:propTypes.bool,isCapture:propTypes.bool,globalEventOff:propTypes.string,getContent:propTypes.any,afterShow:propTypes.func,afterHide:propTypes.func,overridePosition:propTypes.func,disable:propTypes.bool,scrollHide:propTypes.bool,resizeHide:propTypes.bool,wrapper:propTypes.string,bodyMode:propTypes.bool,possibleCustomEvents:propTypes.string,possibleCustomEventsOff:propTypes.string,clickable:propTypes.bool}),_defineProperty(_class2,"defaultProps",{insecure:!0,resizeHide:!0,wrapper:"div",clickable:!1}),_defineProperty(_class2,"supportedWrappers",["div","span"]),_defineProperty(_class2,"displayName","ReactTooltip"),_class=_temp))||_class)||_class)||_class)||_class)||_class)||_class)||_class;module.exports=ReactTooltip}).call(this)}).call(this,require("_process"))},{_process:422,react:483}],471:[function(require,module,exports){"use strict";exports.__esModule=!0,exports.default=void 0;var _propTypes=_interopRequireDefault(require("prop-types")),_addClass2=_interopRequireDefault(require("dom-helpers/addClass")),_removeClass=_interopRequireDefault(require("dom-helpers/removeClass")),_react=_interopRequireDefault(require("react")),_Transition=_interopRequireDefault(require("./Transition")),_PropTypes=require("./utils/PropTypes");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _extends(){return(_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target}).apply(this,arguments)}function _objectWithoutPropertiesLoose(source,excluded){if(null==source)return{};var target={},sourceKeys=Object.keys(source),key,i;for(i=0;i<sourceKeys.length;i++)key=sourceKeys[i],excluded.indexOf(key)>=0||(target[key]=source[key]);return target}function _inheritsLoose(subClass,superClass){subClass.prototype=Object.create(superClass.prototype),subClass.prototype.constructor=subClass,subClass.__proto__=superClass}var _addClass=function addClass(node,classes){return node&&classes&&classes.split(" ").forEach((function(c){return(0,_addClass2.default)(node,c)}))},removeClass=function removeClass(node,classes){return node&&classes&&classes.split(" ").forEach((function(c){return(0,_removeClass.default)(node,c)}))},CSSTransition=function(_React$Component){function CSSTransition(){for(var _this,_len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];return(_this=_React$Component.call.apply(_React$Component,[this].concat(args))||this).appliedClasses={appear:{},enter:{},exit:{}},_this.onEnter=function(maybeNode,maybeAppearing){var _this$resolveArgument=_this.resolveArguments(maybeNode,maybeAppearing),node=_this$resolveArgument[0],appearing=_this$resolveArgument[1];_this.removeClasses(node,"exit"),_this.addClass(node,appearing?"appear":"enter","base"),_this.props.onEnter&&_this.props.onEnter(maybeNode,maybeAppearing)},_this.onEntering=function(maybeNode,maybeAppearing){var _this$resolveArgument2=_this.resolveArguments(maybeNode,maybeAppearing),node=_this$resolveArgument2[0],appearing,type=_this$resolveArgument2[1]?"appear":"enter";_this.addClass(node,type,"active"),_this.props.onEntering&&_this.props.onEntering(maybeNode,maybeAppearing)},_this.onEntered=function(maybeNode,maybeAppearing){var _this$resolveArgument3=_this.resolveArguments(maybeNode,maybeAppearing),node=_this$resolveArgument3[0],appearing,type=_this$resolveArgument3[1]?"appear":"enter";_this.removeClasses(node,type),_this.addClass(node,type,"done"),_this.props.onEntered&&_this.props.onEntered(maybeNode,maybeAppearing)},_this.onExit=function(maybeNode){var _this$resolveArgument4,node=_this.resolveArguments(maybeNode)[0];_this.removeClasses(node,"appear"),_this.removeClasses(node,"enter"),_this.addClass(node,"exit","base"),_this.props.onExit&&_this.props.onExit(maybeNode)},_this.onExiting=function(maybeNode){var _this$resolveArgument5,node=_this.resolveArguments(maybeNode)[0];_this.addClass(node,"exit","active"),_this.props.onExiting&&_this.props.onExiting(maybeNode)},_this.onExited=function(maybeNode){var _this$resolveArgument6,node=_this.resolveArguments(maybeNode)[0];_this.removeClasses(node,"exit"),_this.addClass(node,"exit","done"),_this.props.onExited&&_this.props.onExited(maybeNode)},_this.resolveArguments=function(maybeNode,maybeAppearing){return _this.props.nodeRef?[_this.props.nodeRef.current,maybeNode]:[maybeNode,maybeAppearing]},_this.getClassNames=function(type){var classNames=_this.props.classNames,isStringClassNames="string"==typeof classNames,prefix,baseClassName=isStringClassNames?""+(isStringClassNames&&classNames?classNames+"-":"")+type:classNames[type],activeClassName,doneClassName;return{baseClassName:baseClassName,activeClassName:isStringClassNames?baseClassName+"-active":classNames[type+"Active"],doneClassName:isStringClassNames?baseClassName+"-done":classNames[type+"Done"]}},_this}_inheritsLoose(CSSTransition,_React$Component);var _proto=CSSTransition.prototype;return _proto.addClass=function addClass(node,type,phase){var className=this.getClassNames(type)[phase+"ClassName"],_this$getClassNames,doneClassName=this.getClassNames("enter").doneClassName;"appear"===type&&"done"===phase&&doneClassName&&(className+=" "+doneClassName),"active"===phase&&node&&node.scrollTop,className&&(this.appliedClasses[type][phase]=className,_addClass(node,className))},_proto.removeClasses=function removeClasses(node,type){var _this$appliedClasses$=this.appliedClasses[type],baseClassName=_this$appliedClasses$.base,activeClassName=_this$appliedClasses$.active,doneClassName=_this$appliedClasses$.done;this.appliedClasses[type]={},baseClassName&&removeClass(node,baseClassName),activeClassName&&removeClass(node,activeClassName),doneClassName&&removeClass(node,doneClassName)},_proto.render=function render(){var _this$props=this.props,_=_this$props.classNames,props=_objectWithoutPropertiesLoose(_this$props,["classNames"]);return(_react.default.createElement(_Transition.default,_extends({},props,{onEnter:this.onEnter,onEntered:this.onEntered,onEntering:this.onEntering,onExit:this.onExit,onExiting:this.onExiting,onExited:this.onExited})))},CSSTransition}(_react.default.Component);CSSTransition.defaultProps={classNames:""},CSSTransition.propTypes=_extends({},_Transition.default.propTypes,{classNames:_PropTypes.classNamesShape,onEnter:_propTypes.default.func,onEntering:_propTypes.default.func,onEntered:_propTypes.default.func,onExit:_propTypes.default.func,onExiting:_propTypes.default.func,onExited:_propTypes.default.func});var _default=CSSTransition;exports.default=_default,module.exports=exports.default},{"./Transition":474,"./utils/PropTypes":480,"dom-helpers/addClass":262,"dom-helpers/removeClass":264,"prop-types":426,react:483}],472:[function(require,module,exports){"use strict";exports.__esModule=!0,exports.default=void 0;var _propTypes=_interopRequireDefault(require("prop-types")),_react=_interopRequireDefault(require("react")),_reactDom=_interopRequireDefault(require("react-dom")),_TransitionGroup=_interopRequireDefault(require("./TransitionGroup"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _objectWithoutPropertiesLoose(source,excluded){if(null==source)return{};var target={},sourceKeys=Object.keys(source),key,i;for(i=0;i<sourceKeys.length;i++)key=sourceKeys[i],excluded.indexOf(key)>=0||(target[key]=source[key]);return target}function _inheritsLoose(subClass,superClass){subClass.prototype=Object.create(superClass.prototype),subClass.prototype.constructor=subClass,subClass.__proto__=superClass}var ReplaceTransition=function(_React$Component){function ReplaceTransition(){for(var _this,_len=arguments.length,_args=new Array(_len),_key=0;_key<_len;_key++)_args[_key]=arguments[_key];return(_this=_React$Component.call.apply(_React$Component,[this].concat(_args))||this).handleEnter=function(){for(var _len2=arguments.length,args=new Array(_len2),_key2=0;_key2<_len2;_key2++)args[_key2]=arguments[_key2];return _this.handleLifecycle("onEnter",0,args)},_this.handleEntering=function(){for(var _len3=arguments.length,args=new Array(_len3),_key3=0;_key3<_len3;_key3++)args[_key3]=arguments[_key3];return _this.handleLifecycle("onEntering",0,args)},_this.handleEntered=function(){for(var _len4=arguments.length,args=new Array(_len4),_key4=0;_key4<_len4;_key4++)args[_key4]=arguments[_key4];return _this.handleLifecycle("onEntered",0,args)},_this.handleExit=function(){for(var _len5=arguments.length,args=new Array(_len5),_key5=0;_key5<_len5;_key5++)args[_key5]=arguments[_key5];return _this.handleLifecycle("onExit",1,args)},_this.handleExiting=function(){for(var _len6=arguments.length,args=new Array(_len6),_key6=0;_key6<_len6;_key6++)args[_key6]=arguments[_key6];return _this.handleLifecycle("onExiting",1,args)},_this.handleExited=function(){for(var _len7=arguments.length,args=new Array(_len7),_key7=0;_key7<_len7;_key7++)args[_key7]=arguments[_key7];return _this.handleLifecycle("onExited",1,args)},_this}_inheritsLoose(ReplaceTransition,_React$Component);var _proto=ReplaceTransition.prototype;return _proto.handleLifecycle=function handleLifecycle(handler,idx,originalArgs){var _child$props,children=this.props.children,child=_react.default.Children.toArray(children)[idx];if(child.props[handler]&&(_child$props=child.props)[handler].apply(_child$props,originalArgs),this.props[handler]){var maybeNode=child.props.nodeRef?void 0:_reactDom.default.findDOMNode(this);this.props[handler](maybeNode)}},_proto.render=function render(){var _this$props=this.props,children=_this$props.children,inProp=_this$props.in,props=_objectWithoutPropertiesLoose(_this$props,["children","in"]),_React$Children$toArr=_react.default.Children.toArray(children),first=_React$Children$toArr[0],second=_React$Children$toArr[1];return delete props.onEnter,delete props.onEntering,delete props.onEntered,delete props.onExit,delete props.onExiting,delete props.onExited,_react.default.createElement(_TransitionGroup.default,props,inProp?_react.default.cloneElement(first,{key:"first",onEnter:this.handleEnter,onEntering:this.handleEntering,onEntered:this.handleEntered}):_react.default.cloneElement(second,{key:"second",onEnter:this.handleExit,onEntering:this.handleExiting,onEntered:this.handleExited}))},ReplaceTransition}(_react.default.Component);ReplaceTransition.propTypes={in:_propTypes.default.bool.isRequired,children:function children(props,propName){return 2!==_react.default.Children.count(props[propName])?new Error('"'+propName+'" must be exactly two transition components.'):null}};var _default=ReplaceTransition;exports.default=_default,module.exports=exports.default},{"./TransitionGroup":475,"prop-types":426,react:483,"react-dom":440}],473:[function(require,module,exports){"use strict";exports.__esModule=!0,exports.default=exports.modes=void 0;var _react=_interopRequireDefault(require("react")),_propTypes=_interopRequireDefault(require("prop-types")),_Transition=require("./Transition"),_TransitionGroupContext=_interopRequireDefault(require("./TransitionGroupContext")),_leaveRenders,_enterRenders;function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _inheritsLoose(subClass,superClass){subClass.prototype=Object.create(superClass.prototype),subClass.prototype.constructor=subClass,subClass.__proto__=superClass}function areChildrenDifferent(oldChildren,newChildren){return oldChildren!==newChildren&&(!_react.default.isValidElement(oldChildren)||!_react.default.isValidElement(newChildren)||null==oldChildren.key||oldChildren.key!==newChildren.key)}var modes={out:"out-in",in:"in-out"};exports.modes=modes;var callHook=function callHook(element,name,cb){return function(){var _element$props;element.props[name]&&(_element$props=element.props)[name].apply(_element$props,arguments),cb()}},leaveRenders=((_leaveRenders={})[modes.out]=function(_ref){var current=_ref.current,changeState=_ref.changeState;return _react.default.cloneElement(current,{in:!1,onExited:callHook(current,"onExited",(function(){changeState(_Transition.ENTERING,null)}))})},_leaveRenders[modes.in]=function(_ref2){var current=_ref2.current,changeState=_ref2.changeState,children=_ref2.children;return[current,_react.default.cloneElement(children,{in:!0,onEntered:callHook(children,"onEntered",(function(){changeState(_Transition.ENTERING)}))})]},_leaveRenders),enterRenders=((_enterRenders={})[modes.out]=function(_ref3){var children=_ref3.children,changeState=_ref3.changeState;return _react.default.cloneElement(children,{in:!0,onEntered:callHook(children,"onEntered",(function(){changeState(_Transition.ENTERED,_react.default.cloneElement(children,{in:!0}))}))})},_enterRenders[modes.in]=function(_ref4){var current=_ref4.current,children=_ref4.children,changeState=_ref4.changeState;return[_react.default.cloneElement(current,{in:!1,onExited:callHook(current,"onExited",(function(){changeState(_Transition.ENTERED,_react.default.cloneElement(children,{in:!0}))}))}),_react.default.cloneElement(children,{in:!0})]},_enterRenders),SwitchTransition=function(_React$Component){function SwitchTransition(){for(var _this,_len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];return(_this=_React$Component.call.apply(_React$Component,[this].concat(args))||this).state={status:_Transition.ENTERED,current:null},_this.appeared=!1,_this.changeState=function(status,current){void 0===current&&(current=_this.state.current),_this.setState({status:status,current:current})},_this}_inheritsLoose(SwitchTransition,_React$Component);var _proto=SwitchTransition.prototype;return _proto.componentDidMount=function componentDidMount(){this.appeared=!0},SwitchTransition.getDerivedStateFromProps=function getDerivedStateFromProps(props,state){return null==props.children?{current:null}:state.status===_Transition.ENTERING&&props.mode===modes.in?{status:_Transition.ENTERING}:state.current&&areChildrenDifferent(state.current,props.children)?{status:_Transition.EXITING}:{current:_react.default.cloneElement(props.children,{in:!0})}},_proto.render=function render(){var _this$props=this.props,children=_this$props.children,mode=_this$props.mode,_this$state=this.state,status=_this$state.status,current=_this$state.current,data={children:children,current:current,changeState:this.changeState,status:status},component;switch(status){case _Transition.ENTERING:component=enterRenders[mode](data);break;case _Transition.EXITING:component=leaveRenders[mode](data);break;case _Transition.ENTERED:component=current}return(_react.default.createElement(_TransitionGroupContext.default.Provider,{value:{isMounting:!this.appeared}},component))},SwitchTransition}(_react.default.Component);SwitchTransition.propTypes={mode:_propTypes.default.oneOf([modes.in,modes.out]),children:_propTypes.default.oneOfType([_propTypes.default.element.isRequired])},SwitchTransition.defaultProps={mode:modes.out};var _default=SwitchTransition;exports.default=_default},{"./Transition":474,"./TransitionGroupContext":476,"prop-types":426,react:483}],474:[function(require,module,exports){"use strict";exports.__esModule=!0,exports.default=exports.EXITING=exports.ENTERED=exports.ENTERING=exports.EXITED=exports.UNMOUNTED=void 0;var _propTypes=_interopRequireDefault(require("prop-types")),_react=_interopRequireDefault(require("react")),_reactDom=_interopRequireDefault(require("react-dom")),_config=_interopRequireDefault(require("./config")),_PropTypes=require("./utils/PropTypes"),_TransitionGroupContext=_interopRequireDefault(require("./TransitionGroupContext"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _objectWithoutPropertiesLoose(source,excluded){if(null==source)return{};var target={},sourceKeys=Object.keys(source),key,i;for(i=0;i<sourceKeys.length;i++)key=sourceKeys[i],excluded.indexOf(key)>=0||(target[key]=source[key]);return target}function _inheritsLoose(subClass,superClass){subClass.prototype=Object.create(superClass.prototype),subClass.prototype.constructor=subClass,subClass.__proto__=superClass}var UNMOUNTED="unmounted";exports.UNMOUNTED=UNMOUNTED;var EXITED="exited";exports.EXITED=EXITED;var ENTERING="entering";exports.ENTERING=ENTERING;var ENTERED="entered";exports.ENTERED=ENTERED;var EXITING="exiting";exports.EXITING=EXITING;var Transition=function(_React$Component){function Transition(props,context){var _this;_this=_React$Component.call(this,props,context)||this;var parentGroup=context,appear=context&&!context.isMounting?props.enter:props.appear,initialStatus;return _this.appearStatus=null,props.in?appear?(initialStatus=EXITED,_this.appearStatus=ENTERING):initialStatus=ENTERED:initialStatus=props.unmountOnExit||props.mountOnEnter?UNMOUNTED:EXITED,_this.state={status:initialStatus},_this.nextCallback=null,_this}_inheritsLoose(Transition,_React$Component),Transition.getDerivedStateFromProps=function getDerivedStateFromProps(_ref,prevState){var nextIn;return _ref.in&&prevState.status===UNMOUNTED?{status:EXITED}:null};var _proto=Transition.prototype;return _proto.componentDidMount=function componentDidMount(){this.updateStatus(!0,this.appearStatus)},_proto.componentDidUpdate=function componentDidUpdate(prevProps){var nextStatus=null;if(prevProps!==this.props){var status=this.state.status;this.props.in?status!==ENTERING&&status!==ENTERED&&(nextStatus=ENTERING):status!==ENTERING&&status!==ENTERED||(nextStatus=EXITING)}this.updateStatus(!1,nextStatus)},_proto.componentWillUnmount=function componentWillUnmount(){this.cancelNextCallback()},_proto.getTimeouts=function getTimeouts(){var timeout=this.props.timeout,exit,enter,appear;return exit=enter=appear=timeout,null!=timeout&&"number"!=typeof timeout&&(exit=timeout.exit,enter=timeout.enter,appear=void 0!==timeout.appear?timeout.appear:enter),{exit:exit,enter:enter,appear:appear}},_proto.updateStatus=function updateStatus(mounting,nextStatus){void 0===mounting&&(mounting=!1),null!==nextStatus?(this.cancelNextCallback(),nextStatus===ENTERING?this.performEnter(mounting):this.performExit()):this.props.unmountOnExit&&this.state.status===EXITED&&this.setState({status:UNMOUNTED})},_proto.performEnter=function performEnter(mounting){var _this2=this,enter=this.props.enter,appearing=this.context?this.context.isMounting:mounting,_ref2=this.props.nodeRef?[appearing]:[_reactDom.default.findDOMNode(this),appearing],maybeNode=_ref2[0],maybeAppearing=_ref2[1],timeouts=this.getTimeouts(),enterTimeout=appearing?timeouts.appear:timeouts.enter;!mounting&&!enter||_config.default.disabled?this.safeSetState({status:ENTERED},(function(){_this2.props.onEntered(maybeNode)})):(this.props.onEnter(maybeNode,maybeAppearing),this.safeSetState({status:ENTERING},(function(){_this2.props.onEntering(maybeNode,maybeAppearing),_this2.onTransitionEnd(enterTimeout,(function(){_this2.safeSetState({status:ENTERED},(function(){_this2.props.onEntered(maybeNode,maybeAppearing)}))}))})))},_proto.performExit=function performExit(){var _this3=this,exit=this.props.exit,timeouts=this.getTimeouts(),maybeNode=this.props.nodeRef?void 0:_reactDom.default.findDOMNode(this);exit&&!_config.default.disabled?(this.props.onExit(maybeNode),this.safeSetState({status:EXITING},(function(){_this3.props.onExiting(maybeNode),_this3.onTransitionEnd(timeouts.exit,(function(){_this3.safeSetState({status:EXITED},(function(){_this3.props.onExited(maybeNode)}))}))}))):this.safeSetState({status:EXITED},(function(){_this3.props.onExited(maybeNode)}))},_proto.cancelNextCallback=function cancelNextCallback(){null!==this.nextCallback&&(this.nextCallback.cancel(),this.nextCallback=null)},_proto.safeSetState=function safeSetState(nextState,callback){callback=this.setNextCallback(callback),this.setState(nextState,callback)},_proto.setNextCallback=function setNextCallback(callback){var _this4=this,active=!0;return this.nextCallback=function(event){active&&(active=!1,_this4.nextCallback=null,callback(event))},this.nextCallback.cancel=function(){active=!1},this.nextCallback},_proto.onTransitionEnd=function onTransitionEnd(timeout,handler){this.setNextCallback(handler);var node=this.props.nodeRef?this.props.nodeRef.current:_reactDom.default.findDOMNode(this),doesNotHaveTimeoutOrListener=null==timeout&&!this.props.addEndListener;if(node&&!doesNotHaveTimeoutOrListener){if(this.props.addEndListener){var _ref3=this.props.nodeRef?[this.nextCallback]:[node,this.nextCallback],maybeNode=_ref3[0],maybeNextCallback=_ref3[1];this.props.addEndListener(maybeNode,maybeNextCallback)}null!=timeout&&setTimeout(this.nextCallback,timeout)}else setTimeout(this.nextCallback,0)},_proto.render=function render(){var status=this.state.status;if(status===UNMOUNTED)return null;var _this$props=this.props,children=_this$props.children,_in=_this$props.in,_mountOnEnter=_this$props.mountOnEnter,_unmountOnExit=_this$props.unmountOnExit,_appear=_this$props.appear,_enter=_this$props.enter,_exit=_this$props.exit,_timeout=_this$props.timeout,_addEndListener=_this$props.addEndListener,_onEnter=_this$props.onEnter,_onEntering=_this$props.onEntering,_onEntered=_this$props.onEntered,_onExit=_this$props.onExit,_onExiting=_this$props.onExiting,_onExited=_this$props.onExited,_nodeRef=_this$props.nodeRef,childProps=_objectWithoutPropertiesLoose(_this$props,["children","in","mountOnEnter","unmountOnExit","appear","enter","exit","timeout","addEndListener","onEnter","onEntering","onEntered","onExit","onExiting","onExited","nodeRef"]);return(_react.default.createElement(_TransitionGroupContext.default.Provider,{value:null},"function"==typeof children?children(status,childProps):_react.default.cloneElement(_react.default.Children.only(children),childProps)))},Transition}(_react.default.Component);function noop(){}Transition.contextType=_TransitionGroupContext.default,Transition.propTypes={nodeRef:_propTypes.default.shape({current:"undefined"==typeof Element?_propTypes.default.any:_propTypes.default.instanceOf(Element)}),children:_propTypes.default.oneOfType([_propTypes.default.func.isRequired,_propTypes.default.element.isRequired]).isRequired,in:_propTypes.default.bool,mountOnEnter:_propTypes.default.bool,unmountOnExit:_propTypes.default.bool,appear:_propTypes.default.bool,enter:_propTypes.default.bool,exit:_propTypes.default.bool,timeout:function timeout(props){var pt=_PropTypes.timeoutsShape;props.addEndListener||(pt=pt.isRequired);for(var _len=arguments.length,args=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)args[_key-1]=arguments[_key];return pt.apply(void 0,[props].concat(args))},addEndListener:_propTypes.default.func,onEnter:_propTypes.default.func,onEntering:_propTypes.default.func,onEntered:_propTypes.default.func,onExit:_propTypes.default.func,onExiting:_propTypes.default.func,onExited:_propTypes.default.func},Transition.defaultProps={in:!1,mountOnEnter:!1,unmountOnExit:!1,appear:!1,enter:!0,exit:!0,onEnter:noop,onEntering:noop,onEntered:noop,onExit:noop,onExiting:noop,onExited:noop},Transition.UNMOUNTED=UNMOUNTED,Transition.EXITED=EXITED,Transition.ENTERING=ENTERING,Transition.ENTERED=ENTERED,Transition.EXITING=EXITING;var _default=Transition;exports.default=_default},{"./TransitionGroupContext":476,"./config":477,"./utils/PropTypes":480,"prop-types":426,react:483,"react-dom":440}],475:[function(require,module,exports){"use strict";exports.__esModule=!0,exports.default=void 0;var _propTypes=_interopRequireDefault(require("prop-types")),_react=_interopRequireDefault(require("react")),_TransitionGroupContext=_interopRequireDefault(require("./TransitionGroupContext")),_ChildMapping=require("./utils/ChildMapping");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _objectWithoutPropertiesLoose(source,excluded){if(null==source)return{};var target={},sourceKeys=Object.keys(source),key,i;for(i=0;i<sourceKeys.length;i++)key=sourceKeys[i],excluded.indexOf(key)>=0||(target[key]=source[key]);return target}function _extends(){return(_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target}).apply(this,arguments)}function _assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}function _inheritsLoose(subClass,superClass){subClass.prototype=Object.create(superClass.prototype),subClass.prototype.constructor=subClass,subClass.__proto__=superClass}var values=Object.values||function(obj){return Object.keys(obj).map((function(k){return obj[k]}))},defaultProps={component:"div",childFactory:function childFactory(child){return child}},TransitionGroup=function(_React$Component){function TransitionGroup(props,context){var _this,handleExited=(_this=_React$Component.call(this,props,context)||this).handleExited.bind(_assertThisInitialized(_this));return _this.state={contextValue:{isMounting:!0},handleExited:handleExited,firstRender:!0},_this}_inheritsLoose(TransitionGroup,_React$Component);var _proto=TransitionGroup.prototype;return _proto.componentDidMount=function componentDidMount(){this.mounted=!0,this.setState({contextValue:{isMounting:!1}})},_proto.componentWillUnmount=function componentWillUnmount(){this.mounted=!1},TransitionGroup.getDerivedStateFromProps=function getDerivedStateFromProps(nextProps,_ref){var prevChildMapping=_ref.children,handleExited=_ref.handleExited,firstRender;return{children:_ref.firstRender?(0,_ChildMapping.getInitialChildMapping)(nextProps,handleExited):(0,_ChildMapping.getNextChildMapping)(nextProps,prevChildMapping,handleExited),firstRender:!1}},_proto.handleExited=function handleExited(child,node){var currentChildMapping=(0,_ChildMapping.getChildMapping)(this.props.children);child.key in currentChildMapping||(child.props.onExited&&child.props.onExited(node),this.mounted&&this.setState((function(state){var children=_extends({},state.children);return delete children[child.key],{children:children}})))},_proto.render=function render(){var _this$props=this.props,Component=_this$props.component,childFactory=_this$props.childFactory,props=_objectWithoutPropertiesLoose(_this$props,["component","childFactory"]),contextValue=this.state.contextValue,children=values(this.state.children).map(childFactory);return delete props.appear,delete props.enter,delete props.exit,null===Component?_react.default.createElement(_TransitionGroupContext.default.Provider,{value:contextValue},children):_react.default.createElement(_TransitionGroupContext.default.Provider,{value:contextValue},_react.default.createElement(Component,props,children))},TransitionGroup}(_react.default.Component);TransitionGroup.propTypes={component:_propTypes.default.any,children:_propTypes.default.node,appear:_propTypes.default.bool,enter:_propTypes.default.bool,exit:_propTypes.default.bool,childFactory:_propTypes.default.func},TransitionGroup.defaultProps=defaultProps;var _default=TransitionGroup;exports.default=_default,module.exports=exports.default},{"./TransitionGroupContext":476,"./utils/ChildMapping":479,"prop-types":426,react:483}],476:[function(require,module,exports){"use strict";var _react;function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.__esModule=!0,exports.default=void 0;var _default=_interopRequireDefault(require("react")).default.createContext(null);exports.default=_default,module.exports=exports.default},{react:483}],477:[function(require,module,exports){"use strict";exports.__esModule=!0,exports.default=void 0;var _default={disabled:!1};exports.default=_default,module.exports=exports.default},{}],478:[function(require,module,exports){"use strict";exports.__esModule=!0,exports.config=exports.Transition=exports.TransitionGroup=exports.SwitchTransition=exports.ReplaceTransition=exports.CSSTransition=void 0;var _CSSTransition=_interopRequireDefault(require("./CSSTransition"));exports.CSSTransition=_CSSTransition.default;var _ReplaceTransition=_interopRequireDefault(require("./ReplaceTransition"));exports.ReplaceTransition=_ReplaceTransition.default;var _SwitchTransition=_interopRequireDefault(require("./SwitchTransition"));exports.SwitchTransition=_SwitchTransition.default;var _TransitionGroup=_interopRequireDefault(require("./TransitionGroup"));exports.TransitionGroup=_TransitionGroup.default;var _Transition=_interopRequireDefault(require("./Transition"));exports.Transition=_Transition.default;var _config=_interopRequireDefault(require("./config"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.config=_config.default},{"./CSSTransition":471,"./ReplaceTransition":472,"./SwitchTransition":473,"./Transition":474,"./TransitionGroup":475,"./config":477}],479:[function(require,module,exports){"use strict";exports.__esModule=!0,exports.getChildMapping=getChildMapping,exports.mergeChildMappings=mergeChildMappings,exports.getInitialChildMapping=getInitialChildMapping,exports.getNextChildMapping=getNextChildMapping;var _react=require("react");function getChildMapping(children,mapFn){var mapper=function mapper(child){return mapFn&&(0,_react.isValidElement)(child)?mapFn(child):child},result=Object.create(null);return children&&_react.Children.map(children,(function(c){return c})).forEach((function(child){result[child.key]=mapper(child)})),result}function mergeChildMappings(prev,next){function getValueForKey(key){return key in next?next[key]:prev[key]}prev=prev||{},next=next||{};var nextKeysPending=Object.create(null),pendingKeys=[],i;for(var prevKey in prev)prevKey in next?pendingKeys.length&&(nextKeysPending[prevKey]=pendingKeys,pendingKeys=[]):pendingKeys.push(prevKey);var childMapping={};for(var nextKey in next){if(nextKeysPending[nextKey])for(i=0;i<nextKeysPending[nextKey].length;i++){var pendingNextKey=nextKeysPending[nextKey][i];childMapping[nextKeysPending[nextKey][i]]=getValueForKey(pendingNextKey)}childMapping[nextKey]=getValueForKey(nextKey)}for(i=0;i<pendingKeys.length;i++)childMapping[pendingKeys[i]]=getValueForKey(pendingKeys[i]);return childMapping}function getProp(child,prop,props){return null!=props[prop]?props[prop]:child.props[prop]}function getInitialChildMapping(props,onExited){return getChildMapping(props.children,(function(child){return(0,_react.cloneElement)(child,{onExited:onExited.bind(null,child),in:!0,appear:getProp(child,"appear",props),enter:getProp(child,"enter",props),exit:getProp(child,"exit",props)})}))}function getNextChildMapping(nextProps,prevChildMapping,onExited){var nextChildMapping=getChildMapping(nextProps.children),children=mergeChildMappings(prevChildMapping,nextChildMapping);return Object.keys(children).forEach((function(key){var child=children[key];if((0,_react.isValidElement)(child)){var hasPrev=key in prevChildMapping,hasNext=key in nextChildMapping,prevChild=prevChildMapping[key],isLeaving=(0,_react.isValidElement)(prevChild)&&!prevChild.props.in;!hasNext||hasPrev&&!isLeaving?hasNext||!hasPrev||isLeaving?hasNext&&hasPrev&&(0,_react.isValidElement)(prevChild)&&(children[key]=(0,_react.cloneElement)(child,{onExited:onExited.bind(null,child),in:prevChild.props.in,exit:getProp(child,"exit",nextProps),enter:getProp(child,"enter",nextProps)})):children[key]=(0,_react.cloneElement)(child,{in:!1}):children[key]=(0,_react.cloneElement)(child,{onExited:onExited.bind(null,child),in:!0,exit:getProp(child,"exit",nextProps),enter:getProp(child,"enter",nextProps)})}})),children}},{react:483}],480:[function(require,module,exports){"use strict";exports.__esModule=!0,exports.classNamesShape=exports.timeoutsShape=void 0;var _propTypes=_interopRequireDefault(require("prop-types"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var timeoutsShape=_propTypes.default.oneOfType([_propTypes.default.number,_propTypes.default.shape({enter:_propTypes.default.number,exit:_propTypes.default.number,appear:_propTypes.default.number}).isRequired]);exports.timeoutsShape=timeoutsShape;var classNamesShape=_propTypes.default.oneOfType([_propTypes.default.string,_propTypes.default.shape({enter:_propTypes.default.string,exit:_propTypes.default.string,active:_propTypes.default.string}),_propTypes.default.shape({enter:_propTypes.default.string,enterDone:_propTypes.default.string,enterActive:_propTypes.default.string,exit:_propTypes.default.string,exitDone:_propTypes.default.string,exitActive:_propTypes.default.string})]);exports.classNamesShape=classNamesShape},{"prop-types":426}],481:[function(require,module,exports){
/** @license React v16.14.0
 * react.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
"use strict";(function(){var _assign=require("object-assign"),checkPropTypes=require("prop-types/checkPropTypes"),ReactVersion="16.14.0",hasSymbol="function"==typeof Symbol&&Symbol.for,REACT_ELEMENT_TYPE=hasSymbol?Symbol.for("react.element"):60103,REACT_PORTAL_TYPE=hasSymbol?Symbol.for("react.portal"):60106,REACT_FRAGMENT_TYPE=hasSymbol?Symbol.for("react.fragment"):60107,REACT_STRICT_MODE_TYPE=hasSymbol?Symbol.for("react.strict_mode"):60108,REACT_PROFILER_TYPE=hasSymbol?Symbol.for("react.profiler"):60114,REACT_PROVIDER_TYPE=hasSymbol?Symbol.for("react.provider"):60109,REACT_CONTEXT_TYPE=hasSymbol?Symbol.for("react.context"):60110,REACT_CONCURRENT_MODE_TYPE=hasSymbol?Symbol.for("react.concurrent_mode"):60111,REACT_FORWARD_REF_TYPE=hasSymbol?Symbol.for("react.forward_ref"):60112,REACT_SUSPENSE_TYPE=hasSymbol?Symbol.for("react.suspense"):60113,REACT_SUSPENSE_LIST_TYPE=hasSymbol?Symbol.for("react.suspense_list"):60120,REACT_MEMO_TYPE=hasSymbol?Symbol.for("react.memo"):60115,REACT_LAZY_TYPE=hasSymbol?Symbol.for("react.lazy"):60116,REACT_BLOCK_TYPE=hasSymbol?Symbol.for("react.block"):60121,REACT_FUNDAMENTAL_TYPE=hasSymbol?Symbol.for("react.fundamental"):60117,REACT_RESPONDER_TYPE=hasSymbol?Symbol.for("react.responder"):60118,REACT_SCOPE_TYPE=hasSymbol?Symbol.for("react.scope"):60119,MAYBE_ITERATOR_SYMBOL="function"==typeof Symbol&&Symbol.iterator,FAUX_ITERATOR_SYMBOL="@@iterator";function getIteratorFn(maybeIterable){if(null===maybeIterable||"object"!=typeof maybeIterable)return null;var maybeIterator=MAYBE_ITERATOR_SYMBOL&&maybeIterable[MAYBE_ITERATOR_SYMBOL]||maybeIterable["@@iterator"];return"function"==typeof maybeIterator?maybeIterator:null}var ReactCurrentDispatcher={current:null},ReactCurrentBatchConfig={suspense:null},ReactCurrentOwner={current:null},BEFORE_SLASH_RE=/^(.*)[\\\/]/;function describeComponentFrame(name,source,ownerName){var sourceInfo="";if(source){var path=source.fileName,fileName=path.replace(BEFORE_SLASH_RE,"");if(/^index\./.test(fileName)){var match=path.match(BEFORE_SLASH_RE);if(match){var pathBeforeSlash=match[1],folderName;if(pathBeforeSlash)fileName=pathBeforeSlash.replace(BEFORE_SLASH_RE,"")+"/"+fileName}}sourceInfo=" (at "+fileName+":"+source.lineNumber+")"}else ownerName&&(sourceInfo=" (created by "+ownerName+")");return"\n    in "+(name||"Unknown")+sourceInfo}var Resolved=1;function refineResolvedLazyComponent(lazyComponent){return 1===lazyComponent._status?lazyComponent._result:null}function getWrappedName(outerType,innerType,wrapperName){var functionName=innerType.displayName||innerType.name||"";return outerType.displayName||(""!==functionName?wrapperName+"("+functionName+")":wrapperName)}function getComponentName(type){if(null==type)return null;if("number"==typeof type.tag&&error("Received an unexpected object in getComponentName(). This is likely a bug in React. Please file an issue."),"function"==typeof type)return type.displayName||type.name||null;if("string"==typeof type)return type;switch(type){case REACT_FRAGMENT_TYPE:return"Fragment";case REACT_PORTAL_TYPE:return"Portal";case REACT_PROFILER_TYPE:return"Profiler";case REACT_STRICT_MODE_TYPE:return"StrictMode";case REACT_SUSPENSE_TYPE:return"Suspense";case REACT_SUSPENSE_LIST_TYPE:return"SuspenseList"}if("object"==typeof type)switch(type.$$typeof){case REACT_CONTEXT_TYPE:return"Context.Consumer";case REACT_PROVIDER_TYPE:return"Context.Provider";case REACT_FORWARD_REF_TYPE:return getWrappedName(type,type.render,"ForwardRef");case REACT_MEMO_TYPE:return getComponentName(type.type);case REACT_BLOCK_TYPE:return getComponentName(type.render);case REACT_LAZY_TYPE:var thenable,resolvedThenable=refineResolvedLazyComponent(type);if(resolvedThenable)return getComponentName(resolvedThenable)}return null}var ReactDebugCurrentFrame={},currentlyValidatingElement=null;function setCurrentlyValidatingElement(element){currentlyValidatingElement=element}ReactDebugCurrentFrame.getCurrentStack=null,ReactDebugCurrentFrame.getStackAddendum=function(){var stack="";if(currentlyValidatingElement){var name=getComponentName(currentlyValidatingElement.type),owner=currentlyValidatingElement._owner;stack+=describeComponentFrame(name,currentlyValidatingElement._source,owner&&getComponentName(owner.type))}var impl=ReactDebugCurrentFrame.getCurrentStack;return impl&&(stack+=impl()||""),stack};var IsSomeRendererActing,ReactSharedInternals={ReactCurrentDispatcher:ReactCurrentDispatcher,ReactCurrentBatchConfig:ReactCurrentBatchConfig,ReactCurrentOwner:ReactCurrentOwner,IsSomeRendererActing:{current:!1},assign:_assign};function warn(format){for(var _len=arguments.length,args=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)args[_key-1]=arguments[_key];printWarning("warn",format,args)}function error(format){for(var _len2=arguments.length,args=new Array(_len2>1?_len2-1:0),_key2=1;_key2<_len2;_key2++)args[_key2-1]=arguments[_key2];printWarning("error",format,args)}function printWarning(level,format,args){var hasExistingStack;if(!(args.length>0&&"string"==typeof args[args.length-1]&&0===args[args.length-1].indexOf("\n    in"))){var ReactDebugCurrentFrame,stack=ReactSharedInternals.ReactDebugCurrentFrame.getStackAddendum();""!==stack&&(format+="%s",args=args.concat([stack]))}var argsWithFormat=args.map((function(item){return""+item}));argsWithFormat.unshift("Warning: "+format),Function.prototype.apply.call(console[level],console,argsWithFormat);try{var argIndex=0,message="Warning: "+format.replace(/%s/g,(function(){return args[argIndex++]}));throw new Error(message)}catch(x){}}_assign(ReactSharedInternals,{ReactDebugCurrentFrame:ReactDebugCurrentFrame,ReactComponentTreeHook:{}});var didWarnStateUpdateForUnmountedComponent={};function warnNoop(publicInstance,callerName){var _constructor=publicInstance.constructor,componentName=_constructor&&(_constructor.displayName||_constructor.name)||"ReactClass",warningKey=componentName+"."+callerName;didWarnStateUpdateForUnmountedComponent[warningKey]||(error("Can't call %s on a component that is not yet mounted. This is a no-op, but it might indicate a bug in your application. Instead, assign to `this.state` directly or define a `state = {};` class property with the desired state in the %s component.",callerName,componentName),didWarnStateUpdateForUnmountedComponent[warningKey]=!0)}var ReactNoopUpdateQueue={isMounted:function(publicInstance){return!1},enqueueForceUpdate:function(publicInstance,callback,callerName){warnNoop(publicInstance,"forceUpdate")},enqueueReplaceState:function(publicInstance,completeState,callback,callerName){warnNoop(publicInstance,"replaceState")},enqueueSetState:function(publicInstance,partialState,callback,callerName){warnNoop(publicInstance,"setState")}},emptyObject={};function Component(props,context,updater){this.props=props,this.context=context,this.refs=emptyObject,this.updater=updater||ReactNoopUpdateQueue}Object.freeze(emptyObject),Component.prototype.isReactComponent={},Component.prototype.setState=function(partialState,callback){if("object"!=typeof partialState&&"function"!=typeof partialState&&null!=partialState)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,partialState,callback,"setState")},Component.prototype.forceUpdate=function(callback){this.updater.enqueueForceUpdate(this,callback,"forceUpdate")};var deprecatedAPIs={isMounted:["isMounted","Instead, make sure to clean up subscriptions and pending requests in componentWillUnmount to prevent memory leaks."],replaceState:["replaceState","Refactor your code to use setState instead (see https://github.com/facebook/react/issues/3236)."]},defineDeprecationWarning=function(methodName,info){Object.defineProperty(Component.prototype,methodName,{get:function(){warn("%s(...) is deprecated in plain JavaScript React classes. %s",info[0],info[1])}})};for(var fnName in deprecatedAPIs)deprecatedAPIs.hasOwnProperty(fnName)&&defineDeprecationWarning(fnName,deprecatedAPIs[fnName]);function ComponentDummy(){}function PureComponent(props,context,updater){this.props=props,this.context=context,this.refs=emptyObject,this.updater=updater||ReactNoopUpdateQueue}ComponentDummy.prototype=Component.prototype;var pureComponentPrototype=PureComponent.prototype=new ComponentDummy;function createRef(){var refObject={current:null};return Object.seal(refObject),refObject}pureComponentPrototype.constructor=PureComponent,_assign(pureComponentPrototype,Component.prototype),pureComponentPrototype.isPureReactComponent=!0;var hasOwnProperty=Object.prototype.hasOwnProperty,RESERVED_PROPS={key:!0,ref:!0,__self:!0,__source:!0},specialPropKeyWarningShown,specialPropRefWarningShown,didWarnAboutStringRefs;function hasValidRef(config){if(hasOwnProperty.call(config,"ref")){var getter=Object.getOwnPropertyDescriptor(config,"ref").get;if(getter&&getter.isReactWarning)return!1}return void 0!==config.ref}function hasValidKey(config){if(hasOwnProperty.call(config,"key")){var getter=Object.getOwnPropertyDescriptor(config,"key").get;if(getter&&getter.isReactWarning)return!1}return void 0!==config.key}function defineKeyPropWarningGetter(props,displayName){var warnAboutAccessingKey=function(){specialPropKeyWarningShown||(specialPropKeyWarningShown=!0,error("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://fb.me/react-special-props)",displayName))};warnAboutAccessingKey.isReactWarning=!0,Object.defineProperty(props,"key",{get:warnAboutAccessingKey,configurable:!0})}function defineRefPropWarningGetter(props,displayName){var warnAboutAccessingRef=function(){specialPropRefWarningShown||(specialPropRefWarningShown=!0,error("%s: `ref` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://fb.me/react-special-props)",displayName))};warnAboutAccessingRef.isReactWarning=!0,Object.defineProperty(props,"ref",{get:warnAboutAccessingRef,configurable:!0})}function warnIfStringRefCannotBeAutoConverted(config){if("string"==typeof config.ref&&ReactCurrentOwner.current&&config.__self&&ReactCurrentOwner.current.stateNode!==config.__self){var componentName=getComponentName(ReactCurrentOwner.current.type);didWarnAboutStringRefs[componentName]||(error('Component "%s" contains the string ref "%s". Support for string refs will be removed in a future major release. This case cannot be automatically converted to an arrow function. We ask you to manually fix this case by using useRef() or createRef() instead. Learn more about using refs safely here: https://fb.me/react-strict-mode-string-ref',getComponentName(ReactCurrentOwner.current.type),config.ref),didWarnAboutStringRefs[componentName]=!0)}}didWarnAboutStringRefs={};var ReactElement=function(type,key,ref,self,source,owner,props){var element={$$typeof:REACT_ELEMENT_TYPE,type:type,key:key,ref:ref,props:props,_owner:owner,_store:{}};return Object.defineProperty(element._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(element,"_self",{configurable:!1,enumerable:!1,writable:!1,value:self}),Object.defineProperty(element,"_source",{configurable:!1,enumerable:!1,writable:!1,value:source}),Object.freeze&&(Object.freeze(element.props),Object.freeze(element)),element};function createElement(type,config,children){var propName,props={},key=null,ref=null,self=null,source=null;if(null!=config)for(propName in hasValidRef(config)&&(ref=config.ref,warnIfStringRefCannotBeAutoConverted(config)),hasValidKey(config)&&(key=""+config.key),self=void 0===config.__self?null:config.__self,source=void 0===config.__source?null:config.__source,config)hasOwnProperty.call(config,propName)&&!RESERVED_PROPS.hasOwnProperty(propName)&&(props[propName]=config[propName]);var childrenLength=arguments.length-2;if(1===childrenLength)props.children=children;else if(childrenLength>1){for(var childArray=Array(childrenLength),i=0;i<childrenLength;i++)childArray[i]=arguments[i+2];Object.freeze&&Object.freeze(childArray),props.children=childArray}if(type&&type.defaultProps){var defaultProps=type.defaultProps;for(propName in defaultProps)void 0===props[propName]&&(props[propName]=defaultProps[propName])}if(key||ref){var displayName="function"==typeof type?type.displayName||type.name||"Unknown":type;key&&defineKeyPropWarningGetter(props,displayName),ref&&defineRefPropWarningGetter(props,displayName)}return ReactElement(type,key,ref,self,source,ReactCurrentOwner.current,props)}function cloneAndReplaceKey(oldElement,newKey){var newElement;return ReactElement(oldElement.type,newKey,oldElement.ref,oldElement._self,oldElement._source,oldElement._owner,oldElement.props)}function cloneElement(element,config,children){if(null==element)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+element+".");var propName,props=_assign({},element.props),key=element.key,ref=element.ref,self=element._self,source=element._source,owner=element._owner,defaultProps;if(null!=config)for(propName in hasValidRef(config)&&(ref=config.ref,owner=ReactCurrentOwner.current),hasValidKey(config)&&(key=""+config.key),element.type&&element.type.defaultProps&&(defaultProps=element.type.defaultProps),config)hasOwnProperty.call(config,propName)&&!RESERVED_PROPS.hasOwnProperty(propName)&&(void 0===config[propName]&&void 0!==defaultProps?props[propName]=defaultProps[propName]:props[propName]=config[propName]);var childrenLength=arguments.length-2;if(1===childrenLength)props.children=children;else if(childrenLength>1){for(var childArray=Array(childrenLength),i=0;i<childrenLength;i++)childArray[i]=arguments[i+2];props.children=childArray}return ReactElement(element.type,key,ref,self,source,owner,props)}function isValidElement(object){return"object"==typeof object&&null!==object&&object.$$typeof===REACT_ELEMENT_TYPE}var SEPARATOR=".",SUBSEPARATOR=":";function escape(key){var escapeRegex,escaperLookup={"=":"=0",":":"=2"},escapedString;return"$"+(""+key).replace(/[=:]/g,(function(match){return escaperLookup[match]}))}var didWarnAboutMaps=!1,userProvidedKeyEscapeRegex=/\/+/g;function escapeUserProvidedKey(text){return(""+text).replace(userProvidedKeyEscapeRegex,"$&/")}var POOL_SIZE=10,traverseContextPool=[],propTypesMisspellWarningShown;function getPooledTraverseContext(mapResult,keyPrefix,mapFunction,mapContext){if(traverseContextPool.length){var traverseContext=traverseContextPool.pop();return traverseContext.result=mapResult,traverseContext.keyPrefix=keyPrefix,traverseContext.func=mapFunction,traverseContext.context=mapContext,traverseContext.count=0,traverseContext}return{result:mapResult,keyPrefix:keyPrefix,func:mapFunction,context:mapContext,count:0}}function releaseTraverseContext(traverseContext){traverseContext.result=null,traverseContext.keyPrefix=null,traverseContext.func=null,traverseContext.context=null,traverseContext.count=0,traverseContextPool.length<10&&traverseContextPool.push(traverseContext)}function traverseAllChildrenImpl(children,nameSoFar,callback,traverseContext){var type=typeof children;"undefined"!==type&&"boolean"!==type||(children=null);var invokeCallback=!1,child,nextName;if(null===children)invokeCallback=!0;else switch(type){case"string":case"number":invokeCallback=!0;break;case"object":switch(children.$$typeof){case REACT_ELEMENT_TYPE:case REACT_PORTAL_TYPE:invokeCallback=!0}}if(invokeCallback)return callback(traverseContext,children,""===nameSoFar?"."+getComponentKey(children,0):nameSoFar),1;var subtreeCount=0,nextNamePrefix=""===nameSoFar?".":nameSoFar+":";if(Array.isArray(children))for(var i=0;i<children.length;i++)subtreeCount+=traverseAllChildrenImpl(child=children[i],nextName=nextNamePrefix+getComponentKey(child,i),callback,traverseContext);else{var iteratorFn=getIteratorFn(children);if("function"==typeof iteratorFn){iteratorFn===children.entries&&(didWarnAboutMaps||warn("Using Maps as children is deprecated and will be removed in a future major release. Consider converting children to an array of keyed ReactElements instead."),didWarnAboutMaps=!0);for(var iterator=iteratorFn.call(children),step,ii=0;!(step=iterator.next()).done;)subtreeCount+=traverseAllChildrenImpl(child=step.value,nextName=nextNamePrefix+getComponentKey(child,ii++),callback,traverseContext)}else if("object"===type){var addendum="";addendum=" If you meant to render a collection of children, use an array instead."+ReactDebugCurrentFrame.getStackAddendum();var childrenString=""+children;throw Error("Objects are not valid as a React child (found: "+("[object Object]"===childrenString?"object with keys {"+Object.keys(children).join(", ")+"}":childrenString)+")."+addendum)}}return subtreeCount}function traverseAllChildren(children,callback,traverseContext){return null==children?0:traverseAllChildrenImpl(children,"",callback,traverseContext)}function getComponentKey(component,index){return"object"==typeof component&&null!==component&&null!=component.key?escape(component.key):index.toString(36)}function forEachSingleChild(bookKeeping,child,name){var func=bookKeeping.func,context=bookKeeping.context;func.call(context,child,bookKeeping.count++)}function forEachChildren(children,forEachFunc,forEachContext){if(null==children)return children;var traverseContext=getPooledTraverseContext(null,null,forEachFunc,forEachContext);traverseAllChildren(children,forEachSingleChild,traverseContext),releaseTraverseContext(traverseContext)}function mapSingleChildIntoContext(bookKeeping,child,childKey){var result=bookKeeping.result,keyPrefix=bookKeeping.keyPrefix,func=bookKeeping.func,context=bookKeeping.context,mappedChild=func.call(context,child,bookKeeping.count++);Array.isArray(mappedChild)?mapIntoWithKeyPrefixInternal(mappedChild,result,childKey,(function(c){return c})):null!=mappedChild&&(isValidElement(mappedChild)&&(mappedChild=cloneAndReplaceKey(mappedChild,keyPrefix+(!mappedChild.key||child&&child.key===mappedChild.key?"":escapeUserProvidedKey(mappedChild.key)+"/")+childKey)),result.push(mappedChild))}function mapIntoWithKeyPrefixInternal(children,array,prefix,func,context){var escapedPrefix="";null!=prefix&&(escapedPrefix=escapeUserProvidedKey(prefix)+"/");var traverseContext=getPooledTraverseContext(array,escapedPrefix,func,context);traverseAllChildren(children,mapSingleChildIntoContext,traverseContext),releaseTraverseContext(traverseContext)}function mapChildren(children,func,context){if(null==children)return children;var result=[];return mapIntoWithKeyPrefixInternal(children,result,null,func,context),result}function countChildren(children){return traverseAllChildren(children,(function(){return null}),null)}function toArray(children){var result=[];return mapIntoWithKeyPrefixInternal(children,result,null,(function(child){return child})),result}function onlyChild(children){if(!isValidElement(children))throw Error("React.Children.only expected to receive a single React element child.");return children}function createContext(defaultValue,calculateChangedBits){void 0===calculateChangedBits?calculateChangedBits=null:null!==calculateChangedBits&&"function"!=typeof calculateChangedBits&&error("createContext: Expected the optional second argument to be a function. Instead received: %s",calculateChangedBits);var context={$$typeof:REACT_CONTEXT_TYPE,_calculateChangedBits:calculateChangedBits,_currentValue:defaultValue,_currentValue2:defaultValue,_threadCount:0,Provider:null,Consumer:null};context.Provider={$$typeof:REACT_PROVIDER_TYPE,_context:context};var hasWarnedAboutUsingNestedContextConsumers=!1,hasWarnedAboutUsingConsumerProvider=!1,Consumer={$$typeof:REACT_CONTEXT_TYPE,_context:context,_calculateChangedBits:context._calculateChangedBits};return Object.defineProperties(Consumer,{Provider:{get:function(){return hasWarnedAboutUsingConsumerProvider||(hasWarnedAboutUsingConsumerProvider=!0,error("Rendering <Context.Consumer.Provider> is not supported and will be removed in a future major release. Did you mean to render <Context.Provider> instead?")),context.Provider},set:function(_Provider){context.Provider=_Provider}},_currentValue:{get:function(){return context._currentValue},set:function(_currentValue){context._currentValue=_currentValue}},_currentValue2:{get:function(){return context._currentValue2},set:function(_currentValue2){context._currentValue2=_currentValue2}},_threadCount:{get:function(){return context._threadCount},set:function(_threadCount){context._threadCount=_threadCount}},Consumer:{get:function(){return hasWarnedAboutUsingNestedContextConsumers||(hasWarnedAboutUsingNestedContextConsumers=!0,error("Rendering <Context.Consumer.Consumer> is not supported and will be removed in a future major release. Did you mean to render <Context.Consumer> instead?")),context.Consumer}}}),context.Consumer=Consumer,context._currentRenderer=null,context._currentRenderer2=null,context}function lazy(ctor){var lazyType={$$typeof:REACT_LAZY_TYPE,_ctor:ctor,_status:-1,_result:null},defaultProps,propTypes;return Object.defineProperties(lazyType,{defaultProps:{configurable:!0,get:function(){return defaultProps},set:function(newDefaultProps){error("React.lazy(...): It is not supported to assign `defaultProps` to a lazy component import. Either specify them where the component is defined, or create a wrapping component around it."),defaultProps=newDefaultProps,Object.defineProperty(lazyType,"defaultProps",{enumerable:!0})}},propTypes:{configurable:!0,get:function(){return propTypes},set:function(newPropTypes){error("React.lazy(...): It is not supported to assign `propTypes` to a lazy component import. Either specify them where the component is defined, or create a wrapping component around it."),propTypes=newPropTypes,Object.defineProperty(lazyType,"propTypes",{enumerable:!0})}}}),lazyType}function forwardRef(render){return null!=render&&render.$$typeof===REACT_MEMO_TYPE?error("forwardRef requires a render function but received a `memo` component. Instead of forwardRef(memo(...)), use memo(forwardRef(...))."):"function"!=typeof render?error("forwardRef requires a render function but was given %s.",null===render?"null":typeof render):0!==render.length&&2!==render.length&&error("forwardRef render functions accept exactly two parameters: props and ref. %s",1===render.length?"Did you forget to use the ref parameter?":"Any additional parameter will be undefined."),null!=render&&(null==render.defaultProps&&null==render.propTypes||error("forwardRef render functions do not support propTypes or defaultProps. Did you accidentally pass a React component?")),{$$typeof:REACT_FORWARD_REF_TYPE,render:render}}function isValidElementType(type){return"string"==typeof type||"function"==typeof type||type===REACT_FRAGMENT_TYPE||type===REACT_CONCURRENT_MODE_TYPE||type===REACT_PROFILER_TYPE||type===REACT_STRICT_MODE_TYPE||type===REACT_SUSPENSE_TYPE||type===REACT_SUSPENSE_LIST_TYPE||"object"==typeof type&&null!==type&&(type.$$typeof===REACT_LAZY_TYPE||type.$$typeof===REACT_MEMO_TYPE||type.$$typeof===REACT_PROVIDER_TYPE||type.$$typeof===REACT_CONTEXT_TYPE||type.$$typeof===REACT_FORWARD_REF_TYPE||type.$$typeof===REACT_FUNDAMENTAL_TYPE||type.$$typeof===REACT_RESPONDER_TYPE||type.$$typeof===REACT_SCOPE_TYPE||type.$$typeof===REACT_BLOCK_TYPE)}function memo(type,compare){return isValidElementType(type)||error("memo: The first argument must be a component. Instead received: %s",null===type?"null":typeof type),{$$typeof:REACT_MEMO_TYPE,type:type,compare:void 0===compare?null:compare}}function resolveDispatcher(){var dispatcher=ReactCurrentDispatcher.current;if(null===dispatcher)throw Error("Invalid hook call. Hooks can only be called inside of the body of a function component. This could happen for one of the following reasons:\n1. You might have mismatching versions of React and the renderer (such as React DOM)\n2. You might be breaking the Rules of Hooks\n3. You might have more than one copy of React in the same app\nSee https://fb.me/react-invalid-hook-call for tips about how to debug and fix this problem.");return dispatcher}function useContext(Context,unstable_observedBits){var dispatcher=resolveDispatcher();if(void 0!==unstable_observedBits&&error("useContext() second argument is reserved for future use in React. Passing it is not supported. You passed: %s.%s",unstable_observedBits,"number"==typeof unstable_observedBits&&Array.isArray(arguments[2])?"\n\nDid you call array.map(useContext)? Calling Hooks inside a loop is not supported. Learn more at https://fb.me/rules-of-hooks":""),void 0!==Context._context){var realContext=Context._context;realContext.Consumer===Context?error("Calling useContext(Context.Consumer) is not supported, may cause bugs, and will be removed in a future major release. Did you mean to call useContext(Context) instead?"):realContext.Provider===Context&&error("Calling useContext(Context.Provider) is not supported. Did you mean to call useContext(Context) instead?")}return dispatcher.useContext(Context,unstable_observedBits)}function useState(initialState){var dispatcher;return resolveDispatcher().useState(initialState)}function useReducer(reducer,initialArg,init){var dispatcher;return resolveDispatcher().useReducer(reducer,initialArg,init)}function useRef(initialValue){var dispatcher;return resolveDispatcher().useRef(initialValue)}function useEffect(create,deps){var dispatcher;return resolveDispatcher().useEffect(create,deps)}function useLayoutEffect(create,deps){var dispatcher;return resolveDispatcher().useLayoutEffect(create,deps)}function useCallback(callback,deps){var dispatcher;return resolveDispatcher().useCallback(callback,deps)}function useMemo(create,deps){var dispatcher;return resolveDispatcher().useMemo(create,deps)}function useImperativeHandle(ref,create,deps){var dispatcher;return resolveDispatcher().useImperativeHandle(ref,create,deps)}function useDebugValue(value,formatterFn){var dispatcher;return resolveDispatcher().useDebugValue(value,formatterFn)}function getDeclarationErrorAddendum(){if(ReactCurrentOwner.current){var name=getComponentName(ReactCurrentOwner.current.type);if(name)return"\n\nCheck the render method of `"+name+"`."}return""}function getSourceInfoErrorAddendum(source){var fileName,lineNumber;return void 0!==source?"\n\nCheck your code at "+source.fileName.replace(/^.*[\\\/]/,"")+":"+source.lineNumber+".":""}function getSourceInfoErrorAddendumForProps(elementProps){return null!=elementProps?getSourceInfoErrorAddendum(elementProps.__source):""}propTypesMisspellWarningShown=!1;var ownerHasKeyUseWarning={};function getCurrentComponentErrorInfo(parentType){var info=getDeclarationErrorAddendum();if(!info){var parentName="string"==typeof parentType?parentType:parentType.displayName||parentType.name;parentName&&(info="\n\nCheck the top-level render call using <"+parentName+">.")}return info}function validateExplicitKey(element,parentType){if(element._store&&!element._store.validated&&null==element.key){element._store.validated=!0;var currentComponentErrorInfo=getCurrentComponentErrorInfo(parentType);if(!ownerHasKeyUseWarning[currentComponentErrorInfo]){ownerHasKeyUseWarning[currentComponentErrorInfo]=!0;var childOwner="";element&&element._owner&&element._owner!==ReactCurrentOwner.current&&(childOwner=" It was passed a child from "+getComponentName(element._owner.type)+"."),setCurrentlyValidatingElement(element),error('Each child in a list should have a unique "key" prop.%s%s See https://fb.me/react-warning-keys for more information.',currentComponentErrorInfo,childOwner),setCurrentlyValidatingElement(null)}}}function validateChildKeys(node,parentType){if("object"==typeof node)if(Array.isArray(node))for(var i=0;i<node.length;i++){var child=node[i];isValidElement(child)&&validateExplicitKey(child,parentType)}else if(isValidElement(node))node._store&&(node._store.validated=!0);else if(node){var iteratorFn=getIteratorFn(node);if("function"==typeof iteratorFn&&iteratorFn!==node.entries)for(var iterator=iteratorFn.call(node),step;!(step=iterator.next()).done;)isValidElement(step.value)&&validateExplicitKey(step.value,parentType)}}function validatePropTypes(element){var type=element.type;if(null!=type&&"string"!=typeof type){var name=getComponentName(type),propTypes;if("function"==typeof type)propTypes=type.propTypes;else{if("object"!=typeof type||type.$$typeof!==REACT_FORWARD_REF_TYPE&&type.$$typeof!==REACT_MEMO_TYPE)return;propTypes=type.propTypes}propTypes?(setCurrentlyValidatingElement(element),checkPropTypes(propTypes,element.props,"prop",name,ReactDebugCurrentFrame.getStackAddendum),setCurrentlyValidatingElement(null)):void 0===type.PropTypes||propTypesMisspellWarningShown||(propTypesMisspellWarningShown=!0,error("Component %s declared `PropTypes` instead of `propTypes`. Did you misspell the property assignment?",name||"Unknown")),"function"!=typeof type.getDefaultProps||type.getDefaultProps.isReactClassApproved||error("getDefaultProps is only used on classic React.createClass definitions. Use a static property named `defaultProps` instead.")}}function validateFragmentProps(fragment){setCurrentlyValidatingElement(fragment);for(var keys=Object.keys(fragment.props),i=0;i<keys.length;i++){var key=keys[i];if("children"!==key&&"key"!==key){error("Invalid prop `%s` supplied to `React.Fragment`. React.Fragment can only have `key` and `children` props.",key);break}}null!==fragment.ref&&error("Invalid attribute `ref` supplied to `React.Fragment`."),setCurrentlyValidatingElement(null)}function createElementWithValidation(type,props,children){var validType=isValidElementType(type);if(!validType){var info="";(void 0===type||"object"==typeof type&&null!==type&&0===Object.keys(type).length)&&(info+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.");var sourceInfo=getSourceInfoErrorAddendumForProps(props),typeString;info+=sourceInfo||getDeclarationErrorAddendum(),null===type?typeString="null":Array.isArray(type)?typeString="array":void 0!==type&&type.$$typeof===REACT_ELEMENT_TYPE?(typeString="<"+(getComponentName(type.type)||"Unknown")+" />",info=" Did you accidentally export a JSX literal instead of a component?"):typeString=typeof type,error("React.createElement: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: %s.%s",typeString,info)}var element=createElement.apply(this,arguments);if(null==element)return element;if(validType)for(var i=2;i<arguments.length;i++)validateChildKeys(arguments[i],type);return type===REACT_FRAGMENT_TYPE?validateFragmentProps(element):validatePropTypes(element),element}var didWarnAboutDeprecatedCreateFactory=!1;function createFactoryWithValidation(type){var validatedFactory=createElementWithValidation.bind(null,type);return validatedFactory.type=type,didWarnAboutDeprecatedCreateFactory||(didWarnAboutDeprecatedCreateFactory=!0,warn("React.createFactory() is deprecated and will be removed in a future major release. Consider using JSX or use React.createElement() directly instead.")),Object.defineProperty(validatedFactory,"type",{enumerable:!1,get:function(){return warn("Factory.type is deprecated. Access the class directly before passing it to createFactory."),Object.defineProperty(this,"type",{value:type}),type}}),validatedFactory}function cloneElementWithValidation(element,props,children){for(var newElement=cloneElement.apply(this,arguments),i=2;i<arguments.length;i++)validateChildKeys(arguments[i],newElement.type);return validatePropTypes(newElement),newElement}try{var frozenObject=Object.freeze({}),testMap=new Map([[frozenObject,null]]),testSet=new Set([frozenObject]);testMap.set(0,0),testSet.add(0)}catch(e){}var createElement$1=createElementWithValidation,cloneElement$1=cloneElementWithValidation,createFactory=createFactoryWithValidation,Children={map:mapChildren,forEach:forEachChildren,count:countChildren,toArray:toArray,only:onlyChild};exports.Children=Children,exports.Component=Component,exports.Fragment=REACT_FRAGMENT_TYPE,exports.Profiler=REACT_PROFILER_TYPE,exports.PureComponent=PureComponent,exports.StrictMode=REACT_STRICT_MODE_TYPE,exports.Suspense=REACT_SUSPENSE_TYPE,exports.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ReactSharedInternals,exports.cloneElement=cloneElement$1,exports.createContext=createContext,exports.createElement=createElement$1,exports.createFactory=createFactory,exports.createRef=createRef,exports.forwardRef=forwardRef,exports.isValidElement=isValidElement,exports.lazy=lazy,exports.memo=memo,exports.useCallback=useCallback,exports.useContext=useContext,exports.useDebugValue=useDebugValue,exports.useEffect=useEffect,exports.useImperativeHandle=useImperativeHandle,exports.useLayoutEffect=useLayoutEffect,exports.useMemo=useMemo,exports.useReducer=useReducer,exports.useRef=useRef,exports.useState=useState,exports.version="16.14.0"})()},{"object-assign":419,"prop-types/checkPropTypes":423}],482:[function(require,module,exports){
/** @license React v16.14.0
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
"use strict";var l=require("object-assign"),n="function"==typeof Symbol&&Symbol.for,p=n?Symbol.for("react.element"):60103,q=n?Symbol.for("react.portal"):60106,r=n?Symbol.for("react.fragment"):60107,t=n?Symbol.for("react.strict_mode"):60108,u=n?Symbol.for("react.profiler"):60114,v=n?Symbol.for("react.provider"):60109,w=n?Symbol.for("react.context"):60110,x=n?Symbol.for("react.forward_ref"):60112,y=n?Symbol.for("react.suspense"):60113,z=n?Symbol.for("react.memo"):60115,A=n?Symbol.for("react.lazy"):60116,B="function"==typeof Symbol&&Symbol.iterator;function C(a){for(var b="https://reactjs.org/docs/error-decoder.html?invariant="+a,c=1;c<arguments.length;c++)b+="&args[]="+encodeURIComponent(arguments[c]);return"Minified React error #"+a+"; visit "+b+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var D={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},E={};function F(a,b,c){this.props=a,this.context=b,this.refs=E,this.updater=c||D}function G(){}function H(a,b,c){this.props=a,this.context=b,this.refs=E,this.updater=c||D}F.prototype.isReactComponent={},F.prototype.setState=function(a,b){if("object"!=typeof a&&"function"!=typeof a&&null!=a)throw Error(C(85));this.updater.enqueueSetState(this,a,b,"setState")},F.prototype.forceUpdate=function(a){this.updater.enqueueForceUpdate(this,a,"forceUpdate")},G.prototype=F.prototype;var I=H.prototype=new G;I.constructor=H,l(I,F.prototype),I.isPureReactComponent=!0;var J={current:null},K=Object.prototype.hasOwnProperty,L={key:!0,ref:!0,__self:!0,__source:!0};function M(a,b,c){var e,d={},g=null,k=null;if(null!=b)for(e in void 0!==b.ref&&(k=b.ref),void 0!==b.key&&(g=""+b.key),b)K.call(b,e)&&!L.hasOwnProperty(e)&&(d[e]=b[e]);var f=arguments.length-2;if(1===f)d.children=c;else if(1<f){for(var h=Array(f),m=0;m<f;m++)h[m]=arguments[m+2];d.children=h}if(a&&a.defaultProps)for(e in f=a.defaultProps)void 0===d[e]&&(d[e]=f[e]);return{$$typeof:p,type:a,key:g,ref:k,props:d,_owner:J.current}}function N(a,b){return{$$typeof:p,type:a.type,key:b,ref:a.ref,props:a.props,_owner:a._owner}}function O(a){return"object"==typeof a&&null!==a&&a.$$typeof===p}function escape(a){var b={"=":"=0",":":"=2"};return"$"+(""+a).replace(/[=:]/g,(function(a){return b[a]}))}var P=/\/+/g,Q=[];function R(a,b,c,e){if(Q.length){var d=Q.pop();return d.result=a,d.keyPrefix=b,d.func=c,d.context=e,d.count=0,d}return{result:a,keyPrefix:b,func:c,context:e,count:0}}function S(a){a.result=null,a.keyPrefix=null,a.func=null,a.context=null,a.count=0,10>Q.length&&Q.push(a)}function T(a,b,c,e){var d=typeof a;"undefined"!==d&&"boolean"!==d||(a=null);var g=!1;if(null===a)g=!0;else switch(d){case"string":case"number":g=!0;break;case"object":switch(a.$$typeof){case p:case q:g=!0}}if(g)return c(e,a,""===b?"."+U(a,0):b),1;if(g=0,b=""===b?".":b+":",Array.isArray(a))for(var k=0;k<a.length;k++){var f=b+U(d=a[k],k);g+=T(d,f,c,e)}else if(null===a||"object"!=typeof a?f=null:f="function"==typeof(f=B&&a[B]||a["@@iterator"])?f:null,"function"==typeof f)for(a=f.call(a),k=0;!(d=a.next()).done;)g+=T(d=d.value,f=b+U(d,k++),c,e);else if("object"===d)throw c=""+a,Error(C(31,"[object Object]"===c?"object with keys {"+Object.keys(a).join(", ")+"}":c,""));return g}function V(a,b,c){return null==a?0:T(a,"",b,c)}function U(a,b){return"object"==typeof a&&null!==a&&null!=a.key?escape(a.key):b.toString(36)}function W(a,b){a.func.call(a.context,b,a.count++)}function aa(a,b,c){var e=a.result,d=a.keyPrefix;a=a.func.call(a.context,b,a.count++),Array.isArray(a)?X(a,e,c,(function(a){return a})):null!=a&&(O(a)&&(a=N(a,d+(!a.key||b&&b.key===a.key?"":(""+a.key).replace(P,"$&/")+"/")+c)),e.push(a))}function X(a,b,c,e,d){var g="";null!=c&&(g=(""+c).replace(P,"$&/")+"/"),V(a,aa,b=R(b,g,e,d)),S(b)}var Y={current:null};function Z(){var a=Y.current;if(null===a)throw Error(C(321));return a}var ba={ReactCurrentDispatcher:Y,ReactCurrentBatchConfig:{suspense:null},ReactCurrentOwner:J,IsSomeRendererActing:{current:!1},assign:l};exports.Children={map:function(a,b,c){if(null==a)return a;var e=[];return X(a,e,null,b,c),e},forEach:function(a,b,c){if(null==a)return a;V(a,W,b=R(null,null,b,c)),S(b)},count:function(a){return V(a,(function(){return null}),null)},toArray:function(a){var b=[];return X(a,b,null,(function(a){return a})),b},only:function(a){if(!O(a))throw Error(C(143));return a}},exports.Component=F,exports.Fragment=r,exports.Profiler=u,exports.PureComponent=H,exports.StrictMode=t,exports.Suspense=y,exports.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ba,exports.cloneElement=function(a,b,c){if(null==a)throw Error(C(267,a));var e=l({},a.props),d=a.key,g=a.ref,k=a._owner;if(null!=b){if(void 0!==b.ref&&(g=b.ref,k=J.current),void 0!==b.key&&(d=""+b.key),a.type&&a.type.defaultProps)var f=a.type.defaultProps;for(h in b)K.call(b,h)&&!L.hasOwnProperty(h)&&(e[h]=void 0===b[h]&&void 0!==f?f[h]:b[h])}var h=arguments.length-2;if(1===h)e.children=c;else if(1<h){f=Array(h);for(var m=0;m<h;m++)f[m]=arguments[m+2];e.children=f}return{$$typeof:p,type:a.type,key:d,ref:g,props:e,_owner:k}},exports.createContext=function(a,b){return void 0===b&&(b=null),(a={$$typeof:w,_calculateChangedBits:b,_currentValue:a,_currentValue2:a,_threadCount:0,Provider:null,Consumer:null}).Provider={$$typeof:v,_context:a},a.Consumer=a},exports.createElement=M,exports.createFactory=function(a){var b=M.bind(null,a);return b.type=a,b},exports.createRef=function(){return{current:null}},exports.forwardRef=function(a){return{$$typeof:x,render:a}},exports.isValidElement=O,exports.lazy=function(a){return{$$typeof:A,_ctor:a,_status:-1,_result:null}},exports.memo=function(a,b){return{$$typeof:z,type:a,compare:void 0===b?null:b}},exports.useCallback=function(a,b){return Z().useCallback(a,b)},exports.useContext=function(a,b){return Z().useContext(a,b)},exports.useDebugValue=function(){},exports.useEffect=function(a,b){return Z().useEffect(a,b)},exports.useImperativeHandle=function(a,b,c){return Z().useImperativeHandle(a,b,c)},exports.useLayoutEffect=function(a,b){return Z().useLayoutEffect(a,b)},exports.useMemo=function(a,b){return Z().useMemo(a,b)},exports.useReducer=function(a,b,c){return Z().useReducer(a,b,c)},exports.useRef=function(a){return Z().useRef(a)},exports.useState=function(a){return Z().useState(a)},exports.version="16.14.0"},{"object-assign":419}],483:[function(require,module,exports){"use strict";module.exports=require("./cjs/react.development.js")},{"./cjs/react.development.js":481,"./cjs/react.production.min.js":482}],484:[function(require,module,exports){"use strict";function createThunkMiddleware(extraArgument){return function(_ref){var dispatch=_ref.dispatch,getState=_ref.getState;return function(next){return function(action){return"function"==typeof action?action(dispatch,getState,extraArgument):next(action)}}}}exports.__esModule=!0;var thunk=createThunkMiddleware();thunk.withExtraArgument=createThunkMiddleware,exports.default=thunk},{}],485:[function(require,module,exports){(function(process){(function(){"use strict";var _objectSpread;function _interopDefaultLegacy(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}Object.defineProperty(exports,"__esModule",{value:!0});var _objectSpread__default=_interopDefaultLegacy(require("@babel/runtime/helpers/objectSpread2"));function formatProdErrorMessage(code){return"Minified Redux error #"+code+"; visit https://redux.js.org/Errors?code="+code+" for the full message or use the non-minified dev environment for full errors. "}var $$observable="function"==typeof Symbol&&Symbol.observable||"@@observable",randomString=function randomString(){return Math.random().toString(36).substring(7).split("").join(".")},ActionTypes={INIT:"@@redux/INIT"+randomString(),REPLACE:"@@redux/REPLACE"+randomString(),PROBE_UNKNOWN_ACTION:function PROBE_UNKNOWN_ACTION(){return"@@redux/PROBE_UNKNOWN_ACTION"+randomString()}};function isPlainObject(obj){if("object"!=typeof obj||null===obj)return!1;for(var proto=obj;null!==Object.getPrototypeOf(proto);)proto=Object.getPrototypeOf(proto);return Object.getPrototypeOf(obj)===proto}function kindOf(val){var typeOfVal=typeof val;if("production"!==process.env.NODE_ENV){function miniKindOf(val){if(void 0===val)return"undefined";if(null===val)return"null";var type=typeof val;switch(type){case"boolean":case"string":case"number":case"symbol":case"function":return type}if(Array.isArray(val))return"array";if(isDate(val))return"date";if(isError(val))return"error";var constructorName=ctorName(val);switch(constructorName){case"Symbol":case"Promise":case"WeakMap":case"WeakSet":case"Map":case"Set":return constructorName}return type.slice(8,-1).toLowerCase().replace(/\s/g,"")}function ctorName(val){return"function"==typeof val.constructor?val.constructor.name:null}function isError(val){return val instanceof Error||"string"==typeof val.message&&val.constructor&&"number"==typeof val.constructor.stackTraceLimit}function isDate(val){return val instanceof Date||"function"==typeof val.toDateString&&"function"==typeof val.getDate&&"function"==typeof val.setDate}typeOfVal=miniKindOf(val)}return typeOfVal}function createStore(reducer,preloadedState,enhancer){var _ref2;if("function"==typeof preloadedState&&"function"==typeof enhancer||"function"==typeof enhancer&&"function"==typeof arguments[3])throw new Error("production"===process.env.NODE_ENV?formatProdErrorMessage(0):"It looks like you are passing several store enhancers to createStore(). This is not supported. Instead, compose them together to a single function. See https://redux.js.org/tutorials/fundamentals/part-4-store#creating-a-store-with-enhancers for an example.");if("function"==typeof preloadedState&&void 0===enhancer&&(enhancer=preloadedState,preloadedState=void 0),void 0!==enhancer){if("function"!=typeof enhancer)throw new Error("production"===process.env.NODE_ENV?formatProdErrorMessage(1):"Expected the enhancer to be a function. Instead, received: '"+kindOf(enhancer)+"'");return enhancer(createStore)(reducer,preloadedState)}if("function"!=typeof reducer)throw new Error("production"===process.env.NODE_ENV?formatProdErrorMessage(2):"Expected the root reducer to be a function. Instead, received: '"+kindOf(reducer)+"'");var currentReducer=reducer,currentState=preloadedState,currentListeners=[],nextListeners=currentListeners,isDispatching=!1;function ensureCanMutateNextListeners(){nextListeners===currentListeners&&(nextListeners=currentListeners.slice())}function getState(){if(isDispatching)throw new Error("production"===process.env.NODE_ENV?formatProdErrorMessage(3):"You may not call store.getState() while the reducer is executing. The reducer has already received the state as an argument. Pass it down from the top reducer instead of reading it from the store.");return currentState}function subscribe(listener){if("function"!=typeof listener)throw new Error("production"===process.env.NODE_ENV?formatProdErrorMessage(4):"Expected the listener to be a function. Instead, received: '"+kindOf(listener)+"'");if(isDispatching)throw new Error("production"===process.env.NODE_ENV?formatProdErrorMessage(5):"You may not call store.subscribe() while the reducer is executing. If you would like to be notified after the store has been updated, subscribe from a component and invoke store.getState() in the callback to access the latest state. See https://redux.js.org/api/store#subscribelistener for more details.");var isSubscribed=!0;return ensureCanMutateNextListeners(),nextListeners.push(listener),function unsubscribe(){if(isSubscribed){if(isDispatching)throw new Error("production"===process.env.NODE_ENV?formatProdErrorMessage(6):"You may not unsubscribe from a store listener while the reducer is executing. See https://redux.js.org/api/store#subscribelistener for more details.");isSubscribed=!1,ensureCanMutateNextListeners();var index=nextListeners.indexOf(listener);nextListeners.splice(index,1),currentListeners=null}}}function dispatch(action){if(!isPlainObject(action))throw new Error("production"===process.env.NODE_ENV?formatProdErrorMessage(7):"Actions must be plain objects. Instead, the actual type was: '"+kindOf(action)+"'. You may need to add middleware to your store setup to handle dispatching other values, such as 'redux-thunk' to handle dispatching functions. See https://redux.js.org/tutorials/fundamentals/part-4-store#middleware and https://redux.js.org/tutorials/fundamentals/part-6-async-logic#using-the-redux-thunk-middleware for examples.");if(void 0===action.type)throw new Error("production"===process.env.NODE_ENV?formatProdErrorMessage(8):'Actions may not have an undefined "type" property. You may have misspelled an action type string constant.');if(isDispatching)throw new Error("production"===process.env.NODE_ENV?formatProdErrorMessage(9):"Reducers may not dispatch actions.");try{isDispatching=!0,currentState=currentReducer(currentState,action)}finally{isDispatching=!1}for(var listeners=currentListeners=nextListeners,i=0;i<listeners.length;i++){var listener;(0,listeners[i])()}return action}function replaceReducer(nextReducer){if("function"!=typeof nextReducer)throw new Error("production"===process.env.NODE_ENV?formatProdErrorMessage(10):"Expected the nextReducer to be a function. Instead, received: '"+kindOf(nextReducer));currentReducer=nextReducer,dispatch({type:ActionTypes.REPLACE})}function observable(){var _ref,outerSubscribe=subscribe;return(_ref={subscribe:function subscribe(observer){if("object"!=typeof observer||null===observer)throw new Error("production"===process.env.NODE_ENV?formatProdErrorMessage(11):"Expected the observer to be an object. Instead, received: '"+kindOf(observer)+"'");function observeState(){observer.next&&observer.next(getState())}var unsubscribe;return observeState(),{unsubscribe:outerSubscribe(observeState)}}})[$$observable]=function(){return this},_ref}return dispatch({type:ActionTypes.INIT}),(_ref2={dispatch:dispatch,subscribe:subscribe,getState:getState,replaceReducer:replaceReducer})[$$observable]=observable,_ref2}function warning(message){"undefined"!=typeof console&&"function"==typeof console.error&&console.error(message);try{throw new Error(message)}catch(e){}}function getUnexpectedStateShapeWarningMessage(inputState,reducers,action,unexpectedKeyCache){var reducerKeys=Object.keys(reducers),argumentName=action&&action.type===ActionTypes.INIT?"preloadedState argument passed to createStore":"previous state received by the reducer";if(0===reducerKeys.length)return"Store does not have a valid reducer. Make sure the argument passed to combineReducers is an object whose values are reducers.";if(!isPlainObject(inputState))return"The "+argumentName+' has unexpected type of "'+kindOf(inputState)+'". Expected argument to be an object with the following keys: "'+reducerKeys.join('", "')+'"';var unexpectedKeys=Object.keys(inputState).filter((function(key){return!reducers.hasOwnProperty(key)&&!unexpectedKeyCache[key]}));return unexpectedKeys.forEach((function(key){unexpectedKeyCache[key]=!0})),action&&action.type===ActionTypes.REPLACE?void 0:unexpectedKeys.length>0?"Unexpected "+(unexpectedKeys.length>1?"keys":"key")+' "'+unexpectedKeys.join('", "')+'" found in '+argumentName+'. Expected to find one of the known reducer keys instead: "'+reducerKeys.join('", "')+'". Unexpected keys will be ignored.':void 0}function assertReducerShape(reducers){Object.keys(reducers).forEach((function(key){var reducer=reducers[key],initialState;if(void 0===reducer(void 0,{type:ActionTypes.INIT}))throw new Error("production"===process.env.NODE_ENV?formatProdErrorMessage(12):'The slice reducer for key "'+key+"\" returned undefined during initialization. If the state passed to the reducer is undefined, you must explicitly return the initial state. The initial state may not be undefined. If you don't want to set a value for this reducer, you can use null instead of undefined.");if(void 0===reducer(void 0,{type:ActionTypes.PROBE_UNKNOWN_ACTION()}))throw new Error("production"===process.env.NODE_ENV?formatProdErrorMessage(13):'The slice reducer for key "'+key+"\" returned undefined when probed with a random type. Don't try to handle '"+ActionTypes.INIT+'\' or other actions in "redux/*" namespace. They are considered private. Instead, you must return the current state for any unknown actions, unless it is undefined, in which case you must return the initial state, regardless of the action type. The initial state may not be undefined, but can be null.')}))}function combineReducers(reducers){for(var reducerKeys=Object.keys(reducers),finalReducers={},i=0;i<reducerKeys.length;i++){var key=reducerKeys[i];"production"!==process.env.NODE_ENV&&void 0===reducers[key]&&warning('No reducer provided for key "'+key+'"'),"function"==typeof reducers[key]&&(finalReducers[key]=reducers[key])}var finalReducerKeys=Object.keys(finalReducers),unexpectedKeyCache,shapeAssertionError;"production"!==process.env.NODE_ENV&&(unexpectedKeyCache={});try{assertReducerShape(finalReducers)}catch(e){shapeAssertionError=e}return function combination(state,action){if(void 0===state&&(state={}),shapeAssertionError)throw shapeAssertionError;if("production"!==process.env.NODE_ENV){var warningMessage=getUnexpectedStateShapeWarningMessage(state,finalReducers,action,unexpectedKeyCache);warningMessage&&warning(warningMessage)}for(var hasChanged=!1,nextState={},_i=0;_i<finalReducerKeys.length;_i++){var _key=finalReducerKeys[_i],reducer=finalReducers[_key],previousStateForKey=state[_key],nextStateForKey=reducer(previousStateForKey,action);if(void 0===nextStateForKey){var actionType=action&&action.type;throw new Error("production"===process.env.NODE_ENV?formatProdErrorMessage(14):"When called with an action of type "+(actionType?'"'+String(actionType)+'"':"(unknown type)")+', the slice reducer for key "'+_key+'" returned undefined. To ignore an action, you must explicitly return the previous state. If you want this reducer to hold no value, you can return null instead of undefined.')}nextState[_key]=nextStateForKey,hasChanged=hasChanged||nextStateForKey!==previousStateForKey}return(hasChanged=hasChanged||finalReducerKeys.length!==Object.keys(state).length)?nextState:state}}function bindActionCreator(actionCreator,dispatch){return function(){return dispatch(actionCreator.apply(this,arguments))}}function bindActionCreators(actionCreators,dispatch){if("function"==typeof actionCreators)return bindActionCreator(actionCreators,dispatch);if("object"!=typeof actionCreators||null===actionCreators)throw new Error("production"===process.env.NODE_ENV?formatProdErrorMessage(16):"bindActionCreators expected an object or a function, but instead received: '"+kindOf(actionCreators)+'\'. Did you write "import ActionCreators from" instead of "import * as ActionCreators from"?');var boundActionCreators={};for(var key in actionCreators){var actionCreator=actionCreators[key];"function"==typeof actionCreator&&(boundActionCreators[key]=bindActionCreator(actionCreator,dispatch))}return boundActionCreators}function compose(){for(var _len=arguments.length,funcs=new Array(_len),_key=0;_key<_len;_key++)funcs[_key]=arguments[_key];return 0===funcs.length?function(arg){return arg}:1===funcs.length?funcs[0]:funcs.reduce((function(a,b){return function(){return a(b.apply(void 0,arguments))}}))}function applyMiddleware(){for(var _len=arguments.length,middlewares=new Array(_len),_key=0;_key<_len;_key++)middlewares[_key]=arguments[_key];return function(createStore){return function(){var store=createStore.apply(void 0,arguments),_dispatch=function dispatch(){throw new Error("production"===process.env.NODE_ENV?formatProdErrorMessage(15):"Dispatching while constructing your middleware is not allowed. Other middleware would not be applied to this dispatch.")},middlewareAPI={getState:store.getState,dispatch:function dispatch(){return _dispatch.apply(void 0,arguments)}},chain=middlewares.map((function(middleware){return middleware(middlewareAPI)}));return _dispatch=compose.apply(void 0,chain)(store.dispatch),_objectSpread__default.default(_objectSpread__default.default({},store),{},{dispatch:_dispatch})}}}function isCrushed(){}"production"!==process.env.NODE_ENV&&"string"==typeof isCrushed.name&&"isCrushed"!==isCrushed.name&&warning('You are currently using minified code outside of NODE_ENV === "production". This means that you are running a slower development build of Redux. You can use loose-envify (https://github.com/zertosh/loose-envify) for browserify or setting mode to production in webpack (https://webpack.js.org/concepts/mode/) to ensure you have the correct code for your production build.'),exports.__DO_NOT_USE__ActionTypes=ActionTypes,exports.applyMiddleware=applyMiddleware,exports.bindActionCreators=bindActionCreators,exports.combineReducers=combineReducers,exports.compose=compose,exports.createStore=createStore}).call(this)}).call(this,require("_process"))},{"@babel/runtime/helpers/objectSpread2":49,_process:422}],486:[function(require,module,exports){var runtime=function(exports){"use strict";var Op=Object.prototype,hasOwn=Op.hasOwnProperty,undefined,$Symbol="function"==typeof Symbol?Symbol:{},iteratorSymbol=$Symbol.iterator||"@@iterator",asyncIteratorSymbol=$Symbol.asyncIterator||"@@asyncIterator",toStringTagSymbol=$Symbol.toStringTag||"@@toStringTag";function define(obj,key,value){return Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}),obj[key]}try{define({},"")}catch(err){define=function(obj,key,value){return obj[key]=value}}function wrap(innerFn,outerFn,self,tryLocsList){var protoGenerator=outerFn&&outerFn.prototype instanceof Generator?outerFn:Generator,generator=Object.create(protoGenerator.prototype),context=new Context(tryLocsList||[]);return generator._invoke=makeInvokeMethod(innerFn,self,context),generator}function tryCatch(fn,obj,arg){try{return{type:"normal",arg:fn.call(obj,arg)}}catch(err){return{type:"throw",arg:err}}}exports.wrap=wrap;var GenStateSuspendedStart="suspendedStart",GenStateSuspendedYield="suspendedYield",GenStateExecuting="executing",GenStateCompleted="completed",ContinueSentinel={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var IteratorPrototype={};IteratorPrototype[iteratorSymbol]=function(){return this};var getProto=Object.getPrototypeOf,NativeIteratorPrototype=getProto&&getProto(getProto(values([])));NativeIteratorPrototype&&NativeIteratorPrototype!==Op&&hasOwn.call(NativeIteratorPrototype,iteratorSymbol)&&(IteratorPrototype=NativeIteratorPrototype);var Gp=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(IteratorPrototype);function defineIteratorMethods(prototype){["next","throw","return"].forEach((function(method){define(prototype,method,(function(arg){return this._invoke(method,arg)}))}))}function AsyncIterator(generator,PromiseImpl){function invoke(method,arg,resolve,reject){var record=tryCatch(generator[method],generator,arg);if("throw"!==record.type){var result=record.arg,value=result.value;return value&&"object"==typeof value&&hasOwn.call(value,"__await")?PromiseImpl.resolve(value.__await).then((function(value){invoke("next",value,resolve,reject)}),(function(err){invoke("throw",err,resolve,reject)})):PromiseImpl.resolve(value).then((function(unwrapped){result.value=unwrapped,resolve(result)}),(function(error){return invoke("throw",error,resolve,reject)}))}reject(record.arg)}var previousPromise;function enqueue(method,arg){function callInvokeWithMethodAndArg(){return new PromiseImpl((function(resolve,reject){invoke(method,arg,resolve,reject)}))}return previousPromise=previousPromise?previousPromise.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}this._invoke=enqueue}function makeInvokeMethod(innerFn,self,context){var state="suspendedStart";return function invoke(method,arg){if("executing"===state)throw new Error("Generator is already running");if("completed"===state){if("throw"===method)throw arg;return doneResult()}for(context.method=method,context.arg=arg;;){var delegate=context.delegate;if(delegate){var delegateResult=maybeInvokeDelegate(delegate,context);if(delegateResult){if(delegateResult===ContinueSentinel)continue;return delegateResult}}if("next"===context.method)context.sent=context._sent=context.arg;else if("throw"===context.method){if("suspendedStart"===state)throw state="completed",context.arg;context.dispatchException(context.arg)}else"return"===context.method&&context.abrupt("return",context.arg);state="executing";var record=tryCatch(innerFn,self,context);if("normal"===record.type){if(state=context.done?"completed":"suspendedYield",record.arg===ContinueSentinel)continue;return{value:record.arg,done:context.done}}"throw"===record.type&&(state="completed",context.method="throw",context.arg=record.arg)}}}function maybeInvokeDelegate(delegate,context){var method=delegate.iterator[context.method];if(void 0===method){if(context.delegate=null,"throw"===context.method){if(delegate.iterator.return&&(context.method="return",context.arg=void 0,maybeInvokeDelegate(delegate,context),"throw"===context.method))return ContinueSentinel;context.method="throw",context.arg=new TypeError("The iterator does not provide a 'throw' method")}return ContinueSentinel}var record=tryCatch(method,delegate.iterator,context.arg);if("throw"===record.type)return context.method="throw",context.arg=record.arg,context.delegate=null,ContinueSentinel;var info=record.arg;return info?info.done?(context[delegate.resultName]=info.value,context.next=delegate.nextLoc,"return"!==context.method&&(context.method="next",context.arg=void 0),context.delegate=null,ContinueSentinel):info:(context.method="throw",context.arg=new TypeError("iterator result is not an object"),context.delegate=null,ContinueSentinel)}function pushTryEntry(locs){var entry={tryLoc:locs[0]};1 in locs&&(entry.catchLoc=locs[1]),2 in locs&&(entry.finallyLoc=locs[2],entry.afterLoc=locs[3]),this.tryEntries.push(entry)}function resetTryEntry(entry){var record=entry.completion||{};record.type="normal",delete record.arg,entry.completion=record}function Context(tryLocsList){this.tryEntries=[{tryLoc:"root"}],tryLocsList.forEach(pushTryEntry,this),this.reset(!0)}function values(iterable){if(iterable){var iteratorMethod=iterable[iteratorSymbol];if(iteratorMethod)return iteratorMethod.call(iterable);if("function"==typeof iterable.next)return iterable;if(!isNaN(iterable.length)){var i=-1,next=function next(){for(;++i<iterable.length;)if(hasOwn.call(iterable,i))return next.value=iterable[i],next.done=!1,next;return next.value=void 0,next.done=!0,next};return next.next=next}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=Gp.constructor=GeneratorFunctionPrototype,GeneratorFunctionPrototype.constructor=GeneratorFunction,GeneratorFunction.displayName=define(GeneratorFunctionPrototype,toStringTagSymbol,"GeneratorFunction"),exports.isGeneratorFunction=function(genFun){var ctor="function"==typeof genFun&&genFun.constructor;return!!ctor&&(ctor===GeneratorFunction||"GeneratorFunction"===(ctor.displayName||ctor.name))},exports.mark=function(genFun){return Object.setPrototypeOf?Object.setPrototypeOf(genFun,GeneratorFunctionPrototype):(genFun.__proto__=GeneratorFunctionPrototype,define(genFun,toStringTagSymbol,"GeneratorFunction")),genFun.prototype=Object.create(Gp),genFun},exports.awrap=function(arg){return{__await:arg}},defineIteratorMethods(AsyncIterator.prototype),AsyncIterator.prototype[asyncIteratorSymbol]=function(){return this},exports.AsyncIterator=AsyncIterator,exports.async=function(innerFn,outerFn,self,tryLocsList,PromiseImpl){void 0===PromiseImpl&&(PromiseImpl=Promise);var iter=new AsyncIterator(wrap(innerFn,outerFn,self,tryLocsList),PromiseImpl);return exports.isGeneratorFunction(outerFn)?iter:iter.next().then((function(result){return result.done?result.value:iter.next()}))},defineIteratorMethods(Gp),define(Gp,toStringTagSymbol,"Generator"),Gp[iteratorSymbol]=function(){return this},Gp.toString=function(){return"[object Generator]"},exports.keys=function(object){var keys=[];for(var key in object)keys.push(key);return keys.reverse(),function next(){for(;keys.length;){var key=keys.pop();if(key in object)return next.value=key,next.done=!1,next}return next.done=!0,next}},exports.values=values,Context.prototype={constructor:Context,reset:function(skipTempReset){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!skipTempReset)for(var name in this)"t"===name.charAt(0)&&hasOwn.call(this,name)&&!isNaN(+name.slice(1))&&(this[name]=void 0)},stop:function(){this.done=!0;var rootEntry,rootRecord=this.tryEntries[0].completion;if("throw"===rootRecord.type)throw rootRecord.arg;return this.rval},dispatchException:function(exception){if(this.done)throw exception;var context=this;function handle(loc,caught){return record.type="throw",record.arg=exception,context.next=loc,caught&&(context.method="next",context.arg=void 0),!!caught}for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i],record=entry.completion;if("root"===entry.tryLoc)return handle("end");if(entry.tryLoc<=this.prev){var hasCatch=hasOwn.call(entry,"catchLoc"),hasFinally=hasOwn.call(entry,"finallyLoc");if(hasCatch&&hasFinally){if(this.prev<entry.catchLoc)return handle(entry.catchLoc,!0);if(this.prev<entry.finallyLoc)return handle(entry.finallyLoc)}else if(hasCatch){if(this.prev<entry.catchLoc)return handle(entry.catchLoc,!0)}else{if(!hasFinally)throw new Error("try statement without catch or finally");if(this.prev<entry.finallyLoc)return handle(entry.finallyLoc)}}}},abrupt:function(type,arg){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc<=this.prev&&hasOwn.call(entry,"finallyLoc")&&this.prev<entry.finallyLoc){var finallyEntry=entry;break}}finallyEntry&&("break"===type||"continue"===type)&&finallyEntry.tryLoc<=arg&&arg<=finallyEntry.finallyLoc&&(finallyEntry=null);var record=finallyEntry?finallyEntry.completion:{};return record.type=type,record.arg=arg,finallyEntry?(this.method="next",this.next=finallyEntry.finallyLoc,ContinueSentinel):this.complete(record)},complete:function(record,afterLoc){if("throw"===record.type)throw record.arg;return"break"===record.type||"continue"===record.type?this.next=record.arg:"return"===record.type?(this.rval=this.arg=record.arg,this.method="return",this.next="end"):"normal"===record.type&&afterLoc&&(this.next=afterLoc),ContinueSentinel},finish:function(finallyLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.finallyLoc===finallyLoc)return this.complete(entry.completion,entry.afterLoc),resetTryEntry(entry),ContinueSentinel}},catch:function(tryLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc===tryLoc){var record=entry.completion;if("throw"===record.type){var thrown=record.arg;resetTryEntry(entry)}return thrown}}throw new Error("illegal catch attempt")},delegateYield:function(iterable,resultName,nextLoc){return this.delegate={iterator:values(iterable),resultName:resultName,nextLoc:nextLoc},"next"===this.method&&(this.arg=void 0),ContinueSentinel}},exports}("object"==typeof module?module.exports:{});try{regeneratorRuntime=runtime}catch(accidentalStrictMode){Function("r","regeneratorRuntime = r")(runtime)}},{}],487:[function(require,module,exports){"use strict";module.exports=function required(port,protocol){if(protocol=protocol.split(":")[0],!(port=+port))return!1;switch(protocol){case"http":case"ws":return 80!==port;case"https":case"wss":return 443!==port;case"ftp":return 21!==port;case"gopher":return 70!==port;case"file":return!1}return 0!==port}},{}],488:[function(require,module,exports){module.exports=require("./lib/retry")},{"./lib/retry":489}],489:[function(require,module,exports){var RetryOperation=require("./retry_operation");exports.operation=function(options){var timeouts=exports.timeouts(options);return new RetryOperation(timeouts,{forever:options&&options.forever,unref:options&&options.unref,maxRetryTime:options&&options.maxRetryTime})},exports.timeouts=function(options){if(options instanceof Array)return[].concat(options);var opts={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var key in options)opts[key]=options[key];if(opts.minTimeout>opts.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var timeouts=[],i=0;i<opts.retries;i++)timeouts.push(this.createTimeout(i,opts));return options&&options.forever&&!timeouts.length&&timeouts.push(this.createTimeout(i,opts)),timeouts.sort((function(a,b){return a-b})),timeouts},exports.createTimeout=function(attempt,opts){var random=opts.randomize?Math.random()+1:1,timeout=Math.round(random*opts.minTimeout*Math.pow(opts.factor,attempt));return timeout=Math.min(timeout,opts.maxTimeout)},exports.wrap=function(obj,options,methods){if(options instanceof Array&&(methods=options,options=null),!methods)for(var key in methods=[],obj)"function"==typeof obj[key]&&methods.push(key);for(var i=0;i<methods.length;i++){var method=methods[i],original=obj[method];obj[method]=function retryWrapper(original){var op=exports.operation(options),args=Array.prototype.slice.call(arguments,1),callback=args.pop();args.push((function(err){op.retry(err)||(err&&(arguments[0]=op.mainError()),callback.apply(this,arguments))})),op.attempt((function(){original.apply(obj,args)}))}.bind(obj,original),obj[method].options=options}}},{"./retry_operation":490}],490:[function(require,module,exports){function RetryOperation(timeouts,options){"boolean"==typeof options&&(options={forever:options}),this._originalTimeouts=JSON.parse(JSON.stringify(timeouts)),this._timeouts=timeouts,this._options=options||{},this._maxRetryTime=options&&options.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}module.exports=RetryOperation,RetryOperation.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts},RetryOperation.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timeouts=[],this._cachedTimeouts=null},RetryOperation.prototype.retry=function(err){if(this._timeout&&clearTimeout(this._timeout),!err)return!1;var currentTime=(new Date).getTime();if(err&&currentTime-this._operationStart>=this._maxRetryTime)return this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(err);var timeout=this._timeouts.shift();if(void 0===timeout){if(!this._cachedTimeouts)return!1;this._errors.splice(this._errors.length-1,this._errors.length),this._timeouts=this._cachedTimeouts.slice(0),timeout=this._timeouts.shift()}var self=this,timer=setTimeout((function(){self._attempts++,self._operationTimeoutCb&&(self._timeout=setTimeout((function(){self._operationTimeoutCb(self._attempts)}),self._operationTimeout),self._options.unref&&self._timeout.unref()),self._fn(self._attempts)}),timeout);return this._options.unref&&timer.unref(),!0},RetryOperation.prototype.attempt=function(fn,timeoutOps){this._fn=fn,timeoutOps&&(timeoutOps.timeout&&(this._operationTimeout=timeoutOps.timeout),timeoutOps.cb&&(this._operationTimeoutCb=timeoutOps.cb));var self=this;this._operationTimeoutCb&&(this._timeout=setTimeout((function(){self._operationTimeoutCb()}),self._operationTimeout)),this._operationStart=(new Date).getTime(),this._fn(this._attempts)},RetryOperation.prototype.try=function(fn){console.log("Using RetryOperation.try() is deprecated"),this.attempt(fn)},RetryOperation.prototype.start=function(fn){console.log("Using RetryOperation.start() is deprecated"),this.attempt(fn)},RetryOperation.prototype.start=RetryOperation.prototype.try,RetryOperation.prototype.errors=function(){return this._errors},RetryOperation.prototype.attempts=function(){return this._attempts},RetryOperation.prototype.mainError=function(){if(0===this._errors.length)return null;for(var counts={},mainError=null,mainErrorCount=0,i=0;i<this._errors.length;i++){var error=this._errors[i],message=error.message,count=(counts[message]||0)+1;counts[message]=count,count>=mainErrorCount&&(mainError=error,mainErrorCount=count)}return mainError}},{}],491:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},_react,_react2=_interopRequireDefault(require("react")),_propTypes,_propTypes2=_interopRequireDefault(require("prop-types"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var debug=require("debug")("RIEBase"),RIEBase=function(_React$Component){function RIEBase(props){_classCallCheck(this,RIEBase);var _this=_possibleConstructorReturn(this,(RIEBase.__proto__||Object.getPrototypeOf(RIEBase)).call(this,props));if(_this.doValidations=function(value){debug("doValidations("+value+")");var isValid=void 0;if(_this.props.validate)isValid=_this.props.validate(value);else{if(!_this.validate)return!0;isValid=_this.validate(value)}return _this.setState({invalid:!isValid}),isValid},_this.selectInputText=function(element){debug("selectInputText("+element.value+")"),element.setSelectionRange&&element.setSelectionRange(0,element.value.length)},_this.elementClick=function(event){throw"RIEBase must be subclassed first: use a concrete class like RIEInput, RIEToggle et.c"},_this.componentWillReceiveProps=function(nextProps){debug("componentWillReceiveProps("+nextProps+")"),!("value"in nextProps)||nextProps.shouldRemainWhileInvalid&&_this.state.invalid||_this.setState({loading:!1,editing:!1,invalid:!1,newValue:null})},_this.commit=function(value){if(debug("commit("+value+")"),!_this.state.invalid){var newProp={};newProp[_this.props.propName]=value,_this.setState({loading:!0,newValue:value}),_this.props.change(newProp)}},_this.makeClassString=function(){debug("makeClassString()");var classNames=[];return _this.props.className&&classNames.push(_this.props.className),_this.state.editing&&_this.props.classEditing&&classNames.push(_this.props.classEditing),_this.state.loading&&_this.props.classLoading&&classNames.push(_this.props.classLoading),_this.state.disabled&&_this.props.classDisabled&&classNames.push(_this.props.classDisabled),_this.state.invalid&&_this.props.classInvalid&&classNames.push(_this.props.classInvalid),classNames.join(" ")},_this.render=function(){return debuf("render()"),_react2.default.createElement("span",_extends({},_this.props.defaultProps,{tabindex:"0",className:_this.makeClassString(),onClick:_this.elementClick}),_this.props.value)},!_this.props.propName)throw"RTFM: missing 'propName' prop";if(!_this.props.change)throw"RTFM: missing 'change' prop";if(void 0===_this.props.value)throw"RTFM: missing 'value' prop";return _this.state={editing:!1,loading:!1,disabled:!1,invalid:!1},_this}return _inherits(RIEBase,_React$Component),RIEBase}(_react2.default.Component);RIEBase.propTypes={value:_propTypes2.default.any.isRequired,change:_propTypes2.default.func.isRequired,propName:_propTypes2.default.string.isRequired,editProps:_propTypes2.default.object,defaultProps:_propTypes2.default.object,isDisabled:_propTypes2.default.bool,validate:_propTypes2.default.func,handleValidationFail:_propTypes2.default.func,shouldBlockWhileLoading:_propTypes2.default.bool,shouldRemainWhileInvalid:_propTypes2.default.bool,classLoading:_propTypes2.default.string,classEditing:_propTypes2.default.string,classDisabled:_propTypes2.default.string,classInvalid:_propTypes2.default.string,className:_propTypes2.default.string,beforeStart:_propTypes2.default.func,afterStart:_propTypes2.default.func,beforeFinish:_propTypes2.default.func,afterFinish:_propTypes2.default.func},exports.default=RIEBase},{debug:499,"prop-types":426,react:483}],492:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},_react,_react2=_interopRequireDefault(require("react")),_propTypes,_propTypes2=_interopRequireDefault(require("prop-types")),_RIEStatefulBase2,_RIEStatefulBase3=_interopRequireDefault(require("./RIEStatefulBase"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var debug=require("debug")("RIENumber"),RIENumber=function(_RIEStatefulBase){function RIENumber(props){_classCallCheck(this,RIENumber);var _this=_possibleConstructorReturn(this,(RIENumber.__proto__||Object.getPrototypeOf(RIENumber)).call(this,props));return _this.validate=function(value){return debug("validate("+value+")"),!isNaN(value)&&isFinite(value)&&value.length>0},_this.selectInputText=function(element){debug("selectInputText("+element+")"),setTimeout((function(){element.select()}),10)},_this.elementBlur=function(element){debug("elementBlur("+element+")"),element.nativeEvent.explicitOriginalTarget&&element.nativeEvent.explicitOriginalTarget==element.nativeEvent.originalTarget||_this.finishEditing()},_this.renderNormalComponent=function(){return debug("renderNormalComponent()"),_react2.default.createElement("span",_extends({tabIndex:"0",className:_this.makeClassString(),onFocus:_this.startEditing,onClick:_this.elementClick},_this.props.defaultProps),_this.props.format?_this.props.format(_this.state.newValue||_this.props.value):_this.state.newValue||_this.props.value)},_this.renderEditingComponent=function(){return debug("renderEditingComponent()"),_react2.default.createElement("input",_extends({disabled:_this.props.shouldBlockWhileLoading&&_this.state.loading,type:"number",className:_this.makeClassString(),defaultValue:_this.props.value,onInput:_this.textChanged,onBlur:_this.elementBlur,ref:"input",onKeyDown:_this.keyDown},_this.props.editProps))},_this}return _inherits(RIENumber,_RIEStatefulBase),RIENumber}(_RIEStatefulBase3.default);RIENumber.propTypes={format:_propTypes2.default.func},exports.default=RIENumber},{"./RIEStatefulBase":494,debug:499,"prop-types":426,react:483}],493:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},_react,_react2=_interopRequireDefault(require("react")),_reactDom,_reactDom2=_interopRequireDefault(require("react-dom")),_propTypes,_propTypes2=_interopRequireDefault(require("prop-types")),_RIEStatefulBase2,_RIEStatefulBase3;function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var RIESelect=function(_RIEStatefulBase){function RIESelect(){var _ref,_temp,_this,_ret;_classCallCheck(this,RIESelect);for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];return _temp=_this=_possibleConstructorReturn(this,(_ref=RIESelect.__proto__||Object.getPrototypeOf(RIESelect)).call.apply(_ref,[this].concat(args))),_this.finishEditing=function(){var newValue=_this.props.options.find((function(option){return option.id===_reactDom2.default.findDOMNode(this.refs.input).value}),_this);_this.doValidations(newValue),_this.state.invalid||_this.props.value===newValue||_this.commit(newValue),_this.cancelEditing()},_this.renderEditingComponent=function(){var optionNodes=_this.props.options.map((function(option){return _react2.default.createElement("option",{value:option.id,key:option.id},option.text)}));return _react2.default.createElement("select",_extends({disabled:_this.props.shouldBlockWhileLoading&&_this.state.loading,value:_this.props.value.id,className:_this.makeClassString(),onChange:_this.finishEditing,onBlur:_this.cancelEditing,ref:"input",onKeyDown:_this.keyDown},_this.props.editProps),optionNodes)},_this.renderNormalComponent=function(){return _react2.default.createElement("span",_extends({tabIndex:"0",className:_this.makeClassString(),onFocus:_this.startEditing,onClick:_this.startEditing},_this.props.defaultProps),_this.state.newValue?_this.state.newValue.text:_this.props.value.text)},_possibleConstructorReturn(_this,_ret=_temp)}return _inherits(RIESelect,_RIEStatefulBase),RIESelect}(_interopRequireDefault(require("./RIEStatefulBase")).default);RIESelect.propTypes={options:_propTypes2.default.array.isRequired},exports.default=RIESelect},{"./RIEStatefulBase":494,"prop-types":426,react:483,"react-dom":440}],494:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},_react,_react2=_interopRequireDefault(require("react")),_reactDom,_reactDom2=_interopRequireDefault(require("react-dom")),_RIEBase2,_RIEBase3=_interopRequireDefault(require("./RIEBase"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var debug=require("debug")("RIEStatefulBase"),RIEStatefulBase=function(_RIEBase){function RIEStatefulBase(props){_classCallCheck(this,RIEStatefulBase);var _this=_possibleConstructorReturn(this,(RIEStatefulBase.__proto__||Object.getPrototypeOf(RIEStatefulBase)).call(this,props));return _this.startEditing=function(){debug("startEditing"),_this.props.beforeStart&&_this.props.beforeStart(),_this.props.isDisabled||(_this.setState({editing:!0}),_this.props.afterStart&&_this.props.afterStart())},_this.finishEditing=function(){debug("finishEditing"),_this.props.beforeFinish&&_this.props.beforeFinish();var newValue=_reactDom2.default.findDOMNode(_this.refs.input).value,result=_this.doValidations(newValue);result&&_this.props.value!==newValue&&_this.commit(newValue),!result&&_this.props.handleValidationFail?_this.props.handleValidationFail(result,newValue,(function(){return _this.cancelEditing()})):_this.cancelEditing(),_this.props.afterFinish&&_this.props.afterFinish()},_this.cancelEditing=function(){debug("cancelEditing"),_this.setState({editing:!1,invalid:!1})},_this.keyDown=function(event){debug("keyDown(${event.keyCode})"),13===event.keyCode?_this.finishEditing():27===event.keyCode&&_this.cancelEditing()},_this.textChanged=function(event){debug("textChanged(${event.target.value})"),_this.doValidations(event.target.value.trim())},_this.componentDidUpdate=function(prevProps,prevState){debug("componentDidUpdate("+prevProps+", "+prevState+")");var inputElem=_reactDom2.default.findDOMNode(_this.refs.input);debug(inputElem),_this.state.editing&&!prevState.editing?(debug("entering edit mode"),inputElem.focus(),_this.selectInputText(inputElem)):_this.state.editing&&prevProps.text!=_this.props.text&&(debug("not editing && text not equal previous props -- finishing editing"),_this.finishEditing())},_this.renderEditingComponent=function(){return debug("renderEditingComponent()"),_react2.default.createElement("input",_extends({disabled:_this.state.loading,className:_this.makeClassString(),defaultValue:_this.props.value,onInput:_this.textChanged,onBlur:_this.elementBlur,ref:"input",onKeyDown:_this.keyDown},_this.props.editProps))},_this.renderNormalComponent=function(){return debug("renderNormalComponent"),_react2.default.createElement("span",_extends({tabIndex:"0",className:_this.makeClassString(),onFocus:_this.startEditing,onClick:_this.startEditing},_this.props.defaultProps),_this.state.newValue||_this.props.value)},_this.elementBlur=function(event){debug("elementBlur("+event+")"),_this.finishEditing()},_this.elementClick=function(event){debug("elementClick("+event+")"),_this.startEditing(),event.target.element.focus()},_this.render=function(){return debug("render()"),_this.state.editing?_this.renderEditingComponent():_this.renderNormalComponent()},_this}return _inherits(RIEStatefulBase,_RIEBase),RIEStatefulBase}(_RIEBase3.default);exports.default=RIEStatefulBase},{"./RIEBase":491,debug:499,react:483,"react-dom":440}],495:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},_react,_react2=_interopRequireDefault(require("react")),_reactDom,_reactDom2=_interopRequireDefault(require("react-dom")),_propTypes,_propTypes2=_interopRequireDefault(require("prop-types")),_RIEStatefulBase2,_RIEStatefulBase3=_interopRequireDefault(require("./RIEStatefulBase"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}return Array.from(arr)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var RIETag=function(_React$Component){function RIETag(props){_classCallCheck(this,RIETag);var _this=_possibleConstructorReturn(this,(RIETag.__proto__||Object.getPrototypeOf(RIETag)).call(this,props));return _this.remove=function(){_this.props.removeHandler(_this.props.text)},_this.render=function(){return _react2.default.createElement("div",{key:_this.props.text},_this.props.text,_react2.default.createElement("div",{onClick:_this.remove,className:_this.props.className||"remove"},"  "))},_this}return _inherits(RIETag,_React$Component),RIETag}(_react2.default.Component);RIETag.propTypes={text:_propTypes2.default.string.isRequired,removeHandler:_propTypes2.default.func,className:_propTypes2.default.string};var RIETags=function(_RIEStatefulBase){function RIETags(props){_classCallCheck(this,RIETags);var _this2=_possibleConstructorReturn(this,(RIETags.__proto__||Object.getPrototypeOf(RIETags)).call(this,props));return _this2.addTag=function(tag){[].concat(_toConsumableArray(_this2.props.value)).length<(_this2.props.maxTags||65535)&&_this2.commit(_this2.props.value.add(tag))},_this2.removeTag=function(tag){if(clearTimeout(_this2.state.blurTimer),[].concat(_toConsumableArray(_this2.props.value)).length>=(_this2.props.minTags||1)){var newSet=_this2.props.value;newSet.delete(tag),_this2.commit(newSet)}},_this2.componentWillReceiveProps=function(nextProps){"value"in nextProps&&_this2.setState({loading:!1,invalid:!1})},_this2.keyDown=function(event){if(8===event.keyCode){if(0==event.target.value.length){var tagToRemove=[].concat(_toConsumableArray(_this2.props.value)).pop();_this2.removeTag(tagToRemove)}}else 13===event.keyCode?(event.preventDefault(),0===event.target.value.length?_this2.cancelEditing():(_this2.addTag(event.target.value),event.target.value="")):27===event.keyCode&&_this2.cancelEditing()},_this2.cancelEditingDelayed=function(){_this2.setState({blurTimer:setTimeout(_this2.cancelEditing,_this2.props.blurDelay||180)})},_this2.cancelEditing=function(){_this2.setState({editing:!1,invalid:!1})},_this2.componentDidUpdate=function(prevProps,prevState){var inputElem=_reactDom2.default.findDOMNode(_this2.refs.input);_this2.state.editing&&inputElem.focus()},_this2.renderNormalComponent=function(){var tags=[].concat(_toConsumableArray(_this2.props.value)).join(_this2.props.separator||", ");return _react2.default.createElement("span",_extends({tabIndex:"0",className:_this2.makeClassString(),onFocus:_this2.startEditing},_this2.props.defaultProps),tags)},_this2.makeTagElement=function(text){return _react2.default.createElement(RIETag,{key:text,text:text,removeHandler:_this2.removeTag})},_this2.renderEditingComponent=function(){var elements=[].concat(_toConsumableArray(_this2.props.value)).map(_this2.makeTagElement);return _react2.default.createElement("div",_extends({tabIndex:"1",onClick:_this2.startEditing,className:_this2.makeClassString()},_this2.props.editProps),elements,_react2.default.createElement("input",{onBlur:_this2.cancelEditingDelayed,onKeyDown:_this2.keyDown,placeholder:_this2.props.placeholder||"New tag",ref:"input"}))},_this2.state.currentText="",_this2.state.blurTimer=null,_this2}return _inherits(RIETags,_RIEStatefulBase),RIETags}(_RIEStatefulBase3.default);RIETags.propTyes={value:_propTypes2.default.object.isRequired,maxTags:_propTypes2.default.number,minTags:_propTypes2.default.number,separator:_propTypes2.default.string,elementClass:_propTypes2.default.string,blurDelay:_propTypes2.default.number,placeholder:_propTypes2.default.string},exports.default=RIETags},{"./RIEStatefulBase":494,"prop-types":426,react:483,"react-dom":440}],496:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},_react,_react2=_interopRequireDefault(require("react")),_reactDom,_reactDom2=_interopRequireDefault(require("react-dom")),_RIEStatefulBase2,_RIEStatefulBase3;function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var RIETextArea=function(_RIEStatefulBase){function RIETextArea(){var _ref,_temp,_this,_ret;_classCallCheck(this,RIETextArea);for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];return _temp=_this=_possibleConstructorReturn(this,(_ref=RIETextArea.__proto__||Object.getPrototypeOf(RIETextArea)).call.apply(_ref,[this].concat(args))),_this.keyDown=function(event){27===event.keyCode&&_this.cancelEditing()},_this.renderEditingComponent=function(){return _react2.default.createElement("textarea",_extends({rows:_this.props.rows,cols:_this.props.cols,disabled:_this.state.loading,className:_this.makeClassString(),defaultValue:_this.props.value,onInput:_this.textChanged,onBlur:_this.finishEditing,ref:"input",onKeyDown:_this.keyDown},_this.props.editProps))},_this.renderNormalComponent=function(){var value=_this.state.newValue||_this.props.value,spans_and_brs=[],i=0;return value.split("\n").map((function(line){spans_and_brs.push(_react2.default.createElement("span",{key:i},line)),spans_and_brs.push(_react2.default.createElement("br",{key:i+1})),i+=2})),spans_and_brs.pop(),_react2.default.createElement("span",_extends({tabIndex:"0",className:_this.makeClassString(),onFocus:_this.startEditing,onClick:_this.startEditing},_this.props.defaultProps),spans_and_brs)},_possibleConstructorReturn(_this,_ret=_temp)}return _inherits(RIETextArea,_RIEStatefulBase),RIETextArea}(_interopRequireDefault(require("./RIEStatefulBase")).default);exports.default=RIETextArea},{"./RIEStatefulBase":494,react:483,"react-dom":440}],497:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},_react,_react2=_interopRequireDefault(require("react")),_propTypes,_propTypes2=_interopRequireDefault(require("prop-types")),_RIEBase2,_RIEBase3;function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var RIEToggle=function(_RIEBase){function RIEToggle(){var _ref,_temp,_this,_ret;_classCallCheck(this,RIEToggle);for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];return _temp=_this=_possibleConstructorReturn(this,(_ref=RIEToggle.__proto__||Object.getPrototypeOf(RIEToggle)).call.apply(_ref,[this].concat(args))),_this.elementClick=function(e){_this.props.isDisabled||(_this.setState({value:!_this.props.value}),_this.commit(!_this.props.value))},_this.render=function(){var valueToRender=_this.state.loading?_this.state.value:_this.props.value;return _react2.default.createElement("span",_extends({tabIndex:"0",onKeyPress:_this.elementClick,onClick:_this.elementClick,className:_this.makeClassString()},_this.props.defaultProps),valueToRender?_this.props.textTrue||"yes":_this.props.textFalse||"no")},_possibleConstructorReturn(_this,_ret=_temp)}return _inherits(RIEToggle,_RIEBase),RIEToggle}(_interopRequireDefault(require("./RIEBase")).default);RIEToggle.propTypes={textTrue:_propTypes2.default.string,textFalse:_propTypes2.default.string},exports.default=RIEToggle},{"./RIEBase":491,"prop-types":426,react:483}],498:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.RIESelect=exports.RIETags=exports.RIENumber=exports.RIETextArea=exports.RIEInput=exports.RIEToggle=void 0;var _RIEToggle,_RIEToggle2=_interopRequireDefault(require("./RIEToggle")),_RIEStatefulBase2,_RIEStatefulBase3=_interopRequireDefault(require("./RIEStatefulBase")),_RIETextArea,_RIETextArea2=_interopRequireDefault(require("./RIETextArea")),_RIENumber,_RIENumber2=_interopRequireDefault(require("./RIENumber")),_RIETags,_RIETags2=_interopRequireDefault(require("./RIETags")),_RIESelect,_RIESelect2=_interopRequireDefault(require("./RIESelect"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var RIEInput=function(_RIEStatefulBase){function RIEInput(){return _classCallCheck(this,RIEInput),_possibleConstructorReturn(this,(RIEInput.__proto__||Object.getPrototypeOf(RIEInput)).apply(this,arguments))}return _inherits(RIEInput,_RIEStatefulBase),RIEInput}(_RIEStatefulBase3.default);exports.RIEToggle=_RIEToggle2.default,exports.RIEInput=RIEInput,exports.RIETextArea=_RIETextArea2.default,exports.RIENumber=_RIENumber2.default,exports.RIETags=_RIETags2.default,exports.RIESelect=_RIESelect2.default},{"./RIENumber":492,"./RIESelect":493,"./RIEStatefulBase":494,"./RIETags":495,"./RIETextArea":496,"./RIEToggle":497}],499:[function(require,module,exports){(function(process){(function(){function useColors(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type)||("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))}function formatArgs(args){var useColors=this.useColors;if(args[0]=(useColors?"%c":"")+this.namespace+(useColors?" %c":" ")+args[0]+(useColors?"%c ":" ")+"+"+exports.humanize(this.diff),useColors){var c="color: "+this.color;args.splice(1,0,c,"color: inherit");var index=0,lastC=0;args[0].replace(/%[a-zA-Z%]/g,(function(match){"%%"!==match&&(index++,"%c"===match&&(lastC=index))})),args.splice(lastC,0,c)}}function log(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function save(namespaces){try{null==namespaces?exports.storage.removeItem("debug"):exports.storage.debug=namespaces}catch(e){}}function load(){var r;try{r=exports.storage.debug}catch(e){}return!r&&void 0!==process&&"env"in process&&(r=process.env.DEBUG),r}function localstorage(){try{return window.localStorage}catch(e){}}(exports=module.exports=require("./debug")).log=log,exports.formatArgs=formatArgs,exports.save=save,exports.load=load,exports.useColors=useColors,exports.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:localstorage(),exports.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],exports.formatters.j=function(v){try{return JSON.stringify(v)}catch(err){return"[UnexpectedJSONParseError]: "+err.message}},exports.enable(load())}).call(this)}).call(this,require("_process"))},{"./debug":500,_process:422}],500:[function(require,module,exports){var prevTime;function selectColor(namespace){var hash=0,i;for(i in namespace)hash=(hash<<5)-hash+namespace.charCodeAt(i),hash|=0;return exports.colors[Math.abs(hash)%exports.colors.length]}function createDebug(namespace){function debug(){if(debug.enabled){var self=debug,curr=+new Date,ms=curr-(prevTime||curr);self.diff=ms,self.prev=prevTime,self.curr=curr,prevTime=curr;for(var args=new Array(arguments.length),i=0;i<args.length;i++)args[i]=arguments[i];args[0]=exports.coerce(args[0]),"string"!=typeof args[0]&&args.unshift("%O");var index=0;args[0]=args[0].replace(/%([a-zA-Z%])/g,(function(match,format){if("%%"===match)return match;index++;var formatter=exports.formatters[format];if("function"==typeof formatter){var val=args[index];match=formatter.call(self,val),args.splice(index,1),index--}return match})),exports.formatArgs.call(self,args);var logFn=debug.log||exports.log||console.log.bind(console);logFn.apply(self,args)}}return debug.namespace=namespace,debug.enabled=exports.enabled(namespace),debug.useColors=exports.useColors(),debug.color=selectColor(namespace),"function"==typeof exports.init&&exports.init(debug),debug}function enable(namespaces){exports.save(namespaces),exports.names=[],exports.skips=[];for(var split=("string"==typeof namespaces?namespaces:"").split(/[\s,]+/),len=split.length,i=0;i<len;i++)split[i]&&("-"===(namespaces=split[i].replace(/\*/g,".*?"))[0]?exports.skips.push(new RegExp("^"+namespaces.substr(1)+"$")):exports.names.push(new RegExp("^"+namespaces+"$")))}function disable(){exports.enable("")}function enabled(name){var i,len;for(i=0,len=exports.skips.length;i<len;i++)if(exports.skips[i].test(name))return!1;for(i=0,len=exports.names.length;i<len;i++)if(exports.names[i].test(name))return!0;return!1}function coerce(val){return val instanceof Error?val.stack||val.message:val}(exports=module.exports=createDebug.debug=createDebug.default=createDebug).coerce=coerce,exports.disable=disable,exports.enable=enable,exports.enabled=enabled,exports.humanize=require("ms"),exports.names=[],exports.skips=[],exports.formatters={}},{ms:501}],501:[function(require,module,exports){var s=1e3,m=6e4,h=36e5,d=24*h,y=315576e5;function parse(str){if(!((str=String(str)).length>100)){var match=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(str);if(match){var n=parseFloat(match[1]),type;switch((match[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return n*y;case"days":case"day":case"d":return n*d;case"hours":case"hour":case"hrs":case"hr":case"h":return n*h;case"minutes":case"minute":case"mins":case"min":case"m":return n*m;case"seconds":case"second":case"secs":case"sec":case"s":return n*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}}}function fmtShort(ms){return ms>=d?Math.round(ms/d)+"d":ms>=h?Math.round(ms/h)+"h":ms>=m?Math.round(ms/m)+"m":ms>=s?Math.round(ms/s)+"s":ms+"ms"}function fmtLong(ms){return plural(ms,d,"day")||plural(ms,h,"hour")||plural(ms,m,"minute")||plural(ms,s,"second")||ms+" ms"}function plural(ms,n,name){if(!(ms<n))return ms<1.5*n?Math.floor(ms/n)+" "+name:Math.ceil(ms/n)+" "+name+"s"}module.exports=function(val,options){options=options||{};var type=typeof val;if("string"===type&&val.length>0)return parse(val);if("number"===type&&!1===isNaN(val))return options.long?fmtLong(val):fmtShort(val);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(val))}},{}],502:[function(require,module,exports){
/** @license React v0.19.1
 * scheduler-tracing.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
"use strict";(function(){var DEFAULT_THREAD_ID=0,interactionIDCounter=0,threadIDCounter=0;function unstable_clear(callback){var prevInteractions=exports.__interactionsRef.current;exports.__interactionsRef.current=new Set;try{return callback()}finally{exports.__interactionsRef.current=prevInteractions}}function unstable_getCurrent(){return exports.__interactionsRef.current}function unstable_getThreadID(){return++threadIDCounter}function unstable_trace(name,timestamp,callback){var threadID=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,interaction={__count:1,id:interactionIDCounter++,name:name,timestamp:timestamp},prevInteractions=exports.__interactionsRef.current,interactions=new Set(prevInteractions);interactions.add(interaction),exports.__interactionsRef.current=interactions;var subscriber=exports.__subscriberRef.current,returnValue;try{null!==subscriber&&subscriber.onInteractionTraced(interaction)}finally{try{null!==subscriber&&subscriber.onWorkStarted(interactions,threadID)}finally{try{returnValue=callback()}finally{exports.__interactionsRef.current=prevInteractions;try{null!==subscriber&&subscriber.onWorkStopped(interactions,threadID)}finally{interaction.__count--,null!==subscriber&&0===interaction.__count&&subscriber.onInteractionScheduledWorkCompleted(interaction)}}}}return returnValue}function unstable_wrap(callback){var threadID=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,wrappedInteractions=exports.__interactionsRef.current,subscriber=exports.__subscriberRef.current;null!==subscriber&&subscriber.onWorkScheduled(wrappedInteractions,threadID),wrappedInteractions.forEach((function(interaction){interaction.__count++}));var hasRun=!1;function wrapped(){var prevInteractions=exports.__interactionsRef.current;exports.__interactionsRef.current=wrappedInteractions,subscriber=exports.__subscriberRef.current;try{var returnValue;try{null!==subscriber&&subscriber.onWorkStarted(wrappedInteractions,threadID)}finally{try{returnValue=callback.apply(void 0,arguments)}finally{exports.__interactionsRef.current=prevInteractions,null!==subscriber&&subscriber.onWorkStopped(wrappedInteractions,threadID)}}return returnValue}finally{hasRun||(hasRun=!0,wrappedInteractions.forEach((function(interaction){interaction.__count--,null!==subscriber&&0===interaction.__count&&subscriber.onInteractionScheduledWorkCompleted(interaction)})))}}return wrapped.cancel=function cancel(){subscriber=exports.__subscriberRef.current;try{null!==subscriber&&subscriber.onWorkCanceled(wrappedInteractions,threadID)}finally{wrappedInteractions.forEach((function(interaction){interaction.__count--,subscriber&&0===interaction.__count&&subscriber.onInteractionScheduledWorkCompleted(interaction)}))}},wrapped}exports.__interactionsRef=null,exports.__subscriberRef=null,exports.__interactionsRef={current:new Set},exports.__subscriberRef={current:null};var subscribers=null;function unstable_subscribe(subscriber){subscribers.add(subscriber),1===subscribers.size&&(exports.__subscriberRef.current={onInteractionScheduledWorkCompleted:onInteractionScheduledWorkCompleted,onInteractionTraced:onInteractionTraced,onWorkCanceled:onWorkCanceled,onWorkScheduled:onWorkScheduled,onWorkStarted:onWorkStarted,onWorkStopped:onWorkStopped})}function unstable_unsubscribe(subscriber){subscribers.delete(subscriber),0===subscribers.size&&(exports.__subscriberRef.current=null)}function onInteractionTraced(interaction){var didCatchError=!1,caughtError=null;if(subscribers.forEach((function(subscriber){try{subscriber.onInteractionTraced(interaction)}catch(error){didCatchError||(didCatchError=!0,caughtError=error)}})),didCatchError)throw caughtError}function onInteractionScheduledWorkCompleted(interaction){var didCatchError=!1,caughtError=null;if(subscribers.forEach((function(subscriber){try{subscriber.onInteractionScheduledWorkCompleted(interaction)}catch(error){didCatchError||(didCatchError=!0,caughtError=error)}})),didCatchError)throw caughtError}function onWorkScheduled(interactions,threadID){var didCatchError=!1,caughtError=null;if(subscribers.forEach((function(subscriber){try{subscriber.onWorkScheduled(interactions,threadID)}catch(error){didCatchError||(didCatchError=!0,caughtError=error)}})),didCatchError)throw caughtError}function onWorkStarted(interactions,threadID){var didCatchError=!1,caughtError=null;if(subscribers.forEach((function(subscriber){try{subscriber.onWorkStarted(interactions,threadID)}catch(error){didCatchError||(didCatchError=!0,caughtError=error)}})),didCatchError)throw caughtError}function onWorkStopped(interactions,threadID){var didCatchError=!1,caughtError=null;if(subscribers.forEach((function(subscriber){try{subscriber.onWorkStopped(interactions,threadID)}catch(error){didCatchError||(didCatchError=!0,caughtError=error)}})),didCatchError)throw caughtError}function onWorkCanceled(interactions,threadID){var didCatchError=!1,caughtError=null;if(subscribers.forEach((function(subscriber){try{subscriber.onWorkCanceled(interactions,threadID)}catch(error){didCatchError||(didCatchError=!0,caughtError=error)}})),didCatchError)throw caughtError}subscribers=new Set,exports.unstable_clear=unstable_clear,exports.unstable_getCurrent=unstable_getCurrent,exports.unstable_getThreadID=unstable_getThreadID,exports.unstable_subscribe=unstable_subscribe,exports.unstable_trace=unstable_trace,exports.unstable_unsubscribe=unstable_unsubscribe,exports.unstable_wrap=unstable_wrap})()},{}],503:[function(require,module,exports){
/** @license React v0.19.1
 * scheduler-tracing.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
"use strict";var b=0;exports.__interactionsRef=null,exports.__subscriberRef=null,exports.unstable_clear=function(a){return a()},exports.unstable_getCurrent=function(){return null},exports.unstable_getThreadID=function(){return++b},exports.unstable_subscribe=function(){},exports.unstable_trace=function(a,d,c){return c()},exports.unstable_unsubscribe=function(){},exports.unstable_wrap=function(a){return a}},{}],504:[function(require,module,exports){
/** @license React v0.19.1
 * scheduler.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
"use strict";(function(){var enableSchedulerDebugging=!1,enableProfiling=!0,requestHostCallback,requestHostTimeout,cancelHostTimeout,shouldYieldToHost,requestPaint;if("undefined"==typeof window||"function"!=typeof MessageChannel){var _callback=null,_timeoutID=null,_flushCallback=function(){if(null!==_callback)try{var currentTime=exports.unstable_now(),hasRemainingTime=!0;_callback(!0,currentTime),_callback=null}catch(e){throw setTimeout(_flushCallback,0),e}},initialTime=Date.now();exports.unstable_now=function(){return Date.now()-initialTime},requestHostCallback=function(cb){null!==_callback?setTimeout(requestHostCallback,0,cb):(_callback=cb,setTimeout(_flushCallback,0))},requestHostTimeout=function(cb,ms){_timeoutID=setTimeout(cb,ms)},cancelHostTimeout=function(){clearTimeout(_timeoutID)},shouldYieldToHost=function(){return!1},requestPaint=exports.unstable_forceFrameRate=function(){}}else{var performance=window.performance,_Date=window.Date,_setTimeout=window.setTimeout,_clearTimeout=window.clearTimeout;if("undefined"!=typeof console){var requestAnimationFrame=window.requestAnimationFrame,cancelAnimationFrame=window.cancelAnimationFrame;"function"!=typeof requestAnimationFrame&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills"),"function"!=typeof cancelAnimationFrame&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills")}if("object"==typeof performance&&"function"==typeof performance.now)exports.unstable_now=function(){return performance.now()};else{var _initialTime=_Date.now();exports.unstable_now=function(){return _Date.now()-_initialTime}}var isMessageLoopRunning=!1,scheduledHostCallback=null,taskTimeoutID=-1,yieldInterval=5,deadline=0;shouldYieldToHost=function(){return exports.unstable_now()>=deadline},requestPaint=function(){},exports.unstable_forceFrameRate=function(fps){fps<0||fps>125?console.error("forceFrameRate takes a positive int between 0 and 125, forcing framerates higher than 125 fps is not unsupported"):yieldInterval=fps>0?Math.floor(1e3/fps):5};var performWorkUntilDeadline=function(){if(null!==scheduledHostCallback){var currentTime=exports.unstable_now();deadline=currentTime+yieldInterval;var hasTimeRemaining=!0;try{var hasMoreWork;scheduledHostCallback(!0,currentTime)?port.postMessage(null):(isMessageLoopRunning=!1,scheduledHostCallback=null)}catch(error){throw port.postMessage(null),error}}else isMessageLoopRunning=!1},channel=new MessageChannel,port=channel.port2;channel.port1.onmessage=performWorkUntilDeadline,requestHostCallback=function(callback){scheduledHostCallback=callback,isMessageLoopRunning||(isMessageLoopRunning=!0,port.postMessage(null))},requestHostTimeout=function(callback,ms){taskTimeoutID=_setTimeout((function(){callback(exports.unstable_now())}),ms)},cancelHostTimeout=function(){_clearTimeout(taskTimeoutID),taskTimeoutID=-1}}function push(heap,node){var index=heap.length;heap.push(node),siftUp(heap,node,index)}function peek(heap){var first=heap[0];return void 0===first?null:first}function pop(heap){var first=heap[0];if(void 0!==first){var last=heap.pop();return last!==first&&(heap[0]=last,siftDown(heap,last,0)),first}return null}function siftUp(heap,node,i){for(var index=i;;){var parentIndex=index-1>>>1,parent=heap[parentIndex];if(!(void 0!==parent&&compare(parent,node)>0))return;heap[parentIndex]=node,heap[index]=parent,index=parentIndex}}function siftDown(heap,node,i){for(var index=i,length=heap.length;index<length;){var leftIndex=2*(index+1)-1,left=heap[leftIndex],rightIndex=leftIndex+1,right=heap[rightIndex];if(void 0!==left&&compare(left,node)<0)void 0!==right&&compare(right,left)<0?(heap[index]=right,heap[rightIndex]=node,index=rightIndex):(heap[index]=left,heap[leftIndex]=node,index=leftIndex);else{if(!(void 0!==right&&compare(right,node)<0))return;heap[index]=right,heap[rightIndex]=node,index=rightIndex}}}function compare(a,b){var diff=a.sortIndex-b.sortIndex;return 0!==diff?diff:a.id-b.id}var NoPriority=0,ImmediatePriority=1,UserBlockingPriority=2,NormalPriority=3,LowPriority=4,IdlePriority=5,runIdCounter=0,mainThreadIdCounter=0,profilingStateSize=4,sharedProfilingBuffer="function"==typeof SharedArrayBuffer?new SharedArrayBuffer(4*Int32Array.BYTES_PER_ELEMENT):"function"==typeof ArrayBuffer?new ArrayBuffer(4*Int32Array.BYTES_PER_ELEMENT):null,profilingState=null!==sharedProfilingBuffer?new Int32Array(sharedProfilingBuffer):[],PRIORITY=0,CURRENT_TASK_ID=1,CURRENT_RUN_ID=2,QUEUE_SIZE=3;profilingState[0]=0,profilingState[3]=0,profilingState[1]=0;var INITIAL_EVENT_LOG_SIZE=131072,MAX_EVENT_LOG_SIZE=524288,eventLogSize=0,eventLogBuffer=null,eventLog=null,eventLogIndex=0,TaskStartEvent=1,TaskCompleteEvent=2,TaskErrorEvent=3,TaskCancelEvent=4,TaskRunEvent=5,TaskYieldEvent=6,SchedulerSuspendEvent=7,SchedulerResumeEvent=8;function logEvent(entries){if(null!==eventLog){var offset=eventLogIndex;if((eventLogIndex+=entries.length)+1>eventLogSize){if((eventLogSize*=2)>524288)return console.error("Scheduler Profiling: Event log exceeded maximum size. Don't forget to call `stopLoggingProfilingEvents()`."),void stopLoggingProfilingEvents();var newEventLog=new Int32Array(4*eventLogSize);newEventLog.set(eventLog),eventLogBuffer=newEventLog.buffer,eventLog=newEventLog}eventLog.set(entries,offset)}}function startLoggingProfilingEvents(){eventLogSize=131072,eventLogBuffer=new ArrayBuffer(4*eventLogSize),eventLog=new Int32Array(eventLogBuffer),eventLogIndex=0}function stopLoggingProfilingEvents(){var buffer=eventLogBuffer;return eventLogSize=0,eventLogBuffer=null,eventLog=null,eventLogIndex=0,buffer}function markTaskStart(task,ms){profilingState[3]++,null!==eventLog&&logEvent([1,1e3*ms,task.id,task.priorityLevel])}function markTaskCompleted(task,ms){profilingState[0]=0,profilingState[1]=0,profilingState[3]--,null!==eventLog&&logEvent([2,1e3*ms,task.id])}function markTaskCanceled(task,ms){profilingState[3]--,null!==eventLog&&logEvent([4,1e3*ms,task.id])}function markTaskErrored(task,ms){profilingState[0]=0,profilingState[1]=0,profilingState[3]--,null!==eventLog&&logEvent([3,1e3*ms,task.id])}function markTaskRun(task,ms){runIdCounter++,profilingState[0]=task.priorityLevel,profilingState[1]=task.id,profilingState[2]=runIdCounter,null!==eventLog&&logEvent([5,1e3*ms,task.id,runIdCounter])}function markTaskYield(task,ms){profilingState[0]=0,profilingState[1]=0,profilingState[2]=0,null!==eventLog&&logEvent([6,1e3*ms,task.id,runIdCounter])}function markSchedulerSuspended(ms){mainThreadIdCounter++,null!==eventLog&&logEvent([7,1e3*ms,mainThreadIdCounter])}function markSchedulerUnsuspended(ms){null!==eventLog&&logEvent([8,1e3*ms,mainThreadIdCounter])}var maxSigned31BitInt=1073741823,IMMEDIATE_PRIORITY_TIMEOUT=-1,USER_BLOCKING_PRIORITY=250,NORMAL_PRIORITY_TIMEOUT=5e3,LOW_PRIORITY_TIMEOUT=1e4,IDLE_PRIORITY=1073741823,taskQueue=[],timerQueue=[],taskIdCounter=1,currentTask=null,currentPriorityLevel=3,isPerformingWork=!1,isHostCallbackScheduled=!1,isHostTimeoutScheduled=!1;function advanceTimers(currentTime){for(var timer=peek(timerQueue);null!==timer;){if(null===timer.callback)pop(timerQueue);else{if(!(timer.startTime<=currentTime))return;pop(timerQueue),timer.sortIndex=timer.expirationTime,push(taskQueue,timer),markTaskStart(timer,currentTime),timer.isQueued=!0}timer=peek(timerQueue)}}function handleTimeout(currentTime){if(isHostTimeoutScheduled=!1,advanceTimers(currentTime),!isHostCallbackScheduled)if(null!==peek(taskQueue))isHostCallbackScheduled=!0,requestHostCallback(flushWork);else{var firstTimer=peek(timerQueue);null!==firstTimer&&requestHostTimeout(handleTimeout,firstTimer.startTime-currentTime)}}function flushWork(hasTimeRemaining,initialTime){markSchedulerUnsuspended(initialTime),isHostCallbackScheduled=!1,isHostTimeoutScheduled&&(isHostTimeoutScheduled=!1,cancelHostTimeout()),isPerformingWork=!0;var previousPriorityLevel=currentPriorityLevel;try{try{return workLoop(hasTimeRemaining,initialTime)}catch(error){if(null!==currentTask){var currentTime=exports.unstable_now();markTaskErrored(currentTask,currentTime),currentTask.isQueued=!1}throw error}}finally{var _currentTime;currentTask=null,currentPriorityLevel=previousPriorityLevel,isPerformingWork=!1,markSchedulerSuspended(exports.unstable_now())}}function workLoop(hasTimeRemaining,initialTime){var currentTime=initialTime;for(advanceTimers(currentTime),currentTask=peek(taskQueue);null!==currentTask&&(!(currentTask.expirationTime>currentTime)||hasTimeRemaining&&!shouldYieldToHost());){var callback=currentTask.callback;if(null!==callback){currentTask.callback=null,currentPriorityLevel=currentTask.priorityLevel;var didUserCallbackTimeout=currentTask.expirationTime<=currentTime;markTaskRun(currentTask,currentTime);var continuationCallback=callback(didUserCallbackTimeout);currentTime=exports.unstable_now(),"function"==typeof continuationCallback?(currentTask.callback=continuationCallback,markTaskYield(currentTask,currentTime)):(markTaskCompleted(currentTask,currentTime),currentTask.isQueued=!1,currentTask===peek(taskQueue)&&pop(taskQueue)),advanceTimers(currentTime)}else pop(taskQueue);currentTask=peek(taskQueue)}if(null!==currentTask)return!0;var firstTimer=peek(timerQueue);return null!==firstTimer&&requestHostTimeout(handleTimeout,firstTimer.startTime-currentTime),!1}function unstable_runWithPriority(priorityLevel,eventHandler){switch(priorityLevel){case 1:case 2:case 3:case 4:case 5:break;default:priorityLevel=3}var previousPriorityLevel=currentPriorityLevel;currentPriorityLevel=priorityLevel;try{return eventHandler()}finally{currentPriorityLevel=previousPriorityLevel}}function unstable_next(eventHandler){var priorityLevel;switch(currentPriorityLevel){case 1:case 2:case 3:priorityLevel=3;break;default:priorityLevel=currentPriorityLevel}var previousPriorityLevel=currentPriorityLevel;currentPriorityLevel=priorityLevel;try{return eventHandler()}finally{currentPriorityLevel=previousPriorityLevel}}function unstable_wrapCallback(callback){var parentPriorityLevel=currentPriorityLevel;return function(){var previousPriorityLevel=currentPriorityLevel;currentPriorityLevel=parentPriorityLevel;try{return callback.apply(this,arguments)}finally{currentPriorityLevel=previousPriorityLevel}}}function timeoutForPriorityLevel(priorityLevel){switch(priorityLevel){case 1:return-1;case 2:return 250;case 5:return 1073741823;case 4:return 1e4;case 3:default:return 5e3}}function unstable_scheduleCallback(priorityLevel,callback,options){var currentTime=exports.unstable_now(),startTime,timeout;if("object"==typeof options&&null!==options){var delay=options.delay;startTime="number"==typeof delay&&delay>0?currentTime+delay:currentTime,timeout="number"==typeof options.timeout?options.timeout:timeoutForPriorityLevel(priorityLevel)}else timeout=timeoutForPriorityLevel(priorityLevel),startTime=currentTime;var expirationTime=startTime+timeout,newTask={id:taskIdCounter++,callback:callback,priorityLevel:priorityLevel,startTime:startTime,expirationTime:expirationTime,sortIndex:-1,isQueued:!1};return startTime>currentTime?(newTask.sortIndex=startTime,push(timerQueue,newTask),null===peek(taskQueue)&&newTask===peek(timerQueue)&&(isHostTimeoutScheduled?cancelHostTimeout():isHostTimeoutScheduled=!0,requestHostTimeout(handleTimeout,startTime-currentTime))):(newTask.sortIndex=expirationTime,push(taskQueue,newTask),markTaskStart(newTask,currentTime),newTask.isQueued=!0,isHostCallbackScheduled||isPerformingWork||(isHostCallbackScheduled=!0,requestHostCallback(flushWork))),newTask}function unstable_pauseExecution(){}function unstable_continueExecution(){isHostCallbackScheduled||isPerformingWork||(isHostCallbackScheduled=!0,requestHostCallback(flushWork))}function unstable_getFirstCallbackNode(){return peek(taskQueue)}function unstable_cancelCallback(task){var currentTime;task.isQueued&&(markTaskCanceled(task,exports.unstable_now()),task.isQueued=!1);task.callback=null}function unstable_getCurrentPriorityLevel(){return currentPriorityLevel}function unstable_shouldYield(){var currentTime=exports.unstable_now();advanceTimers(currentTime);var firstTask=peek(taskQueue);return firstTask!==currentTask&&null!==currentTask&&null!==firstTask&&null!==firstTask.callback&&firstTask.startTime<=currentTime&&firstTask.expirationTime<currentTask.expirationTime||shouldYieldToHost()}var unstable_requestPaint=requestPaint,unstable_Profiling={startLoggingProfilingEvents:startLoggingProfilingEvents,stopLoggingProfilingEvents:stopLoggingProfilingEvents,sharedProfilingBuffer:sharedProfilingBuffer};exports.unstable_IdlePriority=5,exports.unstable_ImmediatePriority=1,exports.unstable_LowPriority=4,exports.unstable_NormalPriority=3,exports.unstable_Profiling=unstable_Profiling,exports.unstable_UserBlockingPriority=2,exports.unstable_cancelCallback=unstable_cancelCallback,exports.unstable_continueExecution=unstable_continueExecution,exports.unstable_getCurrentPriorityLevel=unstable_getCurrentPriorityLevel,exports.unstable_getFirstCallbackNode=unstable_getFirstCallbackNode,exports.unstable_next=unstable_next,exports.unstable_pauseExecution=unstable_pauseExecution,exports.unstable_requestPaint=unstable_requestPaint,exports.unstable_runWithPriority=unstable_runWithPriority,exports.unstable_scheduleCallback=unstable_scheduleCallback,exports.unstable_shouldYield=unstable_shouldYield,exports.unstable_wrapCallback=unstable_wrapCallback})()},{}],505:[function(require,module,exports){
/** @license React v0.19.1
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
"use strict";var f,g,h,k,l;if("undefined"==typeof window||"function"!=typeof MessageChannel){var p=null,q=null,t=function(){if(null!==p)try{var a=exports.unstable_now();p(!0,a),p=null}catch(b){throw setTimeout(t,0),b}},u=Date.now();exports.unstable_now=function(){return Date.now()-u},f=function(a){null!==p?setTimeout(f,0,a):(p=a,setTimeout(t,0))},g=function(a,b){q=setTimeout(a,b)},h=function(){clearTimeout(q)},k=function(){return!1},l=exports.unstable_forceFrameRate=function(){}}else{var w=window.performance,x=window.Date,y=window.setTimeout,z=window.clearTimeout;if("undefined"!=typeof console){var A=window.cancelAnimationFrame;"function"!=typeof window.requestAnimationFrame&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills"),"function"!=typeof A&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills")}if("object"==typeof w&&"function"==typeof w.now)exports.unstable_now=function(){return w.now()};else{var B=x.now();exports.unstable_now=function(){return x.now()-B}}var C=!1,D=null,E=-1,F=5,G=0;k=function(){return exports.unstable_now()>=G},l=function(){},exports.unstable_forceFrameRate=function(a){0>a||125<a?console.error("forceFrameRate takes a positive int between 0 and 125, forcing framerates higher than 125 fps is not unsupported"):F=0<a?Math.floor(1e3/a):5};var H=new MessageChannel,I=H.port2;H.port1.onmessage=function(){if(null!==D){var a=exports.unstable_now();G=a+F;try{D(!0,a)?I.postMessage(null):(C=!1,D=null)}catch(b){throw I.postMessage(null),b}}else C=!1},f=function(a){D=a,C||(C=!0,I.postMessage(null))},g=function(a,b){E=y((function(){a(exports.unstable_now())}),b)},h=function(){z(E),E=-1}}function J(a,b){var c=a.length;a.push(b);a:for(;;){var d=c-1>>>1,e=a[d];if(!(void 0!==e&&0<K(e,b)))break a;a[d]=b,a[c]=e,c=d}}function L(a){return void 0===(a=a[0])?null:a}function M(a){var b=a[0];if(void 0!==b){var c=a.pop();if(c!==b){a[0]=c;a:for(var d=0,e=a.length;d<e;){var m=2*(d+1)-1,n=a[m],v=m+1,r=a[v];if(void 0!==n&&0>K(n,c))void 0!==r&&0>K(r,n)?(a[d]=r,a[v]=c,d=v):(a[d]=n,a[m]=c,d=m);else{if(!(void 0!==r&&0>K(r,c)))break a;a[d]=r,a[v]=c,d=v}}}return b}return null}function K(a,b){var c=a.sortIndex-b.sortIndex;return 0!==c?c:a.id-b.id}var N=[],O=[],P=1,Q=null,R=3,S=!1,T=!1,U=!1;function V(a){for(var b=L(O);null!==b;){if(null===b.callback)M(O);else{if(!(b.startTime<=a))break;M(O),b.sortIndex=b.expirationTime,J(N,b)}b=L(O)}}function W(a){if(U=!1,V(a),!T)if(null!==L(N))T=!0,f(X);else{var b=L(O);null!==b&&g(W,b.startTime-a)}}function X(a,b){T=!1,U&&(U=!1,h()),S=!0;var c=R;try{for(V(b),Q=L(N);null!==Q&&(!(Q.expirationTime>b)||a&&!k());){var d=Q.callback;if(null!==d){Q.callback=null,R=Q.priorityLevel;var e=d(Q.expirationTime<=b);b=exports.unstable_now(),"function"==typeof e?Q.callback=e:Q===L(N)&&M(N),V(b)}else M(N);Q=L(N)}if(null!==Q)var m=!0;else{var n=L(O);null!==n&&g(W,n.startTime-b),m=!1}return m}finally{Q=null,R=c,S=!1}}function Y(a){switch(a){case 1:return-1;case 2:return 250;case 5:return 1073741823;case 4:return 1e4;default:return 5e3}}var Z=l;exports.unstable_IdlePriority=5,exports.unstable_ImmediatePriority=1,exports.unstable_LowPriority=4,exports.unstable_NormalPriority=3,exports.unstable_Profiling=null,exports.unstable_UserBlockingPriority=2,exports.unstable_cancelCallback=function(a){a.callback=null},exports.unstable_continueExecution=function(){T||S||(T=!0,f(X))},exports.unstable_getCurrentPriorityLevel=function(){return R},exports.unstable_getFirstCallbackNode=function(){return L(N)},exports.unstable_next=function(a){switch(R){case 1:case 2:case 3:var b=3;break;default:b=R}var c=R;R=b;try{return a()}finally{R=c}},exports.unstable_pauseExecution=function(){},exports.unstable_requestPaint=Z,exports.unstable_runWithPriority=function(a,b){switch(a){case 1:case 2:case 3:case 4:case 5:break;default:a=3}var c=R;R=a;try{return b()}finally{R=c}},exports.unstable_scheduleCallback=function(a,b,c){var d=exports.unstable_now();if("object"==typeof c&&null!==c){var e=c.delay;e="number"==typeof e&&0<e?d+e:d,c="number"==typeof c.timeout?c.timeout:Y(a)}else c=Y(a),e=d;return a={id:P++,callback:b,priorityLevel:a,startTime:e,expirationTime:c=e+c,sortIndex:-1},e>d?(a.sortIndex=e,J(O,a),null===L(N)&&a===L(O)&&(U?h():U=!0,g(W,e-d))):(a.sortIndex=c,J(N,a),T||S||(T=!0,f(X))),a},exports.unstable_shouldYield=function(){var a=exports.unstable_now();V(a);var b=L(N);return b!==Q&&null!==Q&&null!==b&&null!==b.callback&&b.startTime<=a&&b.expirationTime<Q.expirationTime||k()},exports.unstable_wrapCallback=function(a){var b=R;return function(){var c=R;R=b;try{return a.apply(this,arguments)}finally{R=c}}}},{}],506:[function(require,module,exports){"use strict";module.exports=require("./cjs/scheduler.development.js")},{"./cjs/scheduler.development.js":504,"./cjs/scheduler.production.min.js":505}],507:[function(require,module,exports){"use strict";module.exports=require("./cjs/scheduler-tracing.development.js")},{"./cjs/scheduler-tracing.development.js":502,"./cjs/scheduler-tracing.production.min.js":503}],508:[function(require,module,exports){var grammar=module.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(o){return o.encoding?"rtpmap:%d %s/%s/%s":o.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(o){return null!=o.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(o){return null!=o.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(o){return"extmap:%d"+(o.direction?"/%s":"%v")+(o["encrypt-uri"]?" %s":"%v")+" %s"+(o.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(o){return null!=o.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(o){var str="candidate:%s %d %s %d %s %d typ %s";return str+=null!=o.raddr?" raddr %s rport %d":"%v%v",str+=null!=o.tcptype?" tcptype %s":"%v",null!=o.generation&&(str+=" generation %d"),str+=null!=o["network-id"]?" network-id %d":"%v",str+=null!=o["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(o){var str="ssrc:%d";return null!=o.attribute&&(str+=" %s",null!=o.value&&(str+=":%s")),str}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(o){return null!=o.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(o){return o.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(o){return"imageattr:%s %s %s"+(o.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(o){return"simulcast:%s %s"+(o.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(o){return"ts-refclk:%s"+(null!=o.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(o){var str="mediaclk:";return str+=null!=o.id?"id=%s %s":"%v%s",str+=null!=o.mediaClockValue?"=%s":"",str+=null!=o.rateNumerator?" rate=%s":"",str+=null!=o.rateDenominator?"/%s":""}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(grammar).forEach((function(key){var objs;grammar[key].forEach((function(obj){obj.reg||(obj.reg=/(.*)/),obj.format||(obj.format="%s")}))}))},{}],509:[function(require,module,exports){var parser=require("./parser"),writer=require("./writer");exports.write=writer,exports.parse=parser.parse,exports.parseParams=parser.parseParams,exports.parseFmtpConfig=parser.parseFmtpConfig,exports.parsePayloads=parser.parsePayloads,exports.parseRemoteCandidates=parser.parseRemoteCandidates,exports.parseImageAttributes=parser.parseImageAttributes,exports.parseSimulcastStreamList=parser.parseSimulcastStreamList},{"./parser":510,"./writer":511}],510:[function(require,module,exports){var toIntIfInt=function(v){return String(Number(v))===v?Number(v):v},attachProperties=function(match,location,names,rawName){if(rawName&&!names)location[rawName]=toIntIfInt(match[1]);else for(var i=0;i<names.length;i+=1)null!=match[i+1]&&(location[names[i]]=toIntIfInt(match[i+1]))},parseReg=function(obj,location,content){var needsBlank=obj.name&&obj.names;obj.push&&!location[obj.push]?location[obj.push]=[]:needsBlank&&!location[obj.name]&&(location[obj.name]={});var keyLocation=obj.push?{}:needsBlank?location[obj.name]:location;attachProperties(content.match(obj.reg),keyLocation,obj.names,obj.name),obj.push&&location[obj.push].push(keyLocation)},grammar=require("./grammar"),validLine=RegExp.prototype.test.bind(/^([a-z])=(.*)/);exports.parse=function(sdp){var session={},media=[],location=session;return sdp.split(/(\r\n|\r|\n)/).filter(validLine).forEach((function(l){var type=l[0],content=l.slice(2);"m"===type&&(media.push({rtp:[],fmtp:[]}),location=media[media.length-1]);for(var j=0;j<(grammar[type]||[]).length;j+=1){var obj=grammar[type][j];if(obj.reg.test(content))return parseReg(obj,location,content)}})),session.media=media,session};var paramReducer=function(acc,expr){var s=expr.split(/=(.+)/,2);return 2===s.length?acc[s[0]]=toIntIfInt(s[1]):1===s.length&&expr.length>1&&(acc[s[0]]=void 0),acc};exports.parseParams=function(str){return str.split(/;\s?/).reduce(paramReducer,{})},exports.parseFmtpConfig=exports.parseParams,exports.parsePayloads=function(str){return str.toString().split(" ").map(Number)},exports.parseRemoteCandidates=function(str){for(var candidates=[],parts=str.split(" ").map(toIntIfInt),i=0;i<parts.length;i+=3)candidates.push({component:parts[i],ip:parts[i+1],port:parts[i+2]});return candidates},exports.parseImageAttributes=function(str){return str.split(" ").map((function(item){return item.substring(1,item.length-1).split(",").reduce(paramReducer,{})}))},exports.parseSimulcastStreamList=function(str){return str.split(";").map((function(stream){return stream.split(",").map((function(format){var scid,paused=!1;return"~"!==format[0]?scid=toIntIfInt(format):(scid=toIntIfInt(format.substring(1,format.length)),paused=!0),{scid:scid,paused:paused}}))}))}},{"./grammar":508}],511:[function(require,module,exports){var grammar=require("./grammar"),formatRegExp=/%[sdv%]/g,format=function(formatStr){var i=1,args=arguments,len=args.length;return formatStr.replace(formatRegExp,(function(x){if(i>=len)return x;var arg=args[i];switch(i+=1,x){case"%%":return"%";case"%s":return String(arg);case"%d":return Number(arg);case"%v":return""}}))},makeLine=function(type,obj,location){var str,args=[type+"="+(obj.format instanceof Function?obj.format(obj.push?location:location[obj.name]):obj.format)];if(obj.names)for(var i=0;i<obj.names.length;i+=1){var n=obj.names[i];obj.name?args.push(location[obj.name][n]):args.push(location[obj.names[i]])}else args.push(location[obj.name]);return format.apply(null,args)},defaultOuterOrder=["v","o","s","i","u","e","p","c","b","t","r","z","a"],defaultInnerOrder=["i","c","b","a"];module.exports=function(session,opts){opts=opts||{},null==session.version&&(session.version=0),null==session.name&&(session.name=" "),session.media.forEach((function(mLine){null==mLine.payloads&&(mLine.payloads="")}));var outerOrder=opts.outerOrder||defaultOuterOrder,innerOrder=opts.innerOrder||defaultInnerOrder,sdp=[];return outerOrder.forEach((function(type){grammar[type].forEach((function(obj){obj.name in session&&null!=session[obj.name]?sdp.push(makeLine(type,obj,session)):obj.push in session&&null!=session[obj.push]&&session[obj.push].forEach((function(el){sdp.push(makeLine(type,obj,el))}))}))})),session.media.forEach((function(mLine){sdp.push(makeLine("m",grammar.m[0],mLine)),innerOrder.forEach((function(type){grammar[type].forEach((function(obj){obj.name in mLine&&null!=mLine[obj.name]?sdp.push(makeLine(type,obj,mLine)):obj.push in mLine&&null!=mLine[obj.push]&&mLine[obj.push].forEach((function(el){sdp.push(makeLine(type,obj,el))}))}))}))})),sdp.join("\r\n")+"\r\n"}},{"./grammar":508}],512:[function(require,module,exports){var alea=require("./lib/alea"),xor128=require("./lib/xor128"),xorwow=require("./lib/xorwow"),xorshift7=require("./lib/xorshift7"),xor4096=require("./lib/xor4096"),tychei=require("./lib/tychei"),sr=require("./seedrandom");sr.alea=alea,sr.xor128=xor128,sr.xorwow=xorwow,sr.xorshift7=xorshift7,sr.xor4096=xor4096,sr.tychei=tychei,module.exports=sr},{"./lib/alea":513,"./lib/tychei":514,"./lib/xor128":515,"./lib/xor4096":516,"./lib/xorshift7":517,"./lib/xorwow":518,"./seedrandom":519}],513:[function(require,module,exports){!function(global,module,define){function Alea(seed){var me=this,mash=Mash();me.next=function(){var t=2091639*me.s0+2.3283064365386963e-10*me.c;return me.s0=me.s1,me.s1=me.s2,me.s2=t-(me.c=0|t)},me.c=1,me.s0=mash(" "),me.s1=mash(" "),me.s2=mash(" "),me.s0-=mash(seed),me.s0<0&&(me.s0+=1),me.s1-=mash(seed),me.s1<0&&(me.s1+=1),me.s2-=mash(seed),me.s2<0&&(me.s2+=1),mash=null}function copy(f,t){return t.c=f.c,t.s0=f.s0,t.s1=f.s1,t.s2=f.s2,t}function impl(seed,opts){var xg=new Alea(seed),state=opts&&opts.state,prng=xg.next;return prng.int32=function(){return 4294967296*xg.next()|0},prng.double=function(){return prng()+11102230246251565e-32*(2097152*prng()|0)},prng.quick=prng,state&&("object"==typeof state&&copy(state,xg),prng.state=function(){return copy(xg,{})}),prng}function Mash(){var n=4022871197,mash;return function(data){data=data.toString();for(var i=0;i<data.length;i++){var h=.02519603282416938*(n+=data.charCodeAt(i));h-=n=h>>>0,n=(h*=n)>>>0,n+=4294967296*(h-=n)}return 2.3283064365386963e-10*(n>>>0)}}module&&module.exports?module.exports=impl:define&&define.amd?define((function(){return impl})):this.alea=impl}(this,"object"==typeof module&&module,"function"==typeof define&&define)},{}],514:[function(require,module,exports){!function(global,module,define){function XorGen(seed){var me=this,strseed="";me.next=function(){var b=me.b,c=me.c,d=me.d,a=me.a;return b=b<<25^b>>>7^c,c=c-d|0,d=d<<24^d>>>8^a,a=a-b|0,me.b=b=b<<20^b>>>12^c,me.c=c=c-d|0,me.d=d<<16^c>>>16^a,me.a=a-b|0},me.a=0,me.b=0,me.c=-1640531527,me.d=1367130551,seed===Math.floor(seed)?(me.a=seed/4294967296|0,me.b=0|seed):strseed+=seed;for(var k=0;k<strseed.length+20;k++)me.b^=0|strseed.charCodeAt(k),me.next()}function copy(f,t){return t.a=f.a,t.b=f.b,t.c=f.c,t.d=f.d,t}function impl(seed,opts){var xg=new XorGen(seed),state=opts&&opts.state,prng=function(){return(xg.next()>>>0)/4294967296};return prng.double=function(){do{var top,bot,result=((xg.next()>>>11)+(xg.next()>>>0)/4294967296)/(1<<21)}while(0===result);return result},prng.int32=xg.next,prng.quick=prng,state&&("object"==typeof state&&copy(state,xg),prng.state=function(){return copy(xg,{})}),prng}module&&module.exports?module.exports=impl:define&&define.amd?define((function(){return impl})):this.tychei=impl}(this,"object"==typeof module&&module,"function"==typeof define&&define)},{}],515:[function(require,module,exports){!function(global,module,define){function XorGen(seed){var me=this,strseed="";me.x=0,me.y=0,me.z=0,me.w=0,me.next=function(){var t=me.x^me.x<<11;return me.x=me.y,me.y=me.z,me.z=me.w,me.w^=me.w>>>19^t^t>>>8},seed===(0|seed)?me.x=seed:strseed+=seed;for(var k=0;k<strseed.length+64;k++)me.x^=0|strseed.charCodeAt(k),me.next()}function copy(f,t){return t.x=f.x,t.y=f.y,t.z=f.z,t.w=f.w,t}function impl(seed,opts){var xg=new XorGen(seed),state=opts&&opts.state,prng=function(){return(xg.next()>>>0)/4294967296};return prng.double=function(){do{var top,bot,result=((xg.next()>>>11)+(xg.next()>>>0)/4294967296)/(1<<21)}while(0===result);return result},prng.int32=xg.next,prng.quick=prng,state&&("object"==typeof state&&copy(state,xg),prng.state=function(){return copy(xg,{})}),prng}module&&module.exports?module.exports=impl:define&&define.amd?define((function(){return impl})):this.xor128=impl}(this,"object"==typeof module&&module,"function"==typeof define&&define)},{}],516:[function(require,module,exports){!function(global,module,define){function XorGen(seed){var me=this;function init(me,seed){var t,v,i,j,w,X=[],limit=128;for(seed===(0|seed)?(v=seed,seed=null):(seed+="\0",v=0,limit=Math.max(limit,seed.length)),i=0,j=-32;j<limit;++j)seed&&(v^=seed.charCodeAt((j+32)%seed.length)),0===j&&(w=v),v^=v<<10,v^=v>>>15,v^=v<<4,v^=v>>>13,j>=0&&(w=w+1640531527|0,i=0==(t=X[127&j]^=v+w)?i+1:0);for(i>=128&&(X[127&(seed&&seed.length||0)]=-1),i=127,j=512;j>0;--j)v=X[i+34&127],t=X[i=i+1&127],v^=v<<13,t^=t<<17,v^=v>>>15,t^=t>>>12,X[i]=v^t;me.w=w,me.X=X,me.i=i}me.next=function(){var w=me.w,X=me.X,i=me.i,t,v;return me.w=w=w+1640531527|0,v=X[i+34&127],t=X[i=i+1&127],v^=v<<13,t^=t<<17,v^=v>>>15,t^=t>>>12,v=X[i]=v^t,me.i=i,v+(w^w>>>16)|0},init(me,seed)}function copy(f,t){return t.i=f.i,t.w=f.w,t.X=f.X.slice(),t}function impl(seed,opts){null==seed&&(seed=+new Date);var xg=new XorGen(seed),state=opts&&opts.state,prng=function(){return(xg.next()>>>0)/4294967296};return prng.double=function(){do{var top,bot,result=((xg.next()>>>11)+(xg.next()>>>0)/4294967296)/(1<<21)}while(0===result);return result},prng.int32=xg.next,prng.quick=prng,state&&(state.X&&copy(state,xg),prng.state=function(){return copy(xg,{})}),prng}module&&module.exports?module.exports=impl:define&&define.amd?define((function(){return impl})):this.xor4096=impl}(this,"object"==typeof module&&module,"function"==typeof define&&define)},{}],517:[function(require,module,exports){!function(global,module,define){function XorGen(seed){var me=this;function init(me,seed){var j,w,X=[];if(seed===(0|seed))w=X[0]=seed;else for(seed=""+seed,j=0;j<seed.length;++j)X[7&j]=X[7&j]<<15^seed.charCodeAt(j)+X[j+1&7]<<13;for(;X.length<8;)X.push(0);for(j=0;j<8&&0===X[j];++j);for(w=8==j?X[7]=-1:X[j],me.x=X,me.i=0,j=256;j>0;--j)me.next()}me.next=function(){var X=me.x,i=me.i,t,v,w;return t=X[i],v=(t^=t>>>7)^t<<24,v^=(t=X[i+1&7])^t>>>10,v^=(t=X[i+3&7])^t>>>3,v^=(t=X[i+4&7])^t<<7,t=X[i+7&7],v^=(t^=t<<13)^t<<9,X[i]=v,me.i=i+1&7,v},init(me,seed)}function copy(f,t){return t.x=f.x.slice(),t.i=f.i,t}function impl(seed,opts){null==seed&&(seed=+new Date);var xg=new XorGen(seed),state=opts&&opts.state,prng=function(){return(xg.next()>>>0)/4294967296};return prng.double=function(){do{var top,bot,result=((xg.next()>>>11)+(xg.next()>>>0)/4294967296)/(1<<21)}while(0===result);return result},prng.int32=xg.next,prng.quick=prng,state&&(state.x&&copy(state,xg),prng.state=function(){return copy(xg,{})}),prng}module&&module.exports?module.exports=impl:define&&define.amd?define((function(){return impl})):this.xorshift7=impl}(this,"object"==typeof module&&module,"function"==typeof define&&define)},{}],518:[function(require,module,exports){!function(global,module,define){function XorGen(seed){var me=this,strseed="";me.next=function(){var t=me.x^me.x>>>2;return me.x=me.y,me.y=me.z,me.z=me.w,me.w=me.v,(me.d=me.d+362437|0)+(me.v=me.v^me.v<<4^t^t<<1)|0},me.x=0,me.y=0,me.z=0,me.w=0,me.v=0,seed===(0|seed)?me.x=seed:strseed+=seed;for(var k=0;k<strseed.length+64;k++)me.x^=0|strseed.charCodeAt(k),k==strseed.length&&(me.d=me.x<<10^me.x>>>4),me.next()}function copy(f,t){return t.x=f.x,t.y=f.y,t.z=f.z,t.w=f.w,t.v=f.v,t.d=f.d,t}function impl(seed,opts){var xg=new XorGen(seed),state=opts&&opts.state,prng=function(){return(xg.next()>>>0)/4294967296};return prng.double=function(){do{var top,bot,result=((xg.next()>>>11)+(xg.next()>>>0)/4294967296)/(1<<21)}while(0===result);return result},prng.int32=xg.next,prng.quick=prng,state&&("object"==typeof state&&copy(state,xg),prng.state=function(){return copy(xg,{})}),prng}module&&module.exports?module.exports=impl:define&&define.amd?define((function(){return impl})):this.xorwow=impl}(this,"object"==typeof module&&module,"function"==typeof define&&define)},{}],519:[function(require,module,exports){!function(pool,math){var global=this,width=256,chunks=6,digits=52,rngname="random",startdenom=math.pow(256,6),significance=math.pow(2,52),overflow=2*significance,mask=255,nodecrypto;function seedrandom(seed,options,callback){var key=[],shortseed=mixkey(flatten((options=1==options?{entropy:!0}:options||{}).entropy?[seed,tostring(pool)]:null==seed?autoseed():seed,3),key),arc4=new ARC4(key),prng=function(){for(var n=arc4.g(6),d=startdenom,x=0;n<significance;)n=256*(n+x),d*=256,x=arc4.g(1);for(;n>=overflow;)n/=2,d/=2,x>>>=1;return(n+x)/d};return prng.int32=function(){return 0|arc4.g(4)},prng.quick=function(){return arc4.g(4)/4294967296},prng.double=prng,mixkey(tostring(arc4.S),pool),(options.pass||callback||function(prng,seed,is_math_call,state){return state&&(state.S&&copy(state,arc4),prng.state=function(){return copy(arc4,{})}),is_math_call?(math.random=prng,seed):prng})(prng,shortseed,"global"in options?options.global:this==math,options.state)}function ARC4(key){var t,keylen=key.length,me=this,i=0,j=me.i=me.j=0,s=me.S=[];for(keylen||(key=[keylen++]);i<256;)s[i]=i++;for(i=0;i<256;i++)s[i]=s[j=255&j+key[i%keylen]+(t=s[i])],s[j]=t;(me.g=function(count){for(var t,r=0,i=me.i,j=me.j,s=me.S;count--;)t=s[i=255&i+1],r=256*r+s[255&(s[i]=s[j=255&j+t])+(s[j]=t)];return me.i=i,me.j=j,r})(256)}function copy(f,t){return t.i=f.i,t.j=f.j,t.S=f.S.slice(),t}function flatten(obj,depth){var result=[],typ=typeof obj,prop;if(depth&&"object"==typ)for(prop in obj)try{result.push(flatten(obj[prop],depth-1))}catch(e){}return result.length?result:"string"==typ?obj:obj+"\0"}function mixkey(seed,key){for(var stringseed=seed+"",smear,j=0;j<stringseed.length;)key[255&j]=255&(smear^=19*key[255&j])+stringseed.charCodeAt(j++);return tostring(key)}function autoseed(){try{var out;return nodecrypto&&(out=nodecrypto.randomBytes)?out=out(256):(out=new Uint8Array(256),(global.crypto||global.msCrypto).getRandomValues(out)),tostring(out)}catch(e){var browser=global.navigator,plugins=browser&&browser.plugins;return[+new Date,global,plugins,global.screen,tostring(pool)]}}function tostring(a){return String.fromCharCode.apply(0,a)}if(math.seedrandom=seedrandom,mixkey(math.random(),pool),"object"==typeof module&&module.exports){module.exports=seedrandom;try{nodecrypto=require("crypto")}catch(ex){}}else"function"==typeof define&&define.amd&&define((function(){return seedrandom}))}([],Math)},{crypto:254}],520:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),tf=require("@tensorflow/tfjs-core"),getModelUris_1=require("./common/getModelUris"),dom_1=require("./dom"),env_1=require("./env"),NeuralNetwork=function(){function NeuralNetwork(_name){this._name=_name,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(NeuralNetwork.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(NeuralNetwork.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(NeuralNetwork.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),NeuralNetwork.prototype.getParamFromPath=function(paramPath){var _a=this.traversePropertyPath(paramPath),obj,objProp;return _a.obj[_a.objProp]},NeuralNetwork.prototype.reassignParamFromPath=function(paramPath,tensor){var _a=this.traversePropertyPath(paramPath),obj=_a.obj,objProp=_a.objProp;obj[objProp].dispose(),obj[objProp]=tensor},NeuralNetwork.prototype.getParamList=function(){var _this=this;return this._paramMappings.map((function(_a){var paramPath=_a.paramPath;return{path:paramPath,tensor:_this.getParamFromPath(paramPath)}}))},NeuralNetwork.prototype.getTrainableParams=function(){return this.getParamList().filter((function(param){return param.tensor instanceof tf.Variable}))},NeuralNetwork.prototype.getFrozenParams=function(){return this.getParamList().filter((function(param){return!(param.tensor instanceof tf.Variable)}))},NeuralNetwork.prototype.variable=function(){var _this=this;this.getFrozenParams().forEach((function(_a){var path=_a.path,tensor=_a.tensor;_this.reassignParamFromPath(path,tensor.variable())}))},NeuralNetwork.prototype.freeze=function(){var _this=this;this.getTrainableParams().forEach((function(_a){var path=_a.path,variable=_a.tensor,tensor=tf.tensor(variable.dataSync());variable.dispose(),_this.reassignParamFromPath(path,tensor)}))},NeuralNetwork.prototype.dispose=function(throwOnRedispose){void 0===throwOnRedispose&&(throwOnRedispose=!0),this.getParamList().forEach((function(param){if(throwOnRedispose&&param.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+param.path);param.tensor.dispose()})),this._params=void 0},NeuralNetwork.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map((function(_a){var tensor=_a.tensor;return Array.from(tensor.dataSync())})).reduce((function(flat,arr){return flat.concat(arr)})))},NeuralNetwork.prototype.load=function(weightsOrUrl){return tslib_1.__awaiter(this,void 0,void 0,(function(){return tslib_1.__generator(this,(function(_a){switch(_a.label){case 0:return weightsOrUrl instanceof Float32Array?(this.extractWeights(weightsOrUrl),[2]):[4,this.loadFromUri(weightsOrUrl)];case 1:return _a.sent(),[2]}}))}))},NeuralNetwork.prototype.loadFromUri=function(uri){return tslib_1.__awaiter(this,void 0,void 0,(function(){var weightMap;return tslib_1.__generator(this,(function(_a){switch(_a.label){case 0:if(uri&&"string"!=typeof uri)throw new Error(this._name+".loadFromUri - expected model uri");return[4,dom_1.loadWeightMap(uri,this.getDefaultModelName())];case 1:return weightMap=_a.sent(),this.loadFromWeightMap(weightMap),[2]}}))}))},NeuralNetwork.prototype.loadFromDisk=function(filePath){return tslib_1.__awaiter(this,void 0,void 0,(function(){var readFile,_a,manifestUri,modelBaseUri,fetchWeightsFromDisk,loadWeights,manifest,_b,_c,weightMap;return tslib_1.__generator(this,(function(_d){switch(_d.label){case 0:if(filePath&&"string"!=typeof filePath)throw new Error(this._name+".loadFromDisk - expected model file path");return readFile=env_1.env.getEnv().readFile,_a=getModelUris_1.getModelUris(filePath,this.getDefaultModelName()),manifestUri=_a.manifestUri,modelBaseUri=_a.modelBaseUri,fetchWeightsFromDisk=function(filePaths){return Promise.all(filePaths.map((function(filePath){return readFile(filePath).then((function(buf){return buf.buffer}))})))},loadWeights=tf.io.weightsLoaderFactory(fetchWeightsFromDisk),_c=(_b=JSON).parse,[4,readFile(manifestUri)];case 1:return manifest=_c.apply(_b,[_d.sent().toString()]),[4,loadWeights(manifest,modelBaseUri)];case 2:return weightMap=_d.sent(),this.loadFromWeightMap(weightMap),[2]}}))}))},NeuralNetwork.prototype.loadFromWeightMap=function(weightMap){var _a=this.extractParamsFromWeigthMap(weightMap),paramMappings=_a.paramMappings,params=_a.params;this._paramMappings=paramMappings,this._params=params},NeuralNetwork.prototype.extractWeights=function(weights){var _a=this.extractParams(weights),paramMappings=_a.paramMappings,params=_a.params;this._paramMappings=paramMappings,this._params=params},NeuralNetwork.prototype.traversePropertyPath=function(paramPath){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var result=paramPath.split("/").reduce((function(res,objProp){if(!res.nextObj.hasOwnProperty(objProp))throw new Error("traversePropertyPath - object does not have property "+objProp+", for path "+paramPath);return{obj:res.nextObj,objProp:objProp,nextObj:res.nextObj[objProp]}}),{nextObj:this.params}),obj=result.obj,objProp=result.objProp;if(!(obj&&objProp&&obj[objProp]instanceof tf.Tensor))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+paramPath);return{obj:obj,objProp:objProp}},NeuralNetwork}();exports.NeuralNetwork=NeuralNetwork},{"./common/getModelUris":537,"./dom":552,"./env":565,"@tensorflow/tfjs-core":155,tslib:588}],521:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),Box_1,BoundingBox=function(_super){function BoundingBox(left,top,right,bottom,allowNegativeDimensions){return void 0===allowNegativeDimensions&&(allowNegativeDimensions=!1),_super.call(this,{left:left,top:top,right:right,bottom:bottom},allowNegativeDimensions)||this}return tslib_1.__extends(BoundingBox,_super),BoundingBox}(require("./Box").Box);exports.BoundingBox=BoundingBox},{"./Box":522,tslib:588}],522:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var utils_1=require("../utils"),Point_1=require("./Point"),Box=function(){function Box(_box,allowNegativeDimensions){void 0===allowNegativeDimensions&&(allowNegativeDimensions=!0);var box=_box||{},isBbox=[box.left,box.top,box.right,box.bottom].every(utils_1.isValidNumber),isRect=[box.x,box.y,box.width,box.height].every(utils_1.isValidNumber);if(!isRect&&!isBbox)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(box));var _a=isRect?[box.x,box.y,box.width,box.height]:[box.left,box.top,box.right-box.left,box.bottom-box.top],x=_a[0],y=_a[1],width=_a[2],height=_a[3];Box.assertIsValidBox({x:x,y:y,width:width,height:height},"Box.constructor",allowNegativeDimensions),this._x=x,this._y=y,this._width=width,this._height=height}return Box.isRect=function(rect){return!!rect&&[rect.x,rect.y,rect.width,rect.height].every(utils_1.isValidNumber)},Box.assertIsValidBox=function(box,callee,allowNegativeDimensions){if(void 0===allowNegativeDimensions&&(allowNegativeDimensions=!1),!Box.isRect(box))throw new Error(callee+" - invalid box: "+JSON.stringify(box)+", expected object with properties x, y, width, height");if(!allowNegativeDimensions&&(box.width<0||box.height<0))throw new Error(callee+" - width ("+box.width+") and height ("+box.height+") must be positive numbers")},Object.defineProperty(Box.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(Box.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(Box.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(Box.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(Box.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(Box.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(Box.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(Box.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(Box.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(Box.prototype,"topLeft",{get:function(){return new Point_1.Point(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(Box.prototype,"topRight",{get:function(){return new Point_1.Point(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(Box.prototype,"bottomLeft",{get:function(){return new Point_1.Point(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(Box.prototype,"bottomRight",{get:function(){return new Point_1.Point(this.right,this.bottom)},enumerable:!0,configurable:!0}),Box.prototype.round=function(){var _a=[this.x,this.y,this.width,this.height].map((function(val){return Math.round(val)})),x,y,width,height;return new Box({x:_a[0],y:_a[1],width:_a[2],height:_a[3]})},Box.prototype.floor=function(){var _a=[this.x,this.y,this.width,this.height].map((function(val){return Math.floor(val)})),x,y,width,height;return new Box({x:_a[0],y:_a[1],width:_a[2],height:_a[3]})},Box.prototype.toSquare=function(){var _a=this,x=_a.x,y=_a.y,width=_a.width,height=_a.height,diff=Math.abs(width-height);return width<height&&(x-=diff/2,width+=diff),height<width&&(y-=diff/2,height+=diff),new Box({x:x,y:y,width:width,height:height})},Box.prototype.rescale=function(s){var scaleX=utils_1.isDimensions(s)?s.width:s,scaleY=utils_1.isDimensions(s)?s.height:s;return new Box({x:this.x*scaleX,y:this.y*scaleY,width:this.width*scaleX,height:this.height*scaleY})},Box.prototype.pad=function(padX,padY){var _a=[this.x-padX/2,this.y-padY/2,this.width+padX,this.height+padY],x,y,width,height;return new Box({x:_a[0],y:_a[1],width:_a[2],height:_a[3]})},Box.prototype.clipAtImageBorders=function(imgWidth,imgHeight){var _a=this,x=_a.x,y=_a.y,right=_a.right,bottom=_a.bottom,clippedX=Math.max(x,0),clippedY=Math.max(y,0),newWidth=right-clippedX,newHeight=bottom-clippedY,clippedWidth,clippedHeight;return new Box({x:clippedX,y:clippedY,width:Math.min(newWidth,imgWidth-clippedX),height:Math.min(newHeight,imgHeight-clippedY)}).floor()},Box.prototype.shift=function(sx,sy){var _a=this,width=_a.width,height=_a.height,x,y;return new Box({x:this.x+sx,y:this.y+sy,width:width,height:height})},Box.prototype.padAtBorders=function(imageHeight,imageWidth){var w=this.width+1,h=this.height+1,dx=1,dy=1,edx=w,edy=h,x=this.left,y=this.top,ex=this.right,ey=this.bottom;return ex>imageWidth&&(edx=-ex+imageWidth+w,ex=imageWidth),ey>imageHeight&&(edy=-ey+imageHeight+h,ey=imageHeight),x<1&&(edy=2-x,x=1),y<1&&(edy=2-y,y=1),{dy:1,edy:edy,dx:1,edx:edx,y:y,ey:ey,x:x,ex:ex,w:w,h:h}},Box.prototype.calibrate=function(region){return new Box({left:this.left+region.left*this.width,top:this.top+region.top*this.height,right:this.right+region.right*this.width,bottom:this.bottom+region.bottom*this.height}).toSquare().round()},Box}();exports.Box=Box},{"../utils":586,"./Point":526}],523:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var utils_1=require("../utils"),Dimensions=function(){function Dimensions(width,height){if(!utils_1.isValidNumber(width)||!utils_1.isValidNumber(height))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:width,height:height}));this._width=width,this._height=height}return Object.defineProperty(Dimensions.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(Dimensions.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Dimensions.prototype.reverse=function(){return new Dimensions(1/this.width,1/this.height)},Dimensions}();exports.Dimensions=Dimensions},{"../utils":586}],524:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),Box_1=require("./Box"),index_1=require("../utils/index"),LabeledBox=function(_super){function LabeledBox(box,label){var _this=_super.call(this,box)||this;return _this._label=label,_this}return tslib_1.__extends(LabeledBox,_super),LabeledBox.assertIsValidLabeledBox=function(box,callee){if(Box_1.Box.assertIsValidBox(box,callee),!index_1.isValidNumber(box.label))throw new Error(callee+" - expected property label ("+box.label+") to be a number")},Object.defineProperty(LabeledBox.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),LabeledBox}(Box_1.Box);exports.LabeledBox=LabeledBox},{"../utils/index":586,"./Box":522,tslib:588}],525:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Box_1=require("./Box"),Dimensions_1=require("./Dimensions"),ObjectDetection=function(){function ObjectDetection(score,classScore,className,relativeBox,imageDims){this._imageDims=new Dimensions_1.Dimensions(imageDims.width,imageDims.height),this._score=score,this._classScore=classScore,this._className=className,this._box=new Box_1.Box(relativeBox).rescale(this._imageDims)}return Object.defineProperty(ObjectDetection.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(ObjectDetection.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(ObjectDetection.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(ObjectDetection.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(ObjectDetection.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(ObjectDetection.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(ObjectDetection.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(ObjectDetection.prototype,"relativeBox",{get:function(){return new Box_1.Box(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),ObjectDetection.prototype.forSize=function(width,height){return new ObjectDetection(this.score,this.classScore,this.className,this.relativeBox,{width:width,height:height})},ObjectDetection}();exports.ObjectDetection=ObjectDetection},{"./Box":522,"./Dimensions":523}],526:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Point=function(){function Point(x,y){this._x=x,this._y=y}return Object.defineProperty(Point.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(Point.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Point.prototype.add=function(pt){return new Point(this.x+pt.x,this.y+pt.y)},Point.prototype.sub=function(pt){return new Point(this.x-pt.x,this.y-pt.y)},Point.prototype.mul=function(pt){return new Point(this.x*pt.x,this.y*pt.y)},Point.prototype.div=function(pt){return new Point(this.x/pt.x,this.y/pt.y)},Point.prototype.abs=function(){return new Point(Math.abs(this.x),Math.abs(this.y))},Point.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},Point.prototype.floor=function(){return new Point(Math.floor(this.x),Math.floor(this.y))},Point}();exports.Point=Point},{}],527:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),utils_1=require("../utils"),LabeledBox_1=require("./LabeledBox"),PredictedBox=function(_super){function PredictedBox(box,label,score,classScore){var _this=_super.call(this,box,label)||this;return _this._score=score,_this._classScore=classScore,_this}return tslib_1.__extends(PredictedBox,_super),PredictedBox.assertIsValidPredictedBox=function(box,callee){if(LabeledBox_1.LabeledBox.assertIsValidLabeledBox(box,callee),!utils_1.isValidProbablitiy(box.score)||!utils_1.isValidProbablitiy(box.classScore))throw new Error(callee+" - expected properties score ("+box.score+") and ("+box.classScore+") to be a number between [0, 1]")},Object.defineProperty(PredictedBox.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(PredictedBox.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),PredictedBox}(LabeledBox_1.LabeledBox);exports.PredictedBox=PredictedBox},{"../utils":586,"./LabeledBox":524,tslib:588}],528:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),Box_1,Rect=function(_super){function Rect(x,y,width,height,allowNegativeDimensions){return void 0===allowNegativeDimensions&&(allowNegativeDimensions=!1),_super.call(this,{x:x,y:y,width:width,height:height},allowNegativeDimensions)||this}return tslib_1.__extends(Rect,_super),Rect}(require("./Box").Box);exports.Rect=Rect},{"./Box":522,tslib:588}],529:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib");tslib_1.__exportStar(require("./BoundingBox"),exports),tslib_1.__exportStar(require("./Box"),exports),tslib_1.__exportStar(require("./Dimensions"),exports),tslib_1.__exportStar(require("./LabeledBox"),exports),tslib_1.__exportStar(require("./ObjectDetection"),exports),tslib_1.__exportStar(require("./Point"),exports),tslib_1.__exportStar(require("./PredictedBox"),exports),tslib_1.__exportStar(require("./Rect"),exports)},{"./BoundingBox":521,"./Box":522,"./Dimensions":523,"./LabeledBox":524,"./ObjectDetection":525,"./Point":526,"./PredictedBox":527,"./Rect":528,tslib:588}],530:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tf=require("@tensorflow/tfjs-core");function convLayer(x,params,padding,withRelu){return void 0===padding&&(padding="same"),void 0===withRelu&&(withRelu=!1),tf.tidy((function(){var out=tf.add(tf.conv2d(x,params.filters,[1,1],padding),params.bias);return withRelu?tf.relu(out):out}))}exports.convLayer=convLayer},{"@tensorflow/tfjs-core":155}],531:[function(require,module,exports){"use strict";function disposeUnusedWeightTensors(weightMap,paramMappings){Object.keys(weightMap).forEach((function(path){paramMappings.some((function(pm){return pm.originalPath===path}))||weightMap[path].dispose()}))}Object.defineProperty(exports,"__esModule",{value:!0}),exports.disposeUnusedWeightTensors=disposeUnusedWeightTensors},{}],532:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tf=require("@tensorflow/tfjs-core");function extractConvParamsFactory(extractWeights,paramMappings){return function(channelsIn,channelsOut,filterSize,mappedPrefix){var filters=tf.tensor4d(extractWeights(channelsIn*channelsOut*filterSize*filterSize),[filterSize,filterSize,channelsIn,channelsOut]),bias=tf.tensor1d(extractWeights(channelsOut));return paramMappings.push({paramPath:mappedPrefix+"/filters"},{paramPath:mappedPrefix+"/bias"}),{filters:filters,bias:bias}}}exports.extractConvParamsFactory=extractConvParamsFactory},{"@tensorflow/tfjs-core":155}],533:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tf=require("@tensorflow/tfjs-core");function extractFCParamsFactory(extractWeights,paramMappings){return function(channelsIn,channelsOut,mappedPrefix){var fc_weights=tf.tensor2d(extractWeights(channelsIn*channelsOut),[channelsIn,channelsOut]),fc_bias=tf.tensor1d(extractWeights(channelsOut));return paramMappings.push({paramPath:mappedPrefix+"/weights"},{paramPath:mappedPrefix+"/bias"}),{weights:fc_weights,bias:fc_bias}}}exports.extractFCParamsFactory=extractFCParamsFactory},{"@tensorflow/tfjs-core":155}],534:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tf=require("@tensorflow/tfjs-core"),types_1=require("./types");function extractSeparableConvParamsFactory(extractWeights,paramMappings){return function(channelsIn,channelsOut,mappedPrefix){var depthwise_filter=tf.tensor4d(extractWeights(9*channelsIn),[3,3,channelsIn,1]),pointwise_filter=tf.tensor4d(extractWeights(channelsIn*channelsOut),[1,1,channelsIn,channelsOut]),bias=tf.tensor1d(extractWeights(channelsOut));return paramMappings.push({paramPath:mappedPrefix+"/depthwise_filter"},{paramPath:mappedPrefix+"/pointwise_filter"},{paramPath:mappedPrefix+"/bias"}),new types_1.SeparableConvParams(depthwise_filter,pointwise_filter,bias)}}function loadSeparableConvParamsFactory(extractWeightEntry){return function(prefix){var depthwise_filter=extractWeightEntry(prefix+"/depthwise_filter",4),pointwise_filter=extractWeightEntry(prefix+"/pointwise_filter",4),bias=extractWeightEntry(prefix+"/bias",1);return new types_1.SeparableConvParams(depthwise_filter,pointwise_filter,bias)}}exports.extractSeparableConvParamsFactory=extractSeparableConvParamsFactory,exports.loadSeparableConvParamsFactory=loadSeparableConvParamsFactory},{"./types":539,"@tensorflow/tfjs-core":155}],535:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var utils_1=require("../utils");function extractWeightEntryFactory(weightMap,paramMappings){return function(originalPath,paramRank,mappedPath){var tensor=weightMap[originalPath];if(!utils_1.isTensor(tensor,paramRank))throw new Error("expected weightMap["+originalPath+"] to be a Tensor"+paramRank+"D, instead have "+tensor);return paramMappings.push({originalPath:originalPath,paramPath:mappedPath||originalPath}),tensor}}exports.extractWeightEntryFactory=extractWeightEntryFactory},{"../utils":586}],536:[function(require,module,exports){"use strict";function extractWeightsFactory(weights){var remainingWeights=weights;function extractWeights(numWeights){var ret=remainingWeights.slice(0,numWeights);return remainingWeights=remainingWeights.slice(numWeights),ret}function getRemainingWeights(){return remainingWeights}return{extractWeights:extractWeights,getRemainingWeights:getRemainingWeights}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.extractWeightsFactory=extractWeightsFactory},{}],537:[function(require,module,exports){"use strict";function getModelUris(uri,defaultModelName){var defaultManifestFilename=defaultModelName+"-weights_manifest.json";if(!uri)return{modelBaseUri:"",manifestUri:defaultManifestFilename};if("/"===uri)return{modelBaseUri:"/",manifestUri:"/"+defaultManifestFilename};var protocol=uri.startsWith("http://")?"http://":uri.startsWith("https://")?"https://":"",parts=(uri=uri.replace(protocol,"")).split("/").filter((function(s){return s})),manifestFile=uri.endsWith(".json")?parts[parts.length-1]:defaultManifestFilename,modelBaseUri=protocol+(uri.endsWith(".json")?parts.slice(0,parts.length-1):parts).join("/");return{modelBaseUri:modelBaseUri=uri.startsWith("/")?"/"+modelBaseUri:modelBaseUri,manifestUri:"/"===modelBaseUri?"/"+manifestFile:modelBaseUri+"/"+manifestFile}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.getModelUris=getModelUris},{}],538:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib");tslib_1.__exportStar(require("./convLayer"),exports),tslib_1.__exportStar(require("./disposeUnusedWeightTensors"),exports),tslib_1.__exportStar(require("./extractConvParamsFactory"),exports),tslib_1.__exportStar(require("./extractFCParamsFactory"),exports),tslib_1.__exportStar(require("./extractSeparableConvParamsFactory"),exports),tslib_1.__exportStar(require("./extractWeightEntryFactory"),exports),tslib_1.__exportStar(require("./extractWeightsFactory"),exports),tslib_1.__exportStar(require("./getModelUris"),exports),tslib_1.__exportStar(require("./types"),exports)},{"./convLayer":530,"./disposeUnusedWeightTensors":531,"./extractConvParamsFactory":532,"./extractFCParamsFactory":533,"./extractSeparableConvParamsFactory":534,"./extractWeightEntryFactory":535,"./extractWeightsFactory":536,"./getModelUris":537,"./types":539,tslib:588}],539:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var SeparableConvParams=function(){function SeparableConvParams(depthwise_filter,pointwise_filter,bias){this.depthwise_filter=depthwise_filter,this.pointwise_filter=pointwise_filter,this.bias=bias}return SeparableConvParams}();exports.SeparableConvParams=SeparableConvParams},{}],540:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tf=require("@tensorflow/tfjs-core"),env_1=require("../env"),padToSquare_1=require("../ops/padToSquare"),utils_1=require("../utils"),createCanvas_1=require("./createCanvas"),imageToSquare_1=require("./imageToSquare"),NetInput=function(){function NetInput(inputs,treatAsBatchInput){var _this=this;if(void 0===treatAsBatchInput&&(treatAsBatchInput=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(inputs))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+inputs);this._treatAsBatchInput=treatAsBatchInput,this._batchSize=inputs.length,inputs.forEach((function(input,idx){if(utils_1.isTensor3D(input))return _this._imageTensors[idx]=input,void(_this._inputDimensions[idx]=input.shape);if(utils_1.isTensor4D(input)){var batchSize=input.shape[0];if(1!==batchSize)throw new Error("NetInput - tf.Tensor4D with batchSize "+batchSize+" passed, but not supported in input array");return _this._imageTensors[idx]=input,void(_this._inputDimensions[idx]=input.shape.slice(1))}var canvas=input instanceof env_1.env.getEnv().Canvas?input:createCanvas_1.createCanvasFromMedia(input);_this._canvases[idx]=canvas,_this._inputDimensions[idx]=[canvas.height,canvas.width,3]}))}return Object.defineProperty(NetInput.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(NetInput.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(NetInput.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(NetInput.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(NetInput.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(NetInput.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(NetInput.prototype,"reshapedInputDimensions",{get:function(){var _this=this;return utils_1.range(this.batchSize,0,1).map((function(_,batchIdx){return _this.getReshapedInputDimensions(batchIdx)}))},enumerable:!0,configurable:!0}),NetInput.prototype.getInput=function(batchIdx){return this.canvases[batchIdx]||this.imageTensors[batchIdx]},NetInput.prototype.getInputDimensions=function(batchIdx){return this._inputDimensions[batchIdx]},NetInput.prototype.getInputHeight=function(batchIdx){return this._inputDimensions[batchIdx][0]},NetInput.prototype.getInputWidth=function(batchIdx){return this._inputDimensions[batchIdx][1]},NetInput.prototype.getReshapedInputDimensions=function(batchIdx){if("number"!=typeof this.inputSize)throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");var width=this.getInputWidth(batchIdx),height=this.getInputHeight(batchIdx);return utils_1.computeReshapedDimensions({width:width,height:height},this.inputSize)},NetInput.prototype.toBatchTensor=function(inputSize,isCenterInputs){var _this=this;return void 0===isCenterInputs&&(isCenterInputs=!0),this._inputSize=inputSize,tf.tidy((function(){var inputTensors=utils_1.range(_this.batchSize,0,1).map((function(batchIdx){var input=_this.getInput(batchIdx);if(input instanceof tf.Tensor){var imgTensor=utils_1.isTensor4D(input)?input:input.expandDims();return(imgTensor=padToSquare_1.padToSquare(imgTensor,isCenterInputs)).shape[1]===inputSize&&imgTensor.shape[2]===inputSize||(imgTensor=tf.image.resizeBilinear(imgTensor,[inputSize,inputSize])),imgTensor.as3D(inputSize,inputSize,3)}if(input instanceof env_1.env.getEnv().Canvas)return tf.browser.fromPixels(imageToSquare_1.imageToSquare(input,inputSize,isCenterInputs));throw new Error("toBatchTensor - at batchIdx "+batchIdx+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+input)})),batchTensor;return tf.stack(inputTensors.map((function(t){return t.toFloat()}))).as4D(_this.batchSize,inputSize,inputSize,3)}))},NetInput}();exports.NetInput=NetInput},{"../env":565,"../ops/padToSquare":574,"../utils":586,"./createCanvas":543,"./imageToSquare":551,"@tensorflow/tfjs-core":155}],541:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var env_1=require("../env"),isMediaLoaded_1=require("./isMediaLoaded");function awaitMediaLoaded(media){return new Promise((function(resolve,reject){if(media instanceof env_1.env.getEnv().Canvas||isMediaLoaded_1.isMediaLoaded(media))return resolve();function onLoad(e){e.currentTarget&&(e.currentTarget.removeEventListener("load",onLoad),e.currentTarget.removeEventListener("error",onError),resolve(e))}function onError(e){e.currentTarget&&(e.currentTarget.removeEventListener("load",onLoad),e.currentTarget.removeEventListener("error",onError),reject(e))}media.addEventListener("load",onLoad),media.addEventListener("error",onError)}))}exports.awaitMediaLoaded=awaitMediaLoaded},{"../env":565,"./isMediaLoaded":554}],542:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var env_1=require("../env");function bufferToImage(buf){return new Promise((function(resolve,reject){if(!(buf instanceof Blob))return reject("bufferToImage - expected buf to be of type: Blob");var reader=new FileReader;reader.onload=function(){if("string"!=typeof reader.result)return reject("bufferToImage - expected reader.result to be a string, in onload");var img=env_1.env.getEnv().createImageElement();img.onload=function(){return resolve(img)},img.onerror=reject,img.src=reader.result},reader.onerror=reject,reader.readAsDataURL(buf)}))}exports.bufferToImage=bufferToImage},{"../env":565}],543:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var env_1=require("../env"),getContext2dOrThrow_1=require("./getContext2dOrThrow"),getMediaDimensions_1=require("./getMediaDimensions"),isMediaLoaded_1=require("./isMediaLoaded");function createCanvas(_a){var width=_a.width,height=_a.height,createCanvasElement,canvas=(0,env_1.env.getEnv().createCanvasElement)();return canvas.width=width,canvas.height=height,canvas}function createCanvasFromMedia(media,dims){var ImageData=env_1.env.getEnv().ImageData;if(!(media instanceof ImageData||isMediaLoaded_1.isMediaLoaded(media)))throw new Error("createCanvasFromMedia - media has not finished loading yet");var _a=dims||getMediaDimensions_1.getMediaDimensions(media),width=_a.width,height=_a.height,canvas=createCanvas({width:width,height:height});return media instanceof ImageData?getContext2dOrThrow_1.getContext2dOrThrow(canvas).putImageData(media,0,0):getContext2dOrThrow_1.getContext2dOrThrow(canvas).drawImage(media,0,0,width,height),canvas}exports.createCanvas=createCanvas,exports.createCanvasFromMedia=createCanvasFromMedia},{"../env":565,"./getContext2dOrThrow":548,"./getMediaDimensions":549,"./isMediaLoaded":554}],544:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),bufferToImage_1=require("./bufferToImage"),fetchOrThrow_1=require("./fetchOrThrow");function fetchImage(uri){return tslib_1.__awaiter(this,void 0,void 0,(function(){var res,blob;return tslib_1.__generator(this,(function(_a){switch(_a.label){case 0:return[4,fetchOrThrow_1.fetchOrThrow(uri)];case 1:return[4,(res=_a.sent()).blob()];case 2:if(!(blob=_a.sent()).type.startsWith("image/"))throw new Error("fetchImage - expected blob type to be of type image/*, instead have: "+blob.type+", for url: "+res.url);return[2,bufferToImage_1.bufferToImage(blob)]}}))}))}exports.fetchImage=fetchImage},{"./bufferToImage":542,"./fetchOrThrow":547,tslib:588}],545:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),fetchOrThrow_1=require("./fetchOrThrow");function fetchJson(uri){return tslib_1.__awaiter(this,void 0,void 0,(function(){return tslib_1.__generator(this,(function(_a){switch(_a.label){case 0:return[4,fetchOrThrow_1.fetchOrThrow(uri)];case 1:return[2,_a.sent().json()]}}))}))}exports.fetchJson=fetchJson},{"./fetchOrThrow":547,tslib:588}],546:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),fetchOrThrow_1=require("./fetchOrThrow");function fetchNetWeights(uri){return tslib_1.__awaiter(this,void 0,void 0,(function(){var _a;return tslib_1.__generator(this,(function(_b){switch(_b.label){case 0:return _a=Float32Array.bind,[4,fetchOrThrow_1.fetchOrThrow(uri)];case 1:return[4,_b.sent().arrayBuffer()];case 2:return[2,new(_a.apply(Float32Array,[void 0,_b.sent()]))]}}))}))}exports.fetchNetWeights=fetchNetWeights},{"./fetchOrThrow":547,tslib:588}],547:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),env_1=require("../env");function fetchOrThrow(url,init){return tslib_1.__awaiter(this,void 0,void 0,(function(){var fetch,res;return tslib_1.__generator(this,(function(_a){switch(_a.label){case 0:return[4,(fetch=env_1.env.getEnv().fetch)(url,init)];case 1:if(!((res=_a.sent()).status<400))throw new Error("failed to fetch: ("+res.status+") "+res.statusText+", from url: "+res.url);return[2,res]}}))}))}exports.fetchOrThrow=fetchOrThrow},{"../env":565,tslib:588}],548:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var env_1=require("../env"),resolveInput_1=require("./resolveInput");function getContext2dOrThrow(canvasArg){var _a=env_1.env.getEnv(),Canvas=_a.Canvas,CanvasRenderingContext2D;if(canvasArg instanceof _a.CanvasRenderingContext2D)return canvasArg;var canvas=resolveInput_1.resolveInput(canvasArg);if(!(canvas instanceof Canvas))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var ctx=canvas.getContext("2d");if(!ctx)throw new Error("resolveContext2d - canvas 2d context is null");return ctx}exports.getContext2dOrThrow=getContext2dOrThrow},{"../env":565,"./resolveInput":557}],549:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Dimensions_1=require("../classes/Dimensions"),env_1=require("../env");function getMediaDimensions(input){var _a=env_1.env.getEnv(),Image=_a.Image,Video=_a.Video;return input instanceof Image?new Dimensions_1.Dimensions(input.naturalWidth,input.naturalHeight):input instanceof Video?new Dimensions_1.Dimensions(input.videoWidth,input.videoHeight):new Dimensions_1.Dimensions(input.width,input.height)}exports.getMediaDimensions=getMediaDimensions},{"../classes/Dimensions":523,"../env":565}],550:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),tf=require("@tensorflow/tfjs-core"),env_1=require("../env"),utils_1=require("../utils");function imageTensorToCanvas(imgTensor,canvas){return tslib_1.__awaiter(this,void 0,void 0,(function(){var targetCanvas,_a,height,width,numChannels,imgTensor3D;return tslib_1.__generator(this,(function(_b){switch(_b.label){case 0:return targetCanvas=canvas||env_1.env.getEnv().createCanvasElement(),_a=imgTensor.shape.slice(utils_1.isTensor4D(imgTensor)?1:0),height=_a[0],width=_a[1],numChannels=_a[2],imgTensor3D=tf.tidy((function(){return imgTensor.as3D(height,width,numChannels).toInt()})),[4,tf.browser.toPixels(imgTensor3D,targetCanvas)];case 1:return _b.sent(),imgTensor3D.dispose(),[2,targetCanvas]}}))}))}exports.imageTensorToCanvas=imageTensorToCanvas},{"../env":565,"../utils":586,"@tensorflow/tfjs-core":155,tslib:588}],551:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var env_1=require("../env"),createCanvas_1=require("./createCanvas"),getContext2dOrThrow_1=require("./getContext2dOrThrow"),getMediaDimensions_1=require("./getMediaDimensions");function imageToSquare(input,inputSize,centerImage){void 0===centerImage&&(centerImage=!1);var _a=env_1.env.getEnv(),Image=_a.Image,Canvas=_a.Canvas;if(!(input instanceof Image||input instanceof Canvas))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var dims=getMediaDimensions_1.getMediaDimensions(input),scale=inputSize/Math.max(dims.height,dims.width),width=scale*dims.width,height=scale*dims.height,targetCanvas=createCanvas_1.createCanvas({width:inputSize,height:inputSize}),inputCanvas=input instanceof Canvas?input:createCanvas_1.createCanvasFromMedia(input),offset=Math.abs(width-height)/2,dx=centerImage&&width<height?offset:0,dy=centerImage&&height<width?offset:0;return getContext2dOrThrow_1.getContext2dOrThrow(targetCanvas).drawImage(inputCanvas,dx,dy,width,height),targetCanvas}exports.imageToSquare=imageToSquare},{"../env":565,"./createCanvas":543,"./getContext2dOrThrow":548,"./getMediaDimensions":549}],552:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib");tslib_1.__exportStar(require("./awaitMediaLoaded"),exports),tslib_1.__exportStar(require("./bufferToImage"),exports),tslib_1.__exportStar(require("./createCanvas"),exports),tslib_1.__exportStar(require("./fetchImage"),exports),tslib_1.__exportStar(require("./fetchJson"),exports),tslib_1.__exportStar(require("./fetchNetWeights"),exports),tslib_1.__exportStar(require("./fetchOrThrow"),exports),tslib_1.__exportStar(require("./getContext2dOrThrow"),exports),tslib_1.__exportStar(require("./getMediaDimensions"),exports),tslib_1.__exportStar(require("./imageTensorToCanvas"),exports),tslib_1.__exportStar(require("./imageToSquare"),exports),tslib_1.__exportStar(require("./isMediaElement"),exports),tslib_1.__exportStar(require("./isMediaLoaded"),exports),tslib_1.__exportStar(require("./loadWeightMap"),exports),tslib_1.__exportStar(require("./matchDimensions"),exports),tslib_1.__exportStar(require("./NetInput"),exports),tslib_1.__exportStar(require("./resolveInput"),exports),tslib_1.__exportStar(require("./toNetInput"),exports)},{"./NetInput":540,"./awaitMediaLoaded":541,"./bufferToImage":542,"./createCanvas":543,"./fetchImage":544,"./fetchJson":545,"./fetchNetWeights":546,"./fetchOrThrow":547,"./getContext2dOrThrow":548,"./getMediaDimensions":549,"./imageTensorToCanvas":550,"./imageToSquare":551,"./isMediaElement":553,"./isMediaLoaded":554,"./loadWeightMap":555,"./matchDimensions":556,"./resolveInput":557,"./toNetInput":558,tslib:588}],553:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var env_1=require("../env");function isMediaElement(input){var _a=env_1.env.getEnv(),Image=_a.Image,Canvas=_a.Canvas,Video=_a.Video;return input instanceof Image||input instanceof Canvas||input instanceof Video}exports.isMediaElement=isMediaElement},{"../env":565}],554:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var env_1=require("../env");function isMediaLoaded(media){var _a=env_1.env.getEnv(),Image=_a.Image,Video=_a.Video;return media instanceof Image&&media.complete||media instanceof Video&&media.readyState>=3}exports.isMediaLoaded=isMediaLoaded},{"../env":565}],555:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),tf=require("@tensorflow/tfjs-core"),getModelUris_1=require("../common/getModelUris"),fetchJson_1=require("./fetchJson");function loadWeightMap(uri,defaultModelName){return tslib_1.__awaiter(this,void 0,void 0,(function(){var _a,manifestUri,modelBaseUri,manifest;return tslib_1.__generator(this,(function(_b){switch(_b.label){case 0:return _a=getModelUris_1.getModelUris(uri,defaultModelName),manifestUri=_a.manifestUri,modelBaseUri=_a.modelBaseUri,[4,fetchJson_1.fetchJson(manifestUri)];case 1:return manifest=_b.sent(),[2,tf.io.loadWeights(manifest,modelBaseUri)]}}))}))}exports.loadWeightMap=loadWeightMap},{"../common/getModelUris":537,"./fetchJson":545,"@tensorflow/tfjs-core":155,tslib:588}],556:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var getMediaDimensions_1=require("./getMediaDimensions");function matchDimensions(input,reference,useMediaDimensions){void 0===useMediaDimensions&&(useMediaDimensions=!1);var _a=useMediaDimensions?getMediaDimensions_1.getMediaDimensions(reference):reference,width=_a.width,height=_a.height;return input.width=width,input.height=height,{width:width,height:height}}exports.matchDimensions=matchDimensions},{"./getMediaDimensions":549}],557:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var env_1=require("../env");function resolveInput(arg){return env_1.env.isNodejs()||"string"!=typeof arg?arg:document.getElementById(arg)}exports.resolveInput=resolveInput},{"../env":565}],558:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),utils_1=require("../utils"),awaitMediaLoaded_1=require("./awaitMediaLoaded"),isMediaElement_1=require("./isMediaElement"),NetInput_1=require("./NetInput"),resolveInput_1=require("./resolveInput");function toNetInput(inputs){return tslib_1.__awaiter(this,void 0,void 0,(function(){var inputArgArray,getIdxHint,inputArray;return tslib_1.__generator(this,(function(_a){switch(_a.label){case 0:if(inputs instanceof NetInput_1.NetInput)return[2,inputs];if(!(inputArgArray=Array.isArray(inputs)?inputs:[inputs]).length)throw new Error("toNetInput - empty array passed as input");return getIdxHint=function(idx){return Array.isArray(inputs)?" at input index "+idx+":":""},(inputArray=inputArgArray.map(resolveInput_1.resolveInput)).forEach((function(input,i){if(!isMediaElement_1.isMediaElement(input)&&!utils_1.isTensor3D(input)&&!utils_1.isTensor4D(input)){if("string"==typeof inputArgArray[i])throw new Error("toNetInput -"+getIdxHint(i)+" string passed, but could not resolve HTMLElement for element id "+inputArgArray[i]);throw new Error("toNetInput -"+getIdxHint(i)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id")}if(utils_1.isTensor4D(input)){var batchSize=input.shape[0];if(1!==batchSize)throw new Error("toNetInput -"+getIdxHint(i)+" tf.Tensor4D with batchSize "+batchSize+" passed, but not supported in input array")}})),[4,Promise.all(inputArray.map((function(input){return isMediaElement_1.isMediaElement(input)&&awaitMediaLoaded_1.awaitMediaLoaded(input)})))];case 1:return _a.sent(),[2,new NetInput_1.NetInput(inputArray,Array.isArray(inputs))]}}))}))}exports.toNetInput=toNetInput},{"../utils":586,"./NetInput":540,"./awaitMediaLoaded":541,"./isMediaElement":553,"./resolveInput":557,tslib:588}],559:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var classes_1=require("../classes"),getContext2dOrThrow_1=require("../dom/getContext2dOrThrow"),DrawTextField_1=require("./DrawTextField"),DrawBoxOptions=function(){function DrawBoxOptions(options){void 0===options&&(options={});var boxColor=options.boxColor,lineWidth=options.lineWidth,label=options.label,drawLabelOptions=options.drawLabelOptions;this.boxColor=boxColor||"rgba(0, 0, 255, 1)",this.lineWidth=lineWidth||2,this.label=label;var defaultDrawLabelOptions={anchorPosition:DrawTextField_1.AnchorPosition.BOTTOM_LEFT,backgroundColor:this.boxColor};this.drawLabelOptions=new DrawTextField_1.DrawTextFieldOptions(Object.assign({},defaultDrawLabelOptions,drawLabelOptions))}return DrawBoxOptions}();exports.DrawBoxOptions=DrawBoxOptions;var DrawBox=function(){function DrawBox(box,options){void 0===options&&(options={}),this.box=new classes_1.Box(box),this.options=new DrawBoxOptions(options)}return DrawBox.prototype.draw=function(canvasArg){var ctx=getContext2dOrThrow_1.getContext2dOrThrow(canvasArg),_a=this.options,boxColor=_a.boxColor,lineWidth=_a.lineWidth,_b=this.box,x=_b.x,y=_b.y,width=_b.width,height=_b.height;ctx.strokeStyle=boxColor,ctx.lineWidth=lineWidth,ctx.strokeRect(x,y,width,height);var label=this.options.label;label&&new DrawTextField_1.DrawTextField([label],{x:x-lineWidth/2,y:y},this.options.drawLabelOptions).draw(canvasArg)},DrawBox}();exports.DrawBox=DrawBox},{"../classes":529,"../dom/getContext2dOrThrow":548,"./DrawTextField":560}],560:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var getContext2dOrThrow_1=require("../dom/getContext2dOrThrow"),resolveInput_1=require("../dom/resolveInput"),AnchorPosition;!function(AnchorPosition){AnchorPosition.TOP_LEFT="TOP_LEFT",AnchorPosition.TOP_RIGHT="TOP_RIGHT",AnchorPosition.BOTTOM_LEFT="BOTTOM_LEFT",AnchorPosition.BOTTOM_RIGHT="BOTTOM_RIGHT"}(AnchorPosition=exports.AnchorPosition||(exports.AnchorPosition={}));var DrawTextFieldOptions=function(){function DrawTextFieldOptions(options){void 0===options&&(options={});var anchorPosition=options.anchorPosition,backgroundColor=options.backgroundColor,fontColor=options.fontColor,fontSize=options.fontSize,fontStyle=options.fontStyle,padding=options.padding;this.anchorPosition=anchorPosition||AnchorPosition.TOP_LEFT,this.backgroundColor=backgroundColor||"rgba(0, 0, 0, 0.5)",this.fontColor=fontColor||"rgba(255, 255, 255, 1)",this.fontSize=fontSize||14,this.fontStyle=fontStyle||"Georgia",this.padding=padding||4}return DrawTextFieldOptions}();exports.DrawTextFieldOptions=DrawTextFieldOptions;var DrawTextField=function(){function DrawTextField(text,anchor,options){void 0===options&&(options={}),this.text="string"==typeof text?[text]:text instanceof DrawTextField?text.text:text,this.anchor=anchor,this.options=new DrawTextFieldOptions(options)}return DrawTextField.prototype.measureWidth=function(ctx){var padding=this.options.padding;return this.text.map((function(l){return ctx.measureText(l).width})).reduce((function(w0,w1){return w0<w1?w1:w0}),0)+2*padding},DrawTextField.prototype.measureHeight=function(){var _a=this.options,fontSize=_a.fontSize,padding=_a.padding;return this.text.length*fontSize+2*padding},DrawTextField.prototype.getUpperLeft=function(ctx,canvasDims){var anchorPosition=this.options.anchorPosition,isShiftLeft=anchorPosition===AnchorPosition.BOTTOM_RIGHT||anchorPosition===AnchorPosition.TOP_RIGHT,isShiftTop=anchorPosition===AnchorPosition.BOTTOM_LEFT||anchorPosition===AnchorPosition.BOTTOM_RIGHT,textFieldWidth=this.measureWidth(ctx),textFieldHeight=this.measureHeight(),x=isShiftLeft?this.anchor.x-textFieldWidth:this.anchor.x,y=isShiftTop?this.anchor.y-textFieldHeight:this.anchor.y;if(canvasDims){var width=canvasDims.width,height=canvasDims.height,newX,newY;return{x:Math.max(Math.min(x,width-textFieldWidth),0),y:Math.max(Math.min(y,height-textFieldHeight),0)}}return{x:x,y:y}},DrawTextField.prototype.draw=function(canvasArg){var canvas=resolveInput_1.resolveInput(canvasArg),ctx=getContext2dOrThrow_1.getContext2dOrThrow(canvas),_a=this.options,backgroundColor=_a.backgroundColor,fontColor=_a.fontColor,fontSize=_a.fontSize,fontStyle=_a.fontStyle,padding=_a.padding;ctx.font=fontSize+"px "+fontStyle;var maxTextWidth=this.measureWidth(ctx),textHeight=this.measureHeight();ctx.fillStyle=backgroundColor;var upperLeft=this.getUpperLeft(ctx,canvas);ctx.fillRect(upperLeft.x,upperLeft.y,maxTextWidth,textHeight),ctx.fillStyle=fontColor,this.text.forEach((function(textLine,i){var x=padding+upperLeft.x,y=padding+upperLeft.y+(i+1)*fontSize;ctx.fillText(textLine,x,y)}))},DrawTextField}();exports.DrawTextField=DrawTextField},{"../dom/getContext2dOrThrow":548,"../dom/resolveInput":557}],561:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib");tslib_1.__exportStar(require("./DrawBox"),exports),tslib_1.__exportStar(require("./DrawTextField"),exports)},{"./DrawBox":559,"./DrawTextField":560,tslib:588}],562:[function(require,module,exports){"use strict";function createBrowserEnv(){var fetch=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")},readFile;return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D:CanvasRenderingContext2D,Image:HTMLImageElement,ImageData:ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:fetch,readFile:function(){throw new Error("readFile - filesystem not available for browser environment")}}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.createBrowserEnv=createBrowserEnv},{}],563:[function(require,module,exports){"use strict";function createFileSystem(fs){var requireFsError="",readFile;if(!fs)try{fs=require("fs")}catch(err){requireFsError=err.toString()}return{readFile:fs?function(filePath){return new Promise((function(res,rej){fs.readFile(filePath,(function(err,buffer){return err?rej(err):res(buffer)}))}))}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+requireFsError)}}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.createFileSystem=createFileSystem},{fs:255}],564:[function(require,module,exports){(function(global){(function(){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),createFileSystem_1=require("./createFileSystem");function createNodejsEnv(){var Canvas=global.Canvas||global.HTMLCanvasElement,Image=global.Image||global.HTMLImageElement,createCanvasElement=function(){if(Canvas)return new Canvas;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},createImageElement=function(){if(Image)return new Image;throw new Error("createImageElement - missing Image implementation for nodejs environment")},fetch=global.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},fileSystem=createFileSystem_1.createFileSystem();return tslib_1.__assign({Canvas:Canvas||function(){function Canvas(){}return Canvas}(),CanvasRenderingContext2D:global.CanvasRenderingContext2D||function(){function class_1(){}return class_1}(),Image:Image||function(){function Image(){}return Image}(),ImageData:global.ImageData||function(){function class_2(){}return class_2}(),Video:global.HTMLVideoElement||function(){function class_3(){}return class_3}(),createCanvasElement:createCanvasElement,createImageElement:createImageElement,fetch:fetch},fileSystem)}exports.createNodejsEnv=createNodejsEnv}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./createFileSystem":563,tslib:588}],565:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var createBrowserEnv_1=require("./createBrowserEnv"),createFileSystem_1=require("./createFileSystem"),createNodejsEnv_1=require("./createNodejsEnv"),isBrowser_1=require("./isBrowser"),isNodejs_1=require("./isNodejs"),environment;function getEnv(){if(!environment)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return environment}function setEnv(env){environment=env}function initialize(){isBrowser_1.isBrowser()&&setEnv(createBrowserEnv_1.createBrowserEnv()),isNodejs_1.isNodejs()&&setEnv(createNodejsEnv_1.createNodejsEnv())}function monkeyPatch(env){if(environment||initialize(),!environment)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var _a=env.Canvas,Canvas=void 0===_a?environment.Canvas:_a,_b=env.Image,Image=void 0===_b?environment.Image:_b;environment.Canvas=Canvas,environment.Image=Image,environment.createCanvasElement=env.createCanvasElement||function(){return new Canvas},environment.createImageElement=env.createImageElement||function(){return new Image},environment.ImageData=env.ImageData||environment.ImageData,environment.Video=env.Video||environment.Video,environment.fetch=env.fetch||environment.fetch,environment.readFile=env.readFile||environment.readFile}exports.env={getEnv:getEnv,setEnv:setEnv,initialize:initialize,createBrowserEnv:createBrowserEnv_1.createBrowserEnv,createFileSystem:createFileSystem_1.createFileSystem,createNodejsEnv:createNodejsEnv_1.createNodejsEnv,monkeyPatch:monkeyPatch,isBrowser:isBrowser_1.isBrowser,isNodejs:isNodejs_1.isNodejs},initialize()},{"./createBrowserEnv":562,"./createFileSystem":563,"./createNodejsEnv":564,"./isBrowser":566,"./isNodejs":567}],566:[function(require,module,exports){"use strict";function isBrowser(){return"object"==typeof window&&"undefined"!=typeof document&&"undefined"!=typeof HTMLImageElement&&"undefined"!=typeof HTMLCanvasElement&&"undefined"!=typeof HTMLVideoElement&&"undefined"!=typeof ImageData&&"undefined"!=typeof CanvasRenderingContext2D}Object.defineProperty(exports,"__esModule",{value:!0}),exports.isBrowser=isBrowser},{}],567:[function(require,module,exports){(function(process,global){(function(){"use strict";function isNodejs(){return"object"==typeof global&&"function"==typeof require&&void 0!==module&&void 0!==process&&!!process.version}Object.defineProperty(exports,"__esModule",{value:!0}),exports.isNodejs=isNodejs}).call(this)}).call(this,require("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:422}],568:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),draw=require("./draw");exports.draw=draw;var TfjsImageRecognitionBase=require("./tfjsImageRecognitionBase");exports.TfjsImageRecognitionBase=TfjsImageRecognitionBase,tslib_1.__exportStar(require("./classes/index"),exports),tslib_1.__exportStar(require("./dom/index"),exports),tslib_1.__exportStar(require("./env/index"),exports),tslib_1.__exportStar(require("./ops/index"),exports),tslib_1.__exportStar(require("./utils"),exports),tslib_1.__exportStar(require("./NeuralNetwork"),exports)},{"./NeuralNetwork":520,"./classes/index":529,"./dom/index":552,"./draw":561,"./env/index":565,"./ops/index":569,"./tfjsImageRecognitionBase":576,"./utils":586,tslib:588}],569:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib");function sigmoid(x){return 1/(1+Math.exp(-x))}function inverseSigmoid(x){return Math.log(x/(1-x))}tslib_1.__exportStar(require("./iou"),exports),tslib_1.__exportStar(require("./minBbox"),exports),tslib_1.__exportStar(require("./nonMaxSuppression"),exports),tslib_1.__exportStar(require("./normalize"),exports),tslib_1.__exportStar(require("./padToSquare"),exports),tslib_1.__exportStar(require("./shuffleArray"),exports),exports.sigmoid=sigmoid,exports.inverseSigmoid=inverseSigmoid},{"./iou":570,"./minBbox":571,"./nonMaxSuppression":572,"./normalize":573,"./padToSquare":574,"./shuffleArray":575,tslib:588}],570:[function(require,module,exports){"use strict";function iou(box1,box2,isIOU){void 0===isIOU&&(isIOU=!0);var width,height,interSection=Math.max(0,Math.min(box1.right,box2.right)-Math.max(box1.left,box2.left))*Math.max(0,Math.min(box1.bottom,box2.bottom)-Math.max(box1.top,box2.top));return isIOU?interSection/(box1.area+box2.area-interSection):interSection/Math.min(box1.area,box2.area)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.iou=iou},{}],571:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var classes_1=require("../classes");function minBbox(pts){var xs=pts.map((function(pt){return pt.x})),ys=pts.map((function(pt){return pt.y})),minX=xs.reduce((function(min,x){return x<min?x:min}),1/0),minY=ys.reduce((function(min,y){return y<min?y:min}),1/0),maxX=xs.reduce((function(max,x){return max<x?x:max}),0),maxY=ys.reduce((function(max,y){return max<y?y:max}),0);return new classes_1.BoundingBox(minX,minY,maxX,maxY)}exports.minBbox=minBbox},{"../classes":529}],572:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var iou_1=require("./iou");function nonMaxSuppression(boxes,scores,iouThreshold,isIOU){void 0===isIOU&&(isIOU=!0);for(var indicesSortedByScore=scores.map((function(score,boxIndex){return{score:score,boxIndex:boxIndex}})).sort((function(c1,c2){return c1.score-c2.score})).map((function(c){return c.boxIndex})),pick=[],_loop_1=function(){var curr=indicesSortedByScore.pop();pick.push(curr);for(var indices=indicesSortedByScore,outputs=[],i=0;i<indices.length;i++){var idx=indices[i],currBox=boxes[curr],idxBox=boxes[idx];outputs.push(iou_1.iou(currBox,idxBox,isIOU))}indicesSortedByScore=indicesSortedByScore.filter((function(_,j){return outputs[j]<=iouThreshold}))};indicesSortedByScore.length>0;)_loop_1();return pick}exports.nonMaxSuppression=nonMaxSuppression},{"./iou":570}],573:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),tf=require("@tensorflow/tfjs-core");function normalize(x,meanRgb){return tf.tidy((function(){var r=meanRgb[0],g=meanRgb[1],b=meanRgb[2],avg_r=tf.fill(tslib_1.__spreadArrays(x.shape.slice(0,3),[1]),r),avg_g=tf.fill(tslib_1.__spreadArrays(x.shape.slice(0,3),[1]),g),avg_b=tf.fill(tslib_1.__spreadArrays(x.shape.slice(0,3),[1]),b),avg_rgb=tf.concat([avg_r,avg_g,avg_b],3);return tf.sub(x,avg_rgb)}))}exports.normalize=normalize},{"@tensorflow/tfjs-core":155,tslib:588}],574:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tf=require("@tensorflow/tfjs-core");function padToSquare(imgTensor,isCenterImage){return void 0===isCenterImage&&(isCenterImage=!1),tf.tidy((function(){var _a=imgTensor.shape.slice(1),height=_a[0],width=_a[1];if(height===width)return imgTensor;var dimDiff=Math.abs(height-width),paddingAmount=Math.round(dimDiff*(isCenterImage?.5:1)),paddingAxis=height>width?2:1,createPaddingTensor=function(paddingAmount){var paddingTensorShape=imgTensor.shape.slice();return paddingTensorShape[paddingAxis]=paddingAmount,tf.fill(paddingTensorShape,0)},paddingTensorAppend=createPaddingTensor(paddingAmount),remainingPaddingAmount=dimDiff-paddingTensorAppend.shape[paddingAxis],paddingTensorPrepend,tensorsToStack=[isCenterImage&&remainingPaddingAmount?createPaddingTensor(remainingPaddingAmount):null,imgTensor,paddingTensorAppend].filter((function(t){return!!t})).map((function(t){return t.toFloat()}));return tf.concat(tensorsToStack,paddingAxis)}))}exports.padToSquare=padToSquare},{"@tensorflow/tfjs-core":155}],575:[function(require,module,exports){"use strict";function shuffleArray(inputArray){for(var array=inputArray.slice(),i=array.length-1;i>0;i--){var j=Math.floor(Math.random()*(i+1)),x=array[i];array[i]=array[j],array[j]=x}return array}Object.defineProperty(exports,"__esModule",{value:!0}),exports.shuffleArray=shuffleArray},{}],576:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib");tslib_1.__exportStar(require("./common"),exports),tslib_1.__exportStar(require("./tinyYolov2/index"),exports)},{"./common":538,"./tinyYolov2/index":584,tslib:588}],577:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),tf=require("@tensorflow/tfjs-core"),BoundingBox_1=require("../classes/BoundingBox"),ObjectDetection_1=require("../classes/ObjectDetection"),common_1=require("../common"),dom_1=require("../dom"),NeuralNetwork_1=require("../NeuralNetwork"),ops_1=require("../ops"),nonMaxSuppression_1=require("../ops/nonMaxSuppression"),normalize_1=require("../ops/normalize"),config_1=require("./config"),convWithBatchNorm_1=require("./convWithBatchNorm"),depthwiseSeparableConv_1=require("./depthwiseSeparableConv"),extractParams_1=require("./extractParams"),extractParamsFromWeigthMap_1=require("./extractParamsFromWeigthMap"),leaky_1=require("./leaky"),TinyYolov2Options_1=require("./TinyYolov2Options"),TinyYolov2=function(_super){function TinyYolov2(config){var _this=_super.call(this,"TinyYolov2")||this;return config_1.validateConfig(config),_this._config=config,_this}return tslib_1.__extends(TinyYolov2,_super),Object.defineProperty(TinyYolov2.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(TinyYolov2.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(TinyYolov2.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),TinyYolov2.prototype.runTinyYolov2=function(x,params){var out=convWithBatchNorm_1.convWithBatchNorm(x,params.conv0);return out=tf.maxPool(out,[2,2],[2,2],"same"),out=convWithBatchNorm_1.convWithBatchNorm(out,params.conv1),out=tf.maxPool(out,[2,2],[2,2],"same"),out=convWithBatchNorm_1.convWithBatchNorm(out,params.conv2),out=tf.maxPool(out,[2,2],[2,2],"same"),out=convWithBatchNorm_1.convWithBatchNorm(out,params.conv3),out=tf.maxPool(out,[2,2],[2,2],"same"),out=convWithBatchNorm_1.convWithBatchNorm(out,params.conv4),out=tf.maxPool(out,[2,2],[2,2],"same"),out=convWithBatchNorm_1.convWithBatchNorm(out,params.conv5),out=tf.maxPool(out,[2,2],[1,1],"same"),out=convWithBatchNorm_1.convWithBatchNorm(out,params.conv6),out=convWithBatchNorm_1.convWithBatchNorm(out,params.conv7),common_1.convLayer(out,params.conv8,"valid",!1)},TinyYolov2.prototype.runMobilenet=function(x,params){var out=this.config.isFirstLayerConv2d?leaky_1.leaky(common_1.convLayer(x,params.conv0,"valid",!1)):depthwiseSeparableConv_1.depthwiseSeparableConv(x,params.conv0);return out=tf.maxPool(out,[2,2],[2,2],"same"),out=depthwiseSeparableConv_1.depthwiseSeparableConv(out,params.conv1),out=tf.maxPool(out,[2,2],[2,2],"same"),out=depthwiseSeparableConv_1.depthwiseSeparableConv(out,params.conv2),out=tf.maxPool(out,[2,2],[2,2],"same"),out=depthwiseSeparableConv_1.depthwiseSeparableConv(out,params.conv3),out=tf.maxPool(out,[2,2],[2,2],"same"),out=depthwiseSeparableConv_1.depthwiseSeparableConv(out,params.conv4),out=tf.maxPool(out,[2,2],[2,2],"same"),out=depthwiseSeparableConv_1.depthwiseSeparableConv(out,params.conv5),out=tf.maxPool(out,[2,2],[1,1],"same"),out=params.conv6?depthwiseSeparableConv_1.depthwiseSeparableConv(out,params.conv6):out,out=params.conv7?depthwiseSeparableConv_1.depthwiseSeparableConv(out,params.conv7):out,common_1.convLayer(out,params.conv8,"valid",!1)},TinyYolov2.prototype.forwardInput=function(input,inputSize){var _this=this,params=this.params;if(!params)throw new Error("TinyYolov2 - load model before inference");return tf.tidy((function(){var batchTensor=input.toBatchTensor(inputSize,!1).toFloat();return batchTensor=(batchTensor=_this.config.meanRgb?normalize_1.normalize(batchTensor,_this.config.meanRgb):batchTensor).div(tf.scalar(256)),_this.config.withSeparableConvs?_this.runMobilenet(batchTensor,params):_this.runTinyYolov2(batchTensor,params)}))},TinyYolov2.prototype.forward=function(input,inputSize){return tslib_1.__awaiter(this,void 0,void 0,(function(){var _a;return tslib_1.__generator(this,(function(_b){switch(_b.label){case 0:return _a=this.forwardInput,[4,dom_1.toNetInput(input)];case 1:return[4,_a.apply(this,[_b.sent(),inputSize])];case 2:return[2,_b.sent()]}}))}))},TinyYolov2.prototype.detect=function(input,forwardParams){return void 0===forwardParams&&(forwardParams={}),tslib_1.__awaiter(this,void 0,void 0,(function(){var _a,inputSize,scoreThreshold,netInput,out,out0,inputDimensions,results,boxes,scores,classScores,classNames,indices,detections,_this=this;return tslib_1.__generator(this,(function(_b){switch(_b.label){case 0:return _a=new TinyYolov2Options_1.TinyYolov2Options(forwardParams),inputSize=_a.inputSize,scoreThreshold=_a.scoreThreshold,[4,dom_1.toNetInput(input)];case 1:return netInput=_b.sent(),[4,this.forwardInput(netInput,inputSize)];case 2:return out=_b.sent(),out0=tf.tidy((function(){return tf.unstack(out)[0].expandDims()})),inputDimensions={width:netInput.getInputWidth(0),height:netInput.getInputHeight(0)},[4,this.extractBoxes(out0,netInput.getReshapedInputDimensions(0),scoreThreshold)];case 3:return results=_b.sent(),out.dispose(),out0.dispose(),boxes=results.map((function(res){return res.box})),scores=results.map((function(res){return res.score})),classScores=results.map((function(res){return res.classScore})),classNames=results.map((function(res){return _this.config.classes[res.label]})),indices=nonMaxSuppression_1.nonMaxSuppression(boxes.map((function(box){return box.rescale(inputSize)})),scores,this.config.iouThreshold,!0),[2,detections=indices.map((function(idx){return new ObjectDetection_1.ObjectDetection(scores[idx],classScores[idx],classNames[idx],boxes[idx],inputDimensions)}))]}}))}))},TinyYolov2.prototype.getDefaultModelName=function(){return""},TinyYolov2.prototype.extractParamsFromWeigthMap=function(weightMap){return extractParamsFromWeigthMap_1.extractParamsFromWeigthMap(weightMap,this.config)},TinyYolov2.prototype.extractParams=function(weights){var filterSizes=this.config.filterSizes||TinyYolov2.DEFAULT_FILTER_SIZES,numFilters=filterSizes?filterSizes.length:void 0;if(7!==numFilters&&8!==numFilters&&9!==numFilters)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+numFilters+" filterSizes in config");return extractParams_1.extractParams(weights,this.config,this.boxEncodingSize,filterSizes)},TinyYolov2.prototype.extractBoxes=function(outputTensor,inputBlobDimensions,scoreThreshold){return tslib_1.__awaiter(this,void 0,void 0,(function(){var width,height,inputSize,correctionFactorX,correctionFactorY,numCells,numBoxes,_a,boxesTensor,scoresTensor,classScoresTensor,results,scoresData,boxesData,row,col,anchor,score,ctX,ctY,width_1,height_1,x,y,pos,_b,classScore,label,_c,_this=this;return tslib_1.__generator(this,(function(_d){switch(_d.label){case 0:return width=inputBlobDimensions.width,height=inputBlobDimensions.height,inputSize=Math.max(width,height),correctionFactorX=inputSize/width,correctionFactorY=inputSize/height,numCells=outputTensor.shape[1],numBoxes=this.config.anchors.length,_a=tf.tidy((function(){var reshaped=outputTensor.reshape([numCells,numCells,numBoxes,_this.boxEncodingSize]),boxes,scores,classScores;return[reshaped.slice([0,0,0,0],[numCells,numCells,numBoxes,4]),reshaped.slice([0,0,0,4],[numCells,numCells,numBoxes,1]),_this.withClassScores?tf.softmax(reshaped.slice([0,0,0,5],[numCells,numCells,numBoxes,_this.config.classes.length]),3):tf.scalar(0)]})),boxesTensor=_a[0],scoresTensor=_a[1],classScoresTensor=_a[2],results=[],[4,scoresTensor.array()];case 1:return scoresData=_d.sent(),[4,boxesTensor.array()];case 2:boxesData=_d.sent(),row=0,_d.label=3;case 3:if(!(row<numCells))return[3,12];col=0,_d.label=4;case 4:if(!(col<numCells))return[3,11];anchor=0,_d.label=5;case 5:return anchor<numBoxes?(score=ops_1.sigmoid(scoresData[row][col][anchor][0]),!scoreThreshold||score>scoreThreshold?(ctX=(col+ops_1.sigmoid(boxesData[row][col][anchor][0]))/numCells*correctionFactorX,ctY=(row+ops_1.sigmoid(boxesData[row][col][anchor][1]))/numCells*correctionFactorY,width_1=Math.exp(boxesData[row][col][anchor][2])*this.config.anchors[anchor].x/numCells*correctionFactorX,height_1=Math.exp(boxesData[row][col][anchor][3])*this.config.anchors[anchor].y/numCells*correctionFactorY,x=ctX-width_1/2,y=ctY-height_1/2,pos={row:row,col:col,anchor:anchor},this.withClassScores?[4,this.extractPredictedClass(classScoresTensor,pos)]:[3,7]):[3,9]):[3,10];case 6:return _c=_d.sent(),[3,8];case 7:_c={classScore:1,label:0},_d.label=8;case 8:classScore=(_b=_c).classScore,label=_b.label,results.push(tslib_1.__assign({box:new BoundingBox_1.BoundingBox(x,y,x+width_1,y+height_1),score:score,classScore:score*classScore,label:label},pos)),_d.label=9;case 9:return anchor++,[3,5];case 10:return col++,[3,4];case 11:return row++,[3,3];case 12:return boxesTensor.dispose(),scoresTensor.dispose(),classScoresTensor.dispose(),[2,results]}}))}))},TinyYolov2.prototype.extractPredictedClass=function(classesTensor,pos){return tslib_1.__awaiter(this,void 0,void 0,(function(){var row,col,anchor,classesData;return tslib_1.__generator(this,(function(_a){switch(_a.label){case 0:return row=pos.row,col=pos.col,anchor=pos.anchor,[4,classesTensor.array()];case 1:return classesData=_a.sent(),[2,Array(this.config.classes.length).fill(0).map((function(_,i){return classesData[row][col][anchor][i]})).map((function(classScore,label){return{classScore:classScore,label:label}})).reduce((function(max,curr){return max.classScore>curr.classScore?max:curr}))]}}))}))},TinyYolov2.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],TinyYolov2}(NeuralNetwork_1.NeuralNetwork);exports.TinyYolov2=TinyYolov2},{"../NeuralNetwork":520,"../classes/BoundingBox":521,"../classes/ObjectDetection":525,"../common":538,"../dom":552,"../ops":569,"../ops/nonMaxSuppression":572,"../ops/normalize":573,"./TinyYolov2Options":578,"./config":579,"./convWithBatchNorm":580,"./depthwiseSeparableConv":581,"./extractParams":582,"./extractParamsFromWeigthMap":583,"./leaky":585,"@tensorflow/tfjs-core":155,tslib:588}],578:[function(require,module,exports){"use strict";var TinyYolov2SizeType;Object.defineProperty(exports,"__esModule",{value:!0}),function(TinyYolov2SizeType){TinyYolov2SizeType[TinyYolov2SizeType.XS=224]="XS",TinyYolov2SizeType[TinyYolov2SizeType.SM=320]="SM",TinyYolov2SizeType[TinyYolov2SizeType.MD=416]="MD",TinyYolov2SizeType[TinyYolov2SizeType.LG=608]="LG"}(TinyYolov2SizeType=exports.TinyYolov2SizeType||(exports.TinyYolov2SizeType={}));var TinyYolov2Options=function(){function TinyYolov2Options(_a){var _b=void 0===_a?{}:_a,inputSize=_b.inputSize,scoreThreshold=_b.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=inputSize||416,this._scoreThreshold=scoreThreshold||.5,"number"!=typeof this._inputSize||this._inputSize%32!=0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if("number"!=typeof this._scoreThreshold||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(TinyYolov2Options.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(TinyYolov2Options.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),TinyYolov2Options}();exports.TinyYolov2Options=TinyYolov2Options},{}],579:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var isNumber=function(arg){return"number"==typeof arg};function validateConfig(config){if(!config)throw new Error("invalid config: "+config);if("boolean"!=typeof config.withSeparableConvs)throw new Error("config.withSeparableConvs has to be a boolean, have: "+config.withSeparableConvs);if(!isNumber(config.iouThreshold)||config.iouThreshold<0||config.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+config.iouThreshold);if(!Array.isArray(config.classes)||!config.classes.length||!config.classes.every((function(c){return"string"==typeof c})))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(config.classes));if(!Array.isArray(config.anchors)||!config.anchors.length||!config.anchors.map((function(a){return a||{}})).every((function(a){return isNumber(a.x)&&isNumber(a.y)})))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(config.anchors));if(config.meanRgb&&(!Array.isArray(config.meanRgb)||3!==config.meanRgb.length||!config.meanRgb.every(isNumber)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(config.meanRgb))}exports.validateConfig=validateConfig},{}],580:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tf=require("@tensorflow/tfjs-core"),leaky_1=require("./leaky");function convWithBatchNorm(x,params){return tf.tidy((function(){var out=tf.pad(x,[[0,0],[1,1],[1,1],[0,0]]);return out=tf.conv2d(out,params.conv.filters,[1,1],"valid"),out=tf.sub(out,params.bn.sub),out=tf.mul(out,params.bn.truediv),out=tf.add(out,params.conv.bias),leaky_1.leaky(out)}))}exports.convWithBatchNorm=convWithBatchNorm},{"./leaky":585,"@tensorflow/tfjs-core":155}],581:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tf=require("@tensorflow/tfjs-core"),leaky_1=require("./leaky");function depthwiseSeparableConv(x,params){return tf.tidy((function(){var out=tf.pad(x,[[0,0],[1,1],[1,1],[0,0]]);return out=tf.separableConv2d(out,params.depthwise_filter,params.pointwise_filter,[1,1],"valid"),out=tf.add(out,params.bias),leaky_1.leaky(out)}))}exports.depthwiseSeparableConv=depthwiseSeparableConv},{"./leaky":585,"@tensorflow/tfjs-core":155}],582:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tf=require("@tensorflow/tfjs-core"),common_1=require("../common"),extractSeparableConvParamsFactory_1=require("../common/extractSeparableConvParamsFactory"),extractWeightsFactory_1=require("../common/extractWeightsFactory");function extractorsFactory(extractWeights,paramMappings){var extractConvParams=common_1.extractConvParamsFactory(extractWeights,paramMappings);function extractBatchNormParams(size,mappedPrefix){var sub=tf.tensor1d(extractWeights(size)),truediv=tf.tensor1d(extractWeights(size));return paramMappings.push({paramPath:mappedPrefix+"/sub"},{paramPath:mappedPrefix+"/truediv"}),{sub:sub,truediv:truediv}}function extractConvWithBatchNormParams(channelsIn,channelsOut,mappedPrefix){var conv,bn;return{conv:extractConvParams(channelsIn,channelsOut,3,mappedPrefix+"/conv"),bn:extractBatchNormParams(channelsOut,mappedPrefix+"/bn")}}var extractSeparableConvParams=extractSeparableConvParamsFactory_1.extractSeparableConvParamsFactory(extractWeights,paramMappings);return{extractConvParams:extractConvParams,extractConvWithBatchNormParams:extractConvWithBatchNormParams,extractSeparableConvParams:extractSeparableConvParams}}function extractParams(weights,config,boxEncodingSize,filterSizes){var _a=extractWeightsFactory_1.extractWeightsFactory(weights),extractWeights=_a.extractWeights,getRemainingWeights=_a.getRemainingWeights,paramMappings=[],_b=extractorsFactory(extractWeights,paramMappings),extractConvParams=_b.extractConvParams,extractConvWithBatchNormParams=_b.extractConvWithBatchNormParams,extractSeparableConvParams=_b.extractSeparableConvParams,params;if(config.withSeparableConvs){var s0=filterSizes[0],s1=filterSizes[1],s2=filterSizes[2],s3=filterSizes[3],s4=filterSizes[4],s5=filterSizes[5],s6=filterSizes[6],s7=filterSizes[7],s8=filterSizes[8],conv0,conv1,conv2,conv3,conv4,conv5,conv6,conv7,conv8;params={conv0:conv0=config.isFirstLayerConv2d?extractConvParams(s0,s1,3,"conv0"):extractSeparableConvParams(s0,s1,"conv0"),conv1:conv1=extractSeparableConvParams(s1,s2,"conv1"),conv2:conv2=extractSeparableConvParams(s2,s3,"conv2"),conv3:conv3=extractSeparableConvParams(s3,s4,"conv3"),conv4:conv4=extractSeparableConvParams(s4,s5,"conv4"),conv5:conv5=extractSeparableConvParams(s5,s6,"conv5"),conv6:conv6=s7?extractSeparableConvParams(s6,s7,"conv6"):void 0,conv7:conv7=s8?extractSeparableConvParams(s7,s8,"conv7"):void 0,conv8:conv8=extractConvParams(s8||s7||s6,5*boxEncodingSize,1,"conv8")}}else{var s0=filterSizes[0],s1=filterSizes[1],s2=filterSizes[2],s3=filterSizes[3],s4=filterSizes[4],s5=filterSizes[5],s6=filterSizes[6],s7=filterSizes[7],s8=filterSizes[8],conv0,conv1,conv2,conv3,conv4,conv5,conv6,conv7,conv8;params={conv0:conv0=extractConvWithBatchNormParams(s0,s1,"conv0"),conv1:conv1=extractConvWithBatchNormParams(s1,s2,"conv1"),conv2:conv2=extractConvWithBatchNormParams(s2,s3,"conv2"),conv3:conv3=extractConvWithBatchNormParams(s3,s4,"conv3"),conv4:conv4=extractConvWithBatchNormParams(s4,s5,"conv4"),conv5:conv5=extractConvWithBatchNormParams(s5,s6,"conv5"),conv6:conv6=extractConvWithBatchNormParams(s6,s7,"conv6"),conv7:conv7=extractConvWithBatchNormParams(s7,s8,"conv7"),conv8:conv8=extractConvParams(s8,5*boxEncodingSize,1,"conv8")}}if(0!==getRemainingWeights().length)throw new Error("weights remaing after extract: "+getRemainingWeights().length);return{params:params,paramMappings:paramMappings}}exports.extractParams=extractParams},{"../common":538,"../common/extractSeparableConvParamsFactory":534,"../common/extractWeightsFactory":536,"@tensorflow/tfjs-core":155}],583:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var disposeUnusedWeightTensors_1=require("../common/disposeUnusedWeightTensors"),extractSeparableConvParamsFactory_1=require("../common/extractSeparableConvParamsFactory"),extractWeightEntryFactory_1=require("../common/extractWeightEntryFactory");function extractorsFactory(weightMap,paramMappings){var extractWeightEntry=extractWeightEntryFactory_1.extractWeightEntryFactory(weightMap,paramMappings),extractSeparableConvParams;function extractBatchNormParams(prefix){var sub,truediv;return{sub:extractWeightEntry(prefix+"/sub",1),truediv:extractWeightEntry(prefix+"/truediv",1)}}function extractConvParams(prefix){var filters,bias;return{filters:extractWeightEntry(prefix+"/filters",4),bias:extractWeightEntry(prefix+"/bias",1)}}function extractConvWithBatchNormParams(prefix){var conv,bn;return{conv:extractConvParams(prefix+"/conv"),bn:extractBatchNormParams(prefix+"/bn")}}return{extractConvParams:extractConvParams,extractConvWithBatchNormParams:extractConvWithBatchNormParams,extractSeparableConvParams:extractSeparableConvParamsFactory_1.loadSeparableConvParamsFactory(extractWeightEntry)}}function extractParamsFromWeigthMap(weightMap,config){var paramMappings=[],_a=extractorsFactory(weightMap,paramMappings),extractConvParams=_a.extractConvParams,extractConvWithBatchNormParams=_a.extractConvWithBatchNormParams,extractSeparableConvParams=_a.extractSeparableConvParams,params;if(config.withSeparableConvs){var numFilters=config.filterSizes&&config.filterSizes.length||9;params={conv0:config.isFirstLayerConv2d?extractConvParams("conv0"):extractSeparableConvParams("conv0"),conv1:extractSeparableConvParams("conv1"),conv2:extractSeparableConvParams("conv2"),conv3:extractSeparableConvParams("conv3"),conv4:extractSeparableConvParams("conv4"),conv5:extractSeparableConvParams("conv5"),conv6:numFilters>7?extractSeparableConvParams("conv6"):void 0,conv7:numFilters>8?extractSeparableConvParams("conv7"):void 0,conv8:extractConvParams("conv8")}}else params={conv0:extractConvWithBatchNormParams("conv0"),conv1:extractConvWithBatchNormParams("conv1"),conv2:extractConvWithBatchNormParams("conv2"),conv3:extractConvWithBatchNormParams("conv3"),conv4:extractConvWithBatchNormParams("conv4"),conv5:extractConvWithBatchNormParams("conv5"),conv6:extractConvWithBatchNormParams("conv6"),conv7:extractConvWithBatchNormParams("conv7"),conv8:extractConvParams("conv8")};return disposeUnusedWeightTensors_1.disposeUnusedWeightTensors(weightMap,paramMappings),{params:params,paramMappings:paramMappings}}exports.extractParamsFromWeigthMap=extractParamsFromWeigthMap},{"../common/disposeUnusedWeightTensors":531,"../common/extractSeparableConvParamsFactory":534,"../common/extractWeightEntryFactory":535}],584:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib");tslib_1.__exportStar(require("./TinyYolov2"),exports),tslib_1.__exportStar(require("./TinyYolov2Options"),exports),tslib_1.__exportStar(require("./config"),exports)},{"./TinyYolov2":577,"./TinyYolov2Options":578,"./config":579,tslib:588}],585:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tf=require("@tensorflow/tfjs-core");function leaky(x){return tf.tidy((function(){var min=tf.mul(x,tf.scalar(.10000000149011612));return tf.add(tf.relu(tf.sub(x,min)),min)}))}exports.leaky=leaky},{"@tensorflow/tfjs-core":155}],586:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tf=require("@tensorflow/tfjs-core"),Dimensions_1=require("../classes/Dimensions"),Point_1=require("../classes/Point");function isTensor(tensor,dim){return tensor instanceof tf.Tensor&&tensor.shape.length===dim}function isTensor1D(tensor){return isTensor(tensor,1)}function isTensor2D(tensor){return isTensor(tensor,2)}function isTensor3D(tensor){return isTensor(tensor,3)}function isTensor4D(tensor){return isTensor(tensor,4)}function isFloat(num){return num%1!=0}function isEven(num){return num%2==0}function round(num,prec){void 0===prec&&(prec=2);var f=Math.pow(10,prec);return Math.floor(num*f)/f}function isDimensions(obj){return obj&&obj.width&&obj.height}function computeReshapedDimensions(_a,inputSize){var width=_a.width,height=_a.height,scale=inputSize/Math.max(height,width);return new Dimensions_1.Dimensions(Math.round(width*scale),Math.round(height*scale))}function getCenterPoint(pts){return pts.reduce((function(sum,pt){return sum.add(pt)}),new Point_1.Point(0,0)).div(new Point_1.Point(pts.length,pts.length))}function range(num,start,step){return Array(num).fill(0).map((function(_,i){return start+i*step}))}function isValidNumber(num){return!!num&&num!==1/0&&num!==-1/0&&!isNaN(num)||0===num}function isValidProbablitiy(num){return isValidNumber(num)&&0<=num&&num<=1}exports.isTensor=isTensor,exports.isTensor1D=isTensor1D,exports.isTensor2D=isTensor2D,exports.isTensor3D=isTensor3D,exports.isTensor4D=isTensor4D,exports.isFloat=isFloat,exports.isEven=isEven,exports.round=round,exports.isDimensions=isDimensions,exports.computeReshapedDimensions=computeReshapedDimensions,exports.getCenterPoint=getCenterPoint,exports.range=range,exports.isValidNumber=isValidNumber,exports.isValidProbablitiy=isValidProbablitiy},{"../classes/Dimensions":523,"../classes/Point":526,"@tensorflow/tfjs-core":155}],587:[function(require,module,exports){(function(setImmediate,clearImmediate){(function(){var nextTick=require("process/browser.js").nextTick,apply=Function.prototype.apply,slice=Array.prototype.slice,immediateIds={},nextImmediateId=0;function Timeout(id,clearFn){this._id=id,this._clearFn=clearFn}exports.setTimeout=function(){return new Timeout(apply.call(setTimeout,window,arguments),clearTimeout)},exports.setInterval=function(){return new Timeout(apply.call(setInterval,window,arguments),clearInterval)},exports.clearTimeout=exports.clearInterval=function(timeout){timeout.close()},Timeout.prototype.unref=Timeout.prototype.ref=function(){},Timeout.prototype.close=function(){this._clearFn.call(window,this._id)},exports.enroll=function(item,msecs){clearTimeout(item._idleTimeoutId),item._idleTimeout=msecs},exports.unenroll=function(item){clearTimeout(item._idleTimeoutId),item._idleTimeout=-1},exports._unrefActive=exports.active=function(item){clearTimeout(item._idleTimeoutId);var msecs=item._idleTimeout;msecs>=0&&(item._idleTimeoutId=setTimeout((function onTimeout(){item._onTimeout&&item._onTimeout()}),msecs))},exports.setImmediate="function"==typeof setImmediate?setImmediate:function(fn){var id=nextImmediateId++,args=!(arguments.length<2)&&slice.call(arguments,1);return immediateIds[id]=!0,nextTick((function onNextTick(){immediateIds[id]&&(args?fn.apply(null,args):fn.call(null),exports.clearImmediate(id))})),id},exports.clearImmediate="function"==typeof clearImmediate?clearImmediate:function(id){delete immediateIds[id]}}).call(this)}).call(this,require("timers").setImmediate,require("timers").clearImmediate)},{"process/browser.js":422,timers:587}],588:[function(require,module,exports){(function(global){(function(){
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
var __extends,__assign,__rest,__decorate,__param,__metadata,__awaiter,__generator,__exportStar,__values,__read,__spread,__spreadArrays,__await,__asyncGenerator,__asyncDelegator,__asyncValues,__makeTemplateObject,__importStar,__importDefault,__classPrivateFieldGet,__classPrivateFieldSet,__createBinding;!function(factory){var root="object"==typeof global?global:"object"==typeof self?self:"object"==typeof this?this:{};function createExporter(exports,previous){return exports!==root&&("function"==typeof Object.create?Object.defineProperty(exports,"__esModule",{value:!0}):exports.__esModule=!0),function(id,v){return exports[id]=previous?previous(id,v):v}}"function"==typeof define&&define.amd?define("tslib",["exports"],(function(exports){factory(createExporter(root,createExporter(exports)))})):"object"==typeof module&&"object"==typeof module.exports?factory(createExporter(root,createExporter(module.exports))):factory(createExporter(root))}((function(exporter){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};__extends=function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t},__rest=function(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,p=Object.getOwnPropertySymbols(s);i<p.length;i++)e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i])&&(t[p[i]]=s[p[i]]);return t},__decorate=function(decorators,target,key,desc){var c=arguments.length,r=c<3?target:null===desc?desc=Object.getOwnPropertyDescriptor(target,key):desc,d;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;i>=0;i--)(d=decorators[i])&&(r=(c<3?d(r):c>3?d(target,key,r):d(target,key))||r);return c>3&&r&&Object.defineProperty(target,key,r),r},__param=function(paramIndex,decorator){return function(target,key){decorator(target,key,paramIndex)}},__metadata=function(metadataKey,metadataValue){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(metadataKey,metadataValue)},__awaiter=function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},__generator=function(thisArg,body){var _={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}},__createBinding=function(o,m,k,k2){void 0===k2&&(k2=k),o[k2]=m[k]},__exportStar=function(m,exports){for(var p in m)"default"===p||exports.hasOwnProperty(p)||(exports[p]=m[p])},__values=function(o){var s="function"==typeof Symbol&&Symbol.iterator,m=s&&o[s],i=0;if(m)return m.call(o);if(o&&"number"==typeof o.length)return{next:function(){return o&&i>=o.length&&(o=void 0),{value:o&&o[i++],done:!o}}};throw new TypeError(s?"Object is not iterable.":"Symbol.iterator is not defined.")},__read=function(o,n){var m="function"==typeof Symbol&&o[Symbol.iterator];if(!m)return o;var i=m.call(o),r,ar=[],e;try{for(;(void 0===n||n-- >0)&&!(r=i.next()).done;)ar.push(r.value)}catch(error){e={error:error}}finally{try{r&&!r.done&&(m=i.return)&&m.call(i)}finally{if(e)throw e.error}}return ar},__spread=function(){for(var ar=[],i=0;i<arguments.length;i++)ar=ar.concat(__read(arguments[i]));return ar},__spreadArrays=function(){for(var s=0,i=0,il=arguments.length;i<il;i++)s+=arguments[i].length;for(var r=Array(s),k=0,i=0;i<il;i++)for(var a=arguments[i],j=0,jl=a.length;j<jl;j++,k++)r[k]=a[j];return r},__await=function(v){return this instanceof __await?(this.v=v,this):new __await(v)},__asyncGenerator=function(thisArg,_arguments,generator){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var g=generator.apply(thisArg,_arguments||[]),i,q=[];return i={},verb("next"),verb("throw"),verb("return"),i[Symbol.asyncIterator]=function(){return this},i;function verb(n){g[n]&&(i[n]=function(v){return new Promise((function(a,b){q.push([n,v,a,b])>1||resume(n,v)}))})}function resume(n,v){try{step(g[n](v))}catch(e){settle(q[0][3],e)}}function step(r){r.value instanceof __await?Promise.resolve(r.value.v).then(fulfill,reject):settle(q[0][2],r)}function fulfill(value){resume("next",value)}function reject(value){resume("throw",value)}function settle(f,v){f(v),q.shift(),q.length&&resume(q[0][0],q[0][1])}},__asyncDelegator=function(o){var i,p;return i={},verb("next"),verb("throw",(function(e){throw e})),verb("return"),i[Symbol.iterator]=function(){return this},i;function verb(n,f){i[n]=o[n]?function(v){return(p=!p)?{value:__await(o[n](v)),done:"return"===n}:f?f(v):v}:f}},__asyncValues=function(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var m=o[Symbol.asyncIterator],i;return m?m.call(o):(o=__values(o),i={},verb("next"),verb("throw"),verb("return"),i[Symbol.asyncIterator]=function(){return this},i);function verb(n){i[n]=o[n]&&function(v){return new Promise((function(resolve,reject){settle(resolve,reject,(v=o[n](v)).done,v.value)}))}}function settle(resolve,reject,d,v){Promise.resolve(v).then((function(v){resolve({value:v,done:d})}),reject)}},__makeTemplateObject=function(cooked,raw){return Object.defineProperty?Object.defineProperty(cooked,"raw",{value:raw}):cooked.raw=raw,cooked},__importStar=function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)Object.hasOwnProperty.call(mod,k)&&(result[k]=mod[k]);return result.default=mod,result},__importDefault=function(mod){return mod&&mod.__esModule?mod:{default:mod}},__classPrivateFieldGet=function(receiver,privateMap){if(!privateMap.has(receiver))throw new TypeError("attempted to get private field on non-instance");return privateMap.get(receiver)},__classPrivateFieldSet=function(receiver,privateMap,value){if(!privateMap.has(receiver))throw new TypeError("attempted to set private field on non-instance");return privateMap.set(receiver,value),value},exporter("__extends",__extends),exporter("__assign",__assign),exporter("__rest",__rest),exporter("__decorate",__decorate),exporter("__param",__param),exporter("__metadata",__metadata),exporter("__awaiter",__awaiter),exporter("__generator",__generator),exporter("__exportStar",__exportStar),exporter("__createBinding",__createBinding),exporter("__values",__values),exporter("__read",__read),exporter("__spread",__spread),exporter("__spreadArrays",__spreadArrays),exporter("__await",__await),exporter("__asyncGenerator",__asyncGenerator),exporter("__asyncDelegator",__asyncDelegator),exporter("__asyncValues",__asyncValues),exporter("__makeTemplateObject",__makeTemplateObject),exporter("__importStar",__importStar),exporter("__importDefault",__importDefault),exporter("__classPrivateFieldGet",__classPrivateFieldGet),exporter("__classPrivateFieldSet",__classPrivateFieldSet)}))}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],589:[function(require,module,exports){"use strict";const uniqueRandom=require("unique-random");module.exports=array=>{const random=uniqueRandom(0,array.length-1);return()=>array[random()]}},{"unique-random":590}],590:[function(require,module,exports){"use strict";module.exports=(minimum,maximum)=>{let previousValue;return function random(){const number=Math.floor(Math.random()*(maximum-minimum+1)+minimum);return previousValue=number===previousValue&&minimum!==maximum?random():number,previousValue}}},{}],591:[function(require,module,exports){(function(global){(function(){"use strict";var required=require("requires-port"),qs=require("querystringify"),slashes=/^[A-Za-z][A-Za-z0-9+-.]*:[\\/]+/,protocolre=/^([a-z][a-z0-9.+-]*:)?([\\/]{1,})?([\S\s]*)/i,whitespace,left=new RegExp("^"+"[\\x09\\x0A\\x0B\\x0C\\x0D\\x20\\xA0\\u1680\\u180E\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200A\\u202F\\u205F\\u3000\\u2028\\u2029\\uFEFF]"+"+");function trimLeft(str){return(str||"").toString().replace(left,"")}var rules=[["#","hash"],["?","query"],function sanitize(address){return address.replace("\\","/")},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d+)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],ignore={hash:1,query:1};function lolcation(loc){var globalVar,location=(globalVar="undefined"!=typeof window?window:void 0!==global?global:"undefined"!=typeof self?self:{}).location||{},finaldestination={},type=typeof(loc=loc||location),key;if("blob:"===loc.protocol)finaldestination=new Url(unescape(loc.pathname),{});else if("string"===type)for(key in finaldestination=new Url(loc,{}),ignore)delete finaldestination[key];else if("object"===type){for(key in loc)key in ignore||(finaldestination[key]=loc[key]);void 0===finaldestination.slashes&&(finaldestination.slashes=slashes.test(loc.href))}return finaldestination}function extractProtocol(address){address=trimLeft(address);var match=protocolre.exec(address),protocol,slashes,rest;return{protocol:match[1]?match[1].toLowerCase():"",slashes:!!(match[2]&&match[2].length>=2),rest:match[2]&&1===match[2].length?"/"+match[3]:match[3]}}function resolve(relative,base){if(""===relative)return base;for(var path=(base||"/").split("/").slice(0,-1).concat(relative.split("/")),i=path.length,last=path[i-1],unshift=!1,up=0;i--;)"."===path[i]?path.splice(i,1):".."===path[i]?(path.splice(i,1),up++):up&&(0===i&&(unshift=!0),path.splice(i,1),up--);return unshift&&path.unshift(""),"."!==last&&".."!==last||path.push(""),path.join("/")}function Url(address,location,parser){if(address=trimLeft(address),!(this instanceof Url))return new Url(address,location,parser);var relative,extracted,parse,instruction,index,key,instructions=rules.slice(),type=typeof location,url=this,i=0;for("object"!==type&&"string"!==type&&(parser=location,location=null),parser&&"function"!=typeof parser&&(parser=qs.parse),location=lolcation(location),relative=!(extracted=extractProtocol(address||"")).protocol&&!extracted.slashes,url.slashes=extracted.slashes||relative&&location.slashes,url.protocol=extracted.protocol||location.protocol||"",address=extracted.rest,extracted.slashes||(instructions[3]=[/(.*)/,"pathname"]);i<instructions.length;i++)"function"!=typeof(instruction=instructions[i])?(parse=instruction[0],key=instruction[1],parse!=parse?url[key]=address:"string"==typeof parse?~(index=address.indexOf(parse))&&("number"==typeof instruction[2]?(url[key]=address.slice(0,index),address=address.slice(index+instruction[2])):(url[key]=address.slice(index),address=address.slice(0,index))):(index=parse.exec(address))&&(url[key]=index[1],address=address.slice(0,index.index)),url[key]=url[key]||relative&&instruction[3]&&location[key]||"",instruction[4]&&(url[key]=url[key].toLowerCase())):address=instruction(address);parser&&(url.query=parser(url.query)),relative&&location.slashes&&"/"!==url.pathname.charAt(0)&&(""!==url.pathname||""!==location.pathname)&&(url.pathname=resolve(url.pathname,location.pathname)),"/"!==url.pathname.charAt(0)&&url.hostname&&(url.pathname="/"+url.pathname),required(url.port,url.protocol)||(url.host=url.hostname,url.port=""),url.username=url.password="",url.auth&&(instruction=url.auth.split(":"),url.username=instruction[0]||"",url.password=instruction[1]||""),url.origin=url.protocol&&url.host&&"file:"!==url.protocol?url.protocol+"//"+url.host:"null",url.href=url.toString()}function set(part,value,fn){var url=this;switch(part){case"query":"string"==typeof value&&value.length&&(value=(fn||qs.parse)(value)),url[part]=value;break;case"port":url[part]=value,required(value,url.protocol)?value&&(url.host=url.hostname+":"+value):(url.host=url.hostname,url[part]="");break;case"hostname":url[part]=value,url.port&&(value+=":"+url.port),url.host=value;break;case"host":url[part]=value,/:\d+$/.test(value)?(value=value.split(":"),url.port=value.pop(),url.hostname=value.join(":")):(url.hostname=value,url.port="");break;case"protocol":url.protocol=value.toLowerCase(),url.slashes=!fn;break;case"pathname":case"hash":if(value){var char="pathname"===part?"/":"#";url[part]=value.charAt(0)!==char?char+value:value}else url[part]=value;break;default:url[part]=value}for(var i=0;i<rules.length;i++){var ins=rules[i];ins[4]&&(url[ins[1]]=url[ins[1]].toLowerCase())}return url.origin=url.protocol&&url.host&&"file:"!==url.protocol?url.protocol+"//"+url.host:"null",url.href=url.toString(),url}function toString(stringify){stringify&&"function"==typeof stringify||(stringify=qs.stringify);var query,url=this,protocol=url.protocol;protocol&&":"!==protocol.charAt(protocol.length-1)&&(protocol+=":");var result=protocol+(url.slashes?"//":"");return url.username&&(result+=url.username,url.password&&(result+=":"+url.password),result+="@"),result+=url.host+url.pathname,(query="object"==typeof url.query?stringify(url.query):url.query)&&(result+="?"!==query.charAt(0)?"?"+query:query),url.hash&&(result+=url.hash),result}Url.prototype={set:set,toString:toString},Url.extractProtocol=extractProtocol,Url.location=lolcation,Url.trimLeft=trimLeft,Url.qs=qs,module.exports=Url}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{querystringify:436,"requires-port":487}],592:[function(require,module,exports){var _globalThis;if("object"==typeof globalThis)_globalThis=globalThis;else try{_globalThis=require("es5-ext/global")}catch(error){}finally{if(_globalThis||"undefined"==typeof window||(_globalThis=window),!_globalThis)throw new Error("Could not determine global this")}var NativeWebSocket=_globalThis.WebSocket||_globalThis.MozWebSocket,websocket_version=require("./version");function W3CWebSocket(uri,protocols){var native_instance;return native_instance=protocols?new NativeWebSocket(uri,protocols):new NativeWebSocket(uri)}NativeWebSocket&&["CONNECTING","OPEN","CLOSING","CLOSED"].forEach((function(prop){Object.defineProperty(W3CWebSocket,prop,{get:function(){return NativeWebSocket[prop]}})})),module.exports={w3cwebsocket:NativeWebSocket?W3CWebSocket:null,version:websocket_version}},{"./version":593,"es5-ext/global":266}],593:[function(require,module,exports){module.exports=require("../package.json").version},{"../package.json":594}],594:[function(require,module,exports){module.exports={_from:"websocket@^1.0.33",_id:"websocket@1.0.34",_inBundle:!1,_integrity:"sha512-PRDso2sGwF6kM75QykIesBijKSVceR6jL2G8NGYyq2XrItNC2P5/qL5XeR056GhA+Ly7JMFvJb9I312mJfmqnQ==",_location:"/websocket",_phantomChildren:{},_requested:{type:"range",registry:!0,raw:"websocket@^1.0.33",name:"websocket",escapedName:"websocket",rawSpec:"^1.0.33",saveSpec:null,fetchSpec:"^1.0.33"},_requiredBy:["/protoo-client"],_resolved:"https://registry.npmjs.org/websocket/-/websocket-1.0.34.tgz",_shasum:"2bdc2602c08bf2c82253b730655c0ef7dcab3111",_spec:"websocket@^1.0.33",_where:"H:\\t\\mediasoap\\v1\\mediasoup-demo\\app\\node_modules\\protoo-client",author:{name:"Brian McKelvey",email:"theturtle32@gmail.com",url:"https://github.com/theturtle32"},browser:"lib/browser.js",bugs:{url:"https://github.com/theturtle32/WebSocket-Node/issues"},bundleDependencies:!1,config:{verbose:!1},contributors:[{name:"Iaki Baz Castillo",email:"ibc@aliax.net",url:"http://dev.sipdoc.net"}],dependencies:{bufferutil:"^4.0.1",debug:"^2.2.0","es5-ext":"^0.10.50","typedarray-to-buffer":"^3.1.5","utf-8-validate":"^5.0.2",yaeti:"^0.0.6"},deprecated:!1,description:"Websocket Client & Server Library implementing the WebSocket protocol as specified in RFC 6455.",devDependencies:{"buffer-equal":"^1.0.0",gulp:"^4.0.2","gulp-jshint":"^2.0.4",jshint:"^2.0.0","jshint-stylish":"^2.2.1",tape:"^4.9.1"},directories:{lib:"./lib"},engines:{node:">=4.0.0"},homepage:"https://github.com/theturtle32/WebSocket-Node",keywords:["websocket","websockets","socket","networking","comet","push","RFC-6455","realtime","server","client"],license:"Apache-2.0",main:"index",name:"websocket",repository:{type:"git",url:"git+https://github.com/theturtle32/WebSocket-Node.git"},scripts:{gulp:"gulp",test:"tape test/unit/*.js"},version:"1.0.34"}},{}],595:[function(require,module,exports){function WildEmitter(){}module.exports=WildEmitter,WildEmitter.mixin=function(constructor){var prototype=constructor.prototype||constructor;prototype.isWildEmitter=!0,prototype.on=function(event,groupName,fn){this.callbacks=this.callbacks||{};var hasGroup=3===arguments.length,group=hasGroup?arguments[1]:void 0,func=hasGroup?arguments[2]:arguments[1];return func._groupName=group,(this.callbacks[event]=this.callbacks[event]||[]).push(func),this},prototype.once=function(event,groupName,fn){var self=this,hasGroup=3===arguments.length,group=hasGroup?arguments[1]:void 0,func=hasGroup?arguments[2]:arguments[1];function on(){self.off(event,on),func.apply(this,arguments)}return this.on(event,group,on),this},prototype.releaseGroup=function(groupName){var item,i,len,handlers;for(item in this.callbacks=this.callbacks||{},this.callbacks)for(i=0,len=(handlers=this.callbacks[item]).length;i<len;i++)handlers[i]._groupName===groupName&&(handlers.splice(i,1),i--,len--);return this},prototype.off=function(event,fn){this.callbacks=this.callbacks||{};var callbacks=this.callbacks[event],i;return callbacks?1===arguments.length?(delete this.callbacks[event],this):(-1!==(i=callbacks.indexOf(fn))&&(callbacks.splice(i,1),0===callbacks.length&&delete this.callbacks[event]),this):this},prototype.emit=function(event){this.callbacks=this.callbacks||{};var args=[].slice.call(arguments,1),callbacks=this.callbacks[event],specialCallbacks=this.getWildcardCallbacks(event),i,len,item,listeners;if(callbacks)for(i=0,len=(listeners=callbacks.slice()).length;i<len&&listeners[i];++i)listeners[i].apply(this,args);if(specialCallbacks)for(len=specialCallbacks.length,i=0,len=(listeners=specialCallbacks.slice()).length;i<len&&listeners[i];++i)listeners[i].apply(this,[event].concat(args));return this},prototype.getWildcardCallbacks=function(eventName){this.callbacks=this.callbacks||{};var item,split,result=[];for(item in this.callbacks)split=item.split("*"),("*"===item||2===split.length&&eventName.slice(0,split[0].length)===split[0])&&(result=result.concat(this.callbacks[item]));return result}},WildEmitter.mixin(WildEmitter)},{}]},{},[20]);