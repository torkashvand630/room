!function () { return function e(t, n, i) { function o(s, a) { if (!n[s]) { if (!t[s]) { var c = "function" == typeof require && require; if (!a && c) return c(s, !0); if (r) return r(s, !0); var d = new Error("Cannot find module '" + s + "'"); throw d.code = "MODULE_NOT_FOUND", d } var u = n[s] = { exports: {} }; t[s][0].call(u.exports, function (e) { return o(t[s][1][e] || e) }, u, u.exports, e, t, n, i) } return n[s].exports } for (var r = "function" == typeof require && require, s = 0; s < i.length; s++)o(i[s]); return o } }()({ 1: [function (e, t, n) { var i = Object.create || function (e) { var t = function () { }; return t.prototype = e, new t }, o = Object.keys || function (e) { var t = []; for (var n in e) Object.prototype.hasOwnProperty.call(e, n) && t.push(n); return n }, r = Function.prototype.bind || function (e) { var t = this; return function () { return t.apply(e, arguments) } }; function s() { this._events && Object.prototype.hasOwnProperty.call(this, "_events") || (this._events = i(null), this._eventsCount = 0), this._maxListeners = this._maxListeners || void 0 } t.exports = s, s.EventEmitter = s, s.prototype._events = void 0, s.prototype._maxListeners = void 0; var a, c = 10; try { var d = {}; Object.defineProperty && Object.defineProperty(d, "x", { value: 0 }), a = 0 === d.x } catch (e) { a = !1 } function u(e) { return void 0 === e._maxListeners ? s.defaultMaxListeners : e._maxListeners } function l(e, t, n, o) { var r, s, a; if ("function" != typeof n) throw new TypeError('"listener" argument must be a function'); if ((s = e._events) ? (s.newListener && (e.emit("newListener", t, n.listener ? n.listener : n), s = e._events), a = s[t]) : (s = e._events = i(null), e._eventsCount = 0), a) { if ("function" == typeof a ? a = s[t] = o ? [n, a] : [a, n] : o ? a.unshift(n) : a.push(n), !a.warned && (r = u(e)) && r > 0 && a.length > r) { a.warned = !0; var c = new Error("Possible EventEmitter memory leak detected. " + a.length + ' "' + String(t) + '" listeners added. Use emitter.setMaxListeners() to increase limit.'); c.name = "MaxListenersExceededWarning", c.emitter = e, c.type = t, c.count = a.length, "object" == typeof console && console.warn && console.warn("%s: %s", c.name, c.message) } } else a = s[t] = n, ++e._eventsCount; return e } function p() { if (!this.fired) switch (this.target.removeListener(this.type, this.wrapFn), this.fired = !0, arguments.length) { case 0: return this.listener.call(this.target); case 1: return this.listener.call(this.target, arguments[0]); case 2: return this.listener.call(this.target, arguments[0], arguments[1]); case 3: return this.listener.call(this.target, arguments[0], arguments[1], arguments[2]); default: for (var e = new Array(arguments.length), t = 0; t < e.length; ++t)e[t] = arguments[t]; this.listener.apply(this.target, e) } } function f(e, t, n) { var i = { fired: !1, wrapFn: void 0, target: e, type: t, listener: n }, o = r.call(p, i); return o.listener = n, i.wrapFn = o, o } function h(e, t, n) { var i = e._events; if (!i) return []; var o = i[t]; return o ? "function" == typeof o ? n ? [o.listener || o] : [o] : n ? function (e) { for (var t = new Array(e.length), n = 0; n < t.length; ++n)t[n] = e[n].listener || e[n]; return t }(o) : v(o, o.length) : [] } function m(e) { var t = this._events; if (t) { var n = t[e]; if ("function" == typeof n) return 1; if (n) return n.length } return 0 } function v(e, t) { for (var n = new Array(t), i = 0; i < t; ++i)n[i] = e[i]; return n } a ? Object.defineProperty(s, "defaultMaxListeners", { enumerable: !0, get: function () { return c }, set: function (e) { if ("number" != typeof e || e < 0 || e != e) throw new TypeError('"defaultMaxListeners" must be a positive number'); c = e } }) : s.defaultMaxListeners = c, s.prototype.setMaxListeners = function (e) { if ("number" != typeof e || e < 0 || isNaN(e)) throw new TypeError('"n" argument must be a positive number'); return this._maxListeners = e, this }, s.prototype.getMaxListeners = function () { return u(this) }, s.prototype.emit = function (e) { var t, n, i, o, r, s, a = "error" === e; if (s = this._events) a = a && null == s.error; else if (!a) return !1; if (a) { if (arguments.length > 1 && (t = arguments[1]), t instanceof Error) throw t; var c = new Error('Unhandled "error" event. (' + t + ")"); throw c.context = t, c } if (!(n = s[e])) return !1; var d = "function" == typeof n; switch (i = arguments.length) { case 1: !function (e, t, n) { if (t) e.call(n); else for (var i = e.length, o = v(e, i), r = 0; r < i; ++r)o[r].call(n) }(n, d, this); break; case 2: !function (e, t, n, i) { if (t) e.call(n, i); else for (var o = e.length, r = v(e, o), s = 0; s < o; ++s)r[s].call(n, i) }(n, d, this, arguments[1]); break; case 3: !function (e, t, n, i, o) { if (t) e.call(n, i, o); else for (var r = e.length, s = v(e, r), a = 0; a < r; ++a)s[a].call(n, i, o) }(n, d, this, arguments[1], arguments[2]); break; case 4: !function (e, t, n, i, o, r) { if (t) e.call(n, i, o, r); else for (var s = e.length, a = v(e, s), c = 0; c < s; ++c)a[c].call(n, i, o, r) }(n, d, this, arguments[1], arguments[2], arguments[3]); break; default: for (o = new Array(i - 1), r = 1; r < i; r++)o[r - 1] = arguments[r]; !function (e, t, n, i) { if (t) e.apply(n, i); else for (var o = e.length, r = v(e, o), s = 0; s < o; ++s)r[s].apply(n, i) }(n, d, this, o) }return !0 }, s.prototype.addListener = function (e, t) { return l(this, e, t, !1) }, s.prototype.on = s.prototype.addListener, s.prototype.prependListener = function (e, t) { return l(this, e, t, !0) }, s.prototype.once = function (e, t) { if ("function" != typeof t) throw new TypeError('"listener" argument must be a function'); return this.on(e, f(this, e, t)), this }, s.prototype.prependOnceListener = function (e, t) { if ("function" != typeof t) throw new TypeError('"listener" argument must be a function'); return this.prependListener(e, f(this, e, t)), this }, s.prototype.removeListener = function (e, t) { var n, o, r, s, a; if ("function" != typeof t) throw new TypeError('"listener" argument must be a function'); if (!(o = this._events)) return this; if (!(n = o[e])) return this; if (n === t || n.listener === t) 0 == --this._eventsCount ? this._events = i(null) : (delete o[e], o.removeListener && this.emit("removeListener", e, n.listener || t)); else if ("function" != typeof n) { for (r = -1, s = n.length - 1; s >= 0; s--)if (n[s] === t || n[s].listener === t) { a = n[s].listener, r = s; break } if (r < 0) return this; 0 === r ? n.shift() : function (e, t) { for (var n = t, i = n + 1, o = e.length; i < o; n += 1, i += 1)e[n] = e[i]; e.pop() }(n, r), 1 === n.length && (o[e] = n[0]), o.removeListener && this.emit("removeListener", e, a || t) } return this }, s.prototype.removeAllListeners = function (e) { var t, n, r; if (!(n = this._events)) return this; if (!n.removeListener) return 0 === arguments.length ? (this._events = i(null), this._eventsCount = 0) : n[e] && (0 == --this._eventsCount ? this._events = i(null) : delete n[e]), this; if (0 === arguments.length) { var s, a = o(n); for (r = 0; r < a.length; ++r)"removeListener" !== (s = a[r]) && this.removeAllListeners(s); return this.removeAllListeners("removeListener"), this._events = i(null), this._eventsCount = 0, this } if ("function" == typeof (t = n[e])) this.removeListener(e, t); else if (t) for (r = t.length - 1; r >= 0; r--)this.removeListener(e, t[r]); return this }, s.prototype.listeners = function (e) { return h(this, e, !0) }, s.prototype.rawListeners = function (e) { return h(this, e, !1) }, s.listenerCount = function (e, t) { return "function" == typeof e.listenerCount ? e.listenerCount(t) : m.call(e, t) }, s.prototype.listenerCount = m, s.prototype.eventNames = function () { return this._eventsCount > 0 ? Reflect.ownKeys(this._events) : [] } }, {}], 2: [function (e, t, n) { "use strict"; var i = e("normalice"); t.exports = function (t) { var n, o = { stun: (t || {}).stun || e("./stun.json"), turn: (t || {}).turn || e("./turn.json") }, r = (t || {}).stunCount || 2, s = (t || {}).turnCount || 0; function a(e, t) { for (var n, r = [], s = [].concat(o[e]); s.length && r.length < t;)n = Math.random() * s.length | 0, r = r.concat(s.splice(n, 1)); return r.map(function (t) { return "string" == typeof t || t instanceof String ? i(e + ":" + t) : t }) } return n = [].concat(a("stun", r)), s && (n = n.concat(a("turn", s))), n } }, { "./stun.json": 3, "./turn.json": 4, normalice: 7 }], 3: [function (e, t, n) { t.exports = ["stun.l.google.com:19302", "stun1.l.google.com:19302", "stun2.l.google.com:19302", "stun3.l.google.com:19302", "stun4.l.google.com:19302", "stun.ekiga.net", "stun.ideasip.com", "stun.schlund.de", "stun.stunprotocol.org:3478", "stun.voiparound.com", "stun.voipbuster.com", "stun.voipstunt.com", "stun.voxgratia.org"] }, {}], 4: [function (e, t, n) { t.exports = [] }, {}], 5: [function (e, t, n) { var i, o = e("wildemitter"); "undefined" != typeof window && (i = window.AudioContext || window.webkitAudioContext); var r = null; t.exports = function (e, t) { var n = new o; if (!i) return n; var s, a, c, d = (t = t || {}).smoothing || .1, u = t.interval || 50, l = t.threshold, p = t.play, f = t.history || 10, h = !0; r = t.audioContext || r || new i, (c = r.createAnalyser()).fftSize = 512, c.smoothingTimeConstant = d, a = new Float32Array(c.frequencyBinCount), e.jquery && (e = e[0]), e instanceof HTMLAudioElement || e instanceof HTMLVideoElement ? (s = r.createMediaElementSource(e), void 0 === p && (p = !0), l = l || -50) : (s = r.createMediaStreamSource(e), l = l || -50), s.connect(c), p && c.connect(r.destination), n.speaking = !1, n.suspend = function () { return r.suspend() }, n.resume = function () { return r.resume() }, Object.defineProperty(n, "state", { get: function () { return r.state } }), r.onstatechange = function () { n.emit("state_change", r.state) }, n.setThreshold = function (e) { l = e }, n.setInterval = function (e) { u = e }, n.stop = function () { h = !1, n.emit("volume_change", -100, l), n.speaking && (n.speaking = !1, n.emit("stopped_speaking")), c.disconnect(), s.disconnect() }, n.speakingHistory = []; for (var m = 0; m < f; m++)n.speakingHistory.push(0); var v = function () { setTimeout(function () { if (h) { var e = function (e, t) { var n = -1 / 0; e.getFloatFrequencyData(t); for (var i = 4, o = t.length; i < o; i++)t[i] > n && t[i] < 0 && (n = t[i]); return n }(c, a); n.emit("volume_change", e, l); var t = 0; if (e > l && !n.speaking) { for (var i = n.speakingHistory.length - 3; i < n.speakingHistory.length; i++)t += n.speakingHistory[i]; t >= 2 && (n.speaking = !0, n.emit("speaking")) } else if (e < l && n.speaking) { for (i = 0; i < n.speakingHistory.length; i++)t += n.speakingHistory[i]; 0 == t && (n.speaking = !1, n.emit("stopped_speaking")) } n.speakingHistory.shift(), n.speakingHistory.push(0 + (e > l)), v() } }, u) }; return v(), n } }, { wildemitter: 19 }], 6: [function (e, t, n) { "function" == typeof Object.create ? t.exports = function (e, t) { t && (e.super_ = t, e.prototype = Object.create(t.prototype, { constructor: { value: e, enumerable: !1, writable: !0, configurable: !0 } })) } : t.exports = function (e, t) { if (t) { e.super_ = t; var n = function () { }; n.prototype = t.prototype, e.prototype = new n, e.prototype.constructor = e } } }, {}], 7: [function (e, t, n) { var i = ["stun:", "turn:"]; t.exports = function (e) { var t, n, o = (e || {}).url || e, r = {}; return "string" == typeof o || o instanceof String ? (o = o.trim(), (t = i[i.indexOf(o.slice(0, 5))]) ? (n = (o = o.slice(5)).split("@"), r.username = e.username, r.credential = e.credential, n.length > 1 && (o = n[1], n = n[0].split(":"), r.username = n[0], r.credential = (e || {}).credential || n[1] || ""), r.url = t + o, r.urls = [r.url], r) : e) : e } }, {}], 8: [function (e, t, n) { (function (e) { (function () { "use strict"; var i = { function: !0, object: !0 }, o = i[typeof window] && window || this, r = i[typeof n] && n, s = i[typeof t] && t && !t.nodeType && t, a = r && s && "object" == typeof e && e; !a || a.global !== a && a.window !== a && a.self !== a || (o = a); var c = Math.pow(2, 53) - 1, d = /\bOpera/, u = Object.prototype, l = u.hasOwnProperty, p = u.toString; function f(e) { return (e = String(e)).charAt(0).toUpperCase() + e.slice(1) } function h(e) { return e = g(e), /^(?:webOS|i(?:OS|P))/.test(e) ? e : f(e) } function m(e, t) { for (var n in e) l.call(e, n) && t(e[n], n, e) } function v(e) { return null == e ? f(e) : p.call(e).slice(8, -1) } function b(e) { return String(e).replace(/([ -])(?!$)/g, "$1?") } function E(e, t) { var n = null; return function (e, t) { var n = -1, i = e ? e.length : 0; if ("number" == typeof i && i > -1 && i <= c) for (; ++n < i;)t(e[n], n, e); else m(e, t) }(e, function (i, o) { n = t(n, i, o, e) }), n } function g(e) { return String(e).replace(/^ +| +$/g, "") } var S = function e(t) { var n = o, i = t && "object" == typeof t && "String" != v(t); i && (n = t, t = null); var r = n.navigator || {}, s = r.userAgent || ""; t || (t = s); var a, c, u, l, f, S = i ? !!r.likeChrome : /\bChrome\b/.test(t) && !/internal|\n/i.test(p.toString()), y = i ? "Object" : "ScriptBridgingProxyObject", w = i ? "Object" : "Environment", O = i && n.java ? "JavaPackage" : v(n.java), R = i ? "Object" : "RuntimeObject", I = /\bJava/.test(O) && n.java, C = I && v(n.environment) == w, P = I ? "a" : "α", k = I ? "b" : "β", _ = n.document || {}, T = n.operamini || n.opera, V = d.test(V = i && T ? T["[[Class]]"] : v(T)) ? V : T = null, M = t, D = [], N = null, A = t == s, x = A && T && "function" == typeof T.version && T.version(), L = E([{ label: "EdgeHTML", pattern: "Edge" }, "Trident", { label: "WebKit", pattern: "AppleWebKit" }, "iCab", "Presto", "NetFront", "Tasman", "KHTML", "Gecko"], function (e, n) { return e || RegExp("\\b" + (n.pattern || b(n)) + "\\b", "i").exec(t) && (n.label || n) }), j = function (e) { return E(e, function (e, n) { return e || RegExp("\\b" + (n.pattern || b(n)) + "\\b", "i").exec(t) && (n.label || n) }) }(["Adobe AIR", "Arora", "Avant Browser", "Breach", "Camino", "Electron", "Epiphany", "Fennec", "Flock", "Galeon", "GreenBrowser", "iCab", "Iceweasel", "K-Meleon", "Konqueror", "Lunascape", "Maxthon", { label: "Microsoft Edge", pattern: "Edge" }, "Midori", "Nook Browser", "PaleMoon", "PhantomJS", "Raven", "Rekonq", "RockMelt", { label: "Samsung Internet", pattern: "SamsungBrowser" }, "SeaMonkey", { label: "Silk", pattern: "(?:Cloud9|Silk-Accelerated)" }, "Sleipnir", "SlimBrowser", { label: "SRWare Iron", pattern: "Iron" }, "Sunrise", "Swiftfox", "Waterfox", "WebPositive", "Opera Mini", { label: "Opera Mini", pattern: "OPiOS" }, "Opera", { label: "Opera", pattern: "OPR" }, "Chrome", { label: "Chrome Mobile", pattern: "(?:CriOS|CrMo)" }, { label: "Firefox", pattern: "(?:Firefox|Minefield)" }, { label: "Firefox for iOS", pattern: "FxiOS" }, { label: "IE", pattern: "IEMobile" }, { label: "IE", pattern: "MSIE" }, "Safari"]), W = B([{ label: "BlackBerry", pattern: "BB10" }, "BlackBerry", { label: "Galaxy S", pattern: "GT-I9000" }, { label: "Galaxy S2", pattern: "GT-I9100" }, { label: "Galaxy S3", pattern: "GT-I9300" }, { label: "Galaxy S4", pattern: "GT-I9500" }, { label: "Galaxy S5", pattern: "SM-G900" }, { label: "Galaxy S6", pattern: "SM-G920" }, { label: "Galaxy S6 Edge", pattern: "SM-G925" }, { label: "Galaxy S7", pattern: "SM-G930" }, { label: "Galaxy S7 Edge", pattern: "SM-G935" }, "Google TV", "Lumia", "iPad", "iPod", "iPhone", "Kindle", { label: "Kindle Fire", pattern: "(?:Cloud9|Silk-Accelerated)" }, "Nexus", "Nook", "PlayBook", "PlayStation Vita", "PlayStation", "TouchPad", "Transformer", { label: "Wii U", pattern: "WiiU" }, "Wii", "Xbox One", { label: "Xbox 360", pattern: "Xbox" }, "Xoom"]), F = function (e) { return E(e, function (e, n, i) { return e || (n[W] || n[/^[a-z]+(?: +[a-z]+\b)*/i.exec(W)] || RegExp("\\b" + b(i) + "(?:\\b|\\w*\\d)", "i").exec(t)) && i }) }({ Apple: { iPad: 1, iPhone: 1, iPod: 1 }, Archos: {}, Amazon: { Kindle: 1, "Kindle Fire": 1 }, Asus: { Transformer: 1 }, "Barnes & Noble": { Nook: 1 }, BlackBerry: { PlayBook: 1 }, Google: { "Google TV": 1, Nexus: 1 }, HP: { TouchPad: 1 }, HTC: {}, LG: {}, Microsoft: { Xbox: 1, "Xbox One": 1 }, Motorola: { Xoom: 1 }, Nintendo: { "Wii U": 1, Wii: 1 }, Nokia: { Lumia: 1 }, Samsung: { "Galaxy S": 1, "Galaxy S2": 1, "Galaxy S3": 1, "Galaxy S4": 1 }, Sony: { PlayStation: 1, "PlayStation Vita": 1 } }), U = function (e) { return E(e, function (e, n) { var i = n.pattern || b(n); return !e && (e = RegExp("\\b" + i + "(?:/[\\d.]+|[ \\w.]*)", "i").exec(t)) && (e = function (e, t, n) { var i = { "10.0": "10", 6.4: "10 Technical Preview", 6.3: "8.1", 6.2: "8", 6.1: "Server 2008 R2 / 7", "6.0": "Server 2008 / Vista", 5.2: "Server 2003 / XP 64-bit", 5.1: "XP", 5.01: "2000 SP1", "5.0": "2000", "4.0": "NT", "4.90": "ME" }; return t && n && /^Win/i.test(e) && !/^Windows Phone /i.test(e) && (i = i[/[\d.]+$/.exec(e)]) && (e = "Windows " + i), e = String(e), t && n && (e = e.replace(RegExp(t, "i"), n)), e = h(e.replace(/ ce$/i, " CE").replace(/\bhpw/i, "web").replace(/\bMacintosh\b/, "Mac OS").replace(/_PowerPC\b/i, " OS").replace(/\b(OS X) [^ \d]+/i, "$1").replace(/\bMac (OS X)\b/, "$1").replace(/\/(\d)/, " $1").replace(/_/g, ".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i, "").replace(/\bx86\.64\b/gi, "x86_64").replace(/\b(Windows Phone) OS\b/, "$1").replace(/\b(Chrome OS \w+) [\d.]+\b/, "$1").split(" on ")[0]) }(e, i, n.label || n)), e }) }(["Windows Phone", "Android", "CentOS", { label: "Chrome OS", pattern: "CrOS" }, "Debian", "Fedora", "FreeBSD", "Gentoo", "Haiku", "Kubuntu", "Linux Mint", "OpenBSD", "Red Hat", "SuSE", "Ubuntu", "Xubuntu", "Cygwin", "Symbian OS", "hpwOS", "webOS ", "webOS", "Tablet OS", "Tizen", "Linux", "Mac OS X", "Macintosh", "Mac", "Windows 98;", "Windows "]); function B(e) { return E(e, function (e, n) { var i = n.pattern || b(n); return !e && (e = RegExp("\\b" + i + " *\\d+[.\\w_]*", "i").exec(t) || RegExp("\\b" + i + " *\\w+-[\\w]*", "i").exec(t) || RegExp("\\b" + i + "(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)", "i").exec(t)) && ((e = String(n.label && !RegExp(i, "i").test(n.label) ? n.label : e).split("/"))[1] && !/[\d.]+/.test(e[0]) && (e[0] += " " + e[1]), n = n.label || n, e = h(e[0].replace(RegExp(i, "i"), n).replace(RegExp("; *(?:" + n + "[_-])?", "i"), " ").replace(RegExp("(" + n + ")[-_.]?(\\w)", "i"), "$1 $2"))), e }) } if (L && (L = [L]), F && !W && (W = B([F])), (a = /\bGoogle TV\b/.exec(W)) && (W = a[0]), /\bSimulator\b/i.test(t) && (W = (W ? W + " " : "") + "Simulator"), "Opera Mini" == j && /\bOPiOS\b/.test(t) && D.push("running in Turbo/Uncompressed mode"), "IE" == j && /\blike iPhone OS\b/.test(t) ? (F = (a = e(t.replace(/like iPhone OS/, ""))).manufacturer, W = a.product) : /^iP/.test(W) ? (j || (j = "Safari"), U = "iOS" + ((a = / OS ([\d_]+)/i.exec(t)) ? " " + a[1].replace(/_/g, ".") : "")) : "Konqueror" != j || /buntu/i.test(U) ? F && "Google" != F && (/Chrome/.test(j) && !/\bMobile Safari\b/i.test(t) || /\bVita\b/.test(W)) || /\bAndroid\b/.test(U) && /^Chrome/.test(j) && /\bVersion\//i.test(t) ? (j = "Android Browser", U = /\bAndroid\b/.test(U) ? U : "Android") : "Silk" == j ? (/\bMobi/i.test(t) || (U = "Android", D.unshift("desktop mode")), /Accelerated *= *true/i.test(t) && D.unshift("accelerated")) : "PaleMoon" == j && (a = /\bFirefox\/([\d.]+)\b/.exec(t)) ? D.push("identifying as Firefox " + a[1]) : "Firefox" == j && (a = /\b(Mobile|Tablet|TV)\b/i.exec(t)) ? (U || (U = "Firefox OS"), W || (W = a[1])) : !j || (a = !/\bMinefield\b/i.test(t) && /\b(?:Firefox|Safari)\b/.exec(j)) ? (j && !W && /[\/,]|^[^(]+?\)/.test(t.slice(t.indexOf(a + "/") + 8)) && (j = null), (a = W || F || U) && (W || F || /\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(U)) && (j = /[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(U) ? U : a) + " Browser")) : "Electron" == j && (a = (/\bChrome\/([\d.]+)\b/.exec(t) || 0)[1]) && D.push("Chromium " + a) : U = "Kubuntu", x || (x = E(["(?:Cloud9|CriOS|CrMo|Edge|FxiOS|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$))", "Version", b(j), "(?:Firefox|Minefield|NetFront)"], function (e, n) { return e || (RegExp(n + "(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)", "i").exec(t) || 0)[1] || null })), (a = ("iCab" == L && parseFloat(x) > 3 ? "WebKit" : /\bOpera\b/.test(j) && (/\bOPR\b/.test(t) ? "Blink" : "Presto")) || /\b(?:Midori|Nook|Safari)\b/i.test(t) && !/^(?:Trident|EdgeHTML)$/.test(L) && "WebKit" || !L && /\bMSIE\b/i.test(t) && ("Mac OS" == U ? "Tasman" : "Trident") || "WebKit" == L && /\bPlayStation\b(?! Vita\b)/i.test(j) && "NetFront") && (L = [a]), "IE" == j && (a = (/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(t) || 0)[1]) ? (j += " Mobile", U = "Windows Phone " + (/\+$/.test(a) ? a : a + ".x"), D.unshift("desktop mode")) : /\bWPDesktop\b/i.test(t) ? (j = "IE Mobile", U = "Windows Phone 8.x", D.unshift("desktop mode"), x || (x = (/\brv:([\d.]+)/.exec(t) || 0)[1])) : "IE" != j && "Trident" == L && (a = /\brv:([\d.]+)/.exec(t)) && (j && D.push("identifying as " + j + (x ? " " + x : "")), j = "IE", x = a[1]), A) { if (l = "global", f = null != (u = n) ? typeof u[l] : "number", /^(?:boolean|number|string|undefined)$/.test(f) || "object" == f && !u[l]) v(a = n.runtime) == y ? (j = "Adobe AIR", U = a.flash.system.Capabilities.os) : v(a = n.phantom) == R ? (j = "PhantomJS", x = (a = a.version || null) && a.major + "." + a.minor + "." + a.patch) : "number" == typeof _.documentMode && (a = /\bTrident\/(\d+)/i.exec(t)) ? (x = [x, _.documentMode], (a = +a[1] + 4) != x[1] && (D.push("IE " + x[1] + " mode"), L && (L[1] = ""), x[1] = a), x = "IE" == j ? String(x[1].toFixed(1)) : x[0]) : "number" == typeof _.documentMode && /^(?:Chrome|Firefox)\b/.test(j) && (D.push("masking as " + j + " " + x), j = "IE", x = "11.0", L = ["Trident"], U = "Windows"); else if (I && (M = (a = I.lang.System).getProperty("os.arch"), U = U || a.getProperty("os.name") + " " + a.getProperty("os.version")), C) { try { x = n.require("ringo/engine").version.join("."), j = "RingoJS" } catch (e) { (a = n.system) && a.global.system == n.system && (j = "Narwhal", U || (U = a[0].os || null)) } j || (j = "Rhino") } else "object" == typeof n.process && !n.process.browser && (a = n.process) && ("object" == typeof a.versions && ("string" == typeof a.versions.electron ? (D.push("Node " + a.versions.node), j = "Electron", x = a.versions.electron) : "string" == typeof a.versions.nw && (D.push("Chromium " + x, "Node " + a.versions.node), j = "NW.js", x = a.versions.nw)), j || (j = "Node.js", M = a.arch, U = a.platform, x = (x = /[\d.]+/.exec(a.version)) ? x[0] : null)); U = U && h(U) } if (x && (a = /(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(x) || /(?:alpha|beta)(?: ?\d)?/i.exec(t + ";" + (A && r.appMinorVersion)) || /\bMinefield\b/i.test(t) && "a") && (N = /b/i.test(a) ? "beta" : "alpha", x = x.replace(RegExp(a + "\\+?$"), "") + ("beta" == N ? k : P) + (/\d+\+?/.exec(a) || "")), "Fennec" == j || "Firefox" == j && /\b(?:Android|Firefox OS)\b/.test(U)) j = "Firefox Mobile"; else if ("Maxthon" == j && x) x = x.replace(/\.[\d.]+/, ".x"); else if (/\bXbox\b/i.test(W)) "Xbox 360" == W && (U = null), "Xbox 360" == W && /\bIEMobile\b/.test(t) && D.unshift("mobile mode"); else if (!/^(?:Chrome|IE|Opera)$/.test(j) && (!j || W || /Browser|Mobi/.test(j)) || "Windows CE" != U && !/Mobi/i.test(t)) if ("IE" == j && A) try { null === n.external && D.unshift("platform preview") } catch (e) { D.unshift("embedded") } else (/\bBlackBerry\b/.test(W) || /\bBB10\b/.test(t)) && (a = (RegExp(W.replace(/ +/g, " *") + "/([.\\d]+)", "i").exec(t) || 0)[1] || x) ? (U = ((a = [a, /BB10/.test(t)])[1] ? (W = null, F = "BlackBerry") : "Device Software") + " " + a[0], x = null) : this != m && "Wii" != W && (A && T || /Opera/.test(j) && /\b(?:MSIE|Firefox)\b/i.test(t) || "Firefox" == j && /\bOS X (?:\d+\.){2,}/.test(U) || "IE" == j && (U && !/^Win/.test(U) && x > 5.5 || /\bWindows XP\b/.test(U) && x > 8 || 8 == x && !/\bTrident\b/.test(t))) && !d.test(a = e.call(m, t.replace(d, "") + ";")) && a.name && (a = "ing as " + a.name + ((a = a.version) ? " " + a : ""), d.test(j) ? (/\bIE\b/.test(a) && "Mac OS" == U && (U = null), a = "identify" + a) : (a = "mask" + a, j = V ? h(V.replace(/([a-z])([A-Z])/g, "$1 $2")) : "Opera", /\bIE\b/.test(a) && (U = null), A || (x = null)), L = ["Presto"], D.push(a)); else j += " Mobile"; (a = (/\bAppleWebKit\/([\d.]+\+?)/i.exec(t) || 0)[1]) && (a = [parseFloat(a.replace(/\.(\d)$/, ".0$1")), a], "Safari" == j && "+" == a[1].slice(-1) ? (j = "WebKit Nightly", N = "alpha", x = a[1].slice(0, -1)) : x != a[1] && x != (a[2] = (/\bSafari\/([\d.]+\+?)/i.exec(t) || 0)[1]) || (x = null), a[1] = (/\bChrome\/([\d.]+)/i.exec(t) || 0)[1], 537.36 == a[0] && 537.36 == a[2] && parseFloat(a[1]) >= 28 && "WebKit" == L && (L = ["Blink"]), A && (S || a[1]) ? (L && (L[1] = "like Chrome"), a = a[1] || ((a = a[0]) < 530 ? 1 : a < 532 ? 2 : a < 532.05 ? 3 : a < 533 ? 4 : a < 534.03 ? 5 : a < 534.07 ? 6 : a < 534.1 ? 7 : a < 534.13 ? 8 : a < 534.16 ? 9 : a < 534.24 ? 10 : a < 534.3 ? 11 : a < 535.01 ? 12 : a < 535.02 ? "13+" : a < 535.07 ? 15 : a < 535.11 ? 16 : a < 535.19 ? 17 : a < 536.05 ? 18 : a < 536.1 ? 19 : a < 537.01 ? 20 : a < 537.11 ? "21+" : a < 537.13 ? 23 : a < 537.18 ? 24 : a < 537.24 ? 25 : a < 537.36 ? 26 : "Blink" != L ? "27" : "28")) : (L && (L[1] = "like Safari"), a = (a = a[0]) < 400 ? 1 : a < 500 ? 2 : a < 526 ? 3 : a < 533 ? 4 : a < 534 ? "4+" : a < 535 ? 5 : a < 537 ? 6 : a < 538 ? 7 : a < 601 ? 8 : "8"), L && (L[1] += " " + (a += "number" == typeof a ? ".x" : /[.+]/.test(a) ? "" : "+")), "Safari" == j && (!x || parseInt(x) > 45) && (x = a)), "Opera" == j && (a = /\bzbov|zvav$/.exec(U)) ? (j += " ", D.unshift("desktop mode"), "zvav" == a ? (j += "Mini", x = null) : j += "Mobile", U = U.replace(RegExp(" *" + a + "$"), "")) : "Safari" == j && /\bChrome\b/.exec(L && L[1]) && (D.unshift("desktop mode"), j = "Chrome Mobile", x = null, /\bOS X\b/.test(U) ? (F = "Apple", U = "iOS 4.3+") : U = null), x && 0 == x.indexOf(a = /[\d.]+$/.exec(U)) && t.indexOf("/" + a + "-") > -1 && (U = g(U.replace(a, ""))), L && !/\b(?:Avant|Nook)\b/.test(j) && (/Browser|Lunascape|Maxthon/.test(j) || "Safari" != j && /^iOS/.test(U) && /\bSafari\b/.test(L[1]) || /^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|Web)/.test(j) && L[1]) && (a = L[L.length - 1]) && D.push(a), D.length && (D = ["(" + D.join("; ") + ")"]), F && W && W.indexOf(F) < 0 && D.push("on " + F), W && D.push((/^on /.test(D[D.length - 1]) ? "" : "on ") + W), U && (a = / ([\d.+]+)$/.exec(U), c = a && "/" == U.charAt(U.length - a[0].length - 1), U = { architecture: 32, family: a && !c ? U.replace(a[0], "") : U, version: a ? a[1] : null, toString: function () { var e = this.version; return this.family + (e && !c ? " " + e : "") + (64 == this.architecture ? " 64-bit" : "") } }), (a = /\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(M)) && !/\bi686\b/i.test(M) ? (U && (U.architecture = 64, U.family = U.family.replace(RegExp(" *" + a), "")), j && (/\bWOW64\b/i.test(t) || A && /\w(?:86|32)$/.test(r.cpuClass || r.platform) && !/\bWin64; x64\b/i.test(t)) && D.unshift("32-bit")) : U && /^OS X/.test(U.family) && "Chrome" == j && parseFloat(x) >= 39 && (U.architecture = 64), t || (t = null); var q = {}; return q.description = t, q.layout = L && L[0], q.manufacturer = F, q.name = j, q.prerelease = N, q.product = W, q.ua = t, q.version = j && x, q.os = U || { architecture: null, family: null, version: null, toString: function () { return "null" } }, q.parse = e, q.toString = function () { return this.description || "" }, q.version && D.unshift(x), q.name && D.unshift(j), U && j && (U != String(U).split(" ")[0] || U != j.split(" ")[0] && !W) && D.push(W ? "(" + U + ")" : "on " + U), D.length && (q.description = D.join(" ")), q }(); "function" == typeof define && "object" == typeof define.amd && define.amd ? (o.platform = S, define(function () { return S })) : r && s ? m(S, function (e, t) { r[t] = e }) : o.platform = S }).call(this) }).call(this, "undefined" != typeof global ? global : "undefined" != typeof self ? self : "undefined" != typeof window ? window : {}) }, {}], 9: [function (e, t, n) { "use strict"; Object.defineProperty(n, "__esModule", { value: !0 }), n.default = void 0; for (var i = [], o = 0; o < 256; ++o)i[o] = (o + 256).toString(16).substr(1); var r = function (e, t) { var n = t || 0, o = i; return [o[e[n++]], o[e[n++]], o[e[n++]], o[e[n++]], "-", o[e[n++]], o[e[n++]], "-", o[e[n++]], o[e[n++]], "-", o[e[n++]], o[e[n++]], "-", o[e[n++]], o[e[n++]], o[e[n++]], o[e[n++]], o[e[n++]], o[e[n++]]].join("") }; n.default = r, t.exports = n.default }, {}], 10: [function (e, t, n) { "use strict"; Object.defineProperty(n, "__esModule", { value: !0 }), Object.defineProperty(n, "v1", { enumerable: !0, get: function () { return i.default } }), Object.defineProperty(n, "v3", { enumerable: !0, get: function () { return o.default } }), Object.defineProperty(n, "v4", { enumerable: !0, get: function () { return r.default } }), Object.defineProperty(n, "v5", { enumerable: !0, get: function () { return s.default } }); var i = a(e("./v1.js")), o = a(e("./v3.js")), r = a(e("./v4.js")), s = a(e("./v5.js")); function a(e) { return e && e.__esModule ? e : { default: e } } }, { "./v1.js": 14, "./v3.js": 15, "./v4.js": 17, "./v5.js": 18 }], 11: [function (e, t, n) { "use strict"; function i(e, t) { var n = (65535 & e) + (65535 & t); return (e >> 16) + (t >> 16) + (n >> 16) << 16 | 65535 & n } function o(e, t, n, o, r, s) { return i((a = i(i(t, e), i(o, s))) << (c = r) | a >>> 32 - c, n); var a, c } function r(e, t, n, i, r, s, a) { return o(t & n | ~t & i, e, t, r, s, a) } function s(e, t, n, i, r, s, a) { return o(t & i | n & ~i, e, t, r, s, a) } function a(e, t, n, i, r, s, a) { return o(t ^ n ^ i, e, t, r, s, a) } function c(e, t, n, i, r, s, a) { return o(n ^ (t | ~i), e, t, r, s, a) } Object.defineProperty(n, "__esModule", { value: !0 }), n.default = void 0; var d = function (e) { if ("string" == typeof e) { var t = unescape(encodeURIComponent(e)); e = new Array(t.length); for (var n = 0; n < t.length; n++)e[n] = t.charCodeAt(n) } return function (e) { var t, n, i, o = [], r = 32 * e.length; for (t = 0; t < r; t += 8)n = e[t >> 5] >>> t % 32 & 255, i = parseInt("0123456789abcdef".charAt(n >>> 4 & 15) + "0123456789abcdef".charAt(15 & n), 16), o.push(i); return o }(function (e, t) { var n, o, d, u, l; e[t >> 5] |= 128 << t % 32, e[14 + (t + 64 >>> 9 << 4)] = t; var p = 1732584193, f = -271733879, h = -1732584194, m = 271733878; for (n = 0; n < e.length; n += 16)o = p, d = f, u = h, l = m, p = r(p, f, h, m, e[n], 7, -680876936), m = r(m, p, f, h, e[n + 1], 12, -389564586), h = r(h, m, p, f, e[n + 2], 17, 606105819), f = r(f, h, m, p, e[n + 3], 22, -1044525330), p = r(p, f, h, m, e[n + 4], 7, -176418897), m = r(m, p, f, h, e[n + 5], 12, 1200080426), h = r(h, m, p, f, e[n + 6], 17, -1473231341), f = r(f, h, m, p, e[n + 7], 22, -45705983), p = r(p, f, h, m, e[n + 8], 7, 1770035416), m = r(m, p, f, h, e[n + 9], 12, -1958414417), h = r(h, m, p, f, e[n + 10], 17, -42063), f = r(f, h, m, p, e[n + 11], 22, -1990404162), p = r(p, f, h, m, e[n + 12], 7, 1804603682), m = r(m, p, f, h, e[n + 13], 12, -40341101), h = r(h, m, p, f, e[n + 14], 17, -1502002290), f = r(f, h, m, p, e[n + 15], 22, 1236535329), p = s(p, f, h, m, e[n + 1], 5, -165796510), m = s(m, p, f, h, e[n + 6], 9, -1069501632), h = s(h, m, p, f, e[n + 11], 14, 643717713), f = s(f, h, m, p, e[n], 20, -373897302), p = s(p, f, h, m, e[n + 5], 5, -701558691), m = s(m, p, f, h, e[n + 10], 9, 38016083), h = s(h, m, p, f, e[n + 15], 14, -660478335), f = s(f, h, m, p, e[n + 4], 20, -405537848), p = s(p, f, h, m, e[n + 9], 5, 568446438), m = s(m, p, f, h, e[n + 14], 9, -1019803690), h = s(h, m, p, f, e[n + 3], 14, -187363961), f = s(f, h, m, p, e[n + 8], 20, 1163531501), p = s(p, f, h, m, e[n + 13], 5, -1444681467), m = s(m, p, f, h, e[n + 2], 9, -51403784), h = s(h, m, p, f, e[n + 7], 14, 1735328473), f = s(f, h, m, p, e[n + 12], 20, -1926607734), p = a(p, f, h, m, e[n + 5], 4, -378558), m = a(m, p, f, h, e[n + 8], 11, -2022574463), h = a(h, m, p, f, e[n + 11], 16, 1839030562), f = a(f, h, m, p, e[n + 14], 23, -35309556), p = a(p, f, h, m, e[n + 1], 4, -1530992060), m = a(m, p, f, h, e[n + 4], 11, 1272893353), h = a(h, m, p, f, e[n + 7], 16, -155497632), f = a(f, h, m, p, e[n + 10], 23, -1094730640), p = a(p, f, h, m, e[n + 13], 4, 681279174), m = a(m, p, f, h, e[n], 11, -358537222), h = a(h, m, p, f, e[n + 3], 16, -722521979), f = a(f, h, m, p, e[n + 6], 23, 76029189), p = a(p, f, h, m, e[n + 9], 4, -640364487), m = a(m, p, f, h, e[n + 12], 11, -421815835), h = a(h, m, p, f, e[n + 15], 16, 530742520), f = a(f, h, m, p, e[n + 2], 23, -995338651), p = c(p, f, h, m, e[n], 6, -198630844), m = c(m, p, f, h, e[n + 7], 10, 1126891415), h = c(h, m, p, f, e[n + 14], 15, -1416354905), f = c(f, h, m, p, e[n + 5], 21, -57434055), p = c(p, f, h, m, e[n + 12], 6, 1700485571), m = c(m, p, f, h, e[n + 3], 10, -1894986606), h = c(h, m, p, f, e[n + 10], 15, -1051523), f = c(f, h, m, p, e[n + 1], 21, -2054922799), p = c(p, f, h, m, e[n + 8], 6, 1873313359), m = c(m, p, f, h, e[n + 15], 10, -30611744), h = c(h, m, p, f, e[n + 6], 15, -1560198380), f = c(f, h, m, p, e[n + 13], 21, 1309151649), p = c(p, f, h, m, e[n + 4], 6, -145523070), m = c(m, p, f, h, e[n + 11], 10, -1120210379), h = c(h, m, p, f, e[n + 2], 15, 718787259), f = c(f, h, m, p, e[n + 9], 21, -343485551), p = i(p, o), f = i(f, d), h = i(h, u), m = i(m, l); return [p, f, h, m] }(function (e) { var t, n = []; for (n[(e.length >> 2) - 1] = void 0, t = 0; t < n.length; t += 1)n[t] = 0; var i = 8 * e.length; for (t = 0; t < i; t += 8)n[t >> 5] |= (255 & e[t / 8]) << t % 32; return n }(e), 8 * e.length)) }; n.default = d, t.exports = n.default }, {}], 12: [function (e, t, n) { "use strict"; Object.defineProperty(n, "__esModule", { value: !0 }), n.default = function () { if (!i) throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported"); return i(o) }; var i = "undefined" != typeof crypto && crypto.getRandomValues && crypto.getRandomValues.bind(crypto) || "undefined" != typeof msCrypto && "function" == typeof msCrypto.getRandomValues && msCrypto.getRandomValues.bind(msCrypto), o = new Uint8Array(16); t.exports = n.default }, {}], 13: [function (e, t, n) { "use strict"; function i(e, t, n, i) { switch (e) { case 0: return t & n ^ ~t & i; case 1: return t ^ n ^ i; case 2: return t & n ^ t & i ^ n & i; case 3: return t ^ n ^ i } } function o(e, t) { return e << t | e >>> 32 - t } Object.defineProperty(n, "__esModule", { value: !0 }), n.default = void 0; var r = function (e) { var t = [1518500249, 1859775393, 2400959708, 3395469782], n = [1732584193, 4023233417, 2562383102, 271733878, 3285377520]; if ("string" == typeof e) { var r = unescape(encodeURIComponent(e)); e = new Array(r.length); for (var s = 0; s < r.length; s++)e[s] = r.charCodeAt(s) } e.push(128); var a = e.length / 4 + 2, c = Math.ceil(a / 16), d = new Array(c); for (s = 0; s < c; s++) { d[s] = new Array(16); for (var u = 0; u < 16; u++)d[s][u] = e[64 * s + 4 * u] << 24 | e[64 * s + 4 * u + 1] << 16 | e[64 * s + 4 * u + 2] << 8 | e[64 * s + 4 * u + 3] } for (d[c - 1][14] = 8 * (e.length - 1) / Math.pow(2, 32), d[c - 1][14] = Math.floor(d[c - 1][14]), d[c - 1][15] = 8 * (e.length - 1) & 4294967295, s = 0; s < c; s++) { for (var l = new Array(80), p = 0; p < 16; p++)l[p] = d[s][p]; for (p = 16; p < 80; p++)l[p] = o(l[p - 3] ^ l[p - 8] ^ l[p - 14] ^ l[p - 16], 1); var f = n[0], h = n[1], m = n[2], v = n[3], b = n[4]; for (p = 0; p < 80; p++) { var E = Math.floor(p / 20), g = o(f, 5) + i(E, h, m, v) + b + t[E] + l[p] >>> 0; b = v, v = m, m = o(h, 30) >>> 0, h = f, f = g } n[0] = n[0] + f >>> 0, n[1] = n[1] + h >>> 0, n[2] = n[2] + m >>> 0, n[3] = n[3] + v >>> 0, n[4] = n[4] + b >>> 0 } return [n[0] >> 24 & 255, n[0] >> 16 & 255, n[0] >> 8 & 255, 255 & n[0], n[1] >> 24 & 255, n[1] >> 16 & 255, n[1] >> 8 & 255, 255 & n[1], n[2] >> 24 & 255, n[2] >> 16 & 255, n[2] >> 8 & 255, 255 & n[2], n[3] >> 24 & 255, n[3] >> 16 & 255, n[3] >> 8 & 255, 255 & n[3], n[4] >> 24 & 255, n[4] >> 16 & 255, n[4] >> 8 & 255, 255 & n[4]] }; n.default = r, t.exports = n.default }, {}], 14: [function (e, t, n) { "use strict"; Object.defineProperty(n, "__esModule", { value: !0 }), n.default = void 0; var i, o, r = a(e("./rng.js")), s = a(e("./bytesToUuid.js")); function a(e) { return e && e.__esModule ? e : { default: e } } var c = 0, d = 0; var u = function (e, t, n) { var a = t && n || 0, u = t || [], l = (e = e || {}).node || i, p = void 0 !== e.clockseq ? e.clockseq : o; if (null == l || null == p) { var f = e.random || (e.rng || r.default)(); null == l && (l = i = [1 | f[0], f[1], f[2], f[3], f[4], f[5]]), null == p && (p = o = 16383 & (f[6] << 8 | f[7])) } var h = void 0 !== e.msecs ? e.msecs : (new Date).getTime(), m = void 0 !== e.nsecs ? e.nsecs : d + 1, v = h - c + (m - d) / 1e4; if (v < 0 && void 0 === e.clockseq && (p = p + 1 & 16383), (v < 0 || h > c) && void 0 === e.nsecs && (m = 0), m >= 1e4) throw new Error("uuid.v1(): Can't create more than 10M uuids/sec"); c = h, d = m, o = p; var b = (1e4 * (268435455 & (h += 122192928e5)) + m) % 4294967296; u[a++] = b >>> 24 & 255, u[a++] = b >>> 16 & 255, u[a++] = b >>> 8 & 255, u[a++] = 255 & b; var E = h / 4294967296 * 1e4 & 268435455; u[a++] = E >>> 8 & 255, u[a++] = 255 & E, u[a++] = E >>> 24 & 15 | 16, u[a++] = E >>> 16 & 255, u[a++] = p >>> 8 | 128, u[a++] = 255 & p; for (var g = 0; g < 6; ++g)u[a + g] = l[g]; return t || (0, s.default)(u) }; n.default = u, t.exports = n.default }, { "./bytesToUuid.js": 9, "./rng.js": 12 }], 15: [function (e, t, n) { "use strict"; Object.defineProperty(n, "__esModule", { value: !0 }), n.default = void 0; var i = r(e("./v35.js")), o = r(e("./md5.js")); function r(e) { return e && e.__esModule ? e : { default: e } } var s = (0, i.default)("v3", 48, o.default); n.default = s, t.exports = n.default }, { "./md5.js": 11, "./v35.js": 16 }], 16: [function (e, t, n) { "use strict"; Object.defineProperty(n, "__esModule", { value: !0 }), n.default = function (e, t, n) { var i = function (e, i, r, s) { var a = r && s || 0; if ("string" == typeof e && (e = function (e) { e = unescape(encodeURIComponent(e)); for (var t = new Array(e.length), n = 0; n < e.length; n++)t[n] = e.charCodeAt(n); return t }(e)), "string" == typeof i && (i = function (e) { var t = []; return e.replace(/[a-fA-F0-9]{2}/g, function (e) { t.push(parseInt(e, 16)) }), t }(i)), !Array.isArray(e)) throw TypeError("value must be an array of bytes"); if (!Array.isArray(i) || 16 !== i.length) throw TypeError("namespace must be uuid string or an Array of 16 byte values"); var c = n(i.concat(e)); if (c[6] = 15 & c[6] | t, c[8] = 63 & c[8] | 128, r) for (var d = 0; d < 16; ++d)r[a + d] = c[d]; return r || (0, o.default)(c) }; try { i.name = e } catch (e) { } return i.DNS = r, i.URL = s, i }, n.URL = n.DNS = void 0; var i, o = (i = e("./bytesToUuid.js")) && i.__esModule ? i : { default: i }; const r = "6ba7b810-9dad-11d1-80b4-00c04fd430c8"; n.DNS = r; const s = "6ba7b811-9dad-11d1-80b4-00c04fd430c8"; n.URL = s }, { "./bytesToUuid.js": 9 }], 17: [function (e, t, n) { "use strict"; Object.defineProperty(n, "__esModule", { value: !0 }), n.default = void 0; var i = r(e("./rng.js")), o = r(e("./bytesToUuid.js")); function r(e) { return e && e.__esModule ? e : { default: e } } var s = function (e, t, n) { var r = t && n || 0; "string" == typeof e && (t = "binary" === e ? new Array(16) : null, e = null); var s = (e = e || {}).random || (e.rng || i.default)(); if (s[6] = 15 & s[6] | 64, s[8] = 63 & s[8] | 128, t) for (var a = 0; a < 16; ++a)t[r + a] = s[a]; return t || (0, o.default)(s) }; n.default = s, t.exports = n.default }, { "./bytesToUuid.js": 9, "./rng.js": 12 }], 18: [function (e, t, n) { "use strict"; Object.defineProperty(n, "__esModule", { value: !0 }), n.default = void 0; var i = r(e("./v35.js")), o = r(e("./sha1.js")); function r(e) { return e && e.__esModule ? e : { default: e } } var s = (0, i.default)("v5", 80, o.default); n.default = s, t.exports = n.default }, { "./sha1.js": 13, "./v35.js": 16 }], 19: [function (e, t, n) { function i() { } t.exports = i, i.mixin = function (e) { var t = e.prototype || e; t.isWildEmitter = !0, t.on = function (e, t, n) { this.callbacks = this.callbacks || {}; var i = 3 === arguments.length, o = i ? arguments[1] : void 0, r = i ? arguments[2] : arguments[1]; return r._groupName = o, (this.callbacks[e] = this.callbacks[e] || []).push(r), this }, t.once = function (e, t, n) { var i = this, o = 3 === arguments.length, r = o ? arguments[1] : void 0, s = o ? arguments[2] : arguments[1]; return this.on(e, r, function t() { i.off(e, t), s.apply(this, arguments) }), this }, t.releaseGroup = function (e) { var t, n, i, o; for (t in this.callbacks = this.callbacks || {}, this.callbacks) for (n = 0, i = (o = this.callbacks[t]).length; n < i; n++)o[n]._groupName === e && (o.splice(n, 1), n--, i--); return this }, t.off = function (e, t) { this.callbacks = this.callbacks || {}; var n, i = this.callbacks[e]; return i ? 1 === arguments.length ? (delete this.callbacks[e], this) : (-1 !== (n = i.indexOf(t)) && (i.splice(n, 1), 0 === i.length && delete this.callbacks[e]), this) : this }, t.emit = function (e) { this.callbacks = this.callbacks || {}; var t, n, i, o = [].slice.call(arguments, 1), r = this.callbacks[e], s = this.getWildcardCallbacks(e); if (r) for (t = 0, n = (i = r.slice()).length; t < n && i[t]; ++t)i[t].apply(this, o); if (s) for (n = s.length, t = 0, n = (i = s.slice()).length; t < n && i[t]; ++t)i[t].apply(this, [e].concat(o)); return this }, t.getWildcardCallbacks = function (e) { this.callbacks = this.callbacks || {}; var t, n, i = []; for (t in this.callbacks) n = t.split("*"), ("*" === t || 2 === n.length && e.slice(0, n[0].length) === n[0]) && (i = i.concat(this.callbacks[t])); return i } }, i.mixin(i) }, {}], 20: [function (e, t, n) { !function (e) { "use strict"; function n() { } var i = n.prototype, o = e.EventEmitter; function r(e, t) { for (var n = e.length; n--;)if (e[n].listener === t) return n; return -1 } function s(e) { return function () { return this[e].apply(this, arguments) } } i.getListeners = function (e) { var t, n, i = this._getEvents(); if (e instanceof RegExp) for (n in t = {}, i) i.hasOwnProperty(n) && e.test(n) && (t[n] = i[n]); else t = i[e] || (i[e] = []); return t }, i.flattenListeners = function (e) { var t, n = []; for (t = 0; t < e.length; t += 1)n.push(e[t].listener); return n }, i.getListenersAsObject = function (e) { var t, n = this.getListeners(e); return n instanceof Array && ((t = {})[e] = n), t || n }, i.addListener = function (e, t) { if (!function e(t) { return "function" == typeof t || t instanceof RegExp || !(!t || "object" != typeof t) && e(t.listener) }(t)) throw new TypeError("listener must be a function"); var n, i = this.getListenersAsObject(e), o = "object" == typeof t; for (n in i) i.hasOwnProperty(n) && -1 === r(i[n], t) && i[n].push(o ? t : { listener: t, once: !1 }); return this }, i.on = s("addListener"), i.addOnceListener = function (e, t) { return this.addListener(e, { listener: t, once: !0 }) }, i.once = s("addOnceListener"), i.defineEvent = function (e) { return this.getListeners(e), this }, i.defineEvents = function (e) { for (var t = 0; t < e.length; t += 1)this.defineEvent(e[t]); return this }, i.removeListener = function (e, t) { var n, i, o = this.getListenersAsObject(e); for (i in o) o.hasOwnProperty(i) && -1 !== (n = r(o[i], t)) && o[i].splice(n, 1); return this }, i.off = s("removeListener"), i.addListeners = function (e, t) { return this.manipulateListeners(!1, e, t) }, i.removeListeners = function (e, t) { return this.manipulateListeners(!0, e, t) }, i.manipulateListeners = function (e, t, n) { var i, o, r = e ? this.removeListener : this.addListener, s = e ? this.removeListeners : this.addListeners; if ("object" != typeof t || t instanceof RegExp) for (i = n.length; i--;)r.call(this, t, n[i]); else for (i in t) t.hasOwnProperty(i) && (o = t[i]) && ("function" == typeof o ? r.call(this, i, o) : s.call(this, i, o)); return this }, i.removeEvent = function (e) { var t, n = typeof e, i = this._getEvents(); if ("string" === n) delete i[e]; else if (e instanceof RegExp) for (t in i) i.hasOwnProperty(t) && e.test(t) && delete i[t]; else delete this._events; return this }, i.removeAllListeners = s("removeEvent"), i.emitEvent = function (e, t) { var n, i, o, r, s = this.getListenersAsObject(e); for (r in s) if (s.hasOwnProperty(r)) for (n = s[r].slice(0), o = 0; o < n.length; o++)!0 === (i = n[o]).once && this.removeListener(e, i.listener), i.listener.apply(this, t || []) === this._getOnceReturnValue() && this.removeListener(e, i.listener); return this }, i.trigger = s("emitEvent"), i.emit = function (e) { var t = Array.prototype.slice.call(arguments, 1); return this.emitEvent(e, t) }, i.setOnceReturnValue = function (e) { return this._onceReturnValue = e, this }, i._getOnceReturnValue = function () { return !this.hasOwnProperty("_onceReturnValue") || this._onceReturnValue }, i._getEvents = function () { return this._events || (this._events = {}) }, n.noConflict = function () { return e.EventEmitter = o, n }, "function" == typeof define && define.amd ? define(function () { return n }) : "object" == typeof t && t.exports ? t.exports = n : e.EventEmitter = n }("undefined" != typeof window ? window : this || {}) }, {}], 21: [function (e, t, n) { t.exports = { author: "OpenVidu", dependencies: { "@types/node": "13.13.2", "@types/platform": "1.3.2", freeice: "2.2.2", hark: "1.2.3", platform: "1.3.5", uuid: "7.0.3", "wolfy87-eventemitter": "5.2.9" }, description: "OpenVidu Browser", devDependencies: { browserify: "16.5.1", grunt: "1.1.0", "grunt-cli": "1.3.2", "grunt-contrib-copy": "1.0.0", "grunt-contrib-sass": "1.0.0", "grunt-contrib-uglify": "4.0.1", "grunt-contrib-watch": "1.1.0", "grunt-postcss": "0.9.0", "grunt-string-replace": "1.3.1", "grunt-ts": "6.0.0-beta.22", terser: "4.6.11", tsify: "4.0.1", tslint: "6.1.1", typedoc: "0.17.4", typescript: "3.8.3" }, license: "Apache-2.0", main: "lib/index.js", name: "openvidu-browser", repository: { type: "git", url: "git://github.com/OpenVidu/openvidu" }, scripts: { browserify: "VERSION=${VERSION:-dev}; cd src && ../node_modules/browserify/bin/cmd.js Main.ts -p [ tsify ] --exclude kurento-browser-extensions --debug -o ../static/js/openvidu-browser-$VERSION.js -v", "browserify-prod": "VERSION=${VERSION:-dev}; cd src && ../node_modules/browserify/bin/cmd.js --debug Main.ts -p [ tsify ] --exclude kurento-browser-extensions | ../node_modules/terser/bin/terser --source-map content=inline --output ../static/js/openvidu-browser-$VERSION.min.js", build: "cd src/OpenVidu && ./../../node_modules/typescript/bin/tsc && cd ../.. && ./node_modules/typescript/bin/tsc --declaration src/index.ts --outDir ./lib --sourceMap --lib dom,es5,es2015.promise,scripthost", docs: "./generate-docs.sh" }, types: "lib/index.d.ts", version: "2.13.0" } }, {}], 22: [function (e, t, n) { "use strict"; Object.defineProperty(n, "__esModule", { value: !0 }); var i = e("./OpenVidu/OpenVidu"); window && (window.OpenVidu = i.OpenVidu) }, { "./OpenVidu/OpenVidu": 26 }], 23: [function (e, t, n) { "use strict"; Object.defineProperty(n, "__esModule", { value: !0 }); var i = e("./Stream"), o = function () { function e(e, t) { this.session = e, this.disposed = !1; var n = "'Connection' created "; t ? (n += "(remote) with 'connectionId' [" + t.id + "]", this.options = t, this.connectionId = t.id, this.creationTime = t.createdAt, t.metadata && (this.data = t.metadata), t.streams && this.initRemoteStreams(t.streams)) : n += "(local)", console.info(n) } return e.prototype.sendIceCandidate = function (e) { console.debug((this.stream.outboundStreamOpts ? "Local" : "Remote") + "candidate for" + this.connectionId, e), this.session.openvidu.sendRequest("onIceCandidate", { endpointName: this.connectionId, candidate: e.candidate, sdpMid: e.sdpMid, sdpMLineIndex: e.sdpMLineIndex }, function (e, t) { e && console.error("Error sending ICE candidate: " + JSON.stringify(e)) }) }, e.prototype.initRemoteStreams = function (e) { var t = this; e.forEach(function (e) { var n = { id: e.id, createdAt: e.createdAt, connection: t, hasAudio: e.hasAudio, hasVideo: e.hasVideo, audioActive: e.audioActive, videoActive: e.videoActive, typeOfVideo: e.typeOfVideo, frameRate: e.frameRate, videoDimensions: e.videoDimensions ? JSON.parse(e.videoDimensions) : void 0, filter: e.filter ? e.filter : void 0 }, o = new i.Stream(t.session, n); t.addStream(o) }), console.info("Remote 'Connection' with 'connectionId' [" + this.connectionId + "] is now configured for receiving Streams with options: ", this.stream.inboundStreamOpts) }, e.prototype.addStream = function (e) { e.connection = this, this.stream = e }, e.prototype.removeStream = function (e) { delete this.stream }, e.prototype.dispose = function () { this.stream && delete this.stream, this.disposed = !0 }, e }(); n.Connection = o }, { "./Stream": 29 }], 24: [function (e, t, n) { "use strict"; Object.defineProperty(n, "__esModule", { value: !0 }); var i = e("../OpenViduInternal/Events/StreamPropertyChangedEvent"), o = e("../OpenViduInternal/Enums/OpenViduError"), r = function () { function e(e, t) { this.handlers = {}, this.type = e, this.options = t } return e.prototype.execMethod = function (e, t) { var n = this; return new Promise(function (r, s) { var a; if (console.info("Executing filter method to stream " + n.stream.streamId), "string" != typeof t) try { a = JSON.stringify(t) } catch (e) { var c = "'params' property must be a JSON formatted object"; console.error(c), s(c) } else a = t; n.stream.session.openvidu.sendRequest("execFilterMethod", { streamId: n.stream.streamId, method: e, params: a }, function (t, c) { if (t) console.error("Error executing filter method for Stream " + n.stream.streamId, t), 401 === t.code ? s(new o.OpenViduError(o.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED, "You don't have permissions to execute a filter method")) : s(t); else { console.info("Filter method successfully executed on Stream " + n.stream.streamId); var d = Object.assign({}, n.stream.filter); n.stream.filter.lastExecMethod = { method: e, params: JSON.parse(a) }, n.stream.session.emitEvent("streamPropertyChanged", [new i.StreamPropertyChangedEvent(n.stream.session, n.stream, "filter", n.stream.filter, d, "execFilterMethod")]), n.stream.streamManager.emitEvent("streamPropertyChanged", [new i.StreamPropertyChangedEvent(n.stream.streamManager, n.stream, "filter", n.stream.filter, d, "execFilterMethod")]), r() } }) }) }, e.prototype.addEventListener = function (e, t) { var n = this; return new Promise(function (i, r) { console.info("Adding filter event listener to event " + e + " to stream " + n.stream.streamId), n.stream.session.openvidu.sendRequest("addFilterEventListener", { streamId: n.stream.streamId, eventType: e }, function (s, a) { s ? (console.error("Error adding filter event listener to event " + e + "for Stream " + n.stream.streamId, s), 401 === s.code ? r(new o.OpenViduError(o.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED, "You don't have permissions to add a filter event listener")) : r(s)) : (n.handlers[e] = t, console.info("Filter event listener to event " + e + " successfully applied on Stream " + n.stream.streamId), i()) }) }) }, e.prototype.removeEventListener = function (e) { var t = this; return new Promise(function (n, i) { console.info("Removing filter event listener to event " + e + " to stream " + t.stream.streamId), t.stream.session.openvidu.sendRequest("removeFilterEventListener", { streamId: t.stream.streamId, eventType: e }, function (r, s) { r ? (console.error("Error removing filter event listener to event " + e + "for Stream " + t.stream.streamId, r), 401 === r.code ? i(new o.OpenViduError(o.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED, "You don't have permissions to add a filter event listener")) : i(r)) : (delete t.handlers[e], console.info("Filter event listener to event " + e + " successfully removed on Stream " + t.stream.streamId), n()) }) }) }, e }(); n.Filter = r }, { "../OpenViduInternal/Enums/OpenViduError": 33, "../OpenViduInternal/Events/StreamPropertyChangedEvent": 44 }], 25: [function (e, t, n) { "use strict"; Object.defineProperty(n, "__esModule", { value: !0 }); var i = e("../OpenViduInternal/Enums/LocalRecorderState"), o = e("platform"), r = function () { function e(e) { this.stream = e, this.chunks = [], this.connectionId = this.stream.connection ? this.stream.connection.connectionId : "default-connection", this.id = this.stream.streamId + "_" + this.connectionId + "_localrecord", this.state = i.LocalRecorderState.READY } return e.prototype.record = function (e) { var t = this; return new Promise(function (n, o) { try { if ("undefined" == typeof MediaRecorder) throw console.error("MediaRecorder not supported on your browser. See compatibility in https://caniuse.com/#search=MediaRecorder"), Error("MediaRecorder not supported on your browser. See compatibility in https://caniuse.com/#search=MediaRecorder"); if (t.state !== i.LocalRecorderState.READY) throw Error("'LocalRecord.record()' needs 'LocalRecord.state' to be 'READY' (current value: '" + t.state + "'). Call 'LocalRecorder.clean()' or init a new LocalRecorder before"); console.log("Starting local recording of stream '" + t.stream.streamId + "' of connection '" + t.connectionId + "'"); var r = {}; "function" == typeof MediaRecorder.isTypeSupported ? e ? (MediaRecorder.isTypeSupported(e) || o(new Error('mimeType "' + e + '" is not supported')), r = { mimeType: e }) : console.log("No mimeType parameter provided. Using default codecs") : console.warn("MediaRecorder#isTypeSupported is not supported. Using default codecs"), t.mediaRecorder = new MediaRecorder(t.stream.getMediaStream(), r), t.mediaRecorder.start(10) } catch (e) { o(e) } t.mediaRecorder.ondataavailable = function (e) { t.chunks.push(e.data) }, t.mediaRecorder.onerror = function (e) { console.error("MediaRecorder error: ", e) }, t.mediaRecorder.onstart = function () { console.log("MediaRecorder started (state=" + t.mediaRecorder.state + ")") }, t.mediaRecorder.onstop = function () { t.onStopDefault() }, t.mediaRecorder.onpause = function () { console.log("MediaRecorder paused (state=" + t.mediaRecorder.state + ")") }, t.mediaRecorder.onresume = function () { console.log("MediaRecorder resumed (state=" + t.mediaRecorder.state + ")") }, t.mediaRecorder.onwarning = function (e) { console.log("MediaRecorder warning: " + e) }, t.state = i.LocalRecorderState.RECORDING, n() }) }, e.prototype.stop = function () { var e = this; return new Promise(function (t, n) { try { if (e.state === i.LocalRecorderState.READY || e.state === i.LocalRecorderState.FINISHED) throw Error("'LocalRecord.stop()' needs 'LocalRecord.state' to be 'RECORDING' or 'PAUSED' (current value: '" + e.state + "'). Call 'LocalRecorder.start()' before"); e.mediaRecorder.onstop = function () { e.onStopDefault(), t() }, e.mediaRecorder.stop() } catch (e) { n(e) } }) }, e.prototype.pause = function () { var e = this; return new Promise(function (t, n) { try { e.state !== i.LocalRecorderState.RECORDING && n(Error("'LocalRecord.pause()' needs 'LocalRecord.state' to be 'RECORDING' (current value: '" + e.state + "'). Call 'LocalRecorder.start()' or 'LocalRecorder.resume()' before")), e.mediaRecorder.pause(), e.state = i.LocalRecorderState.PAUSED } catch (e) { n(e) } }) }, e.prototype.resume = function () { var e = this; return new Promise(function (t, n) { try { if (e.state !== i.LocalRecorderState.PAUSED) throw Error("'LocalRecord.resume()' needs 'LocalRecord.state' to be 'PAUSED' (current value: '" + e.state + "'). Call 'LocalRecorder.pause()' before"); e.mediaRecorder.resume(), e.state = i.LocalRecorderState.RECORDING } catch (e) { n(e) } }) }, e.prototype.preview = function (e) { if (this.state !== i.LocalRecorderState.FINISHED) throw Error("'LocalRecord.preview()' needs 'LocalRecord.state' to be 'FINISHED' (current value: '" + this.state + "'). Call 'LocalRecorder.stop()' before"); if (this.videoPreview = document.createElement("video"), this.videoPreview.id = this.id, this.videoPreview.autoplay = !0, "Safari" === o.name && this.videoPreview.setAttribute("playsinline", "true"), "string" == typeof e) { var t = document.getElementById(e); t && (this.videoPreview = t.appendChild(this.videoPreview)) } else this.videoPreview = e.appendChild(this.videoPreview); return this.videoPreview.src = this.videoPreviewSrc, this.videoPreview }, e.prototype.clean = function () { var e = this, t = function () { delete e.blob, e.chunks = [], delete e.mediaRecorder, e.state = i.LocalRecorderState.READY }; this.state === i.LocalRecorderState.RECORDING || this.state === i.LocalRecorderState.PAUSED ? this.stop().then(function () { return t() }).catch(function () { return t() }) : t() }, e.prototype.download = function () { if (this.state !== i.LocalRecorderState.FINISHED) throw Error("'LocalRecord.download()' needs 'LocalRecord.state' to be 'FINISHED' (current value: '" + this.state + "'). Call 'LocalRecorder.stop()' before"); var e = document.createElement("a"); e.style.display = "none", document.body.appendChild(e); var t = window.URL.createObjectURL(this.blob); e.href = t, e.download = this.id + ".webm", e.click(), window.URL.revokeObjectURL(t), document.body.removeChild(e) }, e.prototype.getBlob = function () { if (this.state !== i.LocalRecorderState.FINISHED) throw Error("Call 'LocalRecord.stop()' before getting Blob file"); return this.blob }, e.prototype.uploadAsBinary = function (e, t) { var n = this; return new Promise(function (o, r) { if (n.state !== i.LocalRecorderState.FINISHED) r(Error("'LocalRecord.uploadAsBinary()' needs 'LocalRecord.state' to be 'FINISHED' (current value: '" + n.state + "'). Call 'LocalRecorder.stop()' before")); else { var s = new XMLHttpRequest; if (s.open("POST", e, !0), "object" == typeof t) for (var a = 0, c = Object.keys(t); a < c.length; a++) { var d = c[a]; s.setRequestHeader(d, t[d]) } s.onreadystatechange = function () { 4 === s.readyState && ("2" === s.status.toString().charAt(0) ? o(s.responseText) : r(s.status)) }, s.send(n.blob) } }) }, e.prototype.uploadAsMultipartfile = function (e, t) { var n = this; return new Promise(function (o, r) { if (n.state !== i.LocalRecorderState.FINISHED) r(Error("'LocalRecord.uploadAsMultipartfile()' needs 'LocalRecord.state' to be 'FINISHED' (current value: '" + n.state + "'). Call 'LocalRecorder.stop()' before")); else { var s = new XMLHttpRequest; if (s.open("POST", e, !0), "object" == typeof t) for (var a = 0, c = Object.keys(t); a < c.length; a++) { var d = c[a]; s.setRequestHeader(d, t[d]) } var u = new FormData; u.append("file", n.blob, n.id + ".webm"), s.onreadystatechange = function () { 4 === s.readyState && ("2" === s.status.toString().charAt(0) ? o(s.responseText) : r(s.status)) }, s.send(u) } }) }, e.prototype.onStopDefault = function () { console.log("MediaRecorder stopped  (state=" + this.mediaRecorder.state + ")"), this.blob = new Blob(this.chunks, { type: "video/webm" }), this.chunks = [], this.videoPreviewSrc = window.URL.createObjectURL(this.blob), this.state = i.LocalRecorderState.FINISHED }, e }(); n.LocalRecorder = r }, { "../OpenViduInternal/Enums/LocalRecorderState": 32, platform: 8 }], 26: [function (e, t, n) { "use strict"; Object.defineProperty(n, "__esModule", { value: !0 }); var i = e("./LocalRecorder"), o = e("./Publisher"), r = e("./Session"), s = e("../OpenViduInternal/Events/StreamPropertyChangedEvent"), a = e("../OpenViduInternal/Enums/OpenViduError"), c = e("../OpenViduInternal/Enums/VideoInsertMode"), d = e("../OpenViduInternal/ScreenSharing/Screen-Capturing-Auto"), u = e("../OpenViduInternal/ScreenSharing/Screen-Capturing"), l = e("wolfy87-eventemitter"), p = e("../OpenViduInternal/KurentoUtils/kurento-jsonrpc"), f = e("platform"); f.isIonicIos = ("iPhone" === f.product || "iPad" === f.product) && -1 === f.ua.indexOf("Safari"), f.isIonicAndroid = "Android" === f.os.family && "Android Browser" == f.name; var h = e("../../package.json"), m = function () { function e() { var e = this; this.publishers = [], this.secret = "", this.recorder = !1, this.advancedConfiguration = {}, this.webrtcStatsInterval = 0, this.ee = new l, this.libraryVersion = h.version, console.info("'OpenVidu' initialized"), console.info("openvidu-browser version: " + this.libraryVersion), "iOS" !== f.os.family && "Android" !== f.os.family || window.addEventListener("orientationchange", function () { e.publishers.forEach(function (t) { if (t.stream.isLocalStreamPublished && t.stream && t.stream.hasVideo && t.stream.streamManager.videos[0]) var n = 0, i = t.stream.videoDimensions.width, o = t.stream.videoDimensions.height, r = setInterval(function () { new Promise(function (e, n) { if (f.isIonicIos) e({ newWidth: t.stream.streamManager.videos[0].video.videoWidth, newHeight: t.stream.streamManager.videos[0].video.videoHeight }); else { var i = t.stream.getMediaStream().getVideoTracks()[0].getSettings(); e({ newWidth: -1 !== f.name.toLowerCase().indexOf("firefox") ? i.width : t.videoReference.videoWidth, newHeight: -1 !== f.name.toLowerCase().indexOf("firefox") ? i.height : t.videoReference.videoHeight }) } }).then(function (e) { a(i, o, e.newWidth, e.newHeight) }) }, 75), a = function (i, o, a, c) { ++n > 10 && clearTimeout(r), a === i && c === o || (t.stream.videoDimensions = { width: a || 0, height: c || 0 }, e.sendRequest("streamPropertyChanged", { streamId: t.stream.streamId, property: "videoDimensions", newValue: JSON.stringify(t.stream.videoDimensions), reason: "deviceRotated" }, function (n, r) { n ? console.error("Error sending 'streamPropertyChanged' event", n) : (e.session.emitEvent("streamPropertyChanged", [new s.StreamPropertyChangedEvent(e.session, t.stream, "videoDimensions", t.stream.videoDimensions, { width: i, height: o }, "deviceRotated")]), t.emitEvent("streamPropertyChanged", [new s.StreamPropertyChangedEvent(t, t.stream, "videoDimensions", t.stream.videoDimensions, { width: i, height: o }, "deviceRotated")])) }), clearTimeout(r)) } }) }) } return e.prototype.initSession = function () { return this.session = new r.Session(this), this.session }, e.prototype.initPublisher = function (e, t, n) { var i; i = t && "function" != typeof t ? { audioSource: void 0 !== (i = t).audioSource ? i.audioSource : void 0, frameRate: "undefined" != typeof MediaStreamTrack && i.videoSource instanceof MediaStreamTrack ? void 0 : void 0 !== i.frameRate ? i.frameRate : void 0, insertMode: void 0 !== i.insertMode ? "string" == typeof i.insertMode ? c.VideoInsertMode[i.insertMode] : i.insertMode : c.VideoInsertMode.APPEND, mirror: void 0 === i.mirror || i.mirror, publishAudio: void 0 === i.publishAudio || i.publishAudio, publishVideo: void 0 === i.publishVideo || i.publishVideo, resolution: "undefined" != typeof MediaStreamTrack && i.videoSource instanceof MediaStreamTrack ? void 0 : void 0 !== i.resolution ? i.resolution : "640x480", videoSource: void 0 !== i.videoSource ? i.videoSource : void 0, filter: i.filter } : { insertMode: c.VideoInsertMode.APPEND, mirror: !0, publishAudio: !0, publishVideo: !0, resolution: "640x480" }; var r, s = new o.Publisher(e, i, this); return t && "function" == typeof t ? r = t : n && (r = n), s.initialize().then(function () { void 0 !== r && r(void 0), s.emitEvent("accessAllowed", []) }).catch(function (e) { void 0 !== r && r(e), s.emitEvent("accessDenied", [e]) }), this.publishers.push(s), s }, e.prototype.initPublisherAsync = function (e, t) { var n = this; return new Promise(function (i, o) { var r, s = function (e) { e ? o(e) : i(r) }; r = t ? n.initPublisher(e, t, s) : n.initPublisher(e, s) }) }, e.prototype.initLocalRecorder = function (e) { return new i.LocalRecorder(e) }, e.prototype.checkSystemRequirements = function () { var e = f.name, t = f.os.family, n = f.ua ? f.ua : navigator.userAgent; return "iOS" !== t || "Safari" === e && -1 === n.indexOf("CriOS") && -1 === n.indexOf("FxiOS") ? "Safari" !== e && "Chrome" !== e && "Chrome Mobile" !== e && "Firefox" !== e && "Firefox Mobile" !== e && "Opera" !== e && "Opera Mobile" !== e && "Android Browser" !== e && "Electron" !== e ? 0 : 1 : 0 }, e.prototype.checkScreenSharingCapabilities = function () { var e = f.name, t = f.os.family; return "iOS" === t || "Android" === t ? 0 : "Chrome" !== e && "Firefox" !== e && "Opera" !== e && "Electron" !== e ? 0 : 1 }, e.prototype.getDevices = function () { return new Promise(function (e, t) { navigator.mediaDevices.enumerateDevices().then(function (t) { var n = []; f.isIonicAndroid && cordova.plugins && cordova.plugins.EnumerateDevicesPlugin ? cordova.plugins.EnumerateDevicesPlugin.getEnumerateDevices().then(function (i) { var o = [], r = [], s = []; o = i.filter(function (e) { return "audioinput" === e.kind }), r = t.filter(function (e) { return "videoinput" === e.kind }), s = t.filter(function (e) { return "audioinput" === e.kind }), r.forEach(function (e, t) { if (e.label) n.push({ kind: e.kind, deviceId: e.deviceId, label: e.label }); else { var i = ""; i = 0 === t ? "Front Camera" : 1 === t ? "Back Camera" : "Unknown Camera", n.push({ kind: e.kind, deviceId: e.deviceId, label: i }) } }), s.forEach(function (e, t) { if (e.label) n.push({ kind: e.kind, deviceId: e.deviceId, label: e.label }); else { var i = ""; switch (t) { case 0: i = "Default"; break; case 1: var r = o.filter(function (e) { return e.label.includes("Built") })[0]; i = r ? r.label : "Built-in Microphone"; break; case 2: var s = o.filter(function (e) { return e.label.includes("Wired") })[0]; i = s ? s.label : "Headset earpiece"; break; case 3: var a = o.filter(function (e) { return e.label.includes("Bluetooth") })[0]; i = a ? a.label : "Wireless"; break; default: i = "Unknown Microphone" }n.push({ kind: e.kind, deviceId: e.deviceId, label: i }) } }), e(n) }) : (t.forEach(function (e) { "audioinput" !== e.kind && "videoinput" !== e.kind || n.push({ kind: e.kind, deviceId: e.deviceId, label: e.label }) }), e(n)) }).catch(function (e) { console.error("Error getting devices", e), t(e) }) }) }, e.prototype.getUserMedia = function (e) { var t = this; return new Promise(function (n, i) { var o = function (e, o) { var r = { audio: void 0 === o.audio || o.audio, video: !1 }; navigator.mediaDevices.getUserMedia(r).then(function (t) { e.addTrack(t.getAudioTracks()[0]), n(e) }).catch(function (n) { e.getAudioTracks().forEach(function (e) { e.stop() }), e.getVideoTracks().forEach(function (e) { e.stop() }), i(t.generateAudioDeviceError(n, r)) }) }; t.generateMediaConstraints(e).then(function (r) { var s, c; if (r.videoTrack && r.audioTrack || r.audioTrack && !1 === (null === (s = r.constraints) || void 0 === s ? void 0 : s.video) || r.videoTrack && !1 === (null === (c = r.constraints) || void 0 === c ? void 0 : c.audio)) n(t.addAlreadyProvidedTracks(r, new MediaStream)); else { r.videoTrack && delete r.constraints.video, r.audioTrack && delete r.constraints.audio; var d = !1; if ("string" == typeof e.videoSource && ("screen" === e.videoSource || "window" === e.videoSource || "Electron" === f.name && e.videoSource.startsWith("screen:")) && (d = !r.audioTrack && null !== e.audioSource && !1 !== e.audioSource, navigator.mediaDevices.getDisplayMedia && "Electron" !== f.name)) return void navigator.mediaDevices.getDisplayMedia({ video: !0 }).then(function (e) { t.addAlreadyProvidedTracks(r, e), d ? o(e, r.constraints) : n(e) }).catch(function (e) { var t = a.OpenViduErrorName.SCREEN_CAPTURE_DENIED, n = e.toString(); i(new a.OpenViduError(t, n)) }); var u = d ? { video: r.constraints.video } : r.constraints; navigator.mediaDevices.getUserMedia(u).then(function (e) { t.addAlreadyProvidedTracks(r, e), d ? o(e, r.constraints) : n(e) }).catch(function (t) { var n, o = t.toString(); n = "screen" !== e.videoSource ? a.OpenViduErrorName.DEVICE_ACCESS_DENIED : a.OpenViduErrorName.SCREEN_CAPTURE_DENIED, i(new a.OpenViduError(n, o)) }) } }).catch(function (e) { i(e) }) }) }, e.prototype.enableProdMode = function () { console.log = function () { }, console.debug = function () { }, console.info = function () { }, console.warn = function () { } }, e.prototype.setAdvancedConfiguration = function (e) { this.advancedConfiguration = e }, e.prototype.generateMediaConstraints = function (e) { var t = this; return new Promise(function (n, i) { var o = { audioTrack: void 0, videoTrack: void 0, constraints: { audio: void 0, video: void 0 } }, r = e.audioSource, s = e.videoSource; if (null !== r && !1 !== r || (o.constraints.audio = !1), null !== s && !1 !== s || (o.constraints.video = !1), !1 === o.constraints.audio && !1 === o.constraints.video && i(new a.OpenViduError(a.OpenViduErrorName.NO_INPUT_SOURCE_SET, "Properties 'audioSource' and 'videoSource' cannot be set to false or null at the same time")), "undefined" != typeof MediaStreamTrack && r instanceof MediaStreamTrack && (o.audioTrack = r), "undefined" != typeof MediaStreamTrack && s instanceof MediaStreamTrack && (o.videoTrack = s), void 0 === r && (o.constraints.audio = !0), void 0 === s && (o.constraints.video = { width: { ideal: 640 }, height: { ideal: 480 } }), null !== s && !1 !== s) { if (e.resolution) { var c = e.resolution.toLowerCase().split("x"), l = Number(c[0]), p = Number(c[1]); o.constraints.video = { width: { ideal: l }, height: { ideal: p } } } e.frameRate && (o.constraints.video.frameRate = { ideal: e.frameRate }) } if ("string" == typeof r && (o.constraints.audio = { deviceId: { exact: r } }), "string" == typeof s) if (t.isScreenShare(s)) if (t.checkScreenSharingCapabilities()) if ("Electron" === f.name) { var h = s, m = h.substr(h.indexOf("screen:") + "screen:".length); o.constraints.video = { mandatory: { chromeMediaSource: "desktop", chromeMediaSourceId: m } }, n(o) } else { if (t.advancedConfiguration.screenShareChromeExtension && -1 === f.name.indexOf("Firefox") && !navigator.mediaDevices.getDisplayMedia) return void u.getScreenConstraints(function (e, r) { if (e || r.mandatory && "screen" === r.mandatory.chromeMediaSource) { if ("permission-denied" !== e && "PermissionDeniedError" !== e) { var s = t.advancedConfiguration.screenShareChromeExtension.split("/").pop().trim(); return void u.getChromeExtensionStatus(s, function (e) { if ("installed-disabled" === e) { var n = new a.OpenViduError(a.OpenViduErrorName.SCREEN_EXTENSION_DISABLED, "You must enable the screen extension"); console.error(n), i(n) } if ("not-installed" === e) { var o = new a.OpenViduError(a.OpenViduErrorName.SCREEN_EXTENSION_NOT_INSTALLED, t.advancedConfiguration.screenShareChromeExtension); console.error(o), i(o) } }) } var c = new a.OpenViduError(a.OpenViduErrorName.SCREEN_CAPTURE_DENIED, "You must allow access to one window of your desktop"); console.error(c), i(c) } else o.constraints.video = r, n(o) }); if (!navigator.mediaDevices.getDisplayMedia) { var v = -1 !== f.name.indexOf("Firefox") ? e.videoSource : void 0; return void d.getScreenId(v, function (e, r, s) { if (e) if ("not-installed" === e) { var c = t.advancedConfiguration.screenShareChromeExtension ? t.advancedConfiguration.screenShareChromeExtension : "https://chrome.google.com/webstore/detail/openvidu-screensharing/lfcgfepafnobdloecchnfaclibenjold", d = new a.OpenViduError(a.OpenViduErrorName.SCREEN_EXTENSION_NOT_INSTALLED, c); console.error(d), i(d) } else if ("installed-disabled" === e) { d = new a.OpenViduError(a.OpenViduErrorName.SCREEN_EXTENSION_DISABLED, "You must enable the screen extension"); console.error(d), i(d) } else if ("permission-denied" === e) { d = new a.OpenViduError(a.OpenViduErrorName.SCREEN_CAPTURE_DENIED, "You must allow access to one window of your desktop"); console.error(d), i(d) } else { d = new a.OpenViduError(a.OpenViduErrorName.GENERIC_ERROR, "Unknown error when accessing screen share"); console.error(d), console.error(e), i(d) } else o.constraints.video = s.video, n(o) }) } n(o) } else { var b = new a.OpenViduError(a.OpenViduErrorName.SCREEN_SHARING_NOT_SUPPORTED, "You can only screen share in desktop Chrome, Firefox, Opera or Electron. Detected client: " + f.name); console.error(b), i(b) } else o.constraints.video || (o.constraints.video = {}), o.constraints.video.deviceId = { exact: s }; n(o) }) }, e.prototype.startWs = function (e) { var t = { heartbeat: 5e3, sendCloseMessage: !1, ws: { uri: this.wsUri, onconnected: e, ondisconnect: this.disconnectCallback.bind(this), onreconnecting: this.reconnectingCallback.bind(this), onreconnected: this.reconnectedCallback.bind(this) }, rpc: { requestTimeout: 1e4, participantJoined: this.session.onParticipantJoined.bind(this.session), participantPublished: this.session.onParticipantPublished.bind(this.session), participantUnpublished: this.session.onParticipantUnpublished.bind(this.session), participantLeft: this.session.onParticipantLeft.bind(this.session), participantEvicted: this.session.onParticipantEvicted.bind(this.session), recordingStarted: this.session.onRecordingStarted.bind(this.session), recordingStopped: this.session.onRecordingStopped.bind(this.session), sendMessage: this.session.onNewMessage.bind(this.session), streamPropertyChanged: this.session.onStreamPropertyChanged.bind(this.session), filterEventDispatched: this.session.onFilterEventDispatched.bind(this.session), iceCandidate: this.session.recvIceCandidate.bind(this.session), mediaError: this.session.onMediaError.bind(this.session) } }; this.jsonRpcClient = new p.clients.JsonRpcClient(t) }, e.prototype.closeWs = function () { this.jsonRpcClient.close(4102, "Connection closed by client") }, e.prototype.sendRequest = function (e, t, n) { t && t instanceof Function && (n = t, t = {}), console.debug('Sending request: {method:"' + e + '", params: ' + JSON.stringify(t) + "}"), this.jsonRpcClient.send(e, t, n) }, e.prototype.getWsUri = function () { return this.wsUri }, e.prototype.getSecret = function () { return this.secret }, e.prototype.getRecorder = function () { return this.recorder }, e.prototype.generateAudioDeviceError = function (e, t) { var n, i; switch ("Error" === e.name && (e.name = e.constructor.name), e.name.toLowerCase()) { case "notfounderror": return n = a.OpenViduErrorName.INPUT_AUDIO_DEVICE_NOT_FOUND, i = e.toString(), new a.OpenViduError(n, i); case "notallowederror": return n = a.OpenViduErrorName.DEVICE_ACCESS_DENIED, i = e.toString(), new a.OpenViduError(n, i); case "overconstrainederror": return "deviceid" === e.constraint.toLowerCase() ? (n = a.OpenViduErrorName.INPUT_AUDIO_DEVICE_NOT_FOUND, i = "Audio input device with deviceId '" + t.audio.deviceId.exact + "' not found") : (n = a.OpenViduErrorName.PUBLISHER_PROPERTIES_ERROR, i = "Audio input device doesn't support the value passed for constraint '" + e.constraint + "'"), new a.OpenViduError(n, i); case "notreadableerror": return n = a.OpenViduErrorName.DEVICE_ALREADY_IN_USE, i = e.toString(), new a.OpenViduError(n, i); default: return new a.OpenViduError(a.OpenViduErrorName.INPUT_AUDIO_DEVICE_GENERIC_ERROR, e.toString()) } }, e.prototype.addAlreadyProvidedTracks = function (e, t) { return e.videoTrack && t.addTrack(e.videoTrack), e.audioTrack && t.addTrack(e.audioTrack), t }, e.prototype.disconnectCallback = function () { console.warn("Websocket connection lost"), this.isRoomAvailable() ? this.session.onLostConnection("networkDisconnect") : alert("Connection error. Please reload page.") }, e.prototype.reconnectingCallback = function () { console.warn("Websocket connection lost (reconnecting)"), this.isRoomAvailable() ? this.session.emitEvent("reconnecting", []) : alert("Connection error. Please reload page.") }, e.prototype.reconnectedCallback = function () { var e = this; console.warn("Websocket reconnected"), this.isRoomAvailable() ? this.sendRequest("connect", { sessionId: this.session.connection.rpcSessionId }, function (t, n) { t ? (console.error(t), console.warn("Websocket was able to reconnect to OpenVidu Server, but your Connection was already destroyed due to timeout. You are no longer a participant of the Session and your media streams have been destroyed"), e.session.onLostConnection("networkDisconnect"), e.jsonRpcClient.close(4101, "Reconnection fault"), reconectinMode = 1, startSession(1)) : (e.jsonRpcClient.resetPing(), e.session.onRecoveredConnection()) }) : alert("Connection error. Please reload page.") }, e.prototype.isRoomAvailable = function () { return void 0 !== this.session && this.session instanceof r.Session || (console.warn("Session instance not found"), !1) }, e.prototype.isScreenShare = function (e) { return "screen" === e || "window" === e || "Electron" === f.name && e.startsWith("screen:") }, e }(); n.OpenVidu = m }, { "../../package.json": 21, "../OpenViduInternal/Enums/OpenViduError": 33, "../OpenViduInternal/Enums/VideoInsertMode": 34, "../OpenViduInternal/Events/StreamPropertyChangedEvent": 44, "../OpenViduInternal/KurentoUtils/kurento-jsonrpc": 51, "../OpenViduInternal/ScreenSharing/Screen-Capturing": 56, "../OpenViduInternal/ScreenSharing/Screen-Capturing-Auto": 55, "./LocalRecorder": 25, "./Publisher": 27, "./Session": 28, platform: 8, "wolfy87-eventemitter": 20 }], 27: [function (e, t, n) { "use strict"; var i, o = this && this.__extends || (i = function (e, t) { return (i = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var n in t) t.hasOwnProperty(n) && (e[n] = t[n]) })(e, t) }, function (e, t) { function n() { this.constructor = e } i(e, t), e.prototype = null === t ? Object.create(t) : (n.prototype = t.prototype, new n) }); Object.defineProperty(n, "__esModule", { value: !0 }); var r = e("./Session"), s = e("./Stream"), a = e("./StreamManager"), c = e("../OpenViduInternal/Events/StreamEvent"), d = e("../OpenViduInternal/Events/StreamPropertyChangedEvent"), u = e("../OpenViduInternal/Events/VideoElementEvent"), l = e("../OpenViduInternal/Enums/OpenViduError"), p = e("platform"), f = function (e) { function t(t, n, i) { var o = e.call(this, new s.Stream(i.session ? i.session : new r.Session(i), { publisherProperties: n, mediaConstraints: {} }), t) || this; return o.accessAllowed = !1, o.isSubscribedToRemote = !1, o.accessDenied = !1, o.properties = n, o.openvidu = i, o.stream.ee.on("local-stream-destroyed", function (e) { o.stream.isLocalStreamPublished = !1; var t = new c.StreamEvent(!0, o, "streamDestroyed", o.stream, e); o.emitEvent("streamDestroyed", [t]), t.callDefaultBehavior() }), o } return o(t, e), t.prototype.publishAudio = function (e) { var t = this; this.stream.audioActive !== e && ((this.stream.displayMyRemote() ? this.stream.localMediaStreamWhenSubscribedToRemote : this.stream.getMediaStream()).getAudioTracks().forEach(function (t) { t.enabled = e }), this.session && this.stream.streamId && this.session.openvidu.sendRequest("streamPropertyChanged", { streamId: this.stream.streamId, property: "audioActive", newValue: e, reason: "publishAudio" }, function (n, i) { n ? console.error("Error sending 'streamPropertyChanged' event", n) : (t.session.emitEvent("streamPropertyChanged", [new d.StreamPropertyChangedEvent(t.session, t.stream, "audioActive", e, !e, "publishAudio")]), t.emitEvent("streamPropertyChanged", [new d.StreamPropertyChangedEvent(t, t.stream, "audioActive", e, !e, "publishAudio")])) }), this.stream.audioActive = e, console.info("'Publisher' has " + (e ? "published" : "unpublished") + " its audio stream")) }, t.prototype.publishVideo = function (e) { var t = this; this.stream.videoActive !== e && ((this.stream.displayMyRemote() ? this.stream.localMediaStreamWhenSubscribedToRemote : this.stream.getMediaStream()).getVideoTracks().forEach(function (t) { t.enabled = e }), this.session && this.stream.streamId && this.session.openvidu.sendRequest("streamPropertyChanged", { streamId: this.stream.streamId, property: "videoActive", newValue: e, reason: "publishVideo" }, function (n, i) { n ? console.error("Error sending 'streamPropertyChanged' event", n) : (t.session.emitEvent("streamPropertyChanged", [new d.StreamPropertyChangedEvent(t.session, t.stream, "videoActive", e, !e, "publishVideo")]), t.emitEvent("streamPropertyChanged", [new d.StreamPropertyChangedEvent(t, t.stream, "videoActive", e, !e, "publishVideo")])) }), this.stream.videoActive = e, console.info("'Publisher' has " + (e ? "published" : "unpublished") + " its video stream")) }, t.prototype.subscribeToRemote = function (e) { e = void 0 === e || e, this.isSubscribedToRemote = e, this.stream.subscribeToMyRemote(e) }, t.prototype.on = function (t, n) { var i = this; return e.prototype.on.call(this, t, n), "streamCreated" === t && (this.stream && this.stream.isLocalStreamPublished ? this.emitEvent("streamCreated", [new c.StreamEvent(!1, this, "streamCreated", this.stream, "")]) : this.stream.ee.on("stream-created-by-publisher", function () { i.emitEvent("streamCreated", [new c.StreamEvent(!1, i, "streamCreated", i.stream, "")]) })), "remoteVideoPlaying" === t && this.stream.displayMyRemote() && this.videos[0] && this.videos[0].video && this.videos[0].video.currentTime > 0 && !1 === this.videos[0].video.paused && !1 === this.videos[0].video.ended && 4 === this.videos[0].video.readyState && this.emitEvent("remoteVideoPlaying", [new u.VideoElementEvent(this.videos[0].video, this, "remoteVideoPlaying")]), "accessAllowed" === t && this.accessAllowed && this.emitEvent("accessAllowed", []), "accessDenied" === t && this.accessDenied && this.emitEvent("accessDenied", []), this }, t.prototype.once = function (t, n) { var i = this; return e.prototype.once.call(this, t, n), "streamCreated" === t && (this.stream && this.stream.isLocalStreamPublished ? this.emitEvent("streamCreated", [new c.StreamEvent(!1, this, "streamCreated", this.stream, "")]) : this.stream.ee.once("stream-created-by-publisher", function () { i.emitEvent("streamCreated", [new c.StreamEvent(!1, i, "streamCreated", i.stream, "")]) })), "remoteVideoPlaying" === t && this.stream.displayMyRemote() && this.videos[0] && this.videos[0].video && this.videos[0].video.currentTime > 0 && !1 === this.videos[0].video.paused && !1 === this.videos[0].video.ended && 4 === this.videos[0].video.readyState && this.emitEvent("remoteVideoPlaying", [new u.VideoElementEvent(this.videos[0].video, this, "remoteVideoPlaying")]), "accessAllowed" === t && this.accessAllowed && this.emitEvent("accessAllowed", []), "accessDenied" === t && this.accessDenied && this.emitEvent("accessDenied", []), this }, t.prototype.replaceTrack = function (e) { var t = this, n = function () { var n, i = t.stream.displayMyRemote() ? t.stream.localMediaStreamWhenSubscribedToRemote : t.stream.getMediaStream(); n = "video" === e.kind ? i.getVideoTracks()[0] : i.getAudioTracks()[0], i.removeTrack(n), n.stop(), i.addTrack(e) }; return new Promise(function (i, o) { if (t.stream.isLocalStreamPublished) { var r = t.stream.getRTCPeerConnection().getSenders(), s = void 0; "video" === e.kind ? (s = r.find(function (e) { return !!e.track && "video" === e.track.kind })) || o(new Error("There's no replaceable track for that kind of MediaStreamTrack in this Publisher object")) : "audio" === e.kind ? (s = r.find(function (e) { return !!e.track && "audio" === e.track.kind })) || o(new Error("There's no replaceable track for that kind of MediaStreamTrack in this Publisher object")) : o(new Error("Unknown track kind " + e.kind)), s.replaceTrack(e).then(function () { n(), i() }).catch(function (e) { o(e) }) } else n(), i() }) }, t.prototype.initialize = function () { var e = this; return new Promise(function (t, n) { var i, o = {}, r = {}, s = function (t) { e.accessDenied = !0, e.accessAllowed = !1, n(t) }, a = function (n) { if (e.accessAllowed = !0, e.accessDenied = !1, "undefined" != typeof MediaStreamTrack && e.properties.audioSource instanceof MediaStreamTrack && (n.removeTrack(n.getAudioTracks()[0]), n.addTrack(e.properties.audioSource)), "undefined" != typeof MediaStreamTrack && e.properties.videoSource instanceof MediaStreamTrack && (n.removeTrack(n.getVideoTracks()[0]), n.addTrack(e.properties.videoSource)), n.getAudioTracks()[0]) { var i = void 0 !== e.stream.audioActive && null !== e.stream.audioActive ? e.stream.audioActive : !!e.stream.outboundStreamOpts.publisherProperties.publishAudio; n.getAudioTracks()[0].enabled = i } if (n.getVideoTracks()[0]) { i = void 0 !== e.stream.videoActive && null !== e.stream.videoActive ? e.stream.videoActive : !!e.stream.outboundStreamOpts.publisherProperties.publishVideo; n.getVideoTracks()[0].enabled = i } if (e.videoReference = document.createElement("video"), "Safari" === p.name && e.videoReference.setAttribute("playsinline", "true"), e.stream.setMediaStream(n), e.firstVideoElement && e.createVideoElement(e.firstVideoElement.targetElement, e.properties.insertMode), e.videoReference.srcObject = n, e.stream.displayMyRemote() || e.stream.updateMediaStreamInVideos(), delete e.firstVideoElement, e.stream.isSendVideo()) if (e.stream.isSendScreen()) e.videoReference.addEventListener("loadedmetadata", function () { e.stream.videoDimensions = { width: e.videoReference.videoWidth, height: e.videoReference.videoHeight }, e.screenShareResizeInterval = setInterval(function () { var t = n.getVideoTracks()[0].getSettings(), i = "Chrome" === p.name || "Opera" === p.name ? e.videoReference.videoWidth : t.width, o = "Chrome" === p.name || "Opera" === p.name ? e.videoReference.videoHeight : t.height; if (e.stream.isLocalStreamPublished && (i !== e.stream.videoDimensions.width || o !== e.stream.videoDimensions.height)) { var r = { width: e.stream.videoDimensions.width, height: e.stream.videoDimensions.height }; e.stream.videoDimensions = { width: i || 0, height: o || 0 }, e.session.openvidu.sendRequest("streamPropertyChanged", { streamId: e.stream.streamId, property: "videoDimensions", newValue: JSON.stringify(e.stream.videoDimensions), reason: "screenResized" }, function (t, n) { t ? console.error("Error sending 'streamPropertyChanged' event", t) : (e.session.emitEvent("streamPropertyChanged", [new d.StreamPropertyChangedEvent(e.session, e.stream, "videoDimensions", e.stream.videoDimensions, r, "screenResized")]), e.emitEvent("streamPropertyChanged", [new d.StreamPropertyChangedEvent(e, e.stream, "videoDimensions", e.stream.videoDimensions, r, "screenResized")])) }) } }, 500), e.stream.isLocalStreamReadyToPublish = !0, e.stream.ee.emitEvent("stream-ready-to-publish", []) }); else if (p.isIonicIos || "Safari" === p.name) { e.videoReference.style.display = "none", document.body.appendChild(e.videoReference); var o, r = function () { e.stream.videoDimensions = { width: e.videoReference.videoWidth, height: e.videoReference.videoHeight }, e.stream.isLocalStreamReadyToPublish = !0, e.stream.ee.emitEvent("stream-ready-to-publish", []), document.body.removeChild(e.videoReference) }; e.videoReference.addEventListener("loadedmetadata", function () { 0 === e.videoReference.videoWidth ? o = setInterval(function () { 0 !== e.videoReference.videoWidth && (clearInterval(o), r()) }, 40) : r() }) } else { var s = n.getVideoTracks()[0].getSettings(), a = s.width, c = s.height; ("iOS" === p.os.family || "Android" === p.os.family) && window.innerHeight > window.innerWidth ? e.stream.videoDimensions = { width: c || 0, height: a || 0 } : e.stream.videoDimensions = { width: a || 0, height: c || 0 }, e.stream.isLocalStreamReadyToPublish = !0, e.stream.ee.emitEvent("stream-ready-to-publish", []) } else e.stream.isLocalStreamReadyToPublish = !0, e.stream.ee.emitEvent("stream-ready-to-publish", []); t() }, c = function (t, n) { e.clearPermissionDialogTimer(i, 1250), e.stream.isSendScreen() && e.stream.isSendAudio() ? (r.audio = n, r.video = !1, i = Date.now(), e.setPermissionDialogTimer(1250), navigator.mediaDevices.getUserMedia(r).then(function (n) { e.clearPermissionDialogTimer(i, 1250), t.addTrack(n.getAudioTracks()[0]), a(t) }).catch(function (n) { e.clearPermissionDialogTimer(i, 1250), t.getAudioTracks().forEach(function (e) { e.stop() }), t.getVideoTracks().forEach(function (e) { e.stop() }), s(e.openvidu.generateAudioDeviceError(n, o)) })) : a(t) }, u = function (t) { var n, r; switch (console.error(t), e.clearPermissionDialogTimer(i, 1250), "Error" === t.name && (t.name = t.constructor.name), t.name.toLowerCase()) { case "notfounderror": navigator.mediaDevices.getUserMedia({ audio: !1, video: o.video }).then(function (e) { e.getVideoTracks().forEach(function (e) { e.stop() }), n = l.OpenViduErrorName.INPUT_AUDIO_DEVICE_NOT_FOUND, r = t.toString(), s(new l.OpenViduError(n, r)) }).catch(function (e) { n = l.OpenViduErrorName.INPUT_VIDEO_DEVICE_NOT_FOUND, r = t.toString(), s(new l.OpenViduError(n, r)) }); break; case "notallowederror": n = e.stream.isSendScreen() ? l.OpenViduErrorName.SCREEN_CAPTURE_DENIED : l.OpenViduErrorName.DEVICE_ACCESS_DENIED, r = t.toString(), s(new l.OpenViduError(n, r)); break; case "overconstrainederror": navigator.mediaDevices.getUserMedia({ audio: !1, video: o.video }).then(function (e) { e.getVideoTracks().forEach(function (e) { e.stop() }), "deviceid" === t.constraint.toLowerCase() ? (n = l.OpenViduErrorName.INPUT_AUDIO_DEVICE_NOT_FOUND, r = "Audio input device with deviceId '" + o.audio.deviceId.exact + "' not found") : (n = l.OpenViduErrorName.PUBLISHER_PROPERTIES_ERROR, r = "Audio input device doesn't support the value passed for constraint '" + t.constraint + "'"), s(new l.OpenViduError(n, r)) }).catch(function (e) { "deviceid" === t.constraint.toLowerCase() ? (n = l.OpenViduErrorName.INPUT_VIDEO_DEVICE_NOT_FOUND, r = "Video input device with deviceId '" + o.video.deviceId.exact + "' not found") : (n = l.OpenViduErrorName.PUBLISHER_PROPERTIES_ERROR, r = "Video input device doesn't support the value passed for constraint '" + t.constraint + "'"), s(new l.OpenViduError(n, r)) }); break; case "aborterror": case "notreadableerror": n = l.OpenViduErrorName.DEVICE_ALREADY_IN_USE, r = t.toString(), s(new l.OpenViduError(n, r)); break; default: n = l.OpenViduErrorName.GENERIC_ERROR, r = t.toString(), s(new l.OpenViduError(n, r)) } }; e.openvidu.generateMediaConstraints(e.properties).then(function (t) { if (void 0 !== t.constraints) { var n = { mediaConstraints: o = t.constraints, publisherProperties: e.properties }; e.stream.setOutboundStreamOptions(n); var s = void 0 === o.audio || o.audio; r.audio = !e.stream.isSendScreen() && s, r.video = o.video, i = Date.now(), e.setPermissionDialogTimer(1250), e.stream.isSendScreen() && navigator.mediaDevices.getDisplayMedia && "Electron" !== p.name ? navigator.mediaDevices.getDisplayMedia({ video: !0 }).then(function (n) { e.openvidu.addAlreadyProvidedTracks(t, n), c(n, s) }).catch(function (e) { u(e) }) : navigator.mediaDevices.getUserMedia(r).then(function (n) { e.openvidu.addAlreadyProvidedTracks(t, n), c(n, s) }).catch(function (e) { u(e) }) } else a(e.openvidu.addAlreadyProvidedTracks(t, new MediaStream)) }).catch(function (e) { s(e) }) }) }, t.prototype.reestablishStreamPlayingEvent = function () { this.ee.getListeners("streamPlaying").length > 0 && this.addPlayEventToFirstVideo() }, t.prototype.setPermissionDialogTimer = function (e) { var t = this; this.permissionDialogTimeout = setTimeout(function () { t.emitEvent("accessDialogOpened", []) }, e) }, t.prototype.clearPermissionDialogTimer = function (e, t) { clearTimeout(this.permissionDialogTimeout), Date.now() - e > t && this.emitEvent("accessDialogClosed", []) }, t }(a.StreamManager); n.Publisher = f }, { "../OpenViduInternal/Enums/OpenViduError": 33, "../OpenViduInternal/Events/StreamEvent": 42, "../OpenViduInternal/Events/StreamPropertyChangedEvent": 44, "../OpenViduInternal/Events/VideoElementEvent": 45, "./Session": 28, "./Stream": 29, "./StreamManager": 30, platform: 8 }], 28: [function (e, t, n) { "use strict"; Object.defineProperty(n, "__esModule", { value: !0 }); var i = e("./Connection"), o = e("./Filter"), r = e("./Subscriber"), s = e("../OpenViduInternal/Events/ConnectionEvent"), a = e("../OpenViduInternal/Events/FilterEvent"), c = e("../OpenViduInternal/Events/RecordingEvent"), d = e("../OpenViduInternal/Events/SessionDisconnectedEvent"), u = e("../OpenViduInternal/Events/SignalEvent"), l = e("../OpenViduInternal/Events/StreamEvent"), p = e("../OpenViduInternal/Events/StreamPropertyChangedEvent"), f = e("../OpenViduInternal/Enums/OpenViduError"), h = e("../OpenViduInternal/Enums/VideoInsertMode"), m = e("wolfy87-eventemitter"), v = e("platform"), b = function () { function e(e) { this.streamManagers = [], this.remoteStreamsCreated = {}, this.isFirstIonicIosSubscriber = !0, this.countDownForIonicIosSubscribersActive = !0, this.remoteConnections = {}, this.startSpeakingEventsEnabled = !1, this.startSpeakingEventsEnabledOnce = !1, this.stopSpeakingEventsEnabled = !1, this.stopSpeakingEventsEnabledOnce = !1, this.ee = new m, this.openvidu = e } return e.prototype.connect = function (e, t) { var n = this; return new Promise(function (i, o) { n.processToken(e), n.openvidu.checkSystemRequirements() ? (n.options = { sessionId: n.sessionId, participantId: e, metadata: t ? n.stringClientMetadata(t) : "" }, n.connectAux(e).then(function () { i() }).catch(function (e) { o(e) })) : o(new f.OpenViduError(f.OpenViduErrorName.BROWSER_NOT_SUPPORTED, "Browser " + v.name + " (version " + v.version + ") for " + v.os.family + " is not supported in OpenVidu")) }) }, e.prototype.disconnect = function () { this.leave(!1, "disconnect") }, e.prototype.subscribe = function (e, t, n, i) { var o, s = {}; s = n && "function" != typeof n ? { insertMode: void 0 !== n.insertMode ? "string" == typeof n.insertMode ? h.VideoInsertMode[n.insertMode] : s.insertMode : h.VideoInsertMode.APPEND, subscribeToAudio: void 0 === n.subscribeToAudio || n.subscribeToAudio, subscribeToVideo: void 0 === n.subscribeToVideo || n.subscribeToVideo } : { insertMode: h.VideoInsertMode.APPEND, subscribeToAudio: !0, subscribeToVideo: !0 }, n && "function" == typeof n ? o = n : i && (o = i), console.info("Subscribing to " + e.connection.connectionId), e.subscribe().then(function () { console.info("Subscribed correctly to " + e.connection.connectionId), void 0 !== o && o(void 0) }).catch(function (e) { void 0 !== o && o(e) }); var a = new r.Subscriber(e, t, s); return a.targetElement && e.streamManager.createVideoElement(a.targetElement, s.insertMode), a }, e.prototype.subscribeAsync = function (e, t, n) { var i = this; return new Promise(function (o, r) { var s, a = function (e) { e ? r(e) : o(s) }; s = n ? i.subscribe(e, t, n, a) : i.subscribe(e, t, a) }) }, e.prototype.unsubscribe = function (e) { var t = e.stream.connection.connectionId; console.info("Unsubscribing from " + t), this.openvidu.sendRequest("unsubscribeFromVideo", { sender: e.stream.connection.connectionId }, function (n, i) { n ? console.error("Error unsubscribing from " + t, n) : console.info("Unsubscribed correctly from " + t), e.stream.disposeWebRtcPeer(), e.stream.disposeMediaStream() }), e.stream.streamManager.removeAllVideos() }, e.prototype.publish = function (e) { var t = this; return new Promise(function (n, i) { e.session = t, e.stream.session = t, e.stream.publishedOnce ? e.initialize().then(function () { t.connection.addStream(e.stream), e.reestablishStreamPlayingEvent(), e.stream.publish().then(function () { n() }).catch(function (e) { i(e) }) }).catch(function (e) { i(e) }) : (t.connection.addStream(e.stream), e.stream.publish().then(function () { n() }).catch(function (e) { i(e) })) }) }, e.prototype.unpublish = function (e) { var t = e.stream; if (t.connection) if (t.connection === this.connection) { console.info("Unpublishing local media (" + t.connection.connectionId + ")"), this.openvidu.sendRequest("unpublishVideo", function (e, t) { e ? console.error(e) : console.info("Media unpublished correctly") }), t.disposeWebRtcPeer(), delete t.connection.stream; var n = new l.StreamEvent(!0, e, "streamDestroyed", e.stream, "unpublish"); e.emitEvent("streamDestroyed", [n]), n.callDefaultBehavior() } else console.error("The associated Connection object of this Publisher is not your local Connection.Only moderators can force unpublish on remote Streams via 'forceUnpublish' method", t); else console.error("The associated Connection object of this Publisher is null", t) }, e.prototype.forceDisconnect = function (e) { var t = this; return new Promise(function (n, i) { console.info("Forcing disconnect for connection " + e.connectionId), t.openvidu.sendRequest("forceDisconnect", { connectionId: e.connectionId }, function (t, o) { t ? (console.error("Error forcing disconnect for Connection " + e.connectionId, t), 401 === t.code ? i(new f.OpenViduError(f.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED, "You don't have permissions to force a disconnection")) : i(t)) : (console.info("Forcing disconnect correctly for Connection " + e.connectionId), n()) }) }) }, e.prototype.forceUnpublish = function (e) { var t = this; return new Promise(function (n, i) { console.info("Forcing unpublish for stream " + e.streamId), t.openvidu.sendRequest("forceUnpublish", { streamId: e.streamId }, function (t, o) { t ? (console.error("Error forcing unpublish for Stream " + e.streamId, t), 401 === t.code ? i(new f.OpenViduError(f.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED, "You don't have permissions to force an unpublishing")) : i(t)) : (console.info("Forcing unpublish correctly for Stream " + e.streamId), n()) }) }) }, e.prototype.signal = function (e) { var t = this; return new Promise(function (n, i) { var o = {}; if (e.to && e.to.length > 0) { var r = []; e.to.forEach(function (e) { e.connectionId && r.push(e.connectionId) }), o.to = r } else o.to = []; o.data = e.data ? e.data : ""; var s = e.type ? e.type : "signal"; s && "signal:" !== s.substring(0, 7) && (s = "signal:" + s), o.type = s, t.openvidu.sendRequest("sendMessage", { message: JSON.stringify(o) }, function (e, t) { e ? i(e) : n() }) }) }, e.prototype.on = function (e, t) { if (this.ee.on(e, function (n) { n ? console.info("Event '" + e + "' triggered by 'Session'", n) : console.info("Event '" + e + "' triggered by 'Session'"), t(n) }), "publisherStartSpeaking" === e) for (var n in this.startSpeakingEventsEnabled = !0, this.remoteConnections) { (i = this.remoteConnections[n].stream) && i.hasAudio && i.enableStartSpeakingEvent() } if ("publisherStopSpeaking" === e) for (var n in this.stopSpeakingEventsEnabled = !0, this.remoteConnections) { var i; (i = this.remoteConnections[n].stream) && i.hasAudio && i.enableStopSpeakingEvent() } return this }, e.prototype.once = function (e, t) { if (this.ee.once(e, function (n) { n ? console.info("Event '" + e + "' triggered once by 'Session'", n) : console.info("Event '" + e + "' triggered once by 'Session'"), t(n) }), "publisherStartSpeaking" === e) for (var n in this.startSpeakingEventsEnabledOnce = !0, this.remoteConnections) { (i = this.remoteConnections[n].stream) && i.hasAudio && i.enableOnceStartSpeakingEvent() } if ("publisherStopSpeaking" === e) for (var n in this.stopSpeakingEventsEnabledOnce = !0, this.remoteConnections) { var i; (i = this.remoteConnections[n].stream) && i.hasAudio && i.enableOnceStopSpeakingEvent() } return this }, e.prototype.off = function (e, t) { if ((t ? this.ee.off(e, t) : this.ee.removeAllListeners(e), "publisherStartSpeaking" === e) && 0 === this.ee.getListeners(e).length) for (var n in this.startSpeakingEventsEnabled = !1, this.remoteConnections) { (i = this.remoteConnections[n].stream) && i.disableStartSpeakingEvent(!1) } if ("publisherStopSpeaking" === e && 0 === this.ee.getListeners(e).length) for (var n in this.stopSpeakingEventsEnabled = !1, this.remoteConnections) { var i; (i = this.remoteConnections[n].stream) && i.disableStopSpeakingEvent(!1) } return this }, e.prototype.onParticipantJoined = function (e) { var t = this; this.getConnection(e.id, "").then(function (t) { console.warn("Connection " + e.id + " already exists in connections list") }).catch(function (n) { var o = new i.Connection(t, e); t.remoteConnections[e.id] = o, t.ee.emitEvent("connectionCreated", [new s.ConnectionEvent(!1, t, "connectionCreated", o, "")]) }) }, e.prototype.onParticipantLeft = function (e) { var t = this; this.getRemoteConnection(e.connectionId, "Remote connection " + e.connectionId + " unknown when 'onParticipantLeft'. Existing remote connections: " + JSON.stringify(Object.keys(this.remoteConnections))).then(function (n) { if (n.stream) { var i = n.stream, o = new l.StreamEvent(!0, t, "streamDestroyed", i, e.reason); t.ee.emitEvent("streamDestroyed", [o]), o.callDefaultBehavior(), delete t.remoteStreamsCreated[i.streamId], 0 === Object.keys(t.remoteStreamsCreated).length && (t.isFirstIonicIosSubscriber = !0, t.countDownForIonicIosSubscribersActive = !0) } delete t.remoteConnections[n.connectionId], t.ee.emitEvent("connectionDestroyed", [new s.ConnectionEvent(!1, t, "connectionDestroyed", n, e.reason)]) }).catch(function (e) { console.error(e) }) }, e.prototype.onParticipantPublished = function (e) { var t, n = this, o = function (e) { n.remoteConnections[e.connectionId] = e, n.remoteStreamsCreated[e.stream.streamId] || n.ee.emitEvent("streamCreated", [new l.StreamEvent(!1, n, "streamCreated", e.stream, "")]), n.remoteStreamsCreated[e.stream.streamId] = !0 }; this.getRemoteConnection(e.id, "Remote connection '" + e.id + "' unknown when 'onParticipantPublished'. Existing remote connections: " + JSON.stringify(Object.keys(this.remoteConnections))).then(function (n) { t = n, e.metadata = n.data, t.options = e, t.initRemoteStreams(e.streams), o(t) }).catch(function (r) { t = new i.Connection(n, e), o(t) }) }, e.prototype.onParticipantUnpublished = function (e) { var t = this; e.connectionId === this.connection.connectionId ? this.stopPublisherStream(e.reason) : this.getRemoteConnection(e.connectionId, "Remote connection '" + e.connectionId + "' unknown when 'onParticipantUnpublished'. Existing remote connections: " + JSON.stringify(Object.keys(this.remoteConnections))).then(function (n) { var i = new l.StreamEvent(!0, t, "streamDestroyed", n.stream, e.reason); t.ee.emitEvent("streamDestroyed", [i]), i.callDefaultBehavior(); var o = n.stream.streamId; delete t.remoteStreamsCreated[o], 0 === Object.keys(t.remoteStreamsCreated).length && (t.isFirstIonicIosSubscriber = !0, t.countDownForIonicIosSubscribersActive = !0), n.removeStream(o) }).catch(function (e) { console.error(e) }) }, e.prototype.onParticipantEvicted = function (e) { e.connectionId === this.connection.connectionId && this.sessionId && !this.connection.disposed && this.leave(!0, e.reason) }, e.prototype.onNewMessage = function (e) { var t = this; console.info("New signal: " + JSON.stringify(e)); var n = e.type ? e.type.replace(/^(signal:)/, "") : void 0; e.from ? this.getConnection(e.from, "Connection '" + e.from + "' unknow when 'onNewMessage'. Existing remote connections: " + JSON.stringify(Object.keys(this.remoteConnections)) + ". Existing local connection: " + this.connection.connectionId).then(function (i) { t.ee.emitEvent("signal", [new u.SignalEvent(t, n, e.data, i)]), "signal" !== e.type && t.ee.emitEvent(e.type, [new u.SignalEvent(t, n, e.data, i)]) }).catch(function (e) { console.error(e) }) : (this.ee.emitEvent("signal", [new u.SignalEvent(this, n, e.data, void 0)]), "signal" !== e.type && this.ee.emitEvent(e.type, [new u.SignalEvent(this, n, e.data, void 0)])) }, e.prototype.onStreamPropertyChanged = function (e) { var t = this, n = function (n) { if (n.stream && n.stream.streamId === e.streamId) { var i = n.stream, r = void 0; switch (e.property) { case "audioActive": r = i.audioActive, e.newValue = "true" === e.newValue, i.audioActive = e.newValue; break; case "videoActive": r = i.videoActive, e.newValue = "true" === e.newValue, i.videoActive = e.newValue; break; case "videoDimensions": r = i.videoDimensions, e.newValue = JSON.parse(JSON.parse(e.newValue)), i.videoDimensions = e.newValue; break; case "filter": r = i.filter, e.newValue = Object.keys(e.newValue).length > 0 ? e.newValue : void 0, void 0 !== e.newValue ? (i.filter = new o.Filter(e.newValue.type, e.newValue.options), i.filter.stream = i, e.newValue.lastExecMethod && (i.filter.lastExecMethod = e.newValue.lastExecMethod)) : delete i.filter, e.newValue = i.filter }t.ee.emitEvent("streamPropertyChanged", [new p.StreamPropertyChangedEvent(t, i, e.property, e.newValue, r, e.reason)]), i.streamManager && i.streamManager.emitEvent("streamPropertyChanged", [new p.StreamPropertyChangedEvent(i.streamManager, i, e.property, e.newValue, r, e.reason)]) } else console.error("No stream with streamId '" + e.streamId + "' found for connection '" + e.connectionId + "' on 'streamPropertyChanged' event") }; e.connectionId === this.connection.connectionId ? n(this.connection) : this.getRemoteConnection(e.connectionId, "Remote connection " + e.connectionId + " unknown when 'onStreamPropertyChanged'. Existing remote connections: " + JSON.stringify(Object.keys(this.remoteConnections))).then(function (e) { n(e) }).catch(function (e) { console.error(e) }) }, e.prototype.recvIceCandidate = function (e) { var t = { candidate: e.candidate, component: e.component, foundation: e.foundation, port: e.port, priority: e.priority, protocol: e.protocol, relatedAddress: e.relatedAddress, relatedPort: e.relatedPort, sdpMid: e.sdpMid, sdpMLineIndex: e.sdpMLineIndex, tcpType: e.tcpType, usernameFragment: e.usernameFragment, type: e.type, toJSON: function () { return { candidate: e.candidate } } }; this.getConnection(e.senderConnectionId, "Connection not found for connectionId " + e.senderConnectionId + " owning endpoint " + e.endpointName + ". Ice candidate will be ignored: " + t).then(function (n) { var i = n.stream; i.getWebRtcPeer().addIceCandidate(t).catch(function (t) { console.error("Error adding candidate for " + i.streamId + " stream of endpoint " + e.endpointName + ": " + t) }) }).catch(function (e) { console.error(e) }) }, e.prototype.onSessionClosed = function (e) { console.info("Session closed: " + JSON.stringify(e)); var t = e.sessionId; void 0 !== t ? this.ee.emitEvent("session-closed", [{ session: t }]) : console.warn("Session undefined on session closed", e) }, e.prototype.onLostConnection = function (e) { console.warn("Lost connection in Session " + this.sessionId), this.sessionId && !this.connection.disposed && this.leave(!0, e) }, e.prototype.onRecoveredConnection = function () { console.info("Recovered connection in Session " + this.sessionId), this.reconnectBrokenStreams(), this.ee.emitEvent("reconnected", []) }, e.prototype.onMediaError = function (e) { console.error("Media error: " + JSON.stringify(e)); var t = e.error; t ? this.ee.emitEvent("error-media", [{ error: t }]) : console.warn("Received undefined media error. Params:", e) }, e.prototype.onRecordingStarted = function (e) { this.ee.emitEvent("recordingStarted", [new c.RecordingEvent(this, "recordingStarted", e.id, e.name)]) }, e.prototype.onRecordingStopped = function (e) { this.ee.emitEvent("recordingStopped", [new c.RecordingEvent(this, "recordingStopped", e.id, e.name, e.reason)]) }, e.prototype.onFilterEventDispatched = function (e) { var t = e.connectionId; e.streamId; this.getConnection(t, "No connection found for connectionId " + t).then(function (t) { console.info("Filter event dispatched"); var n = t.stream; n.filter.handlers[e.eventType](new a.FilterEvent(n.filter, e.eventType, e.data)) }) }, e.prototype.reconnectBrokenStreams = function () { console.info("Re-establishing media connections..."); var e = !1; this.connection.stream && this.connection.stream.streamIceConnectionStateBroken() && (console.warn("Re-establishing Publisher " + this.connection.stream.streamId), this.connection.stream.initWebRtcPeerSend(!0), e = !0); for (var t = 0, n = Object.values(this.remoteConnections); t < n.length; t++) { var i = n[t]; i.stream && i.stream.streamIceConnectionStateBroken() && (console.warn("Re-establishing Subscriber " + i.stream.streamId), i.stream.initWebRtcPeerReceive(!0), e = !0) } e || console.info("There were no media streams in need of a reconnection") }, e.prototype.emitEvent = function (e, t) { this.ee.emitEvent(e, t) }, e.prototype.leave = function (e, t) { var n = this; if (e = !!e, console.info("Leaving Session (forced=" + e + ")"), this.connection) { if (this.connection.disposed || e ? this.openvidu.closeWs() : this.openvidu.sendRequest("leaveRoom", function (e, t) { e && console.error(e), n.openvidu.closeWs() }), this.stopPublisherStream(t), !this.connection.disposed) { var i = new d.SessionDisconnectedEvent(this, t); this.ee.emitEvent("sessionDisconnected", [i]), i.callDefaultBehavior() } } else console.warn("You were not connected to the session " + this.sessionId) }, e.prototype.connectAux = function (e) { var t = this; return new Promise(function (n, o) { t.openvidu.startWs(function (r) { if (r) o(r); else { var a = { token: e || "", session: t.sessionId, platform: v.description ? v.description : "unknown", metadata: t.options.metadata ? t.options.metadata : "", secret: t.openvidu.getSecret(), recorder: t.openvidu.getRecorder() }; t.openvidu.sendRequest("joinRoom", a, function (e, r) { if (e) o(e); else { t.capabilities = { subscribe: !0, publish: "SUBSCRIBER" !== t.openvidu.role, forceUnpublish: "MODERATOR" === t.openvidu.role, forceDisconnect: "MODERATOR" === t.openvidu.role }, t.connection = new i.Connection(t), t.connection.connectionId = r.id, t.connection.creationTime = r.createdAt, t.connection.data = r.metadata, t.connection.rpcSessionId = r.sessionId; var a = { connections: new Array, streams: new Array }; r.value.forEach(function (e) { var n = new i.Connection(t, e); t.remoteConnections[n.connectionId] = n, a.connections.push(n), n.stream && (t.remoteStreamsCreated[n.stream.streamId] = !0, a.streams.push(n.stream)) }), t.ee.emitEvent("connectionCreated", [new s.ConnectionEvent(!1, t, "connectionCreated", t.connection, "")]), a.connections.forEach(function (e) { t.ee.emitEvent("connectionCreated", [new s.ConnectionEvent(!1, t, "connectionCreated", e, "")]) }), a.streams.forEach(function (e) { t.ee.emitEvent("streamCreated", [new l.StreamEvent(!1, t, "streamCreated", e, "")]) }), n() } }) } }) }) }, e.prototype.stopPublisherStream = function (e) { this.connection.stream && (this.connection.stream.disposeWebRtcPeer(), this.connection.stream.isLocalStreamPublished && this.connection.stream.ee.emitEvent("local-stream-destroyed", [e])) }, e.prototype.stringClientMetadata = function (e) { return "string" != typeof e ? JSON.stringify(e) : e }, e.prototype.getConnection = function (e, t) { var n = this; return new Promise(function (i, o) { var r = n.remoteConnections[e]; r ? i(r) : n.connection.connectionId === e ? i(n.connection) : o(new f.OpenViduError(f.OpenViduErrorName.GENERIC_ERROR, t)) }) }, e.prototype.getRemoteConnection = function (e, t) { var n = this; return new Promise(function (i, o) { var r = n.remoteConnections[e]; r ? i(r) : o(new f.OpenViduError(f.OpenViduErrorName.GENERIC_ERROR, t)) }) }, e.prototype.processToken = function (e) { var t = e.match(/^(wss?\:)\/\/(([^:\/?#]*)(?:\:([0-9]+))?)([\/]{0,1}[^?#]*)(\?[^#]*|)(#.*|)$/); if (t) { var n = { protocol: t[1], host: t[2], hostname: t[3], port: t[4], pathname: t[5], search: t[6], hash: t[7] }, i = e.split("?"), o = decodeURI(i[1]).split("&").map(function (e) { return e.split("=") }).reduce(function (e, t) { var n = t[0], i = t[1]; return e[n] = i, e }, {}); this.sessionId = o.sessionId; var r = o.secret, s = o.recorder, a = o.coturnIp, c = o.turnUsername, d = o.turnCredential, u = o.role, l = o.webrtcStatsInterval, p = o.version; if (r && (this.openvidu.secret = r), s && (this.openvidu.recorder = !0), c && d) { var f = "stun:" + a + ":3478", h = "turn:" + a + ":3478", m = h + "?transport=tcp"; this.openvidu.iceServers = [{ urls: [f] }, { urls: [h, m], username: c, credential: d }], console.log("STUN/TURN server IP: " + a), console.log("TURN temp credentials [" + c + ":" + d + "]") } u && (this.openvidu.role = u), l && (this.openvidu.webrtcStatsInterval = +l), p && (console.info("openvidu-server version: " + p), p !== this.openvidu.libraryVersion && console.error("OpenVidu Server (" + p + ") and OpenVidu Browser (" + this.openvidu.libraryVersion + ") versions do NOT match. There may be incompatibilities")), this.openvidu.wsUri = "wss://" + n.host + "/openvidu", this.openvidu.httpUri = "https://" + n.host } else console.error('Token "' + e + '" is not valid') }, e }(); n.Session = b }, { "../OpenViduInternal/Enums/OpenViduError": 33, "../OpenViduInternal/Enums/VideoInsertMode": 34, "../OpenViduInternal/Events/ConnectionEvent": 35, "../OpenViduInternal/Events/FilterEvent": 37, "../OpenViduInternal/Events/RecordingEvent": 39, "../OpenViduInternal/Events/SessionDisconnectedEvent": 40, "../OpenViduInternal/Events/SignalEvent": 41, "../OpenViduInternal/Events/StreamEvent": 42, "../OpenViduInternal/Events/StreamPropertyChangedEvent": 44, "./Connection": 23, "./Filter": 24, "./Subscriber": 31, platform: 8, "wolfy87-eventemitter": 20 }], 29: [function (e, t, n) { "use strict"; Object.defineProperty(n, "__esModule", { value: !0 }); var i = e("./Filter"), o = e("./Subscriber"), r = e("../OpenViduInternal/WebRtcPeer/WebRtcPeer"), s = e("../OpenViduInternal/WebRtcStats/WebRtcStats"), a = e("../OpenViduInternal/Events/PublisherSpeakingEvent"), c = e("../OpenViduInternal/Events/StreamManagerEvent"), d = e("../OpenViduInternal/Events/StreamPropertyChangedEvent"), u = e("../OpenViduInternal/Enums/OpenViduError"), l = e("hark"), p = e("wolfy87-eventemitter"), f = e("platform"), h = function () { function e(e, t) { var n = this; this.ee = new p, this.isSubscribeToRemote = !1, this.isLocalStreamReadyToPublish = !1, this.isLocalStreamPublished = !1, this.publishedOnce = !1, this.publisherStartSpeakingEventEnabled = !1, this.publisherStartSpeakingEventEnabledOnce = !1, this.publisherStopSpeakingEventEnabled = !1, this.publisherStopSpeakingEventEnabledOnce = !1, this.volumeChangeEventEnabled = !1, this.volumeChangeEventEnabledOnce = !1, this.session = e, t.hasOwnProperty("id") ? (this.inboundStreamOpts = t, this.streamId = this.inboundStreamOpts.id, this.creationTime = this.inboundStreamOpts.createdAt, this.hasAudio = this.inboundStreamOpts.hasAudio, this.hasVideo = this.inboundStreamOpts.hasVideo, this.hasAudio && (this.audioActive = this.inboundStreamOpts.audioActive), this.hasVideo && (this.videoActive = this.inboundStreamOpts.videoActive, this.typeOfVideo = this.inboundStreamOpts.typeOfVideo ? this.inboundStreamOpts.typeOfVideo : void 0, this.frameRate = -1 === this.inboundStreamOpts.frameRate ? void 0 : this.inboundStreamOpts.frameRate, this.videoDimensions = this.inboundStreamOpts.videoDimensions), this.inboundStreamOpts.filter && Object.keys(this.inboundStreamOpts.filter).length > 0 && (this.inboundStreamOpts.filter.lastExecMethod && 0 === Object.keys(this.inboundStreamOpts.filter.lastExecMethod).length && delete this.inboundStreamOpts.filter.lastExecMethod, this.filter = this.inboundStreamOpts.filter)) : (this.outboundStreamOpts = t, this.hasAudio = this.isSendAudio(), this.hasVideo = this.isSendVideo(), this.hasAudio && (this.audioActive = !!this.outboundStreamOpts.publisherProperties.publishAudio), this.hasVideo && (this.videoActive = !!this.outboundStreamOpts.publisherProperties.publishVideo, this.frameRate = this.outboundStreamOpts.publisherProperties.frameRate, "undefined" != typeof MediaStreamTrack && this.outboundStreamOpts.publisherProperties.videoSource instanceof MediaStreamTrack ? this.typeOfVideo = "CUSTOM" : this.typeOfVideo = this.isSendScreen() ? "SCREEN" : "CAMERA"), this.outboundStreamOpts.publisherProperties.filter && (this.filter = this.outboundStreamOpts.publisherProperties.filter)), this.ee.on("mediastream-updated", function () { n.streamManager.updateMediaStream(n.mediaStream), console.debug("Video srcObject [" + n.mediaStream + "] updated in stream [" + n.streamId + "]") }) } return e.prototype.on = function (e, t) { var n = this; return this.ee.on(e, function (i) { i ? console.info("Event '" + e + "' triggered by stream '" + n.streamId + "'", i) : console.info("Event '" + e + "' triggered by stream '" + n.streamId + "'"), t(i) }), this }, e.prototype.once = function (e, t) { var n = this; return this.ee.once(e, function (i) { i ? console.info("Event '" + e + "' triggered once by stream '" + n.streamId + "'", i) : console.info("Event '" + e + "' triggered once by stream '" + n.streamId + "'"), t(i) }), this }, e.prototype.off = function (e, t) { return t ? this.ee.off(e, t) : this.ee.removeAllListeners(e), this }, e.prototype.applyFilter = function (e, t) { var n = this; return new Promise(function (o, r) { console.info("Applying filter to stream " + n.streamId), "string" != typeof (t = t || {}) && (t = JSON.stringify(t)), n.session.openvidu.sendRequest("applyFilter", { streamId: n.streamId, type: e, options: t }, function (s, a) { if (s) console.error("Error applying filter for Stream " + n.streamId, s), 401 === s.code ? r(new u.OpenViduError(u.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED, "You don't have permissions to apply a filter")) : r(s); else { console.info("Filter successfully applied on Stream " + n.streamId); var c = n.filter; n.filter = new i.Filter(e, t), n.filter.stream = n, n.session.emitEvent("streamPropertyChanged", [new d.StreamPropertyChangedEvent(n.session, n, "filter", n.filter, c, "applyFilter")]), n.streamManager.emitEvent("streamPropertyChanged", [new d.StreamPropertyChangedEvent(n.streamManager, n, "filter", n.filter, c, "applyFilter")]), o(n.filter) } }) }) }, e.prototype.removeFilter = function () { var e = this; return new Promise(function (t, n) { console.info("Removing filter of stream " + e.streamId), e.session.openvidu.sendRequest("removeFilter", { streamId: e.streamId }, function (i, o) { if (i) console.error("Error removing filter for Stream " + e.streamId, i), 401 === i.code ? n(new u.OpenViduError(u.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED, "You don't have permissions to remove a filter")) : n(i); else { console.info("Filter successfully removed from Stream " + e.streamId); var r = e.filter; delete e.filter, e.session.emitEvent("streamPropertyChanged", [new d.StreamPropertyChangedEvent(e.session, e, "filter", e.filter, r, "applyFilter")]), e.streamManager.emitEvent("streamPropertyChanged", [new d.StreamPropertyChangedEvent(e.streamManager, e, "filter", e.filter, r, "applyFilter")]), t() } }) }) }, e.prototype.getRTCPeerConnection = function () { return this.webRtcPeer.pc }, e.prototype.getMediaStream = function () { return this.mediaStream }, e.prototype.setMediaStream = function (e) { this.mediaStream = e }, e.prototype.updateMediaStreamInVideos = function () { this.ee.emitEvent("mediastream-updated", []) }, e.prototype.getWebRtcPeer = function () { return this.webRtcPeer }, e.prototype.subscribeToMyRemote = function (e) { this.isSubscribeToRemote = e }, e.prototype.setOutboundStreamOptions = function (e) { this.outboundStreamOpts = e }, e.prototype.subscribe = function () { var e = this; return new Promise(function (t, n) { e.initWebRtcPeerReceive(!1).then(function () { t() }).catch(function (e) { n(e) }) }) }, e.prototype.publish = function () { var e = this; return new Promise(function (t, n) { e.isLocalStreamReadyToPublish ? e.initWebRtcPeerSend(!1).then(function () { t() }).catch(function (e) { n(e) }) : e.ee.once("stream-ready-to-publish", function () { e.publish().then(function () { t() }).catch(function (e) { n(e) }) }) }) }, e.prototype.disposeWebRtcPeer = function () { this.webRtcPeer && (this.webRtcPeer.dispose(), this.stopWebRtcStats()), console.info((this.outboundStreamOpts ? "Outbound " : "Inbound ") + "WebRTCPeer from 'Stream' with id [" + this.streamId + "] is now closed") }, e.prototype.disposeMediaStream = function () { this.mediaStream && (this.mediaStream.getAudioTracks().forEach(function (e) { e.stop() }), this.mediaStream.getVideoTracks().forEach(function (e) { e.stop() }), delete this.mediaStream), this.localMediaStreamWhenSubscribedToRemote && (this.localMediaStreamWhenSubscribedToRemote.getAudioTracks().forEach(function (e) { e.stop() }), this.localMediaStreamWhenSubscribedToRemote.getVideoTracks().forEach(function (e) { e.stop() }), delete this.localMediaStreamWhenSubscribedToRemote), this.speechEvent && (this.speechEvent.stop && this.speechEvent.stop(), delete this.speechEvent), console.info((this.outboundStreamOpts ? "Local " : "Remote ") + "MediaStream from 'Stream' with id [" + this.streamId + "] is now disposed") }, e.prototype.displayMyRemote = function () { return this.isSubscribeToRemote }, e.prototype.isSendAudio = function () { return !!this.outboundStreamOpts && null !== this.outboundStreamOpts.publisherProperties.audioSource && !1 !== this.outboundStreamOpts.publisherProperties.audioSource }, e.prototype.isSendVideo = function () { return !!this.outboundStreamOpts && null !== this.outboundStreamOpts.publisherProperties.videoSource && !1 !== this.outboundStreamOpts.publisherProperties.videoSource }, e.prototype.isSendScreen = function () { var e = "screen" === this.outboundStreamOpts.publisherProperties.videoSource; return "Electron" === f.name && (e = "string" == typeof this.outboundStreamOpts.publisherProperties.videoSource && this.outboundStreamOpts.publisherProperties.videoSource.startsWith("screen:")), !!this.outboundStreamOpts && e }, e.prototype.enableStartSpeakingEvent = function () { var e = this; this.setSpeechEventIfNotExists(), this.publisherStartSpeakingEventEnabled || (this.publisherStartSpeakingEventEnabled = !0, this.speechEvent.on("speaking", function () { e.session.emitEvent("publisherStartSpeaking", [new a.PublisherSpeakingEvent(e.session, "publisherStartSpeaking", e.connection, e.streamId)]), e.publisherStartSpeakingEventEnabledOnce = !1 })) }, e.prototype.enableOnceStartSpeakingEvent = function () { var e = this; this.setSpeechEventIfNotExists(), this.publisherStartSpeakingEventEnabledOnce || (this.publisherStartSpeakingEventEnabledOnce = !0, this.speechEvent.once("speaking", function () { e.publisherStartSpeakingEventEnabledOnce && e.session.emitEvent("publisherStartSpeaking", [new a.PublisherSpeakingEvent(e.session, "publisherStartSpeaking", e.connection, e.streamId)]), e.disableStartSpeakingEvent(!0) })) }, e.prototype.disableStartSpeakingEvent = function (e) { if (this.speechEvent) { if (this.publisherStartSpeakingEventEnabledOnce = !1, e) { if (this.publisherStartSpeakingEventEnabled) return } else this.publisherStartSpeakingEventEnabled = !1; this.volumeChangeEventEnabled || this.volumeChangeEventEnabledOnce || this.publisherStopSpeakingEventEnabled || this.publisherStopSpeakingEventEnabledOnce ? this.speechEvent.off("speaking") : (this.speechEvent.stop(), delete this.speechEvent) } }, e.prototype.enableStopSpeakingEvent = function () { var e = this; this.setSpeechEventIfNotExists(), this.publisherStopSpeakingEventEnabled || (this.publisherStopSpeakingEventEnabled = !0, this.speechEvent.on("stopped_speaking", function () { e.session.emitEvent("publisherStopSpeaking", [new a.PublisherSpeakingEvent(e.session, "publisherStopSpeaking", e.connection, e.streamId)]), e.publisherStopSpeakingEventEnabledOnce = !1 })) }, e.prototype.enableOnceStopSpeakingEvent = function () { var e = this; this.setSpeechEventIfNotExists(), this.publisherStopSpeakingEventEnabledOnce || (this.publisherStopSpeakingEventEnabledOnce = !0, this.speechEvent.once("stopped_speaking", function () { e.publisherStopSpeakingEventEnabledOnce && e.session.emitEvent("publisherStopSpeaking", [new a.PublisherSpeakingEvent(e.session, "publisherStopSpeaking", e.connection, e.streamId)]), e.disableStopSpeakingEvent(!0) })) }, e.prototype.disableStopSpeakingEvent = function (e) { if (this.speechEvent) { if (this.publisherStopSpeakingEventEnabledOnce = !1, e) { if (this.publisherStopSpeakingEventEnabled) return } else this.publisherStopSpeakingEventEnabled = !1; this.volumeChangeEventEnabled || this.volumeChangeEventEnabledOnce || this.publisherStartSpeakingEventEnabled || this.publisherStartSpeakingEventEnabledOnce ? this.speechEvent.off("stopped_speaking") : (this.speechEvent.stop(), delete this.speechEvent) } }, e.prototype.enableVolumeChangeEvent = function (e) { var t = this; this.setSpeechEventIfNotExists() ? this.volumeChangeEventEnabled && !e || (this.volumeChangeEventEnabled = !0, this.speechEvent.on("volume_change", function (e) { var n = { newValue: e, oldValue: t.speechEvent.oldVolumeValue }; t.speechEvent.oldVolumeValue = e, t.streamManager.emitEvent("streamAudioVolumeChange", [new c.StreamManagerEvent(t.streamManager, "streamAudioVolumeChange", n)]) })) : this.volumeChangeEventEnabled = !0 }, e.prototype.enableOnceVolumeChangeEvent = function (e) { var t = this; this.setSpeechEventIfNotExists() ? this.volumeChangeEventEnabledOnce && !e || (this.volumeChangeEventEnabledOnce = !0, this.speechEvent.once("volume_change", function (e) { var n = { newValue: e, oldValue: t.speechEvent.oldVolumeValue }; t.speechEvent.oldVolumeValue = e, t.disableVolumeChangeEvent(!0), t.streamManager.emitEvent("streamAudioVolumeChange", [new c.StreamManagerEvent(t.streamManager, "streamAudioVolumeChange", n)]) })) : this.volumeChangeEventEnabledOnce = !0 }, e.prototype.disableVolumeChangeEvent = function (e) { if (this.speechEvent) { if (this.volumeChangeEventEnabledOnce = !1, e) { if (this.volumeChangeEventEnabled) return } else this.volumeChangeEventEnabled = !1; this.publisherStartSpeakingEventEnabled || this.publisherStartSpeakingEventEnabledOnce || this.publisherStopSpeakingEventEnabled || this.publisherStopSpeakingEventEnabledOnce ? this.speechEvent.off("volume_change") : (this.speechEvent.stop(), delete this.speechEvent) } }, e.prototype.isLocal = function () { return !this.inboundStreamOpts && !!this.outboundStreamOpts }, e.prototype.getSelectedIceCandidate = function () { var e = this; return new Promise(function (t, n) { e.webRtcStats.getSelectedIceCandidateInfo().then(function (e) { return t(e) }).catch(function (e) { return n(e) }) }) }, e.prototype.getRemoteIceCandidateList = function () { return this.webRtcPeer.remoteCandidatesQueue }, e.prototype.getLocalIceCandidateList = function () { return this.webRtcPeer.localCandidatesQueue }, e.prototype.streamIceConnectionStateBroken = function () { if (!this.getWebRtcPeer() || !this.getRTCPeerConnection()) return !1; if (this.isLocal && this.session.openvidu.advancedConfiguration.forceMediaReconnectionAfterNetworkDrop) return console.warn('OpenVidu Browser advanced configuration option "forceMediaReconnectionAfterNetworkDrop" is enabled. Publisher stream ' + this.streamId + "will force a reconnection"), !0; var e = this.getRTCPeerConnection().iceConnectionState; return "disconnected" === e || "failed" === e }, e.prototype.setSpeechEventIfNotExists = function () { if (this.mediaStream) { if (!this.speechEvent) { var e = this.harkOptions ? this.harkOptions : this.session.openvidu.advancedConfiguration.publisherSpeakingEventsOptions || {}; e.interval = "number" == typeof e.interval ? e.interval : 100, e.threshold = "number" == typeof e.threshold ? e.threshold : -50, this.speechEvent = l(this.mediaStream, e) } return !0 } return !1 }, e.prototype.initWebRtcPeerSend = function (e) { var t = this; return new Promise(function (n, i) { e || t.initHarkEvents(); var o = { audio: t.isSendAudio(), video: t.isSendVideo() }, s = { mediaStream: t.mediaStream, mediaConstraints: o, onicecandidate: t.connection.sendIceCandidate.bind(t.connection), iceServers: t.getIceServersConf(), simulcast: !1 }; e && t.disposeWebRtcPeer(), t.displayMyRemote() ? t.webRtcPeer = new r.WebRtcPeerSendrecv(s) : t.webRtcPeer = new r.WebRtcPeerSendonly(s), t.webRtcPeer.addIceConnectionStateChangeListener("publisher of " + t.connection.connectionId), t.webRtcPeer.generateOffer().then(function (o) { !function (o) { console.debug("Sending SDP offer to publish as " + t.streamId, o); var r, s = e ? "reconnectStream" : "publishVideo"; if (e) r = { stream: t.streamId }; else { var a = ""; t.isSendVideo() && (a = "undefined" != typeof MediaStreamTrack && t.outboundStreamOpts.publisherProperties.videoSource instanceof MediaStreamTrack ? "CUSTOM" : t.isSendScreen() ? "SCREEN" : "CAMERA"), r = { doLoopback: t.displayMyRemote() || !1, hasAudio: t.isSendAudio(), hasVideo: t.isSendVideo(), audioActive: t.audioActive, videoActive: t.videoActive, typeOfVideo: a, frameRate: t.frameRate ? t.frameRate : -1, videoDimensions: JSON.stringify(t.videoDimensions), filter: t.outboundStreamOpts.publisherProperties.filter } } r.sdpOffer = o, t.session.openvidu.sendRequest(s, r, function (o, r) { o ? 401 === o.code ? i(new u.OpenViduError(u.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED, "You don't have permissions to publish")) : i("Error on publishVideo: " + JSON.stringify(o)) : t.webRtcPeer.processAnswer(r.sdpAnswer, !1).then(function () { t.streamId = r.id, t.creationTime = r.createdAt, t.isLocalStreamPublished = !0, t.publishedOnce = !0, t.displayMyRemote() && (t.localMediaStreamWhenSubscribedToRemote = t.mediaStream, t.remotePeerSuccessfullyEstablished()), e ? t.ee.emitEvent("stream-reconnected-by-publisher", []) : t.ee.emitEvent("stream-created-by-publisher", []), t.initWebRtcStats(), console.info("'Publisher' (" + t.streamId + ") successfully " + (e ? "reconnected" : "published") + " to session"), n() }).catch(function (e) { i(e) }) }) }(o) }).catch(function (e) { i(new Error("(publish) SDP offer error: " + JSON.stringify(e))) }) }) }, e.prototype.initWebRtcPeerReceive = function (e) { var t = this; return new Promise(function (n, i) { var o = { audio: t.inboundStreamOpts.hasAudio, video: t.inboundStreamOpts.hasVideo }; console.debug("'Session.subscribe(Stream)' called. Constraints of generate SDP offer", o); var s = { onicecandidate: t.connection.sendIceCandidate.bind(t.connection), mediaConstraints: o, iceServers: t.getIceServersConf(), simulcast: !1 }; t.webRtcPeer = new r.WebRtcPeerRecvonly(s), t.webRtcPeer.addIceConnectionStateChangeListener(t.streamId), t.webRtcPeer.generateOffer().then(function (o) { !function (o) { console.debug("Sending SDP offer to subscribe to " + t.streamId, o); var r = e ? "reconnectStream" : "receiveVideoFrom", s = { sdpOffer: o }; s[e ? "stream" : "sender"] = t.streamId, t.session.openvidu.sendRequest(r, s, function (o, r) { if (o) i(new Error("Error on recvVideoFrom: " + JSON.stringify(o))); else { t.session.isFirstIonicIosSubscriber && (t.session.isFirstIonicIosSubscriber = !1, setTimeout(function () { t.session.countDownForIonicIosSubscribersActive = !1 }, 400)); var s = t.session.countDownForIonicIosSubscribersActive; t.webRtcPeer.processAnswer(r.sdpAnswer, s).then(function () { console.info("'Subscriber' (" + t.streamId + ") successfully " + (e ? "reconnected" : "subscribed")), t.remotePeerSuccessfullyEstablished(), t.initWebRtcStats(), n() }).catch(function (e) { i(e) }) } }) }(o) }).catch(function (e) { i(new Error("(subscribe) SDP offer error: " + JSON.stringify(e))) }) }) }, e.prototype.remotePeerSuccessfullyEstablished = function () { if (f.isIonicIos) { var e = this.webRtcPeer.pc; this.mediaStream = e.getRemoteStreams()[0] } else { this.mediaStream = new MediaStream; for (var t = void 0, n = 0, i = this.webRtcPeer.pc.getReceivers(); n < i.length; n++)(t = i[n]).track && this.mediaStream.addTrack(t.track) } if (console.debug("Peer remote stream", this.mediaStream), this.mediaStream) { if (this.streamManager instanceof o.Subscriber) { if (this.mediaStream.getAudioTracks()[0]) { var r = !!this.streamManager.properties.subscribeToAudio; this.mediaStream.getAudioTracks()[0].enabled = r } if (this.mediaStream.getVideoTracks()[0]) { r = !!this.streamManager.properties.subscribeToVideo; this.mediaStream.getVideoTracks()[0].enabled = r } } this.updateMediaStreamInVideos(), this.initHarkEvents() } }, e.prototype.initHarkEvents = function () { this.mediaStream.getAudioTracks()[0] && (this.streamManager.remote && (this.session.startSpeakingEventsEnabled && this.enableStartSpeakingEvent(), this.session.startSpeakingEventsEnabledOnce && this.enableOnceStartSpeakingEvent(), this.session.stopSpeakingEventsEnabled && this.enableStopSpeakingEvent(), this.session.stopSpeakingEventsEnabledOnce && this.enableOnceStopSpeakingEvent()), this.volumeChangeEventEnabled && this.enableVolumeChangeEvent(!0), this.volumeChangeEventEnabledOnce && this.enableOnceVolumeChangeEvent(!0)) }, e.prototype.initWebRtcStats = function () { this.webRtcStats = new s.WebRtcStats(this), this.webRtcStats.initWebRtcStats() }, e.prototype.stopWebRtcStats = function () { this.webRtcStats && this.webRtcStats.isEnabled() && this.webRtcStats.stopWebRtcStats() }, e.prototype.getIceServersConf = function () { return this.session.openvidu.advancedConfiguration.iceServers ? "freeice" === this.session.openvidu.advancedConfiguration.iceServers ? void 0 : this.session.openvidu.advancedConfiguration.iceServers : this.session.openvidu.iceServers ? this.session.openvidu.iceServers : void 0 }, e.prototype.gatherStatsForPeer = function () { var e = this; return new Promise(function (t, n) { e.isLocal() ? e.getRTCPeerConnection().getSenders().forEach(function (t) { return t.getStats().then(function (t) { t.forEach(function (t) { if (e.isReportWanted(t)) { var n = {}; n.type = t.type, n.timestamp = t.timestamp, n.id = t.id, "outbound-rtp" === t.type && (n.ssrc = t.ssrc, n.firCount = t.firCount, n.pliCount = t.pliCount, n.nackCount = t.nackCount, n.qpSum = t.qpSum, t.kind ? n.mediaType = t.kind : t.mediaType ? n.mediaType = t.mediaType : n.mediaType = -1 !== t.id.indexOf("VideoStream") ? "video" : "audio", "video" === n.mediaType && (n.framesEncoded = t.framesEncoded), n.packetsSent = t.packetsSent, n.bytesSent = t.bytesSent), "candidate-pair" === t.type && void 0 !== t.totalRoundTripTime && (n.availableOutgoingBitrate = t.availableOutgoingBitrate, n.rtt = t.currentRoundTripTime, n.averageRtt = t.totalRoundTripTime / t.responsesReceived), "remote-inbound-rtp" === t.type || t.type, console.log(n) } }) }) }) : e.getRTCPeerConnection().getReceivers().forEach(function (t) { return t.getStats().then(function (t) { t.forEach(function (t) { if (e.isReportWanted(t)) { var n = {}; n.type = t.type, n.timestamp = t.timestamp, n.id = t.id, "inbound-rtp" === t.type && (n.ssrc = t.ssrc, n.firCount = t.firCount, n.pliCount = t.pliCount, n.nackCount = t.nackCount, n.qpSum = t.qpSum, t.kind ? n.mediaType = t.kind : t.mediaType ? n.mediaType = t.mediaType : n.mediaType = -1 !== t.id.indexOf("VideoStream") ? "video" : "audio", "video" === n.mediaType && (n.framesDecoded = t.framesDecoded), n.packetsReceived = t.packetsReceived, n.packetsLost = t.packetsLost, n.jitter = t.jitter, n.bytesReceived = t.bytesReceived), "candidate-pair" === t.type && void 0 !== t.totalRoundTripTime && (n.availableIncomingBitrate = t.availableIncomingBitrate, n.rtt = t.currentRoundTripTime, n.averageRtt = t.totalRoundTripTime / t.responsesReceived), "remote-inbound-rtp" === t.type || t.type, console.log(n) } }) }) }) }) }, e.prototype.isReportWanted = function (e) { return "inbound-rtp" === e.type && !this.isLocal() || "outbound-rtp" === e.type && this.isLocal() || "candidate-pair" === e.type && e.nominated && e.bytesSent > 0 }, e }(); n.Stream = h }, { "../OpenViduInternal/Enums/OpenViduError": 33, "../OpenViduInternal/Events/PublisherSpeakingEvent": 38, "../OpenViduInternal/Events/StreamManagerEvent": 43, "../OpenViduInternal/Events/StreamPropertyChangedEvent": 44, "../OpenViduInternal/WebRtcPeer/WebRtcPeer": 57, "../OpenViduInternal/WebRtcStats/WebRtcStats": 58, "./Filter": 24, "./Subscriber": 31, hark: 5, platform: 8, "wolfy87-eventemitter": 20 }], 30: [function (e, t, n) { "use strict"; Object.defineProperty(n, "__esModule", { value: !0 }); var i = e("../OpenViduInternal/Events/StreamManagerEvent"), o = e("../OpenViduInternal/Events/VideoElementEvent"), r = e("../OpenViduInternal/Enums/VideoInsertMode"), s = e("wolfy87-eventemitter"), a = e("platform"), c = function () { function e(e, t) { var n = this; if (this.videos = [], this.lazyLaunchVideoElementCreatedEvent = !1, this.ee = new s, this.stream = e, this.stream.streamManager = this, this.remote = !this.stream.isLocal(), t) { var r = void 0; "string" == typeof t ? r = document.getElementById(t) : t instanceof HTMLElement && (r = t), r && (this.firstVideoElement = { targetElement: r, video: document.createElement("video"), id: "", canplayListenerAdded: !1 }, "Safari" === a.name && this.firstVideoElement.video.setAttribute("playsinline", "true"), this.targetElement = r, this.element = r) } this.canPlayListener = function () { n.stream.isLocal() ? n.stream.displayMyRemote() ? (console.info("Your own remote 'Stream' with id [" + n.stream.streamId + "] video is now playing"), n.ee.emitEvent("remoteVideoPlaying", [new o.VideoElementEvent(n.videos[0].video, n, "remoteVideoPlaying")])) : (console.info("Your local 'Stream' with id [" + n.stream.streamId + "] video is now playing"), n.ee.emitEvent("videoPlaying", [new o.VideoElementEvent(n.videos[0].video, n, "videoPlaying")])) : (console.info("Remote 'Stream' with id [" + n.stream.streamId + "] video is now playing"), n.ee.emitEvent("videoPlaying", [new o.VideoElementEvent(n.videos[0].video, n, "videoPlaying")])), n.ee.emitEvent("streamPlaying", [new i.StreamManagerEvent(n, "streamPlaying", void 0)]) } } return e.prototype.on = function (e, t) { var n = this; return this.ee.on(e, function (i) { i ? console.info("Event '" + e + "' triggered by '" + (n.remote ? "Subscriber" : "Publisher") + "'", i) : console.info("Event '" + e + "' triggered by '" + (n.remote ? "Subscriber" : "Publisher") + "'"), t(i) }), "videoElementCreated" === e && this.stream && this.lazyLaunchVideoElementCreatedEvent && (this.ee.emitEvent("videoElementCreated", [new o.VideoElementEvent(this.videos[0].video, this, "videoElementCreated")]), this.lazyLaunchVideoElementCreatedEvent = !1), "streamPlaying" !== e && "videoPlaying" !== e || this.videos[0] && this.videos[0].video && this.videos[0].video.currentTime > 0 && !1 === this.videos[0].video.paused && !1 === this.videos[0].video.ended && 4 === this.videos[0].video.readyState && (this.ee.emitEvent("streamPlaying", [new i.StreamManagerEvent(this, "streamPlaying", void 0)]), this.ee.emitEvent("videoPlaying", [new o.VideoElementEvent(this.videos[0].video, this, "videoPlaying")])), "streamAudioVolumeChange" === e && this.stream.hasAudio && this.stream.enableVolumeChangeEvent(!1), this }, e.prototype.once = function (e, t) { var n = this; return this.ee.once(e, function (i) { i ? console.info("Event '" + e + "' triggered once by '" + (n.remote ? "Subscriber" : "Publisher") + "'", i) : console.info("Event '" + e + "' triggered once by '" + (n.remote ? "Subscriber" : "Publisher") + "'"), t(i) }), "videoElementCreated" === e && this.stream && this.lazyLaunchVideoElementCreatedEvent && this.ee.emitEvent("videoElementCreated", [new o.VideoElementEvent(this.videos[0].video, this, "videoElementCreated")]), "streamPlaying" !== e && "videoPlaying" !== e || this.videos[0] && this.videos[0].video && this.videos[0].video.currentTime > 0 && !1 === this.videos[0].video.paused && !1 === this.videos[0].video.ended && 4 === this.videos[0].video.readyState && (this.ee.emitEvent("streamPlaying", [new i.StreamManagerEvent(this, "streamPlaying", void 0)]), this.ee.emitEvent("videoPlaying", [new o.VideoElementEvent(this.videos[0].video, this, "videoPlaying")])), "streamAudioVolumeChange" === e && this.stream.hasAudio && this.stream.enableOnceVolumeChangeEvent(!1), this }, e.prototype.off = function (e, t) { (t ? this.ee.off(e, t) : this.ee.removeAllListeners(e), "streamAudioVolumeChange" === e) && (0 === this.ee.getListeners(e).length && this.stream.disableVolumeChangeEvent(!1)); return this }, e.prototype.addVideoElement = function (e) { this.initializeVideoProperties(e), this.stream.isLocal() && this.stream.displayMyRemote() && e.srcObject !== this.stream.getMediaStream() && (e.srcObject = this.stream.getMediaStream()); for (var t = 0, n = this.videos; t < n.length; t++) { if (n[t].video === e) return 0 } for (var i = 1, o = 0, r = this.stream.session.streamManagers; o < r.length; o++) { if (r[o].disassociateVideo(e)) { i = -1; break } } return this.stream.session.streamManagers.forEach(function (t) { t.disassociateVideo(e) }), this.pushNewStreamManagerVideo({ video: e, id: e.id, canplayListenerAdded: !1 }), console.info("New video element associated to ", this), i }, e.prototype.createVideoElement = function (e, t) { var n; if ("string" == typeof e) { if (!(n = document.getElementById(e))) throw new Error("The provided 'targetElement' couldn't be resolved to any HTML element: " + e) } else { if (!(e instanceof HTMLElement)) throw new Error("The provided 'targetElement' couldn't be resolved to any HTML element: " + e); n = e } var i, s = document.createElement("video"); if (i = t || r.VideoInsertMode.APPEND, this.initializeVideoProperties(s), "SCREEN" != this.stream.typeOfVideo) { var a = document.createElement("div"); a.style.display = s.style.display, a.className = "videoItemPanel", a.id = "videoItemPanel_" + s.id, a.appendChild(s), n.appendChild(a) } else s.style.width = "100%", n.appendChild(s); var c = { targetElement: n, video: s, insertMode: i, id: s.id, canplayListenerAdded: !1 }; return this.pushNewStreamManagerVideo(c), this.ee.emitEvent("videoElementCreated", [new o.VideoElementEvent(c.video, this, "videoElementCreated")]), this.lazyLaunchVideoElementCreatedEvent = !!this.firstVideoElement, s }, e.prototype.updatePublisherSpeakingEventsOptions = function (e) { var t = this.stream.harkOptions ? this.stream.harkOptions : this.stream.session.openvidu.advancedConfiguration.publisherSpeakingEventsOptions || {}, n = "number" == typeof e.interval ? e.interval : "number" == typeof t.interval ? t.interval : 100, i = "number" == typeof e.threshold ? e.threshold : "number" == typeof t.threshold ? t.threshold : -50; this.stream.harkOptions = { interval: n, threshold: i }, this.stream.speechEvent && (this.stream.speechEvent.setInterval(n), this.stream.speechEvent.setThreshold(i)) }, e.prototype.initializeVideoProperties = function (e) { this.stream.isLocal() && this.stream.displayMyRemote() || e.srcObject !== this.stream.getMediaStream() && (e.srcObject = this.stream.getMediaStream()), e.autoplay = !0, e.controls = !1, "SCREEN" != this.stream.typeOfVideo && (e.className = "videoItem"); var t = this.stream.videoActive; console.log(t), e.style.display = t ? "block" : "none", "Safari" === a.name && e.setAttribute("playsinline", "true"), e.id || (e.id = (this.remote ? "remote-" : "local-") + "video-" + this.stream.streamId, !this.id && this.targetElement && (this.id = e.id)), this.remote || this.stream.displayMyRemote() || (e.muted = !0, "rotateY(180deg)" !== e.style.transform || this.stream.outboundStreamOpts.publisherProperties.mirror ? this.stream.outboundStreamOpts.publisherProperties.mirror && !this.stream.isSendScreen() && this.mirrorVideo(e) : this.removeMirrorVideo(e)) }, e.prototype.removeAllVideos = function () { var e = this, t = !1; "SCREEN" == this.stream.typeOfVideo && (t = !0); for (var n = this.stream.session.streamManagers.length - 1; n >= 0; --n)this.stream.session.streamManagers[n] === this && this.stream.session.streamManagers.splice(n, 1); this.videos.forEach(function (n) { n.video.removeEventListener("canplay", e.canPlayListener), n.canplayListenerAdded = !1, n.targetElement && (console.warn("aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"), t ? n.video.parentNode.removeChild(n.video) : n.video.parentNode.parentNode.removeChild(n.video.parentNode), e.ee.emitEvent("videoElementDestroyed", [new o.VideoElementEvent(n.video, e, "videoElementDestroyed")])), n.video.srcObject = null, e.videos.filter(function (e) { return !e.targetElement }) }) }, e.prototype.disassociateVideo = function (e) { for (var t = !1, n = 0; n < this.videos.length; n++)if (this.videos[n].video === e) { this.videos[n].video.removeEventListener("canplay", this.canPlayListener), this.videos.splice(n, 1), t = !0, console.info("Video element disassociated from ", this); break } return t }, e.prototype.addPlayEventToFirstVideo = function () { this.videos[0] && this.videos[0].video && !this.videos[0].canplayListenerAdded && (this.videos[0].video.addEventListener("canplay", this.canPlayListener), this.videos[0].canplayListenerAdded = !0) }, e.prototype.updateMediaStream = function (e) { this.videos.forEach(function (t) { if (t.video.srcObject = e, a.isIonicIos) { var n = t.video.parentElement, i = t.video; n.replaceChild(i, t.video), t.video = i } }) }, e.prototype.emitEvent = function (e, t) { this.ee.emitEvent(e, t) }, e.prototype.pushNewStreamManagerVideo = function (e) { this.videos.push(e), this.addPlayEventToFirstVideo(), -1 === this.stream.session.streamManagers.indexOf(this) && this.stream.session.streamManagers.push(this) }, e.prototype.mirrorVideo = function (e) { a.isIonicIos || (e.style.transform = "rotateY(180deg)", e.style.webkitTransform = "rotateY(180deg)") }, e.prototype.removeMirrorVideo = function (e) { e.style.transform = "unset", e.style.webkitTransform = "unset" }, e }(); n.StreamManager = c }, { "../OpenViduInternal/Enums/VideoInsertMode": 34, "../OpenViduInternal/Events/StreamManagerEvent": 43, "../OpenViduInternal/Events/VideoElementEvent": 45, platform: 8, "wolfy87-eventemitter": 20 }], 31: [function (e, t, n) { "use strict"; var i, o = this && this.__extends || (i = function (e, t) { return (i = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var n in t) t.hasOwnProperty(n) && (e[n] = t[n]) })(e, t) }, function (e, t) { function n() { this.constructor = e } i(e, t), e.prototype = null === t ? Object.create(t) : (n.prototype = t.prototype, new n) }); Object.defineProperty(n, "__esModule", { value: !0 }); var r = function (e) { function t(t, n, i) { var o = e.call(this, t, n) || this; return o.element = o.targetElement, o.stream = t, o.properties = i, o } return o(t, e), t.prototype.subscribeToAudio = function (e) { return this.stream.getMediaStream().getAudioTracks().forEach(function (t) { t.enabled = e }), console.info("'Subscriber' has " + (e ? "subscribed to" : "unsubscribed from") + " its audio stream"), this }, t.prototype.subscribeToVideo = function (e) { return this.stream.getMediaStream().getVideoTracks().forEach(function (t) { t.enabled = e }), console.info("'Subscriber' has " + (e ? "subscribed to" : "unsubscribed from") + " its video stream"), this }, t }(e("./StreamManager").StreamManager); n.Subscriber = r }, { "./StreamManager": 30 }], 32: [function (e, t, n) { "use strict"; Object.defineProperty(n, "__esModule", { value: !0 }), function (e) { e.READY = "READY", e.RECORDING = "RECORDING", e.PAUSED = "PAUSED", e.FINISHED = "FINISHED" }(n.LocalRecorderState || (n.LocalRecorderState = {})) }, {}], 33: [function (e, t, n) { "use strict"; Object.defineProperty(n, "__esModule", { value: !0 }), function (e) { e.BROWSER_NOT_SUPPORTED = "BROWSER_NOT_SUPPORTED", e.DEVICE_ACCESS_DENIED = "DEVICE_ACCESS_DENIED", e.DEVICE_ALREADY_IN_USE = "DEVICE_ALREADY_IN_USE", e.SCREEN_CAPTURE_DENIED = "SCREEN_CAPTURE_DENIED", e.SCREEN_SHARING_NOT_SUPPORTED = "SCREEN_SHARING_NOT_SUPPORTED", e.SCREEN_EXTENSION_NOT_INSTALLED = "SCREEN_EXTENSION_NOT_INSTALLED", e.SCREEN_EXTENSION_DISABLED = "SCREEN_EXTENSION_DISABLED", e.INPUT_VIDEO_DEVICE_NOT_FOUND = "INPUT_VIDEO_DEVICE_NOT_FOUND", e.INPUT_AUDIO_DEVICE_NOT_FOUND = "INPUT_AUDIO_DEVICE_NOT_FOUND", e.INPUT_AUDIO_DEVICE_GENERIC_ERROR = "INPUT_AUDIO_DEVICE_GENERIC_ERROR", e.NO_INPUT_SOURCE_SET = "NO_INPUT_SOURCE_SET", e.PUBLISHER_PROPERTIES_ERROR = "PUBLISHER_PROPERTIES_ERROR", e.OPENVIDU_PERMISSION_DENIED = "OPENVIDU_PERMISSION_DENIED", e.OPENVIDU_NOT_CONNECTED = "OPENVIDU_NOT_CONNECTED", e.GENERIC_ERROR = "GENERIC_ERROR" }(n.OpenViduErrorName || (n.OpenViduErrorName = {})); var i = function () { return function (e, t) { this.name = e, this.message = t } }(); n.OpenViduError = i }, {}], 34: [function (e, t, n) { "use strict"; Object.defineProperty(n, "__esModule", { value: !0 }), function (e) { e.AFTER = "AFTER", e.APPEND = "APPEND", e.BEFORE = "BEFORE", e.PREPEND = "PREPEND", e.REPLACE = "REPLACE" }(n.VideoInsertMode || (n.VideoInsertMode = {})) }, {}], 35: [function (e, t, n) { "use strict"; var i, o = this && this.__extends || (i = function (e, t) { return (i = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var n in t) t.hasOwnProperty(n) && (e[n] = t[n]) })(e, t) }, function (e, t) { function n() { this.constructor = e } i(e, t), e.prototype = null === t ? Object.create(t) : (n.prototype = t.prototype, new n) }); Object.defineProperty(n, "__esModule", { value: !0 }); var r = function (e) { function t(t, n, i, o, r) { var s = e.call(this, t, n, i) || this; return s.connection = o, s.reason = r, s } return o(t, e), t.prototype.callDefaultBehavior = function () { }, t }(e("./Event").Event); n.ConnectionEvent = r }, { "./Event": 36 }], 36: [function (e, t, n) { "use strict"; Object.defineProperty(n, "__esModule", { value: !0 }); var i = function () { function e(e, t, n) { this.hasBeenPrevented = !1, this.cancelable = e, this.target = t, this.type = n } return e.prototype.isDefaultPrevented = function () { return this.hasBeenPrevented }, e.prototype.preventDefault = function () { this.callDefaultBehavior = function () { }, this.hasBeenPrevented = !0 }, e }(); n.Event = i }, {}], 37: [function (e, t, n) { "use strict"; var i, o = this && this.__extends || (i = function (e, t) { return (i = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var n in t) t.hasOwnProperty(n) && (e[n] = t[n]) })(e, t) }, function (e, t) { function n() { this.constructor = e } i(e, t), e.prototype = null === t ? Object.create(t) : (n.prototype = t.prototype, new n) }); Object.defineProperty(n, "__esModule", { value: !0 }); var r = function (e) { function t(t, n, i) { var o = e.call(this, !1, t, n) || this; return o.data = i, o } return o(t, e), t.prototype.callDefaultBehavior = function () { }, t }(e("./Event").Event); n.FilterEvent = r }, { "./Event": 36 }], 38: [function (e, t, n) { "use strict"; var i, o = this && this.__extends || (i = function (e, t) { return (i = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var n in t) t.hasOwnProperty(n) && (e[n] = t[n]) })(e, t) }, function (e, t) { function n() { this.constructor = e } i(e, t), e.prototype = null === t ? Object.create(t) : (n.prototype = t.prototype, new n) }); Object.defineProperty(n, "__esModule", { value: !0 }); var r = function (e) { function t(t, n, i, o) { var r = e.call(this, !1, t, n) || this; return r.type = n, r.connection = i, r.streamId = o, r } return o(t, e), t.prototype.callDefaultBehavior = function () { }, t }(e("./Event").Event); n.PublisherSpeakingEvent = r }, { "./Event": 36 }], 39: [function (e, t, n) { "use strict"; var i, o = this && this.__extends || (i = function (e, t) { return (i = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var n in t) t.hasOwnProperty(n) && (e[n] = t[n]) })(e, t) }, function (e, t) { function n() { this.constructor = e } i(e, t), e.prototype = null === t ? Object.create(t) : (n.prototype = t.prototype, new n) }); Object.defineProperty(n, "__esModule", { value: !0 }); var r = function (e) { function t(t, n, i, o, r) { var s = e.call(this, !1, t, n) || this; return s.id = i, o !== i && (s.name = o), s.reason = r, s } return o(t, e), t.prototype.callDefaultBehavior = function () { }, t }(e("./Event").Event); n.RecordingEvent = r }, { "./Event": 36 }], 40: [function (e, t, n) { "use strict"; var i, o = this && this.__extends || (i = function (e, t) { return (i = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var n in t) t.hasOwnProperty(n) && (e[n] = t[n]) })(e, t) }, function (e, t) { function n() { this.constructor = e } i(e, t), e.prototype = null === t ? Object.create(t) : (n.prototype = t.prototype, new n) }); Object.defineProperty(n, "__esModule", { value: !0 }); var r = function (e) { function t(t, n) { var i = e.call(this, !0, t, "sessionDisconnected") || this; return i.reason = n, i } return o(t, e), t.prototype.callDefaultBehavior = function () { console.info("Calling default behavior upon '" + this.type + "' event dispatched by 'Session'"); var e = this.target; for (var t in e.remoteConnections) e.remoteConnections[t].stream && (e.remoteConnections[t].stream.disposeWebRtcPeer(), e.remoteConnections[t].stream.disposeMediaStream(), e.remoteConnections[t].stream.streamManager && e.remoteConnections[t].stream.streamManager.removeAllVideos(), delete e.remoteStreamsCreated[e.remoteConnections[t].stream.streamId], e.remoteConnections[t].dispose()), delete e.remoteConnections[t] }, t }(e("./Event").Event); n.SessionDisconnectedEvent = r }, { "./Event": 36 }], 41: [function (e, t, n) { "use strict"; var i, o = this && this.__extends || (i = function (e, t) { return (i = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var n in t) t.hasOwnProperty(n) && (e[n] = t[n]) })(e, t) }, function (e, t) { function n() { this.constructor = e } i(e, t), e.prototype = null === t ? Object.create(t) : (n.prototype = t.prototype, new n) }); Object.defineProperty(n, "__esModule", { value: !0 }); var r = function (e) { function t(t, n, i, o) { var r = e.call(this, !1, t, "signal") || this; return n && (r.type = "signal:" + n), r.data = i, r.from = o, r } return o(t, e), t.prototype.callDefaultBehavior = function () { }, t }(e("./Event").Event); n.SignalEvent = r }, { "./Event": 36 }], 42: [function (e, t, n) { "use strict"; var i, o = this && this.__extends || (i = function (e, t) { return (i = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var n in t) t.hasOwnProperty(n) && (e[n] = t[n]) })(e, t) }, function (e, t) { function n() { this.constructor = e } i(e, t), e.prototype = null === t ? Object.create(t) : (n.prototype = t.prototype, new n) }); Object.defineProperty(n, "__esModule", { value: !0 }); var r = e("./Event"), s = e("../../OpenVidu/Publisher"), a = e("../../OpenVidu/Session"), c = function (e) { function t(t, n, i, o, r) { var s = e.call(this, t, n, i) || this; return s.stream = o, s.reason = r, s } return o(t, e), t.prototype.callDefaultBehavior = function () { if ("streamDestroyed" === this.type) { if (this.target instanceof a.Session) console.info("Calling default behavior upon '" + this.type + "' event dispatched by 'Session'"), this.stream.disposeWebRtcPeer(); else if (this.target instanceof s.Publisher) { console.info("Calling default behavior upon '" + this.type + "' event dispatched by 'Publisher'"), clearInterval(this.target.screenShareResizeInterval), this.stream.isLocalStreamReadyToPublish = !1; for (var e = this.target.openvidu.publishers, t = 0; t < e.length; t++)if (e[t] === this.target) { e.splice(t, 1); break } } this.stream.disposeMediaStream(), this.stream.streamManager && this.stream.streamManager.removeAllVideos(), delete this.stream.session.remoteStreamsCreated[this.stream.streamId]; var n = this.stream.session.remoteConnections[this.stream.connection.connectionId]; if (n && n.options) { var i = n.options.streams; for (t = i.length - 1; t >= 0; --t)i[t].id === this.stream.streamId && i.splice(t, 1) } } }, t }(r.Event); n.StreamEvent = c }, { "../../OpenVidu/Publisher": 27, "../../OpenVidu/Session": 28, "./Event": 36 }], 43: [function (e, t, n) { "use strict"; var i, o = this && this.__extends || (i = function (e, t) { return (i = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var n in t) t.hasOwnProperty(n) && (e[n] = t[n]) })(e, t) }, function (e, t) { function n() { this.constructor = e } i(e, t), e.prototype = null === t ? Object.create(t) : (n.prototype = t.prototype, new n) }); Object.defineProperty(n, "__esModule", { value: !0 }); var r = function (e) { function t(t, n, i) { var o = e.call(this, !1, t, n) || this; return o.value = i, o } return o(t, e), t.prototype.callDefaultBehavior = function () { }, t }(e("./Event").Event); n.StreamManagerEvent = r }, { "./Event": 36 }], 44: [function (e, t, n) { "use strict"; var i, o = this && this.__extends || (i = function (e, t) { return (i = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var n in t) t.hasOwnProperty(n) && (e[n] = t[n]) })(e, t) }, function (e, t) { function n() { this.constructor = e } i(e, t), e.prototype = null === t ? Object.create(t) : (n.prototype = t.prototype, new n) }); Object.defineProperty(n, "__esModule", { value: !0 }); var r = function (e) { function t(t, n, i, o, r, s) { var a = e.call(this, !1, t, "streamPropertyChanged") || this; return a.stream = n, a.changedProperty = i, a.newValue = o, a.oldValue = r, a.reason = s, a } return o(t, e), t.prototype.callDefaultBehavior = function () { }, t }(e("./Event").Event); n.StreamPropertyChangedEvent = r }, { "./Event": 36 }], 45: [function (e, t, n) { "use strict"; var i, o = this && this.__extends || (i = function (e, t) { return (i = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var n in t) t.hasOwnProperty(n) && (e[n] = t[n]) })(e, t) }, function (e, t) { function n() { this.constructor = e } i(e, t), e.prototype = null === t ? Object.create(t) : (n.prototype = t.prototype, new n) }); Object.defineProperty(n, "__esModule", { value: !0 }); var r = function (e) { function t(t, n, i) { var o = e.call(this, !1, n, i) || this; return o.element = t, o } return o(t, e), t.prototype.callDefaultBehavior = function () { }, t }(e("./Event").Event); n.VideoElementEvent = r }, { "./Event": 36 }], 46: [function (e, t, n) { function i() { var e = {}; this.forEach = function (t) { for (var n in e) { var i = e[n]; for (var o in i) t(i[o]) } }, this.get = function (t, n) { var i = e[n]; if (null != i) return i[t] }, this.remove = function (t, n) { var i = e[n]; if (null != i) { for (var o in delete i[t], i) return !1; delete e[n] } }, this.set = function (t, n, i) { if (null == t) return this.remove(n, i); var o = e[i]; null == o && (e[i] = o = {}), o[n] = t } } i.prototype.pop = function (e, t) { var n = this.get(e, t); if (null != n) return this.remove(e, t), n }, t.exports = i }, {}], 47: [function (e, t, n) { var i = e("./jsonrpcclient"); n.JsonRpcClient = i }, { "./jsonrpcclient": 48 }], 48: [function (e, t, n) { var i = e("../"), o = e("./transports/webSocketWithReconnection"); Date.now = Date.now || function () { return +new Date }; var r = 5e3, s = "RECONNECTING", a = "CONNECTED", c = "DISCONNECTED", d = console; t.exports = function (e) { var t, n = this, u = e.ws, l = -1, p = 0, f = !0, h = !1, m = c, v = u.onreconnecting, b = u.onreconnected, E = u.onconnected, g = u.onerror; e.rpc.pull = function (e, t) { t.reply(null, "push") }, u.onreconnecting = function () { d.debug("--------- ONRECONNECTING -----------"), m !== s ? (C(), m = s, v && v()) : d.error("Websocket already in RECONNECTING state when receiving a new ONRECONNECTING message. Ignoring it") }, u.onreconnected = function () { d.debug("--------- ONRECONNECTED -----------"), m !== a ? (m = a, O(), b && b()) : d.error("Websocket already in CONNECTED state when receiving a new ONRECONNECTED message. Ignoring it") }, u.onconnected = function () { d.debug("--------- ONCONNECTED -----------"), m !== a ? (m = a, f = !0, I(), E && E()) : d.error("Websocket already in CONNECTED state when receiving a new ONCONNECTED message. Ignoring it") }, u.onerror = function (e) { d.debug("--------- ONERROR -----------"), m = c, C(), g && g(e) }; var S = new o(u); d.debug("Connecting websocket to URI: " + u.uri); var y = { request_timeout: e.rpc.requestTimeout, ping_request_timeout: e.rpc.heartbeatRequestTimeout }, w = new i(i.packers.JsonRPC, y, S, function (t) { d.debug("Received request: " + JSON.stringify(t)); try { var n = e.rpc[t.method]; void 0 === n ? d.error("Method " + t.method + " not registered in client") : n(t.params, t) } catch (e) { d.error("Exception processing request: " + JSON.stringify(t)), d.error(e) } }); function O() { d.debug("notReconnectIfNumLessThan = " + p + " (old=" + l + ")"), l = p } function R() { if (f) { var t = null; 0 != p && p != l || (t = { interval: e.heartbeat || r }), p++, n.send("ping", t, (i = p, function (e, t) { e && (d.debug("Error in ping request #" + i + " (" + e.message + ")"), i > l && (f = !1, O(), d.debug("Server did not respond to ping message #" + i + ". Reconnecting... "), S.reconnectWs())) })) } else d.debug("Trying to send ping, but ping is not enabled"); var i } function I() { h || (d.debug("Starting ping (if configured)"), h = !0, null != e.heartbeat && (t = setInterval(R, e.heartbeat), R())) } function C() { clearInterval(t), h = !1, f = !1, p = -1, w.cancel() } this.send = function (e, t, n) { "ping" !== e && d.debug("Request: method:" + e + " params:" + JSON.stringify(t)); var i = Date.now(); w.encode(e, t, function (o, r) { if (o) { try { d.error("ERROR:" + o.message + " in Request: method:" + e + " params:" + JSON.stringify(t) + " request:" + o.request), o.data && d.error("ERROR DATA:" + JSON.stringify(o.data)) } catch (e) { } o.requestTime = i } n && (null != r && "pong" !== r.value && d.debug("Response: " + JSON.stringify(r)), n(o, r)) }) }, this.close = function (n, i) { d.debug("Closing  with code: " + n + " because: " + i), null != t && (d.debug("Clearing ping interval"), clearInterval(t)), h = !1, f = !1, e.sendCloseMessage ? (d.debug("Sending close message"), this.send("closeSession", null, function (e, t) { e && d.error("Error sending close message: " + JSON.stringify(e)), S.close(n, i) })) : S.close(n, i) }, this.forceClose = function (e) { S.forceClose(e) }, this.reconnect = function () { S.reconnectWs() }, this.resetPing = function () { f = !0, p = 0, I() } } }, { "../": 51, "./transports/webSocketWithReconnection": 50 }], 49: [function (e, t, n) { var i = e("./webSocketWithReconnection"); n.WebSocketWithReconnection = i }, { "./webSocketWithReconnection": 50 }], 50: [function (e, t, n) { "use strict"; var i = console, o = 2e3, r = 3e3, s = 3; t.exports = function (e) { var t, n = !1, a = e.uri, c = !1, d = new WebSocket(a); d.onopen = function () { i.debug("WebSocket connected to " + a), e.onconnected && e.onconnected() }, d.onerror = function (t) { i.error("Could not connect to " + a + " (invoking onerror if defined)", t), e.onerror && e.onerror(t) }; var u = function () { d.readyState === s ? n ? i.debug("Connection closed by user") : (i.debug("Connection closed unexpectecly. Reconnecting..."), l(o, 1)) : i.debug("Close callback from previous websocket. Ignoring it") }; function l(n, o) { if (i.debug("reconnect (attempt #" + o + ", max=" + n + ")"), 1 === o) { if (c) return void i.warn("Trying to reconnect when already reconnecting... Ignoring this reconnection."); c = !0, e.onreconnecting && e.onreconnecting() } !function (n, o) { i.debug("Reconnection attempt #" + o), d.close(), (d = new WebSocket(a)).onopen = function () { i.debug("Reconnected to " + a + " after " + o + " attempts..."), c = !1, t(), e.onreconnected() && e.onreconnected(), d.onclose = u }, d.onerror = function (t) { i.warn("Reconnection error: ", t), o === n ? e.ondisconnect && e.ondisconnect() : setTimeout(function () { l(n, o + 1) }, r) } }(n, o) } d.onclose = u, this.close = function () { n = !0, d.close() }, this.reconnectWs = function () { i.debug("reconnectWs"), l(o, 1) }, this.send = function (e) { d.send(e) }, this.addEventListener = function (e, n) { (t = function () { d.addEventListener(e, n) })() } } }, {}], 51: [function (e, t, n) { var i = !1; if (Object.defineProperty) try { Object.defineProperty({}, "x", {}) } catch (e) { i = !0 } Function.prototype.bind || (Function.prototype.bind = function (e) { if ("function" != typeof this) throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable"); var t = Array.prototype.slice.call(arguments, 1), n = this, i = function () { }, o = function () { return n.apply(this instanceof i && e ? this : e, t.concat(Array.prototype.slice.call(arguments))) }; return i.prototype = this.prototype, o.prototype = new i, o }); var o = e("events").EventEmitter, r = e("inherits"), s = e("./packers"), a = e("./Mapper"), c = 5e3; function d(e) { if (e) { if (e instanceof Function) return { send: e }; if (e.send instanceof Function) return e; if (e.postMessage instanceof Function) return e.send = e.postMessage, e; if (e.write instanceof Function) return e.send = e.write, e; if (void 0 === e.onmessage && !(e.pause instanceof Function)) throw new SyntaxError("Transport is not a function nor a valid object") } } function u(e, t) { i ? (this.method = e, this.params = t) : (Object.defineProperty(this, "method", { value: e, enumerable: !0 }), Object.defineProperty(this, "params", { value: t, enumerable: !0 })) } function l(e, t, n, s) { var l = this; if (!e) throw new SyntaxError("Packer is not defined"); if (!e.pack || !e.unpack) throw new SyntaxError("Packer is invalid"); var p = function (e) { if (!e) return {}; for (var t in e) { var n = e[t]; "string" == typeof n && (e[t] = { response: n }) } return e }(e.responseMethods); if (t instanceof Function) { if (null != n) throw new SyntaxError("There can't be parameters after onRequest"); s = t, n = void 0, t = void 0 } if (t && t.send instanceof Function) { if (n && !(n instanceof Function)) throw new SyntaxError("Only a function can be after transport"); s = n, n = t, t = void 0 } if (n instanceof Function) { if (null != s) throw new SyntaxError("There can't be parameters after onRequest"); s = n, n = void 0 } if (n && n.send instanceof Function && s && !(s instanceof Function)) throw new SyntaxError("Only a function can be after transport"); t = t || {}, o.call(this), s && this.on("request", s), i ? this.peerID = t.peerID : Object.defineProperty(this, "peerID", { value: t.peerID }); var f = t.max_retries || 0; function h(e) { l.decode(e.data || e) } this.getTransport = function () { return n }, this.setTransport = function (e) { n && (n.removeEventListener ? n.removeEventListener("message", h) : n.removeListener && n.removeListener("data", h)), e && (e.addEventListener ? e.addEventListener("message", h) : e.addListener && e.addListener("data", h)), n = d(e) }, i || Object.defineProperty(this, "transport", { get: this.getTransport.bind(this), set: this.setTransport.bind(this) }), this.setTransport(n); var m = t.request_timeout || c, v = t.ping_request_timeout || m, b = t.response_timeout || c, E = t.duplicates_timeout || c, g = 0, S = new a, y = new a, w = new a, O = {}; function R(e, t) { var n = setTimeout(function () { w.remove(e, t) }, E); w.set(n, e, t) } function I(t, n, o, r, s) { u.call(this, t, n), this.getTransport = function () { return s }, this.setTransport = function (e) { s = d(e) }, i || Object.defineProperty(this, "transport", { get: this.getTransport.bind(this), set: this.setTransport.bind(this) }); var a = y.get(o, r); s || l.getTransport() || (i ? this.duplicated = Boolean(a) : Object.defineProperty(this, "duplicated", { value: Boolean(a) })); var c = p[t]; this.pack = e.pack.bind(e, this, o), this.reply = function (t, n, i) { if (t instanceof Function || t && t.send instanceof Function) { if (null != n) throw new SyntaxError("There can't be parameters after callback"); i = t, n = null, t = void 0 } else if (n instanceof Function || n && n.send instanceof Function) { if (null != i) throw new SyntaxError("There can't be parameters after callback"); i = n, n = null } var s; if (i = d(i), a && clearTimeout(a.timeout), null != r && (t && (t.dest = r), n && (n.dest = r)), t || null != n) { if (null != l.peerID && (t ? t.from = l.peerID : n.from = l.peerID), c) if (null == c.error && t) s = { error: t }; else s = { method: t ? c.error : c.response, params: t || n }; else s = { error: t, result: n }; s = e.pack(s, o) } else s = a ? a.message : e.pack({ result: null }, o); return function (e, t, n) { var i = { message: e, timeout: setTimeout(function () { y.remove(t, n) }, b) }; y.set(i, t, n) }(s, o, r), (i = i || this.getTransport() || l.getTransport()) ? i.send(s) : s } } function C(e) { var t = O[e]; if (t) { delete O[e]; var n = S.pop(t.id, t.dest); n && (clearTimeout(n.timeout), R(t.id, t.dest)) } } r(I, u), this.cancel = function (e) { if (e) return C(e); for (var e in O) C(e) }, this.close = function () { var e = this.getTransport(); e && e.close && e.close(4003, "Cancel request"), this.cancel(), w.forEach(clearTimeout), y.forEach(function (e) { clearTimeout(e.timeout) }) }, this.encode = function (t, n, i, o, r) { if (n instanceof Function) { if (null != i) throw new SyntaxError("There can't be parameters after callback"); r = n, o = void 0, i = void 0, n = void 0 } else if (i instanceof Function) { if (null != o) throw new SyntaxError("There can't be parameters after callback"); r = i, o = void 0, i = void 0 } else if (o instanceof Function) { if (null != r) throw new SyntaxError("There can't be parameters after callback"); r = o, o = void 0 } null != l.peerID && ((n = n || {}).from = l.peerID), null != i && ((n = n || {}).dest = i); var s = { method: t, params: n }; if (r) { var a = g++, c = 0; function u(e, t) { l.cancel(s), r(e, t) } var h = { message: s = e.pack(s, a), callback: u, responseMethods: p[t] || {} }, b = d(o); function E(e) { var n = "ping" === t ? v : m; return h.timeout = setTimeout(R, n * Math.pow(2, c++)), O[s] = { id: a, dest: i }, S.set(h, a, i), (e = e || b || l.getTransport()) ? e.send(s) : s } function y(e) { e = d(e), console.warn(c + " retry for request message:", s); var t = w.pop(a, i); return clearTimeout(t), E(e) } function R() { if (c < f) return y(o); var e = new Error("Request has timed out"); e.request = s, e.retry = y, u(e) } return E(o) } return s = e.pack(s), (o = o || this.getTransport()) ? o.send(s) : s }, this.decode = function (t, n) { if (!t) throw new TypeError("Message is not defined"); try { t = e.unpack(t) } catch (e) { return console.debug(e, t) } var i = t.id, o = t.ack, r = t.method, s = t.params || {}, a = s.from, c = s.dest; if (null == l.peerID || a != l.peerID) { if (null == i && null == o) { var p = new u(r, s); if (l.emit("request", p)) return; return p } if (r) { if (null == c || c == l.peerID) { if (v = S.get(o, a)) { var f = v.responseMethods; return r == f.error ? g(v, s) : r == f.response ? g(v, null, s) : E() } if (b = w.get(o, a)) return O(b) } return E() } var h = t.error, m = t.result; if (!(h && h.dest && h.dest != l.peerID || m && m.dest && m.dest != l.peerID)) { var v, b; if (!(v = S.get(o, a))) return (b = w.get(o, a)) ? O(b) : console.warn("No callback was defined for this message", t); g(v, h, m) } } function E() { if (n = d(n) || l.getTransport()) { var e = y.get(i, a); if (e) return n.send(e.message) } var t = new I(r, s, null != i ? i : o, a, n); if (!l.emit("request", t)) return t } function g(e, t, n) { e.callback(t, n) } function O(e) { console.warn("Response already processed", t), clearTimeout(e), R(o, a) } } } r(l, o), l.RpcNotification = u, t.exports = l; var p = e("./clients"), f = e("./clients/transports"); l.clients = p, l.clients.transports = f, l.packers = s }, { "./Mapper": 46, "./clients": 47, "./clients/transports": 49, "./packers": 54, events: 1, inherits: 6 }], 52: [function (e, t, n) { n.pack = function (e, t) { var n = { jsonrpc: "2.0" }; if (e.method) n.method = e.method, e.params && (n.params = e.params), null != t && (n.id = t); else if (null != t) { if (e.error) { if (void 0 !== e.result) throw new TypeError("Both result and error are defined"); n.error = e.error } else { if (void 0 === e.result) throw new TypeError("No result or error is defined"); n.result = e.result } n.id = t } return JSON.stringify(n) }, n.unpack = function (e) { var t = e; ("string" == typeof e || e instanceof String) && (t = JSON.parse(e)); var n = t.jsonrpc; if ("2.0" !== n) throw new TypeError("Invalid JsonRPC version '" + n + "': " + e); if (null == t.method) { if (null == t.id) throw new TypeError("Invalid message: " + e); var i = void 0 !== t.result, o = void 0 !== t.error; if (i && o) throw new TypeError("Both result and error are defined: " + e); if (!i && !o) throw new TypeError("No result or error is defined: " + e); t.ack = t.id, delete t.id } return t } }, {}], 53: [function (e, t, n) { n.pack = function (e) { throw new TypeError("Not yet implemented") }, n.unpack = function (e) { throw new TypeError("Not yet implemented") } }, {}], 54: [function (e, t, n) { var i = e("./JsonRPC"), o = e("./XmlRPC"); n.JsonRPC = i, n.XmlRPC = o }, { "./JsonRPC": 52, "./XmlRPC": 53 }], 55: [function (e, t, n) { function i(e, t, n) { var i = { audio: !1, video: { mandatory: { chromeMediaSource: e ? "screen" : "desktop", maxWidth: window.screen.width > 1920 ? window.screen.width : 1920, maxHeight: window.screen.height > 1080 ? window.screen.height : 1080 }, optional: [] } }; return n && (i.audio = { mandatory: { chromeMediaSource: e ? "screen" : "desktop" }, optional: [] }), t && (i.video.mandatory.chromeMediaSourceId = t, i.audio && i.audio.mandatory && (i.audio.mandatory.chromeMediaSourceId = t)), i } function o(e) { r ? r.isLoaded ? e ? e.forEach ? r.contentWindow.postMessage({ captureCustomSourceId: e }, "*") : r.contentWindow.postMessage({ captureSourceIdWithAudio: !0 }, "*") : r.contentWindow.postMessage({ captureSourceId: !0 }, "*") : setTimeout(function () { o(e) }, 100) : s(function () { o(e) }) } var r; function s(e) { r ? e() : ((r = document.createElement("iframe")).onload = function () { r.isLoaded = !0, e() }, r.src = "https://openvidu.github.io/openvidu-screen-sharing-chrome-extension/", r.style.display = "none", (document.body || document.documentElement).appendChild(r)) } function a() { r ? r.isLoaded ? r.contentWindow.postMessage({ getChromeExtensionStatus: !0 }, "*") : setTimeout(a, 100) : s(a) } window.getScreenId = function (e, t, n) { -1 === navigator.userAgent.indexOf("Edge") || !navigator.msSaveOrOpenBlob && !navigator.msSaveBlob ? navigator.mozGetUserMedia ? t(null, "firefox", { video: { mozMediaSource: e, mediaSource: e } }) : (window.addEventListener("message", function e(n) { if (!n.data) return; n.data.chromeMediaSourceId && ("PermissionDeniedError" === n.data.chromeMediaSourceId ? t("permission-denied") : t(null, n.data.chromeMediaSourceId, i(null, n.data.chromeMediaSourceId, n.data.canRequestAudioTrack)), window.removeEventListener("message", e)); n.data.chromeExtensionStatus && (t(n.data.chromeExtensionStatus, null, i(n.data.chromeExtensionStatus)), window.removeEventListener("message", e)) }), n ? setTimeout(function () { o(n) }, 100) : setTimeout(o, 100)) : t({ video: !0 }) }, window.getScreenConstraints = function (e) { s(function () { getScreenId(function (t, n, i) { i || (i = { video: !0 }), e(t, i.video) }) }) }, window.getChromeExtensionStatus = function (e) { navigator.mozGetUserMedia ? e("installed-enabled") : (window.addEventListener("message", function t(n) { if (!n.data) return; n.data.chromeExtensionStatus && (e(n.data.chromeExtensionStatus), window.removeEventListener("message", t)) }), setTimeout(a, 100)) }, n.getScreenId = getScreenId }, {}], 56: [function (e, t, n) { var i, o, r = "screen", s = void 0 !== window.InstallTrigger, a = !!window.opera || navigator.userAgent.indexOf(" OPR/") >= 0; window.chrome; function c(e) { if (!e) throw '"callback" parameter is mandatory.'; if (i) return e(i); o = e, window.postMessage("get-sourceId", "*") } function d(e, t) { i = ""; if (s) return e(null, { mozMediaSource: "window", mediaSource: "window" }); var n = { mandatory: { chromeMediaSource: r, maxWidth: screen.width > 1920 ? screen.width : 1920, maxHeight: screen.height > 1080 ? screen.height : 1080 }, optional: [] }; "desktop" != r || i ? ("desktop" == r && (n.mandatory.chromeMediaSourceId = i), e(null, n)) : t ? function (e) { if (!e) throw '"callback" parameter is mandatory.'; if (i) return e(i); o = e, window.postMessage("audio-plus-tab", "*") }(function (t, i) { n.mandatory.chromeMediaSourceId = t, i && (n.canRequestAudioTrack = !0), e("PermissionDeniedError" == t ? t : null, n) }) : c(function (t) { n.mandatory.chromeMediaSourceId = t, e("PermissionDeniedError" == t ? t : null, n) }) } window.addEventListener("message", function (e) { e.origin == window.location.origin && function (e) { if ("PermissionDeniedError" == e) { if (o) return o("PermissionDeniedError"); throw new Error("PermissionDeniedError") } "rtcmulticonnection-extension-loaded" == e && (r = "desktop"); e.sourceId && o && o(i = e.sourceId, !0 === e.canRequestAudioTrack) }(e.data) }), n.getScreenConstraints = d, n.getScreenConstraintsWithAudio = function (e) { d(e, !0) }, n.isChromeExtensionAvailable = function (e) { if (e) { if ("desktop" == r) return e(!0); window.postMessage("are-you-there", "*"), setTimeout(function () { e("screen" != r) }, 2e3) } }, n.getChromeExtensionStatus = function (e, t) { if (s) return t("not-chrome"); 2 != arguments.length && (t = e, e = "lfcgfepafnobdloecchnfaclibenjold"); var n = document.createElement("img"); n.src = "chrome-extension://" + e + "/icon.png", n.onload = function () { r = "screen", window.postMessage("are-you-there", "*"), setTimeout(function () { t("screen" == r ? "installed-disabled" : "installed-enabled") }, 2e3) }, n.onerror = function () { t("not-installed") } }, n.getSourceId = c }, {}], 57: [function (e, t, n) { "use strict"; var i, o = this && this.__extends || (i = function (e, t) { return (i = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var n in t) t.hasOwnProperty(n) && (e[n] = t[n]) })(e, t) }, function (e, t) { function n() { this.constructor = e } i(e, t), e.prototype = null === t ? Object.create(t) : (n.prototype = t.prototype, new n) }); Object.defineProperty(n, "__esModule", { value: !0 }); var r = e("freeice"), s = e("uuid"), a = e("platform"), c = function () { function e(e) { var t = this; this.configuration = e, this.remoteCandidatesQueue = [], this.localCandidatesQueue = [], this.iceCandidateList = [], this.candidategatheringdone = !1, this.configuration.iceServers = this.configuration.iceServers && this.configuration.iceServers.length > 0 ? this.configuration.iceServers : r(), this.pc = new RTCPeerConnection({ iceServers: this.configuration.iceServers }), this.id = e.id ? e.id : s.v4(), this.pc.onicecandidate = function (e) { if (e.candidate) { var n = e.candidate; n ? (t.localCandidatesQueue.push({ candidate: n.candidate }), t.candidategatheringdone = !1, t.configuration.onicecandidate(e.candidate)) : t.candidategatheringdone || (t.candidategatheringdone = !0) } }, this.pc.onsignalingstatechange = function () { if ("stable" === t.pc.signalingState) for (; t.iceCandidateList.length > 0;)t.pc.addIceCandidate(t.iceCandidateList.shift()) }, this.start() } return e.prototype.start = function () { var e = this; return new Promise(function (t, n) { if ("closed" === e.pc.signalingState && n('The peer connection object is in "closed" state. This is most likely due to an invocation of the dispose method before accepting in the dialogue'), e.configuration.mediaStream) { for (var i = 0, o = e.configuration.mediaStream.getTracks(); i < o.length; i++) { var r = o[i]; e.pc.addTrack(r, e.configuration.mediaStream) } t() } }) }, e.prototype.dispose = function () { if (console.debug("Disposing WebRtcPeer"), this.pc) { if ("closed" === this.pc.signalingState) return; this.pc.close(), this.remoteCandidatesQueue = [], this.localCandidatesQueue = [] } }, e.prototype.generateOffer = function () { var e = this; return new Promise(function (t, n) { var i, o = !0; e.configuration.mediaConstraints && (i = "boolean" != typeof e.configuration.mediaConstraints.audio || e.configuration.mediaConstraints.audio, o = "boolean" != typeof e.configuration.mediaConstraints.video || e.configuration.mediaConstraints.video); var r = { offerToReceiveAudio: "sendonly" !== e.configuration.mode && i, offerToReceiveVideo: "sendonly" !== e.configuration.mode && o }; console.debug("RTCPeerConnection constraints: " + JSON.stringify(r)), "Safari" === a.name && -1 !== a.ua.indexOf("Safari") ? (i && e.pc.addTransceiver("audio", { direction: e.configuration.mode }), o && e.pc.addTransceiver("video", { direction: e.configuration.mode }), e.pc.createOffer().then(function (t) { return console.debug("Created SDP offer"), e.pc.setLocalDescription(t) }).then(function () { var i = e.pc.localDescription; i ? (console.debug("Local description set", i.sdp), t(i.sdp)) : n("Local description is not defined") }).catch(function (e) { return n(e) })) : e.pc.createOffer(r).then(function (t) { return console.debug("Created SDP offer"), e.pc.setLocalDescription(t) }).then(function () { var i = e.pc.localDescription; i ? (console.debug("Local description set", i.sdp), t(i.sdp)) : n("Local description is not defined") }).catch(function (e) { return n(e) }) }) }, e.prototype.processAnswer = function (e, t) { var n = this; return new Promise(function (i, o) { var r = { type: "answer", sdp: e }; console.debug("SDP answer received, setting remote description"), "closed" === n.pc.signalingState && o("RTCPeerConnection is closed"), a.isIonicIos ? t ? setTimeout(function () { console.info("setRemoteDescription run after timeout for Ionic iOS device"), n.pc.setRemoteDescription(new RTCSessionDescription(r)).then(function () { return i() }).catch(function (e) { return o(e) }) }, 250) : n.pc.setRemoteDescription(new RTCSessionDescription(r)).then(function () { return i() }).catch(function (e) { return o(e) }) : n.pc.setRemoteDescription(r).then(function () { return i() }).catch(function (e) { return o(e) }) }) }, e.prototype.addIceCandidate = function (e) { var t = this; return new Promise(function (n, i) { switch (console.debug("Remote ICE candidate received", e), t.remoteCandidatesQueue.push(e), t.pc.signalingState) { case "closed": i(new Error("PeerConnection object is closed")); break; case "stable": t.pc.remoteDescription ? t.pc.addIceCandidate(e).then(function () { return n() }).catch(function (e) { return i(e) }) : (t.iceCandidateList.push(e), n()); break; default: t.iceCandidateList.push(e), n() } }) }, e.prototype.addIceConnectionStateChangeListener = function (e) { var t = this; this.pc.oniceconnectionstatechange = function () { switch (t.pc.iceConnectionState) { case "disconnected": console.warn("IceConnectionState of RTCPeerConnection " + t.id + " (" + e + ') change to "disconnected". Possible network disconnection'); break; case "failed": console.error("IceConnectionState of RTCPeerConnection " + t.id + " (" + e + ') to "failed"'); break; case "closed": console.log("IceConnectionState of RTCPeerConnection " + t.id + " (" + e + ') change to "closed"'); break; case "new": console.log("IceConnectionState of RTCPeerConnection " + t.id + " (" + e + ') change to "new"'); break; case "checking": console.log("IceConnectionState of RTCPeerConnection " + t.id + " (" + e + ') change to "checking"'); break; case "connected": console.log("IceConnectionState of RTCPeerConnection " + t.id + " (" + e + ') change to "connected"'); break; case "completed": console.log("IceConnectionState of RTCPeerConnection " + t.id + " (" + e + ') change to "completed"') } } }, e }(); n.WebRtcPeer = c; var d = function (e) { function t(t) { return t.mode = "recvonly", e.call(this, t) || this } return o(t, e), t }(c); n.WebRtcPeerRecvonly = d; var u = function (e) { function t(t) { return t.mode = "sendonly", e.call(this, t) || this } return o(t, e), t }(c); n.WebRtcPeerSendonly = u; var l = function (e) { function t(t) { return t.mode = "sendrecv", e.call(this, t) || this } return o(t, e), t }(c); n.WebRtcPeerSendrecv = l }, { freeice: 2, platform: 8, uuid: 10 }], 58: [function (e, t, n) { "use strict"; Object.defineProperty(n, "__esModule", { value: !0 }); var i = e("platform"), o = function () { function e(e) { this.stream = e, this.webRtcStatsEnabled = !1, this.statsInterval = 1, this.stats = { inbound: { audio: { bytesReceived: 0, packetsReceived: 0, packetsLost: 0 }, video: { bytesReceived: 0, packetsReceived: 0, packetsLost: 0, framesDecoded: 0, nackCount: 0 } }, outbound: { audio: { bytesSent: 0, packetsSent: 0 }, video: { bytesSent: 0, packetsSent: 0, framesEncoded: 0, nackCount: 0 } } } } return e.prototype.isEnabled = function () { return this.webRtcStatsEnabled }, e.prototype.initWebRtcStats = function () { var e = this, t = localStorage.getItem("elastest-instrumentation"); if (t) { console.warn("WebRtc stats enabled for stream " + this.stream.streamId + " of connection " + this.stream.connection.connectionId), this.webRtcStatsEnabled = !0; var n = JSON.parse(t); return this.statsInterval = n.webrtc.interval, console.warn("localStorage item: " + JSON.stringify(n)), void (this.webRtcStatsIntervalId = setInterval(function () { e.sendStatsToHttpEndpoint(n) }, 1e3 * this.statsInterval)) } console.debug("WebRtc stats not enabled") }, e.prototype.stopWebRtcStats = function () { this.webRtcStatsEnabled && (clearInterval(this.webRtcStatsIntervalId), console.warn("WebRtc stats stopped for disposed stream " + this.stream.streamId + " of connection " + this.stream.connection.connectionId)) }, e.prototype.getSelectedIceCandidateInfo = function () { var e = this; return new Promise(function (t, n) { e.getStatsAgnostic(e.stream.getRTCPeerConnection(), function (o) { if (-1 !== i.name.indexOf("Chrome") || -1 !== i.name.indexOf("Opera")) { var r = void 0, s = void 0, a = void 0, c = {}, d = {}; for (var u in o) { var l = o[u]; "localcandidate" === l.type ? c[l.id] = l : "remotecandidate" === l.type ? d[l.id] = l : "googCandidatePair" === l.type && "true" === l.googActiveConnection && (a = l, r = l.localCandidateId, s = l.remoteCandidateId) } var p = c[r]; if (p) { var f = e.stream.getLocalIceCandidateList().filter(function (e) { return !!e.candidate && e.candidate.indexOf(p.ipAddress) >= 0 && e.candidate.indexOf(p.portNumber) >= 0 && e.candidate.indexOf(p.priority) >= 0 }); p.raw = f[0] ? f[0].candidate : "ERROR: Cannot find local candidate in list of sent ICE candidates" } else p = "ERROR: No active local ICE candidate. Probably ICE-TCP is being used"; var h = d[s]; if (h) { f = e.stream.getRemoteIceCandidateList().filter(function (e) { return !!e.candidate && e.candidate.indexOf(h.ipAddress) >= 0 && e.candidate.indexOf(h.portNumber) >= 0 && e.candidate.indexOf(h.priority) >= 0 }); h.raw = f[0] ? f[0].candidate : "ERROR: Cannot find remote candidate in list of received ICE candidates" } else h = "ERROR: No active remote ICE candidate. Probably ICE-TCP is being used"; t({ googCandidatePair: a, localCandidate: p, remoteCandidate: h }) } else n("Selected ICE candidate info only available for Chrome") }, function (e) { n(e) }) }) }, e.prototype.sendStatsToHttpEndpoint = function (e) { var t = this, n = function (n) { var i = new XMLHttpRequest, o = e.webrtc.httpEndpoint; i.open("POST", o, !0), i.setRequestHeader("Content-type", "application/json"), i.onreadystatechange = function () { 4 === i.readyState && 200 === i.status && console.log("WebRtc stats successfully sent to " + o + " for stream " + t.stream.streamId + " of connection " + t.stream.connection.connectionId) }, i.send(n) }; this.getStatsAgnostic(this.stream.getRTCPeerConnection(), function (o) { if (-1 !== i.name.indexOf("Firefox")) o.forEach(function (i) { var o = {}; if ("inbound-rtp" === i.type && null !== i.nackCount && !1 === i.isRemote && i.id.startsWith("inbound") && i.remoteId.startsWith("inbound")) { var r = "webrtc_inbound_" + i.mediaType + "_" + i.ssrc, s = 1e3 * i.jitter, a = { bytesReceived: (i.bytesReceived - t.stats.inbound[i.mediaType].bytesReceived) / t.statsInterval, jitter: s, packetsReceived: (i.packetsReceived - t.stats.inbound[i.mediaType].packetsReceived) / t.statsInterval, packetsLost: (i.packetsLost - t.stats.inbound[i.mediaType].packetsLost) / t.statsInterval }, c = { bytesReceived: "bytes", jitter: "ms", packetsReceived: "packets", packetsLost: "packets" }; "video" === i.mediaType && (a.framesDecoded = (i.framesDecoded - t.stats.inbound.video.framesDecoded) / t.statsInterval, a.nackCount = (i.nackCount - t.stats.inbound.video.nackCount) / t.statsInterval, c.framesDecoded = "frames", c.nackCount = "packets", t.stats.inbound.video.framesDecoded = i.framesDecoded, t.stats.inbound.video.nackCount = i.nackCount), t.stats.inbound[i.mediaType].bytesReceived = i.bytesReceived, t.stats.inbound[i.mediaType].packetsReceived = i.packetsReceived, t.stats.inbound[i.mediaType].packetsLost = i.packetsLost, (o = { "@timestamp": new Date(i.timestamp).toISOString(), exec: e.exec, component: e.component, stream: "webRtc", et_type: r, stream_type: "composed_metrics", units: c })[r] = a, n(JSON.stringify(o)) } else "outbound-rtp" === i.type && !1 === i.isRemote && i.id.toLowerCase().includes("outbound") && (r = "webrtc_outbound_" + i.mediaType + "_" + i.ssrc, a = { bytesSent: (i.bytesSent - t.stats.outbound[i.mediaType].bytesSent) / t.statsInterval, packetsSent: (i.packetsSent - t.stats.outbound[i.mediaType].packetsSent) / t.statsInterval }, c = { bytesSent: "bytes", packetsSent: "packets" }, "video" === i.mediaType && (a.framesEncoded = (i.framesEncoded - t.stats.outbound.video.framesEncoded) / t.statsInterval, c.framesEncoded = "frames", t.stats.outbound.video.framesEncoded = i.framesEncoded), t.stats.outbound[i.mediaType].bytesSent = i.bytesSent, t.stats.outbound[i.mediaType].packetsSent = i.packetsSent, (o = { "@timestamp": new Date(i.timestamp).toISOString(), exec: e.exec, component: e.component, stream: "webRtc", et_type: r, stream_type: "composed_metrics", units: c })[r] = a, n(JSON.stringify(o))) }); else if (-1 !== i.name.indexOf("Chrome") || -1 !== i.name.indexOf("Opera")) for (var r = 0, s = Object.keys(o); r < s.length; r++) { var a = o[s[r]]; if ("ssrc" === a.type) { var c = {}; if ("bytesReceived" in a && ("audio" === a.mediaType && "audioOutputLevel" in a || "video" === a.mediaType && "qpSum" in a)) { var d = "webrtc_inbound_" + a.mediaType + "_" + a.ssrc, u = { bytesReceived: (a.bytesReceived - t.stats.inbound[a.mediaType].bytesReceived) / t.statsInterval, jitter: a.googJitterBufferMs, packetsReceived: (a.packetsReceived - t.stats.inbound[a.mediaType].packetsReceived) / t.statsInterval, packetsLost: (a.packetsLost - t.stats.inbound[a.mediaType].packetsLost) / t.statsInterval }, l = { bytesReceived: "bytes", jitter: "ms", packetsReceived: "packets", packetsLost: "packets" }; "video" === a.mediaType && (u.framesDecoded = (a.framesDecoded - t.stats.inbound.video.framesDecoded) / t.statsInterval, u.nackCount = (a.googNacksSent - t.stats.inbound.video.nackCount) / t.statsInterval, l.framesDecoded = "frames", l.nackCount = "packets", t.stats.inbound.video.framesDecoded = a.framesDecoded, t.stats.inbound.video.nackCount = a.googNacksSent), t.stats.inbound[a.mediaType].bytesReceived = a.bytesReceived, t.stats.inbound[a.mediaType].packetsReceived = a.packetsReceived, t.stats.inbound[a.mediaType].packetsLost = a.packetsLost, (c = { "@timestamp": new Date(a.timestamp).toISOString(), exec: e.exec, component: e.component, stream: "webRtc", et_type: d, stream_type: "composed_metrics", units: l })[d] = u, n(JSON.stringify(c)) } else "bytesSent" in a && (d = "webrtc_outbound_" + a.mediaType + "_" + a.ssrc, u = { bytesSent: (a.bytesSent - t.stats.outbound[a.mediaType].bytesSent) / t.statsInterval, packetsSent: (a.packetsSent - t.stats.outbound[a.mediaType].packetsSent) / t.statsInterval }, l = { bytesSent: "bytes", packetsSent: "packets" }, "video" === a.mediaType && (u.framesEncoded = (a.framesEncoded - t.stats.outbound.video.framesEncoded) / t.statsInterval, l.framesEncoded = "frames", t.stats.outbound.video.framesEncoded = a.framesEncoded), t.stats.outbound[a.mediaType].bytesSent = a.bytesSent, t.stats.outbound[a.mediaType].packetsSent = a.packetsSent, (c = { "@timestamp": new Date(a.timestamp).toISOString(), exec: e.exec, component: e.component, stream: "webRtc", et_type: d, stream_type: "composed_metrics", units: l })[d] = u, n(JSON.stringify(c))) } } }, function (e) { console.log(e) }) }, e.prototype.standardizeReport = function (e) { console.log(e); var t = {}; return -1 !== i.name.indexOf("Firefox") ? (Object.keys(e).forEach(function (t) { console.log(e[t]) }), e) : (e.result().forEach(function (e) { var n = { id: e.id, timestamp: e.timestamp, type: e.type }; e.names().forEach(function (t) { n[t] = e.stat(t) }), t[n.id] = n }), t) }, e.prototype.getStatsAgnostic = function (e, t, n) { var o = this; return -1 !== i.name.indexOf("Firefox") ? e.getStats(null).then(function (e) { var n = o.standardizeReport(e); t(n) }).catch(n) : -1 !== i.name.indexOf("Chrome") || -1 !== i.name.indexOf("Opera") ? e.getStats(function (e) { var n = o.standardizeReport(e); t(n) }, null, n) : void 0 }, e }(); n.WebRtcStats = o }, { platform: 8 }] }, {}, [22]);