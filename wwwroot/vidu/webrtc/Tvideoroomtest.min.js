function LocalVideoClick(){if(board.user.permission.video){if(!LocalAudioTrack&&LocalVideoTrack){iconDisablVidu(2e3,iconViduPanel);unpublishOwnFeed();return}var n=LocalAudioTrack,t=LocalVideoTrack;LocalAudioTrack||LocalVideoTrack?(iconDisablVidu(5e3,iconViduPanel),unpublishOwnFeed(),setTimeout(()=>{publishOwnFeed(n,!t)},2e3)):(iconDisablVidu(2e3,iconViduPanel),publishOwnFeed(LocalAudioTrack,!0))}}function LocalAudioClick(){if(board.user.permission.audio){if(LocalAudioTrack&&!LocalVideoTrack){iconDisablVidu(2e3,iconViduPanel);unpublishOwnFeed();return}var n=LocalAudioTrack,t=LocalVideoTrack;LocalAudioTrack||LocalVideoTrack?(iconDisablVidu(5e3,iconViduPanel),unpublishOwnFeed(),setTimeout(()=>{publishOwnFeed(!n,t)},2e3)):(iconDisablVidu(2e3,iconViduPanel),publishOwnFeed(!0,LocalVideoTrack))}}function publishlocalTrack(){}function confreancInit(){Janus.init({debug:"all",callback:function(){($(this).attr("disabled",!0).unbind("click"),Janus.isWebrtcSupported())&&(janus=new Janus({server:server,success:function(){janus.attach({plugin:"janus.plugin.videoroom",opaqueId:opaqueId,success:function(n){sfutest=n;Janus.log("Plugin attached! ("+sfutest.getPlugin()+", id="+sfutest.getId()+")");Janus.log("  -- This is a publisher/manager");registerUsername()},error:function(n){Janus.error("  -- Error attaching plugin...",n);console.log("Error attaching plugin... "+n)},consentDialog:function(n){Janus.debug("Consent dialog should be "+(n?"on":"off")+" now")},mediaState:function(n,t){Janus.log("Janus "+(t?"started":"stopped")+" receiving our "+n)},webrtcState:function(n){Janus.log("Janus says our WebRTC PeerConnection is "+(n?"up":"down")+" now");!n},onmessage:function(n,t){var e,i,f,a,h,v,r,u,o,s;if(Janus.debug(" ::: Got a message (publisher) :::"),Janus.debug(n),console.warn("meesage 1"),console.warn(n),console.warn(t),e=n.videoroom,Janus.debug("Event: "+e),e!=undefined&&e!=null)if(e==="joined"){if(myid=n.id,mypvtid=n.private_id,Janus.log("Successfully joined room "+n.room+" with ID "+myid),n.publishers!==undefined&&n.publishers!==null){i=n.publishers;Janus.debug("Got a list of available publishers/feeds:");Janus.debug(i);for(f in i){var c=i[f].id,l=i[f].display,o=i[f].audio_codec,s=i[f].video_codec;Janus.debug("  >> ["+c+"] "+l+" (audio: "+o+", video: "+s+")");newRemoteFeed(c,l,o,s)}}}else if(e==="destroyed")Janus.warn("The room has been destroyed!"),console.log("The room has been destroyed",function(){});else if(e==="event")if(n.publishers!==undefined&&n.publishers!==null){i=n.publishers;Janus.debug("Got a list of available publishers/feeds:");Janus.debug(i);for(f in i){var c=i[f].id,l=i[f].display,o=i[f].audio_codec,s=i[f].video_codec;Janus.debug("  >> ["+c+"] "+l+" (audio: "+o+", video: "+s+")");newRemoteFeed(c,l,o,s)}}else if(n.leaving!==undefined&&n.leaving!==null){for(a=n.leaving,Janus.log("Publisher left: "+a),r=null,u=1;u<6;u++)if(feeds[u]!=null&&feeds[u]!=undefined&&feeds[u].rfid==a){r=feeds[u];break}r!=null&&(Janus.debug("Feed "+r.rfid+" ("+r.rfdisplay+") has left the room, detaching"),feeds[r.rfindex]=null,r.detach())}else if(n.unpublished!==undefined&&n.unpublished!==null){if(h=n.unpublished,v=h,Janus.log("Publisher left: "+h),h==="ok"){sfutest.hangup();return}for(r=null,u=1;u<6;u++)if(feeds[u]!=null&&feeds[u]!=undefined&&feeds[u].rfid==h){r=feeds[u];break}r!=null&&(Janus.debug("Feed "+r.rfid+" ("+r.rfdisplay+") has left the room, detaching"),feeds[r.rfindex]=null,r.detach())}else n.error!==undefined&&n.error!==null&&(n.error_code===426?console.log("<p>Apparently room <code>"+myroom+"<\/code> (the one this demo uses as a test room) does not exist...<\/p><p>Do you have an updated <code>janus.plugin.videoroom.cfg<\/code> configuration file? If not, make sure you copy the details of room <code>"+myroom+"<\/code> from that sample in your current configuration file, then restart Janus and try again."):console.log(n.error));t!==undefined&&t!==null&&(Janus.debug("Handling SDP as well..."),Janus.debug(t),sfutest.handleRemoteJsep({jsep:t}),o=n.audio_codec,mystream&&mystream.getAudioTracks()&&mystream.getAudioTracks().length>0&&!o&&toastr.warning("Our audio stream has been rejected, viewers won't hear us"),s=n.video_codec,mystream&&mystream.getVideoTracks()&&mystream.getVideoTracks().length>0&&!s&&toastr.warning("Our video stream has been rejected, viewers won't see us"))},onlocalstream:function(n){var r,u,f,i,t;Janus.debug(" ::: Got a local stream :::");console.warn(n);mystream=n;Janus.debug(n);r=n.getVideoTracks();console.warn(r);u=n.getAudioTracks();f="block";r.length>0?(document.getElementById("mute-video").style.color="red",LocalVideoTrack=!0):(document.getElementById("mute-video").style.color="black",LocalVideoTrack=!1,f="none");u.length>0?(document.getElementById("mute-audio").style.color="red",LocalAudioTrack=!0):(document.getElementById("mute-audio").style.color="black",LocalAudioTrack=!1);i=document.createElement("div");i.classList+="videoItemPanel vidioItem_0";i.id="vidioItem_0";t=document.createElement("video");i.appendChild(t);document.getElementById("videos").appendChild(i);t.classList="rounded centered videoItem";t.id="remoteVideo_0";t.autoplay=!0;t.controls=!0;t.muted=!0;t.style.maxWidth="100%";t.style.display=f;Janus.attachMediaStream($("#remoteVideo_0").get(0),n);sfutest.webrtcStuff.pc.iceConnectionState!=="completed"&&sfutest.webrtcStuff.pc.iceConnectionState!=="connected";resizingVideoBox();console.warn(u)},onremotestream:function(n){var e,u,f,i,t,r;(console.log("get remote streem .................................................................**************"),console.warn(remoteFeed),Janus.debug("Remote feed #"+remoteFeed.rfindex),e=!1,$("#remoteVideo_"+remoteFeed.rfindex).length===0&&(u=n.getVideoTracks(),console.warn(u),f="block",u.length<1&&(f="none"),i=document.createElement("div"),i.classList+="videoItemPanel vidioItem_"+remoteFeed.rfid,i.id="vidioItem_"+remoteFeed.rfid,t=document.createElement("video"),i.appendChild(t),document.getElementById("videos").appendChild(i),t.style.display=f,t.classList="rounded centered videoItem",t.id="remoteVideo_"+remoteFeed.rfindex,t.autoplay=!0,t.controls=!0,t.style.maxWidth="100%"),Janus.attachMediaStream($("#remoteVideo_"+remoteFeed.rfindex).get(0),n),setTimeout(()=>{resizingVideoBox()},4e3),r=n.getVideoTracks(),(r===null||r===undefined||r.length===0)&&$("#videoremote"+remoteFeed.rfindex+" .no-video-container").length===0&&$("#videoremote"+remoteFeed.rfindex).append('<div class="no-video-container"><i class="fa fa-video-camera fa-5 no-video-icon"><\/i><span class="no-video-text">No remote video available<\/span><\/div>'),e)&&(Janus.webRTCAdapter.browserDetails.browser==="chrome"||Janus.webRTCAdapter.browserDetails.browser==="firefox"||Janus.webRTCAdapter.browserDetails.browser==="safari")&&($("#curbitrate"+remoteFeed.rfindex).removeClass("hide").show(),bitrateTimer[remoteFeed.rfindex]=setInterval(function(){var n=remoteFeed.getBitrate();$("#curbitrate"+remoteFeed.rfindex).text(n)},1e3))},oncleanup:function(){Janus.log(" ::: Got a cleanup notification: we are unpublished now :::");mystream=null;$("#vidioItem_0").remove();LocalAudioTrack=!1;LocalVideoTrack=!1;document.getElementById("mute-video").style.color="black";document.getElementById("mute-audio").style.color="black";resizingVideoBox()}})},error:function(n){Janus.error(n);console.log(n,function(){})},destroyed:function(){}}))}})}function checkEnter(n,t){var i=t.keyCode?t.keyCode:t.which?t.which:t.charCode;return i==13?(registerUsername(),!1):!0}function registerUsername(){myusername="alipppppppp";var n={request:"join",room:myroom,ptype:"publisher",display:myusername};sfutest.send({message:n})}function publishOwnFeed(n,t){sfutest.createOffer({media:{audioRecv:!1,videoRecv:!1,audioSend:n,videoSend:t,audio:{deviceId:{exact:device.audioDevice}},video:{width:200,height:200,deviceId:{exact:device.videoDevice}}},simulcast:doSimulcast,success:function(i){Janus.debug("Got publisher SDP!");Janus.debug(i);var r={request:"configure",audio:n,video:t};sfutest.send({message:r,jsep:i})},error:function(t){Janus.error("WebRTC error:",t);n||console.log("WebRTC error... "+JSON.stringify(t))}})}function toggleMute(){var n=sfutest.isAudioMuted();Janus.log((n?"Unmuting":"Muting")+" local stream...");n?sfutest.unmuteAudio():sfutest.muteAudio();n=sfutest.isAudioMuted();$("#mute").html(n?"Unmute":"Mute")}function unpublishOwnFeed(){sfutest.send({message:{request:"unpublish"}})}function newRemoteFeed(n,t,i,r){var u=null,f;t.startsWith("screen")&&iconDisablVidu(6e3,MainNavBar);f=screenShareStatus;janus.attach({plugin:"janus.plugin.videoroom",opaqueId:opaqueId,success:function(t){u=t;u.simulcastStarted=!1;Janus.log("Plugin attached! ("+u.getPlugin()+", id="+u.getId()+")");Janus.log("  -- This is a subscriber");var i={request:"join",room:myroom,ptype:"subscriber",feed:n,private_id:mypvtid};Janus.webRTCAdapter.browserDetails.browser!=="safari"||r!=="vp9"&&(r!=="vp8"||Janus.safariVp8)||(r&&(r=r.toUpperCase()),toastr.warning("Publisher is using "+r+", but Safari doesn't support it: disabling video"),i.offer_video=!1);u.videoCodec=r;u.send({message:i})},error:function(n){Janus.error("  -- Error attaching plugin...",n);console.log("Error attaching plugin... "+n)},onmessage:function(n,t){var r,i,f,e;if(console.warn("new remote Message ..........................................."),console.warn(n),console.warn(t),Janus.debug(" ::: Got a message (subscriber) :::"),Janus.debug(n),r=n.videoroom,Janus.debug("Event: "+r),n.error!==undefined&&n.error!==null)console.log(n.error);else if(r!=undefined&&r!=null)if(r==="attached"){for(i=1;i<6;i++)if(feeds[i]===undefined||feeds[i]===null){feeds[i]=u;u.rfindex=i;break}u.rfid=n.id;u.rfdisplay=n.display;Janus.log("Successfully attached to feed "+u.rfid+" ("+u.rfdisplay+") in room "+n.room);$("#remote"+u.rfindex).removeClass("hide").html(u.rfdisplay).show()}else r==="event"&&(f=n.substream,e=n.temporal,(f!==null&&f!==undefined||e!==null&&e!==undefined)&&(u.simulcastStarted||(u.simulcastStarted=!0)));t!==undefined&&t!==null&&(Janus.debug("Handling SDP as well..."),Janus.debug(t),u.createAnswer({jsep:t,media:{audioSend:!1,videoSend:!1},success:function(n){Janus.debug("Got SDP!");Janus.debug(n);var t={request:"start",room:myroom};u.send({message:t,jsep:n})},error:function(n){Janus.error("WebRTC error:",n);console.log("WebRTC error... "+JSON.stringify(n))}}))},webrtcState:function(n){Janus.log("Janus says this WebRTC PeerConnection (feed #"+u.rfindex+") is "+(n?"up":"down")+" now")},onlocalstream:function(){},onremotestream:function(n){var h,o,s,r,i,f,c,e;if(console.warn(u),Janus.debug("Remote feed #"+u.rfindex),h=!1,$("#remoteVideo_"+u.rfindex).length===0){if(o=n.getVideoTracks(),console.warn(o),s="block",o.length<1&&(s="none"),r=document.createElement("div"),r.classList+="videoItemPanel vidioItem_"+u.rfid,r.id="vidioItem_"+u.rfid,i=document.createElement("video"),r.appendChild(i),t.startsWith("screen")){if(f=t.split("_")[1],f==board.userName){console.log("displayName is : "+f);return}if(console.log(f+" : "+board.userName),console.log("***************************************************************************************************************************"),isScreenShare=!0,screenShareStatus)return;screenShareRemoteStatus=1;r.classList="vidioItem_"+u.rfid;document.getElementById("screenShareElemnt").appendChild(i)}else document.getElementById("videos").appendChild(r),i.style.display=s,i.classList="rounded centered videoItem";i.id="remoteVideo_"+u.rfindex;i.autoplay=!0;i.controls=!0;i.style.maxWidth="100%"}(Janus.attachMediaStream($("#remoteVideo_"+u.rfindex).get(0),n),c=n.getAudioTracks(),console.warn(c),t.startsWith("screen")&&setTimeout(()=>{connectToScreenShare()},3e3),setTimeout(()=>{resizingVideoBox()},4e3),e=n.getVideoTracks(),(e===null||e===undefined||e.length===0)&&$("#videoremote"+u.rfindex+" .no-video-container").length===0&&$("#videoremote"+u.rfindex).append('<div class="no-video-container"><i class="fa fa-video-camera fa-5 no-video-icon"><\/i><span class="no-video-text">No remote video available<\/span><\/div>'),h)&&(Janus.webRTCAdapter.browserDetails.browser==="chrome"||Janus.webRTCAdapter.browserDetails.browser==="firefox"||Janus.webRTCAdapter.browserDetails.browser==="safari")&&($("#curbitrate"+u.rfindex).removeClass("hide").show(),bitrateTimer[u.rfindex]=setInterval(function(){var n=u.getBitrate();$("#curbitrate"+u.rfindex).text(n)},1e3))},oncleanup:function(){if(console.warn("ali"),console.warn(t),console.warn(u),Janus.log(" ::: Got a cleanup notification (remote feed "+n+") :::"),t.startsWith("screen")){if($("#remoteVideo_"+u.rfindex).remove(),f)return;screenShareRemoteStatus=0;disconnectFromScreenShare()}$(".vidioItem_"+u.rfid).remove();resizingVideoBox();bitrateTimer[u.rfindex]!==null&&bitrateTimer[u.rfindex]!==null&&clearInterval(bitrateTimer[u.rfindex]);bitrateTimer[u.rfindex]=null;u.simulcastStarted=!1}})}function getQueryStringValue(n){n=n.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var i=new RegExp("[\\?&]"+n+"=([^&#]*)"),t=i.exec(location.search);return t===null?"":decodeURIComponent(t[1].replace(/\+/g," "))}var server="wss://"+board.mediaServer+":8989/ws",janus=null,sfutest=null,opaqueId="videoroomtest-"+randomString(12),myroom=parseInt(board.meetID),rrrr,myusername=board.nickName,myid=null,mystream=null,mypvtid=null,feeds=[],bitrateTimer=[],capture=null,role="publisher",doSimulcast=getQueryStringValue("simulcast")==="yes"||getQueryStringValue("simulcast")==="true",LocalAudioTrack=!1,LocalVideoTrack=!1;$(document).ready(function(){});