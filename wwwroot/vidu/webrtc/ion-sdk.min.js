var IonSDK = function (g) { var I = {}; function C(A) { if (I[A]) return I[A].exports; var c = I[A] = { i: A, l: !1, exports: {} }; return g[A].call(c.exports, c, c.exports, C), c.l = !0, c.exports } return C.m = g, C.c = I, C.d = function (g, I, A) { C.o(g, I) || Object.defineProperty(g, I, { enumerable: !0, get: A }) }, C.r = function (g) { "undefined" != typeof Symbol && Symbol.toStringTag && Object.defineProperty(g, Symbol.toStringTag, { value: "Module" }), Object.defineProperty(g, "__esModule", { value: !0 }) }, C.t = function (g, I) { if (1 & I && (g = C(g)), 8 & I) return g; if (4 & I && "object" == typeof g && g && g.__esModule) return g; var A = Object.create(null); if (C.r(A), Object.defineProperty(A, "default", { enumerable: !0, value: g }), 2 & I && "string" != typeof g) for (var c in g) C.d(A, c, function (I) { return g[I] }.bind(null, c)); return A }, C.n = function (g) { var I = g && g.__esModule ? function () { return g.default } : function () { return g }; return C.d(I, "a", I), I }, C.o = function (g, I) { return Object.prototype.hasOwnProperty.call(g, I) }, C.p = "", C(C.s = 1) }([function (module, exports, __webpack_require__) { "use strict"; eval("\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.makeRemote = exports.LocalStream = exports.VideoConstraints = void 0;\r\nconst resolutions = ['qvga', 'vga', 'shd', 'hd', 'fhd', 'qhd'];\r\nexports.VideoConstraints = {\r\n    qvga: {\r\n        resolution: {\r\n            width: { ideal: 320 },\r\n            height: { ideal: 180 },\r\n            frameRate: {\r\n                ideal: 15,\r\n                max: 30,\r\n            },\r\n        },\r\n        encodings: {\r\n            maxBitrate: 150000,\r\n            maxFramerate: 15.0,\r\n        },\r\n    },\r\n    vga: {\r\n        resolution: {\r\n            width: { ideal: 640 },\r\n            height: { ideal: 360 },\r\n            frameRate: {\r\n                ideal: 30,\r\n                max: 60,\r\n            },\r\n        },\r\n        encodings: {\r\n            maxBitrate: 500000,\r\n            maxFramerate: 30.0,\r\n        },\r\n    },\r\n    shd: {\r\n        resolution: {\r\n            width: { ideal: 960 },\r\n            height: { ideal: 540 },\r\n            frameRate: {\r\n                ideal: 30,\r\n                max: 60,\r\n            },\r\n        },\r\n        encodings: {\r\n            maxBitrate: 1200000,\r\n            maxFramerate: 30.0,\r\n        },\r\n    },\r\n    hd: {\r\n        resolution: {\r\n            width: { ideal: 1280 },\r\n            height: { ideal: 720 },\r\n            frameRate: {\r\n                ideal: 30,\r\n                max: 60,\r\n            },\r\n        },\r\n        encodings: {\r\n            maxBitrate: 2500000,\r\n            maxFramerate: 30.0,\r\n        },\r\n    },\r\n    fhd: {\r\n        resolution: {\r\n            width: { ideal: 1920 },\r\n            height: { ideal: 1080 },\r\n            frameRate: {\r\n                ideal: 30,\r\n                max: 60,\r\n            },\r\n        },\r\n        encodings: {\r\n            maxBitrate: 4000000,\r\n            maxFramerate: 30.0,\r\n        },\r\n    },\r\n    qhd: {\r\n        resolution: {\r\n            width: { ideal: 2560 },\r\n            height: { ideal: 1440 },\r\n            frameRate: {\r\n                ideal: 30,\r\n                max: 60,\r\n            },\r\n        },\r\n        encodings: {\r\n            maxBitrate: 8000000,\r\n            maxFramerate: 30.0,\r\n        },\r\n    },\r\n};\r\nconst defaults = {\r\n    resolution: 'hd',\r\n    codec: 'vp8',\r\n    audio: true,\r\n    video: true,\r\n    simulcast: false,\r\n};\r\nclass LocalStream extends MediaStream {\r\n    constructor(stream, constraints) {\r\n        super(stream);\r\n        this.constraints = constraints;\r\n    }\r\n    static async getUserMedia(constraints = defaults) {\r\n        const stream = await navigator.mediaDevices.getUserMedia({\r\n            audio: LocalStream.computeAudioConstraints({\r\n                ...defaults,\r\n                ...constraints,\r\n            }),\r\n            video: LocalStream.computeVideoConstraints({\r\n                ...defaults,\r\n                ...constraints,\r\n            }),\r\n        });\r\n        return new LocalStream(stream, {\r\n            ...defaults,\r\n            ...constraints,\r\n        });\r\n    }\r\n    static async getDisplayMedia(constraints = {\r\n        codec: 'vp8',\r\n        resolution: 'hd',\r\n        audio: true,\r\n        video: true,\r\n        simulcast: false,\r\n    }) {\r\n        // @ts-ignore\r\n        const stream = await navigator.mediaDevices.getDisplayMedia({\r\n            video: true, audio: true \r\n        });\r\n        return new LocalStream(stream, {\r\n            ...defaults,\r\n            ...constraints,\r\n        });\r\n    }\r\n    static computeAudioConstraints(constraints) {\r\n        return constraints.audio;\r\n    }\r\n    static computeVideoConstraints(constraints) {\r\n        if (constraints.video instanceof Object) {\r\n            return constraints.video;\r\n        }\r\n        else if (constraints.video && constraints.resolution) {\r\n            return {\r\n                ...exports.VideoConstraints[constraints.resolution].resolution,\r\n            };\r\n        }\r\n        return constraints.video;\r\n    }\r\n    getTrack(kind) {\r\n        let tracks;\r\n        if (kind === 'video') {\r\n            tracks = this.getVideoTracks();\r\n            return tracks.length > 0 ? this.getVideoTracks()[0] : undefined;\r\n        }\r\n        tracks = this.getAudioTracks();\r\n        return tracks.length > 0 ? this.getAudioTracks()[0] : undefined;\r\n    }\r\n    async getNewTrack(kind) {\r\n        const stream = await navigator.mediaDevices.getUserMedia({\r\n            [kind]: kind === 'video'\r\n                ? LocalStream.computeVideoConstraints(this.constraints)\r\n                : LocalStream.computeAudioConstraints(this.constraints),\r\n        });\r\n        return stream.getTracks()[0];\r\n    }\r\n    publishTrack(track) {\r\n        if (this.pc) {\r\n            if (track.kind === 'video' && this.constraints.simulcast) {\r\n                const idx = resolutions.indexOf(this.constraints.resolution);\r\n                const encodings = [\r\n                    {\r\n                        rid: 'f',\r\n                        maxBitrate: exports.VideoConstraints[resolutions[idx]].encodings.maxBitrate,\r\n                        maxFramerate: exports.VideoConstraints[resolutions[idx]].encodings.maxFramerate,\r\n                    },\r\n                ];\r\n                if (idx - 1 >= 0) {\r\n                    encodings.push({\r\n                        rid: 'h',\r\n                        scaleResolutionDownBy: 2.0,\r\n                        maxBitrate: exports.VideoConstraints[resolutions[idx - 1]].encodings.maxBitrate,\r\n                        maxFramerate: exports.VideoConstraints[resolutions[idx - 1]].encodings.maxFramerate,\r\n                    });\r\n                }\r\n                if (idx - 2 >= 0) {\r\n                    encodings.push({\r\n                        rid: 'q',\r\n                        scaleResolutionDownBy: 4.0,\r\n                        maxBitrate: exports.VideoConstraints[resolutions[idx - 2]].encodings.maxBitrate,\r\n                        maxFramerate: exports.VideoConstraints[resolutions[idx - 2]].encodings.maxFramerate,\r\n                    });\r\n                }\r\n                const transceiver = this.pc.addTransceiver(track, {\r\n                    streams: [this],\r\n                    direction: 'sendonly',\r\n                    sendEncodings: encodings,\r\n                });\r\n                this.setPreferredCodec(transceiver);\r\n            }\r\n            else {\r\n                const transceiver = this.pc.addTransceiver(track, {\r\n                    streams: [this],\r\n                    direction: 'sendonly',\r\n                    sendEncodings: track.kind === 'video' ? [exports.VideoConstraints[this.constraints.resolution].encodings] : undefined,\r\n                });\r\n                if (track.kind === 'video') {\r\n                    this.setPreferredCodec(transceiver);\r\n                }\r\n            }\r\n        }\r\n    }\r\n    setPreferredCodec(transceiver) {\r\n        if ('setCodecPreferences' in transceiver) {\r\n            const cap = RTCRtpSender.getCapabilities('video');\r\n            if (!cap)\r\n                return;\r\n            const selCodec = cap.codecs.find((c) => c.mimeType === `video/${this.constraints.codec.toUpperCase()}` || c.mimeType === `audio/OPUS`);\r\n            if (selCodec) {\r\n                transceiver.setCodecPreferences([selCodec]);\r\n            }\r\n        }\r\n    }\r\n    updateTrack(next, prev) {\r\n        this.addTrack(next);\r\n        // If published, replace published track with track from new device\r\n        if (prev) {\r\n            this.removeTrack(prev);\r\n            prev.stop();\r\n            if (this.pc) {\r\n                this.pc.getSenders().forEach(async (sender) => {\r\n                    var _a, _b;\r\n                    if (((_a = sender === null || sender === void 0 ? void 0 : sender.track) === null || _a === void 0 ? void 0 : _a.kind) === next.kind) {\r\n                        (_b = sender.track) === null || _b === void 0 ? void 0 : _b.stop();\r\n                        sender.replaceTrack(next);\r\n                    }\r\n                });\r\n            }\r\n        }\r\n        else {\r\n            this.addTrack(next);\r\n            if (this.pc) {\r\n                this.publishTrack(next);\r\n            }\r\n        }\r\n    }\r\n    publish(pc) {\r\n        this.pc = pc;\r\n        this.getTracks().forEach(this.publishTrack.bind(this));\r\n    }\r\n    unpublish() {\r\n        if (this.pc) {\r\n            const tracks = this.getTracks();\r\n            this.pc.getSenders().forEach((s) => {\r\n                if (s.track && tracks.includes(s.track)) {\r\n                    this.pc.removeTrack(s);\r\n                }\r\n            });\r\n        }\r\n    }\r\n    async switchDevice(kind, deviceId) {\r\n        this.constraints = {\r\n            ...this.constraints,\r\n            [kind]: this.constraints[kind] instanceof Object\r\n                ? {\r\n                    ...this.constraints[kind],\r\n                    deviceId,\r\n                }\r\n                : { deviceId },\r\n        };\r\n        const prev = this.getTrack(kind);\r\n        const next = await this.getNewTrack(kind);\r\n        this.updateTrack(next, prev);\r\n    }\r\n    mute(kind) {\r\n        const track = this.getTrack(kind);\r\n        if (track) {\r\n            track.stop();\r\n        }\r\n    }\r\n    async unmute(kind) {\r\n        const prev = this.getTrack(kind);\r\n        const track = await this.getNewTrack(kind);\r\n        this.updateTrack(track, prev);\r\n    }\r\n}\r\nexports.LocalStream = LocalStream;\r\nfunction makeRemote(stream, transport) {\r\n    const remote = stream;\r\n    remote.audio = true;\r\n    remote.video = 'none';\r\n    remote._videoPreMute = 'high';\r\n    const select = () => {\r\n        const call = {\r\n            streamId: remote.id,\r\n            video: remote.video,\r\n            audio: remote.audio,\r\n        };\r\n        if (transport.api) {\r\n            if (transport.api.readyState !== 'open') {\r\n                // queue call if we aren't open yet\r\n                transport.api.onopen = () => { var _a; return (_a = transport.api) === null || _a === void 0 ? void 0 : _a.send(JSON.stringify(call)); };\r\n            }\r\n            else {\r\n                transport.api.send(JSON.stringify(call));\r\n            }\r\n        }\r\n    };\r\n    remote.preferLayer = (layer) => {\r\n        remote.video = layer;\r\n        select();\r\n    };\r\n    remote.mute = (kind) => {\r\n        if (kind === 'audio') {\r\n            remote.audio = false;\r\n        }\r\n        else if (kind === 'video') {\r\n            remote._videoPreMute = remote.video;\r\n            remote.video = 'none';\r\n        }\r\n        select();\r\n    };\r\n    remote.unmute = (kind) => {\r\n        if (kind === 'audio') {\r\n            remote.audio = true;\r\n        }\r\n        else if (kind === 'video') {\r\n            remote.video = remote._videoPreMute;\r\n        }\r\n        select();\r\n    };\r\n    return remote;\r\n}\r\nexports.makeRemote = makeRemote;\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9Jb25TREsvLi9zcmMvc3RyZWFtLnRzP2U2ZGYiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBOEMsY0FBYztBQUM1RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLGFBQWE7QUFDakMscUJBQXFCLGFBQWE7QUFDbEM7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1QsS0FBSztBQUNMO0FBQ0E7QUFDQSxvQkFBb0IsYUFBYTtBQUNqQyxxQkFBcUIsYUFBYTtBQUNsQztBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCxLQUFLO0FBQ0w7QUFDQTtBQUNBLG9CQUFvQixhQUFhO0FBQ2pDLHFCQUFxQixhQUFhO0FBQ2xDO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULEtBQUs7QUFDTDtBQUNBO0FBQ0Esb0JBQW9CLGNBQWM7QUFDbEMscUJBQXFCLGFBQWE7QUFDbEM7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1QsS0FBSztBQUNMO0FBQ0E7QUFDQSxvQkFBb0IsY0FBYztBQUNsQyxxQkFBcUIsY0FBYztBQUNuQztBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCxLQUFLO0FBQ0w7QUFDQTtBQUNBLG9CQUFvQixjQUFjO0FBQ2xDLHFCQUFxQixjQUFjO0FBQ25DO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEVBQTRFLHFDQUFxQztBQUNqSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQixXQUFXO0FBQzlCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4Q0FBOEMsUUFBUSxnR0FBZ0c7QUFDdEo7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiIwLmpzIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxuZXhwb3J0cy5tYWtlUmVtb3RlID0gZXhwb3J0cy5Mb2NhbFN0cmVhbSA9IGV4cG9ydHMuVmlkZW9Db25zdHJhaW50cyA9IHZvaWQgMDtcclxuY29uc3QgcmVzb2x1dGlvbnMgPSBbJ3F2Z2EnLCAndmdhJywgJ3NoZCcsICdoZCcsICdmaGQnLCAncWhkJ107XHJcbmV4cG9ydHMuVmlkZW9Db25zdHJhaW50cyA9IHtcclxuICAgIHF2Z2E6IHtcclxuICAgICAgICByZXNvbHV0aW9uOiB7XHJcbiAgICAgICAgICAgIHdpZHRoOiB7IGlkZWFsOiAzMjAgfSxcclxuICAgICAgICAgICAgaGVpZ2h0OiB7IGlkZWFsOiAxODAgfSxcclxuICAgICAgICAgICAgZnJhbWVSYXRlOiB7XHJcbiAgICAgICAgICAgICAgICBpZGVhbDogMTUsXHJcbiAgICAgICAgICAgICAgICBtYXg6IDMwLFxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW5jb2RpbmdzOiB7XHJcbiAgICAgICAgICAgIG1heEJpdHJhdGU6IDE1MDAwMCxcclxuICAgICAgICAgICAgbWF4RnJhbWVyYXRlOiAxNS4wLFxyXG4gICAgICAgIH0sXHJcbiAgICB9LFxyXG4gICAgdmdhOiB7XHJcbiAgICAgICAgcmVzb2x1dGlvbjoge1xyXG4gICAgICAgICAgICB3aWR0aDogeyBpZGVhbDogNjQwIH0sXHJcbiAgICAgICAgICAgIGhlaWdodDogeyBpZGVhbDogMzYwIH0sXHJcbiAgICAgICAgICAgIGZyYW1lUmF0ZToge1xyXG4gICAgICAgICAgICAgICAgaWRlYWw6IDMwLFxyXG4gICAgICAgICAgICAgICAgbWF4OiA2MCxcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVuY29kaW5nczoge1xyXG4gICAgICAgICAgICBtYXhCaXRyYXRlOiA1MDAwMDAsXHJcbiAgICAgICAgICAgIG1heEZyYW1lcmF0ZTogMzAuMCxcclxuICAgICAgICB9LFxyXG4gICAgfSxcclxuICAgIHNoZDoge1xyXG4gICAgICAgIHJlc29sdXRpb246IHtcclxuICAgICAgICAgICAgd2lkdGg6IHsgaWRlYWw6IDk2MCB9LFxyXG4gICAgICAgICAgICBoZWlnaHQ6IHsgaWRlYWw6IDU0MCB9LFxyXG4gICAgICAgICAgICBmcmFtZVJhdGU6IHtcclxuICAgICAgICAgICAgICAgIGlkZWFsOiAzMCxcclxuICAgICAgICAgICAgICAgIG1heDogNjAsXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbmNvZGluZ3M6IHtcclxuICAgICAgICAgICAgbWF4Qml0cmF0ZTogMTIwMDAwMCxcclxuICAgICAgICAgICAgbWF4RnJhbWVyYXRlOiAzMC4wLFxyXG4gICAgICAgIH0sXHJcbiAgICB9LFxyXG4gICAgaGQ6IHtcclxuICAgICAgICByZXNvbHV0aW9uOiB7XHJcbiAgICAgICAgICAgIHdpZHRoOiB7IGlkZWFsOiAxMjgwIH0sXHJcbiAgICAgICAgICAgIGhlaWdodDogeyBpZGVhbDogNzIwIH0sXHJcbiAgICAgICAgICAgIGZyYW1lUmF0ZToge1xyXG4gICAgICAgICAgICAgICAgaWRlYWw6IDMwLFxyXG4gICAgICAgICAgICAgICAgbWF4OiA2MCxcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVuY29kaW5nczoge1xyXG4gICAgICAgICAgICBtYXhCaXRyYXRlOiAyNTAwMDAwLFxyXG4gICAgICAgICAgICBtYXhGcmFtZXJhdGU6IDMwLjAsXHJcbiAgICAgICAgfSxcclxuICAgIH0sXHJcbiAgICBmaGQ6IHtcclxuICAgICAgICByZXNvbHV0aW9uOiB7XHJcbiAgICAgICAgICAgIHdpZHRoOiB7IGlkZWFsOiAxOTIwIH0sXHJcbiAgICAgICAgICAgIGhlaWdodDogeyBpZGVhbDogMTA4MCB9LFxyXG4gICAgICAgICAgICBmcmFtZVJhdGU6IHtcclxuICAgICAgICAgICAgICAgIGlkZWFsOiAzMCxcclxuICAgICAgICAgICAgICAgIG1heDogNjAsXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbmNvZGluZ3M6IHtcclxuICAgICAgICAgICAgbWF4Qml0cmF0ZTogNDAwMDAwMCxcclxuICAgICAgICAgICAgbWF4RnJhbWVyYXRlOiAzMC4wLFxyXG4gICAgICAgIH0sXHJcbiAgICB9LFxyXG4gICAgcWhkOiB7XHJcbiAgICAgICAgcmVzb2x1dGlvbjoge1xyXG4gICAgICAgICAgICB3aWR0aDogeyBpZGVhbDogMjU2MCB9LFxyXG4gICAgICAgICAgICBoZWlnaHQ6IHsgaWRlYWw6IDE0NDAgfSxcclxuICAgICAgICAgICAgZnJhbWVSYXRlOiB7XHJcbiAgICAgICAgICAgICAgICBpZGVhbDogMzAsXHJcbiAgICAgICAgICAgICAgICBtYXg6IDYwLFxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW5jb2RpbmdzOiB7XHJcbiAgICAgICAgICAgIG1heEJpdHJhdGU6IDgwMDAwMDAsXHJcbiAgICAgICAgICAgIG1heEZyYW1lcmF0ZTogMzAuMCxcclxuICAgICAgICB9LFxyXG4gICAgfSxcclxufTtcclxuY29uc3QgZGVmYXVsdHMgPSB7XHJcbiAgICByZXNvbHV0aW9uOiAnaGQnLFxyXG4gICAgY29kZWM6ICd2cDgnLFxyXG4gICAgYXVkaW86IHRydWUsXHJcbiAgICB2aWRlbzogdHJ1ZSxcclxuICAgIHNpbXVsY2FzdDogZmFsc2UsXHJcbn07XHJcbmNsYXNzIExvY2FsU3RyZWFtIGV4dGVuZHMgTWVkaWFTdHJlYW0ge1xyXG4gICAgY29uc3RydWN0b3Ioc3RyZWFtLCBjb25zdHJhaW50cykge1xyXG4gICAgICAgIHN1cGVyKHN0cmVhbSk7XHJcbiAgICAgICAgdGhpcy5jb25zdHJhaW50cyA9IGNvbnN0cmFpbnRzO1xyXG4gICAgfVxyXG4gICAgc3RhdGljIGFzeW5jIGdldFVzZXJNZWRpYShjb25zdHJhaW50cyA9IGRlZmF1bHRzKSB7XHJcbiAgICAgICAgY29uc3Qgc3RyZWFtID0gYXdhaXQgbmF2aWdhdG9yLm1lZGlhRGV2aWNlcy5nZXRVc2VyTWVkaWEoe1xyXG4gICAgICAgICAgICBhdWRpbzogTG9jYWxTdHJlYW0uY29tcHV0ZUF1ZGlvQ29uc3RyYWludHMoe1xyXG4gICAgICAgICAgICAgICAgLi4uZGVmYXVsdHMsXHJcbiAgICAgICAgICAgICAgICAuLi5jb25zdHJhaW50cyxcclxuICAgICAgICAgICAgfSksXHJcbiAgICAgICAgICAgIHZpZGVvOiBMb2NhbFN0cmVhbS5jb21wdXRlVmlkZW9Db25zdHJhaW50cyh7XHJcbiAgICAgICAgICAgICAgICAuLi5kZWZhdWx0cyxcclxuICAgICAgICAgICAgICAgIC4uLmNvbnN0cmFpbnRzLFxyXG4gICAgICAgICAgICB9KSxcclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gbmV3IExvY2FsU3RyZWFtKHN0cmVhbSwge1xyXG4gICAgICAgICAgICAuLi5kZWZhdWx0cyxcclxuICAgICAgICAgICAgLi4uY29uc3RyYWludHMsXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBzdGF0aWMgYXN5bmMgZ2V0RGlzcGxheU1lZGlhKGNvbnN0cmFpbnRzID0ge1xyXG4gICAgICAgIGNvZGVjOiAndnA4JyxcclxuICAgICAgICByZXNvbHV0aW9uOiAnaGQnLFxyXG4gICAgICAgIGF1ZGlvOiBmYWxzZSxcclxuICAgICAgICB2aWRlbzogdHJ1ZSxcclxuICAgICAgICBzaW11bGNhc3Q6IGZhbHNlLFxyXG4gICAgfSkge1xyXG4gICAgICAgIC8vIEB0cy1pZ25vcmVcclxuICAgICAgICBjb25zdCBzdHJlYW0gPSBhd2FpdCBuYXZpZ2F0b3IubWVkaWFEZXZpY2VzLmdldERpc3BsYXlNZWRpYSh7XHJcbiAgICAgICAgICAgIHZpZGVvOiB0cnVlLFxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiBuZXcgTG9jYWxTdHJlYW0oc3RyZWFtLCB7XHJcbiAgICAgICAgICAgIC4uLmRlZmF1bHRzLFxyXG4gICAgICAgICAgICAuLi5jb25zdHJhaW50cyxcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIHN0YXRpYyBjb21wdXRlQXVkaW9Db25zdHJhaW50cyhjb25zdHJhaW50cykge1xyXG4gICAgICAgIHJldHVybiBjb25zdHJhaW50cy5hdWRpbztcclxuICAgIH1cclxuICAgIHN0YXRpYyBjb21wdXRlVmlkZW9Db25zdHJhaW50cyhjb25zdHJhaW50cykge1xyXG4gICAgICAgIGlmIChjb25zdHJhaW50cy52aWRlbyBpbnN0YW5jZW9mIE9iamVjdCkge1xyXG4gICAgICAgICAgICByZXR1cm4gY29uc3RyYWludHMudmlkZW87XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKGNvbnN0cmFpbnRzLnZpZGVvICYmIGNvbnN0cmFpbnRzLnJlc29sdXRpb24pIHtcclxuICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgIC4uLmV4cG9ydHMuVmlkZW9Db25zdHJhaW50c1tjb25zdHJhaW50cy5yZXNvbHV0aW9uXS5yZXNvbHV0aW9uLFxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gY29uc3RyYWludHMudmlkZW87XHJcbiAgICB9XHJcbiAgICBnZXRUcmFjayhraW5kKSB7XHJcbiAgICAgICAgbGV0IHRyYWNrcztcclxuICAgICAgICBpZiAoa2luZCA9PT0gJ3ZpZGVvJykge1xyXG4gICAgICAgICAgICB0cmFja3MgPSB0aGlzLmdldFZpZGVvVHJhY2tzKCk7XHJcbiAgICAgICAgICAgIHJldHVybiB0cmFja3MubGVuZ3RoID4gMCA/IHRoaXMuZ2V0VmlkZW9UcmFja3MoKVswXSA6IHVuZGVmaW5lZDtcclxuICAgICAgICB9XHJcbiAgICAgICAgdHJhY2tzID0gdGhpcy5nZXRBdWRpb1RyYWNrcygpO1xyXG4gICAgICAgIHJldHVybiB0cmFja3MubGVuZ3RoID4gMCA/IHRoaXMuZ2V0QXVkaW9UcmFja3MoKVswXSA6IHVuZGVmaW5lZDtcclxuICAgIH1cclxuICAgIGFzeW5jIGdldE5ld1RyYWNrKGtpbmQpIHtcclxuICAgICAgICBjb25zdCBzdHJlYW0gPSBhd2FpdCBuYXZpZ2F0b3IubWVkaWFEZXZpY2VzLmdldFVzZXJNZWRpYSh7XHJcbiAgICAgICAgICAgIFtraW5kXToga2luZCA9PT0gJ3ZpZGVvJ1xyXG4gICAgICAgICAgICAgICAgPyBMb2NhbFN0cmVhbS5jb21wdXRlVmlkZW9Db25zdHJhaW50cyh0aGlzLmNvbnN0cmFpbnRzKVxyXG4gICAgICAgICAgICAgICAgOiBMb2NhbFN0cmVhbS5jb21wdXRlQXVkaW9Db25zdHJhaW50cyh0aGlzLmNvbnN0cmFpbnRzKSxcclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gc3RyZWFtLmdldFRyYWNrcygpWzBdO1xyXG4gICAgfVxyXG4gICAgcHVibGlzaFRyYWNrKHRyYWNrKSB7XHJcbiAgICAgICAgaWYgKHRoaXMucGMpIHtcclxuICAgICAgICAgICAgaWYgKHRyYWNrLmtpbmQgPT09ICd2aWRlbycgJiYgdGhpcy5jb25zdHJhaW50cy5zaW11bGNhc3QpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGlkeCA9IHJlc29sdXRpb25zLmluZGV4T2YodGhpcy5jb25zdHJhaW50cy5yZXNvbHV0aW9uKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGVuY29kaW5ncyA9IFtcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJpZDogJ2YnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXhCaXRyYXRlOiBleHBvcnRzLlZpZGVvQ29uc3RyYWludHNbcmVzb2x1dGlvbnNbaWR4XV0uZW5jb2RpbmdzLm1heEJpdHJhdGUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1heEZyYW1lcmF0ZTogZXhwb3J0cy5WaWRlb0NvbnN0cmFpbnRzW3Jlc29sdXRpb25zW2lkeF1dLmVuY29kaW5ncy5tYXhGcmFtZXJhdGUsXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIF07XHJcbiAgICAgICAgICAgICAgICBpZiAoaWR4IC0gMSA+PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZW5jb2RpbmdzLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByaWQ6ICdoJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NhbGVSZXNvbHV0aW9uRG93bkJ5OiAyLjAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1heEJpdHJhdGU6IGV4cG9ydHMuVmlkZW9Db25zdHJhaW50c1tyZXNvbHV0aW9uc1tpZHggLSAxXV0uZW5jb2RpbmdzLm1heEJpdHJhdGUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1heEZyYW1lcmF0ZTogZXhwb3J0cy5WaWRlb0NvbnN0cmFpbnRzW3Jlc29sdXRpb25zW2lkeCAtIDFdXS5lbmNvZGluZ3MubWF4RnJhbWVyYXRlLFxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKGlkeCAtIDIgPj0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGVuY29kaW5ncy5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmlkOiAncScsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjYWxlUmVzb2x1dGlvbkRvd25CeTogNC4wLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXhCaXRyYXRlOiBleHBvcnRzLlZpZGVvQ29uc3RyYWludHNbcmVzb2x1dGlvbnNbaWR4IC0gMl1dLmVuY29kaW5ncy5tYXhCaXRyYXRlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXhGcmFtZXJhdGU6IGV4cG9ydHMuVmlkZW9Db25zdHJhaW50c1tyZXNvbHV0aW9uc1tpZHggLSAyXV0uZW5jb2RpbmdzLm1heEZyYW1lcmF0ZSxcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGNvbnN0IHRyYW5zY2VpdmVyID0gdGhpcy5wYy5hZGRUcmFuc2NlaXZlcih0cmFjaywge1xyXG4gICAgICAgICAgICAgICAgICAgIHN0cmVhbXM6IFt0aGlzXSxcclxuICAgICAgICAgICAgICAgICAgICBkaXJlY3Rpb246ICdzZW5kb25seScsXHJcbiAgICAgICAgICAgICAgICAgICAgc2VuZEVuY29kaW5nczogZW5jb2RpbmdzLFxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNldFByZWZlcnJlZENvZGVjKHRyYW5zY2VpdmVyKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHRyYW5zY2VpdmVyID0gdGhpcy5wYy5hZGRUcmFuc2NlaXZlcih0cmFjaywge1xyXG4gICAgICAgICAgICAgICAgICAgIHN0cmVhbXM6IFt0aGlzXSxcclxuICAgICAgICAgICAgICAgICAgICBkaXJlY3Rpb246ICdzZW5kb25seScsXHJcbiAgICAgICAgICAgICAgICAgICAgc2VuZEVuY29kaW5nczogdHJhY2sua2luZCA9PT0gJ3ZpZGVvJyA/IFtleHBvcnRzLlZpZGVvQ29uc3RyYWludHNbdGhpcy5jb25zdHJhaW50cy5yZXNvbHV0aW9uXS5lbmNvZGluZ3NdIDogdW5kZWZpbmVkLFxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICBpZiAodHJhY2sua2luZCA9PT0gJ3ZpZGVvJykge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0UHJlZmVycmVkQ29kZWModHJhbnNjZWl2ZXIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgc2V0UHJlZmVycmVkQ29kZWModHJhbnNjZWl2ZXIpIHtcclxuICAgICAgICBpZiAoJ3NldENvZGVjUHJlZmVyZW5jZXMnIGluIHRyYW5zY2VpdmVyKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNhcCA9IFJUQ1J0cFNlbmRlci5nZXRDYXBhYmlsaXRpZXMoJ3ZpZGVvJyk7XHJcbiAgICAgICAgICAgIGlmICghY2FwKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICBjb25zdCBzZWxDb2RlYyA9IGNhcC5jb2RlY3MuZmluZCgoYykgPT4gYy5taW1lVHlwZSA9PT0gYHZpZGVvLyR7dGhpcy5jb25zdHJhaW50cy5jb2RlYy50b1VwcGVyQ2FzZSgpfWAgfHwgYy5taW1lVHlwZSA9PT0gYGF1ZGlvL09QVVNgKTtcclxuICAgICAgICAgICAgaWYgKHNlbENvZGVjKSB7XHJcbiAgICAgICAgICAgICAgICB0cmFuc2NlaXZlci5zZXRDb2RlY1ByZWZlcmVuY2VzKFtzZWxDb2RlY10pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgdXBkYXRlVHJhY2sobmV4dCwgcHJldikge1xyXG4gICAgICAgIHRoaXMuYWRkVHJhY2sobmV4dCk7XHJcbiAgICAgICAgLy8gSWYgcHVibGlzaGVkLCByZXBsYWNlIHB1Ymxpc2hlZCB0cmFjayB3aXRoIHRyYWNrIGZyb20gbmV3IGRldmljZVxyXG4gICAgICAgIGlmIChwcmV2KSB7XHJcbiAgICAgICAgICAgIHRoaXMucmVtb3ZlVHJhY2socHJldik7XHJcbiAgICAgICAgICAgIHByZXYuc3RvcCgpO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5wYykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5wYy5nZXRTZW5kZXJzKCkuZm9yRWFjaChhc3luYyAoc2VuZGVyKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIF9hLCBfYjtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoKChfYSA9IHNlbmRlciA9PT0gbnVsbCB8fCBzZW5kZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNlbmRlci50cmFjaykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmtpbmQpID09PSBuZXh0LmtpbmQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgKF9iID0gc2VuZGVyLnRyYWNrKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Iuc3RvcCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZW5kZXIucmVwbGFjZVRyYWNrKG5leHQpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLmFkZFRyYWNrKG5leHQpO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5wYykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5wdWJsaXNoVHJhY2sobmV4dCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBwdWJsaXNoKHBjKSB7XHJcbiAgICAgICAgdGhpcy5wYyA9IHBjO1xyXG4gICAgICAgIHRoaXMuZ2V0VHJhY2tzKCkuZm9yRWFjaCh0aGlzLnB1Ymxpc2hUcmFjay5iaW5kKHRoaXMpKTtcclxuICAgIH1cclxuICAgIHVucHVibGlzaCgpIHtcclxuICAgICAgICBpZiAodGhpcy5wYykge1xyXG4gICAgICAgICAgICBjb25zdCB0cmFja3MgPSB0aGlzLmdldFRyYWNrcygpO1xyXG4gICAgICAgICAgICB0aGlzLnBjLmdldFNlbmRlcnMoKS5mb3JFYWNoKChzKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAocy50cmFjayAmJiB0cmFja3MuaW5jbHVkZXMocy50cmFjaykpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnBjLnJlbW92ZVRyYWNrKHMpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBhc3luYyBzd2l0Y2hEZXZpY2Uoa2luZCwgZGV2aWNlSWQpIHtcclxuICAgICAgICB0aGlzLmNvbnN0cmFpbnRzID0ge1xyXG4gICAgICAgICAgICAuLi50aGlzLmNvbnN0cmFpbnRzLFxyXG4gICAgICAgICAgICBba2luZF06IHRoaXMuY29uc3RyYWludHNba2luZF0gaW5zdGFuY2VvZiBPYmplY3RcclxuICAgICAgICAgICAgICAgID8ge1xyXG4gICAgICAgICAgICAgICAgICAgIC4uLnRoaXMuY29uc3RyYWludHNba2luZF0sXHJcbiAgICAgICAgICAgICAgICAgICAgZGV2aWNlSWQsXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICA6IHsgZGV2aWNlSWQgfSxcclxuICAgICAgICB9O1xyXG4gICAgICAgIGNvbnN0IHByZXYgPSB0aGlzLmdldFRyYWNrKGtpbmQpO1xyXG4gICAgICAgIGNvbnN0IG5leHQgPSBhd2FpdCB0aGlzLmdldE5ld1RyYWNrKGtpbmQpO1xyXG4gICAgICAgIHRoaXMudXBkYXRlVHJhY2sobmV4dCwgcHJldik7XHJcbiAgICB9XHJcbiAgICBtdXRlKGtpbmQpIHtcclxuICAgICAgICBjb25zdCB0cmFjayA9IHRoaXMuZ2V0VHJhY2soa2luZCk7XHJcbiAgICAgICAgaWYgKHRyYWNrKSB7XHJcbiAgICAgICAgICAgIHRyYWNrLnN0b3AoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBhc3luYyB1bm11dGUoa2luZCkge1xyXG4gICAgICAgIGNvbnN0IHByZXYgPSB0aGlzLmdldFRyYWNrKGtpbmQpO1xyXG4gICAgICAgIGNvbnN0IHRyYWNrID0gYXdhaXQgdGhpcy5nZXROZXdUcmFjayhraW5kKTtcclxuICAgICAgICB0aGlzLnVwZGF0ZVRyYWNrKHRyYWNrLCBwcmV2KTtcclxuICAgIH1cclxufVxyXG5leHBvcnRzLkxvY2FsU3RyZWFtID0gTG9jYWxTdHJlYW07XHJcbmZ1bmN0aW9uIG1ha2VSZW1vdGUoc3RyZWFtLCB0cmFuc3BvcnQpIHtcclxuICAgIGNvbnN0IHJlbW90ZSA9IHN0cmVhbTtcclxuICAgIHJlbW90ZS5hdWRpbyA9IHRydWU7XHJcbiAgICByZW1vdGUudmlkZW8gPSAnbm9uZSc7XHJcbiAgICByZW1vdGUuX3ZpZGVvUHJlTXV0ZSA9ICdoaWdoJztcclxuICAgIGNvbnN0IHNlbGVjdCA9ICgpID0+IHtcclxuICAgICAgICBjb25zdCBjYWxsID0ge1xyXG4gICAgICAgICAgICBzdHJlYW1JZDogcmVtb3RlLmlkLFxyXG4gICAgICAgICAgICB2aWRlbzogcmVtb3RlLnZpZGVvLFxyXG4gICAgICAgICAgICBhdWRpbzogcmVtb3RlLmF1ZGlvLFxyXG4gICAgICAgIH07XHJcbiAgICAgICAgaWYgKHRyYW5zcG9ydC5hcGkpIHtcclxuICAgICAgICAgICAgaWYgKHRyYW5zcG9ydC5hcGkucmVhZHlTdGF0ZSAhPT0gJ29wZW4nKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBxdWV1ZSBjYWxsIGlmIHdlIGFyZW4ndCBvcGVuIHlldFxyXG4gICAgICAgICAgICAgICAgdHJhbnNwb3J0LmFwaS5vbm9wZW4gPSAoKSA9PiB7IHZhciBfYTsgcmV0dXJuIChfYSA9IHRyYW5zcG9ydC5hcGkpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zZW5kKEpTT04uc3RyaW5naWZ5KGNhbGwpKTsgfTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRyYW5zcG9ydC5hcGkuc2VuZChKU09OLnN0cmluZ2lmeShjYWxsKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgcmVtb3RlLnByZWZlckxheWVyID0gKGxheWVyKSA9PiB7XHJcbiAgICAgICAgcmVtb3RlLnZpZGVvID0gbGF5ZXI7XHJcbiAgICAgICAgc2VsZWN0KCk7XHJcbiAgICB9O1xyXG4gICAgcmVtb3RlLm11dGUgPSAoa2luZCkgPT4ge1xyXG4gICAgICAgIGlmIChraW5kID09PSAnYXVkaW8nKSB7XHJcbiAgICAgICAgICAgIHJlbW90ZS5hdWRpbyA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmIChraW5kID09PSAndmlkZW8nKSB7XHJcbiAgICAgICAgICAgIHJlbW90ZS5fdmlkZW9QcmVNdXRlID0gcmVtb3RlLnZpZGVvO1xyXG4gICAgICAgICAgICByZW1vdGUudmlkZW8gPSAnbm9uZSc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHNlbGVjdCgpO1xyXG4gICAgfTtcclxuICAgIHJlbW90ZS51bm11dGUgPSAoa2luZCkgPT4ge1xyXG4gICAgICAgIGlmIChraW5kID09PSAnYXVkaW8nKSB7XHJcbiAgICAgICAgICAgIHJlbW90ZS5hdWRpbyA9IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKGtpbmQgPT09ICd2aWRlbycpIHtcclxuICAgICAgICAgICAgcmVtb3RlLnZpZGVvID0gcmVtb3RlLl92aWRlb1ByZU11dGU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHNlbGVjdCgpO1xyXG4gICAgfTtcclxuICAgIHJldHVybiByZW1vdGU7XHJcbn1cclxuZXhwb3J0cy5tYWtlUmVtb3RlID0gbWFrZVJlbW90ZTtcclxuIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///0\n")},function(module,exports,__webpack_require__){"use strict";eval('\r\nObject.defineProperty(exports, "__esModule", { value: true });\r\nexports.LocalStream = exports.Client = void 0;\r\nconst client_1 = __webpack_require__(2);\r\nexports.Client = client_1.default;\r\nconst stream_1 = __webpack_require__(0);\r\nObject.defineProperty(exports, "LocalStream", { enumerable: true, get: function () { return stream_1.LocalStream; } });\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9Jb25TREsvLi9zcmMvaW5kZXgudHM/NzFiZCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE4QyxjQUFjO0FBQzVEO0FBQ0EsaUJBQWlCLG1CQUFPLENBQUMsQ0FBVTtBQUNuQztBQUNBLGlCQUFpQixtQkFBTyxDQUFDLENBQVU7QUFDbkMsK0NBQStDLHFDQUFxQyw2QkFBNkIsRUFBRSxFQUFFIiwiZmlsZSI6IjEuanMiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcclxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG5leHBvcnRzLkxvY2FsU3RyZWFtID0gZXhwb3J0cy5DbGllbnQgPSB2b2lkIDA7XHJcbmNvbnN0IGNsaWVudF8xID0gcmVxdWlyZShcIi4vY2xpZW50XCIpO1xyXG5leHBvcnRzLkNsaWVudCA9IGNsaWVudF8xLmRlZmF1bHQ7XHJcbmNvbnN0IHN0cmVhbV8xID0gcmVxdWlyZShcIi4vc3RyZWFtXCIpO1xyXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJMb2NhbFN0cmVhbVwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gc3RyZWFtXzEuTG9jYWxTdHJlYW07IH0gfSk7XHJcbiJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///1\n')},function(module,exports,__webpack_require__){"use strict";eval("\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.Transport = void 0;\r\nconst stream_1 = __webpack_require__(0);\r\nconst API_CHANNEL = 'ion-sfu';\r\nconst ERR_NO_SESSION = 'no active session, join first';\r\nvar Role;\r\n(function (Role) {\r\n    Role[Role[\"pub\"] = 0] = \"pub\";\r\n    Role[Role[\"sub\"] = 1] = \"sub\";\r\n})(Role || (Role = {}));\r\nclass Transport {\r\n    constructor(role, signal, config) {\r\n        this.signal = signal;\r\n        this.pc = new RTCPeerConnection(config);\r\n        this.candidates = [];\r\n        if (role === Role.pub) {\r\n            this.pc.createDataChannel(API_CHANNEL);\r\n        }\r\n        this.pc.onicecandidate = ({ candidate }) => {\r\n            if (candidate) {\r\n                this.signal.trickle({ target: role, candidate });\r\n            }\r\n        };\r\n    }\r\n}\r\nexports.Transport = Transport;\r\nclass Client {\r\n    constructor(signal, config = {\r\n        codec: 'vp8',\r\n        iceServers: [\r\n            {\r\n                urls: [\r\n  'stun:stun.l.google.com:19302'   ],\r\n            },\r\n        ],\r\n    }) {\r\n        this.signal = signal;\r\n        this.config = config;\r\n        signal.onnegotiate = this.negotiate.bind(this);\r\n        signal.ontrickle = this.trickle.bind(this);\r\n    }\r\n    async join(sid) {\r\n        this.transports = {\r\n            [Role.pub]: new Transport(Role.pub, this.signal, this.config),\r\n            [Role.sub]: new Transport(Role.sub, this.signal, this.config),\r\n        };\r\n        this.transports[Role.sub].pc.ontrack = (ev) => {\r\n            const stream = ev.streams[0];\r\n            const remote = stream_1.makeRemote(stream, this.transports[Role.sub]);\r\n            if (this.ontrack) {\r\n                this.ontrack(ev.track, remote);\r\n            }\r\n        };\r\n        this.transports[Role.sub].pc.ondatachannel = (ev) => {\r\n            if (ev.channel.label === API_CHANNEL) {\r\n                this.transports[Role.sub].api = ev.channel;\r\n                return;\r\n            }\r\n            if (this.ondatachannel) {\r\n                this.ondatachannel(ev);\r\n            }\r\n        };\r\n        const offer = await this.transports[Role.pub].pc.createOffer();\r\n        await this.transports[Role.pub].pc.setLocalDescription(offer);\r\n        const answer = await this.signal.join(sid, offer);\r\n        await this.transports[Role.pub].pc.setRemoteDescription(answer);\r\n        this.transports[Role.pub].candidates.forEach((c) => this.transports[Role.pub].pc.addIceCandidate(c));\r\n        this.transports[Role.pub].pc.onnegotiationneeded = this.onNegotiationNeeded.bind(this);\r\n    }\r\n    leave() {\r\n        if (this.transports) {\r\n            Object.values(this.transports).forEach((t) => t.pc.close());\r\n            delete this.transports;\r\n        }\r\n    }\r\n    getPubStats(selector) {\r\n        if (!this.transports) {\r\n            throw Error(ERR_NO_SESSION);\r\n        }\r\n        return this.transports[Role.pub].pc.getStats(selector);\r\n    }\r\n    getSubStats(selector) {\r\n        if (!this.transports) {\r\n            throw Error(ERR_NO_SESSION);\r\n        }\r\n        return this.transports[Role.sub].pc.getStats(selector);\r\n    }\r\n    publish(stream) {\r\n        if (!this.transports) {\r\n            throw Error(ERR_NO_SESSION);\r\n        }\r\n        stream.publish(this.transports[Role.pub].pc);\r\n    }\r\n    createDataChannel(label) {\r\n        if (!this.transports) {\r\n            throw Error(ERR_NO_SESSION);\r\n        }\r\n        return this.transports[Role.pub].pc.createDataChannel(label);\r\n    }\r\n    close() {\r\n        if (this.transports) {\r\n            Object.values(this.transports).forEach((t) => t.pc.close());\r\n        }\r\n        this.signal.close();\r\n    }\r\n    trickle({ candidate, target }) {\r\n        if (!this.transports) {\r\n            throw Error(ERR_NO_SESSION);\r\n        }\r\n        if (this.transports[target].pc.remoteDescription) {\r\n            this.transports[target].pc.addIceCandidate(candidate);\r\n        }\r\n        else {\r\n            this.transports[target].candidates.push(candidate);\r\n        }\r\n    }\r\n    async negotiate(description) {\r\n        if (!this.transports) {\r\n            throw Error(ERR_NO_SESSION);\r\n        }\r\n        try {\r\n            await this.transports[Role.sub].pc.setRemoteDescription(description);\r\n            this.transports[Role.sub].candidates.forEach((c) => this.transports[Role.sub].pc.addIceCandidate(c));\r\n            this.transports[Role.sub].candidates = [];\r\n            const answer = await this.transports[Role.sub].pc.createAnswer();\r\n            await this.transports[Role.sub].pc.setLocalDescription(answer);\r\n            this.signal.answer(answer);\r\n        }\r\n        catch (err) {\r\n            /* tslint:disable-next-line:no-console */\r\n            console.error(err);\r\n        }\r\n    }\r\n    async onNegotiationNeeded() {\r\n        if (!this.transports) {\r\n            throw Error(ERR_NO_SESSION);\r\n        }\r\n        try {\r\n            const offer = await this.transports[Role.pub].pc.createOffer();\r\n            await this.transports[Role.pub].pc.setLocalDescription(offer);\r\n            const answer = await this.signal.offer(offer);\r\n            await this.transports[Role.pub].pc.setRemoteDescription(answer);\r\n        }\r\n        catch (err) {\r\n            /* tslint:disable-next-line:no-console */\r\n            console.error(err);\r\n        }\r\n    }\r\n}\r\nexports.default = Client;\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9Jb25TREsvLi9zcmMvY2xpZW50LnRzP2U3MWIiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBOEMsY0FBYztBQUM1RDtBQUNBLGlCQUFpQixtQkFBTyxDQUFDLENBQVU7QUFDbkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQyxvQkFBb0I7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1DQUFtQyxZQUFZO0FBQy9DO0FBQ0EscUNBQXFDLDBCQUEwQjtBQUMvRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWEsb0JBQW9CO0FBQ2pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiMi5qcyIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xyXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XHJcbmV4cG9ydHMuVHJhbnNwb3J0ID0gdm9pZCAwO1xyXG5jb25zdCBzdHJlYW1fMSA9IHJlcXVpcmUoXCIuL3N0cmVhbVwiKTtcclxuY29uc3QgQVBJX0NIQU5ORUwgPSAnaW9uLXNmdSc7XHJcbmNvbnN0IEVSUl9OT19TRVNTSU9OID0gJ25vIGFjdGl2ZSBzZXNzaW9uLCBqb2luIGZpcnN0JztcclxudmFyIFJvbGU7XHJcbihmdW5jdGlvbiAoUm9sZSkge1xyXG4gICAgUm9sZVtSb2xlW1wicHViXCJdID0gMF0gPSBcInB1YlwiO1xyXG4gICAgUm9sZVtSb2xlW1wic3ViXCJdID0gMV0gPSBcInN1YlwiO1xyXG59KShSb2xlIHx8IChSb2xlID0ge30pKTtcclxuY2xhc3MgVHJhbnNwb3J0IHtcclxuICAgIGNvbnN0cnVjdG9yKHJvbGUsIHNpZ25hbCwgY29uZmlnKSB7XHJcbiAgICAgICAgdGhpcy5zaWduYWwgPSBzaWduYWw7XHJcbiAgICAgICAgdGhpcy5wYyA9IG5ldyBSVENQZWVyQ29ubmVjdGlvbihjb25maWcpO1xyXG4gICAgICAgIHRoaXMuY2FuZGlkYXRlcyA9IFtdO1xyXG4gICAgICAgIGlmIChyb2xlID09PSBSb2xlLnB1Yikge1xyXG4gICAgICAgICAgICB0aGlzLnBjLmNyZWF0ZURhdGFDaGFubmVsKEFQSV9DSEFOTkVMKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5wYy5vbmljZWNhbmRpZGF0ZSA9ICh7IGNhbmRpZGF0ZSB9KSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChjYW5kaWRhdGUpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2lnbmFsLnRyaWNrbGUoeyB0YXJnZXQ6IHJvbGUsIGNhbmRpZGF0ZSB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcbn1cclxuZXhwb3J0cy5UcmFuc3BvcnQgPSBUcmFuc3BvcnQ7XHJcbmNsYXNzIENsaWVudCB7XHJcbiAgICBjb25zdHJ1Y3RvcihzaWduYWwsIGNvbmZpZyA9IHtcclxuICAgICAgICBjb2RlYzogJ3ZwOCcsXHJcbiAgICAgICAgaWNlU2VydmVyczogW1xyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB1cmxzOiBbXHJcbiAgICAgICAgICAgICAgICAgICAgJ3N0dW46c3R1bi5sLmdvb2dsZS5jb206MTkzMDInLFxyXG4gICAgICAgICAgICAgICAgICAgICdzdHVuOnN0dW4xLmwuZ29vZ2xlLmNvbToxOTMwMicsXHJcbiAgICAgICAgICAgICAgICAgICAgJ3N0dW46c3R1bjIubC5nb29nbGUuY29tOjE5MzAyJyxcclxuICAgICAgICAgICAgICAgICAgICAnc3R1bjpzdHVuMy5sLmdvb2dsZS5jb206MTkzMDInLFxyXG4gICAgICAgICAgICAgICAgICAgICdzdHVuOnN0dW40LmwuZ29vZ2xlLmNvbToxOTMwMicsXHJcbiAgICAgICAgICAgICAgICBdLFxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgIF0sXHJcbiAgICB9KSB7XHJcbiAgICAgICAgdGhpcy5zaWduYWwgPSBzaWduYWw7XHJcbiAgICAgICAgdGhpcy5jb25maWcgPSBjb25maWc7XHJcbiAgICAgICAgc2lnbmFsLm9ubmVnb3RpYXRlID0gdGhpcy5uZWdvdGlhdGUuYmluZCh0aGlzKTtcclxuICAgICAgICBzaWduYWwub250cmlja2xlID0gdGhpcy50cmlja2xlLmJpbmQodGhpcyk7XHJcbiAgICB9XHJcbiAgICBhc3luYyBqb2luKHNpZCkge1xyXG4gICAgICAgIHRoaXMudHJhbnNwb3J0cyA9IHtcclxuICAgICAgICAgICAgW1JvbGUucHViXTogbmV3IFRyYW5zcG9ydChSb2xlLnB1YiwgdGhpcy5zaWduYWwsIHRoaXMuY29uZmlnKSxcclxuICAgICAgICAgICAgW1JvbGUuc3ViXTogbmV3IFRyYW5zcG9ydChSb2xlLnN1YiwgdGhpcy5zaWduYWwsIHRoaXMuY29uZmlnKSxcclxuICAgICAgICB9O1xyXG4gICAgICAgIHRoaXMudHJhbnNwb3J0c1tSb2xlLnN1Yl0ucGMub250cmFjayA9IChldikgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBzdHJlYW0gPSBldi5zdHJlYW1zWzBdO1xyXG4gICAgICAgICAgICBjb25zdCByZW1vdGUgPSBzdHJlYW1fMS5tYWtlUmVtb3RlKHN0cmVhbSwgdGhpcy50cmFuc3BvcnRzW1JvbGUuc3ViXSk7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLm9udHJhY2spIHtcclxuICAgICAgICAgICAgICAgIHRoaXMub250cmFjayhldi50cmFjaywgcmVtb3RlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgdGhpcy50cmFuc3BvcnRzW1JvbGUuc3ViXS5wYy5vbmRhdGFjaGFubmVsID0gKGV2KSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChldi5jaGFubmVsLmxhYmVsID09PSBBUElfQ0hBTk5FTCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy50cmFuc3BvcnRzW1JvbGUuc3ViXS5hcGkgPSBldi5jaGFubmVsO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh0aGlzLm9uZGF0YWNoYW5uZWwpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMub25kYXRhY2hhbm5lbChldik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgICAgIGNvbnN0IG9mZmVyID0gYXdhaXQgdGhpcy50cmFuc3BvcnRzW1JvbGUucHViXS5wYy5jcmVhdGVPZmZlcigpO1xyXG4gICAgICAgIGF3YWl0IHRoaXMudHJhbnNwb3J0c1tSb2xlLnB1Yl0ucGMuc2V0TG9jYWxEZXNjcmlwdGlvbihvZmZlcik7XHJcbiAgICAgICAgY29uc3QgYW5zd2VyID0gYXdhaXQgdGhpcy5zaWduYWwuam9pbihzaWQsIG9mZmVyKTtcclxuICAgICAgICBhd2FpdCB0aGlzLnRyYW5zcG9ydHNbUm9sZS5wdWJdLnBjLnNldFJlbW90ZURlc2NyaXB0aW9uKGFuc3dlcik7XHJcbiAgICAgICAgdGhpcy50cmFuc3BvcnRzW1JvbGUucHViXS5jYW5kaWRhdGVzLmZvckVhY2goKGMpID0+IHRoaXMudHJhbnNwb3J0c1tSb2xlLnB1Yl0ucGMuYWRkSWNlQ2FuZGlkYXRlKGMpKTtcclxuICAgICAgICB0aGlzLnRyYW5zcG9ydHNbUm9sZS5wdWJdLnBjLm9ubmVnb3RpYXRpb25uZWVkZWQgPSB0aGlzLm9uTmVnb3RpYXRpb25OZWVkZWQuYmluZCh0aGlzKTtcclxuICAgIH1cclxuICAgIGxlYXZlKCkge1xyXG4gICAgICAgIGlmICh0aGlzLnRyYW5zcG9ydHMpIHtcclxuICAgICAgICAgICAgT2JqZWN0LnZhbHVlcyh0aGlzLnRyYW5zcG9ydHMpLmZvckVhY2goKHQpID0+IHQucGMuY2xvc2UoKSk7XHJcbiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLnRyYW5zcG9ydHM7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgZ2V0UHViU3RhdHMoc2VsZWN0b3IpIHtcclxuICAgICAgICBpZiAoIXRoaXMudHJhbnNwb3J0cykge1xyXG4gICAgICAgICAgICB0aHJvdyBFcnJvcihFUlJfTk9fU0VTU0lPTik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0aGlzLnRyYW5zcG9ydHNbUm9sZS5wdWJdLnBjLmdldFN0YXRzKHNlbGVjdG9yKTtcclxuICAgIH1cclxuICAgIGdldFN1YlN0YXRzKHNlbGVjdG9yKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLnRyYW5zcG9ydHMpIHtcclxuICAgICAgICAgICAgdGhyb3cgRXJyb3IoRVJSX05PX1NFU1NJT04pO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGhpcy50cmFuc3BvcnRzW1JvbGUuc3ViXS5wYy5nZXRTdGF0cyhzZWxlY3Rvcik7XHJcbiAgICB9XHJcbiAgICBwdWJsaXNoKHN0cmVhbSkge1xyXG4gICAgICAgIGlmICghdGhpcy50cmFuc3BvcnRzKSB7XHJcbiAgICAgICAgICAgIHRocm93IEVycm9yKEVSUl9OT19TRVNTSU9OKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgc3RyZWFtLnB1Ymxpc2godGhpcy50cmFuc3BvcnRzW1JvbGUucHViXS5wYyk7XHJcbiAgICB9XHJcbiAgICBjcmVhdGVEYXRhQ2hhbm5lbChsYWJlbCkge1xyXG4gICAgICAgIGlmICghdGhpcy50cmFuc3BvcnRzKSB7XHJcbiAgICAgICAgICAgIHRocm93IEVycm9yKEVSUl9OT19TRVNTSU9OKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMudHJhbnNwb3J0c1tSb2xlLnB1Yl0ucGMuY3JlYXRlRGF0YUNoYW5uZWwobGFiZWwpO1xyXG4gICAgfVxyXG4gICAgY2xvc2UoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMudHJhbnNwb3J0cykge1xyXG4gICAgICAgICAgICBPYmplY3QudmFsdWVzKHRoaXMudHJhbnNwb3J0cykuZm9yRWFjaCgodCkgPT4gdC5wYy5jbG9zZSgpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5zaWduYWwuY2xvc2UoKTtcclxuICAgIH1cclxuICAgIHRyaWNrbGUoeyBjYW5kaWRhdGUsIHRhcmdldCB9KSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLnRyYW5zcG9ydHMpIHtcclxuICAgICAgICAgICAgdGhyb3cgRXJyb3IoRVJSX05PX1NFU1NJT04pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy50cmFuc3BvcnRzW3RhcmdldF0ucGMucmVtb3RlRGVzY3JpcHRpb24pIHtcclxuICAgICAgICAgICAgdGhpcy50cmFuc3BvcnRzW3RhcmdldF0ucGMuYWRkSWNlQ2FuZGlkYXRlKGNhbmRpZGF0ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLnRyYW5zcG9ydHNbdGFyZ2V0XS5jYW5kaWRhdGVzLnB1c2goY2FuZGlkYXRlKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBhc3luYyBuZWdvdGlhdGUoZGVzY3JpcHRpb24pIHtcclxuICAgICAgICBpZiAoIXRoaXMudHJhbnNwb3J0cykge1xyXG4gICAgICAgICAgICB0aHJvdyBFcnJvcihFUlJfTk9fU0VTU0lPTik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGF3YWl0IHRoaXMudHJhbnNwb3J0c1tSb2xlLnN1Yl0ucGMuc2V0UmVtb3RlRGVzY3JpcHRpb24oZGVzY3JpcHRpb24pO1xyXG4gICAgICAgICAgICB0aGlzLnRyYW5zcG9ydHNbUm9sZS5zdWJdLmNhbmRpZGF0ZXMuZm9yRWFjaCgoYykgPT4gdGhpcy50cmFuc3BvcnRzW1JvbGUuc3ViXS5wYy5hZGRJY2VDYW5kaWRhdGUoYykpO1xyXG4gICAgICAgICAgICB0aGlzLnRyYW5zcG9ydHNbUm9sZS5zdWJdLmNhbmRpZGF0ZXMgPSBbXTtcclxuICAgICAgICAgICAgY29uc3QgYW5zd2VyID0gYXdhaXQgdGhpcy50cmFuc3BvcnRzW1JvbGUuc3ViXS5wYy5jcmVhdGVBbnN3ZXIoKTtcclxuICAgICAgICAgICAgYXdhaXQgdGhpcy50cmFuc3BvcnRzW1JvbGUuc3ViXS5wYy5zZXRMb2NhbERlc2NyaXB0aW9uKGFuc3dlcik7XHJcbiAgICAgICAgICAgIHRoaXMuc2lnbmFsLmFuc3dlcihhbnN3ZXIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjYXRjaCAoZXJyKSB7XHJcbiAgICAgICAgICAgIC8qIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1jb25zb2xlICovXHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBhc3luYyBvbk5lZ290aWF0aW9uTmVlZGVkKCkge1xyXG4gICAgICAgIGlmICghdGhpcy50cmFuc3BvcnRzKSB7XHJcbiAgICAgICAgICAgIHRocm93IEVycm9yKEVSUl9OT19TRVNTSU9OKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgY29uc3Qgb2ZmZXIgPSBhd2FpdCB0aGlzLnRyYW5zcG9ydHNbUm9sZS5wdWJdLnBjLmNyZWF0ZU9mZmVyKCk7XHJcbiAgICAgICAgICAgIGF3YWl0IHRoaXMudHJhbnNwb3J0c1tSb2xlLnB1Yl0ucGMuc2V0TG9jYWxEZXNjcmlwdGlvbihvZmZlcik7XHJcbiAgICAgICAgICAgIGNvbnN0IGFuc3dlciA9IGF3YWl0IHRoaXMuc2lnbmFsLm9mZmVyKG9mZmVyKTtcclxuICAgICAgICAgICAgYXdhaXQgdGhpcy50cmFuc3BvcnRzW1JvbGUucHViXS5wYy5zZXRSZW1vdGVEZXNjcmlwdGlvbihhbnN3ZXIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjYXRjaCAoZXJyKSB7XHJcbiAgICAgICAgICAgIC8qIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1jb25zb2xlICovXHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuZXhwb3J0cy5kZWZhdWx0ID0gQ2xpZW50O1xyXG4iXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///2\n")}]);