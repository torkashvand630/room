(function(n){if(typeof exports=="object"&&typeof module!="undefined")module.exports=n();else if(typeof define=="function"&&define.amd)define([],n);else{var t;t=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:this;t.adapter=n()}})(function(){return function(){function n(t,i,r){function u(f,o){var h,c,s;if(!i[f]){if(!t[f]){if(h="function"==typeof require&&require,!o&&h)return h(f,!0);if(e)return e(f,!0);c=new Error("Cannot find module '"+f+"'");throw c.code="MODULE_NOT_FOUND",c;}s=i[f]={exports:{}};t[f][0].call(s.exports,function(n){var i=t[f][1][n];return u(i||n)},s,s.exports,n,t,i,r)}return i[f].exports}for(var e="function"==typeof require&&require,f=0;f<r.length;f++)u(r[f]);return u}return n}()({1:[function(n,t){"use strict";var i=n("./adapter_factory.js"),r=i.adapterFactory({window:window});t.exports=r},{"./adapter_factory.js":2}],2:[function(n,t,i){"use strict";function s(n){var t,i;if(n&&n.__esModule)return n;if(t={},n!=null)for(i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i]);return t.default=n,t}function w(){var l=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},n=l.window,s=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0},t=h.log,c=h.detectBrowser(n),i={browserDetails:c,commonShim:r,extractVersion:h.extractVersion,disableLog:h.disableLog,disableWarnings:h.disableWarnings};switch(c.browser){case"chrome":if(!f||!f.shimPeerConnection||!s.shimChrome)return t("Chrome shim is not included in this adapter release."),i;t("adapter.js shimming chrome.");i.browserShim=f;f.shimGetUserMedia(n);f.shimMediaStream(n);f.shimPeerConnection(n);f.shimOnTrack(n);f.shimAddTrackRemoveTrack(n);f.shimGetSendersWithDtmf(n);f.shimGetStats(n);f.shimSenderReceiverGetStats(n);f.fixNegotiationNeeded(n);r.shimRTCIceCandidate(n);r.shimConnectionState(n);r.shimMaxMessageSize(n);r.shimSendThrowTypeError(n);r.removeAllowExtmapMixed(n);break;case"firefox":if(!u||!u.shimPeerConnection||!s.shimFirefox)return t("Firefox shim is not included in this adapter release."),i;t("adapter.js shimming firefox.");i.browserShim=u;u.shimGetUserMedia(n);u.shimPeerConnection(n);u.shimOnTrack(n);u.shimRemoveStream(n);u.shimSenderGetStats(n);u.shimReceiverGetStats(n);u.shimRTCDataChannel(n);u.shimAddTransceiver(n);u.shimCreateOffer(n);u.shimCreateAnswer(n);r.shimRTCIceCandidate(n);r.shimConnectionState(n);r.shimMaxMessageSize(n);r.shimSendThrowTypeError(n);break;case"edge":if(!o||!o.shimPeerConnection||!s.shimEdge)return t("MS edge shim is not included in this adapter release."),i;t("adapter.js shimming edge.");i.browserShim=o;o.shimGetUserMedia(n);o.shimGetDisplayMedia(n);o.shimPeerConnection(n);o.shimReplaceTrack(n);r.shimMaxMessageSize(n);r.shimSendThrowTypeError(n);break;case"safari":if(!e||!s.shimSafari)return t("Safari shim is not included in this adapter release."),i;t("adapter.js shimming safari.");i.browserShim=e;e.shimRTCIceServerUrls(n);e.shimCreateOfferLegacy(n);e.shimCallbacksAPI(n);e.shimLocalStreamsAPI(n);e.shimRemoteStreamsAPI(n);e.shimTrackEventTransceiver(n);e.shimGetUserMedia(n);r.shimRTCIceCandidate(n);r.shimMaxMessageSize(n);r.shimSendThrowTypeError(n);r.removeAllowExtmapMixed(n);break;default:t("Unsupported browser!")}return i}Object.defineProperty(i,"__esModule",{value:!0});i.adapterFactory=w;var c=n("./utils"),h=s(c),l=n("./chrome/chrome_shim"),f=s(l),a=n("./edge/edge_shim"),o=s(a),v=n("./firefox/firefox_shim"),u=s(v),y=n("./safari/safari_shim"),e=s(y),p=n("./common_shim"),r=s(p)},{"./chrome/chrome_shim":3,"./common_shim":6,"./edge/edge_shim":7,"./firefox/firefox_shim":11,"./safari/safari_shim":14,"./utils":15}],3:[function(n,t,i){"use strict";function c(n){var t,i;if(n&&n.__esModule)return n;if(t={},n!=null)for(i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i]);return t.default=n,t}function s(n,t,i){return t in n?Object.defineProperty(n,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[t]=i,n}function l(n){n.MediaStream=n.MediaStream||n.webkitMediaStream}function a(n){if((typeof n=="undefined"?"undefined":u(n))!=="object"||!n.RTCPeerConnection||"ontrack"in n.RTCPeerConnection.prototype)r.wrapPeerConnectionEvent(n,"track",function(n){return n.transceiver||Object.defineProperty(n,"transceiver",{value:{receiver:n.receiver}}),n});else{Object.defineProperty(n.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(n){this._ontrack&&this.removeEventListener("track",this._ontrack);this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});var t=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){var i=this;return this._ontrackpoly||(this._ontrackpoly=function(t){t.stream.addEventListener("addtrack",function(r){var f=void 0,u;f=n.RTCPeerConnection.prototype.getReceivers?i.getReceivers().find(function(n){return n.track&&n.track.id===r.track.id}):{track:r.track};u=new Event("track");u.track=r.track;u.receiver=f;u.transceiver={receiver:f};u.streams=[t.stream];i.dispatchEvent(u)});t.stream.getTracks().forEach(function(r){var f=void 0,u;f=n.RTCPeerConnection.prototype.getReceivers?i.getReceivers().find(function(n){return n.track&&n.track.id===r.id}):{track:r};u=new Event("track");u.track=r;u.receiver=f;u.transceiver={receiver:f};u.streams=[t.stream];i.dispatchEvent(u)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}}function v(n){var t,i,r,f,e,o;(typeof n=="undefined"?"undefined":u(n))==="object"&&n.RTCPeerConnection&&!("getSenders"in n.RTCPeerConnection.prototype)&&"createDTMFSender"in n.RTCPeerConnection.prototype?(t=function(n,t){return{track:t,get dtmf(){return this._dtmf===undefined&&(this._dtmf=t.kind==="audio"?n.createDTMFSender(t):null),this._dtmf},_pc:n}},n.RTCPeerConnection.prototype.getSenders||(n.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()},i=n.RTCPeerConnection.prototype.addTrack,n.RTCPeerConnection.prototype.addTrack=function(n){var r=i.apply(this,arguments);return r||(r=t(this,n),this._senders.push(r)),r},r=n.RTCPeerConnection.prototype.removeTrack,n.RTCPeerConnection.prototype.removeTrack=function(n){r.apply(this,arguments);var t=this._senders.indexOf(n);t!==-1&&this._senders.splice(t,1)}),f=n.RTCPeerConnection.prototype.addStream,n.RTCPeerConnection.prototype.addStream=function(n){var i=this;this._senders=this._senders||[];f.apply(this,[n]);n.getTracks().forEach(function(n){i._senders.push(t(i,n))})},e=n.RTCPeerConnection.prototype.removeStream,n.RTCPeerConnection.prototype.removeStream=function(n){var t=this;this._senders=this._senders||[];e.apply(this,[n]);n.getTracks().forEach(function(n){var i=t._senders.find(function(t){return t.track===n});i&&t._senders.splice(t._senders.indexOf(i),1)})}):(typeof n=="undefined"?"undefined":u(n))==="object"&&n.RTCPeerConnection&&"getSenders"in n.RTCPeerConnection.prototype&&"createDTMFSender"in n.RTCPeerConnection.prototype&&n.RTCRtpSender&&!("dtmf"in n.RTCRtpSender.prototype)&&(o=n.RTCPeerConnection.prototype.getSenders,n.RTCPeerConnection.prototype.getSenders=function(){var t=this,n=o.apply(this,[]);return n.forEach(function(n){return n._pc=t}),n},Object.defineProperty(n.RTCRtpSender.prototype,"dtmf",{get:function(){return this._dtmf===undefined&&(this._dtmf=this.track.kind==="audio"?this._pc.createDTMFSender(this.track):null),this._dtmf}}))}function y(n){if(n.RTCPeerConnection){var t=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){var o=this,n=Array.prototype.slice.call(arguments),i=n[0],f=n[1],s=n[2],r,u,e;return arguments.length>0&&typeof i=="function"?t.apply(this,arguments):t.length===0&&(arguments.length===0||typeof i!="function")?t.apply(this,[]):(r=function(n){var t={},i=n.result();return i.forEach(function(n){var i={id:n.id,timestamp:n.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[n.type]||n.type};n.names().forEach(function(t){i[t]=n.stat(t)});t[i.id]=i}),t},u=function(n){return new Map(Object.keys(n).map(function(t){return[t,n[t]]}))},arguments.length>=2)?(e=function(n){f(u(r(n)))},t.apply(this,[e,i])):new Promise(function(n,i){t.apply(o,[function(t){n(u(r(t)))},i])}).then(f,s)}}}function p(n){var t,i,f,e;(typeof n=="undefined"?"undefined":u(n))==="object"&&n.RTCPeerConnection&&n.RTCRtpSender&&n.RTCRtpReceiver&&("getStats"in n.RTCRtpSender.prototype||(t=n.RTCPeerConnection.prototype.getSenders,t&&(n.RTCPeerConnection.prototype.getSenders=function(){var i=this,n=t.apply(this,[]);return n.forEach(function(n){return n._pc=i}),n}),i=n.RTCPeerConnection.prototype.addTrack,i&&(n.RTCPeerConnection.prototype.addTrack=function(){var n=i.apply(this,arguments);return n._pc=this,n}),n.RTCRtpSender.prototype.getStats=function(){var n=this;return this._pc.getStats().then(function(t){return r.filterStats(t,n.track,!0)})}),"getStats"in n.RTCRtpReceiver.prototype||(f=n.RTCPeerConnection.prototype.getReceivers,f&&(n.RTCPeerConnection.prototype.getReceivers=function(){var t=this,n=f.apply(this,[]);return n.forEach(function(n){return n._pc=t}),n}),r.wrapPeerConnectionEvent(n,"track",function(n){return n.receiver._pc=n.srcElement,n}),n.RTCRtpReceiver.prototype.getStats=function(){var n=this;return this._pc.getStats().then(function(t){return r.filterStats(t,n.track,!1)})}),"getStats"in n.RTCRtpSender.prototype&&"getStats"in n.RTCRtpReceiver.prototype)&&(e=n.RTCPeerConnection.prototype.getStats,n.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof n.MediaStreamTrack){var r=arguments[0],t=void 0,i=void 0,u=void 0;return(this.getSenders().forEach(function(n){n.track===r&&(t?u=!0:t=n)}),this.getReceivers().forEach(function(n){return n.track===r&&(i?u=!0:i=n),n.track===r}),u||t&&i)?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():i?i.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)})}function h(n){var t,i,r,u;n.RTCPeerConnection.prototype.getLocalStreams=function(){var n=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(function(t){return n._shimmedLocalStreams[t][0]})};t=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(n,i){if(!i)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var r=t.apply(this,arguments);return this._shimmedLocalStreams[i.id]?this._shimmedLocalStreams[i.id].indexOf(r)===-1&&this._shimmedLocalStreams[i.id].push(r):this._shimmedLocalStreams[i.id]=[i,r],r};i=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(n){var u=this,t,r;this._shimmedLocalStreams=this._shimmedLocalStreams||{};n.getTracks().forEach(function(n){var t=u.getSenders().find(function(t){return t.track===n});if(t)throw new DOMException("Track already exists.","InvalidAccessError");});t=this.getSenders();i.apply(this,arguments);r=this.getSenders().filter(function(n){return t.indexOf(n)===-1});this._shimmedLocalStreams[n.id]=[n].concat(r)};r=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(n){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[n.id],r.apply(this,arguments)};u=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(n){var t=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},n&&Object.keys(this._shimmedLocalStreams).forEach(function(i){var r=t._shimmedLocalStreams[i].indexOf(n);r!==-1&&t._shimmedLocalStreams[i].splice(r,1);t._shimmedLocalStreams[i].length===1&&delete t._shimmedLocalStreams[i]}),u.apply(this,arguments)}}function w(n){function t(n,t){var i=t.sdp;return Object.keys(n._reverseStreams||[]).forEach(function(t){var r=n._reverseStreams[t],u=n._streams[r.id];i=i.replace(new RegExp(u.id,"g"),r.id)}),new RTCSessionDescription({type:t.type,sdp:i})}function l(n,t){var i=t.sdp;return Object.keys(n._reverseStreams||[]).forEach(function(t){var r=n._reverseStreams[t],u=n._streams[r.id];i=i.replace(new RegExp(r.id,"g"),u.id)}),new RTCSessionDescription({type:t.type,sdp:i})}var u,f,e,o,i,c;if(n.RTCPeerConnection){if(u=r.detectBrowser(n),n.RTCPeerConnection.prototype.addTrack&&u.version>=65)return h(n);f=n.RTCPeerConnection.prototype.getLocalStreams;n.RTCPeerConnection.prototype.getLocalStreams=function(){var n=this,t=f.apply(this);return this._reverseStreams=this._reverseStreams||{},t.map(function(t){return n._reverseStreams[t.id]})};e=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(t){var r=this,i;this._streams=this._streams||{};this._reverseStreams=this._reverseStreams||{};t.getTracks().forEach(function(n){var t=r.getSenders().find(function(t){return t.track===n});if(t)throw new DOMException("Track already exists.","InvalidAccessError");});this._reverseStreams[t.id]||(i=new n.MediaStream(t.getTracks()),this._streams[t.id]=i,this._reverseStreams[i.id]=t,t=i);e.apply(this,[t])};o=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(n){this._streams=this._streams||{};this._reverseStreams=this._reverseStreams||{};o.apply(this,[this._streams[n.id]||n]);delete this._reverseStreams[this._streams[n.id]?this._streams[n.id].id:n.id];delete this._streams[n.id]};n.RTCPeerConnection.prototype.addTrack=function(t,i){var o=this,u,e,f,r;if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(u=[].slice.call(arguments,1),u.length!==1||!u[0].getTracks().find(function(n){return n===t}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(e=this.getSenders().find(function(n){return n.track===t}),e)throw new DOMException("Track already exists.","InvalidAccessError");return this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},f=this._streams[i.id],f?(f.addTrack(t),Promise.resolve().then(function(){o.dispatchEvent(new Event("negotiationneeded"))})):(r=new n.MediaStream([t]),this._streams[i.id]=r,this._reverseStreams[r.id]=i,this.addStream(r)),this.getSenders().find(function(n){return n.track===t})};["createOffer","createAnswer"].forEach(function(i){var r=n.RTCPeerConnection.prototype[i],u=s({},i,function(){var i=this,n=arguments,u=arguments.length&&typeof arguments[0]=="function";return u?r.apply(this,[function(r){var u=t(i,r);n[0].apply(null,[u])},function(t){n[1]&&n[1].apply(null,t)},arguments[2]]):r.apply(this,arguments).then(function(n){return t(i,n)})});n.RTCPeerConnection.prototype[i]=u[i]});i=n.RTCPeerConnection.prototype.setLocalDescription;n.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?i.apply(this,arguments):(arguments[0]=l(this,arguments[0]),i.apply(this,arguments))};c=Object.getOwnPropertyDescriptor(n.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(n.RTCPeerConnection.prototype,"localDescription",{get:function(){var n=c.get.apply(this);return n.type===""?n:t(this,n)}});n.RTCPeerConnection.prototype.removeTrack=function(n){var i=this,r,t;if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!n._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(r=n._pc===this,!r)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};t=void 0;Object.keys(this._streams).forEach(function(r){var u=i._streams[r].getTracks().find(function(t){return n.track===t});u&&(t=i._streams[r])});t&&(t.getTracks().length===1?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(n.track),this.dispatchEvent(new Event("negotiationneeded")))}}}function b(n){var t=r.detectBrowser(n),i,u;(!n.RTCPeerConnection&&n.webkitRTCPeerConnection&&(n.RTCPeerConnection=n.webkitRTCPeerConnection),n.RTCPeerConnection)&&(i=n.RTCPeerConnection.prototype.addIceCandidate.length===0,t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var i=n.RTCPeerConnection.prototype[t],r=s({},t,function(){return arguments[0]=new(t==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)});n.RTCPeerConnection.prototype[t]=r[t]}),u=n.RTCPeerConnection.prototype.addIceCandidate,n.RTCPeerConnection.prototype.addIceCandidate=function(){return!i&&!arguments[0]?(arguments[1]&&arguments[1].apply(null),Promise.resolve()):t.version<78&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():u.apply(this,arguments)})}function k(n){r.wrapPeerConnectionEvent(n,"negotiationneeded",function(n){var t=n.target;if(t.signalingState==="stable")return n})}var u,f,e,o,r;Object.defineProperty(i,"__esModule",{value:!0});i.shimGetDisplayMedia=i.shimGetUserMedia=undefined;u=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n};f=n("./getusermedia");Object.defineProperty(i,"shimGetUserMedia",{enumerable:!0,get:function(){return f.shimGetUserMedia}});e=n("./getdisplaymedia");Object.defineProperty(i,"shimGetDisplayMedia",{enumerable:!0,get:function(){return e.shimGetDisplayMedia}});i.shimMediaStream=l;i.shimOnTrack=a;i.shimGetSendersWithDtmf=v;i.shimGetStats=y;i.shimSenderReceiverGetStats=p;i.shimAddTrackRemoveTrackWithNative=h;i.shimAddTrackRemoveTrack=w;i.shimPeerConnection=b;i.fixNegotiationNeeded=k;o=n("../utils.js");r=c(o)},{"../utils.js":15,"./getdisplaymedia":4,"./getusermedia":5}],4:[function(n,t,i){"use strict";function r(n,t){if((!n.navigator.mediaDevices||!("getDisplayMedia"in n.navigator.mediaDevices))&&n.navigator.mediaDevices){if(typeof t!="function"){console.error("shimGetDisplayMedia: getSourceId argument is not a function");return}n.navigator.mediaDevices.getDisplayMedia=function(i){return t(i).then(function(t){var r=i.video&&i.video.width,u=i.video&&i.video.height,f=i.video&&i.video.frameRate;return i.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:f||3}},r&&(i.video.mandatory.maxWidth=r),u&&(i.video.mandatory.maxHeight=u),n.navigator.mediaDevices.getUserMedia(i)})}}}Object.defineProperty(i,"__esModule",{value:!0});i.shimGetDisplayMedia=r},{}],5:[function(n,t,i){"use strict";function o(n){var t,i;if(n&&n.__esModule)return n;if(t={},n!=null)for(i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i]);return t.default=n,t}function s(n){var t=n&&n.navigator,h;if(t.mediaDevices){var i=u.detectBrowser(n),e=function(n){if((typeof n=="undefined"?"undefined":r(n))!=="object"||n.mandatory||n.optional)return n;var t={};return Object.keys(n).forEach(function(i){var u,e,f;i!=="require"&&i!=="advanced"&&i!=="mediaSource"&&(u=r(n[i])==="object"?n[i]:{ideal:n[i]},u.exact!==undefined&&typeof u.exact=="number"&&(u.min=u.max=u.exact),e=function(n,t){return n?n+t.charAt(0).toUpperCase()+t.slice(1):t==="deviceId"?"sourceId":t},u.ideal!==undefined&&(t.optional=t.optional||[],f={},typeof u.ideal=="number"?(f[e("min",i)]=u.ideal,t.optional.push(f),f={},f[e("max",i)]=u.ideal,t.optional.push(f)):(f[e("",i)]=u.ideal,t.optional.push(f))),u.exact!==undefined&&typeof u.exact!="number"?(t.mandatory=t.mandatory||{},t.mandatory[e("",i)]=u.exact):["min","max"].forEach(function(n){u[n]!==undefined&&(t.mandatory=t.mandatory||{},t.mandatory[e(n,i)]=u[n])}))}),n.advanced&&(t.optional=(t.optional||[]).concat(n.advanced)),t},o=function(n,u){var h,o,c,s;if(i.version>=61)return u(n);if(n=JSON.parse(JSON.stringify(n)),n&&r(n.audio)==="object"&&(h=function(n,t,i){t in n&&!(i in n)&&(n[i]=n[t],delete n[t])},n=JSON.parse(JSON.stringify(n)),h(n.audio,"autoGainControl","googAutoGainControl"),h(n.audio,"noiseSuppression","googNoiseSuppression"),n.audio=e(n.audio)),n&&r(n.video)==="object"){if(o=n.video.facingMode,o=o&&((typeof o=="undefined"?"undefined":r(o))==="object"?o:{ideal:o}),c=i.version<66,o&&(o.exact==="user"||o.exact==="environment"||o.ideal==="user"||o.ideal==="environment")&&!(t.mediaDevices.getSupportedConstraints&&t.mediaDevices.getSupportedConstraints().facingMode&&!c)&&(delete n.video.facingMode,s=void 0,o.exact==="environment"||o.ideal==="environment"?s=["back","rear"]:(o.exact==="user"||o.ideal==="user")&&(s=["front"]),s))return t.mediaDevices.enumerateDevices().then(function(t){t=t.filter(function(n){return n.kind==="videoinput"});var i=t.find(function(n){return s.some(function(t){return n.label.toLowerCase().includes(t)})});return!i&&t.length&&s.includes("back")&&(i=t[t.length-1]),i&&(n.video.deviceId=o.exact?{exact:i.deviceId}:{ideal:i.deviceId}),n.video=e(n.video),f("chrome: "+JSON.stringify(n)),u(n)});n.video=e(n.video)}return f("chrome: "+JSON.stringify(n)),u(n)},s=function(n){return i.version>=64?n:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[n.name]||n.name,message:n.message,constraint:n.constraint||n.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}},c=function(n,i,r){o(n,function(n){t.webkitGetUserMedia(n,i,function(n){r&&r(s(n))})})};t.getUserMedia=c.bind(t);t.mediaDevices.getUserMedia&&(h=t.mediaDevices.getUserMedia.bind(t.mediaDevices),t.mediaDevices.getUserMedia=function(n){return o(n,function(n){return h(n).then(function(t){if(n.audio&&!t.getAudioTracks().length||n.video&&!t.getVideoTracks().length){t.getTracks().forEach(function(n){n.stop()});throw new DOMException("","NotFoundError");}return t},function(n){return Promise.reject(s(n))})})})}}var r,e,u,f;Object.defineProperty(i,"__esModule",{value:!0});r=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n};i.shimGetUserMedia=s;e=n("../utils.js");u=o(e);f=u.log},{"../utils.js":15}],6:[function(n,t,i){"use strict";function s(n){var t,i;if(n&&n.__esModule)return n;if(t={},n!=null)for(i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i]);return t.default=n,t}function h(n){return n&&n.__esModule?n:{"default":n}}function c(n){if(n.RTCIceCandidate&&(!n.RTCIceCandidate||!("foundation"in n.RTCIceCandidate.prototype))){var t=n.RTCIceCandidate;n.RTCIceCandidate=function(n){if((typeof n=="undefined"?"undefined":f(n))==="object"&&n.candidate&&n.candidate.indexOf("a=")===0&&(n=JSON.parse(JSON.stringify(n)),n.candidate=n.candidate.substr(2)),n.candidate&&n.candidate.length){var u=new t(n),e=r.default.parseCandidate(n.candidate),i=Object.assign(u,e);return i.toJSON=function(){return{candidate:i.candidate,sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex,usernameFragment:i.usernameFragment}},i}return new t(n)};n.RTCIceCandidate.prototype=t.prototype;u.wrapPeerConnectionEvent(n,"icecandidate",function(t){return t.candidate&&Object.defineProperty(t,"candidate",{value:new n.RTCIceCandidate(t.candidate),writable:"false"}),t})}}function l(n){var t;if(n.RTCPeerConnection){t=u.detectBrowser(n);"sctp"in n.RTCPeerConnection.prototype||Object.defineProperty(n.RTCPeerConnection.prototype,"sctp",{get:function(){return typeof this._sctp=="undefined"?null:this._sctp}});var i=function(n){if(!n||!n.sdp)return!1;var t=r.default.splitSections(n.sdp);return t.shift(),t.some(function(n){var t=r.default.parseMLine(n);return t&&t.kind==="application"&&t.protocol.indexOf("SCTP")!==-1})},f=function(n){var i=n.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/),t;return i===null||i.length<2?-1:(t=parseInt(i[1],10),t!==t?-1:t)},e=function(n){var i=65536;return t.browser==="firefox"&&(i=t.version<57?n===-1?16384:2147483637:t.version<60?t.version===57?65535:65536:2147483637),i},o=function(n,i){var u=65536,f;return t.browser==="firefox"&&t.version===57&&(u=65535),f=r.default.matchPrefix(n.sdp,"a=max-message-size:"),f.length>0?u=parseInt(f[0].substr(19),10):t.browser==="firefox"&&i!==-1&&(u=2147483637),u},s=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){var h,c,u;if(this._sctp=null,t.browser==="chrome"&&t.version>=76&&(h=this.getConfiguration(),c=h.sdpSemantics,c==="plan-b"&&Object.defineProperty(this,"sctp",{get:function(){return typeof this._sctp=="undefined"?null:this._sctp},enumerable:!0,configurable:!0})),i(arguments[0])){var l=f(arguments[0]),n=e(l),r=o(arguments[0],l),a=void 0;a=n===0&&r===0?Number.POSITIVE_INFINITY:n===0||r===0?Math.max(n,r):Math.min(n,r);u={};Object.defineProperty(u,"maxMessageSize",{get:function(){return a}});this._sctp=u}return s.apply(this,arguments)}}}function a(n){function t(n,t){var i=n.send;n.send=function(){var r=arguments[0],u=r.length||r.size||r.byteLength;if(n.readyState==="open"&&t.sctp&&u>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return i.apply(n,arguments)}}if(n.RTCPeerConnection&&"createDataChannel"in n.RTCPeerConnection.prototype){var i=n.RTCPeerConnection.prototype.createDataChannel;n.RTCPeerConnection.prototype.createDataChannel=function(){var n=i.apply(this,arguments);return t(n,this),n};u.wrapPeerConnectionEvent(n,"datachannel",function(n){return t(n.channel,n.target),n})}}function v(n){if(n.RTCPeerConnection&&!("connectionState"in n.RTCPeerConnection.prototype)){var t=n.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get:function(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0});Object.defineProperty(t,"onconnectionstatechange",{get:function(){return this._onconnectionstatechange||null},set:function(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange);n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0});["setLocalDescription","setRemoteDescription"].forEach(function(n){var i=t[n];t[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=function(n){var t=n.target,i;return t._lastConnectionState!==t.connectionState&&(t._lastConnectionState=t.connectionState,i=new Event("connectionstatechange",n),t.dispatchEvent(i)),n},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}}function y(n){var t,i;n.RTCPeerConnection&&((t=u.detectBrowser(n),t.browser==="chrome"&&t.version>=71)||(i=n.RTCPeerConnection.prototype.setRemoteDescription,n.RTCPeerConnection.prototype.setRemoteDescription=function(n){return n&&n.sdp&&n.sdp.indexOf("\na=extmap-allow-mixed")!==-1&&(n.sdp=n.sdp.split("\n").filter(function(n){return n.trim()!=="a=extmap-allow-mixed"}).join("\n")),i.apply(this,arguments)}))}var f;Object.defineProperty(i,"__esModule",{value:!0});f=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n};i.shimRTCIceCandidate=c;i.shimMaxMessageSize=l;i.shimSendThrowTypeError=a;i.shimConnectionState=v;i.removeAllowExtmapMixed=y;var e=n("sdp"),r=h(e),o=n("./utils"),u=s(o)},{"./utils":15,sdp:17}],7:[function(n,t,i){"use strict";function c(n){return n&&n.__esModule?n:{"default":n}}function l(n){var t,i;if(n&&n.__esModule)return n;if(t={},n!=null)for(i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i]);return t.default=n,t}function a(n){var t=f.detectBrowser(n),r,i;n.RTCIceGatherer&&(n.RTCIceCandidate||(n.RTCIceCandidate=function(n){return n}),n.RTCSessionDescription||(n.RTCSessionDescription=function(n){return n}),t.version<15025&&(r=Object.getOwnPropertyDescriptor(n.MediaStreamTrack.prototype,"enabled"),Object.defineProperty(n.MediaStreamTrack.prototype,"enabled",{set:function(n){r.set.call(this,n);var t=new Event("enabled");t.enabled=n;this.dispatchEvent(t)}})));!n.RTCRtpSender||"dtmf"in n.RTCRtpSender.prototype||Object.defineProperty(n.RTCRtpSender.prototype,"dtmf",{get:function(){return this._dtmf===undefined&&(this.track.kind==="audio"?this._dtmf=new n.RTCDtmfSender(this):this.track.kind==="video"&&(this._dtmf=null)),this._dtmf}});n.RTCDtmfSender&&!n.RTCDTMFSender&&(n.RTCDTMFSender=n.RTCDtmfSender);i=h.default(n,t.version);n.RTCPeerConnection=function(n){return n&&n.iceServers&&(n.iceServers=o.filterIceServers(n.iceServers,t.version),f.log("ICE servers after filtering:",n.iceServers)),new i(n)};n.RTCPeerConnection.prototype=i.prototype}function v(n){!n.RTCRtpSender||"replaceTrack"in n.RTCRtpSender.prototype||(n.RTCRtpSender.prototype.replaceTrack=n.RTCRtpSender.prototype.setTrack)}var r,u;Object.defineProperty(i,"__esModule",{value:!0});i.shimGetDisplayMedia=i.shimGetUserMedia=undefined;r=n("./getusermedia");Object.defineProperty(i,"shimGetUserMedia",{enumerable:!0,get:function(){return r.shimGetUserMedia}});u=n("./getdisplaymedia");Object.defineProperty(i,"shimGetDisplayMedia",{enumerable:!0,get:function(){return u.shimGetDisplayMedia}});i.shimPeerConnection=a;i.shimReplaceTrack=v;var e=n("../utils"),f=l(e),o=n("./filtericeservers"),s=n("rtcpeerconnection-shim"),h=c(s)},{"../utils":15,"./filtericeservers":8,"./getdisplaymedia":9,"./getusermedia":10,"rtcpeerconnection-shim":16}],8:[function(n,t,i){"use strict";function f(n){var t,i;if(n&&n.__esModule)return n;if(t={},n!=null)for(i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i]);return t.default=n,t}function e(n){var t=!1;return n=JSON.parse(JSON.stringify(n)),n.filter(function(n){var i,r;if(n&&(n.urls||n.url))return i=n.urls||n.url,n.url&&!n.urls&&u.deprecated("RTCIceServer.url","RTCIceServer.urls"),r=typeof i=="string",r&&(i=[i]),i=i.filter(function(n){if(n.indexOf("stun:")===0)return!1;var i=n.startsWith("turn")&&!n.startsWith("turn:[")&&n.includes("transport=udp");return i&&!t?(t=!0,!0):i&&!t}),delete n.url,n.urls=r?i[0]:i,!!i.length})}Object.defineProperty(i,"__esModule",{value:!0});i.filterIceServers=e;var r=n("../utils"),u=f(r)},{"../utils":15}],9:[function(n,t,i){"use strict";function r(n){"getDisplayMedia"in n.navigator&&n.navigator.mediaDevices&&(n.navigator.mediaDevices&&"getDisplayMedia"in n.navigator.mediaDevices||(n.navigator.mediaDevices.getDisplayMedia=n.navigator.getDisplayMedia.bind(n.navigator)))}Object.defineProperty(i,"__esModule",{value:!0});i.shimGetDisplayMedia=r},{}],10:[function(n,t,i){"use strict";function r(n){var t=n&&n.navigator,i=function(n){return{name:{PermissionDeniedError:"NotAllowedError"}[n.name]||n.name,message:n.message,constraint:n.constraint,toString:function(){return this.name}}},r=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(n){return r(n).catch(function(n){return Promise.reject(i(n))})}}Object.defineProperty(i,"__esModule",{value:!0});i.shimGetUserMedia=r},{}],11:[function(n,t,i){"use strict";function s(n){var t,i;if(n&&n.__esModule)return n;if(t={},n!=null)for(i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i]);return t.default=n,t}function h(n,t,i){return t in n?Object.defineProperty(n,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[t]=i,n}function c(n){(typeof n=="undefined"?"undefined":r(n))==="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}function l(n){var t=u.detectBrowser(n),f,i,e;(typeof n=="undefined"?"undefined":r(n))==="object"&&(n.RTCPeerConnection||n.mozRTCPeerConnection)&&(!n.RTCPeerConnection&&n.mozRTCPeerConnection&&(n.RTCPeerConnection=n.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var i=n.RTCPeerConnection.prototype[t],r=h({},t,function(){return arguments[0]=new(t==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)});n.RTCPeerConnection.prototype[t]=r[t]}),t.version<68&&(f=n.RTCPeerConnection.prototype.addIceCandidate,n.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?arguments[0]&&arguments[0].candidate===""?Promise.resolve():f.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}),i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},e=n.RTCPeerConnection.prototype.getStats,n.RTCPeerConnection.prototype.getStats=function(){var n=Array.prototype.slice.call(arguments),u=n[0],r=n[1],f=n[2];return e.apply(this,[u||null]).then(function(n){if(t.version<53&&!r)try{n.forEach(function(n){n.type=i[n.type]||n.type})}catch(u){if(u.name!=="TypeError")throw u;n.forEach(function(t,r){n.set(r,Object.assign({},t,{type:i[t.type]||t.type}))})}return n}).then(r,f)})}function a(n){var t,i;(typeof n=="undefined"?"undefined":r(n))==="object"&&n.RTCPeerConnection&&n.RTCRtpSender&&(n.RTCRtpSender&&"getStats"in n.RTCRtpSender.prototype||(t=n.RTCPeerConnection.prototype.getSenders,t&&(n.RTCPeerConnection.prototype.getSenders=function(){var i=this,n=t.apply(this,[]);return n.forEach(function(n){return n._pc=i}),n}),i=n.RTCPeerConnection.prototype.addTrack,i&&(n.RTCPeerConnection.prototype.addTrack=function(){var n=i.apply(this,arguments);return n._pc=this,n}),n.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}))}function v(n){if((typeof n=="undefined"?"undefined":r(n))==="object"&&n.RTCPeerConnection&&n.RTCRtpSender&&(!n.RTCRtpSender||!("getStats"in n.RTCRtpReceiver.prototype))){var t=n.RTCPeerConnection.prototype.getReceivers;t&&(n.RTCPeerConnection.prototype.getReceivers=function(){var i=this,n=t.apply(this,[]);return n.forEach(function(n){return n._pc=i}),n});u.wrapPeerConnectionEvent(n,"track",function(n){return n.receiver._pc=n.srcElement,n});n.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}}function y(n){!n.RTCPeerConnection||"removeStream"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.removeStream=function(n){var t=this;u.deprecated("removeStream","removeTrack");this.getSenders().forEach(function(i){i.track&&n.getTracks().includes(i.track)&&t.removeTrack(i)})})}function p(n){n.DataChannel&&!n.RTCDataChannel&&(n.RTCDataChannel=n.DataChannel)}function w(n){if((typeof n=="undefined"?"undefined":r(n))==="object"&&n.RTCPeerConnection){var t=n.RTCPeerConnection.prototype.addTransceiver;t&&(n.RTCPeerConnection.prototype.addTransceiver=function(){var n,r,u,f,i;return this.setParametersPromises=[],n=arguments[1],r=n&&"sendEncodings"in n,r&&n.sendEncodings.forEach(function(n){if("rid"in n)if(!/^[a-z0-9]{0,16}$/i.test(n.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in n&&!(parseFloat(n.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in n&&!(parseFloat(n.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0");}),u=t.apply(this,arguments),r&&(f=u.sender,i=f.getParameters(),"encodings"in i||(i.encodings=n.sendEncodings,this.setParametersPromises.push(f.setParameters(i).catch(function(){})))),u})}}function b(n){if((typeof n=="undefined"?"undefined":r(n))==="object"&&n.RTCPeerConnection){var t=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(){var n=this,i=arguments;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(function(){return t.apply(n,i)}).finally(function(){n.setParametersPromises=[]}):t.apply(this,arguments)}}}function k(n){if((typeof n=="undefined"?"undefined":r(n))==="object"&&n.RTCPeerConnection){var t=n.RTCPeerConnection.prototype.createAnswer;n.RTCPeerConnection.prototype.createAnswer=function(){var n=this,i=arguments;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(function(){return t.apply(n,i)}).finally(function(){n.setParametersPromises=[]}):t.apply(this,arguments)}}}var r,f,e,o,u;Object.defineProperty(i,"__esModule",{value:!0});i.shimGetDisplayMedia=i.shimGetUserMedia=undefined;r=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n};f=n("./getusermedia");Object.defineProperty(i,"shimGetUserMedia",{enumerable:!0,get:function(){return f.shimGetUserMedia}});e=n("./getdisplaymedia");Object.defineProperty(i,"shimGetDisplayMedia",{enumerable:!0,get:function(){return e.shimGetDisplayMedia}});i.shimOnTrack=c;i.shimPeerConnection=l;i.shimSenderGetStats=a;i.shimReceiverGetStats=v;i.shimRemoveStream=y;i.shimRTCDataChannel=p;i.shimAddTransceiver=w;i.shimCreateOffer=b;i.shimCreateAnswer=k;o=n("../utils");u=s(o)},{"../utils":15,"./getdisplaymedia":12,"./getusermedia":13}],12:[function(n,t,i){"use strict";function r(n,t){n.navigator.mediaDevices&&"getDisplayMedia"in n.navigator.mediaDevices||n.navigator.mediaDevices&&(n.navigator.mediaDevices.getDisplayMedia=function(i){if(!(i&&i.video)){var r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,Promise.reject(r)}return i.video===!0?i.video={mediaSource:t}:i.video.mediaSource=t,n.navigator.mediaDevices.getUserMedia(i)})}Object.defineProperty(i,"__esModule",{value:!0});i.shimGetDisplayMedia=r},{}],13:[function(n,t,i){"use strict";function e(n){var t,i;if(n&&n.__esModule)return n;if(t={},n!=null)for(i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i]);return t.default=n,t}function o(n){var h=u.detectBrowser(n),f=n&&n.navigator,t=n&&n.MediaStreamTrack,i,e,o,s;f.getUserMedia=function(n,t,i){u.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia");f.mediaDevices.getUserMedia(n).then(t,i)};h.version>55&&"autoGainControl"in f.mediaDevices.getSupportedConstraints()||(i=function(n,t,i){t in n&&!(i in n)&&(n[i]=n[t],delete n[t])},e=f.mediaDevices.getUserMedia.bind(f.mediaDevices),f.mediaDevices.getUserMedia=function(n){return(typeof n=="undefined"?"undefined":r(n))==="object"&&r(n.audio)==="object"&&(n=JSON.parse(JSON.stringify(n)),i(n.audio,"autoGainControl","mozAutoGainControl"),i(n.audio,"noiseSuppression","mozNoiseSuppression")),e(n)},t&&t.prototype.getSettings&&(o=t.prototype.getSettings,t.prototype.getSettings=function(){var n=o.apply(this,arguments);return i(n,"mozAutoGainControl","autoGainControl"),i(n,"mozNoiseSuppression","noiseSuppression"),n}),t&&t.prototype.applyConstraints&&(s=t.prototype.applyConstraints,t.prototype.applyConstraints=function(n){return this.kind==="audio"&&(typeof n=="undefined"?"undefined":r(n))==="object"&&(n=JSON.parse(JSON.stringify(n)),i(n,"autoGainControl","mozAutoGainControl"),i(n,"noiseSuppression","mozNoiseSuppression")),s.apply(this,[n])}))}var r,f,u;Object.defineProperty(i,"__esModule",{value:!0});r=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n};i.shimGetUserMedia=o;f=n("../utils");u=e(f)},{"../utils":15}],14:[function(n,t,i){"use strict";function o(n){var t,i;if(n&&n.__esModule)return n;if(t={},n!=null)for(i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i]);return t.default=n,t}function s(n){if((typeof n=="undefined"?"undefined":r(n))==="object"&&n.RTCPeerConnection){if("getLocalStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in n.RTCPeerConnection.prototype)){var t=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addStream=function(n){var i=this;this._localStreams||(this._localStreams=[]);this._localStreams.includes(n)||this._localStreams.push(n);n.getAudioTracks().forEach(function(r){return t.call(i,r,n)});n.getVideoTracks().forEach(function(r){return t.call(i,r,n)})};n.RTCPeerConnection.prototype.addTrack=function(){var n=arguments[1];return n&&(this._localStreams?this._localStreams.includes(n)||this._localStreams.push(n):this._localStreams=[n]),t.apply(this,arguments)}}"removeStream"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.removeStream=function(n){var r=this,t,i;(this._localStreams||(this._localStreams=[]),t=this._localStreams.indexOf(n),t!==-1)&&(this._localStreams.splice(t,1),i=n.getTracks(),this.getSenders().forEach(function(n){i.includes(n.track)&&r.removeTrack(n)}))})}}function h(n){if((typeof n=="undefined"?"undefined":r(n))==="object"&&n.RTCPeerConnection&&("getRemoteStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in n.RTCPeerConnection.prototype))){Object.defineProperty(n.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(n){var t=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly));this.addEventListener("addstream",this._onaddstream=n);this.addEventListener("track",this._onaddstreampoly=function(n){n.streams.forEach(function(n){if(t._remoteStreams||(t._remoteStreams=[]),!t._remoteStreams.includes(n)){t._remoteStreams.push(n);var i=new Event("addstream");i.stream=n;t.dispatchEvent(i)}})})}});var t=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){var n=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach(function(t){if(n._remoteStreams||(n._remoteStreams=[]),!(n._remoteStreams.indexOf(t)>=0)){n._remoteStreams.push(t);var i=new Event("addstream");i.stream=t;n.dispatchEvent(i)}})}),t.apply(n,arguments)}}}function c(n){var i;if((typeof n=="undefined"?"undefined":r(n))==="object"&&n.RTCPeerConnection){var t=n.RTCPeerConnection.prototype,u=t.createOffer,f=t.createAnswer,e=t.setLocalDescription,o=t.setRemoteDescription,s=t.addIceCandidate;t.createOffer=function(n,t){var r=arguments.length>=2?arguments[2]:arguments[0],i=u.apply(this,[r]);return t?(i.then(n,t),Promise.resolve()):i};t.createAnswer=function(n,t){var r=arguments.length>=2?arguments[2]:arguments[0],i=f.apply(this,[r]);return t?(i.then(n,t),Promise.resolve()):i};i=function(n,t,i){var r=e.apply(this,[n]);return i?(r.then(t,i),Promise.resolve()):r};t.setLocalDescription=i;i=function(n,t,i){var r=o.apply(this,[n]);return i?(r.then(t,i),Promise.resolve()):r};t.setRemoteDescription=i;i=function(n,t,i){var r=s.apply(this,[n]);return i?(r.then(t,i),Promise.resolve()):r};t.addIceCandidate=i}}function l(n){var t=n&&n.navigator,i,r;t.mediaDevices&&t.mediaDevices.getUserMedia&&(i=t.mediaDevices,r=i.getUserMedia.bind(i),t.mediaDevices.getUserMedia=function(n){return r(e(n))});!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(n,i,r){t.mediaDevices.getUserMedia(n).then(i,r)}.bind(t))}function e(n){return n&&n.video!==undefined?Object.assign({},n,{video:u.compactObject(n.video)}):n}function a(n){var t=n.RTCPeerConnection;n.RTCPeerConnection=function(n,i){var e,f,r;if(n&&n.iceServers){for(e=[],f=0;f<n.iceServers.length;f++)r=n.iceServers[f],!r.hasOwnProperty("urls")&&r.hasOwnProperty("url")?(u.deprecated("RTCIceServer.url","RTCIceServer.urls"),r=JSON.parse(JSON.stringify(r)),r.urls=r.url,delete r.url,e.push(r)):e.push(n.iceServers[f]);n.iceServers=e}return new t(n,i)};n.RTCPeerConnection.prototype=t.prototype;"generateCertificate"in n.RTCPeerConnection&&Object.defineProperty(n.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})}function v(n){(typeof n=="undefined"?"undefined":r(n))==="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}function y(n){var t=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(n){var i,r;return n&&(typeof n.offerToReceiveAudio!="undefined"&&(n.offerToReceiveAudio=!!n.offerToReceiveAudio),i=this.getTransceivers().find(function(n){return n.receiver.track.kind==="audio"}),n.offerToReceiveAudio===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):n.offerToReceiveAudio!==!0||i||this.addTransceiver("audio"),typeof n.offerToReceiveVideo!="undefined"&&(n.offerToReceiveVideo=!!n.offerToReceiveVideo),r=this.getTransceivers().find(function(n){return n.receiver.track.kind==="video"}),n.offerToReceiveVideo===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):n.offerToReceiveVideo!==!0||r||this.addTransceiver("video")),t.apply(this,arguments)}}var r,f,u;Object.defineProperty(i,"__esModule",{value:!0});r=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n};i.shimLocalStreamsAPI=s;i.shimRemoteStreamsAPI=h;i.shimCallbacksAPI=c;i.shimGetUserMedia=l;i.shimConstraints=e;i.shimRTCIceServerUrls=a;i.shimTrackEventTransceiver=v;i.shimCreateOfferLegacy=y;f=n("../utils");u=o(f)},{"../utils":15}],15:[function(n,t,i){"use strict";function c(n,t,i){return t in n?Object.defineProperty(n,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[t]=i,n}function r(n,t,i){var r=n.match(t);return r&&r.length>=i&&parseInt(r[i],10)}function l(n,t,i){var r,u,f;n.RTCPeerConnection&&(r=n.RTCPeerConnection.prototype,u=r.addEventListener,r.addEventListener=function(n,r){if(n!==t)return u.apply(this,arguments);var f=function(n){var t=i(n);t&&r(t)};return this._eventMap=this._eventMap||{},this._eventMap[r]=f,u.apply(this,[n,f])},f=r.removeEventListener,r.removeEventListener=function(n,i){if(n!==t||!this._eventMap||!this._eventMap[i])return f.apply(this,arguments);var r=this._eventMap[i];return delete this._eventMap[i],f.apply(this,[n,r])},Object.defineProperty(r,"on"+t,{get:function(){return this["_on"+t]},set:function(n){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]);n&&this.addEventListener(t,this["_on"+t]=n)},enumerable:!0,configurable:!0}))}function a(n){return typeof n!="boolean"?new Error("Argument type: "+(typeof n=="undefined"?"undefined":u(n))+". Please use a boolean."):(e=n,n?"adapter.js logging disabled":"adapter.js logging enabled")}function v(n){return typeof n!="boolean"?new Error("Argument type: "+(typeof n=="undefined"?"undefined":u(n))+". Please use a boolean."):(o=!n,"adapter.js deprecation warnings "+(n?"disabled":"enabled"))}function y(){if((typeof window=="undefined"?"undefined":u(window))==="object"){if(e)return;typeof console!="undefined"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function p(n,t){o&&console.warn(n+" is deprecated, please use "+t+" instead.")}function w(n){var i=n.navigator,t={browser:null,version:null};if(typeof n=="undefined"||!n.navigator)return t.browser="Not a browser.",t;if(i.mozGetUserMedia)t.browser="firefox",t.version=r(i.userAgent,/Firefox\/(\d+)\./,1);else if(i.webkitGetUserMedia||n.isSecureContext===!1&&n.webkitRTCPeerConnection&&!n.RTCIceGatherer)t.browser="chrome",t.version=r(i.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(i.mediaDevices&&i.userAgent.match(/Edge\/(\d+).(\d+)$/))t.browser="edge",t.version=r(i.userAgent,/Edge\/(\d+).(\d+)$/,2);else if(n.RTCPeerConnection&&i.userAgent.match(/AppleWebKit\/(\d+)\./))t.browser="safari",t.version=r(i.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=n.RTCRtpTransceiver&&"currentDirection"in n.RTCRtpTransceiver.prototype;else return t.browser="Not a supported browser.",t;return t}function s(n){return Object.prototype.toString.call(n)==="[object Object]"}function h(n){return s(n)?Object.keys(n).reduce(function(t,i){var u=s(n[i]),r=u?h(n[i]):n[i],f=u&&!Object.keys(r).length;return r===undefined||f?t:Object.assign(t,c({},i,r))},{}):n}function f(n,t,i){t&&!i.has(t.id)&&(i.set(t.id,t),Object.keys(t).forEach(function(r){r.endsWith("Id")?f(n,n.get(t[r]),i):r.endsWith("Ids")&&t[r].forEach(function(t){f(n,n.get(t),i)})}))}function b(n,t,i){var e=i?"outbound-rtp":"inbound-rtp",r=new Map,u;return t===null?r:(u=[],n.forEach(function(n){n.type==="track"&&n.trackIdentifier===t.id&&u.push(n)}),u.forEach(function(t){n.forEach(function(i){i.type===e&&i.trackId===t.id&&f(n,i,r)})}),r)}var u,e,o;Object.defineProperty(i,"__esModule",{value:!0});u=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n};i.extractVersion=r;i.wrapPeerConnectionEvent=l;i.disableLog=a;i.disableWarnings=v;i.log=y;i.deprecated=p;i.detectBrowser=w;i.compactObject=h;i.walkStats=f;i.filterStats=b;e=!0;o=!0},{}],16:[function(n,t){"use strict";function s(n){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[n.type]||n.type}function e(n,t,r,u,f){var e=i.writeRtpDescription(n.kind,t),s,o;return e+=i.writeIceParameters(n.iceGatherer.getLocalParameters()),e+=i.writeDtlsParameters(n.dtlsTransport.getLocalParameters(),r==="offer"?"actpass":f||"active"),e+="a=mid:"+n.mid+"\r\n",e+=n.rtpSender&&n.rtpReceiver?"a=sendrecv\r\n":n.rtpSender?"a=sendonly\r\n":n.rtpReceiver?"a=recvonly\r\n":"a=inactive\r\n",n.rtpSender&&(s=n.rtpSender._initialTrackId||n.rtpSender.track.id,n.rtpSender._initialTrackId=s,o="msid:"+(u?u.id:"-")+" "+s+"\r\n",e+="a="+o,e+="a=ssrc:"+n.sendEncodingParameters[0].ssrc+" "+o,n.sendEncodingParameters[0].rtx&&(e+="a=ssrc:"+n.sendEncodingParameters[0].rtx.ssrc+" "+o,e+="a=ssrc-group:FID "+n.sendEncodingParameters[0].ssrc+" "+n.sendEncodingParameters[0].rtx.ssrc+"\r\n")),e+="a=ssrc:"+n.sendEncodingParameters[0].ssrc+" cname:"+i.localCName+"\r\n",n.rtpSender&&n.sendEncodingParameters[0].rtx&&(e+="a=ssrc:"+n.sendEncodingParameters[0].rtx.ssrc+" cname:"+i.localCName+"\r\n"),e}function h(n,t){var i=!1;return n=JSON.parse(JSON.stringify(n)),n.filter(function(n){var r,u;if(n&&(n.urls||n.url))return r=n.urls||n.url,n.url&&!n.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead."),u=typeof r=="string",u&&(r=[r]),r=r.filter(function(n){var r=n.indexOf("turn:")===0&&n.indexOf("transport=udp")!==-1&&n.indexOf("turn:[")===-1&&!i;return r?(i=!0,!0):n.indexOf("stun:")===0&&t>=14393&&n.indexOf("?transport=udp")===-1}),delete n.url,n.urls=u?r[0]:r,!!r.length})}function u(n,t){var i={codecs:[],headerExtensions:[],fecMechanisms:[]},r=function(n,t){n=parseInt(n,10);for(var i=0;i<t.length;i++)if(t[i].payloadType===n||t[i].preferredPayloadType===n)return t[i]},u=function(n,t,i,u){var f=r(n.parameters.apt,i),e=r(t.parameters.apt,u);return f&&e&&f.name.toLowerCase()===e.name.toLowerCase()};return n.codecs.forEach(function(r){for(var f,e=0;e<t.codecs.length;e++)if(f=t.codecs[e],r.name.toLowerCase()===f.name.toLowerCase()&&r.clockRate===f.clockRate){if(r.name.toLowerCase()==="rtx"&&r.parameters&&f.parameters.apt&&!u(r,f,n.codecs,t.codecs))continue;f=JSON.parse(JSON.stringify(f));f.numChannels=Math.min(r.numChannels,f.numChannels);i.codecs.push(f);f.rtcpFeedback=f.rtcpFeedback.filter(function(n){for(var t=0;t<r.rtcpFeedback.length;t++)if(r.rtcpFeedback[t].type===n.type&&r.rtcpFeedback[t].parameter===n.parameter)return!0;return!1});break}}),n.headerExtensions.forEach(function(n){for(var u,r=0;r<t.headerExtensions.length;r++)if(u=t.headerExtensions[r],n.uri===u.uri){i.headerExtensions.push(u);break}}),i}function o(n,t,i){return{offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][n].indexOf(i)!==-1}function f(n,t){var i=n.getRemoteCandidates().find(function(n){return t.foundation===n.foundation&&t.ip===n.ip&&t.port===n.port&&t.priority===n.priority&&t.protocol===n.protocol&&t.type===n.type});return i||n.addRemoteCandidate(t),!i}function r(n,t){var i=new Error(t);return i.name=n,i.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:undefined,OperationError:undefined}[n],i}var i=n("sdp");t.exports=function(n,t){function a(t,i){i.addTrack(t);i.dispatchEvent(new n.MediaStreamTrackEvent("addtrack",{track:t}))}function p(t,i){i.removeTrack(t);i.dispatchEvent(new n.MediaStreamTrackEvent("removetrack",{track:t}))}function v(t,i,r,u){var f=new Event("track");f.track=i;f.receiver=r;f.transceiver={receiver:r};f.streams=u;n.setTimeout(function(){t._dispatchEvent("track",f)})}var c=function(u){var o=this,e=document.createDocumentFragment(),f;if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(n){o[n]=e[n].bind(e)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",u=JSON.parse(JSON.stringify(u||{})),this.usingBundle=u.bundlePolicy==="max-bundle",u.rtcpMuxPolicy==="negotiate")throw r("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");else u.rtcpMuxPolicy||(u.rtcpMuxPolicy="require");switch(u.iceTransportPolicy){case"all":case"relay":break;default:u.iceTransportPolicy="all"}switch(u.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:u.bundlePolicy="balanced"}if(u.iceServers=h(u.iceServers||[],t),this._iceGatherers=[],u.iceCandidatePoolSize)for(f=u.iceCandidatePoolSize;f>0;f--)this._iceGatherers.push(new n.RTCIceGatherer({iceServers:u.iceServers,gatherPolicy:u.iceTransportPolicy}));else u.iceCandidatePoolSize=0;this._config=u;this.transceivers=[];this._sdpSessionId=i.generateSessionId();this._sdpSessionVersion=0;this._dtlsRole=undefined;this._isClosed=!1},y,l;return Object.defineProperty(c.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(c.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),c.prototype.onicecandidate=null,c.prototype.onaddstream=null,c.prototype.ontrack=null,c.prototype.onremovestream=null,c.prototype.onsignalingstatechange=null,c.prototype.oniceconnectionstatechange=null,c.prototype.onconnectionstatechange=null,c.prototype.onicegatheringstatechange=null,c.prototype.onnegotiationneeded=null,c.prototype.ondatachannel=null,c.prototype._dispatchEvent=function(n,t){this._isClosed||(this.dispatchEvent(t),typeof this["on"+n]=="function"&&this["on"+n](t))},c.prototype._emitGatheringStateChange=function(){var n=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",n)},c.prototype.getConfiguration=function(){return this._config},c.prototype.getLocalStreams=function(){return this.localStreams},c.prototype.getRemoteStreams=function(){return this.remoteStreams},c.prototype._createTransceiver=function(n,t){var u=this.transceivers.length>0,i={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:n,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0},r;return this.usingBundle&&u?(i.iceTransport=this.transceivers[0].iceTransport,i.dtlsTransport=this.transceivers[0].dtlsTransport):(r=this._createIceAndDtlsTransports(),i.iceTransport=r.iceTransport,i.dtlsTransport=r.dtlsTransport),t||this.transceivers.push(i),i},c.prototype.addTrack=function(t,i){var e,u,f;if(this._isClosed)throw r("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");if(e=this.transceivers.find(function(n){return n.track===t}),e)throw r("InvalidAccessError","Track already exists.");for(f=0;f<this.transceivers.length;f++)this.transceivers[f].track||this.transceivers[f].kind!==t.kind||(u=this.transceivers[f]);return u||(u=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),this.localStreams.indexOf(i)===-1&&this.localStreams.push(i),u.track=t,u.stream=i,u.rtpSender=new n.RTCRtpSender(t,u.dtlsTransport),u.rtpSender},c.prototype.addStream=function(n){var r=this,i;t>=15025?n.getTracks().forEach(function(t){r.addTrack(t,n)}):(i=n.clone(),n.getTracks().forEach(function(n,t){var r=i.getTracks()[t];n.addEventListener("enabled",function(n){r.enabled=n.enabled})}),i.getTracks().forEach(function(n){r.addTrack(n,i)}))},c.prototype.removeTrack=function(t){var i,u,f;if(this._isClosed)throw r("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(t instanceof n.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");if(i=this.transceivers.find(function(n){return n.rtpSender===t}),!i)throw r("InvalidAccessError","Sender was not created by this connection.");u=i.stream;i.rtpSender.stop();i.rtpSender=null;i.track=null;i.stream=null;f=this.transceivers.map(function(n){return n.stream});f.indexOf(u)===-1&&this.localStreams.indexOf(u)>-1&&this.localStreams.splice(this.localStreams.indexOf(u),1);this._maybeFireNegotiationNeeded()},c.prototype.removeStream=function(n){var t=this;n.getTracks().forEach(function(n){var i=t.getSenders().find(function(t){return t.track===n});i&&t.removeTrack(i)})},c.prototype.getSenders=function(){return this.transceivers.filter(function(n){return!!n.rtpSender}).map(function(n){return n.rtpSender})},c.prototype.getReceivers=function(){return this.transceivers.filter(function(n){return!!n.rtpReceiver}).map(function(n){return n.rtpReceiver})},c.prototype._createIceGatherer=function(t,i){var u=this,r;return i&&t>0?this.transceivers[0].iceGatherer:this._iceGatherers.length?this._iceGatherers.shift():(r=new n.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy}),Object.defineProperty(r,"state",{value:"new",writable:!0}),this.transceivers[t].bufferedCandidateEvents=[],this.transceivers[t].bufferCandidates=function(n){var i=!n.candidate||Object.keys(n.candidate).length===0;r.state=i?"completed":"gathering";u.transceivers[t].bufferedCandidateEvents!==null&&u.transceivers[t].bufferedCandidateEvents.push(n)},r.addEventListener("localcandidate",this.transceivers[t].bufferCandidates),r)},c.prototype._gather=function(t,r){var u=this,f=this.transceivers[r].iceGatherer,e;f.onlocalcandidate||(e=this.transceivers[r].bufferedCandidateEvents,this.transceivers[r].bufferedCandidateEvents=null,f.removeEventListener("localcandidate",this.transceivers[r].bufferCandidates),f.onlocalcandidate=function(n){var e,o,s,h,c,l;u.usingBundle&&r>0||(e=new Event("icecandidate"),e.candidate={sdpMid:t,sdpMLineIndex:r},o=n.candidate,s=!o||Object.keys(o).length===0,s?(f.state==="new"||f.state==="gathering")&&(f.state="completed"):(f.state==="new"&&(f.state="gathering"),o.component=1,o.ufrag=f.getLocalParameters().usernameFragment,h=i.writeCandidate(o),e.candidate=Object.assign(e.candidate,i.parseCandidate(h)),e.candidate.candidate=h,e.candidate.toJSON=function(){return{candidate:e.candidate.candidate,sdpMid:e.candidate.sdpMid,sdpMLineIndex:e.candidate.sdpMLineIndex,usernameFragment:e.candidate.usernameFragment}}),c=i.getMediaSections(u._localDescription.sdp),c[e.candidate.sdpMLineIndex]+=s?"a=end-of-candidates\r\n":"a="+e.candidate.candidate+"\r\n",u._localDescription.sdp=i.getDescription(u._localDescription.sdp)+c.join(""),l=u.transceivers.every(function(n){return n.iceGatherer&&n.iceGatherer.state==="completed"}),u.iceGatheringState!=="gathering"&&(u.iceGatheringState="gathering",u._emitGatheringStateChange()),s||u._dispatchEvent("icecandidate",e),l&&(u._dispatchEvent("icecandidate",new Event("icecandidate")),u.iceGatheringState="complete",u._emitGatheringStateChange()))},n.setTimeout(function(){e.forEach(function(n){f.onlocalcandidate(n)})},0))},c.prototype._createIceAndDtlsTransports=function(){var i=this,r=new n.RTCIceTransport(null),t;return r.onicestatechange=function(){i._updateIceConnectionState();i._updateConnectionState()},t=new n.RTCDtlsTransport(r),t.ondtlsstatechange=function(){i._updateConnectionState()},t.onerror=function(){Object.defineProperty(t,"state",{value:"failed",writable:!0});i._updateConnectionState()},{iceTransport:r,dtlsTransport:t}},c.prototype._disposeIceAndDtlsTransports=function(n){var r=this.transceivers[n].iceGatherer,i,t;r&&(delete r.onlocalcandidate,delete this.transceivers[n].iceGatherer);i=this.transceivers[n].iceTransport;i&&(delete i.onicestatechange,delete this.transceivers[n].iceTransport);t=this.transceivers[n].dtlsTransport;t&&(delete t.ondtlsstatechange,delete t.onerror,delete this.transceivers[n].dtlsTransport)},c.prototype._transceive=function(n,r,f){var e=u(n.localCapabilities,n.remoteCapabilities);r&&n.rtpSender&&(e.encodings=n.sendEncodingParameters,e.rtcp={cname:i.localCName,compound:n.rtcpParameters.compound},n.recvEncodingParameters.length&&(e.rtcp.ssrc=n.recvEncodingParameters[0].ssrc),n.rtpSender.send(e));f&&n.rtpReceiver&&e.codecs.length>0&&(n.kind==="video"&&n.recvEncodingParameters&&t<15019&&n.recvEncodingParameters.forEach(function(n){delete n.rtx}),e.encodings=n.recvEncodingParameters.length?n.recvEncodingParameters:[{}],e.rtcp={compound:n.rtcpParameters.compound},n.rtcpParameters.cname&&(e.rtcp.cname=n.rtcpParameters.cname),n.sendEncodingParameters.length&&(e.rtcp.ssrc=n.sendEncodingParameters[0].ssrc),n.rtpReceiver.receive(e))},c.prototype.setLocalDescription=function(n){var t=this,f,e,s;return["offer","answer"].indexOf(n.type)===-1?Promise.reject(r("TypeError",'Unsupported type "'+n.type+'"')):!o("setLocalDescription",n.type,t.signalingState)||t._isClosed?Promise.reject(r("InvalidStateError","Can not set local "+n.type+" in state "+t.signalingState)):(n.type==="offer"?(f=i.splitSections(n.sdp),e=f.shift(),f.forEach(function(n,r){var u=i.parseRtpParameters(n);t.transceivers[r].localCapabilities=u}),t.transceivers.forEach(function(n,i){t._gather(n.mid,i)})):n.type==="answer"&&(f=i.splitSections(t._remoteDescription.sdp),e=f.shift(),s=i.matchPrefix(e,"a=ice-lite").length>0,f.forEach(function(n,r){var f=t.transceivers[r],v=f.iceGatherer,h=f.iceTransport,c=f.dtlsTransport,y=f.localCapabilities,p=f.remoteCapabilities,w=i.isRejected(n)&&i.matchPrefix(n,"a=bundle-only").length===0,l,o,a;w||f.rejected||(l=i.getIceParameters(n,e),o=i.getDtlsParameters(n,e),s&&(o.role="server"),t.usingBundle&&r!==0||(t._gather(f.mid,r),h.state==="new"&&h.start(v,l,s?"controlling":"controlled"),c.state==="new"&&c.start(o)),a=u(y,p),t._transceive(f,a.codecs.length>0,!1))})),t._localDescription={type:n.type,sdp:n.sdp},n.type==="offer"?t._updateSignalingState("have-local-offer"):t._updateSignalingState("stable"),Promise.resolve())},c.prototype.setRemoteDescription=function(e){var s=this,h,w;if(["offer","answer"].indexOf(e.type)===-1)return Promise.reject(r("TypeError",'Unsupported type "'+e.type+'"'));if(!o("setRemoteDescription",e.type,s.signalingState)||s._isClosed)return Promise.reject(r("InvalidStateError","Can not set remote "+e.type+" in state "+s.signalingState));h={};s.remoteStreams.forEach(function(n){h[n.id]=n});var y=[],b=i.splitSections(e.sdp),c=b.shift(),k=i.matchPrefix(c,"a=ice-lite").length>0,l=i.matchPrefix(c,"a=group:BUNDLE ").length>0;return s.usingBundle=l,w=i.matchPrefix(c,"a=ice-options:")[0],s.canTrickleIceCandidates=w?w.substr(14).split(" ").indexOf("trickle")>=0:!1,b.forEach(function(r,o){var gt=i.splitLines(r),nt=i.getKind(r),tt=i.isRejected(r)&&i.matchPrefix(r,"a=bundle-only").length===0,ot=gt[0].substr(2).split(" ")[2],g=i.getDirection(r,c),w=i.parseMsid(r),vt=i.getMid(r)||i.generateIdentifier(),v,yt,ut,st,b,ht,ct,ft,d,lt,pt,at,et,rt,kt,dt;if(tt||nt==="application"&&(ot==="DTLS/SCTP"||ot==="UDP/DTLS/SCTP")){s.transceivers[o]={mid:vt,kind:nt,protocol:ot,rejected:!0};return}!tt&&s.transceivers[o]&&s.transceivers[o].rejected&&(s.transceivers[o]=s._createTransceiver(nt,!0));lt=i.parseRtpParameters(r);tt||(pt=i.getIceParameters(r,c),at=i.getDtlsParameters(r,c),at.role="client");ct=i.parseRtpEncodingParameters(r);var wt=i.parseRtcpParameters(r),bt=i.matchPrefix(r,"a=end-of-candidates",c).length>0,it=i.matchPrefix(r,"a=candidate:").map(function(n){return i.parseCandidate(n)}).filter(function(n){return n.component===1});(e.type==="offer"||e.type==="answer")&&!tt&&l&&o>0&&s.transceivers[o]&&(s._disposeIceAndDtlsTransports(o),s.transceivers[o].iceGatherer=s.transceivers[0].iceGatherer,s.transceivers[o].iceTransport=s.transceivers[0].iceTransport,s.transceivers[o].dtlsTransport=s.transceivers[0].dtlsTransport,s.transceivers[o].rtpSender&&s.transceivers[o].rtpSender.setTransport(s.transceivers[0].dtlsTransport),s.transceivers[o].rtpReceiver&&s.transceivers[o].rtpReceiver.setTransport(s.transceivers[0].dtlsTransport));e.type!=="offer"||tt?e.type!=="answer"||tt||(v=s.transceivers[o],yt=v.iceGatherer,ut=v.iceTransport,st=v.dtlsTransport,b=v.rtpReceiver,ht=v.sendEncodingParameters,ft=v.localCapabilities,s.transceivers[o].recvEncodingParameters=ct,s.transceivers[o].remoteCapabilities=lt,s.transceivers[o].rtcpParameters=wt,it.length&&ut.state==="new"&&((k||bt)&&(!l||o===0)?ut.setRemoteCandidates(it):it.forEach(function(n){f(v.iceTransport,n)})),l&&o!==0||(ut.state==="new"&&ut.start(yt,pt,"controlling"),st.state==="new"&&st.start(at)),kt=u(v.localCapabilities,v.remoteCapabilities),dt=kt.codecs.filter(function(n){return n.name.toLowerCase()==="rtx"}).length,!dt&&v.sendEncodingParameters[0].rtx&&delete v.sendEncodingParameters[0].rtx,s._transceive(v,g==="sendrecv"||g==="recvonly",g==="sendrecv"||g==="sendonly"),b&&(g==="sendrecv"||g==="sendonly")?(d=b.track,w?(h[w.stream]||(h[w.stream]=new n.MediaStream),a(d,h[w.stream]),y.push([d,b,h[w.stream]])):(h.default||(h.default=new n.MediaStream),a(d,h.default),y.push([d,b,h.default]))):delete v.rtpReceiver):(v=s.transceivers[o]||s._createTransceiver(nt),v.mid=vt,v.iceGatherer||(v.iceGatherer=s._createIceGatherer(o,l)),it.length&&v.iceTransport.state==="new"&&(bt&&(!l||o===0)?v.iceTransport.setRemoteCandidates(it):it.forEach(function(n){f(v.iceTransport,n)})),ft=n.RTCRtpReceiver.getCapabilities(nt),t<15019&&(ft.codecs=ft.codecs.filter(function(n){return n.name!=="rtx"})),ht=v.sendEncodingParameters||[{ssrc:(2*o+2)*1001}],et=!1,g==="sendrecv"||g==="sendonly"?(et=!v.rtpReceiver,b=v.rtpReceiver||new n.RTCRtpReceiver(v.dtlsTransport,nt),et&&(d=b.track,w&&w.stream==="-"||(w?(h[w.stream]||(h[w.stream]=new n.MediaStream,Object.defineProperty(h[w.stream],"id",{get:function(){return w.stream}})),Object.defineProperty(d,"id",{get:function(){return w.track}}),rt=h[w.stream]):(h.default||(h.default=new n.MediaStream),rt=h.default)),rt&&(a(d,rt),v.associatedRemoteMediaStreams.push(rt)),y.push([d,b,rt]))):v.rtpReceiver&&v.rtpReceiver.track&&(v.associatedRemoteMediaStreams.forEach(function(n){var t=n.getTracks().find(function(n){return n.id===v.rtpReceiver.track.id});t&&p(t,n)}),v.associatedRemoteMediaStreams=[]),v.localCapabilities=ft,v.remoteCapabilities=lt,v.rtpReceiver=b,v.rtcpParameters=wt,v.sendEncodingParameters=ht,v.recvEncodingParameters=ct,s._transceive(s.transceivers[o],!1,et))}),s._dtlsRole===undefined&&(s._dtlsRole=e.type==="offer"?"active":"passive"),s._remoteDescription={type:e.type,sdp:e.sdp},e.type==="offer"?s._updateSignalingState("have-remote-offer"):s._updateSignalingState("stable"),Object.keys(h).forEach(function(t){var i=h[t],r;i.getTracks().length&&(s.remoteStreams.indexOf(i)===-1&&(s.remoteStreams.push(i),r=new Event("addstream"),r.stream=i,n.setTimeout(function(){s._dispatchEvent("addstream",r)})),y.forEach(function(n){var t=n[0],r=n[1];i.id===n[2].id&&v(s,t,r,[i])}))}),y.forEach(function(n){n[2]||v(s,n[0],n[1],[])}),n.setTimeout(function(){s&&s.transceivers&&s.transceivers.forEach(function(n){n.iceTransport&&n.iceTransport.state==="new"&&n.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),n.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},c.prototype.close=function(){this.transceivers.forEach(function(n){n.iceTransport&&n.iceTransport.stop();n.dtlsTransport&&n.dtlsTransport.stop();n.rtpSender&&n.rtpSender.stop();n.rtpReceiver&&n.rtpReceiver.stop()});this._isClosed=!0;this._updateSignalingState("closed")},c.prototype._updateSignalingState=function(n){this.signalingState=n;var t=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",t)},c.prototype._maybeFireNegotiationNeeded=function(){var t=this;this.signalingState==="stable"&&this.needNegotiation!==!0&&(this.needNegotiation=!0,n.setTimeout(function(){if(t.needNegotiation){t.needNegotiation=!1;var n=new Event("negotiationneeded");t._dispatchEvent("negotiationneeded",n)}},0))},c.prototype._updateIceConnectionState=function(){var n,t={"new":0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0},i;this.transceivers.forEach(function(n){n.iceTransport&&!n.rejected&&t[n.iceTransport.state]++});n="new";t.failed>0?n="failed":t.checking>0?n="checking":t.disconnected>0?n="disconnected":t.new>0?n="new":t.connected>0?n="connected":t.completed>0&&(n="completed");n!==this.iceConnectionState&&(this.iceConnectionState=n,i=new Event("iceconnectionstatechange"),this._dispatchEvent("iceconnectionstatechange",i))},c.prototype._updateConnectionState=function(){var t,n={"new":0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0},i;this.transceivers.forEach(function(t){t.iceTransport&&t.dtlsTransport&&!t.rejected&&(n[t.iceTransport.state]++,n[t.dtlsTransport.state]++)});n.connected+=n.completed;t="new";n.failed>0?t="failed":n.connecting>0?t="connecting":n.disconnected>0?t="disconnected":n.new>0?t="new":n.connected>0&&(t="connected");t!==this.connectionState&&(this.connectionState=t,i=new Event("connectionstatechange"),this._dispatchEvent("connectionstatechange",i))},c.prototype.createOffer=function(){var u=this,o,c;if(u._isClosed)return Promise.reject(r("InvalidStateError","Can not call createOffer after close"));var s=u.transceivers.filter(function(n){return n.kind==="audio"}).length,h=u.transceivers.filter(function(n){return n.kind==="video"}).length,f=arguments[0];if(f){if(f.mandatory||f.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");f.offerToReceiveAudio!==undefined&&(s=f.offerToReceiveAudio===!0?1:f.offerToReceiveAudio===!1?0:f.offerToReceiveAudio);f.offerToReceiveVideo!==undefined&&(h=f.offerToReceiveVideo===!0?1:f.offerToReceiveVideo===!1?0:f.offerToReceiveVideo)}for(u.transceivers.forEach(function(n){n.kind==="audio"?(s--,s<0&&(n.wantReceive=!1)):n.kind==="video"&&(h--,h<0&&(n.wantReceive=!1))});s>0||h>0;)s>0&&(u._createTransceiver("audio"),s--),h>0&&(u._createTransceiver("video"),h--);return o=i.writeSessionBoilerplate(u._sdpSessionId,u._sdpSessionVersion++),u.transceivers.forEach(function(r,f){var h=r.track,s=r.kind,c=r.mid||i.generateIdentifier(),e,o;r.mid=c;r.iceGatherer||(r.iceGatherer=u._createIceGatherer(f,u.usingBundle));e=n.RTCRtpSender.getCapabilities(s);t<15019&&(e.codecs=e.codecs.filter(function(n){return n.name!=="rtx"}));e.codecs.forEach(function(n){n.name==="H264"&&n.parameters["level-asymmetry-allowed"]===undefined&&(n.parameters["level-asymmetry-allowed"]="1");r.remoteCapabilities&&r.remoteCapabilities.codecs&&r.remoteCapabilities.codecs.forEach(function(t){n.name.toLowerCase()===t.name.toLowerCase()&&n.clockRate===t.clockRate&&(n.preferredPayloadType=t.payloadType)})});e.headerExtensions.forEach(function(n){var t=r.remoteCapabilities&&r.remoteCapabilities.headerExtensions||[];t.forEach(function(t){n.uri===t.uri&&(n.id=t.id)})});o=r.sendEncodingParameters||[{ssrc:(2*f+1)*1001}];h&&t>=15019&&s==="video"&&!o[0].rtx&&(o[0].rtx={ssrc:o[0].ssrc+1});r.wantReceive&&(r.rtpReceiver=new n.RTCRtpReceiver(r.dtlsTransport,s));r.localCapabilities=e;r.sendEncodingParameters=o}),u._config.bundlePolicy!=="max-compat"&&(o+="a=group:BUNDLE "+u.transceivers.map(function(n){return n.mid}).join(" ")+"\r\n"),o+="a=ice-options:trickle\r\n",u.transceivers.forEach(function(n,t){o+=e(n,n.localCapabilities,"offer",n.stream,u._dtlsRole);o+="a=rtcp-rsize\r\n";n.iceGatherer&&u.iceGatheringState!=="new"&&(t===0||!u.usingBundle)&&(n.iceGatherer.getLocalCandidates().forEach(function(n){n.component=1;o+="a="+i.writeCandidate(n)+"\r\n"}),n.iceGatherer.state==="completed"&&(o+="a=end-of-candidates\r\n"))}),c=new n.RTCSessionDescription({type:"offer",sdp:o}),Promise.resolve(c)},c.prototype.createAnswer=function(){var f=this,o,s,h;return f._isClosed?Promise.reject(r("InvalidStateError","Can not call createAnswer after close")):(f.signalingState==="have-remote-offer"||f.signalingState==="have-local-pranswer")?(o=i.writeSessionBoilerplate(f._sdpSessionId,f._sdpSessionVersion++),f.usingBundle&&(o+="a=group:BUNDLE "+f.transceivers.map(function(n){return n.mid}).join(" ")+"\r\n"),o+="a=ice-options:trickle\r\n",s=i.getMediaSections(f._remoteDescription.sdp).length,f.transceivers.forEach(function(n,i){var r,h,c;if(!(i+1>s)){if(n.rejected){n.kind==="application"?o+=n.protocol==="DTLS/SCTP"?"m=application 0 DTLS/SCTP 5000\r\n":"m=application 0 "+n.protocol+" webrtc-datachannel\r\n":n.kind==="audio"?o+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":n.kind==="video"&&(o+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n");o+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+n.mid+"\r\n";return}n.stream&&(n.kind==="audio"?r=n.stream.getAudioTracks()[0]:n.kind==="video"&&(r=n.stream.getVideoTracks()[0]),r&&t>=15019&&n.kind==="video"&&!n.sendEncodingParameters[0].rtx&&(n.sendEncodingParameters[0].rtx={ssrc:n.sendEncodingParameters[0].ssrc+1}));h=u(n.localCapabilities,n.remoteCapabilities);c=h.codecs.filter(function(n){return n.name.toLowerCase()==="rtx"}).length;!c&&n.sendEncodingParameters[0].rtx&&delete n.sendEncodingParameters[0].rtx;o+=e(n,h,"answer",n.stream,f._dtlsRole);n.rtcpParameters&&n.rtcpParameters.reducedSize&&(o+="a=rtcp-rsize\r\n")}}),h=new n.RTCSessionDescription({type:"answer",sdp:o}),Promise.resolve(h)):Promise.reject(r("InvalidStateError","Can not call createAnswer in signalingState "+f.signalingState))},c.prototype.addIceCandidate=function(n){var t=this,u;return n&&!(n.sdpMLineIndex!==undefined||n.sdpMid)?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(e,o){var h,c,l,a,s,v;if(t._remoteDescription){if(n&&n.candidate!==""){if(c=n.sdpMLineIndex,n.sdpMid)for(l=0;l<t.transceivers.length;l++)if(t.transceivers[l].mid===n.sdpMid){c=l;break}if(a=t.transceivers[c],a){if(a.rejected||(s=Object.keys(n.candidate).length>0?i.parseCandidate(n.candidate):{},s.protocol==="tcp"&&(s.port===0||s.port===9))||s.component&&s.component!==1)return e();if((c===0||c>0&&a.iceTransport!==t.transceivers[0].iceTransport)&&!f(a.iceTransport,s))return o(r("OperationError","Can not add ICE candidate"));v=n.candidate.trim();v.indexOf("a=")===0&&(v=v.substr(2));u=i.getMediaSections(t._remoteDescription.sdp);u[c]+="a="+(s.type?v:"end-of-candidates")+"\r\n";t._remoteDescription.sdp=i.getDescription(t._remoteDescription.sdp)+u.join("")}else return o(r("OperationError","Can not add ICE candidate"))}else for(h=0;h<t.transceivers.length;h++)if(!t.transceivers[h].rejected&&(t.transceivers[h].iceTransport.addRemoteCandidate({}),u=i.getMediaSections(t._remoteDescription.sdp),u[h]+="a=end-of-candidates\r\n",t._remoteDescription.sdp=i.getDescription(t._remoteDescription.sdp)+u.join(""),t.usingBundle))break}else return o(r("InvalidStateError","Can not add ICE candidate without a remote description"));e()})},c.prototype.getStats=function(t){var i,u;if(t&&t instanceof n.MediaStreamTrack){if(i=null,this.transceivers.forEach(function(n){n.rtpSender&&n.rtpSender.track===t?i=n.rtpSender:n.rtpReceiver&&n.rtpReceiver.track===t&&(i=n.rtpReceiver)}),!i)throw r("InvalidAccessError","Invalid selector.");return i.getStats()}return u=[],this.transceivers.forEach(function(n){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(t){n[t]&&u.push(n[t].getStats())})}),Promise.all(u).then(function(n){var t=new Map;return n.forEach(function(n){n.forEach(function(n){t.set(n.id,n)})}),t})},y=["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"],y.forEach(function(t){var i=n[t],r;i&&i.prototype&&i.prototype.getStats&&(r=i.prototype.getStats,i.prototype.getStats=function(){return r.apply(this).then(function(n){var t=new Map;return Object.keys(n).forEach(function(i){n[i].type=s(n[i]);t.set(i,n[i])}),t})})}),l=["createOffer","createAnswer"],l.forEach(function(n){var t=c.prototype[n];c.prototype[n]=function(){var n=arguments;return typeof n[0]=="function"||typeof n[1]=="function"?t.apply(this,[arguments[2]]).then(function(t){typeof n[0]=="function"&&n[0].apply(null,[t])},function(t){typeof n[1]=="function"&&n[1].apply(null,[t])}):t.apply(this,arguments)}}),l=["setLocalDescription","setRemoteDescription","addIceCandidate"],l.forEach(function(n){var t=c.prototype[n];c.prototype[n]=function(){var n=arguments;return typeof n[1]=="function"||typeof n[2]=="function"?t.apply(this,arguments).then(function(){typeof n[1]=="function"&&n[1].apply(null)},function(t){typeof n[2]=="function"&&n[2].apply(null,[t])}):t.apply(this,arguments)}}),["getStats"].forEach(function(n){var t=c.prototype[n];c.prototype[n]=function(){var n=arguments;return typeof n[1]=="function"?t.apply(this,arguments).then(function(){typeof n[1]=="function"&&n[1].apply(null)}):t.apply(this,arguments)}}),c}},{sdp:17}],17:[function(n,t){"use strict";var i={};i.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)};i.localCName=i.generateIdentifier();i.splitLines=function(n){return n.trim().split("\n").map(function(n){return n.trim()})};i.splitSections=function(n){var t=n.split("\nm=");return t.map(function(n,t){return(t>0?"m="+n:n).trim()+"\r\n"})};i.getDescription=function(n){var t=i.splitSections(n);return t&&t[0]};i.getMediaSections=function(n){var t=i.splitSections(n);return t.shift(),t};i.matchPrefix=function(n,t){return i.splitLines(n).filter(function(n){return n.indexOf(t)===0})};i.parseCandidate=function(n){var t,r,i;for(t=n.indexOf("a=candidate:")===0?n.substring(12).split(" "):n.substring(10).split(" "),r={foundation:t[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]},i=8;i<t.length;i+=2)switch(t[i]){case"raddr":r.relatedAddress=t[i+1];break;case"rport":r.relatedPort=parseInt(t[i+1],10);break;case"tcptype":r.tcpType=t[i+1];break;case"ufrag":r.ufrag=t[i+1];r.usernameFragment=t[i+1];break;default:r[t[i]]=t[i+1]}return r};i.writeCandidate=function(n){var t=[],i;return t.push(n.foundation),t.push(n.component),t.push(n.protocol.toUpperCase()),t.push(n.priority),t.push(n.address||n.ip),t.push(n.port),i=n.type,t.push("typ"),t.push(i),i!=="host"&&n.relatedAddress&&n.relatedPort&&(t.push("raddr"),t.push(n.relatedAddress),t.push("rport"),t.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(t.push("tcptype"),t.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(t.push("ufrag"),t.push(n.usernameFragment||n.ufrag)),"candidate:"+t.join(" ")};i.parseIceOptions=function(n){return n.substr(14).split(" ")};i.parseRtpMap=function(n){var t=n.substr(9).split(" "),i={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),i.name=t[0],i.clockRate=parseInt(t[1],10),i.channels=t.length===3?parseInt(t[2],10):1,i.numChannels=i.channels,i};i.writeRtpMap=function(n){var i=n.payloadType,t;return n.preferredPayloadType!==undefined&&(i=n.preferredPayloadType),t=n.channels||n.numChannels||1,"a=rtpmap:"+i+" "+n.name+"/"+n.clockRate+(t!==1?"/"+t:"")+"\r\n"};i.parseExtmap=function(n){var t=n.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}};i.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+"\r\n"};i.parseFmtp=function(n){for(var r={},t,u=n.substr(n.indexOf(" ")+1).split(";"),i=0;i<u.length;i++)t=u[i].trim().split("="),r[t[0].trim()]=t[1];return r};i.writeFmtp=function(n){var i="",r=n.payloadType,t;return n.preferredPayloadType!==undefined&&(r=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length&&(t=[],Object.keys(n.parameters).forEach(function(i){n.parameters[i]?t.push(i+"="+n.parameters[i]):t.push(i)}),i+="a=fmtp:"+r+" "+t.join(";")+"\r\n"),i};i.parseRtcpFb=function(n){var t=n.substr(n.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}};i.writeRtcpFb=function(n){var t="",i=n.payloadType;return n.preferredPayloadType!==undefined&&(i=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(function(n){t+="a=rtcp-fb:"+i+" "+n.type+(n.parameter&&n.parameter.length?" "+n.parameter:"")+"\r\n"}),t};i.parseSsrcMedia=function(n){var t=n.indexOf(" "),i={ssrc:parseInt(n.substr(7,t-7),10)},r=n.indexOf(":",t);return r>-1?(i.attribute=n.substr(t+1,r-t-1),i.value=n.substr(r+1)):i.attribute=n.substr(t+1),i};i.parseSsrcGroup=function(n){var t=n.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map(function(n){return parseInt(n,10)})}};i.getMid=function(n){var t=i.matchPrefix(n,"a=mid:")[0];if(t)return t.substr(6)};i.parseFingerprint=function(n){var t=n.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}};i.getDtlsParameters=function(n,t){var r=i.matchPrefix(n+t,"a=fingerprint:");return{role:"auto",fingerprints:r.map(i.parseFingerprint)}};i.writeDtlsParameters=function(n,t){var i="a=setup:"+t+"\r\n";return n.fingerprints.forEach(function(n){i+="a=fingerprint:"+n.algorithm+" "+n.value+"\r\n"}),i};i.parseCryptoLine=function(n){var t=n.substr(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}};i.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?i.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+"\r\n"};i.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;var t=n.substr(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:undefined,mkiLength:t[2]?t[2].split(":")[1]:undefined}};i.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")};i.getCryptoParameters=function(n,t){var r=i.matchPrefix(n+t,"a=crypto:");return r.map(i.parseCryptoLine)};i.getIceParameters=function(n,t){var r=i.matchPrefix(n+t,"a=ice-ufrag:")[0],u=i.matchPrefix(n+t,"a=ice-pwd:")[0];return(r&&u)?{usernameFragment:r.substr(12),password:u.substr(10)}:null};i.writeIceParameters=function(n){return"a=ice-ufrag:"+n.usernameFragment+"\r\na=ice-pwd:"+n.password+"\r\n"};i.parseRtpParameters=function(n){for(var u,e,t,o,r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},h=i.splitLines(n),s=h[0].split(" "),f=3;f<s.length;f++)if(u=s[f],e=i.matchPrefix(n,"a=rtpmap:"+u+" ")[0],e){t=i.parseRtpMap(e);o=i.matchPrefix(n,"a=fmtp:"+u+" ");t.parameters=o.length?i.parseFmtp(o[0]):{};t.rtcpFeedback=i.matchPrefix(n,"a=rtcp-fb:"+u+" ").map(i.parseRtcpFb);r.codecs.push(t);switch(t.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(t.name.toUpperCase())}}return i.matchPrefix(n,"a=extmap:").forEach(function(n){r.headerExtensions.push(i.parseExtmap(n))}),r};i.writeRtpDescription=function(n,t){var r="",u;return r+="m="+n+" ",r+=t.codecs.length>0?"9":"0",r+=" UDP/TLS/RTP/SAVPF ",r+=t.codecs.map(function(n){return n.preferredPayloadType!==undefined?n.preferredPayloadType:n.payloadType}).join(" ")+"\r\n",r+="c=IN IP4 0.0.0.0\r\n",r+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(function(n){r+=i.writeRtpMap(n);r+=i.writeFmtp(n);r+=i.writeRtcpFb(n)}),u=0,t.codecs.forEach(function(n){n.maxptime>u&&(u=n.maxptime)}),u>0&&(r+="a=maxptime:"+u+"\r\n"),r+="a=rtcp-mux\r\n",t.headerExtensions&&t.headerExtensions.forEach(function(n){r+=i.writeExtmap(n)}),r};i.parseRtpEncodingParameters=function(n){var r=[],e=i.parseRtpParameters(n),h=e.fecMechanisms.indexOf("RED")!==-1,c=e.fecMechanisms.indexOf("ULPFEC")!==-1,s=i.matchPrefix(n,"a=ssrc:").map(function(n){return i.parseSsrcMedia(n)}).filter(function(n){return n.attribute==="cname"}),u=s.length>0&&s[0].ssrc,o,f=i.matchPrefix(n,"a=ssrc-group:FID").map(function(n){var t=n.substr(17).split(" ");return t.map(function(n){return parseInt(n,10)})}),t;return f.length>0&&f[0].length>1&&f[0][0]===u&&(o=f[0][1]),e.codecs.forEach(function(n){if(n.name.toUpperCase()==="RTX"&&n.parameters.apt){var t={ssrc:u,codecPayloadType:parseInt(n.parameters.apt,10)};u&&o&&(t.rtx={ssrc:o});r.push(t);h&&(t=JSON.parse(JSON.stringify(t)),t.fec={ssrc:u,mechanism:c?"red+ulpfec":"red"},r.push(t))}}),r.length===0&&u&&r.push({ssrc:u}),t=i.matchPrefix(n,"b="),t.length&&(t=t[0].indexOf("b=TIAS:")===0?parseInt(t[0].substr(7),10):t[0].indexOf("b=AS:")===0?parseInt(t[0].substr(5),10)*1e3*.95-16e3:undefined,r.forEach(function(n){n.maxBitrate=t})),r};i.parseRtcpParameters=function(n){var t={},r=i.matchPrefix(n,"a=ssrc:").map(function(n){return i.parseSsrcMedia(n)}).filter(function(n){return n.attribute==="cname"})[0],u,f;return r&&(t.cname=r.value,t.ssrc=r.ssrc),u=i.matchPrefix(n,"a=rtcp-rsize"),t.reducedSize=u.length>0,t.compound=u.length===0,f=i.matchPrefix(n,"a=rtcp-mux"),t.mux=f.length>0,t};i.parseMsid=function(n){var t,u=i.matchPrefix(n,"a=msid:"),r;return u.length===1?(t=u[0].substr(7).split(" "),{stream:t[0],track:t[1]}):(r=i.matchPrefix(n,"a=ssrc:").map(function(n){return i.parseSsrcMedia(n)}).filter(function(n){return n.attribute==="msid"}),r.length>0?(t=r[0].value.split(" "),{stream:t[0],track:t[1]}):void 0)};i.parseSctpDescription=function(n){var o=i.parseMLine(n),f=i.matchPrefix(n,"a=max-message-size:"),t,r,e,u;return(f.length>0&&(t=parseInt(f[0].substr(19),10)),isNaN(t)&&(t=65536),r=i.matchPrefix(n,"a=sctp-port:"),r.length>0)?{port:parseInt(r[0].substr(12),10),protocol:o.fmt,maxMessageSize:t}:(e=i.matchPrefix(n,"a=sctpmap:"),e.length>0?(u=i.matchPrefix(n,"a=sctpmap:")[0].substr(10).split(" "),{port:parseInt(u[0],10),protocol:u[1],maxMessageSize:t}):void 0)};i.writeSctpDescription=function(n,t){var i=[];return i=n.protocol!=="DTLS/SCTP"?["m="+n.kind+" 9 "+n.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+n.kind+" 9 "+n.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],t.maxMessageSize!==undefined&&i.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),i.join("")};i.generateSessionId=function(){return Math.random().toString().substr(2,21)};i.writeSessionBoilerplate=function(n,t,r){var u,e=t!==undefined?t:2,f;return u=n?n:i.generateSessionId(),f=r||"thisisadapterortc","v=0\r\no="+f+" "+u+" "+e+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"};i.writeMediaSection=function(n,t,r,u){var f=i.writeRtpDescription(n.kind,t),e;return f+=i.writeIceParameters(n.iceGatherer.getLocalParameters()),f+=i.writeDtlsParameters(n.dtlsTransport.getLocalParameters(),r==="offer"?"actpass":"active"),f+="a=mid:"+n.mid+"\r\n",f+=n.direction?"a="+n.direction+"\r\n":n.rtpSender&&n.rtpReceiver?"a=sendrecv\r\n":n.rtpSender?"a=sendonly\r\n":n.rtpReceiver?"a=recvonly\r\n":"a=inactive\r\n",n.rtpSender&&(e="msid:"+u.id+" "+n.rtpSender.track.id+"\r\n",f+="a="+e,f+="a=ssrc:"+n.sendEncodingParameters[0].ssrc+" "+e,n.sendEncodingParameters[0].rtx&&(f+="a=ssrc:"+n.sendEncodingParameters[0].rtx.ssrc+" "+e,f+="a=ssrc-group:FID "+n.sendEncodingParameters[0].ssrc+" "+n.sendEncodingParameters[0].rtx.ssrc+"\r\n")),f+="a=ssrc:"+n.sendEncodingParameters[0].ssrc+" cname:"+i.localCName+"\r\n",n.rtpSender&&n.sendEncodingParameters[0].rtx&&(f+="a=ssrc:"+n.sendEncodingParameters[0].rtx.ssrc+" cname:"+i.localCName+"\r\n"),f};i.getDirection=function(n,t){for(var u=i.splitLines(n),r=0;r<u.length;r++)switch(u[r]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return u[r].substr(2)}return t?i.getDirection(t):"sendrecv"};i.getKind=function(n){var t=i.splitLines(n),r=t[0].split(" ");return r[0].substr(2)};i.isRejected=function(n){return n.split(" ",2)[1]==="0"};i.parseMLine=function(n){var r=i.splitLines(n),t=r[0].substr(2).split(" ");return{kind:t[0],port:parseInt(t[1],10),protocol:t[2],fmt:t.slice(3).join(" ")}};i.parseOLine=function(n){var r=i.matchPrefix(n,"o=")[0],t=r.substr(2).split(" ");return{username:t[0],sessionId:t[1],sessionVersion:parseInt(t[2],10),netType:t[3],addressType:t[4],address:t[5]}};i.isValidSDP=function(n){var r,t;if(typeof n!="string"||n.length===0)return!1;for(r=i.splitLines(n),t=0;t<r.length;t++)if(r[t].length<2||r[t].charAt(1)!=="=")return!1;return!0};typeof t=="object"&&(t.exports=i)},{}]},{},[1])(1)});