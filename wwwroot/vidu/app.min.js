function startSession(n){appUnPublishing();try{session.disconnect()}catch(t){}session=undefined;OV=undefined;document.getElementById("videos").innerHTML="";sessionId?joinRoom(n):joinRoom(n);return}function joinRoom(n){OV=new OpenVidu;session=OV.initSession();session.on("connectionCreated",function(){});session.on("connectionDestroyed",function(){});session.on("streamCreated",function(n){var t,i;if(console.log("ssssssssss : "),console.log(n),console.log(n.stream.streamId),n.stream.typeOfVideo=="SCREEN")if(session3!=0&&n.stream.connection.connectionId==session3.connection.connectionId)console.warn("this is local chreen ; ");else{i=session.subscribe(n.stream,"screenShareElemnt");i.on("videoElementCreated",function(){screenShareRemoteStatus=1;connectToScreenShare()});i.on("videoElementDestroyed",function(){console.warn("by sessen 111.. ");screenShareRemoteStatus=0;disconnectFromScreenShare()})}else{t=session.subscribe(n.stream,"videos");t.on("videoElementCreated",function(n){console.warn("event videoElementCreated");console.log(n);resizingVideoBox()});t.on("videoElementDestroyed",function(){resizingVideoBox()})}});session.on("streamPropertyChanged",function(n){var i,r,u;console.log("dddddddddddddddddddddddddddddddddddddddddd : ");console.warn(n);i=n.stream.isLocalStreamPublished;i&&(r=n.stream.videoActive,u=n.stream.audioActive,document.getElementById("mute-video").style.color=r?"red":"black",document.getElementById("mute-audio").style.color=u?"red":"black");var f=n.newValue,e=n.stream.streamManager.id,t=document.getElementById(e),o=n.changedProperty;o=="videoActive"&&(f?(t.style.display="block",t.parentNode.style.display="block"):(t.style.display="none",t.parentNode.style.display="none"));console.log(t);resizingVideoBox()});session.on("streamDestroyed",function(n){console.log("eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee :streamDestroyed ");console.warn(n)});session.on("signal",n=>{console.log(n.data)});session.on("reconnecting",()=>console.warn("Oops! Trying to reconnect to the session aliiiiiiiiiiiiiiiiiiiiiiiii"));session.on("reconnected",()=>{console.log("Hurray!----------------------- You successfully reconnected to the session aliiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiii")});session.on("sessionDisconnected",n=>{n.reason==="networkDisconnect"?console.warn("Dang-it... You lost your connection to the session aliiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiii"):console.warn("Dang-it... You lost your connection to the session uuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuu")});getToken(sessionId).then(t=>{toktok=t,session.connect(t).then(()=>{board.publish?n&&appPublishByDevice():console.log("no publish")}).catch(n=>{console.log("There was an error connecting to the session:",n.code,n.message)})})}function appPublishing(){(console.log("publish"),console.log(publisher),appUnPublishing(),videoEnabled||audioEnabled)&&(console.log("reconectinMode : "+reconectinMode),reconectinMode==0?($("#deviceModal").modal("toggle"),device.start()):appPublishByDevice())}function appPublishByDevice(){console.log("audio select : "+device.audioDevice);console.log("video select : "+device.videoDevice);audioEnabled&&device.audioDevice==undefined&&(alert("your micrifgone not found"),audioEnabled=!1);videoEnabled&&device.videoDevice==undefined&&(videoEnabled=!1,alert("your camera not found"));iconDisablVidu(6e3,iconViduPanel);publisher=OV.initPublisher("videos",{audioSource:device.audioDevice?device.audioDevice:!1,videoSource:device.videoDevice?device.videoDevice:!1,publishAudio:audioEnabled,publishVideo:videoEnabled,resolution:"300*200",frameRate:10,insertMode:"PREPEND",mirror:!1});publisher.on("videoElementCreated",function(n){resizingVideoBox();$(n.element).prop("muted",!0);var t=n.target.stream.videoActive,i=n.target.stream.audioActive;document.getElementById("mute-video").style.color=t?"red":"black";document.getElementById("mute-audio").style.color=i?"red":"black";iconEnableVidu(iconViduPanel);setTimeout(function(){var t,i,r;(console.log("timeout"),console.warn("videoElementCreated"),console.warn(n),t=n.target.stream.streamId,console.warn("publisher streamId is : "+t),t!=undefined)&&(i=n.target.stream.connection.connectionId,console.log(t),r={type:"userManager",action:"setStreamId",streamId:t,connectionId:i},mainApp.sendToServer(r),console.log("timeout 2"))},2e3)});publisher.on("videoElementDestroyed",function(){resizingVideoBox();document.getElementById("mute-video").style.color="black";document.getElementById("mute-audio").style.color="black"});session.publish(publisher);console.warn("publish complate ...")}function appUnPublishing(){if(publisher==undefined)console.log("unpublish");else{try{session.unpublish(publisher)}catch(n){console.log("error in : session.unpublish(publisher);")}publisher=undefined}}function appPublishToggle(){publisher==undefined?(console.log("unpublish"),appPublishing()):(session.unpublish(publisher),publisher=undefined)}function leaveRoom(){iconDisablVidu(2e3,iconViduPanel);appUnPublishing();videoEnabled=!1;audioEnabled=!1}function muteAudio(){if(iconDisablVidu(2e3,iconViduPanel),audioEnabled=!audioEnabled,!audioEnabled&&!videoEnabled){leaveRoom();return}if(publisher==undefined){console.log("unpublish");reconectinMode=0;appPublishing();return}if(!audioEnabled){publisher.publishAudio(!1);return}reconectinMode=0;$("#deviceModal").modal("toggle");device.start()}function muteVideo(){if(iconDisablVidu(2e3,iconViduPanel),videoEnabled=!videoEnabled,!audioEnabled&&!videoEnabled){leaveRoom();return}if(console.log("videoEnabled : "+videoEnabled),publisher==undefined){console.log("unpublish");reconectinMode=0;appPublishing();return}if(!videoEnabled){publisher.publishVideo(!1);return}reconectinMode=0;$("#deviceModal").modal("toggle");device.start()}function iconDisablVidu(n,t){t.classList.add("disabledbutton");setTimeout(function(){iconEnableVidu(t)},n)}function iconEnableVidu(n){n.classList.remove("disabledbutton")}function randomString(){return Math.random().toString(36).slice(2)}function getToken(n){return createSession(n).then(n=>createToken(n))}function createSession(n){return new Promise(t=>{$.ajax({type:"POST",url:OPENVIDU_SERVER_URL+"/api/sessions",data:JSON.stringify({customSessionId:n,recordingMode:"MANUAL",outputMode:"COMPOSED",recordingLayout:"BEST_FIT"}),headers:{Authorization:"Basic "+btoa("OPENVIDUAPP:"+OPENVIDU_SERVER_SECRET),"Content-Type":"application/json"},success:n=>t(n.id),error:i=>{i.status===409?t(n):console.log("cant acces to this ip : ffffffffffffffffffff")}})})}function createToken(n){return new Promise((t,i)=>{$.ajax({type:"POST",url:OPENVIDU_SERVER_URL+"/api/tokens",data:JSON.stringify({session:n}),headers:{Authorization:"Basic "+btoa("OPENVIDUAPP:"+OPENVIDU_SERVER_SECRET),"Content-Type":"application/json"},success:n=>t(n.token),error:n=>i(n)})})}var OV,session,publisher,screenSubscriber,sessionId=board.meetID,audioEnabled=board.publish,videoEnabled=!1,numOfVideos=0,reconectinMode=0,toktok,OPENVIDU_SERVER_URL,OPENVIDU_SERVER_SECRET;window.addEventListener("beforeunload",function(){session&&session.disconnect();session3&&session.disconnect()});OPENVIDU_SERVER_URL="https://demos.openvidu.io";OPENVIDU_SERVER_SECRET="MY_SECRET";